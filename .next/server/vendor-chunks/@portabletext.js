"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@portabletext";
exports.ids = ["vendor-chunks/@portabletext"];
exports.modules = {

/***/ "(ssr)/./node_modules/@portabletext/block-tools/lib/_chunks-es/helpers.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@portabletext/block-tools/lib/_chunks-es/helpers.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BLOCK_DEFAULT_STYLE: () => (/* binding */ BLOCK_DEFAULT_STYLE),\n/* harmony export */   DEFAULT_BLOCK: () => (/* binding */ DEFAULT_BLOCK),\n/* harmony export */   DEFAULT_SPAN: () => (/* binding */ DEFAULT_SPAN),\n/* harmony export */   HTML_BLOCK_TAGS: () => (/* binding */ HTML_BLOCK_TAGS),\n/* harmony export */   HTML_DECORATOR_TAGS: () => (/* binding */ HTML_DECORATOR_TAGS),\n/* harmony export */   HTML_HEADER_TAGS: () => (/* binding */ HTML_HEADER_TAGS),\n/* harmony export */   HTML_LIST_CONTAINER_TAGS: () => (/* binding */ HTML_LIST_CONTAINER_TAGS),\n/* harmony export */   HTML_LIST_ITEM_TAGS: () => (/* binding */ HTML_LIST_ITEM_TAGS),\n/* harmony export */   HTML_SPAN_TAGS: () => (/* binding */ HTML_SPAN_TAGS),\n/* harmony export */   PRESERVE_WHITESPACE_TAGS: () => (/* binding */ PRESERVE_WHITESPACE_TAGS),\n/* harmony export */   defaultParseHtml: () => (/* binding */ defaultParseHtml),\n/* harmony export */   ensureRootIsBlocks: () => (/* binding */ ensureRootIsBlocks),\n/* harmony export */   flattenNestedBlocks: () => (/* binding */ flattenNestedBlocks),\n/* harmony export */   isElement: () => (/* binding */ isElement),\n/* harmony export */   isEqualMarks: () => (/* binding */ isEqualMarks),\n/* harmony export */   isMinimalBlock: () => (/* binding */ isMinimalBlock),\n/* harmony export */   isMinimalSpan: () => (/* binding */ isMinimalSpan),\n/* harmony export */   isNodeList: () => (/* binding */ isNodeList),\n/* harmony export */   isPlaceholderAnnotation: () => (/* binding */ isPlaceholderAnnotation),\n/* harmony export */   isPlaceholderDecorator: () => (/* binding */ isPlaceholderDecorator),\n/* harmony export */   resolveJsType: () => (/* binding */ resolveJsType),\n/* harmony export */   tagName: () => (/* binding */ tagName)\n/* harmony export */ });\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n\nconst objectToString = Object.prototype.toString;\nfunction resolveJsType(val) {\n  switch (objectToString.call(val)) {\n    case \"[object Function]\":\n      return \"function\";\n    case \"[object Date]\":\n      return \"date\";\n    case \"[object RegExp]\":\n      return \"regexp\";\n    case \"[object Arguments]\":\n      return \"arguments\";\n    case \"[object Array]\":\n      return \"array\";\n    case \"[object String]\":\n      return \"string\";\n  }\n  return val === null ? \"null\" : val === void 0 ? \"undefined\" : val && typeof val == \"object\" && \"nodeType\" in val && val.nodeType === 1 ? \"element\" : val === Object(val) ? \"object\" : typeof val;\n}\nfunction isEqualMarks(a, b) {\n  if (!a || !b)\n    return a === b;\n  if (a.length !== b.length)\n    return !1;\n  for (let index = 0; index < a.length; index++)\n    if (a[index] !== b[index])\n      return !1;\n  return !0;\n}\nfunction isDeepEqual(data, other) {\n  return isDeepEqualImplementation(data, other);\n}\nfunction isDeepEqualImplementation(data, other) {\n  if (data === other || Object.is(data, other))\n    return !0;\n  if (typeof data != \"object\" || typeof other != \"object\" || data === null || other === null || Object.getPrototypeOf(data) !== Object.getPrototypeOf(other))\n    return !1;\n  if (Array.isArray(data))\n    return isDeepEqualArrays(data, other);\n  if (data instanceof Map)\n    return isDeepEqualMaps(data, other);\n  if (data instanceof Set)\n    return isDeepEqualSets(data, other);\n  if (data instanceof Date)\n    return data.getTime() === other.getTime();\n  if (data instanceof RegExp)\n    return data.toString() === other.toString();\n  if (Object.keys(data).length !== Object.keys(other).length)\n    return !1;\n  for (const [key, value] of Object.entries(data))\n    if (!(key in other) || !isDeepEqualImplementation(\n      value,\n      // @ts-expect-error [ts7053] - We already checked that `other` has `key`\n      other[key]\n    ))\n      return !1;\n  return !0;\n}\nfunction isDeepEqualArrays(data, other) {\n  if (data.length !== other.length)\n    return !1;\n  for (const [index, item] of data.entries())\n    if (!isDeepEqualImplementation(item, other[index]))\n      return !1;\n  return !0;\n}\nfunction isDeepEqualMaps(data, other) {\n  if (data.size !== other.size)\n    return !1;\n  for (const [key, value] of data.entries())\n    if (!other.has(key) || !isDeepEqualImplementation(value, other.get(key)))\n      return !1;\n  return !0;\n}\nfunction isDeepEqualSets(data, other) {\n  if (data.size !== other.size)\n    return !1;\n  const otherCopy = [...other];\n  for (const dataItem of data) {\n    let isFound = !1;\n    for (const [index, otherItem] of otherCopy.entries())\n      if (isDeepEqualImplementation(dataItem, otherItem)) {\n        isFound = !0, otherCopy.splice(index, 1);\n        break;\n      }\n    if (!isFound)\n      return !1;\n  }\n  return !0;\n}\nfunction isArbitraryTypedObject(object) {\n  return isRecord(object) && typeof object._type == \"string\";\n}\nfunction isRecord(value) {\n  return !!value && (typeof value == \"object\" || typeof value == \"function\");\n}\nfunction flattenNestedBlocks(context, blocks) {\n  return blocks.flatMap((block) => {\n    if (isBlockContainer(block))\n      return flattenNestedBlocks(context, [block.block]);\n    if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block)) {\n      const hasBlockObjects = block.children.some((child) => context.schema.blockObjects.some(\n        (blockObject) => blockObject.name === child._type\n      )), hasBlocks = block.children.some(\n        (child) => child._type === \"__block\" || child._type === \"block\"\n      );\n      if (hasBlockObjects || hasBlocks) {\n        const splitChildren = getSplitChildren(context, block);\n        return splitChildren.length === 1 && splitChildren[0].type === \"children\" && isDeepEqual(splitChildren[0].children, block.children) ? [block] : splitChildren.flatMap((slice) => slice.type === \"block object\" ? [slice.block] : slice.type === \"block\" ? flattenNestedBlocks(context, [\n          slice.block\n        ]) : slice.children.length > 0 ? slice.children.every(\n          (child) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child) && child.text.trim() === \"\"\n        ) ? [] : flattenNestedBlocks(context, [\n          {\n            ...block,\n            children: slice.children\n          }\n        ]) : []);\n      }\n      return [block];\n    }\n    return [block];\n  });\n}\nfunction isBlockContainer(block) {\n  return block._type === \"__block\" && isArbitraryTypedObject(block.block);\n}\nfunction getSplitChildren(context, block) {\n  return block.children.reduce(\n    (slices, child) => {\n      const knownInlineObject = context.schema.inlineObjects.some(\n        (inlineObject) => inlineObject.name === child._type\n      ), knownBlockObject = context.schema.blockObjects.some(\n        (blockObject) => blockObject.name === child._type\n      ), lastSlice = slices.pop();\n      return !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child) && !knownInlineObject && knownBlockObject ? [\n        ...slices,\n        ...lastSlice ? [lastSlice] : [],\n        { type: \"block object\", block: child }\n      ] : child._type === \"__block\" ? [\n        ...slices,\n        ...lastSlice ? [lastSlice] : [],\n        {\n          type: \"block object\",\n          block: child.block\n        }\n      ] : child._type === \"block\" ? [\n        ...slices,\n        ...lastSlice ? [lastSlice] : [],\n        { type: \"block\", block: child }\n      ] : lastSlice && lastSlice.type === \"children\" ? [\n        ...slices,\n        {\n          type: \"children\",\n          children: [...lastSlice.children, child]\n        }\n      ] : [\n        ...slices,\n        ...lastSlice ? [lastSlice] : [],\n        { type: \"children\", children: [child] }\n      ];\n    },\n    []\n  );\n}\nconst PRESERVE_WHITESPACE_TAGS = [\"pre\", \"textarea\", \"code\"], BLOCK_DEFAULT_STYLE = \"normal\", DEFAULT_BLOCK = Object.freeze({\n  _type: \"block\",\n  markDefs: [],\n  style: BLOCK_DEFAULT_STYLE\n}), DEFAULT_SPAN = Object.freeze({\n  _type: \"span\",\n  marks: []\n}), HTML_BLOCK_TAGS = {\n  p: DEFAULT_BLOCK,\n  blockquote: { ...DEFAULT_BLOCK, style: \"blockquote\" }\n}, HTML_SPAN_TAGS = {\n  span: { object: \"text\" }\n}, HTML_LIST_CONTAINER_TAGS = {\n  ol: { object: null },\n  ul: { object: null }\n}, HTML_HEADER_TAGS = {\n  h1: { ...DEFAULT_BLOCK, style: \"h1\" },\n  h2: { ...DEFAULT_BLOCK, style: \"h2\" },\n  h3: { ...DEFAULT_BLOCK, style: \"h3\" },\n  h4: { ...DEFAULT_BLOCK, style: \"h4\" },\n  h5: { ...DEFAULT_BLOCK, style: \"h5\" },\n  h6: { ...DEFAULT_BLOCK, style: \"h6\" }\n}, HTML_MISC_TAGS = {\n  br: { ...DEFAULT_BLOCK, style: BLOCK_DEFAULT_STYLE }\n}, HTML_DECORATOR_TAGS = {\n  b: \"strong\",\n  strong: \"strong\",\n  i: \"em\",\n  em: \"em\",\n  u: \"underline\",\n  s: \"strike-through\",\n  strike: \"strike-through\",\n  del: \"strike-through\",\n  code: \"code\",\n  sup: \"sup\",\n  sub: \"sub\",\n  ins: \"ins\",\n  mark: \"mark\",\n  small: \"small\"\n}, HTML_LIST_ITEM_TAGS = {\n  li: {\n    ...DEFAULT_BLOCK,\n    style: BLOCK_DEFAULT_STYLE,\n    level: 1,\n    listItem: \"bullet\"\n  }\n}, ELEMENT_MAP = {\n  ...HTML_BLOCK_TAGS,\n  ...HTML_SPAN_TAGS,\n  ...HTML_LIST_CONTAINER_TAGS,\n  ...HTML_LIST_ITEM_TAGS,\n  ...HTML_HEADER_TAGS,\n  ...HTML_MISC_TAGS\n};\n[\n  ...new Set(\n    Object.values(ELEMENT_MAP).filter((tag) => \"style\" in tag).map((tag) => tag.style)\n  )\n];\n[\n  ...new Set(Object.values(HTML_DECORATOR_TAGS))\n];\nfunction tagName(el) {\n  if (el && \"tagName\" in el)\n    return el.tagName.toLowerCase();\n}\nfunction defaultParseHtml() {\n  if (resolveJsType(DOMParser) === \"undefined\")\n    throw new Error(\n      \"The native `DOMParser` global which the `Html` deserializer uses by default is not present in this environment. You must supply the `options.parseHtml` function instead.\"\n    );\n  return (html) => new DOMParser().parseFromString(html, \"text/html\");\n}\nfunction ensureRootIsBlocks(schema, objects) {\n  return objects.reduce((blocks, node, i, original) => {\n    if (node._type === \"block\")\n      return blocks.push(node), blocks;\n    if (node._type === \"__block\")\n      return blocks.push(node.block), blocks;\n    const lastBlock = blocks[blocks.length - 1];\n    if (i > 0 && !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)({ schema }, original[i - 1]) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)({ schema }, lastBlock))\n      return lastBlock.children.push(node), blocks;\n    const block = {\n      ...DEFAULT_BLOCK,\n      children: [node]\n    };\n    return blocks.push(block), blocks;\n  }, []);\n}\nfunction isNodeList(node) {\n  return Object.prototype.toString.call(node) === \"[object NodeList]\";\n}\nfunction isMinimalSpan(node) {\n  return node._type === \"span\";\n}\nfunction isMinimalBlock(node) {\n  return node._type === \"block\";\n}\nfunction isPlaceholderDecorator(node) {\n  return node._type === \"__decorator\";\n}\nfunction isPlaceholderAnnotation(node) {\n  return node._type === \"__annotation\";\n}\nfunction isElement(node) {\n  return node.nodeType === 1;\n}\n\n//# sourceMappingURL=helpers.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9ibG9jay10b29scy9saWIvX2NodW5rcy1lcy9oZWxwZXJzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQTJEO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0Isa0JBQWtCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQVc7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsNERBQU07QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyw0REFBTTtBQUNwQjtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsZ0JBQWdCO0FBQ2hCLENBQUM7QUFDRCxVQUFVO0FBQ1YsQ0FBQztBQUNELFFBQVEsY0FBYztBQUN0QixRQUFRO0FBQ1IsQ0FBQztBQUNELFFBQVEsK0JBQStCO0FBQ3ZDLFFBQVEsK0JBQStCO0FBQ3ZDLFFBQVEsK0JBQStCO0FBQ3ZDLFFBQVEsK0JBQStCO0FBQ3ZDLFFBQVEsK0JBQStCO0FBQ3ZDLFFBQVE7QUFDUixDQUFDO0FBQ0QsUUFBUTtBQUNSLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsaUVBQVcsR0FBRyxRQUFRLHNCQUFzQixpRUFBVyxHQUFHLFFBQVE7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBd0JFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L2Jsb2NrLXRvb2xzL2xpYi9fY2h1bmtzLWVzL2hlbHBlcnMuanM/M2ZkYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1RleHRCbG9jaywgaXNTcGFuIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvc2NoZW1hXCI7XG5jb25zdCBvYmplY3RUb1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7XG5mdW5jdGlvbiByZXNvbHZlSnNUeXBlKHZhbCkge1xuICBzd2l0Y2ggKG9iamVjdFRvU3RyaW5nLmNhbGwodmFsKSkge1xuICAgIGNhc2UgXCJbb2JqZWN0IEZ1bmN0aW9uXVwiOlxuICAgICAgcmV0dXJuIFwiZnVuY3Rpb25cIjtcbiAgICBjYXNlIFwiW29iamVjdCBEYXRlXVwiOlxuICAgICAgcmV0dXJuIFwiZGF0ZVwiO1xuICAgIGNhc2UgXCJbb2JqZWN0IFJlZ0V4cF1cIjpcbiAgICAgIHJldHVybiBcInJlZ2V4cFwiO1xuICAgIGNhc2UgXCJbb2JqZWN0IEFyZ3VtZW50c11cIjpcbiAgICAgIHJldHVybiBcImFyZ3VtZW50c1wiO1xuICAgIGNhc2UgXCJbb2JqZWN0IEFycmF5XVwiOlxuICAgICAgcmV0dXJuIFwiYXJyYXlcIjtcbiAgICBjYXNlIFwiW29iamVjdCBTdHJpbmddXCI6XG4gICAgICByZXR1cm4gXCJzdHJpbmdcIjtcbiAgfVxuICByZXR1cm4gdmFsID09PSBudWxsID8gXCJudWxsXCIgOiB2YWwgPT09IHZvaWQgMCA/IFwidW5kZWZpbmVkXCIgOiB2YWwgJiYgdHlwZW9mIHZhbCA9PSBcIm9iamVjdFwiICYmIFwibm9kZVR5cGVcIiBpbiB2YWwgJiYgdmFsLm5vZGVUeXBlID09PSAxID8gXCJlbGVtZW50XCIgOiB2YWwgPT09IE9iamVjdCh2YWwpID8gXCJvYmplY3RcIiA6IHR5cGVvZiB2YWw7XG59XG5mdW5jdGlvbiBpc0VxdWFsTWFya3MoYSwgYikge1xuICBpZiAoIWEgfHwgIWIpXG4gICAgcmV0dXJuIGEgPT09IGI7XG4gIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpXG4gICAgcmV0dXJuICExO1xuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYS5sZW5ndGg7IGluZGV4KyspXG4gICAgaWYgKGFbaW5kZXhdICE9PSBiW2luZGV4XSlcbiAgICAgIHJldHVybiAhMTtcbiAgcmV0dXJuICEwO1xufVxuZnVuY3Rpb24gaXNEZWVwRXF1YWwoZGF0YSwgb3RoZXIpIHtcbiAgcmV0dXJuIGlzRGVlcEVxdWFsSW1wbGVtZW50YXRpb24oZGF0YSwgb3RoZXIpO1xufVxuZnVuY3Rpb24gaXNEZWVwRXF1YWxJbXBsZW1lbnRhdGlvbihkYXRhLCBvdGhlcikge1xuICBpZiAoZGF0YSA9PT0gb3RoZXIgfHwgT2JqZWN0LmlzKGRhdGEsIG90aGVyKSlcbiAgICByZXR1cm4gITA7XG4gIGlmICh0eXBlb2YgZGF0YSAhPSBcIm9iamVjdFwiIHx8IHR5cGVvZiBvdGhlciAhPSBcIm9iamVjdFwiIHx8IGRhdGEgPT09IG51bGwgfHwgb3RoZXIgPT09IG51bGwgfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKGRhdGEpICE9PSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob3RoZXIpKVxuICAgIHJldHVybiAhMTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpXG4gICAgcmV0dXJuIGlzRGVlcEVxdWFsQXJyYXlzKGRhdGEsIG90aGVyKTtcbiAgaWYgKGRhdGEgaW5zdGFuY2VvZiBNYXApXG4gICAgcmV0dXJuIGlzRGVlcEVxdWFsTWFwcyhkYXRhLCBvdGhlcik7XG4gIGlmIChkYXRhIGluc3RhbmNlb2YgU2V0KVxuICAgIHJldHVybiBpc0RlZXBFcXVhbFNldHMoZGF0YSwgb3RoZXIpO1xuICBpZiAoZGF0YSBpbnN0YW5jZW9mIERhdGUpXG4gICAgcmV0dXJuIGRhdGEuZ2V0VGltZSgpID09PSBvdGhlci5nZXRUaW1lKCk7XG4gIGlmIChkYXRhIGluc3RhbmNlb2YgUmVnRXhwKVxuICAgIHJldHVybiBkYXRhLnRvU3RyaW5nKCkgPT09IG90aGVyLnRvU3RyaW5nKCk7XG4gIGlmIChPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggIT09IE9iamVjdC5rZXlzKG90aGVyKS5sZW5ndGgpXG4gICAgcmV0dXJuICExO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhkYXRhKSlcbiAgICBpZiAoIShrZXkgaW4gb3RoZXIpIHx8ICFpc0RlZXBFcXVhbEltcGxlbWVudGF0aW9uKFxuICAgICAgdmFsdWUsXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFt0czcwNTNdIC0gV2UgYWxyZWFkeSBjaGVja2VkIHRoYXQgYG90aGVyYCBoYXMgYGtleWBcbiAgICAgIG90aGVyW2tleV1cbiAgICApKVxuICAgICAgcmV0dXJuICExO1xuICByZXR1cm4gITA7XG59XG5mdW5jdGlvbiBpc0RlZXBFcXVhbEFycmF5cyhkYXRhLCBvdGhlcikge1xuICBpZiAoZGF0YS5sZW5ndGggIT09IG90aGVyLmxlbmd0aClcbiAgICByZXR1cm4gITE7XG4gIGZvciAoY29uc3QgW2luZGV4LCBpdGVtXSBvZiBkYXRhLmVudHJpZXMoKSlcbiAgICBpZiAoIWlzRGVlcEVxdWFsSW1wbGVtZW50YXRpb24oaXRlbSwgb3RoZXJbaW5kZXhdKSlcbiAgICAgIHJldHVybiAhMTtcbiAgcmV0dXJuICEwO1xufVxuZnVuY3Rpb24gaXNEZWVwRXF1YWxNYXBzKGRhdGEsIG90aGVyKSB7XG4gIGlmIChkYXRhLnNpemUgIT09IG90aGVyLnNpemUpXG4gICAgcmV0dXJuICExO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBkYXRhLmVudHJpZXMoKSlcbiAgICBpZiAoIW90aGVyLmhhcyhrZXkpIHx8ICFpc0RlZXBFcXVhbEltcGxlbWVudGF0aW9uKHZhbHVlLCBvdGhlci5nZXQoa2V5KSkpXG4gICAgICByZXR1cm4gITE7XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGlzRGVlcEVxdWFsU2V0cyhkYXRhLCBvdGhlcikge1xuICBpZiAoZGF0YS5zaXplICE9PSBvdGhlci5zaXplKVxuICAgIHJldHVybiAhMTtcbiAgY29uc3Qgb3RoZXJDb3B5ID0gWy4uLm90aGVyXTtcbiAgZm9yIChjb25zdCBkYXRhSXRlbSBvZiBkYXRhKSB7XG4gICAgbGV0IGlzRm91bmQgPSAhMTtcbiAgICBmb3IgKGNvbnN0IFtpbmRleCwgb3RoZXJJdGVtXSBvZiBvdGhlckNvcHkuZW50cmllcygpKVxuICAgICAgaWYgKGlzRGVlcEVxdWFsSW1wbGVtZW50YXRpb24oZGF0YUl0ZW0sIG90aGVySXRlbSkpIHtcbiAgICAgICAgaXNGb3VuZCA9ICEwLCBvdGhlckNvcHkuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgaWYgKCFpc0ZvdW5kKVxuICAgICAgcmV0dXJuICExO1xuICB9XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGlzQXJiaXRyYXJ5VHlwZWRPYmplY3Qob2JqZWN0KSB7XG4gIHJldHVybiBpc1JlY29yZChvYmplY3QpICYmIHR5cGVvZiBvYmplY3QuX3R5cGUgPT0gXCJzdHJpbmdcIjtcbn1cbmZ1bmN0aW9uIGlzUmVjb3JkKHZhbHVlKSB7XG4gIHJldHVybiAhIXZhbHVlICYmICh0eXBlb2YgdmFsdWUgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgdmFsdWUgPT0gXCJmdW5jdGlvblwiKTtcbn1cbmZ1bmN0aW9uIGZsYXR0ZW5OZXN0ZWRCbG9ja3MoY29udGV4dCwgYmxvY2tzKSB7XG4gIHJldHVybiBibG9ja3MuZmxhdE1hcCgoYmxvY2spID0+IHtcbiAgICBpZiAoaXNCbG9ja0NvbnRhaW5lcihibG9jaykpXG4gICAgICByZXR1cm4gZmxhdHRlbk5lc3RlZEJsb2Nrcyhjb250ZXh0LCBbYmxvY2suYmxvY2tdKTtcbiAgICBpZiAoaXNUZXh0QmxvY2soY29udGV4dCwgYmxvY2spKSB7XG4gICAgICBjb25zdCBoYXNCbG9ja09iamVjdHMgPSBibG9jay5jaGlsZHJlbi5zb21lKChjaGlsZCkgPT4gY29udGV4dC5zY2hlbWEuYmxvY2tPYmplY3RzLnNvbWUoXG4gICAgICAgIChibG9ja09iamVjdCkgPT4gYmxvY2tPYmplY3QubmFtZSA9PT0gY2hpbGQuX3R5cGVcbiAgICAgICkpLCBoYXNCbG9ja3MgPSBibG9jay5jaGlsZHJlbi5zb21lKFxuICAgICAgICAoY2hpbGQpID0+IGNoaWxkLl90eXBlID09PSBcIl9fYmxvY2tcIiB8fCBjaGlsZC5fdHlwZSA9PT0gXCJibG9ja1wiXG4gICAgICApO1xuICAgICAgaWYgKGhhc0Jsb2NrT2JqZWN0cyB8fCBoYXNCbG9ja3MpIHtcbiAgICAgICAgY29uc3Qgc3BsaXRDaGlsZHJlbiA9IGdldFNwbGl0Q2hpbGRyZW4oY29udGV4dCwgYmxvY2spO1xuICAgICAgICByZXR1cm4gc3BsaXRDaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgc3BsaXRDaGlsZHJlblswXS50eXBlID09PSBcImNoaWxkcmVuXCIgJiYgaXNEZWVwRXF1YWwoc3BsaXRDaGlsZHJlblswXS5jaGlsZHJlbiwgYmxvY2suY2hpbGRyZW4pID8gW2Jsb2NrXSA6IHNwbGl0Q2hpbGRyZW4uZmxhdE1hcCgoc2xpY2UpID0+IHNsaWNlLnR5cGUgPT09IFwiYmxvY2sgb2JqZWN0XCIgPyBbc2xpY2UuYmxvY2tdIDogc2xpY2UudHlwZSA9PT0gXCJibG9ja1wiID8gZmxhdHRlbk5lc3RlZEJsb2Nrcyhjb250ZXh0LCBbXG4gICAgICAgICAgc2xpY2UuYmxvY2tcbiAgICAgICAgXSkgOiBzbGljZS5jaGlsZHJlbi5sZW5ndGggPiAwID8gc2xpY2UuY2hpbGRyZW4uZXZlcnkoXG4gICAgICAgICAgKGNoaWxkKSA9PiBpc1NwYW4oY29udGV4dCwgY2hpbGQpICYmIGNoaWxkLnRleHQudHJpbSgpID09PSBcIlwiXG4gICAgICAgICkgPyBbXSA6IGZsYXR0ZW5OZXN0ZWRCbG9ja3MoY29udGV4dCwgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIC4uLmJsb2NrLFxuICAgICAgICAgICAgY2hpbGRyZW46IHNsaWNlLmNoaWxkcmVuXG4gICAgICAgICAgfVxuICAgICAgICBdKSA6IFtdKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBbYmxvY2tdO1xuICAgIH1cbiAgICByZXR1cm4gW2Jsb2NrXTtcbiAgfSk7XG59XG5mdW5jdGlvbiBpc0Jsb2NrQ29udGFpbmVyKGJsb2NrKSB7XG4gIHJldHVybiBibG9jay5fdHlwZSA9PT0gXCJfX2Jsb2NrXCIgJiYgaXNBcmJpdHJhcnlUeXBlZE9iamVjdChibG9jay5ibG9jayk7XG59XG5mdW5jdGlvbiBnZXRTcGxpdENoaWxkcmVuKGNvbnRleHQsIGJsb2NrKSB7XG4gIHJldHVybiBibG9jay5jaGlsZHJlbi5yZWR1Y2UoXG4gICAgKHNsaWNlcywgY2hpbGQpID0+IHtcbiAgICAgIGNvbnN0IGtub3duSW5saW5lT2JqZWN0ID0gY29udGV4dC5zY2hlbWEuaW5saW5lT2JqZWN0cy5zb21lKFxuICAgICAgICAoaW5saW5lT2JqZWN0KSA9PiBpbmxpbmVPYmplY3QubmFtZSA9PT0gY2hpbGQuX3R5cGVcbiAgICAgICksIGtub3duQmxvY2tPYmplY3QgPSBjb250ZXh0LnNjaGVtYS5ibG9ja09iamVjdHMuc29tZShcbiAgICAgICAgKGJsb2NrT2JqZWN0KSA9PiBibG9ja09iamVjdC5uYW1lID09PSBjaGlsZC5fdHlwZVxuICAgICAgKSwgbGFzdFNsaWNlID0gc2xpY2VzLnBvcCgpO1xuICAgICAgcmV0dXJuICFpc1NwYW4oY29udGV4dCwgY2hpbGQpICYmICFrbm93bklubGluZU9iamVjdCAmJiBrbm93bkJsb2NrT2JqZWN0ID8gW1xuICAgICAgICAuLi5zbGljZXMsXG4gICAgICAgIC4uLmxhc3RTbGljZSA/IFtsYXN0U2xpY2VdIDogW10sXG4gICAgICAgIHsgdHlwZTogXCJibG9jayBvYmplY3RcIiwgYmxvY2s6IGNoaWxkIH1cbiAgICAgIF0gOiBjaGlsZC5fdHlwZSA9PT0gXCJfX2Jsb2NrXCIgPyBbXG4gICAgICAgIC4uLnNsaWNlcyxcbiAgICAgICAgLi4ubGFzdFNsaWNlID8gW2xhc3RTbGljZV0gOiBbXSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IFwiYmxvY2sgb2JqZWN0XCIsXG4gICAgICAgICAgYmxvY2s6IGNoaWxkLmJsb2NrXG4gICAgICAgIH1cbiAgICAgIF0gOiBjaGlsZC5fdHlwZSA9PT0gXCJibG9ja1wiID8gW1xuICAgICAgICAuLi5zbGljZXMsXG4gICAgICAgIC4uLmxhc3RTbGljZSA/IFtsYXN0U2xpY2VdIDogW10sXG4gICAgICAgIHsgdHlwZTogXCJibG9ja1wiLCBibG9jazogY2hpbGQgfVxuICAgICAgXSA6IGxhc3RTbGljZSAmJiBsYXN0U2xpY2UudHlwZSA9PT0gXCJjaGlsZHJlblwiID8gW1xuICAgICAgICAuLi5zbGljZXMsXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcImNoaWxkcmVuXCIsXG4gICAgICAgICAgY2hpbGRyZW46IFsuLi5sYXN0U2xpY2UuY2hpbGRyZW4sIGNoaWxkXVxuICAgICAgICB9XG4gICAgICBdIDogW1xuICAgICAgICAuLi5zbGljZXMsXG4gICAgICAgIC4uLmxhc3RTbGljZSA/IFtsYXN0U2xpY2VdIDogW10sXG4gICAgICAgIHsgdHlwZTogXCJjaGlsZHJlblwiLCBjaGlsZHJlbjogW2NoaWxkXSB9XG4gICAgICBdO1xuICAgIH0sXG4gICAgW11cbiAgKTtcbn1cbmNvbnN0IFBSRVNFUlZFX1dISVRFU1BBQ0VfVEFHUyA9IFtcInByZVwiLCBcInRleHRhcmVhXCIsIFwiY29kZVwiXSwgQkxPQ0tfREVGQVVMVF9TVFlMRSA9IFwibm9ybWFsXCIsIERFRkFVTFRfQkxPQ0sgPSBPYmplY3QuZnJlZXplKHtcbiAgX3R5cGU6IFwiYmxvY2tcIixcbiAgbWFya0RlZnM6IFtdLFxuICBzdHlsZTogQkxPQ0tfREVGQVVMVF9TVFlMRVxufSksIERFRkFVTFRfU1BBTiA9IE9iamVjdC5mcmVlemUoe1xuICBfdHlwZTogXCJzcGFuXCIsXG4gIG1hcmtzOiBbXVxufSksIEhUTUxfQkxPQ0tfVEFHUyA9IHtcbiAgcDogREVGQVVMVF9CTE9DSyxcbiAgYmxvY2txdW90ZTogeyAuLi5ERUZBVUxUX0JMT0NLLCBzdHlsZTogXCJibG9ja3F1b3RlXCIgfVxufSwgSFRNTF9TUEFOX1RBR1MgPSB7XG4gIHNwYW46IHsgb2JqZWN0OiBcInRleHRcIiB9XG59LCBIVE1MX0xJU1RfQ09OVEFJTkVSX1RBR1MgPSB7XG4gIG9sOiB7IG9iamVjdDogbnVsbCB9LFxuICB1bDogeyBvYmplY3Q6IG51bGwgfVxufSwgSFRNTF9IRUFERVJfVEFHUyA9IHtcbiAgaDE6IHsgLi4uREVGQVVMVF9CTE9DSywgc3R5bGU6IFwiaDFcIiB9LFxuICBoMjogeyAuLi5ERUZBVUxUX0JMT0NLLCBzdHlsZTogXCJoMlwiIH0sXG4gIGgzOiB7IC4uLkRFRkFVTFRfQkxPQ0ssIHN0eWxlOiBcImgzXCIgfSxcbiAgaDQ6IHsgLi4uREVGQVVMVF9CTE9DSywgc3R5bGU6IFwiaDRcIiB9LFxuICBoNTogeyAuLi5ERUZBVUxUX0JMT0NLLCBzdHlsZTogXCJoNVwiIH0sXG4gIGg2OiB7IC4uLkRFRkFVTFRfQkxPQ0ssIHN0eWxlOiBcImg2XCIgfVxufSwgSFRNTF9NSVNDX1RBR1MgPSB7XG4gIGJyOiB7IC4uLkRFRkFVTFRfQkxPQ0ssIHN0eWxlOiBCTE9DS19ERUZBVUxUX1NUWUxFIH1cbn0sIEhUTUxfREVDT1JBVE9SX1RBR1MgPSB7XG4gIGI6IFwic3Ryb25nXCIsXG4gIHN0cm9uZzogXCJzdHJvbmdcIixcbiAgaTogXCJlbVwiLFxuICBlbTogXCJlbVwiLFxuICB1OiBcInVuZGVybGluZVwiLFxuICBzOiBcInN0cmlrZS10aHJvdWdoXCIsXG4gIHN0cmlrZTogXCJzdHJpa2UtdGhyb3VnaFwiLFxuICBkZWw6IFwic3RyaWtlLXRocm91Z2hcIixcbiAgY29kZTogXCJjb2RlXCIsXG4gIHN1cDogXCJzdXBcIixcbiAgc3ViOiBcInN1YlwiLFxuICBpbnM6IFwiaW5zXCIsXG4gIG1hcms6IFwibWFya1wiLFxuICBzbWFsbDogXCJzbWFsbFwiXG59LCBIVE1MX0xJU1RfSVRFTV9UQUdTID0ge1xuICBsaToge1xuICAgIC4uLkRFRkFVTFRfQkxPQ0ssXG4gICAgc3R5bGU6IEJMT0NLX0RFRkFVTFRfU1RZTEUsXG4gICAgbGV2ZWw6IDEsXG4gICAgbGlzdEl0ZW06IFwiYnVsbGV0XCJcbiAgfVxufSwgRUxFTUVOVF9NQVAgPSB7XG4gIC4uLkhUTUxfQkxPQ0tfVEFHUyxcbiAgLi4uSFRNTF9TUEFOX1RBR1MsXG4gIC4uLkhUTUxfTElTVF9DT05UQUlORVJfVEFHUyxcbiAgLi4uSFRNTF9MSVNUX0lURU1fVEFHUyxcbiAgLi4uSFRNTF9IRUFERVJfVEFHUyxcbiAgLi4uSFRNTF9NSVNDX1RBR1Ncbn07XG5bXG4gIC4uLm5ldyBTZXQoXG4gICAgT2JqZWN0LnZhbHVlcyhFTEVNRU5UX01BUCkuZmlsdGVyKCh0YWcpID0+IFwic3R5bGVcIiBpbiB0YWcpLm1hcCgodGFnKSA9PiB0YWcuc3R5bGUpXG4gIClcbl07XG5bXG4gIC4uLm5ldyBTZXQoT2JqZWN0LnZhbHVlcyhIVE1MX0RFQ09SQVRPUl9UQUdTKSlcbl07XG5mdW5jdGlvbiB0YWdOYW1lKGVsKSB7XG4gIGlmIChlbCAmJiBcInRhZ05hbWVcIiBpbiBlbClcbiAgICByZXR1cm4gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xufVxuZnVuY3Rpb24gZGVmYXVsdFBhcnNlSHRtbCgpIHtcbiAgaWYgKHJlc29sdmVKc1R5cGUoRE9NUGFyc2VyKSA9PT0gXCJ1bmRlZmluZWRcIilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIlRoZSBuYXRpdmUgYERPTVBhcnNlcmAgZ2xvYmFsIHdoaWNoIHRoZSBgSHRtbGAgZGVzZXJpYWxpemVyIHVzZXMgYnkgZGVmYXVsdCBpcyBub3QgcHJlc2VudCBpbiB0aGlzIGVudmlyb25tZW50LiBZb3UgbXVzdCBzdXBwbHkgdGhlIGBvcHRpb25zLnBhcnNlSHRtbGAgZnVuY3Rpb24gaW5zdGVhZC5cIlxuICAgICk7XG4gIHJldHVybiAoaHRtbCkgPT4gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhodG1sLCBcInRleHQvaHRtbFwiKTtcbn1cbmZ1bmN0aW9uIGVuc3VyZVJvb3RJc0Jsb2NrcyhzY2hlbWEsIG9iamVjdHMpIHtcbiAgcmV0dXJuIG9iamVjdHMucmVkdWNlKChibG9ja3MsIG5vZGUsIGksIG9yaWdpbmFsKSA9PiB7XG4gICAgaWYgKG5vZGUuX3R5cGUgPT09IFwiYmxvY2tcIilcbiAgICAgIHJldHVybiBibG9ja3MucHVzaChub2RlKSwgYmxvY2tzO1xuICAgIGlmIChub2RlLl90eXBlID09PSBcIl9fYmxvY2tcIilcbiAgICAgIHJldHVybiBibG9ja3MucHVzaChub2RlLmJsb2NrKSwgYmxvY2tzO1xuICAgIGNvbnN0IGxhc3RCbG9jayA9IGJsb2Nrc1tibG9ja3MubGVuZ3RoIC0gMV07XG4gICAgaWYgKGkgPiAwICYmICFpc1RleHRCbG9jayh7IHNjaGVtYSB9LCBvcmlnaW5hbFtpIC0gMV0pICYmIGlzVGV4dEJsb2NrKHsgc2NoZW1hIH0sIGxhc3RCbG9jaykpXG4gICAgICByZXR1cm4gbGFzdEJsb2NrLmNoaWxkcmVuLnB1c2gobm9kZSksIGJsb2NrcztcbiAgICBjb25zdCBibG9jayA9IHtcbiAgICAgIC4uLkRFRkFVTFRfQkxPQ0ssXG4gICAgICBjaGlsZHJlbjogW25vZGVdXG4gICAgfTtcbiAgICByZXR1cm4gYmxvY2tzLnB1c2goYmxvY2spLCBibG9ja3M7XG4gIH0sIFtdKTtcbn1cbmZ1bmN0aW9uIGlzTm9kZUxpc3Qobm9kZSkge1xuICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5vZGUpID09PSBcIltvYmplY3QgTm9kZUxpc3RdXCI7XG59XG5mdW5jdGlvbiBpc01pbmltYWxTcGFuKG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUuX3R5cGUgPT09IFwic3BhblwiO1xufVxuZnVuY3Rpb24gaXNNaW5pbWFsQmxvY2sobm9kZSkge1xuICByZXR1cm4gbm9kZS5fdHlwZSA9PT0gXCJibG9ja1wiO1xufVxuZnVuY3Rpb24gaXNQbGFjZWhvbGRlckRlY29yYXRvcihub2RlKSB7XG4gIHJldHVybiBub2RlLl90eXBlID09PSBcIl9fZGVjb3JhdG9yXCI7XG59XG5mdW5jdGlvbiBpc1BsYWNlaG9sZGVyQW5ub3RhdGlvbihub2RlKSB7XG4gIHJldHVybiBub2RlLl90eXBlID09PSBcIl9fYW5ub3RhdGlvblwiO1xufVxuZnVuY3Rpb24gaXNFbGVtZW50KG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT09IDE7XG59XG5leHBvcnQge1xuICBCTE9DS19ERUZBVUxUX1NUWUxFLFxuICBERUZBVUxUX0JMT0NLLFxuICBERUZBVUxUX1NQQU4sXG4gIEhUTUxfQkxPQ0tfVEFHUyxcbiAgSFRNTF9ERUNPUkFUT1JfVEFHUyxcbiAgSFRNTF9IRUFERVJfVEFHUyxcbiAgSFRNTF9MSVNUX0NPTlRBSU5FUl9UQUdTLFxuICBIVE1MX0xJU1RfSVRFTV9UQUdTLFxuICBIVE1MX1NQQU5fVEFHUyxcbiAgUFJFU0VSVkVfV0hJVEVTUEFDRV9UQUdTLFxuICBkZWZhdWx0UGFyc2VIdG1sLFxuICBlbnN1cmVSb290SXNCbG9ja3MsXG4gIGZsYXR0ZW5OZXN0ZWRCbG9ja3MsXG4gIGlzRWxlbWVudCxcbiAgaXNFcXVhbE1hcmtzLFxuICBpc01pbmltYWxCbG9jayxcbiAgaXNNaW5pbWFsU3BhbixcbiAgaXNOb2RlTGlzdCxcbiAgaXNQbGFjZWhvbGRlckFubm90YXRpb24sXG4gIGlzUGxhY2Vob2xkZXJEZWNvcmF0b3IsXG4gIHJlc29sdmVKc1R5cGUsXG4gIHRhZ05hbWVcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1oZWxwZXJzLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/block-tools/lib/_chunks-es/helpers.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/block-tools/lib/index.js":
/*!*************************************************************!*\
  !*** ./node_modules/@portabletext/block-tools/lib/index.js ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   htmlToBlocks: () => (/* binding */ htmlToBlocks),\n/* harmony export */   normalizeBlock: () => (/* binding */ normalizeBlock),\n/* harmony export */   randomKey: () => (/* binding */ randomKey)\n/* harmony export */ });\n/* harmony import */ var _portabletext_sanity_bridge__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/sanity-bridge */ \"(ssr)/./node_modules/@portabletext/sanity-bridge/dist/index.js\");\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./_chunks-es/helpers.js */ \"(ssr)/./node_modules/@portabletext/block-tools/lib/_chunks-es/helpers.js\");\n\n\n\nvar l = { 0: 8203, 1: 8204, 2: 8205, 3: 8290, 4: 8291, 5: 8288, 6: 65279, 7: 8289, 8: 119155, 9: 119156, a: 119157, b: 119158, c: 119159, d: 119160, e: 119161, f: 119162 }, d = { 0: 8203, 1: 8204, 2: 8205, 3: 65279 }, a = { 0: String.fromCodePoint(d[0]), 1: String.fromCodePoint(d[1]), 2: String.fromCodePoint(d[2]), 3: String.fromCodePoint(d[3]) };\nnew Array(4).fill(String.fromCodePoint(d[0])).join(\"\");\nObject.fromEntries(Object.entries(a).map((t) => [t[1], +t[0]]));\nObject.fromEntries(Object.entries(l).map((t) => t.reverse()));\nvar _ = `${Object.values(l).map((t) => `\\\\u{${t.toString(16)}}`).join(\"\")}`, u = new RegExp(`[${_}]{4,}`, \"gu\");\nfunction D(t) {\n  var e;\n  return { cleaned: t.replace(u, \"\"), encoded: ((e = t.match(u)) == null ? void 0 : e[0]) || \"\" };\n}\nfunction M(t) {\n  return t && JSON.parse(D(JSON.stringify(t)).cleaned);\n}\nfunction keyGenerator() {\n  return randomKey(12);\n}\nfunction whatwgRNG(length = 16) {\n  const rnds8 = new Uint8Array(length);\n  return crypto.getRandomValues(rnds8), rnds8;\n}\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i)\n  byteToHex[i] = (i + 256).toString(16).slice(1);\nfunction randomKey(length) {\n  return whatwgRNG(length).reduce((str, n) => str + byteToHex[n], \"\").slice(0, length);\n}\nfunction isWordOnlineHtml(html) {\n  return /class=\"(?:TextRun|NormalTextRun)[^\"]*SCXW\\d+[^\"]*BCX\\d+/.test(html) || /class=\"EOP[^\"]*SCXW\\d+/.test(html);\n}\nfunction isWordOnlineTextRun(el) {\n  return !(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"span\" ? !1 : el.classList.contains(\"TextRun\") && !el.classList.contains(\"EOP\");\n}\nfunction isNormalTextRun(el) {\n  return !(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"span\" ? !1 : el.classList.contains(\"NormalTextRun\");\n}\nfunction isTextRunSpan(el) {\n  return !(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"span\" ? !1 : el.classList.contains(\"TextRun\") && !el.classList.contains(\"NormalTextRun\") && !el.classList.contains(\"EOP\");\n}\nfunction isFindHit(el) {\n  return !(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"span\" ? !1 : el.classList.contains(\"FindHit\");\n}\nfunction isInHeading(el) {\n  let current = el;\n  for (; current; ) {\n    if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(current) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(current) === \"word-online-block\" && /^heading \\d$/.test(current.getAttribute(\"data-parastyle\") ?? \"\"))\n      return !0;\n    current = current.parentNode;\n  }\n  return !1;\n}\nfunction isInBlockquote(el) {\n  let current = el;\n  for (; current; ) {\n    if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(current) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(current) === \"word-online-block\" && current.getAttribute(\"data-parastyle\") === \"Quote\")\n      return !0;\n    current = current.parentNode;\n  }\n  return !1;\n}\nfunction hasStrongFormatting(el) {\n  const style = el.getAttribute(\"style\") ?? \"\";\n  return el.classList.contains(\"MacChromeBold\") || /font-weight\\s*:\\s*bold/.test(style);\n}\nfunction hasEmphasisFormatting(el) {\n  const style = el.getAttribute(\"style\") ?? \"\";\n  return /font-style\\s*:\\s*italic/.test(style);\n}\nfunction hasUnderlineFormatting(el) {\n  const style = el.getAttribute(\"style\") ?? \"\";\n  return el.classList.contains(\"Underlined\") || /text-decoration\\s*:\\s*underline/.test(style);\n}\nfunction hasStrikethroughFormatting(el) {\n  const style = el.getAttribute(\"style\") ?? \"\";\n  return el.classList.contains(\"Strikethrough\") || /text-decoration\\s*:\\s*line-through/.test(style);\n}\nfunction hasFormatting(el) {\n  return hasStrongFormatting(el) || hasEmphasisFormatting(el) || hasUnderlineFormatting(el) || hasStrikethroughFormatting(el);\n}\nfunction preprocessWordOnline(html, doc) {\n  if (!isWordOnlineHtml(html))\n    return doc;\n  const paragraphs = Array.from(\n    doc.querySelectorAll('p.Paragraph[role=\"heading\"]')\n  );\n  for (const paragraph of paragraphs) {\n    const ariaLevel = paragraph.getAttribute(\"aria-level\");\n    if (ariaLevel) {\n      const wrapper = doc.createElement(\"word-online-block\");\n      wrapper.setAttribute(\"data-parastyle\", `heading ${ariaLevel}`);\n      const parent = paragraph.parentNode;\n      if (parent) {\n        for (parent.insertBefore(wrapper, paragraph); paragraph.firstChild; )\n          wrapper.appendChild(paragraph.firstChild);\n        parent.removeChild(paragraph);\n      }\n    }\n  }\n  let child = doc.body.firstChild;\n  for (; child; ) {\n    const next = child.nextSibling;\n    if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(child) || !(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(child)?.includes(\"span\")) {\n      child = next;\n      continue;\n    }\n    const paraStyle = getParaStyle(child);\n    if (!paraStyle) {\n      child = next;\n      continue;\n    }\n    const group = [child];\n    let sibling = next;\n    for (; sibling && !(!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(sibling) || getParaStyle(sibling) !== paraStyle); )\n      group.push(sibling), sibling = sibling.nextSibling;\n    const wrapper = doc.createElement(\"word-online-block\");\n    wrapper.setAttribute(\"data-parastyle\", paraStyle), doc.body.insertBefore(wrapper, child);\n    for (const span of group)\n      wrapper.appendChild(span);\n    child = sibling;\n  }\n  const textRunSpans = Array.from(doc.body.querySelectorAll(\"span\")).filter(\n    isTextRunSpan\n  );\n  for (const textRunSpan of textRunSpans) {\n    const normalTextRuns = Array.from(textRunSpan.childNodes).filter(\n      isNormalTextRun\n    );\n    for (const normalTextRun of normalTextRuns) {\n      let foundNestedSpan = !0;\n      for (; foundNestedSpan; ) {\n        const children = Array.from(normalTextRun.childNodes), nestedSpanIndex = children.findIndex(\n          (node) => (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(node) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(node) === \"span\" && node.textContent.trim() === \"\"\n        );\n        if (nestedSpanIndex === -1) {\n          foundNestedSpan = !1;\n          break;\n        }\n        const nestedSpan = children.at(nestedSpanIndex);\n        if (!nestedSpan) {\n          foundNestedSpan = !1;\n          break;\n        }\n        const spaceText = nestedSpan.textContent?.replace(/\\u00a0/g, \" \") ?? \"\", isSpaceAtBeginning = !children.slice(0, nestedSpanIndex).some((n) => n.nodeType === 3);\n        if (normalTextRun.removeChild(nestedSpan), isSpaceAtBeginning) {\n          const firstTextNode = Array.from(normalTextRun.childNodes).find(\n            (n) => n.nodeType === 3\n          );\n          if (firstTextNode)\n            firstTextNode.textContent = spaceText + (firstTextNode.textContent || \"\");\n          else {\n            const spaceNode = doc.createTextNode(spaceText);\n            normalTextRun.insertBefore(spaceNode, normalTextRun.firstChild);\n          }\n        } else {\n          const nextSibling = textRunSpan.nextSibling, currentHasFormatting = hasFormatting(textRunSpan);\n          if (nextSibling && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(nextSibling) && isTextRunSpan(nextSibling)) {\n            const nextHasFormatting = hasFormatting(nextSibling);\n            if (currentHasFormatting && !nextHasFormatting) {\n              const nextNormalTextRun = Array.from(nextSibling.childNodes).find(\n                isNormalTextRun\n              );\n              if (nextNormalTextRun && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(nextNormalTextRun)) {\n                const firstChild = nextNormalTextRun.firstChild;\n                if (firstChild && firstChild.nodeType === 3)\n                  firstChild.textContent = spaceText + (firstChild.textContent ?? \"\");\n                else {\n                  const spaceNode = doc.createTextNode(spaceText);\n                  nextNormalTextRun.insertBefore(\n                    spaceNode,\n                    nextNormalTextRun.firstChild\n                  );\n                }\n              }\n            } else {\n              const lastTextNode = Array.from(normalTextRun.childNodes).find(\n                (n) => n.nodeType === 3\n              );\n              if (lastTextNode)\n                lastTextNode.textContent = (lastTextNode.textContent ?? \"\") + spaceText;\n              else {\n                const spaceNode = doc.createTextNode(spaceText);\n                normalTextRun.appendChild(spaceNode);\n              }\n            }\n          } else {\n            const lastTextNode = Array.from(normalTextRun.childNodes).find(\n              (n) => n.nodeType === 3\n            );\n            if (lastTextNode)\n              lastTextNode.textContent = (lastTextNode.textContent ?? \"\") + spaceText;\n            else {\n              const spaceNode = doc.createTextNode(spaceText);\n              normalTextRun.appendChild(spaceNode);\n            }\n          }\n        }\n      }\n    }\n  }\n  return doc;\n}\nfunction getParaStyle(element) {\n  const directStyle = element.getAttribute(\"data-ccp-parastyle\");\n  if (directStyle)\n    return directStyle;\n  if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(element) === \"span\" && element.classList.contains(\"TextRun\")) {\n    const normalTextRuns = Array.from(\n      element.querySelectorAll(\".NormalTextRun\")\n    );\n    if (normalTextRuns.length > 0) {\n      const firstStyle = normalTextRuns[0].getAttribute(\"data-ccp-parastyle\");\n      if (firstStyle && normalTextRuns.every(\n        (normalTextRun) => normalTextRun.getAttribute(\"data-ccp-parastyle\") === firstStyle\n      ))\n        return firstStyle;\n    }\n  }\n}\nconst _XPathResult = {\n  BOOLEAN_TYPE: 3,\n  ORDERED_NODE_ITERATOR_TYPE: 5,\n  UNORDERED_NODE_SNAPSHOT_TYPE: 6\n};\nfunction preprocessGDocs(_html, doc) {\n  let gDocsRootOrSiblingNode = doc.evaluate(\n    '//*[@id and contains(@id, \"docs-internal-guid\")]',\n    doc,\n    null,\n    _XPathResult.ORDERED_NODE_ITERATOR_TYPE,\n    null\n  ).iterateNext();\n  if (gDocsRootOrSiblingNode) {\n    const isWrappedRootTag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(gDocsRootOrSiblingNode) === \"b\";\n    isWrappedRootTag || (gDocsRootOrSiblingNode = doc.body);\n    const childNodes = doc.evaluate(\n      \"//*\",\n      doc,\n      null,\n      _XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,\n      null\n    );\n    for (let i = childNodes.snapshotLength - 1; i >= 0; i--) {\n      const elm = childNodes.snapshotItem(i);\n      elm?.setAttribute(\"data-is-google-docs\", \"true\"), (elm?.parentElement === gDocsRootOrSiblingNode || !isWrappedRootTag && elm.parentElement === doc.body) && (elm?.setAttribute(\"data-is-root-node\", \"true\"), (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(elm)), (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(elm) === \"li\" && elm.firstChild && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(elm?.firstChild) === \"img\" && elm.removeChild(elm.firstChild);\n    }\n    return isWrappedRootTag && doc.body.firstElementChild?.replaceWith(\n      ...Array.from(gDocsRootOrSiblingNode.childNodes)\n    ), doc;\n  }\n  return doc;\n}\nconst unwantedWordDocumentPaths = [\n  \"/html/text()\",\n  \"/html/head/text()\",\n  \"/html/body/text()\",\n  \"/html/body/ul/text()\",\n  \"/html/body/ol/text()\",\n  \"//comment()\",\n  \"//style\",\n  \"//xml\",\n  \"//script\",\n  \"//meta\",\n  \"//link\"\n];\nfunction preprocessHTML(_html, doc) {\n  const bodyTextNodes = doc.evaluate(\n    \"/html/body/text()\",\n    doc,\n    null,\n    _XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  );\n  for (let i = bodyTextNodes.snapshotLength - 1; i >= 0; i--) {\n    const node = bodyTextNodes.snapshotItem(i), text = node.textContent || \"\";\n    if (text.replace(/[^\\S\\n]+$/g, \"\")) {\n      const newNode = doc.createElement(\"span\");\n      newNode.appendChild(doc.createTextNode(text)), node.parentNode?.replaceChild(newNode, node);\n    } else\n      node.parentNode?.removeChild(node);\n  }\n  const unwantedNodes = doc.evaluate(\n    unwantedWordDocumentPaths.join(\"|\"),\n    doc,\n    null,\n    _XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  );\n  for (let i = unwantedNodes.snapshotLength - 1; i >= 0; i--) {\n    const unwanted = unwantedNodes.snapshotItem(i);\n    unwanted && unwanted.parentNode?.removeChild(unwanted);\n  }\n  return doc;\n}\nfunction preprocessNotion(html, doc) {\n  const NOTION_REGEX = /<!-- notionvc:.*?-->/g;\n  if (html.match(NOTION_REGEX)) {\n    const childNodes = doc.evaluate(\n      \"//*\",\n      doc,\n      null,\n      _XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,\n      null\n    );\n    for (let i = childNodes.snapshotLength - 1; i >= 0; i--)\n      childNodes.snapshotItem(i)?.setAttribute(\"data-is-notion\", \"true\");\n    return doc;\n  }\n  return doc;\n}\nconst BLOCK_CONTAINER_ELEMENTS = [\n  \"body\",\n  \"table\",\n  \"tbody\",\n  \"thead\",\n  \"tfoot\",\n  \"tr\",\n  \"ul\",\n  \"ol\"\n];\nfunction preprocessWhitespace(_2, doc) {\n  function processNode(node) {\n    if (node.nodeType === _XPathResult.BOOLEAN_TYPE && !_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.PRESERVE_WHITESPACE_TAGS.includes(\n      node.parentElement?.tagName.toLowerCase() || \"\"\n    )) {\n      const normalized = node.textContent?.replace(/\\s\\s+/g, \" \").replace(/[\\r\\n]+/g, \" \") || \"\", parentTag = node.parentElement?.tagName.toLowerCase();\n      parentTag && BLOCK_CONTAINER_ELEMENTS.includes(parentTag) && normalized.trim() === \"\" ? node.parentNode?.removeChild(node) : node.textContent = normalized;\n    } else\n      for (let i = node.childNodes.length - 1; i >= 0; i--)\n        processNode(node.childNodes[i]);\n  }\n  return processNode(doc.body), doc;\n}\nconst WORD_HTML_REGEX = /(class=\"?Mso|style=(?:\"|')[^\"]*?\\bmso-|w:WordDocument|<o:\\w+>|<\\/font>)/, unwantedPaths = [\n  \"//o:p\",\n  \"//span[@style='mso-list:Ignore']\",\n  \"//span[@style='mso-list: Ignore']\"\n], mappedPaths = [\n  \"//p[@class='MsoTocHeading']\",\n  \"//p[@class='MsoTitle']\",\n  \"//p[@class='MsoToaHeading']\",\n  \"//p[@class='MsoSubtitle']\",\n  \"//span[@class='MsoSubtleEmphasis']\",\n  \"//span[@class='MsoIntenseEmphasis']\"\n], elementMap = {\n  MsoTocHeading: [\"h3\"],\n  MsoTitle: [\"h1\"],\n  MsoToaHeading: [\"h2\"],\n  MsoSubtitle: [\"h5\"],\n  MsoSubtleEmphasis: [\"span\", \"em\"],\n  MsoIntenseEmphasis: [\"span\", \"em\", \"strong\"]\n  // Remove cruft\n};\nfunction isWordHtml(html) {\n  return WORD_HTML_REGEX.test(html);\n}\nfunction preprocessWord(html, doc) {\n  if (!isWordHtml(html))\n    return doc;\n  const unwantedNodes = doc.evaluate(\n    unwantedPaths.join(\"|\"),\n    doc,\n    (prefix) => prefix === \"o\" ? \"urn:schemas-microsoft-com:office:office\" : null,\n    _XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  );\n  for (let i = unwantedNodes.snapshotLength - 1; i >= 0; i--) {\n    const unwanted = unwantedNodes.snapshotItem(i);\n    unwanted?.parentNode && unwanted.parentNode.removeChild(unwanted);\n  }\n  const mappedElements = doc.evaluate(\n    mappedPaths.join(\"|\"),\n    doc,\n    null,\n    _XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  );\n  for (let i = mappedElements.snapshotLength - 1; i >= 0; i--) {\n    const mappedElm = mappedElements.snapshotItem(i), tags = elementMap[mappedElm.className], text = doc.createTextNode(mappedElm.textContent || \"\");\n    if (!tags)\n      continue;\n    const parentElement = doc.createElement(tags[0]);\n    let parent = parentElement, child = parentElement;\n    tags.slice(1).forEach((tag) => {\n      child = doc.createElement(tag), parent.appendChild(child), parent = child;\n    }), child.appendChild(text), mappedElm?.parentNode?.replaceChild(parentElement, mappedElm);\n  }\n  return doc;\n}\nconst preprocessors = [\n  preprocessWhitespace,\n  preprocessNotion,\n  preprocessWord,\n  preprocessWordOnline,\n  preprocessGDocs,\n  preprocessHTML\n];\nfunction mapParaStyleToBlockStyle(schema, paraStyle) {\n  const blockStyle = {\n    \"heading 1\": \"h1\",\n    \"heading 2\": \"h2\",\n    \"heading 3\": \"h3\",\n    \"heading 4\": \"h4\",\n    \"heading 5\": \"h5\",\n    \"heading 6\": \"h6\",\n    Quote: \"blockquote\"\n  }[paraStyle] ?? \"normal\";\n  return schema.styles.find((style) => style.name === blockStyle)?.name;\n}\nfunction createWordOnlineRules(schema, options) {\n  return [\n    // Image rule - handles bare Word Online <img> tags with WACImage class\n    {\n      deserialize(el) {\n        if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"img\")\n          return;\n        const classNameRaw = el.className;\n        let className = \"\";\n        if (typeof classNameRaw == \"string\" ? className = classNameRaw : classNameRaw && typeof classNameRaw == \"object\" && (className = classNameRaw.baseVal || \"\"), !className.includes(\"WACImage\"))\n          return;\n        const src = el.getAttribute(\"src\") ?? void 0, alt = el.getAttribute(\"alt\") ?? void 0, props = Object.fromEntries(\n          Array.from(el.attributes).map((attr) => [attr.name, attr.value])\n        ), image = options.matchers?.image?.({\n          context: {\n            schema,\n            keyGenerator: options.keyGenerator ?? keyGenerator\n          },\n          props: {\n            ...props,\n            ...src ? { src } : {},\n            ...alt ? { alt } : {}\n          }\n        });\n        if (image)\n          return {\n            _type: \"__block\",\n            block: image\n          };\n      }\n    },\n    // Image rule - handles Word Online images wrapped in WACImageContainer\n    {\n      deserialize(el) {\n        if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el))\n          return;\n        const classNameRaw = el.className;\n        let className = \"\";\n        if (typeof classNameRaw == \"string\" ? className = classNameRaw : classNameRaw && typeof classNameRaw == \"object\" && (className = classNameRaw.baseVal || \"\"), !className.includes(\"WACImageContainer\"))\n          return;\n        const img = el.querySelector(\"img\");\n        if (!img)\n          return;\n        const src = img.getAttribute(\"src\") ?? void 0, alt = img.getAttribute(\"alt\") ?? void 0, props = Object.fromEntries(\n          Array.from(img.attributes).map((attr) => [attr.name, attr.value])\n        ), isInsideListItem = el.closest(\"li\") !== null;\n        if (el.closest(\"p\") === null || isInsideListItem) {\n          const inlineImage = options.matchers?.inlineImage?.({\n            context: {\n              schema,\n              keyGenerator: options.keyGenerator ?? keyGenerator\n            },\n            props: {\n              ...props,\n              ...src ? { src } : {},\n              ...alt ? { alt } : {}\n            }\n          });\n          if (inlineImage)\n            return inlineImage;\n        }\n        const image = options.matchers?.image?.({\n          context: {\n            schema,\n            keyGenerator: options.keyGenerator ?? keyGenerator\n          },\n          props: {\n            ...props,\n            ...src ? { src } : {},\n            ...alt ? { alt } : {}\n          }\n        });\n        if (image)\n          return {\n            _type: \"__block\",\n            block: image\n          };\n      }\n    },\n    // List item rule - handles <li> elements with aria-level\n    {\n      deserialize(el, next) {\n        if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"li\")\n          return;\n        const ariaLevel = el.getAttribute(\"data-aria-level\");\n        if (!ariaLevel)\n          return;\n        const listItem = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentNode) === \"ol\" ? \"number\" : \"bullet\";\n        let childNodesToProcess = el.childNodes, blockStyle = \"normal\";\n        if (el.childNodes.length === 1 && el.firstChild && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el.firstChild)) {\n          const childTag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.firstChild);\n          if (childTag && (_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_BLOCK_TAGS[childTag] || _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS[childTag] || childTag === \"word-online-block\")) {\n            if (childTag === \"word-online-block\") {\n              const paraStyle = el.firstChild.getAttribute(\"data-parastyle\"), foundBlockStyle = paraStyle ? mapParaStyleToBlockStyle(schema, paraStyle) : void 0;\n              foundBlockStyle && (blockStyle = foundBlockStyle);\n            }\n            childNodesToProcess = el.firstChild.childNodes;\n          }\n        }\n        const children = next(childNodesToProcess);\n        let childArray = Array.isArray(children) ? children : [children].filter(Boolean);\n        for (; childArray.length > 0; ) {\n          const lastChild = childArray[childArray.length - 1];\n          if (lastChild && typeof lastChild == \"object\" && \"text\" in lastChild) {\n            const text = lastChild.text.trimEnd();\n            if (text === \"\")\n              childArray = childArray.slice(0, -1);\n            else if (text !== lastChild.text) {\n              lastChild.text = text;\n              break;\n            } else\n              break;\n          } else\n            break;\n        }\n        return {\n          _type: schema.block.name,\n          children: childArray,\n          markDefs: [],\n          style: blockStyle,\n          listItem,\n          level: parseInt(ariaLevel, 10)\n        };\n      }\n    },\n    // Block style rule - handles paragraph styles like Quote\n    // The preprocessor wraps grouped NormalTextRun spans in a word-online-block element\n    {\n      deserialize(el, next) {\n        if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el))\n          return;\n        const paraStyle = el.getAttribute(\"data-parastyle\"), blockStyle = paraStyle ? mapParaStyleToBlockStyle(schema, paraStyle) : void 0;\n        if (!blockStyle)\n          return;\n        const children = next(el.childNodes);\n        return {\n          _type: schema.block.name,\n          style: blockStyle,\n          markDefs: [],\n          children: Array.isArray(children) ? children : children ? [children] : []\n        };\n      }\n    },\n    // TextRun rule\n    {\n      deserialize(el) {\n        if (isWordOnlineTextRun(el)) {\n          if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || !el.textContent)\n            return;\n          const text = Array.from(el.childNodes).filter(\n            (node) => isNormalTextRun(node) || isFindHit(node)\n          ).map((span2) => (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(span2) ? span2.textContent ?? \"\" : \"\").join(\"\");\n          if (!text)\n            return;\n          const span = {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            marks: [],\n            text\n          };\n          if (hasStrongFormatting(el) && span.marks.push(\"strong\"), hasEmphasisFormatting(el) && !isInHeading(el) && !isInBlockquote(el) && span.marks.push(\"em\"), hasUnderlineFormatting(el))\n            if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.parentElement && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentElement) === \"a\") {\n              const linkElement = el.parentElement;\n              if (linkElement) {\n                const prevSibling = linkElement.previousSibling, nextSibling = linkElement.nextSibling, hasPrevUnderline = prevSibling && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(prevSibling) && hasUnderlineFormatting(prevSibling), hasNextUnderline = nextSibling && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(nextSibling) && hasUnderlineFormatting(nextSibling);\n                (hasPrevUnderline || hasNextUnderline) && span.marks.push(\"underline\");\n              }\n            } else\n              span.marks.push(\"underline\");\n          return hasStrikethroughFormatting(el) && span.marks.push(\"strike-through\"), span;\n        }\n      }\n    }\n  ];\n}\nconst LIST_CONTAINER_TAGS = Object.keys(_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_LIST_CONTAINER_TAGS);\nfunction isEmphasis$1(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /font-style\\s*:\\s*italic/.test(style || \"\");\n}\nfunction isStrong$1(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /font-weight\\s*:\\s*700/.test(style || \"\");\n}\nfunction isUnderline$1(el) {\n  if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentNode) === \"a\")\n    return !1;\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /text-decoration\\s*:\\s*underline/.test(style || \"\");\n}\nfunction isStrikethrough(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /text-decoration\\s*:\\s*(?:.*line-through.*;)/.test(style || \"\");\n}\nfunction isGoogleDocs(el) {\n  return (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && !!el.getAttribute(\"data-is-google-docs\");\n}\nfunction isRootNode(el) {\n  return (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && !!el.getAttribute(\"data-is-root-node\");\n}\nfunction getListItemStyle$1(el) {\n  const parentTag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentNode);\n  if (!(parentTag && !LIST_CONTAINER_TAGS.includes(parentTag)))\n    return (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentNode) === \"ul\" ? \"bullet\" : \"number\";\n}\nfunction getListItemLevel$1(el) {\n  let level = 0;\n  if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"li\") {\n    let parentNode = el.parentNode;\n    for (; parentNode; ) {\n      const parentTag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(parentNode);\n      parentTag && LIST_CONTAINER_TAGS.includes(parentTag) && level++, parentNode = parentNode.parentNode;\n    }\n  } else\n    level = 1;\n  return level;\n}\nconst blocks = {\n  ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_BLOCK_TAGS,\n  ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS\n};\nfunction getBlockStyle(schema, el) {\n  const childTag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.firstChild), block = childTag && blocks[childTag];\n  return block ? schema.styles.some((style) => style.name === block.style) ? block.style : _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.BLOCK_DEFAULT_STYLE : _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.BLOCK_DEFAULT_STYLE;\n}\nfunction createGDocsRules(schema) {\n  return [\n    {\n      deserialize(el, next) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"span\" && isGoogleDocs(el)) {\n          if (!el.textContent)\n            return !el.previousSibling && !el.nextSibling && el.setAttribute(\"data-lonely-child\", \"true\"), next(el.childNodes);\n          const span = {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            marks: [],\n            text: el.textContent\n          };\n          return isStrong$1(el) && span.marks.push(\"strong\"), isUnderline$1(el) && span.marks.push(\"underline\"), isStrikethrough(el) && span.marks.push(\"strike-through\"), isEmphasis$1(el) && span.marks.push(\"em\"), span;\n        }\n      }\n    },\n    {\n      deserialize(el, next) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"li\" && isGoogleDocs(el))\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_BLOCK,\n            listItem: getListItemStyle$1(el),\n            level: getListItemLevel$1(el),\n            style: getBlockStyle(schema, el),\n            children: next(el.firstChild?.childNodes || [])\n          };\n      }\n    },\n    {\n      deserialize(el) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"br\" && isGoogleDocs(el) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.classList.contains(\"apple-interchange-newline\"))\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            text: \"\"\n          };\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"br\" && isGoogleDocs(el) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el?.parentNode?.textContent === \"\")\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            text: \"\"\n          };\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"br\" && isGoogleDocs(el) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && isRootNode(el))\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            text: \"\"\n          };\n      }\n    }\n  ];\n}\nconst whitespaceTextNodeRule = {\n  deserialize(node) {\n    return node.nodeName === \"#text\" && isWhitespaceTextNode(node) ? {\n      ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n      marks: [],\n      text: (node.textContent ?? \"\").replace(/\\s\\s+/g, \" \")\n    } : void 0;\n  }\n};\nfunction isWhitespaceTextNode(node) {\n  return (node.nodeType === 3 && (node.textContent || \"\").replace(/[\\r\\n]/g, \" \").replace(/\\s\\s+/g, \" \") === \" \" && node.nextSibling && node.nextSibling.nodeType !== 3 && node.previousSibling && node.previousSibling.nodeType !== 3 || node.textContent !== \" \") && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(node.parentNode) !== \"body\";\n}\nfunction resolveListItem(schema, listNodeTagName) {\n  if (listNodeTagName === \"ul\" && schema.lists.some((list) => list.name === \"bullet\"))\n    return \"bullet\";\n  if (listNodeTagName === \"ol\" && schema.lists.some((list) => list.name === \"number\"))\n    return \"number\";\n}\nfunction createHTMLRules(schema, options) {\n  return [\n    whitespaceTextNodeRule,\n    {\n      // Pre element\n      deserialize(el) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"pre\")\n          return;\n        const isCodeEnabled = schema.styles.some(\n          (style) => style.name === \"code\"\n        );\n        return {\n          _type: \"block\",\n          style: \"normal\",\n          markDefs: [],\n          children: [\n            {\n              ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n              marks: isCodeEnabled ? [\"code\"] : [],\n              text: el.textContent || \"\"\n            }\n          ]\n        };\n      }\n    },\n    // Blockquote element\n    {\n      deserialize(el, next) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"blockquote\")\n          return;\n        const blocks2 = {\n          ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_BLOCK_TAGS,\n          ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS\n        };\n        delete blocks2.blockquote;\n        const nonBlockquoteBlocks = Object.keys(blocks2), children = [];\n        return el.childNodes.forEach((node, index) => {\n          if (el.ownerDocument)\n            if (node.nodeType === 1 && nonBlockquoteBlocks.includes(\n              node.localName.toLowerCase()\n            )) {\n              const span = el.ownerDocument.createElement(\"span\"), previousChild = children[children.length - 1];\n              previousChild && previousChild.nodeType === 3 && previousChild.textContent?.trim() && span.appendChild(el.ownerDocument.createTextNode(\"\\r\")), node.childNodes.forEach((cn) => {\n                span.appendChild(cn.cloneNode(!0));\n              }), index !== el.childNodes.length && span.appendChild(el.ownerDocument.createTextNode(\"\\r\")), children.push(span);\n            } else\n              children.push(node);\n        }), {\n          _type: \"block\",\n          style: \"blockquote\",\n          markDefs: [],\n          children: next(children)\n        };\n      }\n    },\n    // Block elements\n    {\n      deserialize(el, next) {\n        const blocks2 = {\n          ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_BLOCK_TAGS,\n          ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS\n        }, tag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el);\n        let block = tag ? blocks2[tag] : void 0;\n        if (!block)\n          return;\n        if (el.parentNode && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentNode) === \"li\")\n          return next(el.childNodes);\n        const blockStyle = block.style;\n        return schema.styles.some((style) => style.name === blockStyle) || (block = _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_BLOCK), {\n          ...block,\n          children: next(el.childNodes)\n        };\n      }\n    },\n    // Ignore span tags\n    {\n      deserialize(el, next) {\n        const tag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el);\n        if (!(!tag || !(tag in _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_SPAN_TAGS)))\n          return next(el.childNodes);\n      }\n    },\n    // Ignore div tags\n    {\n      deserialize(el, next) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"div\")\n          return next(el.childNodes);\n      }\n    },\n    // Ignore list containers\n    {\n      deserialize(el, next) {\n        const tag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el);\n        if (!(!tag || !(tag in _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_LIST_CONTAINER_TAGS)))\n          return next(el.childNodes);\n      }\n    },\n    // Deal with br's\n    {\n      deserialize(el) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"br\")\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            text: `\n`\n          };\n      }\n    },\n    // Deal with list items\n    {\n      deserialize(el, next, block) {\n        const tag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el), listItem = tag ? _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_LIST_ITEM_TAGS[tag] : void 0, parentTag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el.parentNode) || \"\";\n        if (!listItem || !el.parentNode || !_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_LIST_CONTAINER_TAGS[parentTag])\n          return;\n        const enabledListItem = resolveListItem(schema, parentTag);\n        return enabledListItem ? (listItem.listItem = enabledListItem, {\n          ...listItem,\n          children: next(el.childNodes)\n        }) : block({ _type: \"block\", children: next(el.childNodes) });\n      }\n    },\n    // Deal with decorators - this is a limited set of known html elements that we know how to deserialize\n    {\n      deserialize(el, next) {\n        const decorator = _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_DECORATOR_TAGS[(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) || \"\"];\n        if (!(!decorator || !schema.decorators.some(\n          (decoratorType) => decoratorType.name === decorator\n        )))\n          return {\n            _type: \"__decorator\",\n            name: decorator,\n            children: next(el.childNodes)\n          };\n      }\n    },\n    // Special case for hyperlinks, add annotation (if allowed by schema),\n    // If not supported just write out the link text and href in plain text.\n    {\n      deserialize(el, next) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) !== \"a\")\n          return;\n        const linkEnabled = schema.annotations.some(\n          (annotation) => annotation.name === \"link\"\n        ), href = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"href\");\n        return href ? linkEnabled ? {\n          _type: \"__annotation\",\n          markDef: {\n            _key: options.keyGenerator ? options.keyGenerator() : keyGenerator(),\n            _type: \"link\",\n            href\n          },\n          children: next(el.childNodes)\n        } : el.appendChild(el.ownerDocument.createTextNode(` (${href})`)) && next(el.childNodes) : next(el.childNodes);\n      }\n    },\n    {\n      deserialize(el, next) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"td\" || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"th\"))\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_BLOCK,\n            children: next(el.childNodes)\n          };\n      }\n    },\n    {\n      deserialize(el) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"img\") {\n          const src = el.getAttribute(\"src\") ?? void 0, alt = el.getAttribute(\"alt\") ?? void 0, props = Object.fromEntries(\n            Array.from(el.attributes).map((attr) => [attr.name, attr.value])\n          ), ancestorOfLonelyChild = el?.parentElement?.parentElement?.getAttribute(\"data-lonely-child\"), ancestorOfListItem = el.closest(\"li\") !== null;\n          if (ancestorOfLonelyChild && !ancestorOfListItem) {\n            const image2 = options.matchers?.image?.({\n              context: {\n                schema,\n                keyGenerator: options.keyGenerator ?? keyGenerator\n              },\n              props: {\n                ...props,\n                ...src ? { src } : {},\n                ...alt ? { alt } : {}\n              }\n            });\n            if (image2)\n              return {\n                _type: \"__block\",\n                block: image2\n              };\n          }\n          const inlineImage = options.matchers?.inlineImage?.({\n            context: {\n              schema,\n              keyGenerator: options.keyGenerator ?? keyGenerator\n            },\n            props: {\n              ...props,\n              ...src ? { src } : {},\n              ...alt ? { alt } : {}\n            }\n          });\n          if (inlineImage)\n            return inlineImage;\n          const image = options.matchers?.image?.({\n            context: {\n              schema,\n              keyGenerator: options.keyGenerator ?? keyGenerator\n            },\n            props: {\n              ...props,\n              ...src ? { src } : {},\n              ...alt ? { alt } : {}\n            }\n          });\n          if (image)\n            return {\n              _type: \"__block\",\n              block: image\n            };\n        }\n      }\n    }\n  ];\n}\nfunction isEmphasis(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /font-style:italic/.test(style || \"\");\n}\nfunction isStrong(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /font-weight:700/.test(style || \"\") || /font-weight:600/.test(style || \"\");\n}\nfunction isUnderline(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  return /text-decoration:underline/.test(style || \"\");\n}\nfunction isNotion(el) {\n  return (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && !!el.getAttribute(\"data-is-notion\");\n}\nfunction createNotionRules() {\n  return [\n    {\n      deserialize(el) {\n        if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el) === \"span\" && isNotion(el)) {\n          const span = {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_SPAN,\n            marks: [],\n            text: el.textContent\n          };\n          return isStrong(el) && span.marks.push(\"strong\"), isUnderline(el) && span.marks.push(\"underline\"), isEmphasis(el) && span.marks.push(\"em\"), span;\n        }\n      }\n    }\n  ];\n}\nfunction getListItemStyle(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  if (style && style.match(/lfo\\d+/))\n    return style.match(\"lfo1\") ? \"number\" : \"bullet\";\n}\nfunction getListItemLevel(el) {\n  const style = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el) && el.getAttribute(\"style\");\n  if (!style)\n    return;\n  const levelMatch = style.match(/level\\d+/);\n  if (!levelMatch)\n    return;\n  const [level] = levelMatch[0].match(/\\d/) || [];\n  return (level ? Number.parseInt(level, 10) : 1) || 1;\n}\nfunction isWordListElement(el) {\n  if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isElement)(el))\n    return !1;\n  if (el.className && (el.className === \"MsoListParagraphCxSpFirst\" || el.className === \"MsoListParagraphCxSpMiddle\" || el.className === \"MsoListParagraphCxSpLast\"))\n    return !0;\n  const style = el.getAttribute(\"style\");\n  return !!(style && /mso-list:\\s*l\\d+\\s+level\\d+\\s+lfo\\d+/.test(style));\n}\nfunction getHeadingStyle(el) {\n  const tag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el);\n  if (tag && _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS[tag])\n    return _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS[tag]?.style;\n}\nfunction createWordRules() {\n  return [\n    {\n      deserialize(el, next) {\n        const tag = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(el);\n        if ((tag === \"p\" || _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.HTML_HEADER_TAGS[tag || \"\"]) && isWordListElement(el)) {\n          const headingStyle = getHeadingStyle(el);\n          return {\n            ..._chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_BLOCK,\n            listItem: getListItemStyle(el),\n            level: getListItemLevel(el),\n            style: headingStyle || _chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.BLOCK_DEFAULT_STYLE,\n            children: next(el.childNodes)\n          };\n        }\n      }\n    }\n  ];\n}\nfunction createRules(schema, options) {\n  return [\n    ...createWordRules(),\n    ...createWordOnlineRules(schema, options),\n    ...createNotionRules(),\n    ...createGDocsRules(schema),\n    ...createHTMLRules(schema, options)\n  ];\n}\nfunction trimWhitespace(context, mode, blocks2) {\n  const trimmedBlocks = [];\n  let consecutiveEmptyCount = 0;\n  for (const block of blocks2) {\n    const trimmedBlock = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(context, block) ? trimTextBlockWhitespace(block) : block;\n    if (mode === \"preserve\") {\n      trimmedBlocks.push(trimmedBlock);\n      continue;\n    }\n    if (mode === \"remove\") {\n      if (isEmptyTextBlock(context, trimmedBlock))\n        continue;\n      trimmedBlocks.push(trimmedBlock);\n      continue;\n    }\n    if (mode === \"normalize\") {\n      if (isEmptyTextBlock(context, trimmedBlock)) {\n        consecutiveEmptyCount++, consecutiveEmptyCount === 1 && trimmedBlocks.push(trimmedBlock);\n        continue;\n      }\n      trimmedBlocks.push(trimmedBlock), consecutiveEmptyCount = 0;\n    }\n  }\n  return trimmedBlocks;\n}\nfunction isEmptyTextBlock(context, block) {\n  return !(!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(context, block) || block.children.some(\n    (child) => !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(context, child) || child.text.trim() !== \"\"\n  ));\n}\nfunction trimTextBlockWhitespace(block) {\n  let index = 0;\n  for (const child of block.children) {\n    if (!(0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalSpan)(child)) {\n      index++;\n      continue;\n    }\n    const nextChild = nextSpan(block, index), prevChild = prevSpan(block, index);\n    index === 0 && (child.text = child.text.replace(/^[^\\S\\n]+/g, \"\")), index === block.children.length - 1 && (child.text = child.text.replace(/[^\\S\\n]+$/g, \"\")), /\\s/.test(child.text.slice(Math.max(0, child.text.length - 1))) && nextChild && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalSpan)(nextChild) && /\\s/.test(nextChild.text.slice(0, 1)) && (child.text = child.text.replace(/[^\\S\\n]+$/g, \"\")), /\\s/.test(child.text.slice(0, 1)) && prevChild && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalSpan)(prevChild) && /\\s/.test(prevChild.text.slice(Math.max(0, prevChild.text.length - 1))) && (child.text = child.text.replace(/^[^\\S\\n]+/g, \"\")), child.text || block.children.splice(index, 1), prevChild && Array.isArray(prevChild.marks) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isEqualMarks)(prevChild.marks, child.marks) && isWhiteSpaceChar(child.text) ? (prevChild.text += \" \", block.children.splice(index, 1)) : nextChild && Array.isArray(nextChild.marks) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isEqualMarks)(nextChild.marks, child.marks) && isWhiteSpaceChar(child.text) && (nextChild.text = ` ${nextChild.text}`, block.children.splice(index, 1)), index++;\n  }\n  return block;\n}\nfunction nextSpan(block, index) {\n  const next = block.children[index + 1];\n  return next && next._type === \"span\" ? next : null;\n}\nfunction prevSpan(block, index) {\n  const prev = block.children[index - 1];\n  return prev && prev._type === \"span\" ? prev : null;\n}\nfunction isWhiteSpaceChar(text) {\n  return [\"\\xA0\", \" \"].includes(text);\n}\nclass HtmlDeserializer {\n  keyGenerator;\n  schema;\n  rules;\n  parseHtml;\n  whitespaceMode;\n  _markDefs = [];\n  /**\n   * Create a new serializer respecting a Sanity block content type's schema\n   *\n   * @param blockContentType - Schema type for array containing _at least_ a block child type\n   * @param options - Options for the deserialization process\n   */\n  constructor(schema, options = {}) {\n    const { rules = [], unstable_whitespaceOnPasteMode = \"preserve\" } = options, standardRules = createRules(schema, {\n      keyGenerator: options.keyGenerator,\n      matchers: options.matchers\n    });\n    this.schema = schema, this.keyGenerator = options.keyGenerator ?? keyGenerator, this.rules = [...rules, ...standardRules], this.whitespaceMode = unstable_whitespaceOnPasteMode;\n    const parseHtml = options.parseHtml || (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.defaultParseHtml)();\n    this.parseHtml = (html) => {\n      const cleanHTML = M(html), doc = parseHtml(cleanHTML);\n      for (const processor of preprocessors)\n        processor(cleanHTML, doc);\n      return doc.body;\n    };\n  }\n  /**\n   * Deserialize HTML.\n   *\n   * @param html - The HTML to deserialize, as a string\n   * @returns Array of blocks - either portable text blocks or other allowed blocks\n   */\n  deserialize = (html) => {\n    this._markDefs = [];\n    const { parseHtml } = this, fragment = parseHtml(html), children = Array.from(fragment.childNodes), blocks2 = trimWhitespace(\n      { schema: this.schema },\n      this.whitespaceMode,\n      (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.flattenNestedBlocks)(\n        { schema: this.schema },\n        (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.ensureRootIsBlocks)(\n          this.schema,\n          this.deserializeElements(children)\n        )\n      )\n    );\n    return this._markDefs.length > 0 && blocks2.filter((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)({ schema: this.schema }, block)).forEach((block) => {\n      block.markDefs = block.markDefs || [], block.markDefs = block.markDefs.concat(\n        this._markDefs.filter((def) => block.children.flatMap((child) => child.marks || []).includes(def._key))\n      );\n    }), blocks2.map((block) => (block._type === \"block\" && (block._type = this.schema.block.name), block));\n  };\n  /**\n   * Deserialize an array of DOM elements.\n   *\n   * @param elements - Array of DOM elements to deserialize\n   * @returns\n   */\n  deserializeElements = (elements = []) => {\n    let nodes = [];\n    return elements.forEach((element) => {\n      nodes = nodes.concat(this.deserializeElement(element));\n    }), nodes;\n  };\n  /**\n   * Deserialize a DOM element\n   *\n   * @param element - Deserialize a DOM element\n   * @returns\n   */\n  deserializeElement = (element) => {\n    const next = (elements) => {\n      if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isNodeList)(elements))\n        return this.deserializeElements(Array.from(elements));\n      if (Array.isArray(elements))\n        return this.deserializeElements(elements);\n      if (elements)\n        return this.deserializeElement(elements);\n    }, block = (props) => ({\n      _type: \"__block\",\n      block: props\n    });\n    let node;\n    for (let i = 0; i < this.rules.length; i++) {\n      const rule = this.rules[i];\n      if (!rule.deserialize)\n        continue;\n      const ret = rule.deserialize(element, next, block), type = (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.resolveJsType)(ret);\n      if (type !== \"array\" && type !== \"object\" && type !== \"null\" && type !== \"undefined\")\n        throw new Error(\n          `A rule returned an invalid deserialized representation: \"${node}\".`\n        );\n      if (ret !== void 0) {\n        {\n          if (ret === null)\n            throw new Error(\"Deserializer rule returned `null`\");\n          Array.isArray(ret) ? node = ret : (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isPlaceholderDecorator)(ret) ? node = this.deserializeDecorator(ret) : (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isPlaceholderAnnotation)(ret) ? node = this.deserializeAnnotation(ret) : node = ret;\n        }\n        if (ret && !Array.isArray(ret) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalBlock)(ret) && \"listItem\" in ret) {\n          let parent = element.parentNode?.parentNode;\n          for (; parent && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.tagName)(parent) === \"li\"; )\n            parent = parent.parentNode?.parentNode, ret.level = ret.level ? ret.level + 1 : 1;\n        }\n        ret && !Array.isArray(ret) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalBlock)(ret) && ret.style === \"blockquote\" && ret.children.forEach((child, index) => {\n          (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalSpan)(child) && child.text === \"\\r\" && (child.text = `\n`, (index === 0 || index === ret.children.length - 1) && ret.children.splice(index, 1));\n        });\n        break;\n      }\n    }\n    return node || next(element.childNodes) || [];\n  };\n  /**\n   * Deserialize a `__decorator` type\n   * (an internal made up type to process decorators exclusively)\n   *\n   * @param decorator -\n   * @returns array of ...\n   */\n  deserializeDecorator = (decorator) => {\n    const { name } = decorator, applyDecorator = (node) => {\n      if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isPlaceholderDecorator)(node))\n        return this.deserializeDecorator(node);\n      if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalSpan)(node))\n        node.marks = node.marks || [], node.text.trim() && node.marks.unshift(name);\n      else if (\"children\" in node && Array.isArray(node.children)) {\n        const block = node;\n        block.children = block.children.map(applyDecorator);\n      }\n      return node;\n    };\n    return decorator.children.reduce((children, node) => {\n      const ret = applyDecorator(node);\n      return Array.isArray(ret) ? children.concat(ret) : (children.push(ret), children);\n    }, []);\n  };\n  /**\n   * Deserialize a `__annotation` object.\n   * (an internal made up type to process annotations exclusively)\n   *\n   * @param annotation -\n   * @returns Array of...\n   */\n  deserializeAnnotation = (annotation) => {\n    const { markDef } = annotation;\n    this._markDefs.push(markDef);\n    const applyAnnotation = (node) => {\n      if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isPlaceholderAnnotation)(node))\n        return this.deserializeAnnotation(node);\n      if ((0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isMinimalSpan)(node))\n        node.marks = node.marks || [], node.text.trim() && node.marks.unshift(markDef._key);\n      else if (\"children\" in node && Array.isArray(node.children)) {\n        const block = node;\n        block.children = block.children.map(applyAnnotation);\n      }\n      return node;\n    };\n    return annotation.children.reduce((children, node) => {\n      const ret = applyAnnotation(node);\n      return Array.isArray(ret) ? children.concat(ret) : (children.push(ret), children);\n    }, []);\n  };\n}\nfunction normalizeBlock(node, options = {}) {\n  const schema = {\n    block: {\n      name: options.blockTypeName || \"block\"\n    },\n    span: {\n      name: \"span\"\n    },\n    styles: [],\n    lists: [],\n    decorators: [],\n    annotations: [],\n    blockObjects: [],\n    inlineObjects: []\n  };\n  if (node._type !== (options.blockTypeName || \"block\"))\n    return \"_key\" in node ? node : {\n      ...node,\n      _key: options.keyGenerator ? options.keyGenerator() : keyGenerator()\n    };\n  const block = {\n    _key: options.keyGenerator ? options.keyGenerator() : keyGenerator(),\n    children: [],\n    markDefs: [],\n    ...node\n  }, lastChild = block.children[block.children.length - 1];\n  if (!lastChild)\n    return block.children = [\n      {\n        _type: \"span\",\n        _key: options.keyGenerator ? options.keyGenerator() : keyGenerator(),\n        text: \"\",\n        marks: []\n      }\n    ], block;\n  const usedMarkDefs = [], allowedDecorators = options.allowedDecorators && Array.isArray(options.allowedDecorators) ? options.allowedDecorators : !1;\n  return block.children = block.children.reduce(\n    (acc, child) => {\n      const previousChild = acc[acc.length - 1];\n      return previousChild && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)({ schema }, child) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)({ schema }, previousChild) && (0,_chunks_es_helpers_js__WEBPACK_IMPORTED_MODULE_0__.isEqualMarks)(previousChild.marks, child.marks) ? (lastChild && lastChild === child && child.text === \"\" && block.children.length > 1 || (previousChild.text += child.text), acc) : (acc.push(child), acc);\n    },\n    []\n  ).map((child) => {\n    if (!child)\n      throw new Error(\"missing child\");\n    return child._key = options.keyGenerator ? options.keyGenerator() : keyGenerator(), (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)({ schema }, child) && (child.marks ? allowedDecorators && (child.marks = child.marks.filter((mark) => {\n      const isAllowed = allowedDecorators.includes(mark), isUsed = block.markDefs?.some((def) => def._key === mark);\n      return isAllowed || isUsed;\n    })) : child.marks = [], usedMarkDefs.push(...child.marks)), child;\n  }), block.markDefs = (block.markDefs || []).filter(\n    (markDef) => usedMarkDefs.includes(markDef._key)\n  ), block;\n}\nfunction htmlToBlocks(html, schemaType, options = {}) {\n  const schema = isSanitySchema(schemaType) ? (0,_portabletext_sanity_bridge__WEBPACK_IMPORTED_MODULE_2__.sanitySchemaToPortableTextSchema)(schemaType) : schemaType;\n  return new HtmlDeserializer(schema, options).deserialize(html).map((block) => normalizeBlock(block, { keyGenerator: options.keyGenerator }));\n}\nfunction isSanitySchema(schema) {\n  return schema.hasOwnProperty(\"jsonType\");\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9ibG9jay10b29scy9saWIvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQStFO0FBQ3BCO0FBQ3lYO0FBQ3BiLFVBQVUsaUtBQWlLLFFBQVEscUNBQXFDLFFBQVE7QUFDaE87QUFDQTtBQUNBO0FBQ0EsV0FBVyxpQ0FBaUMsRUFBRSxnQkFBZ0IsWUFBWSxzQkFBc0IsRUFBRSxFQUFFLEdBQUc7QUFDdkc7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsU0FBUztBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxnRUFBUyxRQUFRLDhEQUFPO0FBQ2xDO0FBQ0E7QUFDQSxVQUFVLGdFQUFTLFFBQVEsOERBQU87QUFDbEM7QUFDQTtBQUNBLFVBQVUsZ0VBQVMsUUFBUSw4REFBTztBQUNsQztBQUNBO0FBQ0EsVUFBVSxnRUFBUyxRQUFRLDhEQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLFNBQVMsU0FBUztBQUNsQixRQUFRLGdFQUFTLGFBQWEsOERBQU87QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLFNBQVM7QUFDbEIsUUFBUSxnRUFBUyxhQUFhLDhEQUFPO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELFVBQVU7QUFDbEU7QUFDQTtBQUNBLHNEQUFzRCxzQkFBc0I7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Es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Q0EsVUFBVSxvRUFBYTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsMENBQTBDO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsNERBQU0sR0FBRyxRQUFRLFlBQVksNERBQU0sR0FBRyxRQUFRLG9CQUFvQixtRUFBWTtBQUM1RyxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RkFBd0YsNERBQU0sR0FBRyxRQUFRO0FBQ3pHO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRDtBQUNwRCw4Q0FBOEMsNkZBQWdDO0FBQzlFLHdHQUF3RyxvQ0FBb0M7QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFLRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9ibG9jay10b29scy9saWIvaW5kZXguanM/Mzg0ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzYW5pdHlTY2hlbWFUb1BvcnRhYmxlVGV4dFNjaGVtYSB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3Nhbml0eS1icmlkZ2VcIjtcbmltcG9ydCB7IGlzVGV4dEJsb2NrLCBpc1NwYW4gfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9zY2hlbWFcIjtcbmltcG9ydCB7IGlzRWxlbWVudCwgdGFnTmFtZSwgUFJFU0VSVkVfV0hJVEVTUEFDRV9UQUdTLCBIVE1MX0JMT0NLX1RBR1MsIEhUTUxfSEVBREVSX1RBR1MsIERFRkFVTFRfU1BBTiwgREVGQVVMVF9CTE9DSywgQkxPQ0tfREVGQVVMVF9TVFlMRSwgSFRNTF9MSVNUX0NPTlRBSU5FUl9UQUdTLCBIVE1MX1NQQU5fVEFHUywgSFRNTF9MSVNUX0lURU1fVEFHUywgSFRNTF9ERUNPUkFUT1JfVEFHUywgaXNNaW5pbWFsU3BhbiwgaXNFcXVhbE1hcmtzLCBkZWZhdWx0UGFyc2VIdG1sLCBmbGF0dGVuTmVzdGVkQmxvY2tzLCBlbnN1cmVSb290SXNCbG9ja3MsIHJlc29sdmVKc1R5cGUsIGlzUGxhY2Vob2xkZXJEZWNvcmF0b3IsIGlzUGxhY2Vob2xkZXJBbm5vdGF0aW9uLCBpc01pbmltYWxCbG9jaywgaXNOb2RlTGlzdCB9IGZyb20gXCIuL19jaHVua3MtZXMvaGVscGVycy5qc1wiO1xudmFyIGwgPSB7IDA6IDgyMDMsIDE6IDgyMDQsIDI6IDgyMDUsIDM6IDgyOTAsIDQ6IDgyOTEsIDU6IDgyODgsIDY6IDY1Mjc5LCA3OiA4Mjg5LCA4OiAxMTkxNTUsIDk6IDExOTE1NiwgYTogMTE5MTU3LCBiOiAxMTkxNTgsIGM6IDExOTE1OSwgZDogMTE5MTYwLCBlOiAxMTkxNjEsIGY6IDExOTE2MiB9LCBkID0geyAwOiA4MjAzLCAxOiA4MjA0LCAyOiA4MjA1LCAzOiA2NTI3OSB9LCBhID0geyAwOiBTdHJpbmcuZnJvbUNvZGVQb2ludChkWzBdKSwgMTogU3RyaW5nLmZyb21Db2RlUG9pbnQoZFsxXSksIDI6IFN0cmluZy5mcm9tQ29kZVBvaW50KGRbMl0pLCAzOiBTdHJpbmcuZnJvbUNvZGVQb2ludChkWzNdKSB9O1xubmV3IEFycmF5KDQpLmZpbGwoU3RyaW5nLmZyb21Db2RlUG9pbnQoZFswXSkpLmpvaW4oXCJcIik7XG5PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoYSkubWFwKCh0KSA9PiBbdFsxXSwgK3RbMF1dKSk7XG5PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMobCkubWFwKCh0KSA9PiB0LnJldmVyc2UoKSkpO1xudmFyIF8gPSBgJHtPYmplY3QudmFsdWVzKGwpLm1hcCgodCkgPT4gYFxcXFx1eyR7dC50b1N0cmluZygxNil9fWApLmpvaW4oXCJcIil9YCwgdSA9IG5ldyBSZWdFeHAoYFske199XXs0LH1gLCBcImd1XCIpO1xuZnVuY3Rpb24gRCh0KSB7XG4gIHZhciBlO1xuICByZXR1cm4geyBjbGVhbmVkOiB0LnJlcGxhY2UodSwgXCJcIiksIGVuY29kZWQ6ICgoZSA9IHQubWF0Y2godSkpID09IG51bGwgPyB2b2lkIDAgOiBlWzBdKSB8fCBcIlwiIH07XG59XG5mdW5jdGlvbiBNKHQpIHtcbiAgcmV0dXJuIHQgJiYgSlNPTi5wYXJzZShEKEpTT04uc3RyaW5naWZ5KHQpKS5jbGVhbmVkKTtcbn1cbmZ1bmN0aW9uIGtleUdlbmVyYXRvcigpIHtcbiAgcmV0dXJuIHJhbmRvbUtleSgxMik7XG59XG5mdW5jdGlvbiB3aGF0d2dSTkcobGVuZ3RoID0gMTYpIHtcbiAgY29uc3Qgcm5kczggPSBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICByZXR1cm4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhybmRzOCksIHJuZHM4O1xufVxuY29uc3QgYnl0ZVRvSGV4ID0gW107XG5mb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgKytpKVxuICBieXRlVG9IZXhbaV0gPSAoaSArIDI1NikudG9TdHJpbmcoMTYpLnNsaWNlKDEpO1xuZnVuY3Rpb24gcmFuZG9tS2V5KGxlbmd0aCkge1xuICByZXR1cm4gd2hhdHdnUk5HKGxlbmd0aCkucmVkdWNlKChzdHIsIG4pID0+IHN0ciArIGJ5dGVUb0hleFtuXSwgXCJcIikuc2xpY2UoMCwgbGVuZ3RoKTtcbn1cbmZ1bmN0aW9uIGlzV29yZE9ubGluZUh0bWwoaHRtbCkge1xuICByZXR1cm4gL2NsYXNzPVwiKD86VGV4dFJ1bnxOb3JtYWxUZXh0UnVuKVteXCJdKlNDWFdcXGQrW15cIl0qQkNYXFxkKy8udGVzdChodG1sKSB8fCAvY2xhc3M9XCJFT1BbXlwiXSpTQ1hXXFxkKy8udGVzdChodG1sKTtcbn1cbmZ1bmN0aW9uIGlzV29yZE9ubGluZVRleHRSdW4oZWwpIHtcbiAgcmV0dXJuICFpc0VsZW1lbnQoZWwpIHx8IHRhZ05hbWUoZWwpICE9PSBcInNwYW5cIiA/ICExIDogZWwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiVGV4dFJ1blwiKSAmJiAhZWwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiRU9QXCIpO1xufVxuZnVuY3Rpb24gaXNOb3JtYWxUZXh0UnVuKGVsKSB7XG4gIHJldHVybiAhaXNFbGVtZW50KGVsKSB8fCB0YWdOYW1lKGVsKSAhPT0gXCJzcGFuXCIgPyAhMSA6IGVsLmNsYXNzTGlzdC5jb250YWlucyhcIk5vcm1hbFRleHRSdW5cIik7XG59XG5mdW5jdGlvbiBpc1RleHRSdW5TcGFuKGVsKSB7XG4gIHJldHVybiAhaXNFbGVtZW50KGVsKSB8fCB0YWdOYW1lKGVsKSAhPT0gXCJzcGFuXCIgPyAhMSA6IGVsLmNsYXNzTGlzdC5jb250YWlucyhcIlRleHRSdW5cIikgJiYgIWVsLmNsYXNzTGlzdC5jb250YWlucyhcIk5vcm1hbFRleHRSdW5cIikgJiYgIWVsLmNsYXNzTGlzdC5jb250YWlucyhcIkVPUFwiKTtcbn1cbmZ1bmN0aW9uIGlzRmluZEhpdChlbCkge1xuICByZXR1cm4gIWlzRWxlbWVudChlbCkgfHwgdGFnTmFtZShlbCkgIT09IFwic3BhblwiID8gITEgOiBlbC5jbGFzc0xpc3QuY29udGFpbnMoXCJGaW5kSGl0XCIpO1xufVxuZnVuY3Rpb24gaXNJbkhlYWRpbmcoZWwpIHtcbiAgbGV0IGN1cnJlbnQgPSBlbDtcbiAgZm9yICg7IGN1cnJlbnQ7ICkge1xuICAgIGlmIChpc0VsZW1lbnQoY3VycmVudCkgJiYgdGFnTmFtZShjdXJyZW50KSA9PT0gXCJ3b3JkLW9ubGluZS1ibG9ja1wiICYmIC9eaGVhZGluZyBcXGQkLy50ZXN0KGN1cnJlbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1wYXJhc3R5bGVcIikgPz8gXCJcIikpXG4gICAgICByZXR1cm4gITA7XG4gICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50Tm9kZTtcbiAgfVxuICByZXR1cm4gITE7XG59XG5mdW5jdGlvbiBpc0luQmxvY2txdW90ZShlbCkge1xuICBsZXQgY3VycmVudCA9IGVsO1xuICBmb3IgKDsgY3VycmVudDsgKSB7XG4gICAgaWYgKGlzRWxlbWVudChjdXJyZW50KSAmJiB0YWdOYW1lKGN1cnJlbnQpID09PSBcIndvcmQtb25saW5lLWJsb2NrXCIgJiYgY3VycmVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXBhcmFzdHlsZVwiKSA9PT0gXCJRdW90ZVwiKVxuICAgICAgcmV0dXJuICEwO1xuICAgIGN1cnJlbnQgPSBjdXJyZW50LnBhcmVudE5vZGU7XG4gIH1cbiAgcmV0dXJuICExO1xufVxuZnVuY3Rpb24gaGFzU3Ryb25nRm9ybWF0dGluZyhlbCkge1xuICBjb25zdCBzdHlsZSA9IGVsLmdldEF0dHJpYnV0ZShcInN0eWxlXCIpID8/IFwiXCI7XG4gIHJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMoXCJNYWNDaHJvbWVCb2xkXCIpIHx8IC9mb250LXdlaWdodFxccyo6XFxzKmJvbGQvLnRlc3Qoc3R5bGUpO1xufVxuZnVuY3Rpb24gaGFzRW1waGFzaXNGb3JtYXR0aW5nKGVsKSB7XG4gIGNvbnN0IHN0eWxlID0gZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikgPz8gXCJcIjtcbiAgcmV0dXJuIC9mb250LXN0eWxlXFxzKjpcXHMqaXRhbGljLy50ZXN0KHN0eWxlKTtcbn1cbmZ1bmN0aW9uIGhhc1VuZGVybGluZUZvcm1hdHRpbmcoZWwpIHtcbiAgY29uc3Qgc3R5bGUgPSBlbC5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKSA/PyBcIlwiO1xuICByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiVW5kZXJsaW5lZFwiKSB8fCAvdGV4dC1kZWNvcmF0aW9uXFxzKjpcXHMqdW5kZXJsaW5lLy50ZXN0KHN0eWxlKTtcbn1cbmZ1bmN0aW9uIGhhc1N0cmlrZXRocm91Z2hGb3JtYXR0aW5nKGVsKSB7XG4gIGNvbnN0IHN0eWxlID0gZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikgPz8gXCJcIjtcbiAgcmV0dXJuIGVsLmNsYXNzTGlzdC5jb250YWlucyhcIlN0cmlrZXRocm91Z2hcIikgfHwgL3RleHQtZGVjb3JhdGlvblxccyo6XFxzKmxpbmUtdGhyb3VnaC8udGVzdChzdHlsZSk7XG59XG5mdW5jdGlvbiBoYXNGb3JtYXR0aW5nKGVsKSB7XG4gIHJldHVybiBoYXNTdHJvbmdGb3JtYXR0aW5nKGVsKSB8fCBoYXNFbXBoYXNpc0Zvcm1hdHRpbmcoZWwpIHx8IGhhc1VuZGVybGluZUZvcm1hdHRpbmcoZWwpIHx8IGhhc1N0cmlrZXRocm91Z2hGb3JtYXR0aW5nKGVsKTtcbn1cbmZ1bmN0aW9uIHByZXByb2Nlc3NXb3JkT25saW5lKGh0bWwsIGRvYykge1xuICBpZiAoIWlzV29yZE9ubGluZUh0bWwoaHRtbCkpXG4gICAgcmV0dXJuIGRvYztcbiAgY29uc3QgcGFyYWdyYXBocyA9IEFycmF5LmZyb20oXG4gICAgZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ3AuUGFyYWdyYXBoW3JvbGU9XCJoZWFkaW5nXCJdJylcbiAgKTtcbiAgZm9yIChjb25zdCBwYXJhZ3JhcGggb2YgcGFyYWdyYXBocykge1xuICAgIGNvbnN0IGFyaWFMZXZlbCA9IHBhcmFncmFwaC5nZXRBdHRyaWJ1dGUoXCJhcmlhLWxldmVsXCIpO1xuICAgIGlmIChhcmlhTGV2ZWwpIHtcbiAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2MuY3JlYXRlRWxlbWVudChcIndvcmQtb25saW5lLWJsb2NrXCIpO1xuICAgICAgd3JhcHBlci5zZXRBdHRyaWJ1dGUoXCJkYXRhLXBhcmFzdHlsZVwiLCBgaGVhZGluZyAke2FyaWFMZXZlbH1gKTtcbiAgICAgIGNvbnN0IHBhcmVudCA9IHBhcmFncmFwaC5wYXJlbnROb2RlO1xuICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICBmb3IgKHBhcmVudC5pbnNlcnRCZWZvcmUod3JhcHBlciwgcGFyYWdyYXBoKTsgcGFyYWdyYXBoLmZpcnN0Q2hpbGQ7IClcbiAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHBhcmFncmFwaC5maXJzdENoaWxkKTtcbiAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHBhcmFncmFwaCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGxldCBjaGlsZCA9IGRvYy5ib2R5LmZpcnN0Q2hpbGQ7XG4gIGZvciAoOyBjaGlsZDsgKSB7XG4gICAgY29uc3QgbmV4dCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuICAgIGlmICghaXNFbGVtZW50KGNoaWxkKSB8fCAhdGFnTmFtZShjaGlsZCk/LmluY2x1ZGVzKFwic3BhblwiKSkge1xuICAgICAgY2hpbGQgPSBuZXh0O1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFTdHlsZSA9IGdldFBhcmFTdHlsZShjaGlsZCk7XG4gICAgaWYgKCFwYXJhU3R5bGUpIHtcbiAgICAgIGNoaWxkID0gbmV4dDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBncm91cCA9IFtjaGlsZF07XG4gICAgbGV0IHNpYmxpbmcgPSBuZXh0O1xuICAgIGZvciAoOyBzaWJsaW5nICYmICEoIWlzRWxlbWVudChzaWJsaW5nKSB8fCBnZXRQYXJhU3R5bGUoc2libGluZykgIT09IHBhcmFTdHlsZSk7IClcbiAgICAgIGdyb3VwLnB1c2goc2libGluZyksIHNpYmxpbmcgPSBzaWJsaW5nLm5leHRTaWJsaW5nO1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2MuY3JlYXRlRWxlbWVudChcIndvcmQtb25saW5lLWJsb2NrXCIpO1xuICAgIHdyYXBwZXIuc2V0QXR0cmlidXRlKFwiZGF0YS1wYXJhc3R5bGVcIiwgcGFyYVN0eWxlKSwgZG9jLmJvZHkuaW5zZXJ0QmVmb3JlKHdyYXBwZXIsIGNoaWxkKTtcbiAgICBmb3IgKGNvbnN0IHNwYW4gb2YgZ3JvdXApXG4gICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNwYW4pO1xuICAgIGNoaWxkID0gc2libGluZztcbiAgfVxuICBjb25zdCB0ZXh0UnVuU3BhbnMgPSBBcnJheS5mcm9tKGRvYy5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoXCJzcGFuXCIpKS5maWx0ZXIoXG4gICAgaXNUZXh0UnVuU3BhblxuICApO1xuICBmb3IgKGNvbnN0IHRleHRSdW5TcGFuIG9mIHRleHRSdW5TcGFucykge1xuICAgIGNvbnN0IG5vcm1hbFRleHRSdW5zID0gQXJyYXkuZnJvbSh0ZXh0UnVuU3Bhbi5jaGlsZE5vZGVzKS5maWx0ZXIoXG4gICAgICBpc05vcm1hbFRleHRSdW5cbiAgICApO1xuICAgIGZvciAoY29uc3Qgbm9ybWFsVGV4dFJ1biBvZiBub3JtYWxUZXh0UnVucykge1xuICAgICAgbGV0IGZvdW5kTmVzdGVkU3BhbiA9ICEwO1xuICAgICAgZm9yICg7IGZvdW5kTmVzdGVkU3BhbjsgKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gQXJyYXkuZnJvbShub3JtYWxUZXh0UnVuLmNoaWxkTm9kZXMpLCBuZXN0ZWRTcGFuSW5kZXggPSBjaGlsZHJlbi5maW5kSW5kZXgoXG4gICAgICAgICAgKG5vZGUpID0+IGlzRWxlbWVudChub2RlKSAmJiB0YWdOYW1lKG5vZGUpID09PSBcInNwYW5cIiAmJiBub2RlLnRleHRDb250ZW50LnRyaW0oKSA9PT0gXCJcIlxuICAgICAgICApO1xuICAgICAgICBpZiAobmVzdGVkU3BhbkluZGV4ID09PSAtMSkge1xuICAgICAgICAgIGZvdW5kTmVzdGVkU3BhbiA9ICExO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5lc3RlZFNwYW4gPSBjaGlsZHJlbi5hdChuZXN0ZWRTcGFuSW5kZXgpO1xuICAgICAgICBpZiAoIW5lc3RlZFNwYW4pIHtcbiAgICAgICAgICBmb3VuZE5lc3RlZFNwYW4gPSAhMTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzcGFjZVRleHQgPSBuZXN0ZWRTcGFuLnRleHRDb250ZW50Py5yZXBsYWNlKC9cXHUwMGEwL2csIFwiIFwiKSA/PyBcIlwiLCBpc1NwYWNlQXRCZWdpbm5pbmcgPSAhY2hpbGRyZW4uc2xpY2UoMCwgbmVzdGVkU3BhbkluZGV4KS5zb21lKChuKSA9PiBuLm5vZGVUeXBlID09PSAzKTtcbiAgICAgICAgaWYgKG5vcm1hbFRleHRSdW4ucmVtb3ZlQ2hpbGQobmVzdGVkU3BhbiksIGlzU3BhY2VBdEJlZ2lubmluZykge1xuICAgICAgICAgIGNvbnN0IGZpcnN0VGV4dE5vZGUgPSBBcnJheS5mcm9tKG5vcm1hbFRleHRSdW4uY2hpbGROb2RlcykuZmluZChcbiAgICAgICAgICAgIChuKSA9PiBuLm5vZGVUeXBlID09PSAzXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoZmlyc3RUZXh0Tm9kZSlcbiAgICAgICAgICAgIGZpcnN0VGV4dE5vZGUudGV4dENvbnRlbnQgPSBzcGFjZVRleHQgKyAoZmlyc3RUZXh0Tm9kZS50ZXh0Q29udGVudCB8fCBcIlwiKTtcbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHNwYWNlTm9kZSA9IGRvYy5jcmVhdGVUZXh0Tm9kZShzcGFjZVRleHQpO1xuICAgICAgICAgICAgbm9ybWFsVGV4dFJ1bi5pbnNlcnRCZWZvcmUoc3BhY2VOb2RlLCBub3JtYWxUZXh0UnVuLmZpcnN0Q2hpbGQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBuZXh0U2libGluZyA9IHRleHRSdW5TcGFuLm5leHRTaWJsaW5nLCBjdXJyZW50SGFzRm9ybWF0dGluZyA9IGhhc0Zvcm1hdHRpbmcodGV4dFJ1blNwYW4pO1xuICAgICAgICAgIGlmIChuZXh0U2libGluZyAmJiBpc0VsZW1lbnQobmV4dFNpYmxpbmcpICYmIGlzVGV4dFJ1blNwYW4obmV4dFNpYmxpbmcpKSB7XG4gICAgICAgICAgICBjb25zdCBuZXh0SGFzRm9ybWF0dGluZyA9IGhhc0Zvcm1hdHRpbmcobmV4dFNpYmxpbmcpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRIYXNGb3JtYXR0aW5nICYmICFuZXh0SGFzRm9ybWF0dGluZykge1xuICAgICAgICAgICAgICBjb25zdCBuZXh0Tm9ybWFsVGV4dFJ1biA9IEFycmF5LmZyb20obmV4dFNpYmxpbmcuY2hpbGROb2RlcykuZmluZChcbiAgICAgICAgICAgICAgICBpc05vcm1hbFRleHRSdW5cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgaWYgKG5leHROb3JtYWxUZXh0UnVuICYmIGlzRWxlbWVudChuZXh0Tm9ybWFsVGV4dFJ1bikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdENoaWxkID0gbmV4dE5vcm1hbFRleHRSdW4uZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICBpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLm5vZGVUeXBlID09PSAzKVxuICAgICAgICAgICAgICAgICAgZmlyc3RDaGlsZC50ZXh0Q29udGVudCA9IHNwYWNlVGV4dCArIChmaXJzdENoaWxkLnRleHRDb250ZW50ID8/IFwiXCIpO1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgY29uc3Qgc3BhY2VOb2RlID0gZG9jLmNyZWF0ZVRleHROb2RlKHNwYWNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICBuZXh0Tm9ybWFsVGV4dFJ1bi5pbnNlcnRCZWZvcmUoXG4gICAgICAgICAgICAgICAgICAgIHNwYWNlTm9kZSxcbiAgICAgICAgICAgICAgICAgICAgbmV4dE5vcm1hbFRleHRSdW4uZmlyc3RDaGlsZFxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnN0IGxhc3RUZXh0Tm9kZSA9IEFycmF5LmZyb20obm9ybWFsVGV4dFJ1bi5jaGlsZE5vZGVzKS5maW5kKFxuICAgICAgICAgICAgICAgIChuKSA9PiBuLm5vZGVUeXBlID09PSAzXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGlmIChsYXN0VGV4dE5vZGUpXG4gICAgICAgICAgICAgICAgbGFzdFRleHROb2RlLnRleHRDb250ZW50ID0gKGxhc3RUZXh0Tm9kZS50ZXh0Q29udGVudCA/PyBcIlwiKSArIHNwYWNlVGV4dDtcbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3BhY2VOb2RlID0gZG9jLmNyZWF0ZVRleHROb2RlKHNwYWNlVGV4dCk7XG4gICAgICAgICAgICAgICAgbm9ybWFsVGV4dFJ1bi5hcHBlbmRDaGlsZChzcGFjZU5vZGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RUZXh0Tm9kZSA9IEFycmF5LmZyb20obm9ybWFsVGV4dFJ1bi5jaGlsZE5vZGVzKS5maW5kKFxuICAgICAgICAgICAgICAobikgPT4gbi5ub2RlVHlwZSA9PT0gM1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChsYXN0VGV4dE5vZGUpXG4gICAgICAgICAgICAgIGxhc3RUZXh0Tm9kZS50ZXh0Q29udGVudCA9IChsYXN0VGV4dE5vZGUudGV4dENvbnRlbnQgPz8gXCJcIikgKyBzcGFjZVRleHQ7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc3Qgc3BhY2VOb2RlID0gZG9jLmNyZWF0ZVRleHROb2RlKHNwYWNlVGV4dCk7XG4gICAgICAgICAgICAgIG5vcm1hbFRleHRSdW4uYXBwZW5kQ2hpbGQoc3BhY2VOb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRvYztcbn1cbmZ1bmN0aW9uIGdldFBhcmFTdHlsZShlbGVtZW50KSB7XG4gIGNvbnN0IGRpcmVjdFN0eWxlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNjcC1wYXJhc3R5bGVcIik7XG4gIGlmIChkaXJlY3RTdHlsZSlcbiAgICByZXR1cm4gZGlyZWN0U3R5bGU7XG4gIGlmICh0YWdOYW1lKGVsZW1lbnQpID09PSBcInNwYW5cIiAmJiBlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcIlRleHRSdW5cIikpIHtcbiAgICBjb25zdCBub3JtYWxUZXh0UnVucyA9IEFycmF5LmZyb20oXG4gICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuTm9ybWFsVGV4dFJ1blwiKVxuICAgICk7XG4gICAgaWYgKG5vcm1hbFRleHRSdW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpcnN0U3R5bGUgPSBub3JtYWxUZXh0UnVuc1swXS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNjcC1wYXJhc3R5bGVcIik7XG4gICAgICBpZiAoZmlyc3RTdHlsZSAmJiBub3JtYWxUZXh0UnVucy5ldmVyeShcbiAgICAgICAgKG5vcm1hbFRleHRSdW4pID0+IG5vcm1hbFRleHRSdW4uZ2V0QXR0cmlidXRlKFwiZGF0YS1jY3AtcGFyYXN0eWxlXCIpID09PSBmaXJzdFN0eWxlXG4gICAgICApKVxuICAgICAgICByZXR1cm4gZmlyc3RTdHlsZTtcbiAgICB9XG4gIH1cbn1cbmNvbnN0IF9YUGF0aFJlc3VsdCA9IHtcbiAgQk9PTEVBTl9UWVBFOiAzLFxuICBPUkRFUkVEX05PREVfSVRFUkFUT1JfVFlQRTogNSxcbiAgVU5PUkRFUkVEX05PREVfU05BUFNIT1RfVFlQRTogNlxufTtcbmZ1bmN0aW9uIHByZXByb2Nlc3NHRG9jcyhfaHRtbCwgZG9jKSB7XG4gIGxldCBnRG9jc1Jvb3RPclNpYmxpbmdOb2RlID0gZG9jLmV2YWx1YXRlKFxuICAgICcvLypbQGlkIGFuZCBjb250YWlucyhAaWQsIFwiZG9jcy1pbnRlcm5hbC1ndWlkXCIpXScsXG4gICAgZG9jLFxuICAgIG51bGwsXG4gICAgX1hQYXRoUmVzdWx0Lk9SREVSRURfTk9ERV9JVEVSQVRPUl9UWVBFLFxuICAgIG51bGxcbiAgKS5pdGVyYXRlTmV4dCgpO1xuICBpZiAoZ0RvY3NSb290T3JTaWJsaW5nTm9kZSkge1xuICAgIGNvbnN0IGlzV3JhcHBlZFJvb3RUYWcgPSB0YWdOYW1lKGdEb2NzUm9vdE9yU2libGluZ05vZGUpID09PSBcImJcIjtcbiAgICBpc1dyYXBwZWRSb290VGFnIHx8IChnRG9jc1Jvb3RPclNpYmxpbmdOb2RlID0gZG9jLmJvZHkpO1xuICAgIGNvbnN0IGNoaWxkTm9kZXMgPSBkb2MuZXZhbHVhdGUoXG4gICAgICBcIi8vKlwiLFxuICAgICAgZG9jLFxuICAgICAgbnVsbCxcbiAgICAgIF9YUGF0aFJlc3VsdC5VTk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFLFxuICAgICAgbnVsbFxuICAgICk7XG4gICAgZm9yIChsZXQgaSA9IGNoaWxkTm9kZXMuc25hcHNob3RMZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgZWxtID0gY2hpbGROb2Rlcy5zbmFwc2hvdEl0ZW0oaSk7XG4gICAgICBlbG0/LnNldEF0dHJpYnV0ZShcImRhdGEtaXMtZ29vZ2xlLWRvY3NcIiwgXCJ0cnVlXCIpLCAoZWxtPy5wYXJlbnRFbGVtZW50ID09PSBnRG9jc1Jvb3RPclNpYmxpbmdOb2RlIHx8ICFpc1dyYXBwZWRSb290VGFnICYmIGVsbS5wYXJlbnRFbGVtZW50ID09PSBkb2MuYm9keSkgJiYgKGVsbT8uc2V0QXR0cmlidXRlKFwiZGF0YS1pcy1yb290LW5vZGVcIiwgXCJ0cnVlXCIpLCB0YWdOYW1lKGVsbSkpLCB0YWdOYW1lKGVsbSkgPT09IFwibGlcIiAmJiBlbG0uZmlyc3RDaGlsZCAmJiB0YWdOYW1lKGVsbT8uZmlyc3RDaGlsZCkgPT09IFwiaW1nXCIgJiYgZWxtLnJlbW92ZUNoaWxkKGVsbS5maXJzdENoaWxkKTtcbiAgICB9XG4gICAgcmV0dXJuIGlzV3JhcHBlZFJvb3RUYWcgJiYgZG9jLmJvZHkuZmlyc3RFbGVtZW50Q2hpbGQ/LnJlcGxhY2VXaXRoKFxuICAgICAgLi4uQXJyYXkuZnJvbShnRG9jc1Jvb3RPclNpYmxpbmdOb2RlLmNoaWxkTm9kZXMpXG4gICAgKSwgZG9jO1xuICB9XG4gIHJldHVybiBkb2M7XG59XG5jb25zdCB1bndhbnRlZFdvcmREb2N1bWVudFBhdGhzID0gW1xuICBcIi9odG1sL3RleHQoKVwiLFxuICBcIi9odG1sL2hlYWQvdGV4dCgpXCIsXG4gIFwiL2h0bWwvYm9keS90ZXh0KClcIixcbiAgXCIvaHRtbC9ib2R5L3VsL3RleHQoKVwiLFxuICBcIi9odG1sL2JvZHkvb2wvdGV4dCgpXCIsXG4gIFwiLy9jb21tZW50KClcIixcbiAgXCIvL3N0eWxlXCIsXG4gIFwiLy94bWxcIixcbiAgXCIvL3NjcmlwdFwiLFxuICBcIi8vbWV0YVwiLFxuICBcIi8vbGlua1wiXG5dO1xuZnVuY3Rpb24gcHJlcHJvY2Vzc0hUTUwoX2h0bWwsIGRvYykge1xuICBjb25zdCBib2R5VGV4dE5vZGVzID0gZG9jLmV2YWx1YXRlKFxuICAgIFwiL2h0bWwvYm9keS90ZXh0KClcIixcbiAgICBkb2MsXG4gICAgbnVsbCxcbiAgICBfWFBhdGhSZXN1bHQuVU5PUkRFUkVEX05PREVfU05BUFNIT1RfVFlQRSxcbiAgICBudWxsXG4gICk7XG4gIGZvciAobGV0IGkgPSBib2R5VGV4dE5vZGVzLnNuYXBzaG90TGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBub2RlID0gYm9keVRleHROb2Rlcy5zbmFwc2hvdEl0ZW0oaSksIHRleHQgPSBub2RlLnRleHRDb250ZW50IHx8IFwiXCI7XG4gICAgaWYgKHRleHQucmVwbGFjZSgvW15cXFNcXG5dKyQvZywgXCJcIikpIHtcbiAgICAgIGNvbnN0IG5ld05vZGUgPSBkb2MuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICBuZXdOb2RlLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVUZXh0Tm9kZSh0ZXh0KSksIG5vZGUucGFyZW50Tm9kZT8ucmVwbGFjZUNoaWxkKG5ld05vZGUsIG5vZGUpO1xuICAgIH0gZWxzZVxuICAgICAgbm9kZS5wYXJlbnROb2RlPy5yZW1vdmVDaGlsZChub2RlKTtcbiAgfVxuICBjb25zdCB1bndhbnRlZE5vZGVzID0gZG9jLmV2YWx1YXRlKFxuICAgIHVud2FudGVkV29yZERvY3VtZW50UGF0aHMuam9pbihcInxcIiksXG4gICAgZG9jLFxuICAgIG51bGwsXG4gICAgX1hQYXRoUmVzdWx0LlVOT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsXG4gICAgbnVsbFxuICApO1xuICBmb3IgKGxldCBpID0gdW53YW50ZWROb2Rlcy5zbmFwc2hvdExlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29uc3QgdW53YW50ZWQgPSB1bndhbnRlZE5vZGVzLnNuYXBzaG90SXRlbShpKTtcbiAgICB1bndhbnRlZCAmJiB1bndhbnRlZC5wYXJlbnROb2RlPy5yZW1vdmVDaGlsZCh1bndhbnRlZCk7XG4gIH1cbiAgcmV0dXJuIGRvYztcbn1cbmZ1bmN0aW9uIHByZXByb2Nlc3NOb3Rpb24oaHRtbCwgZG9jKSB7XG4gIGNvbnN0IE5PVElPTl9SRUdFWCA9IC88IS0tIG5vdGlvbnZjOi4qPy0tPi9nO1xuICBpZiAoaHRtbC5tYXRjaChOT1RJT05fUkVHRVgpKSB7XG4gICAgY29uc3QgY2hpbGROb2RlcyA9IGRvYy5ldmFsdWF0ZShcbiAgICAgIFwiLy8qXCIsXG4gICAgICBkb2MsXG4gICAgICBudWxsLFxuICAgICAgX1hQYXRoUmVzdWx0LlVOT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsXG4gICAgICBudWxsXG4gICAgKTtcbiAgICBmb3IgKGxldCBpID0gY2hpbGROb2Rlcy5zbmFwc2hvdExlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgY2hpbGROb2Rlcy5zbmFwc2hvdEl0ZW0oaSk/LnNldEF0dHJpYnV0ZShcImRhdGEtaXMtbm90aW9uXCIsIFwidHJ1ZVwiKTtcbiAgICByZXR1cm4gZG9jO1xuICB9XG4gIHJldHVybiBkb2M7XG59XG5jb25zdCBCTE9DS19DT05UQUlORVJfRUxFTUVOVFMgPSBbXG4gIFwiYm9keVwiLFxuICBcInRhYmxlXCIsXG4gIFwidGJvZHlcIixcbiAgXCJ0aGVhZFwiLFxuICBcInRmb290XCIsXG4gIFwidHJcIixcbiAgXCJ1bFwiLFxuICBcIm9sXCJcbl07XG5mdW5jdGlvbiBwcmVwcm9jZXNzV2hpdGVzcGFjZShfMiwgZG9jKSB7XG4gIGZ1bmN0aW9uIHByb2Nlc3NOb2RlKG5vZGUpIHtcbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gX1hQYXRoUmVzdWx0LkJPT0xFQU5fVFlQRSAmJiAhUFJFU0VSVkVfV0hJVEVTUEFDRV9UQUdTLmluY2x1ZGVzKFxuICAgICAgbm9kZS5wYXJlbnRFbGVtZW50Py50YWdOYW1lLnRvTG93ZXJDYXNlKCkgfHwgXCJcIlxuICAgICkpIHtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBub2RlLnRleHRDb250ZW50Py5yZXBsYWNlKC9cXHNcXHMrL2csIFwiIFwiKS5yZXBsYWNlKC9bXFxyXFxuXSsvZywgXCIgXCIpIHx8IFwiXCIsIHBhcmVudFRhZyA9IG5vZGUucGFyZW50RWxlbWVudD8udGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgcGFyZW50VGFnICYmIEJMT0NLX0NPTlRBSU5FUl9FTEVNRU5UUy5pbmNsdWRlcyhwYXJlbnRUYWcpICYmIG5vcm1hbGl6ZWQudHJpbSgpID09PSBcIlwiID8gbm9kZS5wYXJlbnROb2RlPy5yZW1vdmVDaGlsZChub2RlKSA6IG5vZGUudGV4dENvbnRlbnQgPSBub3JtYWxpemVkO1xuICAgIH0gZWxzZVxuICAgICAgZm9yIChsZXQgaSA9IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSlcbiAgICAgICAgcHJvY2Vzc05vZGUobm9kZS5jaGlsZE5vZGVzW2ldKTtcbiAgfVxuICByZXR1cm4gcHJvY2Vzc05vZGUoZG9jLmJvZHkpLCBkb2M7XG59XG5jb25zdCBXT1JEX0hUTUxfUkVHRVggPSAvKGNsYXNzPVwiP01zb3xzdHlsZT0oPzpcInwnKVteXCJdKj9cXGJtc28tfHc6V29yZERvY3VtZW50fDxvOlxcdys+fDxcXC9mb250PikvLCB1bndhbnRlZFBhdGhzID0gW1xuICBcIi8vbzpwXCIsXG4gIFwiLy9zcGFuW0BzdHlsZT0nbXNvLWxpc3Q6SWdub3JlJ11cIixcbiAgXCIvL3NwYW5bQHN0eWxlPSdtc28tbGlzdDogSWdub3JlJ11cIlxuXSwgbWFwcGVkUGF0aHMgPSBbXG4gIFwiLy9wW0BjbGFzcz0nTXNvVG9jSGVhZGluZyddXCIsXG4gIFwiLy9wW0BjbGFzcz0nTXNvVGl0bGUnXVwiLFxuICBcIi8vcFtAY2xhc3M9J01zb1RvYUhlYWRpbmcnXVwiLFxuICBcIi8vcFtAY2xhc3M9J01zb1N1YnRpdGxlJ11cIixcbiAgXCIvL3NwYW5bQGNsYXNzPSdNc29TdWJ0bGVFbXBoYXNpcyddXCIsXG4gIFwiLy9zcGFuW0BjbGFzcz0nTXNvSW50ZW5zZUVtcGhhc2lzJ11cIlxuXSwgZWxlbWVudE1hcCA9IHtcbiAgTXNvVG9jSGVhZGluZzogW1wiaDNcIl0sXG4gIE1zb1RpdGxlOiBbXCJoMVwiXSxcbiAgTXNvVG9hSGVhZGluZzogW1wiaDJcIl0sXG4gIE1zb1N1YnRpdGxlOiBbXCJoNVwiXSxcbiAgTXNvU3VidGxlRW1waGFzaXM6IFtcInNwYW5cIiwgXCJlbVwiXSxcbiAgTXNvSW50ZW5zZUVtcGhhc2lzOiBbXCJzcGFuXCIsIFwiZW1cIiwgXCJzdHJvbmdcIl1cbiAgLy8gUmVtb3ZlIGNydWZ0XG59O1xuZnVuY3Rpb24gaXNXb3JkSHRtbChodG1sKSB7XG4gIHJldHVybiBXT1JEX0hUTUxfUkVHRVgudGVzdChodG1sKTtcbn1cbmZ1bmN0aW9uIHByZXByb2Nlc3NXb3JkKGh0bWwsIGRvYykge1xuICBpZiAoIWlzV29yZEh0bWwoaHRtbCkpXG4gICAgcmV0dXJuIGRvYztcbiAgY29uc3QgdW53YW50ZWROb2RlcyA9IGRvYy5ldmFsdWF0ZShcbiAgICB1bndhbnRlZFBhdGhzLmpvaW4oXCJ8XCIpLFxuICAgIGRvYyxcbiAgICAocHJlZml4KSA9PiBwcmVmaXggPT09IFwib1wiID8gXCJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTpvZmZpY2VcIiA6IG51bGwsXG4gICAgX1hQYXRoUmVzdWx0LlVOT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsXG4gICAgbnVsbFxuICApO1xuICBmb3IgKGxldCBpID0gdW53YW50ZWROb2Rlcy5zbmFwc2hvdExlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29uc3QgdW53YW50ZWQgPSB1bndhbnRlZE5vZGVzLnNuYXBzaG90SXRlbShpKTtcbiAgICB1bndhbnRlZD8ucGFyZW50Tm9kZSAmJiB1bndhbnRlZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHVud2FudGVkKTtcbiAgfVxuICBjb25zdCBtYXBwZWRFbGVtZW50cyA9IGRvYy5ldmFsdWF0ZShcbiAgICBtYXBwZWRQYXRocy5qb2luKFwifFwiKSxcbiAgICBkb2MsXG4gICAgbnVsbCxcbiAgICBfWFBhdGhSZXN1bHQuVU5PUkRFUkVEX05PREVfU05BUFNIT1RfVFlQRSxcbiAgICBudWxsXG4gICk7XG4gIGZvciAobGV0IGkgPSBtYXBwZWRFbGVtZW50cy5zbmFwc2hvdExlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29uc3QgbWFwcGVkRWxtID0gbWFwcGVkRWxlbWVudHMuc25hcHNob3RJdGVtKGkpLCB0YWdzID0gZWxlbWVudE1hcFttYXBwZWRFbG0uY2xhc3NOYW1lXSwgdGV4dCA9IGRvYy5jcmVhdGVUZXh0Tm9kZShtYXBwZWRFbG0udGV4dENvbnRlbnQgfHwgXCJcIik7XG4gICAgaWYgKCF0YWdzKVxuICAgICAgY29udGludWU7XG4gICAgY29uc3QgcGFyZW50RWxlbWVudCA9IGRvYy5jcmVhdGVFbGVtZW50KHRhZ3NbMF0pO1xuICAgIGxldCBwYXJlbnQgPSBwYXJlbnRFbGVtZW50LCBjaGlsZCA9IHBhcmVudEVsZW1lbnQ7XG4gICAgdGFncy5zbGljZSgxKS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgIGNoaWxkID0gZG9jLmNyZWF0ZUVsZW1lbnQodGFnKSwgcGFyZW50LmFwcGVuZENoaWxkKGNoaWxkKSwgcGFyZW50ID0gY2hpbGQ7XG4gICAgfSksIGNoaWxkLmFwcGVuZENoaWxkKHRleHQpLCBtYXBwZWRFbG0/LnBhcmVudE5vZGU/LnJlcGxhY2VDaGlsZChwYXJlbnRFbGVtZW50LCBtYXBwZWRFbG0pO1xuICB9XG4gIHJldHVybiBkb2M7XG59XG5jb25zdCBwcmVwcm9jZXNzb3JzID0gW1xuICBwcmVwcm9jZXNzV2hpdGVzcGFjZSxcbiAgcHJlcHJvY2Vzc05vdGlvbixcbiAgcHJlcHJvY2Vzc1dvcmQsXG4gIHByZXByb2Nlc3NXb3JkT25saW5lLFxuICBwcmVwcm9jZXNzR0RvY3MsXG4gIHByZXByb2Nlc3NIVE1MXG5dO1xuZnVuY3Rpb24gbWFwUGFyYVN0eWxlVG9CbG9ja1N0eWxlKHNjaGVtYSwgcGFyYVN0eWxlKSB7XG4gIGNvbnN0IGJsb2NrU3R5bGUgPSB7XG4gICAgXCJoZWFkaW5nIDFcIjogXCJoMVwiLFxuICAgIFwiaGVhZGluZyAyXCI6IFwiaDJcIixcbiAgICBcImhlYWRpbmcgM1wiOiBcImgzXCIsXG4gICAgXCJoZWFkaW5nIDRcIjogXCJoNFwiLFxuICAgIFwiaGVhZGluZyA1XCI6IFwiaDVcIixcbiAgICBcImhlYWRpbmcgNlwiOiBcImg2XCIsXG4gICAgUXVvdGU6IFwiYmxvY2txdW90ZVwiXG4gIH1bcGFyYVN0eWxlXSA/PyBcIm5vcm1hbFwiO1xuICByZXR1cm4gc2NoZW1hLnN0eWxlcy5maW5kKChzdHlsZSkgPT4gc3R5bGUubmFtZSA9PT0gYmxvY2tTdHlsZSk/Lm5hbWU7XG59XG5mdW5jdGlvbiBjcmVhdGVXb3JkT25saW5lUnVsZXMoc2NoZW1hLCBvcHRpb25zKSB7XG4gIHJldHVybiBbXG4gICAgLy8gSW1hZ2UgcnVsZSAtIGhhbmRsZXMgYmFyZSBXb3JkIE9ubGluZSA8aW1nPiB0YWdzIHdpdGggV0FDSW1hZ2UgY2xhc3NcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCkge1xuICAgICAgICBpZiAoIWlzRWxlbWVudChlbCkgfHwgdGFnTmFtZShlbCkgIT09IFwiaW1nXCIpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjbGFzc05hbWVSYXcgPSBlbC5jbGFzc05hbWU7XG4gICAgICAgIGxldCBjbGFzc05hbWUgPSBcIlwiO1xuICAgICAgICBpZiAodHlwZW9mIGNsYXNzTmFtZVJhdyA9PSBcInN0cmluZ1wiID8gY2xhc3NOYW1lID0gY2xhc3NOYW1lUmF3IDogY2xhc3NOYW1lUmF3ICYmIHR5cGVvZiBjbGFzc05hbWVSYXcgPT0gXCJvYmplY3RcIiAmJiAoY2xhc3NOYW1lID0gY2xhc3NOYW1lUmF3LmJhc2VWYWwgfHwgXCJcIiksICFjbGFzc05hbWUuaW5jbHVkZXMoXCJXQUNJbWFnZVwiKSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHNyYyA9IGVsLmdldEF0dHJpYnV0ZShcInNyY1wiKSA/PyB2b2lkIDAsIGFsdCA9IGVsLmdldEF0dHJpYnV0ZShcImFsdFwiKSA/PyB2b2lkIDAsIHByb3BzID0gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICAgIEFycmF5LmZyb20oZWwuYXR0cmlidXRlcykubWFwKChhdHRyKSA9PiBbYXR0ci5uYW1lLCBhdHRyLnZhbHVlXSlcbiAgICAgICAgKSwgaW1hZ2UgPSBvcHRpb25zLm1hdGNoZXJzPy5pbWFnZT8uKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgICBrZXlHZW5lcmF0b3I6IG9wdGlvbnMua2V5R2VuZXJhdG9yID8/IGtleUdlbmVyYXRvclxuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgIC4uLnByb3BzLFxuICAgICAgICAgICAgLi4uc3JjID8geyBzcmMgfSA6IHt9LFxuICAgICAgICAgICAgLi4uYWx0ID8geyBhbHQgfSA6IHt9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGltYWdlKVxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfdHlwZTogXCJfX2Jsb2NrXCIsXG4gICAgICAgICAgICBibG9jazogaW1hZ2VcbiAgICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gSW1hZ2UgcnVsZSAtIGhhbmRsZXMgV29yZCBPbmxpbmUgaW1hZ2VzIHdyYXBwZWQgaW4gV0FDSW1hZ2VDb250YWluZXJcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCkge1xuICAgICAgICBpZiAoIWlzRWxlbWVudChlbCkpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjbGFzc05hbWVSYXcgPSBlbC5jbGFzc05hbWU7XG4gICAgICAgIGxldCBjbGFzc05hbWUgPSBcIlwiO1xuICAgICAgICBpZiAodHlwZW9mIGNsYXNzTmFtZVJhdyA9PSBcInN0cmluZ1wiID8gY2xhc3NOYW1lID0gY2xhc3NOYW1lUmF3IDogY2xhc3NOYW1lUmF3ICYmIHR5cGVvZiBjbGFzc05hbWVSYXcgPT0gXCJvYmplY3RcIiAmJiAoY2xhc3NOYW1lID0gY2xhc3NOYW1lUmF3LmJhc2VWYWwgfHwgXCJcIiksICFjbGFzc05hbWUuaW5jbHVkZXMoXCJXQUNJbWFnZUNvbnRhaW5lclwiKSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGltZyA9IGVsLnF1ZXJ5U2VsZWN0b3IoXCJpbWdcIik7XG4gICAgICAgIGlmICghaW1nKVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3Qgc3JjID0gaW1nLmdldEF0dHJpYnV0ZShcInNyY1wiKSA/PyB2b2lkIDAsIGFsdCA9IGltZy5nZXRBdHRyaWJ1dGUoXCJhbHRcIikgPz8gdm9pZCAwLCBwcm9wcyA9IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgICBBcnJheS5mcm9tKGltZy5hdHRyaWJ1dGVzKS5tYXAoKGF0dHIpID0+IFthdHRyLm5hbWUsIGF0dHIudmFsdWVdKVxuICAgICAgICApLCBpc0luc2lkZUxpc3RJdGVtID0gZWwuY2xvc2VzdChcImxpXCIpICE9PSBudWxsO1xuICAgICAgICBpZiAoZWwuY2xvc2VzdChcInBcIikgPT09IG51bGwgfHwgaXNJbnNpZGVMaXN0SXRlbSkge1xuICAgICAgICAgIGNvbnN0IGlubGluZUltYWdlID0gb3B0aW9ucy5tYXRjaGVycz8uaW5saW5lSW1hZ2U/Lih7XG4gICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgIHNjaGVtYSxcbiAgICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBvcHRpb25zLmtleUdlbmVyYXRvciA/PyBrZXlHZW5lcmF0b3JcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgICAgLi4uc3JjID8geyBzcmMgfSA6IHt9LFxuICAgICAgICAgICAgICAuLi5hbHQgPyB7IGFsdCB9IDoge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoaW5saW5lSW1hZ2UpXG4gICAgICAgICAgICByZXR1cm4gaW5saW5lSW1hZ2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW1hZ2UgPSBvcHRpb25zLm1hdGNoZXJzPy5pbWFnZT8uKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgICBrZXlHZW5lcmF0b3I6IG9wdGlvbnMua2V5R2VuZXJhdG9yID8/IGtleUdlbmVyYXRvclxuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgIC4uLnByb3BzLFxuICAgICAgICAgICAgLi4uc3JjID8geyBzcmMgfSA6IHt9LFxuICAgICAgICAgICAgLi4uYWx0ID8geyBhbHQgfSA6IHt9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGltYWdlKVxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfdHlwZTogXCJfX2Jsb2NrXCIsXG4gICAgICAgICAgICBibG9jazogaW1hZ2VcbiAgICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gTGlzdCBpdGVtIHJ1bGUgLSBoYW5kbGVzIDxsaT4gZWxlbWVudHMgd2l0aCBhcmlhLWxldmVsXG4gICAge1xuICAgICAgZGVzZXJpYWxpemUoZWwsIG5leHQpIHtcbiAgICAgICAgaWYgKCFpc0VsZW1lbnQoZWwpIHx8IHRhZ05hbWUoZWwpICE9PSBcImxpXCIpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBhcmlhTGV2ZWwgPSBlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWFyaWEtbGV2ZWxcIik7XG4gICAgICAgIGlmICghYXJpYUxldmVsKVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbGlzdEl0ZW0gPSB0YWdOYW1lKGVsLnBhcmVudE5vZGUpID09PSBcIm9sXCIgPyBcIm51bWJlclwiIDogXCJidWxsZXRcIjtcbiAgICAgICAgbGV0IGNoaWxkTm9kZXNUb1Byb2Nlc3MgPSBlbC5jaGlsZE5vZGVzLCBibG9ja1N0eWxlID0gXCJub3JtYWxcIjtcbiAgICAgICAgaWYgKGVsLmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICYmIGVsLmZpcnN0Q2hpbGQgJiYgaXNFbGVtZW50KGVsLmZpcnN0Q2hpbGQpKSB7XG4gICAgICAgICAgY29uc3QgY2hpbGRUYWcgPSB0YWdOYW1lKGVsLmZpcnN0Q2hpbGQpO1xuICAgICAgICAgIGlmIChjaGlsZFRhZyAmJiAoSFRNTF9CTE9DS19UQUdTW2NoaWxkVGFnXSB8fCBIVE1MX0hFQURFUl9UQUdTW2NoaWxkVGFnXSB8fCBjaGlsZFRhZyA9PT0gXCJ3b3JkLW9ubGluZS1ibG9ja1wiKSkge1xuICAgICAgICAgICAgaWYgKGNoaWxkVGFnID09PSBcIndvcmQtb25saW5lLWJsb2NrXCIpIHtcbiAgICAgICAgICAgICAgY29uc3QgcGFyYVN0eWxlID0gZWwuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXBhcmFzdHlsZVwiKSwgZm91bmRCbG9ja1N0eWxlID0gcGFyYVN0eWxlID8gbWFwUGFyYVN0eWxlVG9CbG9ja1N0eWxlKHNjaGVtYSwgcGFyYVN0eWxlKSA6IHZvaWQgMDtcbiAgICAgICAgICAgICAgZm91bmRCbG9ja1N0eWxlICYmIChibG9ja1N0eWxlID0gZm91bmRCbG9ja1N0eWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNoaWxkTm9kZXNUb1Byb2Nlc3MgPSBlbC5maXJzdENoaWxkLmNoaWxkTm9kZXM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gbmV4dChjaGlsZE5vZGVzVG9Qcm9jZXNzKTtcbiAgICAgICAgbGV0IGNoaWxkQXJyYXkgPSBBcnJheS5pc0FycmF5KGNoaWxkcmVuKSA/IGNoaWxkcmVuIDogW2NoaWxkcmVuXS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgIGZvciAoOyBjaGlsZEFycmF5Lmxlbmd0aCA+IDA7ICkge1xuICAgICAgICAgIGNvbnN0IGxhc3RDaGlsZCA9IGNoaWxkQXJyYXlbY2hpbGRBcnJheS5sZW5ndGggLSAxXTtcbiAgICAgICAgICBpZiAobGFzdENoaWxkICYmIHR5cGVvZiBsYXN0Q2hpbGQgPT0gXCJvYmplY3RcIiAmJiBcInRleHRcIiBpbiBsYXN0Q2hpbGQpIHtcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBsYXN0Q2hpbGQudGV4dC50cmltRW5kKCk7XG4gICAgICAgICAgICBpZiAodGV4dCA9PT0gXCJcIilcbiAgICAgICAgICAgICAgY2hpbGRBcnJheSA9IGNoaWxkQXJyYXkuc2xpY2UoMCwgLTEpO1xuICAgICAgICAgICAgZWxzZSBpZiAodGV4dCAhPT0gbGFzdENoaWxkLnRleHQpIHtcbiAgICAgICAgICAgICAgbGFzdENoaWxkLnRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgX3R5cGU6IHNjaGVtYS5ibG9jay5uYW1lLFxuICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZEFycmF5LFxuICAgICAgICAgIG1hcmtEZWZzOiBbXSxcbiAgICAgICAgICBzdHlsZTogYmxvY2tTdHlsZSxcbiAgICAgICAgICBsaXN0SXRlbSxcbiAgICAgICAgICBsZXZlbDogcGFyc2VJbnQoYXJpYUxldmVsLCAxMClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIEJsb2NrIHN0eWxlIHJ1bGUgLSBoYW5kbGVzIHBhcmFncmFwaCBzdHlsZXMgbGlrZSBRdW90ZVxuICAgIC8vIFRoZSBwcmVwcm9jZXNzb3Igd3JhcHMgZ3JvdXBlZCBOb3JtYWxUZXh0UnVuIHNwYW5zIGluIGEgd29yZC1vbmxpbmUtYmxvY2sgZWxlbWVudFxuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsLCBuZXh0KSB7XG4gICAgICAgIGlmICghaXNFbGVtZW50KGVsKSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHBhcmFTdHlsZSA9IGVsLmdldEF0dHJpYnV0ZShcImRhdGEtcGFyYXN0eWxlXCIpLCBibG9ja1N0eWxlID0gcGFyYVN0eWxlID8gbWFwUGFyYVN0eWxlVG9CbG9ja1N0eWxlKHNjaGVtYSwgcGFyYVN0eWxlKSA6IHZvaWQgMDtcbiAgICAgICAgaWYgKCFibG9ja1N0eWxlKVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBuZXh0KGVsLmNoaWxkTm9kZXMpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIF90eXBlOiBzY2hlbWEuYmxvY2submFtZSxcbiAgICAgICAgICBzdHlsZTogYmxvY2tTdHlsZSxcbiAgICAgICAgICBtYXJrRGVmczogW10sXG4gICAgICAgICAgY2hpbGRyZW46IEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pID8gY2hpbGRyZW4gOiBjaGlsZHJlbiA/IFtjaGlsZHJlbl0gOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gVGV4dFJ1biBydWxlXG4gICAge1xuICAgICAgZGVzZXJpYWxpemUoZWwpIHtcbiAgICAgICAgaWYgKGlzV29yZE9ubGluZVRleHRSdW4oZWwpKSB7XG4gICAgICAgICAgaWYgKCFpc0VsZW1lbnQoZWwpIHx8ICFlbC50ZXh0Q29udGVudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICBjb25zdCB0ZXh0ID0gQXJyYXkuZnJvbShlbC5jaGlsZE5vZGVzKS5maWx0ZXIoXG4gICAgICAgICAgICAobm9kZSkgPT4gaXNOb3JtYWxUZXh0UnVuKG5vZGUpIHx8IGlzRmluZEhpdChub2RlKVxuICAgICAgICAgICkubWFwKChzcGFuMikgPT4gaXNFbGVtZW50KHNwYW4yKSA/IHNwYW4yLnRleHRDb250ZW50ID8/IFwiXCIgOiBcIlwiKS5qb2luKFwiXCIpO1xuICAgICAgICAgIGlmICghdGV4dClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICBjb25zdCBzcGFuID0ge1xuICAgICAgICAgICAgLi4uREVGQVVMVF9TUEFOLFxuICAgICAgICAgICAgbWFya3M6IFtdLFxuICAgICAgICAgICAgdGV4dFxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKGhhc1N0cm9uZ0Zvcm1hdHRpbmcoZWwpICYmIHNwYW4ubWFya3MucHVzaChcInN0cm9uZ1wiKSwgaGFzRW1waGFzaXNGb3JtYXR0aW5nKGVsKSAmJiAhaXNJbkhlYWRpbmcoZWwpICYmICFpc0luQmxvY2txdW90ZShlbCkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwiZW1cIiksIGhhc1VuZGVybGluZUZvcm1hdHRpbmcoZWwpKVxuICAgICAgICAgICAgaWYgKGlzRWxlbWVudChlbCkgJiYgZWwucGFyZW50RWxlbWVudCAmJiB0YWdOYW1lKGVsLnBhcmVudEVsZW1lbnQpID09PSBcImFcIikge1xuICAgICAgICAgICAgICBjb25zdCBsaW5rRWxlbWVudCA9IGVsLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAgIGlmIChsaW5rRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZTaWJsaW5nID0gbGlua0VsZW1lbnQucHJldmlvdXNTaWJsaW5nLCBuZXh0U2libGluZyA9IGxpbmtFbGVtZW50Lm5leHRTaWJsaW5nLCBoYXNQcmV2VW5kZXJsaW5lID0gcHJldlNpYmxpbmcgJiYgaXNFbGVtZW50KHByZXZTaWJsaW5nKSAmJiBoYXNVbmRlcmxpbmVGb3JtYXR0aW5nKHByZXZTaWJsaW5nKSwgaGFzTmV4dFVuZGVybGluZSA9IG5leHRTaWJsaW5nICYmIGlzRWxlbWVudChuZXh0U2libGluZykgJiYgaGFzVW5kZXJsaW5lRm9ybWF0dGluZyhuZXh0U2libGluZyk7XG4gICAgICAgICAgICAgICAgKGhhc1ByZXZVbmRlcmxpbmUgfHwgaGFzTmV4dFVuZGVybGluZSkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwidW5kZXJsaW5lXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgc3Bhbi5tYXJrcy5wdXNoKFwidW5kZXJsaW5lXCIpO1xuICAgICAgICAgIHJldHVybiBoYXNTdHJpa2V0aHJvdWdoRm9ybWF0dGluZyhlbCkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwic3RyaWtlLXRocm91Z2hcIiksIHNwYW47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIF07XG59XG5jb25zdCBMSVNUX0NPTlRBSU5FUl9UQUdTID0gT2JqZWN0LmtleXMoSFRNTF9MSVNUX0NPTlRBSU5FUl9UQUdTKTtcbmZ1bmN0aW9uIGlzRW1waGFzaXMkMShlbCkge1xuICBjb25zdCBzdHlsZSA9IGlzRWxlbWVudChlbCkgJiYgZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gIHJldHVybiAvZm9udC1zdHlsZVxccyo6XFxzKml0YWxpYy8udGVzdChzdHlsZSB8fCBcIlwiKTtcbn1cbmZ1bmN0aW9uIGlzU3Ryb25nJDEoZWwpIHtcbiAgY29uc3Qgc3R5bGUgPSBpc0VsZW1lbnQoZWwpICYmIGVsLmdldEF0dHJpYnV0ZShcInN0eWxlXCIpO1xuICByZXR1cm4gL2ZvbnQtd2VpZ2h0XFxzKjpcXHMqNzAwLy50ZXN0KHN0eWxlIHx8IFwiXCIpO1xufVxuZnVuY3Rpb24gaXNVbmRlcmxpbmUkMShlbCkge1xuICBpZiAoIWlzRWxlbWVudChlbCkgfHwgdGFnTmFtZShlbC5wYXJlbnROb2RlKSA9PT0gXCJhXCIpXG4gICAgcmV0dXJuICExO1xuICBjb25zdCBzdHlsZSA9IGlzRWxlbWVudChlbCkgJiYgZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gIHJldHVybiAvdGV4dC1kZWNvcmF0aW9uXFxzKjpcXHMqdW5kZXJsaW5lLy50ZXN0KHN0eWxlIHx8IFwiXCIpO1xufVxuZnVuY3Rpb24gaXNTdHJpa2V0aHJvdWdoKGVsKSB7XG4gIGNvbnN0IHN0eWxlID0gaXNFbGVtZW50KGVsKSAmJiBlbC5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcbiAgcmV0dXJuIC90ZXh0LWRlY29yYXRpb25cXHMqOlxccyooPzouKmxpbmUtdGhyb3VnaC4qOykvLnRlc3Qoc3R5bGUgfHwgXCJcIik7XG59XG5mdW5jdGlvbiBpc0dvb2dsZURvY3MoZWwpIHtcbiAgcmV0dXJuIGlzRWxlbWVudChlbCkgJiYgISFlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlzLWdvb2dsZS1kb2NzXCIpO1xufVxuZnVuY3Rpb24gaXNSb290Tm9kZShlbCkge1xuICByZXR1cm4gaXNFbGVtZW50KGVsKSAmJiAhIWVsLmdldEF0dHJpYnV0ZShcImRhdGEtaXMtcm9vdC1ub2RlXCIpO1xufVxuZnVuY3Rpb24gZ2V0TGlzdEl0ZW1TdHlsZSQxKGVsKSB7XG4gIGNvbnN0IHBhcmVudFRhZyA9IHRhZ05hbWUoZWwucGFyZW50Tm9kZSk7XG4gIGlmICghKHBhcmVudFRhZyAmJiAhTElTVF9DT05UQUlORVJfVEFHUy5pbmNsdWRlcyhwYXJlbnRUYWcpKSlcbiAgICByZXR1cm4gdGFnTmFtZShlbC5wYXJlbnROb2RlKSA9PT0gXCJ1bFwiID8gXCJidWxsZXRcIiA6IFwibnVtYmVyXCI7XG59XG5mdW5jdGlvbiBnZXRMaXN0SXRlbUxldmVsJDEoZWwpIHtcbiAgbGV0IGxldmVsID0gMDtcbiAgaWYgKHRhZ05hbWUoZWwpID09PSBcImxpXCIpIHtcbiAgICBsZXQgcGFyZW50Tm9kZSA9IGVsLnBhcmVudE5vZGU7XG4gICAgZm9yICg7IHBhcmVudE5vZGU7ICkge1xuICAgICAgY29uc3QgcGFyZW50VGFnID0gdGFnTmFtZShwYXJlbnROb2RlKTtcbiAgICAgIHBhcmVudFRhZyAmJiBMSVNUX0NPTlRBSU5FUl9UQUdTLmluY2x1ZGVzKHBhcmVudFRhZykgJiYgbGV2ZWwrKywgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICB9XG4gIH0gZWxzZVxuICAgIGxldmVsID0gMTtcbiAgcmV0dXJuIGxldmVsO1xufVxuY29uc3QgYmxvY2tzID0ge1xuICAuLi5IVE1MX0JMT0NLX1RBR1MsXG4gIC4uLkhUTUxfSEVBREVSX1RBR1Ncbn07XG5mdW5jdGlvbiBnZXRCbG9ja1N0eWxlKHNjaGVtYSwgZWwpIHtcbiAgY29uc3QgY2hpbGRUYWcgPSB0YWdOYW1lKGVsLmZpcnN0Q2hpbGQpLCBibG9jayA9IGNoaWxkVGFnICYmIGJsb2Nrc1tjaGlsZFRhZ107XG4gIHJldHVybiBibG9jayA/IHNjaGVtYS5zdHlsZXMuc29tZSgoc3R5bGUpID0+IHN0eWxlLm5hbWUgPT09IGJsb2NrLnN0eWxlKSA/IGJsb2NrLnN0eWxlIDogQkxPQ0tfREVGQVVMVF9TVFlMRSA6IEJMT0NLX0RFRkFVTFRfU1RZTEU7XG59XG5mdW5jdGlvbiBjcmVhdGVHRG9jc1J1bGVzKHNjaGVtYSkge1xuICByZXR1cm4gW1xuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsLCBuZXh0KSB7XG4gICAgICAgIGlmIChpc0VsZW1lbnQoZWwpICYmIHRhZ05hbWUoZWwpID09PSBcInNwYW5cIiAmJiBpc0dvb2dsZURvY3MoZWwpKSB7XG4gICAgICAgICAgaWYgKCFlbC50ZXh0Q29udGVudClcbiAgICAgICAgICAgIHJldHVybiAhZWwucHJldmlvdXNTaWJsaW5nICYmICFlbC5uZXh0U2libGluZyAmJiBlbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWxvbmVseS1jaGlsZFwiLCBcInRydWVcIiksIG5leHQoZWwuY2hpbGROb2Rlcyk7XG4gICAgICAgICAgY29uc3Qgc3BhbiA9IHtcbiAgICAgICAgICAgIC4uLkRFRkFVTFRfU1BBTixcbiAgICAgICAgICAgIG1hcmtzOiBbXSxcbiAgICAgICAgICAgIHRleHQ6IGVsLnRleHRDb250ZW50XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gaXNTdHJvbmckMShlbCkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwic3Ryb25nXCIpLCBpc1VuZGVybGluZSQxKGVsKSAmJiBzcGFuLm1hcmtzLnB1c2goXCJ1bmRlcmxpbmVcIiksIGlzU3RyaWtldGhyb3VnaChlbCkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwic3RyaWtlLXRocm91Z2hcIiksIGlzRW1waGFzaXMkMShlbCkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwiZW1cIiksIHNwYW47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsLCBuZXh0KSB7XG4gICAgICAgIGlmICh0YWdOYW1lKGVsKSA9PT0gXCJsaVwiICYmIGlzR29vZ2xlRG9jcyhlbCkpXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLkRFRkFVTFRfQkxPQ0ssXG4gICAgICAgICAgICBsaXN0SXRlbTogZ2V0TGlzdEl0ZW1TdHlsZSQxKGVsKSxcbiAgICAgICAgICAgIGxldmVsOiBnZXRMaXN0SXRlbUxldmVsJDEoZWwpLFxuICAgICAgICAgICAgc3R5bGU6IGdldEJsb2NrU3R5bGUoc2NoZW1hLCBlbCksXG4gICAgICAgICAgICBjaGlsZHJlbjogbmV4dChlbC5maXJzdENoaWxkPy5jaGlsZE5vZGVzIHx8IFtdKVxuICAgICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCkge1xuICAgICAgICBpZiAodGFnTmFtZShlbCkgPT09IFwiYnJcIiAmJiBpc0dvb2dsZURvY3MoZWwpICYmIGlzRWxlbWVudChlbCkgJiYgZWwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYXBwbGUtaW50ZXJjaGFuZ2UtbmV3bGluZVwiKSlcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uREVGQVVMVF9TUEFOLFxuICAgICAgICAgICAgdGV4dDogXCJcIlxuICAgICAgICAgIH07XG4gICAgICAgIGlmICh0YWdOYW1lKGVsKSA9PT0gXCJiclwiICYmIGlzR29vZ2xlRG9jcyhlbCkgJiYgaXNFbGVtZW50KGVsKSAmJiBlbD8ucGFyZW50Tm9kZT8udGV4dENvbnRlbnQgPT09IFwiXCIpXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLkRFRkFVTFRfU1BBTixcbiAgICAgICAgICAgIHRleHQ6IFwiXCJcbiAgICAgICAgICB9O1xuICAgICAgICBpZiAodGFnTmFtZShlbCkgPT09IFwiYnJcIiAmJiBpc0dvb2dsZURvY3MoZWwpICYmIGlzRWxlbWVudChlbCkgJiYgaXNSb290Tm9kZShlbCkpXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLkRFRkFVTFRfU1BBTixcbiAgICAgICAgICAgIHRleHQ6IFwiXCJcbiAgICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgXTtcbn1cbmNvbnN0IHdoaXRlc3BhY2VUZXh0Tm9kZVJ1bGUgPSB7XG4gIGRlc2VyaWFsaXplKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5ub2RlTmFtZSA9PT0gXCIjdGV4dFwiICYmIGlzV2hpdGVzcGFjZVRleHROb2RlKG5vZGUpID8ge1xuICAgICAgLi4uREVGQVVMVF9TUEFOLFxuICAgICAgbWFya3M6IFtdLFxuICAgICAgdGV4dDogKG5vZGUudGV4dENvbnRlbnQgPz8gXCJcIikucmVwbGFjZSgvXFxzXFxzKy9nLCBcIiBcIilcbiAgICB9IDogdm9pZCAwO1xuICB9XG59O1xuZnVuY3Rpb24gaXNXaGl0ZXNwYWNlVGV4dE5vZGUobm9kZSkge1xuICByZXR1cm4gKG5vZGUubm9kZVR5cGUgPT09IDMgJiYgKG5vZGUudGV4dENvbnRlbnQgfHwgXCJcIikucmVwbGFjZSgvW1xcclxcbl0vZywgXCIgXCIpLnJlcGxhY2UoL1xcc1xccysvZywgXCIgXCIpID09PSBcIiBcIiAmJiBub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgIT09IDMgJiYgbm9kZS5wcmV2aW91c1NpYmxpbmcgJiYgbm9kZS5wcmV2aW91c1NpYmxpbmcubm9kZVR5cGUgIT09IDMgfHwgbm9kZS50ZXh0Q29udGVudCAhPT0gXCIgXCIpICYmIHRhZ05hbWUobm9kZS5wYXJlbnROb2RlKSAhPT0gXCJib2R5XCI7XG59XG5mdW5jdGlvbiByZXNvbHZlTGlzdEl0ZW0oc2NoZW1hLCBsaXN0Tm9kZVRhZ05hbWUpIHtcbiAgaWYgKGxpc3ROb2RlVGFnTmFtZSA9PT0gXCJ1bFwiICYmIHNjaGVtYS5saXN0cy5zb21lKChsaXN0KSA9PiBsaXN0Lm5hbWUgPT09IFwiYnVsbGV0XCIpKVxuICAgIHJldHVybiBcImJ1bGxldFwiO1xuICBpZiAobGlzdE5vZGVUYWdOYW1lID09PSBcIm9sXCIgJiYgc2NoZW1hLmxpc3RzLnNvbWUoKGxpc3QpID0+IGxpc3QubmFtZSA9PT0gXCJudW1iZXJcIikpXG4gICAgcmV0dXJuIFwibnVtYmVyXCI7XG59XG5mdW5jdGlvbiBjcmVhdGVIVE1MUnVsZXMoc2NoZW1hLCBvcHRpb25zKSB7XG4gIHJldHVybiBbXG4gICAgd2hpdGVzcGFjZVRleHROb2RlUnVsZSxcbiAgICB7XG4gICAgICAvLyBQcmUgZWxlbWVudFxuICAgICAgZGVzZXJpYWxpemUoZWwpIHtcbiAgICAgICAgaWYgKHRhZ05hbWUoZWwpICE9PSBcInByZVwiKVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgaXNDb2RlRW5hYmxlZCA9IHNjaGVtYS5zdHlsZXMuc29tZShcbiAgICAgICAgICAoc3R5bGUpID0+IHN0eWxlLm5hbWUgPT09IFwiY29kZVwiXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgX3R5cGU6IFwiYmxvY2tcIixcbiAgICAgICAgICBzdHlsZTogXCJub3JtYWxcIixcbiAgICAgICAgICBtYXJrRGVmczogW10sXG4gICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4uREVGQVVMVF9TUEFOLFxuICAgICAgICAgICAgICBtYXJrczogaXNDb2RlRW5hYmxlZCA/IFtcImNvZGVcIl0gOiBbXSxcbiAgICAgICAgICAgICAgdGV4dDogZWwudGV4dENvbnRlbnQgfHwgXCJcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIEJsb2NrcXVvdGUgZWxlbWVudFxuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsLCBuZXh0KSB7XG4gICAgICAgIGlmICh0YWdOYW1lKGVsKSAhPT0gXCJibG9ja3F1b3RlXCIpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBibG9ja3MyID0ge1xuICAgICAgICAgIC4uLkhUTUxfQkxPQ0tfVEFHUyxcbiAgICAgICAgICAuLi5IVE1MX0hFQURFUl9UQUdTXG4gICAgICAgIH07XG4gICAgICAgIGRlbGV0ZSBibG9ja3MyLmJsb2NrcXVvdGU7XG4gICAgICAgIGNvbnN0IG5vbkJsb2NrcXVvdGVCbG9ja3MgPSBPYmplY3Qua2V5cyhibG9ja3MyKSwgY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgcmV0dXJuIGVsLmNoaWxkTm9kZXMuZm9yRWFjaCgobm9kZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBpZiAoZWwub3duZXJEb2N1bWVudClcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIG5vbkJsb2NrcXVvdGVCbG9ja3MuaW5jbHVkZXMoXG4gICAgICAgICAgICAgIG5vZGUubG9jYWxOYW1lLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgY29uc3Qgc3BhbiA9IGVsLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksIHByZXZpb3VzQ2hpbGQgPSBjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgcHJldmlvdXNDaGlsZCAmJiBwcmV2aW91c0NoaWxkLm5vZGVUeXBlID09PSAzICYmIHByZXZpb3VzQ2hpbGQudGV4dENvbnRlbnQ/LnRyaW0oKSAmJiBzcGFuLmFwcGVuZENoaWxkKGVsLm93bmVyRG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcXHJcIikpLCBub2RlLmNoaWxkTm9kZXMuZm9yRWFjaCgoY24pID0+IHtcbiAgICAgICAgICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGNuLmNsb25lTm9kZSghMCkpO1xuICAgICAgICAgICAgICB9KSwgaW5kZXggIT09IGVsLmNoaWxkTm9kZXMubGVuZ3RoICYmIHNwYW4uYXBwZW5kQ2hpbGQoZWwub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIlxcclwiKSksIGNoaWxkcmVuLnB1c2goc3Bhbik7XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgICAgfSksIHtcbiAgICAgICAgICBfdHlwZTogXCJibG9ja1wiLFxuICAgICAgICAgIHN0eWxlOiBcImJsb2NrcXVvdGVcIixcbiAgICAgICAgICBtYXJrRGVmczogW10sXG4gICAgICAgICAgY2hpbGRyZW46IG5leHQoY2hpbGRyZW4pXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBCbG9jayBlbGVtZW50c1xuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsLCBuZXh0KSB7XG4gICAgICAgIGNvbnN0IGJsb2NrczIgPSB7XG4gICAgICAgICAgLi4uSFRNTF9CTE9DS19UQUdTLFxuICAgICAgICAgIC4uLkhUTUxfSEVBREVSX1RBR1NcbiAgICAgICAgfSwgdGFnID0gdGFnTmFtZShlbCk7XG4gICAgICAgIGxldCBibG9jayA9IHRhZyA/IGJsb2NrczJbdGFnXSA6IHZvaWQgMDtcbiAgICAgICAgaWYgKCFibG9jaylcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChlbC5wYXJlbnROb2RlICYmIHRhZ05hbWUoZWwucGFyZW50Tm9kZSkgPT09IFwibGlcIilcbiAgICAgICAgICByZXR1cm4gbmV4dChlbC5jaGlsZE5vZGVzKTtcbiAgICAgICAgY29uc3QgYmxvY2tTdHlsZSA9IGJsb2NrLnN0eWxlO1xuICAgICAgICByZXR1cm4gc2NoZW1hLnN0eWxlcy5zb21lKChzdHlsZSkgPT4gc3R5bGUubmFtZSA9PT0gYmxvY2tTdHlsZSkgfHwgKGJsb2NrID0gREVGQVVMVF9CTE9DSyksIHtcbiAgICAgICAgICAuLi5ibG9jayxcbiAgICAgICAgICBjaGlsZHJlbjogbmV4dChlbC5jaGlsZE5vZGVzKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gSWdub3JlIHNwYW4gdGFnc1xuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsLCBuZXh0KSB7XG4gICAgICAgIGNvbnN0IHRhZyA9IHRhZ05hbWUoZWwpO1xuICAgICAgICBpZiAoISghdGFnIHx8ICEodGFnIGluIEhUTUxfU1BBTl9UQUdTKSkpXG4gICAgICAgICAgcmV0dXJuIG5leHQoZWwuY2hpbGROb2Rlcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBJZ25vcmUgZGl2IHRhZ3NcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCwgbmV4dCkge1xuICAgICAgICBpZiAodGFnTmFtZShlbCkgPT09IFwiZGl2XCIpXG4gICAgICAgICAgcmV0dXJuIG5leHQoZWwuY2hpbGROb2Rlcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBJZ25vcmUgbGlzdCBjb250YWluZXJzXG4gICAge1xuICAgICAgZGVzZXJpYWxpemUoZWwsIG5leHQpIHtcbiAgICAgICAgY29uc3QgdGFnID0gdGFnTmFtZShlbCk7XG4gICAgICAgIGlmICghKCF0YWcgfHwgISh0YWcgaW4gSFRNTF9MSVNUX0NPTlRBSU5FUl9UQUdTKSkpXG4gICAgICAgICAgcmV0dXJuIG5leHQoZWwuY2hpbGROb2Rlcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBEZWFsIHdpdGggYnInc1xuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsKSB7XG4gICAgICAgIGlmICh0YWdOYW1lKGVsKSA9PT0gXCJiclwiKVxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5ERUZBVUxUX1NQQU4sXG4gICAgICAgICAgICB0ZXh0OiBgXG5gXG4gICAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIERlYWwgd2l0aCBsaXN0IGl0ZW1zXG4gICAge1xuICAgICAgZGVzZXJpYWxpemUoZWwsIG5leHQsIGJsb2NrKSB7XG4gICAgICAgIGNvbnN0IHRhZyA9IHRhZ05hbWUoZWwpLCBsaXN0SXRlbSA9IHRhZyA/IEhUTUxfTElTVF9JVEVNX1RBR1NbdGFnXSA6IHZvaWQgMCwgcGFyZW50VGFnID0gdGFnTmFtZShlbC5wYXJlbnROb2RlKSB8fCBcIlwiO1xuICAgICAgICBpZiAoIWxpc3RJdGVtIHx8ICFlbC5wYXJlbnROb2RlIHx8ICFIVE1MX0xJU1RfQ09OVEFJTkVSX1RBR1NbcGFyZW50VGFnXSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGVuYWJsZWRMaXN0SXRlbSA9IHJlc29sdmVMaXN0SXRlbShzY2hlbWEsIHBhcmVudFRhZyk7XG4gICAgICAgIHJldHVybiBlbmFibGVkTGlzdEl0ZW0gPyAobGlzdEl0ZW0ubGlzdEl0ZW0gPSBlbmFibGVkTGlzdEl0ZW0sIHtcbiAgICAgICAgICAuLi5saXN0SXRlbSxcbiAgICAgICAgICBjaGlsZHJlbjogbmV4dChlbC5jaGlsZE5vZGVzKVxuICAgICAgICB9KSA6IGJsb2NrKHsgX3R5cGU6IFwiYmxvY2tcIiwgY2hpbGRyZW46IG5leHQoZWwuY2hpbGROb2RlcykgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBEZWFsIHdpdGggZGVjb3JhdG9ycyAtIHRoaXMgaXMgYSBsaW1pdGVkIHNldCBvZiBrbm93biBodG1sIGVsZW1lbnRzIHRoYXQgd2Uga25vdyBob3cgdG8gZGVzZXJpYWxpemVcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCwgbmV4dCkge1xuICAgICAgICBjb25zdCBkZWNvcmF0b3IgPSBIVE1MX0RFQ09SQVRPUl9UQUdTW3RhZ05hbWUoZWwpIHx8IFwiXCJdO1xuICAgICAgICBpZiAoISghZGVjb3JhdG9yIHx8ICFzY2hlbWEuZGVjb3JhdG9ycy5zb21lKFxuICAgICAgICAgIChkZWNvcmF0b3JUeXBlKSA9PiBkZWNvcmF0b3JUeXBlLm5hbWUgPT09IGRlY29yYXRvclxuICAgICAgICApKSlcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgX3R5cGU6IFwiX19kZWNvcmF0b3JcIixcbiAgICAgICAgICAgIG5hbWU6IGRlY29yYXRvcixcbiAgICAgICAgICAgIGNoaWxkcmVuOiBuZXh0KGVsLmNoaWxkTm9kZXMpXG4gICAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgaHlwZXJsaW5rcywgYWRkIGFubm90YXRpb24gKGlmIGFsbG93ZWQgYnkgc2NoZW1hKSxcbiAgICAvLyBJZiBub3Qgc3VwcG9ydGVkIGp1c3Qgd3JpdGUgb3V0IHRoZSBsaW5rIHRleHQgYW5kIGhyZWYgaW4gcGxhaW4gdGV4dC5cbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCwgbmV4dCkge1xuICAgICAgICBpZiAodGFnTmFtZShlbCkgIT09IFwiYVwiKVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbGlua0VuYWJsZWQgPSBzY2hlbWEuYW5ub3RhdGlvbnMuc29tZShcbiAgICAgICAgICAoYW5ub3RhdGlvbikgPT4gYW5ub3RhdGlvbi5uYW1lID09PSBcImxpbmtcIlxuICAgICAgICApLCBocmVmID0gaXNFbGVtZW50KGVsKSAmJiBlbC5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpO1xuICAgICAgICByZXR1cm4gaHJlZiA/IGxpbmtFbmFibGVkID8ge1xuICAgICAgICAgIF90eXBlOiBcIl9fYW5ub3RhdGlvblwiLFxuICAgICAgICAgIG1hcmtEZWY6IHtcbiAgICAgICAgICAgIF9rZXk6IG9wdGlvbnMua2V5R2VuZXJhdG9yID8gb3B0aW9ucy5rZXlHZW5lcmF0b3IoKSA6IGtleUdlbmVyYXRvcigpLFxuICAgICAgICAgICAgX3R5cGU6IFwibGlua1wiLFxuICAgICAgICAgICAgaHJlZlxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hpbGRyZW46IG5leHQoZWwuY2hpbGROb2RlcylcbiAgICAgICAgfSA6IGVsLmFwcGVuZENoaWxkKGVsLm93bmVyRG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYCAoJHtocmVmfSlgKSkgJiYgbmV4dChlbC5jaGlsZE5vZGVzKSA6IG5leHQoZWwuY2hpbGROb2Rlcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCwgbmV4dCkge1xuICAgICAgICBpZiAoaXNFbGVtZW50KGVsKSAmJiAodGFnTmFtZShlbCkgPT09IFwidGRcIiB8fCB0YWdOYW1lKGVsKSA9PT0gXCJ0aFwiKSlcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uREVGQVVMVF9CTE9DSyxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBuZXh0KGVsLmNoaWxkTm9kZXMpXG4gICAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGRlc2VyaWFsaXplKGVsKSB7XG4gICAgICAgIGlmIChpc0VsZW1lbnQoZWwpICYmIHRhZ05hbWUoZWwpID09PSBcImltZ1wiKSB7XG4gICAgICAgICAgY29uc3Qgc3JjID0gZWwuZ2V0QXR0cmlidXRlKFwic3JjXCIpID8/IHZvaWQgMCwgYWx0ID0gZWwuZ2V0QXR0cmlidXRlKFwiYWx0XCIpID8/IHZvaWQgMCwgcHJvcHMgPSBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgICAgICBBcnJheS5mcm9tKGVsLmF0dHJpYnV0ZXMpLm1hcCgoYXR0cikgPT4gW2F0dHIubmFtZSwgYXR0ci52YWx1ZV0pXG4gICAgICAgICAgKSwgYW5jZXN0b3JPZkxvbmVseUNoaWxkID0gZWw/LnBhcmVudEVsZW1lbnQ/LnBhcmVudEVsZW1lbnQ/LmdldEF0dHJpYnV0ZShcImRhdGEtbG9uZWx5LWNoaWxkXCIpLCBhbmNlc3Rvck9mTGlzdEl0ZW0gPSBlbC5jbG9zZXN0KFwibGlcIikgIT09IG51bGw7XG4gICAgICAgICAgaWYgKGFuY2VzdG9yT2ZMb25lbHlDaGlsZCAmJiAhYW5jZXN0b3JPZkxpc3RJdGVtKSB7XG4gICAgICAgICAgICBjb25zdCBpbWFnZTIgPSBvcHRpb25zLm1hdGNoZXJzPy5pbWFnZT8uKHtcbiAgICAgICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgICAgIHNjaGVtYSxcbiAgICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IG9wdGlvbnMua2V5R2VuZXJhdG9yID8/IGtleUdlbmVyYXRvclxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAgIC4uLnByb3BzLFxuICAgICAgICAgICAgICAgIC4uLnNyYyA/IHsgc3JjIH0gOiB7fSxcbiAgICAgICAgICAgICAgICAuLi5hbHQgPyB7IGFsdCB9IDoge31cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoaW1hZ2UyKVxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIF90eXBlOiBcIl9fYmxvY2tcIixcbiAgICAgICAgICAgICAgICBibG9jazogaW1hZ2UyXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGlubGluZUltYWdlID0gb3B0aW9ucy5tYXRjaGVycz8uaW5saW5lSW1hZ2U/Lih7XG4gICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgIHNjaGVtYSxcbiAgICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBvcHRpb25zLmtleUdlbmVyYXRvciA/PyBrZXlHZW5lcmF0b3JcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgICAgLi4uc3JjID8geyBzcmMgfSA6IHt9LFxuICAgICAgICAgICAgICAuLi5hbHQgPyB7IGFsdCB9IDoge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoaW5saW5lSW1hZ2UpXG4gICAgICAgICAgICByZXR1cm4gaW5saW5lSW1hZ2U7XG4gICAgICAgICAgY29uc3QgaW1hZ2UgPSBvcHRpb25zLm1hdGNoZXJzPy5pbWFnZT8uKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgc2NoZW1hLFxuICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IG9wdGlvbnMua2V5R2VuZXJhdG9yID8/IGtleUdlbmVyYXRvclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgIC4uLnByb3BzLFxuICAgICAgICAgICAgICAuLi5zcmMgPyB7IHNyYyB9IDoge30sXG4gICAgICAgICAgICAgIC4uLmFsdCA/IHsgYWx0IH0gOiB7fVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmIChpbWFnZSlcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIF90eXBlOiBcIl9fYmxvY2tcIixcbiAgICAgICAgICAgICAgYmxvY2s6IGltYWdlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICBdO1xufVxuZnVuY3Rpb24gaXNFbXBoYXNpcyhlbCkge1xuICBjb25zdCBzdHlsZSA9IGlzRWxlbWVudChlbCkgJiYgZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gIHJldHVybiAvZm9udC1zdHlsZTppdGFsaWMvLnRlc3Qoc3R5bGUgfHwgXCJcIik7XG59XG5mdW5jdGlvbiBpc1N0cm9uZyhlbCkge1xuICBjb25zdCBzdHlsZSA9IGlzRWxlbWVudChlbCkgJiYgZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gIHJldHVybiAvZm9udC13ZWlnaHQ6NzAwLy50ZXN0KHN0eWxlIHx8IFwiXCIpIHx8IC9mb250LXdlaWdodDo2MDAvLnRlc3Qoc3R5bGUgfHwgXCJcIik7XG59XG5mdW5jdGlvbiBpc1VuZGVybGluZShlbCkge1xuICBjb25zdCBzdHlsZSA9IGlzRWxlbWVudChlbCkgJiYgZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gIHJldHVybiAvdGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZS8udGVzdChzdHlsZSB8fCBcIlwiKTtcbn1cbmZ1bmN0aW9uIGlzTm90aW9uKGVsKSB7XG4gIHJldHVybiBpc0VsZW1lbnQoZWwpICYmICEhZWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1pcy1ub3Rpb25cIik7XG59XG5mdW5jdGlvbiBjcmVhdGVOb3Rpb25SdWxlcygpIHtcbiAgcmV0dXJuIFtcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCkge1xuICAgICAgICBpZiAoaXNFbGVtZW50KGVsKSAmJiB0YWdOYW1lKGVsKSA9PT0gXCJzcGFuXCIgJiYgaXNOb3Rpb24oZWwpKSB7XG4gICAgICAgICAgY29uc3Qgc3BhbiA9IHtcbiAgICAgICAgICAgIC4uLkRFRkFVTFRfU1BBTixcbiAgICAgICAgICAgIG1hcmtzOiBbXSxcbiAgICAgICAgICAgIHRleHQ6IGVsLnRleHRDb250ZW50XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gaXNTdHJvbmcoZWwpICYmIHNwYW4ubWFya3MucHVzaChcInN0cm9uZ1wiKSwgaXNVbmRlcmxpbmUoZWwpICYmIHNwYW4ubWFya3MucHVzaChcInVuZGVybGluZVwiKSwgaXNFbXBoYXNpcyhlbCkgJiYgc3Bhbi5tYXJrcy5wdXNoKFwiZW1cIiksIHNwYW47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIF07XG59XG5mdW5jdGlvbiBnZXRMaXN0SXRlbVN0eWxlKGVsKSB7XG4gIGNvbnN0IHN0eWxlID0gaXNFbGVtZW50KGVsKSAmJiBlbC5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcbiAgaWYgKHN0eWxlICYmIHN0eWxlLm1hdGNoKC9sZm9cXGQrLykpXG4gICAgcmV0dXJuIHN0eWxlLm1hdGNoKFwibGZvMVwiKSA/IFwibnVtYmVyXCIgOiBcImJ1bGxldFwiO1xufVxuZnVuY3Rpb24gZ2V0TGlzdEl0ZW1MZXZlbChlbCkge1xuICBjb25zdCBzdHlsZSA9IGlzRWxlbWVudChlbCkgJiYgZWwuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gIGlmICghc3R5bGUpXG4gICAgcmV0dXJuO1xuICBjb25zdCBsZXZlbE1hdGNoID0gc3R5bGUubWF0Y2goL2xldmVsXFxkKy8pO1xuICBpZiAoIWxldmVsTWF0Y2gpXG4gICAgcmV0dXJuO1xuICBjb25zdCBbbGV2ZWxdID0gbGV2ZWxNYXRjaFswXS5tYXRjaCgvXFxkLykgfHwgW107XG4gIHJldHVybiAobGV2ZWwgPyBOdW1iZXIucGFyc2VJbnQobGV2ZWwsIDEwKSA6IDEpIHx8IDE7XG59XG5mdW5jdGlvbiBpc1dvcmRMaXN0RWxlbWVudChlbCkge1xuICBpZiAoIWlzRWxlbWVudChlbCkpXG4gICAgcmV0dXJuICExO1xuICBpZiAoZWwuY2xhc3NOYW1lICYmIChlbC5jbGFzc05hbWUgPT09IFwiTXNvTGlzdFBhcmFncmFwaEN4U3BGaXJzdFwiIHx8IGVsLmNsYXNzTmFtZSA9PT0gXCJNc29MaXN0UGFyYWdyYXBoQ3hTcE1pZGRsZVwiIHx8IGVsLmNsYXNzTmFtZSA9PT0gXCJNc29MaXN0UGFyYWdyYXBoQ3hTcExhc3RcIikpXG4gICAgcmV0dXJuICEwO1xuICBjb25zdCBzdHlsZSA9IGVsLmdldEF0dHJpYnV0ZShcInN0eWxlXCIpO1xuICByZXR1cm4gISEoc3R5bGUgJiYgL21zby1saXN0OlxccypsXFxkK1xccytsZXZlbFxcZCtcXHMrbGZvXFxkKy8udGVzdChzdHlsZSkpO1xufVxuZnVuY3Rpb24gZ2V0SGVhZGluZ1N0eWxlKGVsKSB7XG4gIGNvbnN0IHRhZyA9IHRhZ05hbWUoZWwpO1xuICBpZiAodGFnICYmIEhUTUxfSEVBREVSX1RBR1NbdGFnXSlcbiAgICByZXR1cm4gSFRNTF9IRUFERVJfVEFHU1t0YWddPy5zdHlsZTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVdvcmRSdWxlcygpIHtcbiAgcmV0dXJuIFtcbiAgICB7XG4gICAgICBkZXNlcmlhbGl6ZShlbCwgbmV4dCkge1xuICAgICAgICBjb25zdCB0YWcgPSB0YWdOYW1lKGVsKTtcbiAgICAgICAgaWYgKCh0YWcgPT09IFwicFwiIHx8IEhUTUxfSEVBREVSX1RBR1NbdGFnIHx8IFwiXCJdKSAmJiBpc1dvcmRMaXN0RWxlbWVudChlbCkpIHtcbiAgICAgICAgICBjb25zdCBoZWFkaW5nU3R5bGUgPSBnZXRIZWFkaW5nU3R5bGUoZWwpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5ERUZBVUxUX0JMT0NLLFxuICAgICAgICAgICAgbGlzdEl0ZW06IGdldExpc3RJdGVtU3R5bGUoZWwpLFxuICAgICAgICAgICAgbGV2ZWw6IGdldExpc3RJdGVtTGV2ZWwoZWwpLFxuICAgICAgICAgICAgc3R5bGU6IGhlYWRpbmdTdHlsZSB8fCBCTE9DS19ERUZBVUxUX1NUWUxFLFxuICAgICAgICAgICAgY2hpbGRyZW46IG5leHQoZWwuY2hpbGROb2RlcylcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICBdO1xufVxuZnVuY3Rpb24gY3JlYXRlUnVsZXMoc2NoZW1hLCBvcHRpb25zKSB7XG4gIHJldHVybiBbXG4gICAgLi4uY3JlYXRlV29yZFJ1bGVzKCksXG4gICAgLi4uY3JlYXRlV29yZE9ubGluZVJ1bGVzKHNjaGVtYSwgb3B0aW9ucyksXG4gICAgLi4uY3JlYXRlTm90aW9uUnVsZXMoKSxcbiAgICAuLi5jcmVhdGVHRG9jc1J1bGVzKHNjaGVtYSksXG4gICAgLi4uY3JlYXRlSFRNTFJ1bGVzKHNjaGVtYSwgb3B0aW9ucylcbiAgXTtcbn1cbmZ1bmN0aW9uIHRyaW1XaGl0ZXNwYWNlKGNvbnRleHQsIG1vZGUsIGJsb2NrczIpIHtcbiAgY29uc3QgdHJpbW1lZEJsb2NrcyA9IFtdO1xuICBsZXQgY29uc2VjdXRpdmVFbXB0eUNvdW50ID0gMDtcbiAgZm9yIChjb25zdCBibG9jayBvZiBibG9ja3MyKSB7XG4gICAgY29uc3QgdHJpbW1lZEJsb2NrID0gaXNUZXh0QmxvY2soY29udGV4dCwgYmxvY2spID8gdHJpbVRleHRCbG9ja1doaXRlc3BhY2UoYmxvY2spIDogYmxvY2s7XG4gICAgaWYgKG1vZGUgPT09IFwicHJlc2VydmVcIikge1xuICAgICAgdHJpbW1lZEJsb2Nrcy5wdXNoKHRyaW1tZWRCbG9jayk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKG1vZGUgPT09IFwicmVtb3ZlXCIpIHtcbiAgICAgIGlmIChpc0VtcHR5VGV4dEJsb2NrKGNvbnRleHQsIHRyaW1tZWRCbG9jaykpXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgdHJpbW1lZEJsb2Nrcy5wdXNoKHRyaW1tZWRCbG9jayk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKG1vZGUgPT09IFwibm9ybWFsaXplXCIpIHtcbiAgICAgIGlmIChpc0VtcHR5VGV4dEJsb2NrKGNvbnRleHQsIHRyaW1tZWRCbG9jaykpIHtcbiAgICAgICAgY29uc2VjdXRpdmVFbXB0eUNvdW50KyssIGNvbnNlY3V0aXZlRW1wdHlDb3VudCA9PT0gMSAmJiB0cmltbWVkQmxvY2tzLnB1c2godHJpbW1lZEJsb2NrKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0cmltbWVkQmxvY2tzLnB1c2godHJpbW1lZEJsb2NrKSwgY29uc2VjdXRpdmVFbXB0eUNvdW50ID0gMDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRyaW1tZWRCbG9ja3M7XG59XG5mdW5jdGlvbiBpc0VtcHR5VGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSB7XG4gIHJldHVybiAhKCFpc1RleHRCbG9jayhjb250ZXh0LCBibG9jaykgfHwgYmxvY2suY2hpbGRyZW4uc29tZShcbiAgICAoY2hpbGQpID0+ICFpc1NwYW4oY29udGV4dCwgY2hpbGQpIHx8IGNoaWxkLnRleHQudHJpbSgpICE9PSBcIlwiXG4gICkpO1xufVxuZnVuY3Rpb24gdHJpbVRleHRCbG9ja1doaXRlc3BhY2UoYmxvY2spIHtcbiAgbGV0IGluZGV4ID0gMDtcbiAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbikge1xuICAgIGlmICghaXNNaW5pbWFsU3BhbihjaGlsZCkpIHtcbiAgICAgIGluZGV4Kys7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgbmV4dENoaWxkID0gbmV4dFNwYW4oYmxvY2ssIGluZGV4KSwgcHJldkNoaWxkID0gcHJldlNwYW4oYmxvY2ssIGluZGV4KTtcbiAgICBpbmRleCA9PT0gMCAmJiAoY2hpbGQudGV4dCA9IGNoaWxkLnRleHQucmVwbGFjZSgvXlteXFxTXFxuXSsvZywgXCJcIikpLCBpbmRleCA9PT0gYmxvY2suY2hpbGRyZW4ubGVuZ3RoIC0gMSAmJiAoY2hpbGQudGV4dCA9IGNoaWxkLnRleHQucmVwbGFjZSgvW15cXFNcXG5dKyQvZywgXCJcIikpLCAvXFxzLy50ZXN0KGNoaWxkLnRleHQuc2xpY2UoTWF0aC5tYXgoMCwgY2hpbGQudGV4dC5sZW5ndGggLSAxKSkpICYmIG5leHRDaGlsZCAmJiBpc01pbmltYWxTcGFuKG5leHRDaGlsZCkgJiYgL1xccy8udGVzdChuZXh0Q2hpbGQudGV4dC5zbGljZSgwLCAxKSkgJiYgKGNoaWxkLnRleHQgPSBjaGlsZC50ZXh0LnJlcGxhY2UoL1teXFxTXFxuXSskL2csIFwiXCIpKSwgL1xccy8udGVzdChjaGlsZC50ZXh0LnNsaWNlKDAsIDEpKSAmJiBwcmV2Q2hpbGQgJiYgaXNNaW5pbWFsU3BhbihwcmV2Q2hpbGQpICYmIC9cXHMvLnRlc3QocHJldkNoaWxkLnRleHQuc2xpY2UoTWF0aC5tYXgoMCwgcHJldkNoaWxkLnRleHQubGVuZ3RoIC0gMSkpKSAmJiAoY2hpbGQudGV4dCA9IGNoaWxkLnRleHQucmVwbGFjZSgvXlteXFxTXFxuXSsvZywgXCJcIikpLCBjaGlsZC50ZXh0IHx8IGJsb2NrLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMSksIHByZXZDaGlsZCAmJiBBcnJheS5pc0FycmF5KHByZXZDaGlsZC5tYXJrcykgJiYgaXNFcXVhbE1hcmtzKHByZXZDaGlsZC5tYXJrcywgY2hpbGQubWFya3MpICYmIGlzV2hpdGVTcGFjZUNoYXIoY2hpbGQudGV4dCkgPyAocHJldkNoaWxkLnRleHQgKz0gXCIgXCIsIGJsb2NrLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMSkpIDogbmV4dENoaWxkICYmIEFycmF5LmlzQXJyYXkobmV4dENoaWxkLm1hcmtzKSAmJiBpc0VxdWFsTWFya3MobmV4dENoaWxkLm1hcmtzLCBjaGlsZC5tYXJrcykgJiYgaXNXaGl0ZVNwYWNlQ2hhcihjaGlsZC50ZXh0KSAmJiAobmV4dENoaWxkLnRleHQgPSBgICR7bmV4dENoaWxkLnRleHR9YCwgYmxvY2suY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKSksIGluZGV4Kys7XG4gIH1cbiAgcmV0dXJuIGJsb2NrO1xufVxuZnVuY3Rpb24gbmV4dFNwYW4oYmxvY2ssIGluZGV4KSB7XG4gIGNvbnN0IG5leHQgPSBibG9jay5jaGlsZHJlbltpbmRleCArIDFdO1xuICByZXR1cm4gbmV4dCAmJiBuZXh0Ll90eXBlID09PSBcInNwYW5cIiA/IG5leHQgOiBudWxsO1xufVxuZnVuY3Rpb24gcHJldlNwYW4oYmxvY2ssIGluZGV4KSB7XG4gIGNvbnN0IHByZXYgPSBibG9jay5jaGlsZHJlbltpbmRleCAtIDFdO1xuICByZXR1cm4gcHJldiAmJiBwcmV2Ll90eXBlID09PSBcInNwYW5cIiA/IHByZXYgOiBudWxsO1xufVxuZnVuY3Rpb24gaXNXaGl0ZVNwYWNlQ2hhcih0ZXh0KSB7XG4gIHJldHVybiBbXCJcXHhBMFwiLCBcIiBcIl0uaW5jbHVkZXModGV4dCk7XG59XG5jbGFzcyBIdG1sRGVzZXJpYWxpemVyIHtcbiAga2V5R2VuZXJhdG9yO1xuICBzY2hlbWE7XG4gIHJ1bGVzO1xuICBwYXJzZUh0bWw7XG4gIHdoaXRlc3BhY2VNb2RlO1xuICBfbWFya0RlZnMgPSBbXTtcbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBzZXJpYWxpemVyIHJlc3BlY3RpbmcgYSBTYW5pdHkgYmxvY2sgY29udGVudCB0eXBlJ3Mgc2NoZW1hXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja0NvbnRlbnRUeXBlIC0gU2NoZW1hIHR5cGUgZm9yIGFycmF5IGNvbnRhaW5pbmcgX2F0IGxlYXN0XyBhIGJsb2NrIGNoaWxkIHR5cGVcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25zIGZvciB0aGUgZGVzZXJpYWxpemF0aW9uIHByb2Nlc3NcbiAgICovXG4gIGNvbnN0cnVjdG9yKHNjaGVtYSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgeyBydWxlcyA9IFtdLCB1bnN0YWJsZV93aGl0ZXNwYWNlT25QYXN0ZU1vZGUgPSBcInByZXNlcnZlXCIgfSA9IG9wdGlvbnMsIHN0YW5kYXJkUnVsZXMgPSBjcmVhdGVSdWxlcyhzY2hlbWEsIHtcbiAgICAgIGtleUdlbmVyYXRvcjogb3B0aW9ucy5rZXlHZW5lcmF0b3IsXG4gICAgICBtYXRjaGVyczogb3B0aW9ucy5tYXRjaGVyc1xuICAgIH0pO1xuICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hLCB0aGlzLmtleUdlbmVyYXRvciA9IG9wdGlvbnMua2V5R2VuZXJhdG9yID8/IGtleUdlbmVyYXRvciwgdGhpcy5ydWxlcyA9IFsuLi5ydWxlcywgLi4uc3RhbmRhcmRSdWxlc10sIHRoaXMud2hpdGVzcGFjZU1vZGUgPSB1bnN0YWJsZV93aGl0ZXNwYWNlT25QYXN0ZU1vZGU7XG4gICAgY29uc3QgcGFyc2VIdG1sID0gb3B0aW9ucy5wYXJzZUh0bWwgfHwgZGVmYXVsdFBhcnNlSHRtbCgpO1xuICAgIHRoaXMucGFyc2VIdG1sID0gKGh0bWwpID0+IHtcbiAgICAgIGNvbnN0IGNsZWFuSFRNTCA9IE0oaHRtbCksIGRvYyA9IHBhcnNlSHRtbChjbGVhbkhUTUwpO1xuICAgICAgZm9yIChjb25zdCBwcm9jZXNzb3Igb2YgcHJlcHJvY2Vzc29ycylcbiAgICAgICAgcHJvY2Vzc29yKGNsZWFuSFRNTCwgZG9jKTtcbiAgICAgIHJldHVybiBkb2MuYm9keTtcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZSBIVE1MLlxuICAgKlxuICAgKiBAcGFyYW0gaHRtbCAtIFRoZSBIVE1MIHRvIGRlc2VyaWFsaXplLCBhcyBhIHN0cmluZ1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiBibG9ja3MgLSBlaXRoZXIgcG9ydGFibGUgdGV4dCBibG9ja3Mgb3Igb3RoZXIgYWxsb3dlZCBibG9ja3NcbiAgICovXG4gIGRlc2VyaWFsaXplID0gKGh0bWwpID0+IHtcbiAgICB0aGlzLl9tYXJrRGVmcyA9IFtdO1xuICAgIGNvbnN0IHsgcGFyc2VIdG1sIH0gPSB0aGlzLCBmcmFnbWVudCA9IHBhcnNlSHRtbChodG1sKSwgY2hpbGRyZW4gPSBBcnJheS5mcm9tKGZyYWdtZW50LmNoaWxkTm9kZXMpLCBibG9ja3MyID0gdHJpbVdoaXRlc3BhY2UoXG4gICAgICB7IHNjaGVtYTogdGhpcy5zY2hlbWEgfSxcbiAgICAgIHRoaXMud2hpdGVzcGFjZU1vZGUsXG4gICAgICBmbGF0dGVuTmVzdGVkQmxvY2tzKFxuICAgICAgICB7IHNjaGVtYTogdGhpcy5zY2hlbWEgfSxcbiAgICAgICAgZW5zdXJlUm9vdElzQmxvY2tzKFxuICAgICAgICAgIHRoaXMuc2NoZW1hLFxuICAgICAgICAgIHRoaXMuZGVzZXJpYWxpemVFbGVtZW50cyhjaGlsZHJlbilcbiAgICAgICAgKVxuICAgICAgKVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuX21hcmtEZWZzLmxlbmd0aCA+IDAgJiYgYmxvY2tzMi5maWx0ZXIoKGJsb2NrKSA9PiBpc1RleHRCbG9jayh7IHNjaGVtYTogdGhpcy5zY2hlbWEgfSwgYmxvY2spKS5mb3JFYWNoKChibG9jaykgPT4ge1xuICAgICAgYmxvY2subWFya0RlZnMgPSBibG9jay5tYXJrRGVmcyB8fCBbXSwgYmxvY2subWFya0RlZnMgPSBibG9jay5tYXJrRGVmcy5jb25jYXQoXG4gICAgICAgIHRoaXMuX21hcmtEZWZzLmZpbHRlcigoZGVmKSA9PiBibG9jay5jaGlsZHJlbi5mbGF0TWFwKChjaGlsZCkgPT4gY2hpbGQubWFya3MgfHwgW10pLmluY2x1ZGVzKGRlZi5fa2V5KSlcbiAgICAgICk7XG4gICAgfSksIGJsb2NrczIubWFwKChibG9jaykgPT4gKGJsb2NrLl90eXBlID09PSBcImJsb2NrXCIgJiYgKGJsb2NrLl90eXBlID0gdGhpcy5zY2hlbWEuYmxvY2submFtZSksIGJsb2NrKSk7XG4gIH07XG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZSBhbiBhcnJheSBvZiBET00gZWxlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50cyAtIEFycmF5IG9mIERPTSBlbGVtZW50cyB0byBkZXNlcmlhbGl6ZVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgZGVzZXJpYWxpemVFbGVtZW50cyA9IChlbGVtZW50cyA9IFtdKSA9PiB7XG4gICAgbGV0IG5vZGVzID0gW107XG4gICAgcmV0dXJuIGVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIG5vZGVzID0gbm9kZXMuY29uY2F0KHRoaXMuZGVzZXJpYWxpemVFbGVtZW50KGVsZW1lbnQpKTtcbiAgICB9KSwgbm9kZXM7XG4gIH07XG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZSBhIERPTSBlbGVtZW50XG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50IC0gRGVzZXJpYWxpemUgYSBET00gZWxlbWVudFxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgZGVzZXJpYWxpemVFbGVtZW50ID0gKGVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBuZXh0ID0gKGVsZW1lbnRzKSA9PiB7XG4gICAgICBpZiAoaXNOb2RlTGlzdChlbGVtZW50cykpXG4gICAgICAgIHJldHVybiB0aGlzLmRlc2VyaWFsaXplRWxlbWVudHMoQXJyYXkuZnJvbShlbGVtZW50cykpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZWxlbWVudHMpKVxuICAgICAgICByZXR1cm4gdGhpcy5kZXNlcmlhbGl6ZUVsZW1lbnRzKGVsZW1lbnRzKTtcbiAgICAgIGlmIChlbGVtZW50cylcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzZXJpYWxpemVFbGVtZW50KGVsZW1lbnRzKTtcbiAgICB9LCBibG9jayA9IChwcm9wcykgPT4gKHtcbiAgICAgIF90eXBlOiBcIl9fYmxvY2tcIixcbiAgICAgIGJsb2NrOiBwcm9wc1xuICAgIH0pO1xuICAgIGxldCBub2RlO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ydWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgcnVsZSA9IHRoaXMucnVsZXNbaV07XG4gICAgICBpZiAoIXJ1bGUuZGVzZXJpYWxpemUpXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgY29uc3QgcmV0ID0gcnVsZS5kZXNlcmlhbGl6ZShlbGVtZW50LCBuZXh0LCBibG9jayksIHR5cGUgPSByZXNvbHZlSnNUeXBlKHJldCk7XG4gICAgICBpZiAodHlwZSAhPT0gXCJhcnJheVwiICYmIHR5cGUgIT09IFwib2JqZWN0XCIgJiYgdHlwZSAhPT0gXCJudWxsXCIgJiYgdHlwZSAhPT0gXCJ1bmRlZmluZWRcIilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBBIHJ1bGUgcmV0dXJuZWQgYW4gaW52YWxpZCBkZXNlcmlhbGl6ZWQgcmVwcmVzZW50YXRpb246IFwiJHtub2RlfVwiLmBcbiAgICAgICAgKTtcbiAgICAgIGlmIChyZXQgIT09IHZvaWQgMCkge1xuICAgICAgICB7XG4gICAgICAgICAgaWYgKHJldCA9PT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRlc2VyaWFsaXplciBydWxlIHJldHVybmVkIGBudWxsYFwiKTtcbiAgICAgICAgICBBcnJheS5pc0FycmF5KHJldCkgPyBub2RlID0gcmV0IDogaXNQbGFjZWhvbGRlckRlY29yYXRvcihyZXQpID8gbm9kZSA9IHRoaXMuZGVzZXJpYWxpemVEZWNvcmF0b3IocmV0KSA6IGlzUGxhY2Vob2xkZXJBbm5vdGF0aW9uKHJldCkgPyBub2RlID0gdGhpcy5kZXNlcmlhbGl6ZUFubm90YXRpb24ocmV0KSA6IG5vZGUgPSByZXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJldCAmJiAhQXJyYXkuaXNBcnJheShyZXQpICYmIGlzTWluaW1hbEJsb2NrKHJldCkgJiYgXCJsaXN0SXRlbVwiIGluIHJldCkge1xuICAgICAgICAgIGxldCBwYXJlbnQgPSBlbGVtZW50LnBhcmVudE5vZGU/LnBhcmVudE5vZGU7XG4gICAgICAgICAgZm9yICg7IHBhcmVudCAmJiB0YWdOYW1lKHBhcmVudCkgPT09IFwibGlcIjsgKVxuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU/LnBhcmVudE5vZGUsIHJldC5sZXZlbCA9IHJldC5sZXZlbCA/IHJldC5sZXZlbCArIDEgOiAxO1xuICAgICAgICB9XG4gICAgICAgIHJldCAmJiAhQXJyYXkuaXNBcnJheShyZXQpICYmIGlzTWluaW1hbEJsb2NrKHJldCkgJiYgcmV0LnN0eWxlID09PSBcImJsb2NrcXVvdGVcIiAmJiByZXQuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgaXNNaW5pbWFsU3BhbihjaGlsZCkgJiYgY2hpbGQudGV4dCA9PT0gXCJcXHJcIiAmJiAoY2hpbGQudGV4dCA9IGBcbmAsIChpbmRleCA9PT0gMCB8fCBpbmRleCA9PT0gcmV0LmNoaWxkcmVuLmxlbmd0aCAtIDEpICYmIHJldC5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbm9kZSB8fCBuZXh0KGVsZW1lbnQuY2hpbGROb2RlcykgfHwgW107XG4gIH07XG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZSBhIGBfX2RlY29yYXRvcmAgdHlwZVxuICAgKiAoYW4gaW50ZXJuYWwgbWFkZSB1cCB0eXBlIHRvIHByb2Nlc3MgZGVjb3JhdG9ycyBleGNsdXNpdmVseSlcbiAgICpcbiAgICogQHBhcmFtIGRlY29yYXRvciAtXG4gICAqIEByZXR1cm5zIGFycmF5IG9mIC4uLlxuICAgKi9cbiAgZGVzZXJpYWxpemVEZWNvcmF0b3IgPSAoZGVjb3JhdG9yKSA9PiB7XG4gICAgY29uc3QgeyBuYW1lIH0gPSBkZWNvcmF0b3IsIGFwcGx5RGVjb3JhdG9yID0gKG5vZGUpID0+IHtcbiAgICAgIGlmIChpc1BsYWNlaG9sZGVyRGVjb3JhdG9yKG5vZGUpKVxuICAgICAgICByZXR1cm4gdGhpcy5kZXNlcmlhbGl6ZURlY29yYXRvcihub2RlKTtcbiAgICAgIGlmIChpc01pbmltYWxTcGFuKG5vZGUpKVxuICAgICAgICBub2RlLm1hcmtzID0gbm9kZS5tYXJrcyB8fCBbXSwgbm9kZS50ZXh0LnRyaW0oKSAmJiBub2RlLm1hcmtzLnVuc2hpZnQobmFtZSk7XG4gICAgICBlbHNlIGlmIChcImNoaWxkcmVuXCIgaW4gbm9kZSAmJiBBcnJheS5pc0FycmF5KG5vZGUuY2hpbGRyZW4pKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gbm9kZTtcbiAgICAgICAgYmxvY2suY2hpbGRyZW4gPSBibG9jay5jaGlsZHJlbi5tYXAoYXBwbHlEZWNvcmF0b3IpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfTtcbiAgICByZXR1cm4gZGVjb3JhdG9yLmNoaWxkcmVuLnJlZHVjZSgoY2hpbGRyZW4sIG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHJldCA9IGFwcGx5RGVjb3JhdG9yKG5vZGUpO1xuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocmV0KSA/IGNoaWxkcmVuLmNvbmNhdChyZXQpIDogKGNoaWxkcmVuLnB1c2gocmV0KSwgY2hpbGRyZW4pO1xuICAgIH0sIFtdKTtcbiAgfTtcbiAgLyoqXG4gICAqIERlc2VyaWFsaXplIGEgYF9fYW5ub3RhdGlvbmAgb2JqZWN0LlxuICAgKiAoYW4gaW50ZXJuYWwgbWFkZSB1cCB0eXBlIHRvIHByb2Nlc3MgYW5ub3RhdGlvbnMgZXhjbHVzaXZlbHkpXG4gICAqXG4gICAqIEBwYXJhbSBhbm5vdGF0aW9uIC1cbiAgICogQHJldHVybnMgQXJyYXkgb2YuLi5cbiAgICovXG4gIGRlc2VyaWFsaXplQW5ub3RhdGlvbiA9IChhbm5vdGF0aW9uKSA9PiB7XG4gICAgY29uc3QgeyBtYXJrRGVmIH0gPSBhbm5vdGF0aW9uO1xuICAgIHRoaXMuX21hcmtEZWZzLnB1c2gobWFya0RlZik7XG4gICAgY29uc3QgYXBwbHlBbm5vdGF0aW9uID0gKG5vZGUpID0+IHtcbiAgICAgIGlmIChpc1BsYWNlaG9sZGVyQW5ub3RhdGlvbihub2RlKSlcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVzZXJpYWxpemVBbm5vdGF0aW9uKG5vZGUpO1xuICAgICAgaWYgKGlzTWluaW1hbFNwYW4obm9kZSkpXG4gICAgICAgIG5vZGUubWFya3MgPSBub2RlLm1hcmtzIHx8IFtdLCBub2RlLnRleHQudHJpbSgpICYmIG5vZGUubWFya3MudW5zaGlmdChtYXJrRGVmLl9rZXkpO1xuICAgICAgZWxzZSBpZiAoXCJjaGlsZHJlblwiIGluIG5vZGUgJiYgQXJyYXkuaXNBcnJheShub2RlLmNoaWxkcmVuKSkge1xuICAgICAgICBjb25zdCBibG9jayA9IG5vZGU7XG4gICAgICAgIGJsb2NrLmNoaWxkcmVuID0gYmxvY2suY2hpbGRyZW4ubWFwKGFwcGx5QW5ub3RhdGlvbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9kZTtcbiAgICB9O1xuICAgIHJldHVybiBhbm5vdGF0aW9uLmNoaWxkcmVuLnJlZHVjZSgoY2hpbGRyZW4sIG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHJldCA9IGFwcGx5QW5ub3RhdGlvbihub2RlKTtcbiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHJldCkgPyBjaGlsZHJlbi5jb25jYXQocmV0KSA6IChjaGlsZHJlbi5wdXNoKHJldCksIGNoaWxkcmVuKTtcbiAgICB9LCBbXSk7XG4gIH07XG59XG5mdW5jdGlvbiBub3JtYWxpemVCbG9jayhub2RlLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3Qgc2NoZW1hID0ge1xuICAgIGJsb2NrOiB7XG4gICAgICBuYW1lOiBvcHRpb25zLmJsb2NrVHlwZU5hbWUgfHwgXCJibG9ja1wiXG4gICAgfSxcbiAgICBzcGFuOiB7XG4gICAgICBuYW1lOiBcInNwYW5cIlxuICAgIH0sXG4gICAgc3R5bGVzOiBbXSxcbiAgICBsaXN0czogW10sXG4gICAgZGVjb3JhdG9yczogW10sXG4gICAgYW5ub3RhdGlvbnM6IFtdLFxuICAgIGJsb2NrT2JqZWN0czogW10sXG4gICAgaW5saW5lT2JqZWN0czogW11cbiAgfTtcbiAgaWYgKG5vZGUuX3R5cGUgIT09IChvcHRpb25zLmJsb2NrVHlwZU5hbWUgfHwgXCJibG9ja1wiKSlcbiAgICByZXR1cm4gXCJfa2V5XCIgaW4gbm9kZSA/IG5vZGUgOiB7XG4gICAgICAuLi5ub2RlLFxuICAgICAgX2tleTogb3B0aW9ucy5rZXlHZW5lcmF0b3IgPyBvcHRpb25zLmtleUdlbmVyYXRvcigpIDoga2V5R2VuZXJhdG9yKClcbiAgICB9O1xuICBjb25zdCBibG9jayA9IHtcbiAgICBfa2V5OiBvcHRpb25zLmtleUdlbmVyYXRvciA/IG9wdGlvbnMua2V5R2VuZXJhdG9yKCkgOiBrZXlHZW5lcmF0b3IoKSxcbiAgICBjaGlsZHJlbjogW10sXG4gICAgbWFya0RlZnM6IFtdLFxuICAgIC4uLm5vZGVcbiAgfSwgbGFzdENoaWxkID0gYmxvY2suY2hpbGRyZW5bYmxvY2suY2hpbGRyZW4ubGVuZ3RoIC0gMV07XG4gIGlmICghbGFzdENoaWxkKVxuICAgIHJldHVybiBibG9jay5jaGlsZHJlbiA9IFtcbiAgICAgIHtcbiAgICAgICAgX3R5cGU6IFwic3BhblwiLFxuICAgICAgICBfa2V5OiBvcHRpb25zLmtleUdlbmVyYXRvciA/IG9wdGlvbnMua2V5R2VuZXJhdG9yKCkgOiBrZXlHZW5lcmF0b3IoKSxcbiAgICAgICAgdGV4dDogXCJcIixcbiAgICAgICAgbWFya3M6IFtdXG4gICAgICB9XG4gICAgXSwgYmxvY2s7XG4gIGNvbnN0IHVzZWRNYXJrRGVmcyA9IFtdLCBhbGxvd2VkRGVjb3JhdG9ycyA9IG9wdGlvbnMuYWxsb3dlZERlY29yYXRvcnMgJiYgQXJyYXkuaXNBcnJheShvcHRpb25zLmFsbG93ZWREZWNvcmF0b3JzKSA/IG9wdGlvbnMuYWxsb3dlZERlY29yYXRvcnMgOiAhMTtcbiAgcmV0dXJuIGJsb2NrLmNoaWxkcmVuID0gYmxvY2suY2hpbGRyZW4ucmVkdWNlKFxuICAgIChhY2MsIGNoaWxkKSA9PiB7XG4gICAgICBjb25zdCBwcmV2aW91c0NoaWxkID0gYWNjW2FjYy5sZW5ndGggLSAxXTtcbiAgICAgIHJldHVybiBwcmV2aW91c0NoaWxkICYmIGlzU3Bhbih7IHNjaGVtYSB9LCBjaGlsZCkgJiYgaXNTcGFuKHsgc2NoZW1hIH0sIHByZXZpb3VzQ2hpbGQpICYmIGlzRXF1YWxNYXJrcyhwcmV2aW91c0NoaWxkLm1hcmtzLCBjaGlsZC5tYXJrcykgPyAobGFzdENoaWxkICYmIGxhc3RDaGlsZCA9PT0gY2hpbGQgJiYgY2hpbGQudGV4dCA9PT0gXCJcIiAmJiBibG9jay5jaGlsZHJlbi5sZW5ndGggPiAxIHx8IChwcmV2aW91c0NoaWxkLnRleHQgKz0gY2hpbGQudGV4dCksIGFjYykgOiAoYWNjLnB1c2goY2hpbGQpLCBhY2MpO1xuICAgIH0sXG4gICAgW11cbiAgKS5tYXAoKGNoaWxkKSA9PiB7XG4gICAgaWYgKCFjaGlsZClcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIm1pc3NpbmcgY2hpbGRcIik7XG4gICAgcmV0dXJuIGNoaWxkLl9rZXkgPSBvcHRpb25zLmtleUdlbmVyYXRvciA/IG9wdGlvbnMua2V5R2VuZXJhdG9yKCkgOiBrZXlHZW5lcmF0b3IoKSwgaXNTcGFuKHsgc2NoZW1hIH0sIGNoaWxkKSAmJiAoY2hpbGQubWFya3MgPyBhbGxvd2VkRGVjb3JhdG9ycyAmJiAoY2hpbGQubWFya3MgPSBjaGlsZC5tYXJrcy5maWx0ZXIoKG1hcmspID0+IHtcbiAgICAgIGNvbnN0IGlzQWxsb3dlZCA9IGFsbG93ZWREZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspLCBpc1VzZWQgPSBibG9jay5tYXJrRGVmcz8uc29tZSgoZGVmKSA9PiBkZWYuX2tleSA9PT0gbWFyayk7XG4gICAgICByZXR1cm4gaXNBbGxvd2VkIHx8IGlzVXNlZDtcbiAgICB9KSkgOiBjaGlsZC5tYXJrcyA9IFtdLCB1c2VkTWFya0RlZnMucHVzaCguLi5jaGlsZC5tYXJrcykpLCBjaGlsZDtcbiAgfSksIGJsb2NrLm1hcmtEZWZzID0gKGJsb2NrLm1hcmtEZWZzIHx8IFtdKS5maWx0ZXIoXG4gICAgKG1hcmtEZWYpID0+IHVzZWRNYXJrRGVmcy5pbmNsdWRlcyhtYXJrRGVmLl9rZXkpXG4gICksIGJsb2NrO1xufVxuZnVuY3Rpb24gaHRtbFRvQmxvY2tzKGh0bWwsIHNjaGVtYVR5cGUsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBzY2hlbWEgPSBpc1Nhbml0eVNjaGVtYShzY2hlbWFUeXBlKSA/IHNhbml0eVNjaGVtYVRvUG9ydGFibGVUZXh0U2NoZW1hKHNjaGVtYVR5cGUpIDogc2NoZW1hVHlwZTtcbiAgcmV0dXJuIG5ldyBIdG1sRGVzZXJpYWxpemVyKHNjaGVtYSwgb3B0aW9ucykuZGVzZXJpYWxpemUoaHRtbCkubWFwKChibG9jaykgPT4gbm9ybWFsaXplQmxvY2soYmxvY2ssIHsga2V5R2VuZXJhdG9yOiBvcHRpb25zLmtleUdlbmVyYXRvciB9KSk7XG59XG5mdW5jdGlvbiBpc1Nhbml0eVNjaGVtYShzY2hlbWEpIHtcbiAgcmV0dXJuIHNjaGVtYS5oYXNPd25Qcm9wZXJ0eShcImpzb25UeXBlXCIpO1xufVxuZXhwb3J0IHtcbiAgaHRtbFRvQmxvY2tzLFxuICBub3JtYWxpemVCbG9jayxcbiAgcmFuZG9tS2V5XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/block-tools/lib/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getActiveAnnotations: () => (/* binding */ getActiveAnnotations),\n/* harmony export */   getActiveAnnotationsMarks: () => (/* binding */ getActiveAnnotationsMarks),\n/* harmony export */   getActiveDecorators: () => (/* binding */ getActiveDecorators),\n/* harmony export */   getActiveListItem: () => (/* binding */ getActiveListItem),\n/* harmony export */   getActiveStyle: () => (/* binding */ getActiveStyle),\n/* harmony export */   getCaretWordSelection: () => (/* binding */ getCaretWordSelection),\n/* harmony export */   getFocusBlock: () => (/* binding */ getFocusBlock),\n/* harmony export */   getFocusBlockObject: () => (/* binding */ getFocusBlockObject),\n/* harmony export */   getFocusChild: () => (/* binding */ getFocusChild),\n/* harmony export */   getFocusInlineObject: () => (/* binding */ getFocusInlineObject),\n/* harmony export */   getFocusListBlock: () => (/* binding */ getFocusListBlock),\n/* harmony export */   getFocusSpan: () => (/* binding */ getFocusSpan),\n/* harmony export */   getFocusTextBlock: () => (/* binding */ getFocusTextBlock),\n/* harmony export */   getLastBlock: () => (/* binding */ getLastBlock),\n/* harmony export */   getMarkState: () => (/* binding */ getMarkState),\n/* harmony export */   getNextBlock: () => (/* binding */ getNextBlock),\n/* harmony export */   getNextInlineObject: () => (/* binding */ getNextInlineObject),\n/* harmony export */   getNextSpan: () => (/* binding */ getNextSpan),\n/* harmony export */   getPreviousBlock: () => (/* binding */ getPreviousBlock),\n/* harmony export */   getPreviousInlineObject: () => (/* binding */ getPreviousInlineObject),\n/* harmony export */   getPreviousSpan: () => (/* binding */ getPreviousSpan),\n/* harmony export */   getSelectedBlocks: () => (/* binding */ getSelectedBlocks),\n/* harmony export */   getSelectedSpans: () => (/* binding */ getSelectedSpans),\n/* harmony export */   getSelectedTextBlocks: () => (/* binding */ getSelectedTextBlocks),\n/* harmony export */   getSelectedValue: () => (/* binding */ getSelectedValue),\n/* harmony export */   getSelectionEndBlock: () => (/* binding */ getSelectionEndBlock),\n/* harmony export */   getSelectionEndChild: () => (/* binding */ getSelectionEndChild),\n/* harmony export */   getSelectionEndPoint: () => (/* binding */ getSelectionEndPoint),\n/* harmony export */   getSelectionStartBlock: () => (/* binding */ getSelectionStartBlock),\n/* harmony export */   getSelectionStartChild: () => (/* binding */ getSelectionStartChild),\n/* harmony export */   getSelectionStartPoint: () => (/* binding */ getSelectionStartPoint),\n/* harmony export */   getSelectionText: () => (/* binding */ getSelectionText),\n/* harmony export */   isActiveAnnotation: () => (/* binding */ isActiveAnnotation),\n/* harmony export */   isActiveDecorator: () => (/* binding */ isActiveDecorator),\n/* harmony export */   isActiveListItem: () => (/* binding */ isActiveListItem),\n/* harmony export */   isActiveStyle: () => (/* binding */ isActiveStyle),\n/* harmony export */   isAtTheEndOfBlock: () => (/* binding */ isAtTheEndOfBlock),\n/* harmony export */   isAtTheStartOfBlock: () => (/* binding */ isAtTheStartOfBlock),\n/* harmony export */   isOverlappingSelection: () => (/* binding */ isOverlappingSelection),\n/* harmony export */   isPointAfterSelection: () => (/* binding */ isPointAfterSelection),\n/* harmony export */   isPointBeforeSelection: () => (/* binding */ isPointBeforeSelection),\n/* harmony export */   isSelectingEntireBlocks: () => (/* binding */ isSelectingEntireBlocks),\n/* harmony export */   isSelectionCollapsed: () => (/* binding */ isSelectionCollapsed),\n/* harmony export */   isSelectionExpanded: () => (/* binding */ isSelectionExpanded$1)\n/* harmony export */ });\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.slice-blocks.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n\n\nconst getFocusBlock = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const key = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(snapshot.context.selection.focus), index = key ? snapshot.blockIndexMap.get(key) : void 0, node = index !== void 0 ? snapshot.context.value.at(index) : void 0;\n  return node && key ? {\n    node,\n    path: [{\n      _key: key\n    }]\n  } : void 0;\n}, getFocusTextBlock = (snapshot) => {\n  const focusBlock = getFocusBlock(snapshot);\n  return focusBlock && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, focusBlock.node) ? {\n    node: focusBlock.node,\n    path: focusBlock.path\n  } : void 0;\n}, getFocusChild = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const focusBlock = getFocusTextBlock(snapshot);\n  if (!focusBlock)\n    return;\n  const key = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(snapshot.context.selection.focus), node = key ? focusBlock.node.children.find((span) => span._key === key) : void 0;\n  return node && key ? {\n    node,\n    path: [...focusBlock.path, \"children\", {\n      _key: key\n    }]\n  } : void 0;\n}, getFocusInlineObject = (snapshot) => {\n  const focusChild = getFocusChild(snapshot);\n  return focusChild && !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, focusChild.node) ? {\n    node: focusChild.node,\n    path: focusChild.path\n  } : void 0;\n}, getFocusSpan = (snapshot) => {\n  const focusChild = getFocusChild(snapshot);\n  return focusChild && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, focusChild.node) ? {\n    node: focusChild.node,\n    path: focusChild.path\n  } : void 0;\n}, getSelectedBlocks = (snapshot) => {\n  if (!snapshot.context.selection)\n    return [];\n  const selectedBlocks = [], startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(snapshot.context.selection), endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(snapshot.context.selection), startKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(startPoint), endKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(endPoint);\n  if (!startKey || !endKey)\n    return selectedBlocks;\n  const startBlockIndex = snapshot.blockIndexMap.get(startKey), endBlockIndex = snapshot.blockIndexMap.get(endKey);\n  if (startBlockIndex === void 0 || endBlockIndex === void 0)\n    return selectedBlocks;\n  const slicedValue = snapshot.context.value.slice(startBlockIndex, endBlockIndex + 1);\n  for (const block of slicedValue) {\n    if (block._key === startKey) {\n      if (selectedBlocks.push({\n        node: block,\n        path: [{\n          _key: block._key\n        }]\n      }), startKey === endKey)\n        break;\n      continue;\n    }\n    if (block._key === endKey) {\n      selectedBlocks.push({\n        node: block,\n        path: [{\n          _key: block._key\n        }]\n      });\n      break;\n    }\n    selectedBlocks.length > 0 && selectedBlocks.push({\n      node: block,\n      path: [{\n        _key: block._key\n      }]\n    });\n  }\n  return selectedBlocks;\n}, getSelectionEndBlock = (snapshot) => {\n  const endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(snapshot.context.selection);\n  if (endPoint)\n    return getFocusBlock({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: endPoint,\n          focus: endPoint\n        }\n      }\n    });\n}, getSelectionStartBlock = (snapshot) => {\n  const startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(snapshot.context.selection);\n  if (startPoint)\n    return getFocusBlock({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: startPoint,\n          focus: startPoint\n        }\n      }\n    });\n}, getSelectionEndPoint = (snapshot) => {\n  if (snapshot.context.selection)\n    return snapshot.context.selection.backward ? snapshot.context.selection.anchor : snapshot.context.selection.focus;\n}, getSelectionStartPoint = (snapshot) => {\n  if (snapshot.context.selection)\n    return snapshot.context.selection.backward ? snapshot.context.selection.focus : snapshot.context.selection.anchor;\n};\nfunction isPointAfterSelection(point) {\n  return (snapshot) => {\n    if (!snapshot.context.selection)\n      return !1;\n    const endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(snapshot.context.selection), endBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(endPoint), endChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(endPoint), pointBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(point), pointChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(point);\n    if (!pointBlockKey || !endBlockKey)\n      return !1;\n    const pointBlockIndex = snapshot.blockIndexMap.get(pointBlockKey), endBlockIndex = snapshot.blockIndexMap.get(endBlockKey);\n    if (pointBlockIndex === void 0 || endBlockIndex === void 0)\n      return !1;\n    if (pointBlockIndex > endBlockIndex)\n      return !0;\n    if (pointBlockIndex < endBlockIndex)\n      return !1;\n    const pointBlock = snapshot.context.value.at(pointBlockIndex);\n    if (!pointBlock || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, pointBlock))\n      return !1;\n    let pointChildIndex, endChildIndex, childIndex = -1;\n    for (const child of pointBlock.children) {\n      if (childIndex++, child._key === pointChildKey && child._key === endChildKey)\n        return point.offset > endPoint.offset;\n      if (child._key === pointChildKey && (pointChildIndex = childIndex), child._key === endChildKey && (endChildIndex = childIndex), pointChildIndex !== void 0 && endChildIndex !== void 0)\n        break;\n    }\n    return pointChildIndex === void 0 || endChildIndex === void 0 ? !1 : pointChildIndex > endChildIndex;\n  };\n}\nfunction isPointBeforeSelection(point) {\n  return (snapshot) => {\n    if (!snapshot.context.selection)\n      return !1;\n    const startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(snapshot.context.selection), startBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(startPoint), startChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(startPoint), pointBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(point), pointChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(point);\n    if (!pointBlockKey || !startBlockKey)\n      return !1;\n    const startBlockIndex = snapshot.blockIndexMap.get(startBlockKey), pointBlockIndex = snapshot.blockIndexMap.get(pointBlockKey);\n    if (startBlockIndex === void 0 || pointBlockIndex === void 0)\n      return !1;\n    if (pointBlockIndex < startBlockIndex)\n      return !0;\n    if (pointBlockIndex > startBlockIndex)\n      return !1;\n    const pointBlock = snapshot.context.value.at(pointBlockIndex);\n    if (!pointBlock || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, pointBlock))\n      return !1;\n    let pointChildIndex, startChildIndex, childIndex = -1;\n    for (const child of pointBlock.children) {\n      if (childIndex++, child._key === pointChildKey && child._key === startChildKey)\n        return point.offset < startPoint.offset;\n      if (child._key === pointChildKey && (pointChildIndex = childIndex), child._key === startChildKey && (startChildIndex = childIndex), pointChildIndex !== void 0 && startChildIndex !== void 0)\n        break;\n    }\n    return pointChildIndex === void 0 || startChildIndex === void 0 ? !1 : pointChildIndex < startChildIndex;\n  };\n}\nfunction isOverlappingSelection(selection) {\n  return (snapshot) => {\n    if (!selection || !snapshot.context.selection)\n      return !1;\n    const selectionStartPoint = getSelectionStartPoint({\n      context: {\n        ...snapshot.context,\n        selection\n      }\n    }), selectionEndPoint = getSelectionEndPoint({\n      context: {\n        ...snapshot.context,\n        selection\n      }\n    }), originalSelectionStartPoint = getSelectionStartPoint(snapshot), originalSelectionEndPoint = getSelectionEndPoint(snapshot);\n    if (!selectionStartPoint || !selectionEndPoint || !originalSelectionStartPoint || !originalSelectionEndPoint)\n      return !1;\n    const startPointEqualToOriginalStartPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(selectionStartPoint, originalSelectionStartPoint), endPointEqualToOriginalEndPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(selectionEndPoint, originalSelectionEndPoint);\n    if (startPointEqualToOriginalStartPoint && endPointEqualToOriginalEndPoint)\n      return !0;\n    const startPointBeforeSelection = isPointBeforeSelection(selectionStartPoint)(snapshot), startPointAfterSelection = isPointAfterSelection(selectionStartPoint)(snapshot), endPointBeforeSelection = isPointBeforeSelection(selectionEndPoint)(snapshot), endPointAfterSelection = isPointAfterSelection(selectionEndPoint)(snapshot), originalStartPointBeforeStartPoint = isPointBeforeSelection(originalSelectionStartPoint)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: selectionStartPoint,\n          focus: selectionStartPoint\n        }\n      }\n    }), originalStartPointAfterStartPoint = isPointAfterSelection(originalSelectionStartPoint)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: selectionStartPoint,\n          focus: selectionStartPoint\n        }\n      }\n    }), originalEndPointBeforeEndPoint = isPointBeforeSelection(originalSelectionEndPoint)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: selectionEndPoint,\n          focus: selectionEndPoint\n        }\n      }\n    }), originalEndPointAfterEndPoint = isPointAfterSelection(originalSelectionEndPoint)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: selectionEndPoint,\n          focus: selectionEndPoint\n        }\n      }\n    }), startPointEqualToOriginalEndPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(selectionStartPoint, originalSelectionEndPoint), endPointEqualToOriginalStartPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(selectionEndPoint, originalSelectionStartPoint);\n    return !endPointEqualToOriginalStartPoint && !startPointEqualToOriginalEndPoint && !originalStartPointBeforeStartPoint && !originalStartPointAfterStartPoint && !originalEndPointBeforeEndPoint && !originalEndPointAfterEndPoint || endPointBeforeSelection && !endPointEqualToOriginalStartPoint || startPointAfterSelection && !startPointEqualToOriginalEndPoint ? !1 : !originalStartPointBeforeStartPoint && originalStartPointAfterStartPoint && !originalEndPointBeforeEndPoint && originalEndPointAfterEndPoint ? !endPointEqualToOriginalStartPoint : originalStartPointBeforeStartPoint && !originalStartPointAfterStartPoint && originalEndPointBeforeEndPoint && !originalEndPointAfterEndPoint ? !startPointEqualToOriginalEndPoint : !startPointAfterSelection || !startPointBeforeSelection || !endPointAfterSelection || !endPointBeforeSelection;\n  };\n}\nconst isSelectionCollapsed = (snapshot) => snapshot.context.selection ? JSON.stringify(snapshot.context.selection.anchor.path) === JSON.stringify(snapshot.context.selection.focus.path) && snapshot.context.selection?.anchor.offset === snapshot.context.selection?.focus.offset : !1, isSelectionExpanded$1 = (snapshot) => snapshot.context.selection !== null && !isSelectionCollapsed(snapshot), isSelectingEntireBlocks = (snapshot) => {\n  if (!snapshot.context.selection)\n    return !1;\n  const startPoint = snapshot.context.selection.backward ? snapshot.context.selection.focus : snapshot.context.selection.anchor, endPoint = snapshot.context.selection.backward ? snapshot.context.selection.anchor : snapshot.context.selection.focus, startBlock = getSelectionStartBlock(snapshot), endBlock = getSelectionEndBlock(snapshot);\n  if (!startBlock || !endBlock)\n    return !1;\n  const startBlockStartPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockStartPoint)({\n    context: snapshot.context,\n    block: startBlock\n  }), endBlockEndPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockEndPoint)({\n    context: snapshot.context,\n    block: endBlock\n  });\n  return (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(startBlockStartPoint, startPoint) && (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(endBlockEndPoint, endPoint);\n}, getSelectedValue = (snapshot) => {\n  const selection = snapshot.context.selection;\n  if (!selection)\n    return [];\n  const startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(selection), endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(selection), startBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(startPoint), endBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(endPoint);\n  if (!startBlockKey || !endBlockKey)\n    return [];\n  const startBlockIndex = snapshot.blockIndexMap.get(startBlockKey), endBlockIndex = snapshot.blockIndexMap.get(endBlockKey);\n  if (startBlockIndex === void 0 || endBlockIndex === void 0)\n    return [];\n  const startBlock = snapshot.context.value.at(startBlockIndex), slicedStartBlock = startBlock ? (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.sliceBlocks)({\n    context: snapshot.context,\n    blocks: [startBlock]\n  }).at(0) : void 0;\n  if (startBlockIndex === endBlockIndex)\n    return slicedStartBlock ? [slicedStartBlock] : [];\n  const endBlock = snapshot.context.value.at(endBlockIndex), slicedEndBlock = endBlock ? (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.sliceBlocks)({\n    context: snapshot.context,\n    blocks: [endBlock]\n  }).at(0) : void 0, middleBlocks = snapshot.context.value.slice(startBlockIndex + 1, endBlockIndex);\n  return [...slicedStartBlock ? [slicedStartBlock] : [], ...middleBlocks, ...slicedEndBlock ? [slicedEndBlock] : []];\n};\nfunction isBlockPath(path) {\n  const firstSegment = path.at(0);\n  return path.length === 1 && firstSegment !== void 0 && isRecord(firstSegment) && \"_key\" in firstSegment && typeof firstSegment._key == \"string\";\n}\nfunction isRecord(value) {\n  return !!value && (typeof value == \"object\" || typeof value == \"function\");\n}\nfunction isSelectionExpanded(selection) {\n  return selection ? !(0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isSelectionCollapsed)(selection) : !1;\n}\nconst getNextSpan = (snapshot) => {\n  const selectionEndBlock = getSelectionEndBlock(snapshot), selectionEndPoint = getSelectionEndPoint(snapshot);\n  if (!selectionEndBlock || !selectionEndPoint || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, selectionEndBlock.node))\n    return;\n  const selectionEndPointChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(selectionEndPoint);\n  let endPointChildFound = !1, nextSpan;\n  for (const child of selectionEndBlock.node.children) {\n    if (child._key === selectionEndPointChildKey) {\n      endPointChildFound = !0;\n      continue;\n    }\n    if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) && endPointChildFound) {\n      nextSpan = {\n        node: child,\n        path: [...selectionEndBlock.path, \"children\", {\n          _key: child._key\n        }]\n      };\n      break;\n    }\n  }\n  return nextSpan;\n}, getPreviousSpan = (snapshot) => {\n  const selectionStartBlock = getSelectionStartBlock(snapshot), selectionStartPoint = getSelectionStartPoint(snapshot);\n  if (!selectionStartBlock || !selectionStartPoint || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, selectionStartBlock.node))\n    return;\n  const selectionStartPointChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(selectionStartPoint);\n  let previousSpan;\n  for (const child of selectionStartBlock.node.children) {\n    if (child._key === selectionStartPointChildKey)\n      break;\n    (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) && (previousSpan = {\n      node: child,\n      path: [...selectionStartBlock.path, \"children\", {\n        _key: child._key\n      }]\n    });\n  }\n  return previousSpan;\n}, getSelectedSpans = (snapshot) => {\n  if (!snapshot.context.selection)\n    return [];\n  const selectedSpans = [], startPoint = getSelectionStartPoint(snapshot), endPoint = getSelectionEndPoint(snapshot);\n  if (!startPoint || !endPoint)\n    return selectedSpans;\n  const startBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(startPoint), endBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(endPoint), startSpanKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(startPoint), endSpanKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(endPoint);\n  if (!startBlockKey || !endBlockKey)\n    return selectedSpans;\n  const startBlockIndex = snapshot.blockIndexMap.get(startBlockKey), endBlockIndex = snapshot.blockIndexMap.get(endBlockKey);\n  if (startBlockIndex === void 0 || endBlockIndex === void 0)\n    return selectedSpans;\n  const slicedValue = snapshot.context.value.slice(startBlockIndex, endBlockIndex + 1);\n  let startBlockFound = !1;\n  for (const block of slicedValue)\n    if (block._key === startBlockKey && (startBlockFound = !0), !!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block)) {\n      if (block._key === startBlockKey) {\n        for (const child of block.children)\n          if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child)) {\n            if (startSpanKey && child._key === startSpanKey) {\n              if (startPoint.offset < child.text.length && selectedSpans.push({\n                node: child,\n                path: [{\n                  _key: block._key\n                }, \"children\", {\n                  _key: child._key\n                }]\n              }), startSpanKey === endSpanKey)\n                break;\n              continue;\n            }\n            if (endSpanKey && child._key === endSpanKey) {\n              endPoint.offset > 0 && selectedSpans.push({\n                node: child,\n                path: [{\n                  _key: block._key\n                }, \"children\", {\n                  _key: child._key\n                }]\n              });\n              break;\n            }\n            selectedSpans.length > 0 && selectedSpans.push({\n              node: child,\n              path: [{\n                _key: block._key\n              }, \"children\", {\n                _key: child._key\n              }]\n            });\n          }\n        if (startBlockKey === endBlockKey)\n          break;\n        continue;\n      }\n      if (block._key === endBlockKey) {\n        for (const child of block.children)\n          if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child)) {\n            if (endSpanKey && child._key === endSpanKey) {\n              endPoint.offset > 0 && selectedSpans.push({\n                node: child,\n                path: [{\n                  _key: block._key\n                }, \"children\", {\n                  _key: child._key\n                }]\n              });\n              break;\n            }\n            selectedSpans.push({\n              node: child,\n              path: [{\n                _key: block._key\n              }, \"children\", {\n                _key: child._key\n              }]\n            });\n          }\n        break;\n      }\n      if (startBlockFound)\n        for (const child of block.children)\n          (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) && selectedSpans.push({\n            node: child,\n            path: [{\n              _key: block._key\n            }, \"children\", {\n              _key: child._key\n            }]\n          });\n    }\n  return selectedSpans;\n}, getMarkState = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  let selection = snapshot.context.selection;\n  if (!getFocusTextBlock(snapshot))\n    return;\n  if (isBlockPath(selection.anchor.path)) {\n    const spanSelectionPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.blockOffsetToSpanSelectionPoint)({\n      context: snapshot.context,\n      blockOffset: {\n        path: selection.anchor.path,\n        offset: selection.anchor.offset\n      },\n      direction: selection.backward ? \"backward\" : \"forward\"\n    });\n    selection = spanSelectionPoint ? {\n      ...selection,\n      anchor: spanSelectionPoint\n    } : selection;\n  }\n  if (isBlockPath(selection.focus.path)) {\n    const spanSelectionPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.blockOffsetToSpanSelectionPoint)({\n      context: snapshot.context,\n      blockOffset: {\n        path: selection.focus.path,\n        offset: selection.focus.offset\n      },\n      direction: selection.backward ? \"backward\" : \"forward\"\n    });\n    selection = spanSelectionPoint ? {\n      ...selection,\n      focus: spanSelectionPoint\n    } : selection;\n  }\n  const focusSpan = getFocusSpan({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection\n    }\n  });\n  if (!focusSpan)\n    return;\n  if (isSelectionExpanded(selection)) {\n    const selectedSpans = getSelectedSpans({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection\n      }\n    });\n    let index = 0, marks2 = [];\n    for (const span of selectedSpans) {\n      if (index === 0)\n        marks2 = span.node.marks ?? [];\n      else {\n        if (span.node.marks?.length === 0) {\n          marks2 = [];\n          continue;\n        }\n        marks2 = marks2.filter((mark) => (span.node.marks ?? []).some((spanMark) => spanMark === mark));\n      }\n      index++;\n    }\n    return {\n      state: \"unchanged\",\n      marks: marks2\n    };\n  }\n  const decorators = snapshot.context.schema.decorators.map((decorator) => decorator.name), marks = focusSpan.node.marks ?? [], marksWithoutAnnotations = marks.filter((mark) => decorators.includes(mark)), spanHasAnnotations = marks.length > marksWithoutAnnotations.length, spanIsEmpty = focusSpan.node.text.length === 0, atTheBeginningOfSpan = snapshot.context.selection.anchor.offset === 0, atTheEndOfSpan = snapshot.context.selection.anchor.offset === focusSpan.node.text.length, previousSpan = getPreviousSpan({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection\n    }\n  }), nextSpan = getNextSpan({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection\n    }\n  }), nextSpanAnnotations = nextSpan?.node?.marks?.filter((mark) => !decorators.includes(mark)) ?? [], spanAnnotations = marks.filter((mark) => !decorators.includes(mark)), previousSpanHasAnnotations = previousSpan ? previousSpan.node.marks?.some((mark) => !decorators.includes(mark)) : !1, previousSpanHasSameAnnotations = previousSpan ? previousSpan.node.marks?.filter((mark) => !decorators.includes(mark)).every((mark) => marks.includes(mark)) : !1, previousSpanHasSameAnnotation = previousSpan ? previousSpan.node.marks?.some((mark) => !decorators.includes(mark) && marks.includes(mark)) : !1, previousSpanHasSameMarks = previousSpan ? previousSpan.node.marks?.every((mark) => marks.includes(mark)) : !1, nextSpanSharesSomeAnnotations = spanAnnotations.some((mark) => nextSpanAnnotations?.includes(mark));\n  if (spanHasAnnotations && !spanIsEmpty) {\n    if (atTheBeginningOfSpan) {\n      if (previousSpanHasSameMarks)\n        return {\n          state: \"changed\",\n          previousMarks: marks,\n          marks: previousSpan?.node.marks ?? []\n        };\n      if (previousSpanHasSameAnnotations)\n        return {\n          state: \"changed\",\n          previousMarks: marks,\n          marks: previousSpan?.node.marks ?? []\n        };\n      if (previousSpanHasSameAnnotation)\n        return {\n          state: \"unchanged\",\n          marks: focusSpan.node.marks ?? []\n        };\n      if (!previousSpan)\n        return {\n          state: \"changed\",\n          previousMarks: marks,\n          marks: []\n        };\n    }\n    if (atTheEndOfSpan) {\n      if (!nextSpan)\n        return {\n          state: \"changed\",\n          previousMarks: marks,\n          marks: []\n        };\n      if (nextSpanAnnotations.length > 0 && !nextSpanSharesSomeAnnotations)\n        return {\n          state: \"changed\",\n          previousMarks: marks,\n          marks: []\n        };\n      if (nextSpanSharesSomeAnnotations && nextSpanAnnotations.length < spanAnnotations.length || !nextSpanSharesSomeAnnotations)\n        return {\n          state: \"changed\",\n          previousMarks: marks,\n          marks: nextSpan?.node.marks ?? []\n        };\n    }\n  }\n  return atTheBeginningOfSpan && !spanIsEmpty && previousSpan ? previousSpanHasAnnotations ? {\n    state: \"changed\",\n    marks,\n    previousMarks: previousSpan?.node.marks ?? []\n  } : {\n    state: \"changed\",\n    previousMarks: marks,\n    marks: (previousSpan?.node.marks ?? []).filter((mark) => decorators.includes(mark))\n  } : {\n    state: \"unchanged\",\n    marks\n  };\n};\nfunction getActiveAnnotationsMarks(snapshot) {\n  const schema = snapshot.context.schema;\n  return (getMarkState(snapshot)?.marks ?? []).filter((mark) => !schema.decorators.map((decorator) => decorator.name).includes(mark));\n}\nfunction getActiveDecorators(snapshot) {\n  const schema = snapshot.context.schema, decoratorState = snapshot.decoratorState, markState = getMarkState(snapshot), decorators = schema.decorators.map((decorator) => decorator.name);\n  let activeDecorators = (markState?.marks ?? []).filter((mark) => decorators.includes(mark));\n  for (const decorator in decoratorState)\n    decoratorState[decorator] === !1 ? activeDecorators = activeDecorators.filter((activeDecorator) => activeDecorator !== decorator) : decoratorState[decorator] === !0 && (activeDecorators.includes(decorator) || activeDecorators.push(decorator));\n  return activeDecorators;\n}\nfunction isActiveAnnotation(annotation, options) {\n  return (snapshot) => {\n    if ((options?.mode ?? \"full\") === \"partial\")\n      return getSelectedValue(snapshot).flatMap((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block) ? block.markDefs ?? [] : []).some((markDef) => markDef._type === annotation);\n    const selectionMarkDefs = getSelectedBlocks(snapshot).flatMap((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block.node) ? block.node.markDefs ?? [] : []), activeAnnotations = getActiveAnnotationsMarks(snapshot);\n    return selectionMarkDefs.filter((markDef) => markDef._type === annotation && activeAnnotations.includes(markDef._key)).length > 0;\n  };\n}\nconst getActiveAnnotations = (snapshot) => {\n  if (!snapshot.context.selection)\n    return [];\n  const selectedBlocks = getSelectedBlocks(snapshot), activeAnnotations = (getMarkState(snapshot)?.marks ?? []).filter((mark) => !snapshot.context.schema.decorators.map((decorator) => decorator.name).includes(mark));\n  return selectedBlocks.flatMap((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block.node) ? block.node.markDefs ?? [] : []).filter((markDef) => activeAnnotations.includes(markDef._key));\n}, getActiveListItem = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const selectedTextBlocks = getSelectedBlocks(snapshot).map((block) => block.node).filter((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block)), firstTextBlock = selectedTextBlocks.at(0);\n  if (!firstTextBlock)\n    return;\n  const firstListItem = firstTextBlock.listItem;\n  if (firstListItem && selectedTextBlocks.every((block) => block.listItem === firstListItem))\n    return firstListItem;\n}, getActiveStyle = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const selectedTextBlocks = getSelectedBlocks(snapshot).map((block) => block.node).filter((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block)), firstTextBlock = selectedTextBlocks.at(0);\n  if (!firstTextBlock)\n    return;\n  const firstStyle = firstTextBlock.style;\n  if (firstStyle && selectedTextBlocks.every((block) => block.style === firstStyle))\n    return firstStyle;\n}, getNextInlineObject = (snapshot) => {\n  const focusTextBlock = getFocusTextBlock(snapshot), selectionEndPoint = getSelectionEndPoint(snapshot), selectionEndPointChildKey = selectionEndPoint && (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isKeyedSegment)(selectionEndPoint.path[2]) ? selectionEndPoint.path[2]._key : void 0;\n  if (!focusTextBlock || !selectionEndPointChildKey)\n    return;\n  let endPointChildFound = !1, inlineObject;\n  for (const child of focusTextBlock.node.children) {\n    if (child._key === selectionEndPointChildKey) {\n      endPointChildFound = !0;\n      continue;\n    }\n    if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) && endPointChildFound) {\n      inlineObject = {\n        node: child,\n        path: [...focusTextBlock.path, \"children\", {\n          _key: child._key\n        }]\n      };\n      break;\n    }\n  }\n  return inlineObject;\n}, getPreviousInlineObject = (snapshot) => {\n  const focusTextBlock = getFocusTextBlock(snapshot), selectionStartPoint = getSelectionStartPoint(snapshot), selectionStartPointChildKey = selectionStartPoint && (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isKeyedSegment)(selectionStartPoint.path[2]) ? selectionStartPoint.path[2]._key : void 0;\n  if (!focusTextBlock || !selectionStartPointChildKey)\n    return;\n  let inlineObject;\n  for (const child of focusTextBlock.node.children) {\n    if (child._key === selectionStartPointChildKey)\n      break;\n    (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) || (inlineObject = {\n      node: child,\n      path: [...focusTextBlock.path, \"children\", {\n        _key: child._key\n      }]\n    });\n  }\n  return inlineObject;\n}, getSelectionText = (snapshot) => getSelectedValue(snapshot).reduce((text, block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block) ? text + block.children.reduce((text2, child) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) ? text2 + child.text : text2, \"\") : text, \"\"), getCaretWordSelection = (snapshot) => {\n  if (!snapshot.context.selection || !isSelectionCollapsed(snapshot))\n    return null;\n  const focusTextBlock = getFocusTextBlock(snapshot), selectionStartPoint = getSelectionStartPoint(snapshot), selectionStartOffset = selectionStartPoint ? (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.spanSelectionPointToBlockOffset)({\n    context: snapshot.context,\n    selectionPoint: selectionStartPoint\n  }) : void 0;\n  if (!focusTextBlock || !selectionStartPoint || !selectionStartOffset)\n    return null;\n  const previousInlineObject = getPreviousInlineObject(snapshot), blockStartPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockStartPoint)({\n    context: snapshot.context,\n    block: focusTextBlock\n  }), textDirectlyBefore = getSelectionText({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: previousInlineObject ? {\n          path: previousInlineObject.path,\n          offset: 0\n        } : blockStartPoint,\n        focus: selectionStartPoint\n      }\n    }\n  }).split(/\\s+/).at(-1), nextInlineObject = getNextInlineObject(snapshot), blockEndPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockEndPoint)({\n    context: snapshot.context,\n    block: focusTextBlock\n  }), textDirectlyAfter = getSelectionText({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: selectionStartPoint,\n        focus: nextInlineObject ? {\n          path: nextInlineObject.path,\n          offset: 0\n        } : blockEndPoint\n      }\n    }\n  }).split(/\\s+/).at(0);\n  if ((textDirectlyBefore === void 0 || textDirectlyBefore === \"\") && (textDirectlyAfter === void 0 || textDirectlyAfter === \"\"))\n    return null;\n  const caretWordStartOffset = textDirectlyBefore ? {\n    ...selectionStartOffset,\n    offset: selectionStartOffset.offset - textDirectlyBefore.length\n  } : selectionStartOffset, caretWordEndOffset = textDirectlyAfter ? {\n    ...selectionStartOffset,\n    offset: selectionStartOffset.offset + textDirectlyAfter.length\n  } : selectionStartOffset, caretWordStartSelectionPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.blockOffsetToSpanSelectionPoint)({\n    context: snapshot.context,\n    blockOffset: caretWordStartOffset,\n    direction: \"backward\"\n  }), caretWordEndSelectionPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.blockOffsetToSpanSelectionPoint)({\n    context: snapshot.context,\n    blockOffset: caretWordEndOffset,\n    direction: \"forward\"\n  });\n  if (!caretWordStartSelectionPoint || !caretWordEndSelectionPoint)\n    return null;\n  const caretWordSelection = {\n    anchor: caretWordStartSelectionPoint,\n    focus: caretWordEndSelectionPoint\n  };\n  return isSelectionExpanded$1({\n    context: {\n      ...snapshot.context,\n      selection: caretWordSelection\n    }\n  }) ? caretWordSelection : null;\n}, getFocusBlockObject = (snapshot) => {\n  const focusBlock = getFocusBlock(snapshot);\n  return focusBlock && !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, focusBlock.node) ? {\n    node: focusBlock.node,\n    path: focusBlock.path\n  } : void 0;\n}, getFocusListBlock = (snapshot) => {\n  const focusTextBlock = getFocusTextBlock(snapshot);\n  return focusTextBlock && (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isListBlock)(snapshot.context, focusTextBlock.node) ? {\n    node: focusTextBlock.node,\n    path: focusTextBlock.path\n  } : void 0;\n}, getLastBlock = (snapshot) => {\n  const node = snapshot.context.value[snapshot.context.value.length - 1] ? snapshot.context.value[snapshot.context.value.length - 1] : void 0;\n  return node ? {\n    node,\n    path: [{\n      _key: node._key\n    }]\n  } : void 0;\n}, getNextBlock = (snapshot) => {\n  const selectionEndBlock = getSelectionEndBlock(snapshot);\n  if (!selectionEndBlock)\n    return;\n  const index = snapshot.blockIndexMap.get(selectionEndBlock.node._key);\n  if (index === void 0 || index === snapshot.context.value.length - 1)\n    return;\n  const nextBlock = snapshot.context.value.at(index + 1);\n  return nextBlock ? {\n    node: nextBlock,\n    path: [{\n      _key: nextBlock._key\n    }]\n  } : void 0;\n}, getPreviousBlock = (snapshot) => {\n  const selectionStartBlock = getSelectionStartBlock(snapshot);\n  if (!selectionStartBlock)\n    return;\n  const index = snapshot.blockIndexMap.get(selectionStartBlock.node._key);\n  if (index === void 0 || index === 0)\n    return;\n  const previousBlock = snapshot.context.value.at(index - 1);\n  return previousBlock ? {\n    node: previousBlock,\n    path: [{\n      _key: previousBlock._key\n    }]\n  } : void 0;\n}, getSelectedTextBlocks = (snapshot) => {\n  if (!snapshot.context.selection)\n    return [];\n  const selectedTextBlocks = [], startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(snapshot.context.selection), endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(snapshot.context.selection), startBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(startPoint), endBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(endPoint);\n  if (!startBlockKey || !endBlockKey)\n    return selectedTextBlocks;\n  const startBlockIndex = snapshot.blockIndexMap.get(startBlockKey), endBlockIndex = snapshot.blockIndexMap.get(endBlockKey);\n  if (startBlockIndex === void 0 || endBlockIndex === void 0)\n    return selectedTextBlocks;\n  const slicedValue = snapshot.context.value.slice(startBlockIndex, endBlockIndex + 1);\n  for (const block of slicedValue) {\n    if (block._key === startBlockKey) {\n      if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block) && selectedTextBlocks.push({\n        node: block,\n        path: [{\n          _key: block._key\n        }]\n      }), startBlockKey === endBlockKey)\n        break;\n      continue;\n    }\n    if (block._key === endBlockKey) {\n      (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block) && selectedTextBlocks.push({\n        node: block,\n        path: [{\n          _key: block._key\n        }]\n      });\n      break;\n    }\n    selectedTextBlocks.length > 0 && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, block) && selectedTextBlocks.push({\n      node: block,\n      path: [{\n        _key: block._key\n      }]\n    });\n  }\n  return selectedTextBlocks;\n}, getSelectionEndChild = (snapshot) => {\n  const endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(snapshot.context.selection);\n  if (endPoint)\n    return getFocusChild({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: endPoint,\n          focus: endPoint\n        }\n      }\n    });\n}, getSelectionStartChild = (snapshot) => {\n  const startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(snapshot.context.selection);\n  if (startPoint)\n    return getFocusChild({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: startPoint,\n          focus: startPoint\n        }\n      }\n    });\n};\nfunction isActiveDecorator(decorator) {\n  return (snapshot) => {\n    if (isSelectionExpanded$1(snapshot)) {\n      const selectedSpans = getSelectedSpans(snapshot);\n      return selectedSpans.length > 0 && selectedSpans.every((span) => span.node.marks?.includes(decorator));\n    }\n    return getActiveDecorators(snapshot).includes(decorator);\n  };\n}\nfunction isActiveListItem(listItem) {\n  return (snapshot) => getActiveListItem(snapshot) === listItem;\n}\nfunction isActiveStyle(style) {\n  return (snapshot) => getActiveStyle(snapshot) === style;\n}\nfunction isAtTheEndOfBlock(block) {\n  return (snapshot) => {\n    if (!snapshot.context.selection || !isSelectionCollapsed(snapshot))\n      return !1;\n    const blockEndPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockEndPoint)({\n      context: snapshot.context,\n      block\n    });\n    return (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(snapshot.context.selection.focus, blockEndPoint);\n  };\n}\nfunction isAtTheStartOfBlock(block) {\n  return (snapshot) => {\n    if (!snapshot.context.selection || !isSelectionCollapsed(snapshot))\n      return !1;\n    const blockStartPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockStartPoint)({\n      context: snapshot.context,\n      block\n    });\n    return (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(snapshot.context.selection.focus, blockStartPoint);\n  };\n}\n\n//# sourceMappingURL=selector.is-at-the-start-of-block.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL19jaHVua3MtZXMvc2VsZWN0b3IuaXMtYXQtdGhlLXN0YXJ0LW9mLWJsb2NrLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMkQ7QUFDeVc7QUFDcGE7QUFDQTtBQUNBO0FBQ0EsY0FBYyxvRkFBNkI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKLENBQUM7QUFDRDtBQUNBLHVCQUF1QixpRUFBVztBQUNsQztBQUNBO0FBQ0EsSUFBSTtBQUNKLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxvRkFBNkI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKLENBQUM7QUFDRDtBQUNBLHdCQUF3Qiw0REFBTTtBQUM5QjtBQUNBO0FBQ0EsSUFBSTtBQUNKLENBQUM7QUFDRDtBQUNBLHVCQUF1Qiw0REFBTTtBQUM3QjtBQUNBO0FBQ0EsSUFBSTtBQUNKLENBQUM7QUFDRDtBQUNBO0FBQ0EsMENBQTBDLDZFQUF3Qix5Q0FBeUMsMkVBQXNCLHlDQUF5QyxvRkFBNkIsdUJBQXVCLG9GQUE2QjtBQUMzUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBLENBQUM7QUFDRCxtQkFBbUIsMkVBQXNCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0osQ0FBQztBQUNEO0FBQ0E7QUFDQSw4Q0FBOEMsNkVBQXdCLHlDQUF5QywyRUFBc0IsOENBQThDLG9GQUE2Qiw0QkFBNEIsb0ZBQTZCO0FBQ3pRO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLGlFQUFXO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLGlFQUFXO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1A7QUFDQTtBQUNBLHFDQUFxQyxpRUFBVztBQUNoRDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsbUJBQW1CLDJFQUFzQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0QscUJBQXFCLDZFQUF3QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHVFQUFnQjtBQUMxQztBQUNBO0FBQ0EsS0FBSztBQUNMLFdBQVcsNkVBQXNCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qix5RUFBa0I7QUFDOUM7QUFDQTtBQUNBLEtBQUs7QUFDTCxXQUFXLDZFQUFzQjtBQUNqQztBQUNBO0FBOENFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L2VkaXRvci9saWIvX2NodW5rcy1lcy9zZWxlY3Rvci5pcy1hdC10aGUtc3RhcnQtb2YtYmxvY2suanM/MjQ5OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1RleHRCbG9jaywgaXNTcGFuIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvc2NoZW1hXCI7XG5pbXBvcnQgeyBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludCwgZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQsIGdldFNlbGVjdGlvblN0YXJ0UG9pbnQgYXMgZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCQxLCBnZXRTZWxlY3Rpb25FbmRQb2ludCBhcyBnZXRTZWxlY3Rpb25FbmRQb2ludCQxLCBpc0VxdWFsU2VsZWN0aW9uUG9pbnRzLCBnZXRCbG9ja1N0YXJ0UG9pbnQsIGdldEJsb2NrRW5kUG9pbnQsIHNsaWNlQmxvY2tzLCBpc1NlbGVjdGlvbkNvbGxhcHNlZCBhcyBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxLCBibG9ja09mZnNldFRvU3BhblNlbGVjdGlvblBvaW50LCBpc0tleWVkU2VnbWVudCwgc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCwgaXNMaXN0QmxvY2sgfSBmcm9tIFwiLi91dGlsLnNsaWNlLWJsb2Nrcy5qc1wiO1xuY29uc3QgZ2V0Rm9jdXNCbG9jayA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybjtcbiAgY29uc3Qga2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMpLCBpbmRleCA9IGtleSA/IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KGtleSkgOiB2b2lkIDAsIG5vZGUgPSBpbmRleCAhPT0gdm9pZCAwID8gc25hcHNob3QuY29udGV4dC52YWx1ZS5hdChpbmRleCkgOiB2b2lkIDA7XG4gIHJldHVybiBub2RlICYmIGtleSA/IHtcbiAgICBub2RlLFxuICAgIHBhdGg6IFt7XG4gICAgICBfa2V5OiBrZXlcbiAgICB9XVxuICB9IDogdm9pZCAwO1xufSwgZ2V0Rm9jdXNUZXh0QmxvY2sgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3QgZm9jdXNCbG9jayA9IGdldEZvY3VzQmxvY2soc25hcHNob3QpO1xuICByZXR1cm4gZm9jdXNCbG9jayAmJiBpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBmb2N1c0Jsb2NrLm5vZGUpID8ge1xuICAgIG5vZGU6IGZvY3VzQmxvY2subm9kZSxcbiAgICBwYXRoOiBmb2N1c0Jsb2NrLnBhdGhcbiAgfSA6IHZvaWQgMDtcbn0sIGdldEZvY3VzQ2hpbGQgPSAoc25hcHNob3QpID0+IHtcbiAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICByZXR1cm47XG4gIGNvbnN0IGZvY3VzQmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCk7XG4gIGlmICghZm9jdXNCbG9jaylcbiAgICByZXR1cm47XG4gIGNvbnN0IGtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmZvY3VzKSwgbm9kZSA9IGtleSA/IGZvY3VzQmxvY2subm9kZS5jaGlsZHJlbi5maW5kKChzcGFuKSA9PiBzcGFuLl9rZXkgPT09IGtleSkgOiB2b2lkIDA7XG4gIHJldHVybiBub2RlICYmIGtleSA/IHtcbiAgICBub2RlLFxuICAgIHBhdGg6IFsuLi5mb2N1c0Jsb2NrLnBhdGgsIFwiY2hpbGRyZW5cIiwge1xuICAgICAgX2tleToga2V5XG4gICAgfV1cbiAgfSA6IHZvaWQgMDtcbn0sIGdldEZvY3VzSW5saW5lT2JqZWN0ID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IGZvY3VzQ2hpbGQgPSBnZXRGb2N1c0NoaWxkKHNuYXBzaG90KTtcbiAgcmV0dXJuIGZvY3VzQ2hpbGQgJiYgIWlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBmb2N1c0NoaWxkLm5vZGUpID8ge1xuICAgIG5vZGU6IGZvY3VzQ2hpbGQubm9kZSxcbiAgICBwYXRoOiBmb2N1c0NoaWxkLnBhdGhcbiAgfSA6IHZvaWQgMDtcbn0sIGdldEZvY3VzU3BhbiA9IChzbmFwc2hvdCkgPT4ge1xuICBjb25zdCBmb2N1c0NoaWxkID0gZ2V0Rm9jdXNDaGlsZChzbmFwc2hvdCk7XG4gIHJldHVybiBmb2N1c0NoaWxkICYmIGlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBmb2N1c0NoaWxkLm5vZGUpID8ge1xuICAgIG5vZGU6IGZvY3VzQ2hpbGQubm9kZSxcbiAgICBwYXRoOiBmb2N1c0NoaWxkLnBhdGhcbiAgfSA6IHZvaWQgMDtcbn0sIGdldFNlbGVjdGVkQmxvY2tzID0gKHNuYXBzaG90KSA9PiB7XG4gIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgcmV0dXJuIFtdO1xuICBjb25zdCBzZWxlY3RlZEJsb2NrcyA9IFtdLCBzdGFydFBvaW50ID0gZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCQxKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKSwgZW5kUG9pbnQgPSBnZXRTZWxlY3Rpb25FbmRQb2ludCQxKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKSwgc3RhcnRLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChzdGFydFBvaW50KSwgZW5kS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoZW5kUG9pbnQpO1xuICBpZiAoIXN0YXJ0S2V5IHx8ICFlbmRLZXkpXG4gICAgcmV0dXJuIHNlbGVjdGVkQmxvY2tzO1xuICBjb25zdCBzdGFydEJsb2NrSW5kZXggPSBzbmFwc2hvdC5ibG9ja0luZGV4TWFwLmdldChzdGFydEtleSksIGVuZEJsb2NrSW5kZXggPSBzbmFwc2hvdC5ibG9ja0luZGV4TWFwLmdldChlbmRLZXkpO1xuICBpZiAoc3RhcnRCbG9ja0luZGV4ID09PSB2b2lkIDAgfHwgZW5kQmxvY2tJbmRleCA9PT0gdm9pZCAwKVxuICAgIHJldHVybiBzZWxlY3RlZEJsb2NrcztcbiAgY29uc3Qgc2xpY2VkVmFsdWUgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLnNsaWNlKHN0YXJ0QmxvY2tJbmRleCwgZW5kQmxvY2tJbmRleCArIDEpO1xuICBmb3IgKGNvbnN0IGJsb2NrIG9mIHNsaWNlZFZhbHVlKSB7XG4gICAgaWYgKGJsb2NrLl9rZXkgPT09IHN0YXJ0S2V5KSB7XG4gICAgICBpZiAoc2VsZWN0ZWRCbG9ja3MucHVzaCh7XG4gICAgICAgIG5vZGU6IGJsb2NrLFxuICAgICAgICBwYXRoOiBbe1xuICAgICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgICAgfV1cbiAgICAgIH0pLCBzdGFydEtleSA9PT0gZW5kS2V5KVxuICAgICAgICBicmVhaztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoYmxvY2suX2tleSA9PT0gZW5kS2V5KSB7XG4gICAgICBzZWxlY3RlZEJsb2Nrcy5wdXNoKHtcbiAgICAgICAgbm9kZTogYmxvY2ssXG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9XVxuICAgICAgfSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgc2VsZWN0ZWRCbG9ja3MubGVuZ3RoID4gMCAmJiBzZWxlY3RlZEJsb2Nrcy5wdXNoKHtcbiAgICAgIG5vZGU6IGJsb2NrLFxuICAgICAgcGF0aDogW3tcbiAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgfV1cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gc2VsZWN0ZWRCbG9ja3M7XG59LCBnZXRTZWxlY3Rpb25FbmRCbG9jayA9IChzbmFwc2hvdCkgPT4ge1xuICBjb25zdCBlbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50JDEoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pO1xuICBpZiAoZW5kUG9pbnQpXG4gICAgcmV0dXJuIGdldEZvY3VzQmxvY2soe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjogZW5kUG9pbnQsXG4gICAgICAgICAgZm9jdXM6IGVuZFBvaW50XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbn0sIGdldFNlbGVjdGlvblN0YXJ0QmxvY2sgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3Qgc3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQkMShzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbik7XG4gIGlmIChzdGFydFBvaW50KVxuICAgIHJldHVybiBnZXRGb2N1c0Jsb2NrKHtcbiAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgY29udGV4dDoge1xuICAgICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgICBhbmNob3I6IHN0YXJ0UG9pbnQsXG4gICAgICAgICAgZm9jdXM6IHN0YXJ0UG9pbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xufSwgZ2V0U2VsZWN0aW9uRW5kUG9pbnQgPSAoc25hcHNob3QpID0+IHtcbiAgaWYgKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5iYWNrd2FyZCA/IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmFuY2hvciA6IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmZvY3VzO1xufSwgZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgcmV0dXJuIHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmJhY2t3YXJkID8gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMgOiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5hbmNob3I7XG59O1xuZnVuY3Rpb24gaXNQb2ludEFmdGVyU2VsZWN0aW9uKHBvaW50KSB7XG4gIHJldHVybiAoc25hcHNob3QpID0+IHtcbiAgICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGVuZFBvaW50ID0gZ2V0U2VsZWN0aW9uRW5kUG9pbnQkMShzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiksIGVuZEJsb2NrS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoZW5kUG9pbnQpLCBlbmRDaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KGVuZFBvaW50KSwgcG9pbnRCbG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHBvaW50KSwgcG9pbnRDaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHBvaW50KTtcbiAgICBpZiAoIXBvaW50QmxvY2tLZXkgfHwgIWVuZEJsb2NrS2V5KVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IHBvaW50QmxvY2tJbmRleCA9IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KHBvaW50QmxvY2tLZXkpLCBlbmRCbG9ja0luZGV4ID0gc25hcHNob3QuYmxvY2tJbmRleE1hcC5nZXQoZW5kQmxvY2tLZXkpO1xuICAgIGlmIChwb2ludEJsb2NrSW5kZXggPT09IHZvaWQgMCB8fCBlbmRCbG9ja0luZGV4ID09PSB2b2lkIDApXG4gICAgICByZXR1cm4gITE7XG4gICAgaWYgKHBvaW50QmxvY2tJbmRleCA+IGVuZEJsb2NrSW5kZXgpXG4gICAgICByZXR1cm4gITA7XG4gICAgaWYgKHBvaW50QmxvY2tJbmRleCA8IGVuZEJsb2NrSW5kZXgpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgcG9pbnRCbG9jayA9IHNuYXBzaG90LmNvbnRleHQudmFsdWUuYXQocG9pbnRCbG9ja0luZGV4KTtcbiAgICBpZiAoIXBvaW50QmxvY2sgfHwgIWlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIHBvaW50QmxvY2spKVxuICAgICAgcmV0dXJuICExO1xuICAgIGxldCBwb2ludENoaWxkSW5kZXgsIGVuZENoaWxkSW5kZXgsIGNoaWxkSW5kZXggPSAtMTtcbiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHBvaW50QmxvY2suY2hpbGRyZW4pIHtcbiAgICAgIGlmIChjaGlsZEluZGV4KyssIGNoaWxkLl9rZXkgPT09IHBvaW50Q2hpbGRLZXkgJiYgY2hpbGQuX2tleSA9PT0gZW5kQ2hpbGRLZXkpXG4gICAgICAgIHJldHVybiBwb2ludC5vZmZzZXQgPiBlbmRQb2ludC5vZmZzZXQ7XG4gICAgICBpZiAoY2hpbGQuX2tleSA9PT0gcG9pbnRDaGlsZEtleSAmJiAocG9pbnRDaGlsZEluZGV4ID0gY2hpbGRJbmRleCksIGNoaWxkLl9rZXkgPT09IGVuZENoaWxkS2V5ICYmIChlbmRDaGlsZEluZGV4ID0gY2hpbGRJbmRleCksIHBvaW50Q2hpbGRJbmRleCAhPT0gdm9pZCAwICYmIGVuZENoaWxkSW5kZXggIT09IHZvaWQgMClcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBwb2ludENoaWxkSW5kZXggPT09IHZvaWQgMCB8fCBlbmRDaGlsZEluZGV4ID09PSB2b2lkIDAgPyAhMSA6IHBvaW50Q2hpbGRJbmRleCA+IGVuZENoaWxkSW5kZXg7XG4gIH07XG59XG5mdW5jdGlvbiBpc1BvaW50QmVmb3JlU2VsZWN0aW9uKHBvaW50KSB7XG4gIHJldHVybiAoc25hcHNob3QpID0+IHtcbiAgICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IHN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50JDEoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pLCBzdGFydEJsb2NrS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc3RhcnRQb2ludCksIHN0YXJ0Q2hpbGRLZXkgPSBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludChzdGFydFBvaW50KSwgcG9pbnRCbG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHBvaW50KSwgcG9pbnRDaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHBvaW50KTtcbiAgICBpZiAoIXBvaW50QmxvY2tLZXkgfHwgIXN0YXJ0QmxvY2tLZXkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3Qgc3RhcnRCbG9ja0luZGV4ID0gc25hcHNob3QuYmxvY2tJbmRleE1hcC5nZXQoc3RhcnRCbG9ja0tleSksIHBvaW50QmxvY2tJbmRleCA9IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KHBvaW50QmxvY2tLZXkpO1xuICAgIGlmIChzdGFydEJsb2NrSW5kZXggPT09IHZvaWQgMCB8fCBwb2ludEJsb2NrSW5kZXggPT09IHZvaWQgMClcbiAgICAgIHJldHVybiAhMTtcbiAgICBpZiAocG9pbnRCbG9ja0luZGV4IDwgc3RhcnRCbG9ja0luZGV4KVxuICAgICAgcmV0dXJuICEwO1xuICAgIGlmIChwb2ludEJsb2NrSW5kZXggPiBzdGFydEJsb2NrSW5kZXgpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgcG9pbnRCbG9jayA9IHNuYXBzaG90LmNvbnRleHQudmFsdWUuYXQocG9pbnRCbG9ja0luZGV4KTtcbiAgICBpZiAoIXBvaW50QmxvY2sgfHwgIWlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIHBvaW50QmxvY2spKVxuICAgICAgcmV0dXJuICExO1xuICAgIGxldCBwb2ludENoaWxkSW5kZXgsIHN0YXJ0Q2hpbGRJbmRleCwgY2hpbGRJbmRleCA9IC0xO1xuICAgIGZvciAoY29uc3QgY2hpbGQgb2YgcG9pbnRCbG9jay5jaGlsZHJlbikge1xuICAgICAgaWYgKGNoaWxkSW5kZXgrKywgY2hpbGQuX2tleSA9PT0gcG9pbnRDaGlsZEtleSAmJiBjaGlsZC5fa2V5ID09PSBzdGFydENoaWxkS2V5KVxuICAgICAgICByZXR1cm4gcG9pbnQub2Zmc2V0IDwgc3RhcnRQb2ludC5vZmZzZXQ7XG4gICAgICBpZiAoY2hpbGQuX2tleSA9PT0gcG9pbnRDaGlsZEtleSAmJiAocG9pbnRDaGlsZEluZGV4ID0gY2hpbGRJbmRleCksIGNoaWxkLl9rZXkgPT09IHN0YXJ0Q2hpbGRLZXkgJiYgKHN0YXJ0Q2hpbGRJbmRleCA9IGNoaWxkSW5kZXgpLCBwb2ludENoaWxkSW5kZXggIT09IHZvaWQgMCAmJiBzdGFydENoaWxkSW5kZXggIT09IHZvaWQgMClcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBwb2ludENoaWxkSW5kZXggPT09IHZvaWQgMCB8fCBzdGFydENoaWxkSW5kZXggPT09IHZvaWQgMCA/ICExIDogcG9pbnRDaGlsZEluZGV4IDwgc3RhcnRDaGlsZEluZGV4O1xuICB9O1xufVxuZnVuY3Rpb24gaXNPdmVybGFwcGluZ1NlbGVjdGlvbihzZWxlY3Rpb24pIHtcbiAgcmV0dXJuIChzbmFwc2hvdCkgPT4ge1xuICAgIGlmICghc2VsZWN0aW9uIHx8ICFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBzZWxlY3Rpb25TdGFydFBvaW50ID0gZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCh7XG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvblxuICAgICAgfVxuICAgIH0pLCBzZWxlY3Rpb25FbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uXG4gICAgICB9XG4gICAgfSksIG9yaWdpbmFsU2VsZWN0aW9uU3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQoc25hcHNob3QpLCBvcmlnaW5hbFNlbGVjdGlvbkVuZFBvaW50ID0gZ2V0U2VsZWN0aW9uRW5kUG9pbnQoc25hcHNob3QpO1xuICAgIGlmICghc2VsZWN0aW9uU3RhcnRQb2ludCB8fCAhc2VsZWN0aW9uRW5kUG9pbnQgfHwgIW9yaWdpbmFsU2VsZWN0aW9uU3RhcnRQb2ludCB8fCAhb3JpZ2luYWxTZWxlY3Rpb25FbmRQb2ludClcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBzdGFydFBvaW50RXF1YWxUb09yaWdpbmFsU3RhcnRQb2ludCA9IGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMoc2VsZWN0aW9uU3RhcnRQb2ludCwgb3JpZ2luYWxTZWxlY3Rpb25TdGFydFBvaW50KSwgZW5kUG9pbnRFcXVhbFRvT3JpZ2luYWxFbmRQb2ludCA9IGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMoc2VsZWN0aW9uRW5kUG9pbnQsIG9yaWdpbmFsU2VsZWN0aW9uRW5kUG9pbnQpO1xuICAgIGlmIChzdGFydFBvaW50RXF1YWxUb09yaWdpbmFsU3RhcnRQb2ludCAmJiBlbmRQb2ludEVxdWFsVG9PcmlnaW5hbEVuZFBvaW50KVxuICAgICAgcmV0dXJuICEwO1xuICAgIGNvbnN0IHN0YXJ0UG9pbnRCZWZvcmVTZWxlY3Rpb24gPSBpc1BvaW50QmVmb3JlU2VsZWN0aW9uKHNlbGVjdGlvblN0YXJ0UG9pbnQpKHNuYXBzaG90KSwgc3RhcnRQb2ludEFmdGVyU2VsZWN0aW9uID0gaXNQb2ludEFmdGVyU2VsZWN0aW9uKHNlbGVjdGlvblN0YXJ0UG9pbnQpKHNuYXBzaG90KSwgZW5kUG9pbnRCZWZvcmVTZWxlY3Rpb24gPSBpc1BvaW50QmVmb3JlU2VsZWN0aW9uKHNlbGVjdGlvbkVuZFBvaW50KShzbmFwc2hvdCksIGVuZFBvaW50QWZ0ZXJTZWxlY3Rpb24gPSBpc1BvaW50QWZ0ZXJTZWxlY3Rpb24oc2VsZWN0aW9uRW5kUG9pbnQpKHNuYXBzaG90KSwgb3JpZ2luYWxTdGFydFBvaW50QmVmb3JlU3RhcnRQb2ludCA9IGlzUG9pbnRCZWZvcmVTZWxlY3Rpb24ob3JpZ2luYWxTZWxlY3Rpb25TdGFydFBvaW50KSh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiBzZWxlY3Rpb25TdGFydFBvaW50LFxuICAgICAgICAgIGZvY3VzOiBzZWxlY3Rpb25TdGFydFBvaW50XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSwgb3JpZ2luYWxTdGFydFBvaW50QWZ0ZXJTdGFydFBvaW50ID0gaXNQb2ludEFmdGVyU2VsZWN0aW9uKG9yaWdpbmFsU2VsZWN0aW9uU3RhcnRQb2ludCkoe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjogc2VsZWN0aW9uU3RhcnRQb2ludCxcbiAgICAgICAgICBmb2N1czogc2VsZWN0aW9uU3RhcnRQb2ludFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSksIG9yaWdpbmFsRW5kUG9pbnRCZWZvcmVFbmRQb2ludCA9IGlzUG9pbnRCZWZvcmVTZWxlY3Rpb24ob3JpZ2luYWxTZWxlY3Rpb25FbmRQb2ludCkoe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjogc2VsZWN0aW9uRW5kUG9pbnQsXG4gICAgICAgICAgZm9jdXM6IHNlbGVjdGlvbkVuZFBvaW50XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSwgb3JpZ2luYWxFbmRQb2ludEFmdGVyRW5kUG9pbnQgPSBpc1BvaW50QWZ0ZXJTZWxlY3Rpb24ob3JpZ2luYWxTZWxlY3Rpb25FbmRQb2ludCkoe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjogc2VsZWN0aW9uRW5kUG9pbnQsXG4gICAgICAgICAgZm9jdXM6IHNlbGVjdGlvbkVuZFBvaW50XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSwgc3RhcnRQb2ludEVxdWFsVG9PcmlnaW5hbEVuZFBvaW50ID0gaXNFcXVhbFNlbGVjdGlvblBvaW50cyhzZWxlY3Rpb25TdGFydFBvaW50LCBvcmlnaW5hbFNlbGVjdGlvbkVuZFBvaW50KSwgZW5kUG9pbnRFcXVhbFRvT3JpZ2luYWxTdGFydFBvaW50ID0gaXNFcXVhbFNlbGVjdGlvblBvaW50cyhzZWxlY3Rpb25FbmRQb2ludCwgb3JpZ2luYWxTZWxlY3Rpb25TdGFydFBvaW50KTtcbiAgICByZXR1cm4gIWVuZFBvaW50RXF1YWxUb09yaWdpbmFsU3RhcnRQb2ludCAmJiAhc3RhcnRQb2ludEVxdWFsVG9PcmlnaW5hbEVuZFBvaW50ICYmICFvcmlnaW5hbFN0YXJ0UG9pbnRCZWZvcmVTdGFydFBvaW50ICYmICFvcmlnaW5hbFN0YXJ0UG9pbnRBZnRlclN0YXJ0UG9pbnQgJiYgIW9yaWdpbmFsRW5kUG9pbnRCZWZvcmVFbmRQb2ludCAmJiAhb3JpZ2luYWxFbmRQb2ludEFmdGVyRW5kUG9pbnQgfHwgZW5kUG9pbnRCZWZvcmVTZWxlY3Rpb24gJiYgIWVuZFBvaW50RXF1YWxUb09yaWdpbmFsU3RhcnRQb2ludCB8fCBzdGFydFBvaW50QWZ0ZXJTZWxlY3Rpb24gJiYgIXN0YXJ0UG9pbnRFcXVhbFRvT3JpZ2luYWxFbmRQb2ludCA/ICExIDogIW9yaWdpbmFsU3RhcnRQb2ludEJlZm9yZVN0YXJ0UG9pbnQgJiYgb3JpZ2luYWxTdGFydFBvaW50QWZ0ZXJTdGFydFBvaW50ICYmICFvcmlnaW5hbEVuZFBvaW50QmVmb3JlRW5kUG9pbnQgJiYgb3JpZ2luYWxFbmRQb2ludEFmdGVyRW5kUG9pbnQgPyAhZW5kUG9pbnRFcXVhbFRvT3JpZ2luYWxTdGFydFBvaW50IDogb3JpZ2luYWxTdGFydFBvaW50QmVmb3JlU3RhcnRQb2ludCAmJiAhb3JpZ2luYWxTdGFydFBvaW50QWZ0ZXJTdGFydFBvaW50ICYmIG9yaWdpbmFsRW5kUG9pbnRCZWZvcmVFbmRQb2ludCAmJiAhb3JpZ2luYWxFbmRQb2ludEFmdGVyRW5kUG9pbnQgPyAhc3RhcnRQb2ludEVxdWFsVG9PcmlnaW5hbEVuZFBvaW50IDogIXN0YXJ0UG9pbnRBZnRlclNlbGVjdGlvbiB8fCAhc3RhcnRQb2ludEJlZm9yZVNlbGVjdGlvbiB8fCAhZW5kUG9pbnRBZnRlclNlbGVjdGlvbiB8fCAhZW5kUG9pbnRCZWZvcmVTZWxlY3Rpb247XG4gIH07XG59XG5jb25zdCBpc1NlbGVjdGlvbkNvbGxhcHNlZCA9IChzbmFwc2hvdCkgPT4gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24gPyBKU09OLnN0cmluZ2lmeShzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5hbmNob3IucGF0aCkgPT09IEpTT04uc3RyaW5naWZ5KHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmZvY3VzLnBhdGgpICYmIHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uPy5hbmNob3Iub2Zmc2V0ID09PSBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbj8uZm9jdXMub2Zmc2V0IDogITEsIGlzU2VsZWN0aW9uRXhwYW5kZWQkMSA9IChzbmFwc2hvdCkgPT4gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24gIT09IG51bGwgJiYgIWlzU2VsZWN0aW9uQ29sbGFwc2VkKHNuYXBzaG90KSwgaXNTZWxlY3RpbmdFbnRpcmVCbG9ja3MgPSAoc25hcHNob3QpID0+IHtcbiAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICByZXR1cm4gITE7XG4gIGNvbnN0IHN0YXJ0UG9pbnQgPSBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5iYWNrd2FyZCA/IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmZvY3VzIDogc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uYW5jaG9yLCBlbmRQb2ludCA9IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmJhY2t3YXJkID8gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uYW5jaG9yIDogc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMsIHN0YXJ0QmxvY2sgPSBnZXRTZWxlY3Rpb25TdGFydEJsb2NrKHNuYXBzaG90KSwgZW5kQmxvY2sgPSBnZXRTZWxlY3Rpb25FbmRCbG9jayhzbmFwc2hvdCk7XG4gIGlmICghc3RhcnRCbG9jayB8fCAhZW5kQmxvY2spXG4gICAgcmV0dXJuICExO1xuICBjb25zdCBzdGFydEJsb2NrU3RhcnRQb2ludCA9IGdldEJsb2NrU3RhcnRQb2ludCh7XG4gICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICBibG9jazogc3RhcnRCbG9ja1xuICB9KSwgZW5kQmxvY2tFbmRQb2ludCA9IGdldEJsb2NrRW5kUG9pbnQoe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2s6IGVuZEJsb2NrXG4gIH0pO1xuICByZXR1cm4gaXNFcXVhbFNlbGVjdGlvblBvaW50cyhzdGFydEJsb2NrU3RhcnRQb2ludCwgc3RhcnRQb2ludCkgJiYgaXNFcXVhbFNlbGVjdGlvblBvaW50cyhlbmRCbG9ja0VuZFBvaW50LCBlbmRQb2ludCk7XG59LCBnZXRTZWxlY3RlZFZhbHVlID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IHNlbGVjdGlvbiA9IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uO1xuICBpZiAoIXNlbGVjdGlvbilcbiAgICByZXR1cm4gW107XG4gIGNvbnN0IHN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50JDEoc2VsZWN0aW9uKSwgZW5kUG9pbnQgPSBnZXRTZWxlY3Rpb25FbmRQb2ludCQxKHNlbGVjdGlvbiksIHN0YXJ0QmxvY2tLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChzdGFydFBvaW50KSwgZW5kQmxvY2tLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChlbmRQb2ludCk7XG4gIGlmICghc3RhcnRCbG9ja0tleSB8fCAhZW5kQmxvY2tLZXkpXG4gICAgcmV0dXJuIFtdO1xuICBjb25zdCBzdGFydEJsb2NrSW5kZXggPSBzbmFwc2hvdC5ibG9ja0luZGV4TWFwLmdldChzdGFydEJsb2NrS2V5KSwgZW5kQmxvY2tJbmRleCA9IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KGVuZEJsb2NrS2V5KTtcbiAgaWYgKHN0YXJ0QmxvY2tJbmRleCA9PT0gdm9pZCAwIHx8IGVuZEJsb2NrSW5kZXggPT09IHZvaWQgMClcbiAgICByZXR1cm4gW107XG4gIGNvbnN0IHN0YXJ0QmxvY2sgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLmF0KHN0YXJ0QmxvY2tJbmRleCksIHNsaWNlZFN0YXJ0QmxvY2sgPSBzdGFydEJsb2NrID8gc2xpY2VCbG9ja3Moe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2tzOiBbc3RhcnRCbG9ja11cbiAgfSkuYXQoMCkgOiB2b2lkIDA7XG4gIGlmIChzdGFydEJsb2NrSW5kZXggPT09IGVuZEJsb2NrSW5kZXgpXG4gICAgcmV0dXJuIHNsaWNlZFN0YXJ0QmxvY2sgPyBbc2xpY2VkU3RhcnRCbG9ja10gOiBbXTtcbiAgY29uc3QgZW5kQmxvY2sgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLmF0KGVuZEJsb2NrSW5kZXgpLCBzbGljZWRFbmRCbG9jayA9IGVuZEJsb2NrID8gc2xpY2VCbG9ja3Moe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2tzOiBbZW5kQmxvY2tdXG4gIH0pLmF0KDApIDogdm9pZCAwLCBtaWRkbGVCbG9ja3MgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLnNsaWNlKHN0YXJ0QmxvY2tJbmRleCArIDEsIGVuZEJsb2NrSW5kZXgpO1xuICByZXR1cm4gWy4uLnNsaWNlZFN0YXJ0QmxvY2sgPyBbc2xpY2VkU3RhcnRCbG9ja10gOiBbXSwgLi4ubWlkZGxlQmxvY2tzLCAuLi5zbGljZWRFbmRCbG9jayA/IFtzbGljZWRFbmRCbG9ja10gOiBbXV07XG59O1xuZnVuY3Rpb24gaXNCbG9ja1BhdGgocGF0aCkge1xuICBjb25zdCBmaXJzdFNlZ21lbnQgPSBwYXRoLmF0KDApO1xuICByZXR1cm4gcGF0aC5sZW5ndGggPT09IDEgJiYgZmlyc3RTZWdtZW50ICE9PSB2b2lkIDAgJiYgaXNSZWNvcmQoZmlyc3RTZWdtZW50KSAmJiBcIl9rZXlcIiBpbiBmaXJzdFNlZ21lbnQgJiYgdHlwZW9mIGZpcnN0U2VnbWVudC5fa2V5ID09IFwic3RyaW5nXCI7XG59XG5mdW5jdGlvbiBpc1JlY29yZCh2YWx1ZSkge1xuICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZW9mIHZhbHVlID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHZhbHVlID09IFwiZnVuY3Rpb25cIik7XG59XG5mdW5jdGlvbiBpc1NlbGVjdGlvbkV4cGFuZGVkKHNlbGVjdGlvbikge1xuICByZXR1cm4gc2VsZWN0aW9uID8gIWlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc2VsZWN0aW9uKSA6ICExO1xufVxuY29uc3QgZ2V0TmV4dFNwYW4gPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3Qgc2VsZWN0aW9uRW5kQmxvY2sgPSBnZXRTZWxlY3Rpb25FbmRCbG9jayhzbmFwc2hvdCksIHNlbGVjdGlvbkVuZFBvaW50ID0gZ2V0U2VsZWN0aW9uRW5kUG9pbnQoc25hcHNob3QpO1xuICBpZiAoIXNlbGVjdGlvbkVuZEJsb2NrIHx8ICFzZWxlY3Rpb25FbmRQb2ludCB8fCAhaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgc2VsZWN0aW9uRW5kQmxvY2subm9kZSkpXG4gICAgcmV0dXJuO1xuICBjb25zdCBzZWxlY3Rpb25FbmRQb2ludENoaWxkS2V5ID0gZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc2VsZWN0aW9uRW5kUG9pbnQpO1xuICBsZXQgZW5kUG9pbnRDaGlsZEZvdW5kID0gITEsIG5leHRTcGFuO1xuICBmb3IgKGNvbnN0IGNoaWxkIG9mIHNlbGVjdGlvbkVuZEJsb2NrLm5vZGUuY2hpbGRyZW4pIHtcbiAgICBpZiAoY2hpbGQuX2tleSA9PT0gc2VsZWN0aW9uRW5kUG9pbnRDaGlsZEtleSkge1xuICAgICAgZW5kUG9pbnRDaGlsZEZvdW5kID0gITA7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKGlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBjaGlsZCkgJiYgZW5kUG9pbnRDaGlsZEZvdW5kKSB7XG4gICAgICBuZXh0U3BhbiA9IHtcbiAgICAgICAgbm9kZTogY2hpbGQsXG4gICAgICAgIHBhdGg6IFsuLi5zZWxlY3Rpb25FbmRCbG9jay5wYXRoLCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgICAgIH1dXG4gICAgICB9O1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXh0U3Bhbjtcbn0sIGdldFByZXZpb3VzU3BhbiA9IChzbmFwc2hvdCkgPT4ge1xuICBjb25zdCBzZWxlY3Rpb25TdGFydEJsb2NrID0gZ2V0U2VsZWN0aW9uU3RhcnRCbG9jayhzbmFwc2hvdCksIHNlbGVjdGlvblN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50KHNuYXBzaG90KTtcbiAgaWYgKCFzZWxlY3Rpb25TdGFydEJsb2NrIHx8ICFzZWxlY3Rpb25TdGFydFBvaW50IHx8ICFpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBzZWxlY3Rpb25TdGFydEJsb2NrLm5vZGUpKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2VsZWN0aW9uU3RhcnRQb2ludENoaWxkS2V5ID0gZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc2VsZWN0aW9uU3RhcnRQb2ludCk7XG4gIGxldCBwcmV2aW91c1NwYW47XG4gIGZvciAoY29uc3QgY2hpbGQgb2Ygc2VsZWN0aW9uU3RhcnRCbG9jay5ub2RlLmNoaWxkcmVuKSB7XG4gICAgaWYgKGNoaWxkLl9rZXkgPT09IHNlbGVjdGlvblN0YXJ0UG9pbnRDaGlsZEtleSlcbiAgICAgIGJyZWFrO1xuICAgIGlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBjaGlsZCkgJiYgKHByZXZpb3VzU3BhbiA9IHtcbiAgICAgIG5vZGU6IGNoaWxkLFxuICAgICAgcGF0aDogWy4uLnNlbGVjdGlvblN0YXJ0QmxvY2sucGF0aCwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICAgIH1dXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHByZXZpb3VzU3Bhbjtcbn0sIGdldFNlbGVjdGVkU3BhbnMgPSAoc25hcHNob3QpID0+IHtcbiAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICByZXR1cm4gW107XG4gIGNvbnN0IHNlbGVjdGVkU3BhbnMgPSBbXSwgc3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQoc25hcHNob3QpLCBlbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KHNuYXBzaG90KTtcbiAgaWYgKCFzdGFydFBvaW50IHx8ICFlbmRQb2ludClcbiAgICByZXR1cm4gc2VsZWN0ZWRTcGFucztcbiAgY29uc3Qgc3RhcnRCbG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHN0YXJ0UG9pbnQpLCBlbmRCbG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KGVuZFBvaW50KSwgc3RhcnRTcGFuS2V5ID0gZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc3RhcnRQb2ludCksIGVuZFNwYW5LZXkgPSBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludChlbmRQb2ludCk7XG4gIGlmICghc3RhcnRCbG9ja0tleSB8fCAhZW5kQmxvY2tLZXkpXG4gICAgcmV0dXJuIHNlbGVjdGVkU3BhbnM7XG4gIGNvbnN0IHN0YXJ0QmxvY2tJbmRleCA9IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KHN0YXJ0QmxvY2tLZXkpLCBlbmRCbG9ja0luZGV4ID0gc25hcHNob3QuYmxvY2tJbmRleE1hcC5nZXQoZW5kQmxvY2tLZXkpO1xuICBpZiAoc3RhcnRCbG9ja0luZGV4ID09PSB2b2lkIDAgfHwgZW5kQmxvY2tJbmRleCA9PT0gdm9pZCAwKVxuICAgIHJldHVybiBzZWxlY3RlZFNwYW5zO1xuICBjb25zdCBzbGljZWRWYWx1ZSA9IHNuYXBzaG90LmNvbnRleHQudmFsdWUuc2xpY2Uoc3RhcnRCbG9ja0luZGV4LCBlbmRCbG9ja0luZGV4ICsgMSk7XG4gIGxldCBzdGFydEJsb2NrRm91bmQgPSAhMTtcbiAgZm9yIChjb25zdCBibG9jayBvZiBzbGljZWRWYWx1ZSlcbiAgICBpZiAoYmxvY2suX2tleSA9PT0gc3RhcnRCbG9ja0tleSAmJiAoc3RhcnRCbG9ja0ZvdW5kID0gITApLCAhIWlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSkge1xuICAgICAgaWYgKGJsb2NrLl9rZXkgPT09IHN0YXJ0QmxvY2tLZXkpIHtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbilcbiAgICAgICAgICBpZiAoaXNTcGFuKHNuYXBzaG90LmNvbnRleHQsIGNoaWxkKSkge1xuICAgICAgICAgICAgaWYgKHN0YXJ0U3BhbktleSAmJiBjaGlsZC5fa2V5ID09PSBzdGFydFNwYW5LZXkpIHtcbiAgICAgICAgICAgICAgaWYgKHN0YXJ0UG9pbnQub2Zmc2V0IDwgY2hpbGQudGV4dC5sZW5ndGggJiYgc2VsZWN0ZWRTcGFucy5wdXNoKHtcbiAgICAgICAgICAgICAgICBub2RlOiBjaGlsZCxcbiAgICAgICAgICAgICAgICBwYXRoOiBbe1xuICAgICAgICAgICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgIH0pLCBzdGFydFNwYW5LZXkgPT09IGVuZFNwYW5LZXkpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVuZFNwYW5LZXkgJiYgY2hpbGQuX2tleSA9PT0gZW5kU3BhbktleSkge1xuICAgICAgICAgICAgICBlbmRQb2ludC5vZmZzZXQgPiAwICYmIHNlbGVjdGVkU3BhbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgbm9kZTogY2hpbGQsXG4gICAgICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgICAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICAgICAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxlY3RlZFNwYW5zLmxlbmd0aCA+IDAgJiYgc2VsZWN0ZWRTcGFucy5wdXNoKHtcbiAgICAgICAgICAgICAgbm9kZTogY2hpbGQsXG4gICAgICAgICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICAgICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIGlmIChzdGFydEJsb2NrS2V5ID09PSBlbmRCbG9ja0tleSlcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoYmxvY2suX2tleSA9PT0gZW5kQmxvY2tLZXkpIHtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbilcbiAgICAgICAgICBpZiAoaXNTcGFuKHNuYXBzaG90LmNvbnRleHQsIGNoaWxkKSkge1xuICAgICAgICAgICAgaWYgKGVuZFNwYW5LZXkgJiYgY2hpbGQuX2tleSA9PT0gZW5kU3BhbktleSkge1xuICAgICAgICAgICAgICBlbmRQb2ludC5vZmZzZXQgPiAwICYmIHNlbGVjdGVkU3BhbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgbm9kZTogY2hpbGQsXG4gICAgICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgICAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICAgICAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxlY3RlZFNwYW5zLnB1c2goe1xuICAgICAgICAgICAgICBub2RlOiBjaGlsZCxcbiAgICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoc3RhcnRCbG9ja0ZvdW5kKVxuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGJsb2NrLmNoaWxkcmVuKVxuICAgICAgICAgIGlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBjaGlsZCkgJiYgc2VsZWN0ZWRTcGFucy5wdXNoKHtcbiAgICAgICAgICAgIG5vZGU6IGNoaWxkLFxuICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICAgICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfSk7XG4gICAgfVxuICByZXR1cm4gc2VsZWN0ZWRTcGFucztcbn0sIGdldE1hcmtTdGF0ZSA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybjtcbiAgbGV0IHNlbGVjdGlvbiA9IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uO1xuICBpZiAoIWdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KSlcbiAgICByZXR1cm47XG4gIGlmIChpc0Jsb2NrUGF0aChzZWxlY3Rpb24uYW5jaG9yLnBhdGgpKSB7XG4gICAgY29uc3Qgc3BhblNlbGVjdGlvblBvaW50ID0gYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2tPZmZzZXQ6IHtcbiAgICAgICAgcGF0aDogc2VsZWN0aW9uLmFuY2hvci5wYXRoLFxuICAgICAgICBvZmZzZXQ6IHNlbGVjdGlvbi5hbmNob3Iub2Zmc2V0XG4gICAgICB9LFxuICAgICAgZGlyZWN0aW9uOiBzZWxlY3Rpb24uYmFja3dhcmQgPyBcImJhY2t3YXJkXCIgOiBcImZvcndhcmRcIlxuICAgIH0pO1xuICAgIHNlbGVjdGlvbiA9IHNwYW5TZWxlY3Rpb25Qb2ludCA/IHtcbiAgICAgIC4uLnNlbGVjdGlvbixcbiAgICAgIGFuY2hvcjogc3BhblNlbGVjdGlvblBvaW50XG4gICAgfSA6IHNlbGVjdGlvbjtcbiAgfVxuICBpZiAoaXNCbG9ja1BhdGgoc2VsZWN0aW9uLmZvY3VzLnBhdGgpKSB7XG4gICAgY29uc3Qgc3BhblNlbGVjdGlvblBvaW50ID0gYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2tPZmZzZXQ6IHtcbiAgICAgICAgcGF0aDogc2VsZWN0aW9uLmZvY3VzLnBhdGgsXG4gICAgICAgIG9mZnNldDogc2VsZWN0aW9uLmZvY3VzLm9mZnNldFxuICAgICAgfSxcbiAgICAgIGRpcmVjdGlvbjogc2VsZWN0aW9uLmJhY2t3YXJkID8gXCJiYWNrd2FyZFwiIDogXCJmb3J3YXJkXCJcbiAgICB9KTtcbiAgICBzZWxlY3Rpb24gPSBzcGFuU2VsZWN0aW9uUG9pbnQgPyB7XG4gICAgICAuLi5zZWxlY3Rpb24sXG4gICAgICBmb2N1czogc3BhblNlbGVjdGlvblBvaW50XG4gICAgfSA6IHNlbGVjdGlvbjtcbiAgfVxuICBjb25zdCBmb2N1c1NwYW4gPSBnZXRGb2N1c1NwYW4oe1xuICAgIC4uLnNuYXBzaG90LFxuICAgIGNvbnRleHQ6IHtcbiAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICBzZWxlY3Rpb25cbiAgICB9XG4gIH0pO1xuICBpZiAoIWZvY3VzU3BhbilcbiAgICByZXR1cm47XG4gIGlmIChpc1NlbGVjdGlvbkV4cGFuZGVkKHNlbGVjdGlvbikpIHtcbiAgICBjb25zdCBzZWxlY3RlZFNwYW5zID0gZ2V0U2VsZWN0ZWRTcGFucyh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uXG4gICAgICB9XG4gICAgfSk7XG4gICAgbGV0IGluZGV4ID0gMCwgbWFya3MyID0gW107XG4gICAgZm9yIChjb25zdCBzcGFuIG9mIHNlbGVjdGVkU3BhbnMpIHtcbiAgICAgIGlmIChpbmRleCA9PT0gMClcbiAgICAgICAgbWFya3MyID0gc3Bhbi5ub2RlLm1hcmtzID8/IFtdO1xuICAgICAgZWxzZSB7XG4gICAgICAgIGlmIChzcGFuLm5vZGUubWFya3M/Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIG1hcmtzMiA9IFtdO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIG1hcmtzMiA9IG1hcmtzMi5maWx0ZXIoKG1hcmspID0+IChzcGFuLm5vZGUubWFya3MgPz8gW10pLnNvbWUoKHNwYW5NYXJrKSA9PiBzcGFuTWFyayA9PT0gbWFyaykpO1xuICAgICAgfVxuICAgICAgaW5kZXgrKztcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRlOiBcInVuY2hhbmdlZFwiLFxuICAgICAgbWFya3M6IG1hcmtzMlxuICAgIH07XG4gIH1cbiAgY29uc3QgZGVjb3JhdG9ycyA9IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmRlY29yYXRvcnMubWFwKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lKSwgbWFya3MgPSBmb2N1c1NwYW4ubm9kZS5tYXJrcyA/PyBbXSwgbWFya3NXaXRob3V0QW5ub3RhdGlvbnMgPSBtYXJrcy5maWx0ZXIoKG1hcmspID0+IGRlY29yYXRvcnMuaW5jbHVkZXMobWFyaykpLCBzcGFuSGFzQW5ub3RhdGlvbnMgPSBtYXJrcy5sZW5ndGggPiBtYXJrc1dpdGhvdXRBbm5vdGF0aW9ucy5sZW5ndGgsIHNwYW5Jc0VtcHR5ID0gZm9jdXNTcGFuLm5vZGUudGV4dC5sZW5ndGggPT09IDAsIGF0VGhlQmVnaW5uaW5nT2ZTcGFuID0gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uYW5jaG9yLm9mZnNldCA9PT0gMCwgYXRUaGVFbmRPZlNwYW4gPSBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5hbmNob3Iub2Zmc2V0ID09PSBmb2N1c1NwYW4ubm9kZS50ZXh0Lmxlbmd0aCwgcHJldmlvdXNTcGFuID0gZ2V0UHJldmlvdXNTcGFuKHtcbiAgICAuLi5zbmFwc2hvdCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uXG4gICAgfVxuICB9KSwgbmV4dFNwYW4gPSBnZXROZXh0U3Bhbih7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvblxuICAgIH1cbiAgfSksIG5leHRTcGFuQW5ub3RhdGlvbnMgPSBuZXh0U3Bhbj8ubm9kZT8ubWFya3M/LmZpbHRlcigobWFyaykgPT4gIWRlY29yYXRvcnMuaW5jbHVkZXMobWFyaykpID8/IFtdLCBzcGFuQW5ub3RhdGlvbnMgPSBtYXJrcy5maWx0ZXIoKG1hcmspID0+ICFkZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspKSwgcHJldmlvdXNTcGFuSGFzQW5ub3RhdGlvbnMgPSBwcmV2aW91c1NwYW4gPyBwcmV2aW91c1NwYW4ubm9kZS5tYXJrcz8uc29tZSgobWFyaykgPT4gIWRlY29yYXRvcnMuaW5jbHVkZXMobWFyaykpIDogITEsIHByZXZpb3VzU3Bhbkhhc1NhbWVBbm5vdGF0aW9ucyA9IHByZXZpb3VzU3BhbiA/IHByZXZpb3VzU3Bhbi5ub2RlLm1hcmtzPy5maWx0ZXIoKG1hcmspID0+ICFkZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspKS5ldmVyeSgobWFyaykgPT4gbWFya3MuaW5jbHVkZXMobWFyaykpIDogITEsIHByZXZpb3VzU3Bhbkhhc1NhbWVBbm5vdGF0aW9uID0gcHJldmlvdXNTcGFuID8gcHJldmlvdXNTcGFuLm5vZGUubWFya3M/LnNvbWUoKG1hcmspID0+ICFkZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspICYmIG1hcmtzLmluY2x1ZGVzKG1hcmspKSA6ICExLCBwcmV2aW91c1NwYW5IYXNTYW1lTWFya3MgPSBwcmV2aW91c1NwYW4gPyBwcmV2aW91c1NwYW4ubm9kZS5tYXJrcz8uZXZlcnkoKG1hcmspID0+IG1hcmtzLmluY2x1ZGVzKG1hcmspKSA6ICExLCBuZXh0U3BhblNoYXJlc1NvbWVBbm5vdGF0aW9ucyA9IHNwYW5Bbm5vdGF0aW9ucy5zb21lKChtYXJrKSA9PiBuZXh0U3BhbkFubm90YXRpb25zPy5pbmNsdWRlcyhtYXJrKSk7XG4gIGlmIChzcGFuSGFzQW5ub3RhdGlvbnMgJiYgIXNwYW5Jc0VtcHR5KSB7XG4gICAgaWYgKGF0VGhlQmVnaW5uaW5nT2ZTcGFuKSB7XG4gICAgICBpZiAocHJldmlvdXNTcGFuSGFzU2FtZU1hcmtzKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXRlOiBcImNoYW5nZWRcIixcbiAgICAgICAgICBwcmV2aW91c01hcmtzOiBtYXJrcyxcbiAgICAgICAgICBtYXJrczogcHJldmlvdXNTcGFuPy5ub2RlLm1hcmtzID8/IFtdXG4gICAgICAgIH07XG4gICAgICBpZiAocHJldmlvdXNTcGFuSGFzU2FtZUFubm90YXRpb25zKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXRlOiBcImNoYW5nZWRcIixcbiAgICAgICAgICBwcmV2aW91c01hcmtzOiBtYXJrcyxcbiAgICAgICAgICBtYXJrczogcHJldmlvdXNTcGFuPy5ub2RlLm1hcmtzID8/IFtdXG4gICAgICAgIH07XG4gICAgICBpZiAocHJldmlvdXNTcGFuSGFzU2FtZUFubm90YXRpb24pXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhdGU6IFwidW5jaGFuZ2VkXCIsXG4gICAgICAgICAgbWFya3M6IGZvY3VzU3Bhbi5ub2RlLm1hcmtzID8/IFtdXG4gICAgICAgIH07XG4gICAgICBpZiAoIXByZXZpb3VzU3BhbilcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0ZTogXCJjaGFuZ2VkXCIsXG4gICAgICAgICAgcHJldmlvdXNNYXJrczogbWFya3MsXG4gICAgICAgICAgbWFya3M6IFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIGlmIChhdFRoZUVuZE9mU3Bhbikge1xuICAgICAgaWYgKCFuZXh0U3BhbilcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0ZTogXCJjaGFuZ2VkXCIsXG4gICAgICAgICAgcHJldmlvdXNNYXJrczogbWFya3MsXG4gICAgICAgICAgbWFya3M6IFtdXG4gICAgICAgIH07XG4gICAgICBpZiAobmV4dFNwYW5Bbm5vdGF0aW9ucy5sZW5ndGggPiAwICYmICFuZXh0U3BhblNoYXJlc1NvbWVBbm5vdGF0aW9ucylcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0ZTogXCJjaGFuZ2VkXCIsXG4gICAgICAgICAgcHJldmlvdXNNYXJrczogbWFya3MsXG4gICAgICAgICAgbWFya3M6IFtdXG4gICAgICAgIH07XG4gICAgICBpZiAobmV4dFNwYW5TaGFyZXNTb21lQW5ub3RhdGlvbnMgJiYgbmV4dFNwYW5Bbm5vdGF0aW9ucy5sZW5ndGggPCBzcGFuQW5ub3RhdGlvbnMubGVuZ3RoIHx8ICFuZXh0U3BhblNoYXJlc1NvbWVBbm5vdGF0aW9ucylcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0ZTogXCJjaGFuZ2VkXCIsXG4gICAgICAgICAgcHJldmlvdXNNYXJrczogbWFya3MsXG4gICAgICAgICAgbWFya3M6IG5leHRTcGFuPy5ub2RlLm1hcmtzID8/IFtdXG4gICAgICAgIH07XG4gICAgfVxuICB9XG4gIHJldHVybiBhdFRoZUJlZ2lubmluZ09mU3BhbiAmJiAhc3BhbklzRW1wdHkgJiYgcHJldmlvdXNTcGFuID8gcHJldmlvdXNTcGFuSGFzQW5ub3RhdGlvbnMgPyB7XG4gICAgc3RhdGU6IFwiY2hhbmdlZFwiLFxuICAgIG1hcmtzLFxuICAgIHByZXZpb3VzTWFya3M6IHByZXZpb3VzU3Bhbj8ubm9kZS5tYXJrcyA/PyBbXVxuICB9IDoge1xuICAgIHN0YXRlOiBcImNoYW5nZWRcIixcbiAgICBwcmV2aW91c01hcmtzOiBtYXJrcyxcbiAgICBtYXJrczogKHByZXZpb3VzU3Bhbj8ubm9kZS5tYXJrcyA/PyBbXSkuZmlsdGVyKChtYXJrKSA9PiBkZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspKVxuICB9IDoge1xuICAgIHN0YXRlOiBcInVuY2hhbmdlZFwiLFxuICAgIG1hcmtzXG4gIH07XG59O1xuZnVuY3Rpb24gZ2V0QWN0aXZlQW5ub3RhdGlvbnNNYXJrcyhzbmFwc2hvdCkge1xuICBjb25zdCBzY2hlbWEgPSBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYTtcbiAgcmV0dXJuIChnZXRNYXJrU3RhdGUoc25hcHNob3QpPy5tYXJrcyA/PyBbXSkuZmlsdGVyKChtYXJrKSA9PiAhc2NoZW1hLmRlY29yYXRvcnMubWFwKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lKS5pbmNsdWRlcyhtYXJrKSk7XG59XG5mdW5jdGlvbiBnZXRBY3RpdmVEZWNvcmF0b3JzKHNuYXBzaG90KSB7XG4gIGNvbnN0IHNjaGVtYSA9IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLCBkZWNvcmF0b3JTdGF0ZSA9IHNuYXBzaG90LmRlY29yYXRvclN0YXRlLCBtYXJrU3RhdGUgPSBnZXRNYXJrU3RhdGUoc25hcHNob3QpLCBkZWNvcmF0b3JzID0gc2NoZW1hLmRlY29yYXRvcnMubWFwKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lKTtcbiAgbGV0IGFjdGl2ZURlY29yYXRvcnMgPSAobWFya1N0YXRlPy5tYXJrcyA/PyBbXSkuZmlsdGVyKChtYXJrKSA9PiBkZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspKTtcbiAgZm9yIChjb25zdCBkZWNvcmF0b3IgaW4gZGVjb3JhdG9yU3RhdGUpXG4gICAgZGVjb3JhdG9yU3RhdGVbZGVjb3JhdG9yXSA9PT0gITEgPyBhY3RpdmVEZWNvcmF0b3JzID0gYWN0aXZlRGVjb3JhdG9ycy5maWx0ZXIoKGFjdGl2ZURlY29yYXRvcikgPT4gYWN0aXZlRGVjb3JhdG9yICE9PSBkZWNvcmF0b3IpIDogZGVjb3JhdG9yU3RhdGVbZGVjb3JhdG9yXSA9PT0gITAgJiYgKGFjdGl2ZURlY29yYXRvcnMuaW5jbHVkZXMoZGVjb3JhdG9yKSB8fCBhY3RpdmVEZWNvcmF0b3JzLnB1c2goZGVjb3JhdG9yKSk7XG4gIHJldHVybiBhY3RpdmVEZWNvcmF0b3JzO1xufVxuZnVuY3Rpb24gaXNBY3RpdmVBbm5vdGF0aW9uKGFubm90YXRpb24sIG9wdGlvbnMpIHtcbiAgcmV0dXJuIChzbmFwc2hvdCkgPT4ge1xuICAgIGlmICgob3B0aW9ucz8ubW9kZSA/PyBcImZ1bGxcIikgPT09IFwicGFydGlhbFwiKVxuICAgICAgcmV0dXJuIGdldFNlbGVjdGVkVmFsdWUoc25hcHNob3QpLmZsYXRNYXAoKGJsb2NrKSA9PiBpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBibG9jaykgPyBibG9jay5tYXJrRGVmcyA/PyBbXSA6IFtdKS5zb21lKChtYXJrRGVmKSA9PiBtYXJrRGVmLl90eXBlID09PSBhbm5vdGF0aW9uKTtcbiAgICBjb25zdCBzZWxlY3Rpb25NYXJrRGVmcyA9IGdldFNlbGVjdGVkQmxvY2tzKHNuYXBzaG90KS5mbGF0TWFwKChibG9jaykgPT4gaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2subm9kZSkgPyBibG9jay5ub2RlLm1hcmtEZWZzID8/IFtdIDogW10pLCBhY3RpdmVBbm5vdGF0aW9ucyA9IGdldEFjdGl2ZUFubm90YXRpb25zTWFya3Moc25hcHNob3QpO1xuICAgIHJldHVybiBzZWxlY3Rpb25NYXJrRGVmcy5maWx0ZXIoKG1hcmtEZWYpID0+IG1hcmtEZWYuX3R5cGUgPT09IGFubm90YXRpb24gJiYgYWN0aXZlQW5ub3RhdGlvbnMuaW5jbHVkZXMobWFya0RlZi5fa2V5KSkubGVuZ3RoID4gMDtcbiAgfTtcbn1cbmNvbnN0IGdldEFjdGl2ZUFubm90YXRpb25zID0gKHNuYXBzaG90KSA9PiB7XG4gIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgcmV0dXJuIFtdO1xuICBjb25zdCBzZWxlY3RlZEJsb2NrcyA9IGdldFNlbGVjdGVkQmxvY2tzKHNuYXBzaG90KSwgYWN0aXZlQW5ub3RhdGlvbnMgPSAoZ2V0TWFya1N0YXRlKHNuYXBzaG90KT8ubWFya3MgPz8gW10pLmZpbHRlcigobWFyaykgPT4gIXNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmRlY29yYXRvcnMubWFwKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lKS5pbmNsdWRlcyhtYXJrKSk7XG4gIHJldHVybiBzZWxlY3RlZEJsb2Nrcy5mbGF0TWFwKChibG9jaykgPT4gaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2subm9kZSkgPyBibG9jay5ub2RlLm1hcmtEZWZzID8/IFtdIDogW10pLmZpbHRlcigobWFya0RlZikgPT4gYWN0aXZlQW5ub3RhdGlvbnMuaW5jbHVkZXMobWFya0RlZi5fa2V5KSk7XG59LCBnZXRBY3RpdmVMaXN0SXRlbSA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2VsZWN0ZWRUZXh0QmxvY2tzID0gZ2V0U2VsZWN0ZWRCbG9ja3Moc25hcHNob3QpLm1hcCgoYmxvY2spID0+IGJsb2NrLm5vZGUpLmZpbHRlcigoYmxvY2spID0+IGlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSksIGZpcnN0VGV4dEJsb2NrID0gc2VsZWN0ZWRUZXh0QmxvY2tzLmF0KDApO1xuICBpZiAoIWZpcnN0VGV4dEJsb2NrKVxuICAgIHJldHVybjtcbiAgY29uc3QgZmlyc3RMaXN0SXRlbSA9IGZpcnN0VGV4dEJsb2NrLmxpc3RJdGVtO1xuICBpZiAoZmlyc3RMaXN0SXRlbSAmJiBzZWxlY3RlZFRleHRCbG9ja3MuZXZlcnkoKGJsb2NrKSA9PiBibG9jay5saXN0SXRlbSA9PT0gZmlyc3RMaXN0SXRlbSkpXG4gICAgcmV0dXJuIGZpcnN0TGlzdEl0ZW07XG59LCBnZXRBY3RpdmVTdHlsZSA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2VsZWN0ZWRUZXh0QmxvY2tzID0gZ2V0U2VsZWN0ZWRCbG9ja3Moc25hcHNob3QpLm1hcCgoYmxvY2spID0+IGJsb2NrLm5vZGUpLmZpbHRlcigoYmxvY2spID0+IGlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSksIGZpcnN0VGV4dEJsb2NrID0gc2VsZWN0ZWRUZXh0QmxvY2tzLmF0KDApO1xuICBpZiAoIWZpcnN0VGV4dEJsb2NrKVxuICAgIHJldHVybjtcbiAgY29uc3QgZmlyc3RTdHlsZSA9IGZpcnN0VGV4dEJsb2NrLnN0eWxlO1xuICBpZiAoZmlyc3RTdHlsZSAmJiBzZWxlY3RlZFRleHRCbG9ja3MuZXZlcnkoKGJsb2NrKSA9PiBibG9jay5zdHlsZSA9PT0gZmlyc3RTdHlsZSkpXG4gICAgcmV0dXJuIGZpcnN0U3R5bGU7XG59LCBnZXROZXh0SW5saW5lT2JqZWN0ID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IGZvY3VzVGV4dEJsb2NrID0gZ2V0Rm9jdXNUZXh0QmxvY2soc25hcHNob3QpLCBzZWxlY3Rpb25FbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KHNuYXBzaG90KSwgc2VsZWN0aW9uRW5kUG9pbnRDaGlsZEtleSA9IHNlbGVjdGlvbkVuZFBvaW50ICYmIGlzS2V5ZWRTZWdtZW50KHNlbGVjdGlvbkVuZFBvaW50LnBhdGhbMl0pID8gc2VsZWN0aW9uRW5kUG9pbnQucGF0aFsyXS5fa2V5IDogdm9pZCAwO1xuICBpZiAoIWZvY3VzVGV4dEJsb2NrIHx8ICFzZWxlY3Rpb25FbmRQb2ludENoaWxkS2V5KVxuICAgIHJldHVybjtcbiAgbGV0IGVuZFBvaW50Q2hpbGRGb3VuZCA9ICExLCBpbmxpbmVPYmplY3Q7XG4gIGZvciAoY29uc3QgY2hpbGQgb2YgZm9jdXNUZXh0QmxvY2subm9kZS5jaGlsZHJlbikge1xuICAgIGlmIChjaGlsZC5fa2V5ID09PSBzZWxlY3Rpb25FbmRQb2ludENoaWxkS2V5KSB7XG4gICAgICBlbmRQb2ludENoaWxkRm91bmQgPSAhMDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoIWlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBjaGlsZCkgJiYgZW5kUG9pbnRDaGlsZEZvdW5kKSB7XG4gICAgICBpbmxpbmVPYmplY3QgPSB7XG4gICAgICAgIG5vZGU6IGNoaWxkLFxuICAgICAgICBwYXRoOiBbLi4uZm9jdXNUZXh0QmxvY2sucGF0aCwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICB9XVxuICAgICAgfTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaW5saW5lT2JqZWN0O1xufSwgZ2V0UHJldmlvdXNJbmxpbmVPYmplY3QgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3QgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCksIHNlbGVjdGlvblN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50KHNuYXBzaG90KSwgc2VsZWN0aW9uU3RhcnRQb2ludENoaWxkS2V5ID0gc2VsZWN0aW9uU3RhcnRQb2ludCAmJiBpc0tleWVkU2VnbWVudChzZWxlY3Rpb25TdGFydFBvaW50LnBhdGhbMl0pID8gc2VsZWN0aW9uU3RhcnRQb2ludC5wYXRoWzJdLl9rZXkgOiB2b2lkIDA7XG4gIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvblN0YXJ0UG9pbnRDaGlsZEtleSlcbiAgICByZXR1cm47XG4gIGxldCBpbmxpbmVPYmplY3Q7XG4gIGZvciAoY29uc3QgY2hpbGQgb2YgZm9jdXNUZXh0QmxvY2subm9kZS5jaGlsZHJlbikge1xuICAgIGlmIChjaGlsZC5fa2V5ID09PSBzZWxlY3Rpb25TdGFydFBvaW50Q2hpbGRLZXkpXG4gICAgICBicmVhaztcbiAgICBpc1NwYW4oc25hcHNob3QuY29udGV4dCwgY2hpbGQpIHx8IChpbmxpbmVPYmplY3QgPSB7XG4gICAgICBub2RlOiBjaGlsZCxcbiAgICAgIHBhdGg6IFsuLi5mb2N1c1RleHRCbG9jay5wYXRoLCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgfV1cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gaW5saW5lT2JqZWN0O1xufSwgZ2V0U2VsZWN0aW9uVGV4dCA9IChzbmFwc2hvdCkgPT4gZ2V0U2VsZWN0ZWRWYWx1ZShzbmFwc2hvdCkucmVkdWNlKCh0ZXh0LCBibG9jaykgPT4gaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2spID8gdGV4dCArIGJsb2NrLmNoaWxkcmVuLnJlZHVjZSgodGV4dDIsIGNoaWxkKSA9PiBpc1NwYW4oc25hcHNob3QuY29udGV4dCwgY2hpbGQpID8gdGV4dDIgKyBjaGlsZC50ZXh0IDogdGV4dDIsIFwiXCIpIDogdGV4dCwgXCJcIiksIGdldENhcmV0V29yZFNlbGVjdGlvbiA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uIHx8ICFpc1NlbGVjdGlvbkNvbGxhcHNlZChzbmFwc2hvdCkpXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGZvY3VzVGV4dEJsb2NrID0gZ2V0Rm9jdXNUZXh0QmxvY2soc25hcHNob3QpLCBzZWxlY3Rpb25TdGFydFBvaW50ID0gZ2V0U2VsZWN0aW9uU3RhcnRQb2ludChzbmFwc2hvdCksIHNlbGVjdGlvblN0YXJ0T2Zmc2V0ID0gc2VsZWN0aW9uU3RhcnRQb2ludCA/IHNwYW5TZWxlY3Rpb25Qb2ludFRvQmxvY2tPZmZzZXQoe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgc2VsZWN0aW9uUG9pbnQ6IHNlbGVjdGlvblN0YXJ0UG9pbnRcbiAgfSkgOiB2b2lkIDA7XG4gIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvblN0YXJ0UG9pbnQgfHwgIXNlbGVjdGlvblN0YXJ0T2Zmc2V0KVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBwcmV2aW91c0lubGluZU9iamVjdCA9IGdldFByZXZpb3VzSW5saW5lT2JqZWN0KHNuYXBzaG90KSwgYmxvY2tTdGFydFBvaW50ID0gZ2V0QmxvY2tTdGFydFBvaW50KHtcbiAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgIGJsb2NrOiBmb2N1c1RleHRCbG9ja1xuICB9KSwgdGV4dERpcmVjdGx5QmVmb3JlID0gZ2V0U2VsZWN0aW9uVGV4dCh7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHByZXZpb3VzSW5saW5lT2JqZWN0ID8ge1xuICAgICAgICAgIHBhdGg6IHByZXZpb3VzSW5saW5lT2JqZWN0LnBhdGgsXG4gICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgIH0gOiBibG9ja1N0YXJ0UG9pbnQsXG4gICAgICAgIGZvY3VzOiBzZWxlY3Rpb25TdGFydFBvaW50XG4gICAgICB9XG4gICAgfVxuICB9KS5zcGxpdCgvXFxzKy8pLmF0KC0xKSwgbmV4dElubGluZU9iamVjdCA9IGdldE5leHRJbmxpbmVPYmplY3Qoc25hcHNob3QpLCBibG9ja0VuZFBvaW50ID0gZ2V0QmxvY2tFbmRQb2ludCh7XG4gICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICBibG9jazogZm9jdXNUZXh0QmxvY2tcbiAgfSksIHRleHREaXJlY3RseUFmdGVyID0gZ2V0U2VsZWN0aW9uVGV4dCh7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHNlbGVjdGlvblN0YXJ0UG9pbnQsXG4gICAgICAgIGZvY3VzOiBuZXh0SW5saW5lT2JqZWN0ID8ge1xuICAgICAgICAgIHBhdGg6IG5leHRJbmxpbmVPYmplY3QucGF0aCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfSA6IGJsb2NrRW5kUG9pbnRcbiAgICAgIH1cbiAgICB9XG4gIH0pLnNwbGl0KC9cXHMrLykuYXQoMCk7XG4gIGlmICgodGV4dERpcmVjdGx5QmVmb3JlID09PSB2b2lkIDAgfHwgdGV4dERpcmVjdGx5QmVmb3JlID09PSBcIlwiKSAmJiAodGV4dERpcmVjdGx5QWZ0ZXIgPT09IHZvaWQgMCB8fCB0ZXh0RGlyZWN0bHlBZnRlciA9PT0gXCJcIikpXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGNhcmV0V29yZFN0YXJ0T2Zmc2V0ID0gdGV4dERpcmVjdGx5QmVmb3JlID8ge1xuICAgIC4uLnNlbGVjdGlvblN0YXJ0T2Zmc2V0LFxuICAgIG9mZnNldDogc2VsZWN0aW9uU3RhcnRPZmZzZXQub2Zmc2V0IC0gdGV4dERpcmVjdGx5QmVmb3JlLmxlbmd0aFxuICB9IDogc2VsZWN0aW9uU3RhcnRPZmZzZXQsIGNhcmV0V29yZEVuZE9mZnNldCA9IHRleHREaXJlY3RseUFmdGVyID8ge1xuICAgIC4uLnNlbGVjdGlvblN0YXJ0T2Zmc2V0LFxuICAgIG9mZnNldDogc2VsZWN0aW9uU3RhcnRPZmZzZXQub2Zmc2V0ICsgdGV4dERpcmVjdGx5QWZ0ZXIubGVuZ3RoXG4gIH0gOiBzZWxlY3Rpb25TdGFydE9mZnNldCwgY2FyZXRXb3JkU3RhcnRTZWxlY3Rpb25Qb2ludCA9IGJsb2NrT2Zmc2V0VG9TcGFuU2VsZWN0aW9uUG9pbnQoe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2tPZmZzZXQ6IGNhcmV0V29yZFN0YXJ0T2Zmc2V0LFxuICAgIGRpcmVjdGlvbjogXCJiYWNrd2FyZFwiXG4gIH0pLCBjYXJldFdvcmRFbmRTZWxlY3Rpb25Qb2ludCA9IGJsb2NrT2Zmc2V0VG9TcGFuU2VsZWN0aW9uUG9pbnQoe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2tPZmZzZXQ6IGNhcmV0V29yZEVuZE9mZnNldCxcbiAgICBkaXJlY3Rpb246IFwiZm9yd2FyZFwiXG4gIH0pO1xuICBpZiAoIWNhcmV0V29yZFN0YXJ0U2VsZWN0aW9uUG9pbnQgfHwgIWNhcmV0V29yZEVuZFNlbGVjdGlvblBvaW50KVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBjYXJldFdvcmRTZWxlY3Rpb24gPSB7XG4gICAgYW5jaG9yOiBjYXJldFdvcmRTdGFydFNlbGVjdGlvblBvaW50LFxuICAgIGZvY3VzOiBjYXJldFdvcmRFbmRTZWxlY3Rpb25Qb2ludFxuICB9O1xuICByZXR1cm4gaXNTZWxlY3Rpb25FeHBhbmRlZCQxKHtcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uOiBjYXJldFdvcmRTZWxlY3Rpb25cbiAgICB9XG4gIH0pID8gY2FyZXRXb3JkU2VsZWN0aW9uIDogbnVsbDtcbn0sIGdldEZvY3VzQmxvY2tPYmplY3QgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3QgZm9jdXNCbG9jayA9IGdldEZvY3VzQmxvY2soc25hcHNob3QpO1xuICByZXR1cm4gZm9jdXNCbG9jayAmJiAhaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgZm9jdXNCbG9jay5ub2RlKSA/IHtcbiAgICBub2RlOiBmb2N1c0Jsb2NrLm5vZGUsXG4gICAgcGF0aDogZm9jdXNCbG9jay5wYXRoXG4gIH0gOiB2b2lkIDA7XG59LCBnZXRGb2N1c0xpc3RCbG9jayA9IChzbmFwc2hvdCkgPT4ge1xuICBjb25zdCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgcmV0dXJuIGZvY3VzVGV4dEJsb2NrICYmIGlzTGlzdEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGZvY3VzVGV4dEJsb2NrLm5vZGUpID8ge1xuICAgIG5vZGU6IGZvY3VzVGV4dEJsb2NrLm5vZGUsXG4gICAgcGF0aDogZm9jdXNUZXh0QmxvY2sucGF0aFxuICB9IDogdm9pZCAwO1xufSwgZ2V0TGFzdEJsb2NrID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IG5vZGUgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlW3NuYXBzaG90LmNvbnRleHQudmFsdWUubGVuZ3RoIC0gMV0gPyBzbmFwc2hvdC5jb250ZXh0LnZhbHVlW3NuYXBzaG90LmNvbnRleHQudmFsdWUubGVuZ3RoIC0gMV0gOiB2b2lkIDA7XG4gIHJldHVybiBub2RlID8ge1xuICAgIG5vZGUsXG4gICAgcGF0aDogW3tcbiAgICAgIF9rZXk6IG5vZGUuX2tleVxuICAgIH1dXG4gIH0gOiB2b2lkIDA7XG59LCBnZXROZXh0QmxvY2sgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3Qgc2VsZWN0aW9uRW5kQmxvY2sgPSBnZXRTZWxlY3Rpb25FbmRCbG9jayhzbmFwc2hvdCk7XG4gIGlmICghc2VsZWN0aW9uRW5kQmxvY2spXG4gICAgcmV0dXJuO1xuICBjb25zdCBpbmRleCA9IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KHNlbGVjdGlvbkVuZEJsb2NrLm5vZGUuX2tleSk7XG4gIGlmIChpbmRleCA9PT0gdm9pZCAwIHx8IGluZGV4ID09PSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLmxlbmd0aCAtIDEpXG4gICAgcmV0dXJuO1xuICBjb25zdCBuZXh0QmxvY2sgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLmF0KGluZGV4ICsgMSk7XG4gIHJldHVybiBuZXh0QmxvY2sgPyB7XG4gICAgbm9kZTogbmV4dEJsb2NrLFxuICAgIHBhdGg6IFt7XG4gICAgICBfa2V5OiBuZXh0QmxvY2suX2tleVxuICAgIH1dXG4gIH0gOiB2b2lkIDA7XG59LCBnZXRQcmV2aW91c0Jsb2NrID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IHNlbGVjdGlvblN0YXJ0QmxvY2sgPSBnZXRTZWxlY3Rpb25TdGFydEJsb2NrKHNuYXBzaG90KTtcbiAgaWYgKCFzZWxlY3Rpb25TdGFydEJsb2NrKVxuICAgIHJldHVybjtcbiAgY29uc3QgaW5kZXggPSBzbmFwc2hvdC5ibG9ja0luZGV4TWFwLmdldChzZWxlY3Rpb25TdGFydEJsb2NrLm5vZGUuX2tleSk7XG4gIGlmIChpbmRleCA9PT0gdm9pZCAwIHx8IGluZGV4ID09PSAwKVxuICAgIHJldHVybjtcbiAgY29uc3QgcHJldmlvdXNCbG9jayA9IHNuYXBzaG90LmNvbnRleHQudmFsdWUuYXQoaW5kZXggLSAxKTtcbiAgcmV0dXJuIHByZXZpb3VzQmxvY2sgPyB7XG4gICAgbm9kZTogcHJldmlvdXNCbG9jayxcbiAgICBwYXRoOiBbe1xuICAgICAgX2tleTogcHJldmlvdXNCbG9jay5fa2V5XG4gICAgfV1cbiAgfSA6IHZvaWQgMDtcbn0sIGdldFNlbGVjdGVkVGV4dEJsb2NrcyA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybiBbXTtcbiAgY29uc3Qgc2VsZWN0ZWRUZXh0QmxvY2tzID0gW10sIHN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50JDEoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pLCBlbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50JDEoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pLCBzdGFydEJsb2NrS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc3RhcnRQb2ludCksIGVuZEJsb2NrS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoZW5kUG9pbnQpO1xuICBpZiAoIXN0YXJ0QmxvY2tLZXkgfHwgIWVuZEJsb2NrS2V5KVxuICAgIHJldHVybiBzZWxlY3RlZFRleHRCbG9ja3M7XG4gIGNvbnN0IHN0YXJ0QmxvY2tJbmRleCA9IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KHN0YXJ0QmxvY2tLZXkpLCBlbmRCbG9ja0luZGV4ID0gc25hcHNob3QuYmxvY2tJbmRleE1hcC5nZXQoZW5kQmxvY2tLZXkpO1xuICBpZiAoc3RhcnRCbG9ja0luZGV4ID09PSB2b2lkIDAgfHwgZW5kQmxvY2tJbmRleCA9PT0gdm9pZCAwKVxuICAgIHJldHVybiBzZWxlY3RlZFRleHRCbG9ja3M7XG4gIGNvbnN0IHNsaWNlZFZhbHVlID0gc25hcHNob3QuY29udGV4dC52YWx1ZS5zbGljZShzdGFydEJsb2NrSW5kZXgsIGVuZEJsb2NrSW5kZXggKyAxKTtcbiAgZm9yIChjb25zdCBibG9jayBvZiBzbGljZWRWYWx1ZSkge1xuICAgIGlmIChibG9jay5fa2V5ID09PSBzdGFydEJsb2NrS2V5KSB7XG4gICAgICBpZiAoaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2spICYmIHNlbGVjdGVkVGV4dEJsb2Nrcy5wdXNoKHtcbiAgICAgICAgbm9kZTogYmxvY2ssXG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9XVxuICAgICAgfSksIHN0YXJ0QmxvY2tLZXkgPT09IGVuZEJsb2NrS2V5KVxuICAgICAgICBicmVhaztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoYmxvY2suX2tleSA9PT0gZW5kQmxvY2tLZXkpIHtcbiAgICAgIGlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSAmJiBzZWxlY3RlZFRleHRCbG9ja3MucHVzaCh7XG4gICAgICAgIG5vZGU6IGJsb2NrLFxuICAgICAgICBwYXRoOiBbe1xuICAgICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgICAgfV1cbiAgICAgIH0pO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHNlbGVjdGVkVGV4dEJsb2Nrcy5sZW5ndGggPiAwICYmIGlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSAmJiBzZWxlY3RlZFRleHRCbG9ja3MucHVzaCh7XG4gICAgICBub2RlOiBibG9jayxcbiAgICAgIHBhdGg6IFt7XG4gICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgIH1dXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHNlbGVjdGVkVGV4dEJsb2Nrcztcbn0sIGdldFNlbGVjdGlvbkVuZENoaWxkID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IGVuZFBvaW50ID0gZ2V0U2VsZWN0aW9uRW5kUG9pbnQkMShzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbik7XG4gIGlmIChlbmRQb2ludClcbiAgICByZXR1cm4gZ2V0Rm9jdXNDaGlsZCh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiBlbmRQb2ludCxcbiAgICAgICAgICBmb2N1czogZW5kUG9pbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xufSwgZ2V0U2VsZWN0aW9uU3RhcnRDaGlsZCA9IChzbmFwc2hvdCkgPT4ge1xuICBjb25zdCBzdGFydFBvaW50ID0gZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCQxKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKTtcbiAgaWYgKHN0YXJ0UG9pbnQpXG4gICAgcmV0dXJuIGdldEZvY3VzQ2hpbGQoe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjogc3RhcnRQb2ludCxcbiAgICAgICAgICBmb2N1czogc3RhcnRQb2ludFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG59O1xuZnVuY3Rpb24gaXNBY3RpdmVEZWNvcmF0b3IoZGVjb3JhdG9yKSB7XG4gIHJldHVybiAoc25hcHNob3QpID0+IHtcbiAgICBpZiAoaXNTZWxlY3Rpb25FeHBhbmRlZCQxKHNuYXBzaG90KSkge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRTcGFucyA9IGdldFNlbGVjdGVkU3BhbnMoc25hcHNob3QpO1xuICAgICAgcmV0dXJuIHNlbGVjdGVkU3BhbnMubGVuZ3RoID4gMCAmJiBzZWxlY3RlZFNwYW5zLmV2ZXJ5KChzcGFuKSA9PiBzcGFuLm5vZGUubWFya3M/LmluY2x1ZGVzKGRlY29yYXRvcikpO1xuICAgIH1cbiAgICByZXR1cm4gZ2V0QWN0aXZlRGVjb3JhdG9ycyhzbmFwc2hvdCkuaW5jbHVkZXMoZGVjb3JhdG9yKTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGlzQWN0aXZlTGlzdEl0ZW0obGlzdEl0ZW0pIHtcbiAgcmV0dXJuIChzbmFwc2hvdCkgPT4gZ2V0QWN0aXZlTGlzdEl0ZW0oc25hcHNob3QpID09PSBsaXN0SXRlbTtcbn1cbmZ1bmN0aW9uIGlzQWN0aXZlU3R5bGUoc3R5bGUpIHtcbiAgcmV0dXJuIChzbmFwc2hvdCkgPT4gZ2V0QWN0aXZlU3R5bGUoc25hcHNob3QpID09PSBzdHlsZTtcbn1cbmZ1bmN0aW9uIGlzQXRUaGVFbmRPZkJsb2NrKGJsb2NrKSB7XG4gIHJldHVybiAoc25hcHNob3QpID0+IHtcbiAgICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uIHx8ICFpc1NlbGVjdGlvbkNvbGxhcHNlZChzbmFwc2hvdCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgYmxvY2tFbmRQb2ludCA9IGdldEJsb2NrRW5kUG9pbnQoe1xuICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgIGJsb2NrXG4gICAgfSk7XG4gICAgcmV0dXJuIGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMsIGJsb2NrRW5kUG9pbnQpO1xuICB9O1xufVxuZnVuY3Rpb24gaXNBdFRoZVN0YXJ0T2ZCbG9jayhibG9jaykge1xuICByZXR1cm4gKHNuYXBzaG90KSA9PiB7XG4gICAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiB8fCAhaXNTZWxlY3Rpb25Db2xsYXBzZWQoc25hcHNob3QpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGJsb2NrU3RhcnRQb2ludCA9IGdldEJsb2NrU3RhcnRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2tcbiAgICB9KTtcbiAgICByZXR1cm4gaXNFcXVhbFNlbGVjdGlvblBvaW50cyhzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5mb2N1cywgYmxvY2tTdGFydFBvaW50KTtcbiAgfTtcbn1cbmV4cG9ydCB7XG4gIGdldEFjdGl2ZUFubm90YXRpb25zLFxuICBnZXRBY3RpdmVBbm5vdGF0aW9uc01hcmtzLFxuICBnZXRBY3RpdmVEZWNvcmF0b3JzLFxuICBnZXRBY3RpdmVMaXN0SXRlbSxcbiAgZ2V0QWN0aXZlU3R5bGUsXG4gIGdldENhcmV0V29yZFNlbGVjdGlvbixcbiAgZ2V0Rm9jdXNCbG9jayxcbiAgZ2V0Rm9jdXNCbG9ja09iamVjdCxcbiAgZ2V0Rm9jdXNDaGlsZCxcbiAgZ2V0Rm9jdXNJbmxpbmVPYmplY3QsXG4gIGdldEZvY3VzTGlzdEJsb2NrLFxuICBnZXRGb2N1c1NwYW4sXG4gIGdldEZvY3VzVGV4dEJsb2NrLFxuICBnZXRMYXN0QmxvY2ssXG4gIGdldE1hcmtTdGF0ZSxcbiAgZ2V0TmV4dEJsb2NrLFxuICBnZXROZXh0SW5saW5lT2JqZWN0LFxuICBnZXROZXh0U3BhbixcbiAgZ2V0UHJldmlvdXNCbG9jayxcbiAgZ2V0UHJldmlvdXNJbmxpbmVPYmplY3QsXG4gIGdldFByZXZpb3VzU3BhbixcbiAgZ2V0U2VsZWN0ZWRCbG9ja3MsXG4gIGdldFNlbGVjdGVkU3BhbnMsXG4gIGdldFNlbGVjdGVkVGV4dEJsb2NrcyxcbiAgZ2V0U2VsZWN0ZWRWYWx1ZSxcbiAgZ2V0U2VsZWN0aW9uRW5kQmxvY2ssXG4gIGdldFNlbGVjdGlvbkVuZENoaWxkLFxuICBnZXRTZWxlY3Rpb25FbmRQb2ludCxcbiAgZ2V0U2VsZWN0aW9uU3RhcnRCbG9jayxcbiAgZ2V0U2VsZWN0aW9uU3RhcnRDaGlsZCxcbiAgZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCxcbiAgZ2V0U2VsZWN0aW9uVGV4dCxcbiAgaXNBY3RpdmVBbm5vdGF0aW9uLFxuICBpc0FjdGl2ZURlY29yYXRvcixcbiAgaXNBY3RpdmVMaXN0SXRlbSxcbiAgaXNBY3RpdmVTdHlsZSxcbiAgaXNBdFRoZUVuZE9mQmxvY2ssXG4gIGlzQXRUaGVTdGFydE9mQmxvY2ssXG4gIGlzT3ZlcmxhcHBpbmdTZWxlY3Rpb24sXG4gIGlzUG9pbnRBZnRlclNlbGVjdGlvbixcbiAgaXNQb2ludEJlZm9yZVNlbGVjdGlvbixcbiAgaXNTZWxlY3RpbmdFbnRpcmVCbG9ja3MsXG4gIGlzU2VsZWN0aW9uQ29sbGFwc2VkLFxuICBpc1NlbGVjdGlvbkV4cGFuZGVkJDEgYXMgaXNTZWxlY3Rpb25FeHBhbmRlZFxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlbGVjdG9yLmlzLWF0LXRoZS1zdGFydC1vZi1ibG9jay5qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js":
/*!************************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js ***!
  \************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EditorContext: () => (/* binding */ EditorContext),\n/* harmony export */   useEditor: () => (/* binding */ useEditor)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\nfunction getGlobalScope() {\n  if (typeof globalThis < \"u\")\n    return globalThis;\n  if (typeof window < \"u\")\n    return window;\n  if (typeof self < \"u\")\n    return self;\n  if (typeof global < \"u\")\n    return global;\n  throw new Error(\"@portabletext/editor: could not locate global scope\");\n}\nconst globalScope = getGlobalScope();\nfunction createGloballyScopedContext(key, defaultValue) {\n  const symbol = Symbol.for(key);\n  return typeof document > \"u\" ? (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(defaultValue) : (globalScope[symbol] = globalScope[symbol] ?? (0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(defaultValue), globalScope[symbol]);\n}\nconst EditorContext = createGloballyScopedContext(\"@portabletext/editor/context/editor\", null);\nfunction useEditor() {\n  const editor = react__WEBPACK_IMPORTED_MODULE_0__.useContext(EditorContext);\n  if (!editor)\n    throw new Error(\"No Editor set. Use EditorProvider to set one.\");\n  return editor;\n}\n\n//# sourceMappingURL=use-editor.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL19jaHVua3MtZXMvdXNlLWVkaXRvci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxvREFBYSwrREFBK0Qsb0RBQWE7QUFDMUg7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDZDQUFnQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUlFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L2VkaXRvci9saWIvX2NodW5rcy1lcy91c2UtZWRpdG9yLmpzP2JkMjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IGNyZWF0ZUNvbnRleHQgfSBmcm9tIFwicmVhY3RcIjtcbmZ1bmN0aW9uIGdldEdsb2JhbFNjb3BlKCkge1xuICBpZiAodHlwZW9mIGdsb2JhbFRoaXMgPCBcInVcIilcbiAgICByZXR1cm4gZ2xvYmFsVGhpcztcbiAgaWYgKHR5cGVvZiB3aW5kb3cgPCBcInVcIilcbiAgICByZXR1cm4gd2luZG93O1xuICBpZiAodHlwZW9mIHNlbGYgPCBcInVcIilcbiAgICByZXR1cm4gc2VsZjtcbiAgaWYgKHR5cGVvZiBnbG9iYWwgPCBcInVcIilcbiAgICByZXR1cm4gZ2xvYmFsO1xuICB0aHJvdyBuZXcgRXJyb3IoXCJAcG9ydGFibGV0ZXh0L2VkaXRvcjogY291bGQgbm90IGxvY2F0ZSBnbG9iYWwgc2NvcGVcIik7XG59XG5jb25zdCBnbG9iYWxTY29wZSA9IGdldEdsb2JhbFNjb3BlKCk7XG5mdW5jdGlvbiBjcmVhdGVHbG9iYWxseVNjb3BlZENvbnRleHQoa2V5LCBkZWZhdWx0VmFsdWUpIHtcbiAgY29uc3Qgc3ltYm9sID0gU3ltYm9sLmZvcihrZXkpO1xuICByZXR1cm4gdHlwZW9mIGRvY3VtZW50ID4gXCJ1XCIgPyBjcmVhdGVDb250ZXh0KGRlZmF1bHRWYWx1ZSkgOiAoZ2xvYmFsU2NvcGVbc3ltYm9sXSA9IGdsb2JhbFNjb3BlW3N5bWJvbF0gPz8gY3JlYXRlQ29udGV4dChkZWZhdWx0VmFsdWUpLCBnbG9iYWxTY29wZVtzeW1ib2xdKTtcbn1cbmNvbnN0IEVkaXRvckNvbnRleHQgPSBjcmVhdGVHbG9iYWxseVNjb3BlZENvbnRleHQoXCJAcG9ydGFibGV0ZXh0L2VkaXRvci9jb250ZXh0L2VkaXRvclwiLCBudWxsKTtcbmZ1bmN0aW9uIHVzZUVkaXRvcigpIHtcbiAgY29uc3QgZWRpdG9yID0gUmVhY3QudXNlQ29udGV4dChFZGl0b3JDb250ZXh0KTtcbiAgaWYgKCFlZGl0b3IpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gRWRpdG9yIHNldC4gVXNlIEVkaXRvclByb3ZpZGVyIHRvIHNldCBvbmUuXCIpO1xuICByZXR1cm4gZWRpdG9yO1xufVxuZXhwb3J0IHtcbiAgRWRpdG9yQ29udGV4dCxcbiAgdXNlRWRpdG9yXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXNlLWVkaXRvci5qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   blockOffsetToSpanSelectionPoint: () => (/* binding */ blockOffsetToSpanSelectionPoint),\n/* harmony export */   defaultKeyGenerator: () => (/* binding */ defaultKeyGenerator),\n/* harmony export */   getBlockEndPoint: () => (/* binding */ getBlockEndPoint),\n/* harmony export */   getBlockKeyFromSelectionPoint: () => (/* binding */ getBlockKeyFromSelectionPoint),\n/* harmony export */   getBlockStartPoint: () => (/* binding */ getBlockStartPoint),\n/* harmony export */   getChildKeyFromSelectionPoint: () => (/* binding */ getChildKeyFromSelectionPoint),\n/* harmony export */   getSelectionEndPoint: () => (/* binding */ getSelectionEndPoint),\n/* harmony export */   getSelectionStartPoint: () => (/* binding */ getSelectionStartPoint),\n/* harmony export */   isEqualSelectionPoints: () => (/* binding */ isEqualSelectionPoints),\n/* harmony export */   isKeyedSegment: () => (/* binding */ isKeyedSegment),\n/* harmony export */   isListBlock: () => (/* binding */ isListBlock),\n/* harmony export */   isSelectionCollapsed: () => (/* binding */ isSelectionCollapsed),\n/* harmony export */   isTypedObject: () => (/* binding */ isTypedObject),\n/* harmony export */   parseAnnotation: () => (/* binding */ parseAnnotation),\n/* harmony export */   parseBlock: () => (/* binding */ parseBlock),\n/* harmony export */   parseBlocks: () => (/* binding */ parseBlocks),\n/* harmony export */   parseInlineObject: () => (/* binding */ parseInlineObject),\n/* harmony export */   parseMarkDefs: () => (/* binding */ parseMarkDefs),\n/* harmony export */   parseSpan: () => (/* binding */ parseSpan),\n/* harmony export */   sliceBlocks: () => (/* binding */ sliceBlocks),\n/* harmony export */   spanSelectionPointToBlockOffset: () => (/* binding */ spanSelectionPointToBlockOffset)\n/* harmony export */ });\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n\nfunction getBlockEndPoint({\n  context,\n  block\n}) {\n  if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block.node)) {\n    const lastChild = block.node.children[block.node.children.length - 1];\n    if (lastChild)\n      return {\n        path: [...block.path, \"children\", {\n          _key: lastChild._key\n        }],\n        offset: (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, lastChild) ? lastChild.text.length : 0\n      };\n  }\n  return {\n    path: block.path,\n    offset: 0\n  };\n}\nfunction getBlockStartPoint({\n  context,\n  block\n}) {\n  return (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block.node) ? {\n    path: [...block.path, \"children\", {\n      _key: block.node.children[0]._key\n    }],\n    offset: 0\n  } : {\n    path: block.path,\n    offset: 0\n  };\n}\nfunction isSelectionCollapsed(selection) {\n  return selection ? JSON.stringify(selection.anchor.path) === JSON.stringify(selection.focus.path) && selection.anchor.offset === selection.focus.offset : !1;\n}\nfunction isKeyedSegment(segment) {\n  return typeof segment == \"object\" && segment !== null && \"_key\" in segment;\n}\nfunction getBlockKeyFromSelectionPoint(point) {\n  const blockPathSegment = point.path.at(0);\n  if (isKeyedSegment(blockPathSegment))\n    return blockPathSegment._key;\n}\nfunction getChildKeyFromSelectionPoint(point) {\n  const childPathSegment = point.path.at(2);\n  if (isKeyedSegment(childPathSegment))\n    return childPathSegment._key;\n}\nfunction blockOffsetToSpanSelectionPoint({\n  context,\n  blockOffset,\n  direction\n}) {\n  let offsetLeft = blockOffset.offset, selectionPoint, skippedInlineObject = !1;\n  for (const block of context.value)\n    if (block._key === blockOffset.path[0]._key && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block))\n      for (const child of block.children) {\n        if (direction === \"forward\") {\n          if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child))\n            continue;\n          if (offsetLeft <= child.text.length) {\n            selectionPoint = {\n              path: [...blockOffset.path, \"children\", {\n                _key: child._key\n              }],\n              offset: offsetLeft\n            };\n            break;\n          }\n          offsetLeft -= child.text.length;\n          continue;\n        }\n        if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child)) {\n          skippedInlineObject = !0;\n          continue;\n        }\n        if (offsetLeft === 0 && selectionPoint && !skippedInlineObject) {\n          skippedInlineObject && (selectionPoint = {\n            path: [...blockOffset.path, \"children\", {\n              _key: child._key\n            }],\n            offset: 0\n          });\n          break;\n        }\n        if (offsetLeft > child.text.length) {\n          offsetLeft -= child.text.length;\n          continue;\n        }\n        if (offsetLeft <= child.text.length && (selectionPoint = {\n          path: [...blockOffset.path, \"children\", {\n            _key: child._key\n          }],\n          offset: offsetLeft\n        }, offsetLeft -= child.text.length, offsetLeft !== 0))\n          break;\n      }\n  return selectionPoint;\n}\nfunction spanSelectionPointToBlockOffset({\n  context,\n  selectionPoint\n}) {\n  let offset = 0;\n  const blockKey = getBlockKeyFromSelectionPoint(selectionPoint), spanKey = getChildKeyFromSelectionPoint(selectionPoint);\n  if (!(!blockKey || !spanKey)) {\n    for (const block of context.value)\n      if (block._key === blockKey && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block)) {\n        for (const child of block.children)\n          if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child)) {\n            if (child._key === spanKey)\n              return {\n                path: [{\n                  _key: block._key\n                }],\n                offset: offset + selectionPoint.offset\n              };\n            offset += child.text.length;\n          }\n      }\n  }\n}\nfunction getSelectionEndPoint(selection) {\n  return selection ? selection.backward ? selection.anchor : selection.focus : null;\n}\nfunction getSelectionStartPoint(selection) {\n  return selection ? selection.backward ? selection.focus : selection.anchor : null;\n}\nfunction isEqualSelectionPoints(a, b) {\n  return a.offset === b.offset && JSON.stringify(a.path) === JSON.stringify(b.path);\n}\nfunction isTypedObject(object) {\n  return isRecord(object) && typeof object._type == \"string\";\n}\nfunction isRecord(value) {\n  return !!value && (typeof value == \"object\" || typeof value == \"function\");\n}\nfunction parseBlocks({\n  context,\n  blocks,\n  options\n}) {\n  return Array.isArray(blocks) ? blocks.flatMap((block) => {\n    const parsedBlock = parseBlock({\n      context,\n      block,\n      options\n    });\n    return parsedBlock ? [parsedBlock] : [];\n  }) : [];\n}\nfunction parseBlock({\n  context,\n  block,\n  options\n}) {\n  return parseTextBlock({\n    block,\n    context,\n    options\n  }) ?? parseBlockObject({\n    blockObject: block,\n    context,\n    options\n  });\n}\nfunction parseBlockObject({\n  blockObject,\n  context,\n  options\n}) {\n  if (!isTypedObject(blockObject))\n    return;\n  const schemaType = context.schema.blockObjects.find(({\n    name\n  }) => name === blockObject._type);\n  if (schemaType)\n    return parseObject({\n      object: blockObject,\n      context: {\n        keyGenerator: context.keyGenerator,\n        schemaType\n      },\n      options\n    });\n}\nfunction isListBlock(context, block) {\n  return (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block) && block.level !== void 0 && block.listItem !== void 0;\n}\nfunction parseTextBlock({\n  block,\n  context,\n  options\n}) {\n  if (!isTypedObject(block))\n    return;\n  const customFields = {};\n  for (const key of Object.keys(block))\n    key === \"_type\" || key === \"_key\" || key === \"children\" || key === \"markDefs\" || key === \"style\" || key === \"listItem\" || key === \"level\" || (options.validateFields ? context.schema.block.fields?.some((field) => field.name === key) && (customFields[key] = block[key]) : customFields[key] = block[key]);\n  if (block._type !== context.schema.block.name)\n    return;\n  const _key = typeof block._key == \"string\" ? block._key : context.keyGenerator(), {\n    markDefs,\n    markDefKeyMap\n  } = parseMarkDefs({\n    context,\n    markDefs: block.markDefs,\n    options\n  }), parsedChildren = (Array.isArray(block.children) ? block.children : []).map((child) => parseChild({\n    child,\n    context,\n    markDefKeyMap,\n    options\n  })).filter((child) => child !== void 0), marks = parsedChildren.flatMap((child) => child.marks ?? []), children = parsedChildren.length > 0 ? parsedChildren : [{\n    _key: context.keyGenerator(),\n    _type: context.schema.span.name,\n    text: \"\",\n    marks: []\n  }], normalizedChildren = options.normalize ? (\n    // Ensure that inline objects re surrounded by spans\n    children.reduce((normalizedChildren2, child, index) => {\n      if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child))\n        return [...normalizedChildren2, child];\n      const previousChild = normalizedChildren2.at(-1);\n      return !previousChild || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, previousChild) ? [...normalizedChildren2, {\n        _key: context.keyGenerator(),\n        _type: context.schema.span.name,\n        text: \"\",\n        marks: []\n      }, child, ...index === children.length - 1 ? [{\n        _key: context.keyGenerator(),\n        _type: context.schema.span.name,\n        text: \"\",\n        marks: []\n      }] : []] : [...normalizedChildren2, child];\n    }, [])\n  ) : children, parsedBlock = {\n    _type: context.schema.block.name,\n    _key,\n    children: normalizedChildren,\n    ...customFields\n  };\n  return typeof block.markDefs == \"object\" && block.markDefs !== null && (parsedBlock.markDefs = options.removeUnusedMarkDefs ? markDefs.filter((markDef) => marks.includes(markDef._key)) : markDefs), typeof block.style == \"string\" && context.schema.styles.find((style) => style.name === block.style) && (parsedBlock.style = block.style), typeof block.listItem == \"string\" && context.schema.lists.find((list) => list.name === block.listItem) && (parsedBlock.listItem = block.listItem), typeof block.level == \"number\" && (parsedBlock.level = block.level), parsedBlock;\n}\nfunction parseMarkDefs({\n  context,\n  markDefs,\n  options\n}) {\n  const unparsedMarkDefs = Array.isArray(markDefs) ? markDefs : [], markDefKeyMap = /* @__PURE__ */ new Map();\n  return {\n    markDefs: unparsedMarkDefs.flatMap((markDef) => {\n      if (!isTypedObject(markDef))\n        return [];\n      const schemaType = context.schema.annotations.find(({\n        name\n      }) => name === markDef._type);\n      if (!schemaType)\n        return [];\n      if (typeof markDef._key != \"string\")\n        return [];\n      const parsedAnnotation = parseObject({\n        object: markDef,\n        context: {\n          schemaType,\n          keyGenerator: context.keyGenerator\n        },\n        options\n      });\n      return parsedAnnotation ? (markDefKeyMap.set(markDef._key, parsedAnnotation._key), [parsedAnnotation]) : [];\n    }),\n    markDefKeyMap\n  };\n}\nfunction parseChild({\n  child,\n  context,\n  markDefKeyMap,\n  options\n}) {\n  return parseSpan({\n    span: child,\n    context,\n    markDefKeyMap,\n    options\n  }) ?? parseInlineObject({\n    inlineObject: child,\n    context,\n    options\n  });\n}\nfunction parseSpan({\n  span,\n  context,\n  markDefKeyMap,\n  options\n}) {\n  if (!isRecord(span))\n    return;\n  const customFields = {};\n  for (const key of Object.keys(span))\n    key !== \"_type\" && key !== \"_key\" && key !== \"text\" && key !== \"marks\" && (customFields[key] = span[key]);\n  const marks = (Array.isArray(span.marks) ? span.marks : []).flatMap((mark) => {\n    if (typeof mark != \"string\")\n      return [];\n    const markDefKey = markDefKeyMap.get(mark);\n    return markDefKey !== void 0 ? [markDefKey] : context.schema.decorators.some((decorator) => decorator.name === mark) ? [mark] : [];\n  });\n  if (!(typeof span._type == \"string\" && span._type !== context.schema.span.name))\n    return typeof span._type != \"string\" ? typeof span.text == \"string\" ? {\n      _type: context.schema.span.name,\n      _key: typeof span._key == \"string\" ? span._key : context.keyGenerator(),\n      text: span.text,\n      marks,\n      ...options.validateFields ? {} : customFields\n    } : void 0 : {\n      _type: context.schema.span.name,\n      _key: typeof span._key == \"string\" ? span._key : context.keyGenerator(),\n      text: typeof span.text == \"string\" ? span.text : \"\",\n      marks,\n      ...options.validateFields ? {} : customFields\n    };\n}\nfunction parseInlineObject({\n  inlineObject,\n  context,\n  options\n}) {\n  if (!isTypedObject(inlineObject))\n    return;\n  const schemaType = context.schema.inlineObjects.find(({\n    name\n  }) => name === inlineObject._type);\n  if (schemaType)\n    return parseObject({\n      object: inlineObject,\n      context: {\n        keyGenerator: context.keyGenerator,\n        schemaType\n      },\n      options\n    });\n}\nfunction parseAnnotation({\n  annotation,\n  context,\n  options\n}) {\n  if (!isTypedObject(annotation))\n    return;\n  const schemaType = context.schema.annotations.find(({\n    name\n  }) => name === annotation._type);\n  if (schemaType)\n    return parseObject({\n      object: annotation,\n      context: {\n        keyGenerator: context.keyGenerator,\n        schemaType\n      },\n      options\n    });\n}\nfunction parseObject({\n  object,\n  context,\n  options\n}) {\n  const {\n    _type,\n    _key,\n    ...customFields\n  } = object, values = options.validateFields ? context.schemaType.fields.reduce((fieldValues, field) => {\n    const fieldValue = object[field.name];\n    return fieldValue !== void 0 && (fieldValues[field.name] = fieldValue), fieldValues;\n  }, {}) : customFields;\n  return {\n    _type: context.schemaType.name,\n    _key: typeof object._key == \"string\" ? object._key : context.keyGenerator(),\n    ...values\n  };\n}\nconst defaultKeyGenerator = () => randomKey(12), getByteHexTable = /* @__PURE__ */ (() => {\n  let table;\n  return () => {\n    if (table)\n      return table;\n    table = [];\n    for (let i = 0; i < 256; ++i)\n      table[i] = (i + 256).toString(16).slice(1);\n    return table;\n  };\n})();\nfunction whatwgRNG(length = 16) {\n  const rnds8 = new Uint8Array(length);\n  return crypto.getRandomValues(rnds8), rnds8;\n}\nfunction randomKey(length) {\n  const table = getByteHexTable();\n  return whatwgRNG(length).reduce((str, n) => str + table[n], \"\").slice(0, length);\n}\nfunction sliceBlocks({\n  context,\n  blocks\n}) {\n  const slice = [];\n  if (!context.selection)\n    return slice;\n  let startBlock;\n  const middleBlocks = [];\n  let endBlock;\n  const startPoint = getSelectionStartPoint(context.selection), endPoint = getSelectionEndPoint(context.selection), startBlockKey = getBlockKeyFromSelectionPoint(startPoint), startChildKey = getChildKeyFromSelectionPoint(startPoint), endBlockKey = getBlockKeyFromSelectionPoint(endPoint), endChildKey = getChildKeyFromSelectionPoint(endPoint);\n  if (!startBlockKey || !endBlockKey)\n    return slice;\n  for (const block of blocks) {\n    if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block) && block._key === startBlockKey && block._key === endBlockKey) {\n      startBlock = block;\n      break;\n    }\n    if (block._key === startBlockKey) {\n      if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block)) {\n        startBlock = block;\n        continue;\n      }\n      if (startChildKey) {\n        for (const child of block.children) {\n          if (child._key === startChildKey) {\n            if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child)) {\n              const text = child._key === endChildKey ? child.text.slice(startPoint.offset, endPoint.offset) : child.text.slice(startPoint.offset);\n              startBlock = {\n                ...block,\n                children: [{\n                  ...child,\n                  text\n                }]\n              };\n            } else\n              startBlock = {\n                ...block,\n                children: [child]\n              };\n            if (block._key === endBlockKey && startChildKey === endChildKey)\n              break;\n            continue;\n          }\n          if (startBlock && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, startBlock) && (endChildKey && child._key === endChildKey && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child) ? startBlock.children.push({\n            ...child,\n            text: child.text.slice(0, endPoint.offset)\n          }) : startBlock.children.push(child), block._key === endBlockKey && endChildKey && child._key === endChildKey))\n            break;\n        }\n        if (startBlockKey === endBlockKey)\n          break;\n        continue;\n      }\n      if (startBlock = block, startBlockKey === endBlockKey)\n        break;\n    }\n    if (block._key === endBlockKey) {\n      if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block)) {\n        endBlock = block;\n        break;\n      }\n      if (endChildKey) {\n        endBlock = {\n          ...block,\n          children: []\n        };\n        for (const child of block.children)\n          if (endBlock && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, endBlock)) {\n            if (child._key === endChildKey && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child)) {\n              endBlock.children.push({\n                ...child,\n                text: child.text.slice(0, endPoint.offset)\n              });\n              break;\n            }\n            if (endBlock.children.push(child), endChildKey && child._key === endChildKey)\n              break;\n          }\n        break;\n      }\n      endBlock = block;\n      break;\n    }\n    startBlock && middleBlocks.push(parseBlock({\n      context: {\n        schema: context.schema,\n        keyGenerator: context.keyGenerator ?? defaultKeyGenerator\n      },\n      block,\n      options: {\n        normalize: !1,\n        removeUnusedMarkDefs: !0,\n        validateFields: !1\n      }\n    }) ?? block);\n  }\n  const parsedStartBlock = startBlock ? parseBlock({\n    context: {\n      schema: context.schema,\n      keyGenerator: context.keyGenerator ?? defaultKeyGenerator\n    },\n    block: startBlock,\n    options: {\n      normalize: !1,\n      removeUnusedMarkDefs: !0,\n      validateFields: !1\n    }\n  }) : void 0, parsedEndBlock = endBlock ? parseBlock({\n    context: {\n      schema: context.schema,\n      keyGenerator: context.keyGenerator ?? defaultKeyGenerator\n    },\n    block: endBlock,\n    options: {\n      normalize: !1,\n      removeUnusedMarkDefs: !0,\n      validateFields: !1\n    }\n  }) : void 0;\n  return [...parsedStartBlock ? [parsedStartBlock] : [], ...middleBlocks, ...parsedEndBlock ? [parsedEndBlock] : []];\n}\n\n//# sourceMappingURL=util.slice-blocks.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL19jaHVua3MtZXMvdXRpbC5zbGljZS1ibG9ja3MuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUEyRDtBQUMzRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsTUFBTSxpRUFBVztBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULGdCQUFnQiw0REFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxTQUFTLGlFQUFXO0FBQ3BCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxtREFBbUQsaUVBQVc7QUFDOUQ7QUFDQTtBQUNBLGVBQWUsNERBQU07QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsNERBQU07QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGlFQUFXO0FBQ2hEO0FBQ0EsY0FBYyw0REFBTTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFNBQVMsaUVBQVc7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLFVBQVUsNERBQU07QUFDaEI7QUFDQTtBQUNBLGdDQUFnQyw0REFBTTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckMsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRyxJQUFJO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlFQUFXO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxpRUFBVztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNERBQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsaUVBQVcsdUVBQXVFLDREQUFNO0FBQ3BIO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGlFQUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpRUFBVztBQUNyQyw4Q0FBOEMsNERBQU07QUFDcEQ7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQXVCRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL19jaHVua3MtZXMvdXRpbC5zbGljZS1ibG9ja3MuanM/MjhkNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1RleHRCbG9jaywgaXNTcGFuIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvc2NoZW1hXCI7XG5mdW5jdGlvbiBnZXRCbG9ja0VuZFBvaW50KHtcbiAgY29udGV4dCxcbiAgYmxvY2tcbn0pIHtcbiAgaWYgKGlzVGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrLm5vZGUpKSB7XG4gICAgY29uc3QgbGFzdENoaWxkID0gYmxvY2subm9kZS5jaGlsZHJlbltibG9jay5ub2RlLmNoaWxkcmVuLmxlbmd0aCAtIDFdO1xuICAgIGlmIChsYXN0Q2hpbGQpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwYXRoOiBbLi4uYmxvY2sucGF0aCwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgX2tleTogbGFzdENoaWxkLl9rZXlcbiAgICAgICAgfV0sXG4gICAgICAgIG9mZnNldDogaXNTcGFuKGNvbnRleHQsIGxhc3RDaGlsZCkgPyBsYXN0Q2hpbGQudGV4dC5sZW5ndGggOiAwXG4gICAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgcGF0aDogYmxvY2sucGF0aCxcbiAgICBvZmZzZXQ6IDBcbiAgfTtcbn1cbmZ1bmN0aW9uIGdldEJsb2NrU3RhcnRQb2ludCh7XG4gIGNvbnRleHQsXG4gIGJsb2NrXG59KSB7XG4gIHJldHVybiBpc1RleHRCbG9jayhjb250ZXh0LCBibG9jay5ub2RlKSA/IHtcbiAgICBwYXRoOiBbLi4uYmxvY2sucGF0aCwgXCJjaGlsZHJlblwiLCB7XG4gICAgICBfa2V5OiBibG9jay5ub2RlLmNoaWxkcmVuWzBdLl9rZXlcbiAgICB9XSxcbiAgICBvZmZzZXQ6IDBcbiAgfSA6IHtcbiAgICBwYXRoOiBibG9jay5wYXRoLFxuICAgIG9mZnNldDogMFxuICB9O1xufVxuZnVuY3Rpb24gaXNTZWxlY3Rpb25Db2xsYXBzZWQoc2VsZWN0aW9uKSB7XG4gIHJldHVybiBzZWxlY3Rpb24gPyBKU09OLnN0cmluZ2lmeShzZWxlY3Rpb24uYW5jaG9yLnBhdGgpID09PSBKU09OLnN0cmluZ2lmeShzZWxlY3Rpb24uZm9jdXMucGF0aCkgJiYgc2VsZWN0aW9uLmFuY2hvci5vZmZzZXQgPT09IHNlbGVjdGlvbi5mb2N1cy5vZmZzZXQgOiAhMTtcbn1cbmZ1bmN0aW9uIGlzS2V5ZWRTZWdtZW50KHNlZ21lbnQpIHtcbiAgcmV0dXJuIHR5cGVvZiBzZWdtZW50ID09IFwib2JqZWN0XCIgJiYgc2VnbWVudCAhPT0gbnVsbCAmJiBcIl9rZXlcIiBpbiBzZWdtZW50O1xufVxuZnVuY3Rpb24gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQocG9pbnQpIHtcbiAgY29uc3QgYmxvY2tQYXRoU2VnbWVudCA9IHBvaW50LnBhdGguYXQoMCk7XG4gIGlmIChpc0tleWVkU2VnbWVudChibG9ja1BhdGhTZWdtZW50KSlcbiAgICByZXR1cm4gYmxvY2tQYXRoU2VnbWVudC5fa2V5O1xufVxuZnVuY3Rpb24gZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQocG9pbnQpIHtcbiAgY29uc3QgY2hpbGRQYXRoU2VnbWVudCA9IHBvaW50LnBhdGguYXQoMik7XG4gIGlmIChpc0tleWVkU2VnbWVudChjaGlsZFBhdGhTZWdtZW50KSlcbiAgICByZXR1cm4gY2hpbGRQYXRoU2VnbWVudC5fa2V5O1xufVxuZnVuY3Rpb24gYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCh7XG4gIGNvbnRleHQsXG4gIGJsb2NrT2Zmc2V0LFxuICBkaXJlY3Rpb25cbn0pIHtcbiAgbGV0IG9mZnNldExlZnQgPSBibG9ja09mZnNldC5vZmZzZXQsIHNlbGVjdGlvblBvaW50LCBza2lwcGVkSW5saW5lT2JqZWN0ID0gITE7XG4gIGZvciAoY29uc3QgYmxvY2sgb2YgY29udGV4dC52YWx1ZSlcbiAgICBpZiAoYmxvY2suX2tleSA9PT0gYmxvY2tPZmZzZXQucGF0aFswXS5fa2V5ICYmIGlzVGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSlcbiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgYmxvY2suY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJmb3J3YXJkXCIpIHtcbiAgICAgICAgICBpZiAoIWlzU3Bhbihjb250ZXh0LCBjaGlsZCkpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICBpZiAob2Zmc2V0TGVmdCA8PSBjaGlsZC50ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgc2VsZWN0aW9uUG9pbnQgPSB7XG4gICAgICAgICAgICAgIHBhdGg6IFsuLi5ibG9ja09mZnNldC5wYXRoLCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICAgICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICBvZmZzZXQ6IG9mZnNldExlZnRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgb2Zmc2V0TGVmdCAtPSBjaGlsZC50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzU3Bhbihjb250ZXh0LCBjaGlsZCkpIHtcbiAgICAgICAgICBza2lwcGVkSW5saW5lT2JqZWN0ID0gITA7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9mZnNldExlZnQgPT09IDAgJiYgc2VsZWN0aW9uUG9pbnQgJiYgIXNraXBwZWRJbmxpbmVPYmplY3QpIHtcbiAgICAgICAgICBza2lwcGVkSW5saW5lT2JqZWN0ICYmIChzZWxlY3Rpb25Qb2ludCA9IHtcbiAgICAgICAgICAgIHBhdGg6IFsuLi5ibG9ja09mZnNldC5wYXRoLCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAob2Zmc2V0TGVmdCA+IGNoaWxkLnRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgb2Zmc2V0TGVmdCAtPSBjaGlsZC50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2Zmc2V0TGVmdCA8PSBjaGlsZC50ZXh0Lmxlbmd0aCAmJiAoc2VsZWN0aW9uUG9pbnQgPSB7XG4gICAgICAgICAgcGF0aDogWy4uLmJsb2NrT2Zmc2V0LnBhdGgsIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICAgIH1dLFxuICAgICAgICAgIG9mZnNldDogb2Zmc2V0TGVmdFxuICAgICAgICB9LCBvZmZzZXRMZWZ0IC09IGNoaWxkLnRleHQubGVuZ3RoLCBvZmZzZXRMZWZ0ICE9PSAwKSlcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgcmV0dXJuIHNlbGVjdGlvblBvaW50O1xufVxuZnVuY3Rpb24gc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gIGNvbnRleHQsXG4gIHNlbGVjdGlvblBvaW50XG59KSB7XG4gIGxldCBvZmZzZXQgPSAwO1xuICBjb25zdCBibG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHNlbGVjdGlvblBvaW50KSwgc3BhbktleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHNlbGVjdGlvblBvaW50KTtcbiAgaWYgKCEoIWJsb2NrS2V5IHx8ICFzcGFuS2V5KSkge1xuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgY29udGV4dC52YWx1ZSlcbiAgICAgIGlmIChibG9jay5fa2V5ID09PSBibG9ja0tleSAmJiBpc1RleHRCbG9jayhjb250ZXh0LCBibG9jaykpIHtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbilcbiAgICAgICAgICBpZiAoaXNTcGFuKGNvbnRleHQsIGNoaWxkKSkge1xuICAgICAgICAgICAgaWYgKGNoaWxkLl9rZXkgPT09IHNwYW5LZXkpXG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IG9mZnNldCArIHNlbGVjdGlvblBvaW50Lm9mZnNldFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgb2Zmc2V0ICs9IGNoaWxkLnRleHQubGVuZ3RoO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZ2V0U2VsZWN0aW9uRW5kUG9pbnQoc2VsZWN0aW9uKSB7XG4gIHJldHVybiBzZWxlY3Rpb24gPyBzZWxlY3Rpb24uYmFja3dhcmQgPyBzZWxlY3Rpb24uYW5jaG9yIDogc2VsZWN0aW9uLmZvY3VzIDogbnVsbDtcbn1cbmZ1bmN0aW9uIGdldFNlbGVjdGlvblN0YXJ0UG9pbnQoc2VsZWN0aW9uKSB7XG4gIHJldHVybiBzZWxlY3Rpb24gPyBzZWxlY3Rpb24uYmFja3dhcmQgPyBzZWxlY3Rpb24uZm9jdXMgOiBzZWxlY3Rpb24uYW5jaG9yIDogbnVsbDtcbn1cbmZ1bmN0aW9uIGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMoYSwgYikge1xuICByZXR1cm4gYS5vZmZzZXQgPT09IGIub2Zmc2V0ICYmIEpTT04uc3RyaW5naWZ5KGEucGF0aCkgPT09IEpTT04uc3RyaW5naWZ5KGIucGF0aCk7XG59XG5mdW5jdGlvbiBpc1R5cGVkT2JqZWN0KG9iamVjdCkge1xuICByZXR1cm4gaXNSZWNvcmQob2JqZWN0KSAmJiB0eXBlb2Ygb2JqZWN0Ll90eXBlID09IFwic3RyaW5nXCI7XG59XG5mdW5jdGlvbiBpc1JlY29yZCh2YWx1ZSkge1xuICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZW9mIHZhbHVlID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHZhbHVlID09IFwiZnVuY3Rpb25cIik7XG59XG5mdW5jdGlvbiBwYXJzZUJsb2Nrcyh7XG4gIGNvbnRleHQsXG4gIGJsb2NrcyxcbiAgb3B0aW9uc1xufSkge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheShibG9ja3MpID8gYmxvY2tzLmZsYXRNYXAoKGJsb2NrKSA9PiB7XG4gICAgY29uc3QgcGFyc2VkQmxvY2sgPSBwYXJzZUJsb2NrKHtcbiAgICAgIGNvbnRleHQsXG4gICAgICBibG9jayxcbiAgICAgIG9wdGlvbnNcbiAgICB9KTtcbiAgICByZXR1cm4gcGFyc2VkQmxvY2sgPyBbcGFyc2VkQmxvY2tdIDogW107XG4gIH0pIDogW107XG59XG5mdW5jdGlvbiBwYXJzZUJsb2NrKHtcbiAgY29udGV4dCxcbiAgYmxvY2ssXG4gIG9wdGlvbnNcbn0pIHtcbiAgcmV0dXJuIHBhcnNlVGV4dEJsb2NrKHtcbiAgICBibG9jayxcbiAgICBjb250ZXh0LFxuICAgIG9wdGlvbnNcbiAgfSkgPz8gcGFyc2VCbG9ja09iamVjdCh7XG4gICAgYmxvY2tPYmplY3Q6IGJsb2NrLFxuICAgIGNvbnRleHQsXG4gICAgb3B0aW9uc1xuICB9KTtcbn1cbmZ1bmN0aW9uIHBhcnNlQmxvY2tPYmplY3Qoe1xuICBibG9ja09iamVjdCxcbiAgY29udGV4dCxcbiAgb3B0aW9uc1xufSkge1xuICBpZiAoIWlzVHlwZWRPYmplY3QoYmxvY2tPYmplY3QpKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2NoZW1hVHlwZSA9IGNvbnRleHQuc2NoZW1hLmJsb2NrT2JqZWN0cy5maW5kKCh7XG4gICAgbmFtZVxuICB9KSA9PiBuYW1lID09PSBibG9ja09iamVjdC5fdHlwZSk7XG4gIGlmIChzY2hlbWFUeXBlKVxuICAgIHJldHVybiBwYXJzZU9iamVjdCh7XG4gICAgICBvYmplY3Q6IGJsb2NrT2JqZWN0LFxuICAgICAgY29udGV4dDoge1xuICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnRleHQua2V5R2VuZXJhdG9yLFxuICAgICAgICBzY2hlbWFUeXBlXG4gICAgICB9LFxuICAgICAgb3B0aW9uc1xuICAgIH0pO1xufVxuZnVuY3Rpb24gaXNMaXN0QmxvY2soY29udGV4dCwgYmxvY2spIHtcbiAgcmV0dXJuIGlzVGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSAmJiBibG9jay5sZXZlbCAhPT0gdm9pZCAwICYmIGJsb2NrLmxpc3RJdGVtICE9PSB2b2lkIDA7XG59XG5mdW5jdGlvbiBwYXJzZVRleHRCbG9jayh7XG4gIGJsb2NrLFxuICBjb250ZXh0LFxuICBvcHRpb25zXG59KSB7XG4gIGlmICghaXNUeXBlZE9iamVjdChibG9jaykpXG4gICAgcmV0dXJuO1xuICBjb25zdCBjdXN0b21GaWVsZHMgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoYmxvY2spKVxuICAgIGtleSA9PT0gXCJfdHlwZVwiIHx8IGtleSA9PT0gXCJfa2V5XCIgfHwga2V5ID09PSBcImNoaWxkcmVuXCIgfHwga2V5ID09PSBcIm1hcmtEZWZzXCIgfHwga2V5ID09PSBcInN0eWxlXCIgfHwga2V5ID09PSBcImxpc3RJdGVtXCIgfHwga2V5ID09PSBcImxldmVsXCIgfHwgKG9wdGlvbnMudmFsaWRhdGVGaWVsZHMgPyBjb250ZXh0LnNjaGVtYS5ibG9jay5maWVsZHM/LnNvbWUoKGZpZWxkKSA9PiBmaWVsZC5uYW1lID09PSBrZXkpICYmIChjdXN0b21GaWVsZHNba2V5XSA9IGJsb2NrW2tleV0pIDogY3VzdG9tRmllbGRzW2tleV0gPSBibG9ja1trZXldKTtcbiAgaWYgKGJsb2NrLl90eXBlICE9PSBjb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lKVxuICAgIHJldHVybjtcbiAgY29uc3QgX2tleSA9IHR5cGVvZiBibG9jay5fa2V5ID09IFwic3RyaW5nXCIgPyBibG9jay5fa2V5IDogY29udGV4dC5rZXlHZW5lcmF0b3IoKSwge1xuICAgIG1hcmtEZWZzLFxuICAgIG1hcmtEZWZLZXlNYXBcbiAgfSA9IHBhcnNlTWFya0RlZnMoe1xuICAgIGNvbnRleHQsXG4gICAgbWFya0RlZnM6IGJsb2NrLm1hcmtEZWZzLFxuICAgIG9wdGlvbnNcbiAgfSksIHBhcnNlZENoaWxkcmVuID0gKEFycmF5LmlzQXJyYXkoYmxvY2suY2hpbGRyZW4pID8gYmxvY2suY2hpbGRyZW4gOiBbXSkubWFwKChjaGlsZCkgPT4gcGFyc2VDaGlsZCh7XG4gICAgY2hpbGQsXG4gICAgY29udGV4dCxcbiAgICBtYXJrRGVmS2V5TWFwLFxuICAgIG9wdGlvbnNcbiAgfSkpLmZpbHRlcigoY2hpbGQpID0+IGNoaWxkICE9PSB2b2lkIDApLCBtYXJrcyA9IHBhcnNlZENoaWxkcmVuLmZsYXRNYXAoKGNoaWxkKSA9PiBjaGlsZC5tYXJrcyA/PyBbXSksIGNoaWxkcmVuID0gcGFyc2VkQ2hpbGRyZW4ubGVuZ3RoID4gMCA/IHBhcnNlZENoaWxkcmVuIDogW3tcbiAgICBfa2V5OiBjb250ZXh0LmtleUdlbmVyYXRvcigpLFxuICAgIF90eXBlOiBjb250ZXh0LnNjaGVtYS5zcGFuLm5hbWUsXG4gICAgdGV4dDogXCJcIixcbiAgICBtYXJrczogW11cbiAgfV0sIG5vcm1hbGl6ZWRDaGlsZHJlbiA9IG9wdGlvbnMubm9ybWFsaXplID8gKFxuICAgIC8vIEVuc3VyZSB0aGF0IGlubGluZSBvYmplY3RzIHJlIHN1cnJvdW5kZWQgYnkgc3BhbnNcbiAgICBjaGlsZHJlbi5yZWR1Y2UoKG5vcm1hbGl6ZWRDaGlsZHJlbjIsIGNoaWxkLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGlzU3Bhbihjb250ZXh0LCBjaGlsZCkpXG4gICAgICAgIHJldHVybiBbLi4ubm9ybWFsaXplZENoaWxkcmVuMiwgY2hpbGRdO1xuICAgICAgY29uc3QgcHJldmlvdXNDaGlsZCA9IG5vcm1hbGl6ZWRDaGlsZHJlbjIuYXQoLTEpO1xuICAgICAgcmV0dXJuICFwcmV2aW91c0NoaWxkIHx8ICFpc1NwYW4oY29udGV4dCwgcHJldmlvdXNDaGlsZCkgPyBbLi4ubm9ybWFsaXplZENoaWxkcmVuMiwge1xuICAgICAgICBfa2V5OiBjb250ZXh0LmtleUdlbmVyYXRvcigpLFxuICAgICAgICBfdHlwZTogY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICBtYXJrczogW11cbiAgICAgIH0sIGNoaWxkLCAuLi5pbmRleCA9PT0gY2hpbGRyZW4ubGVuZ3RoIC0gMSA/IFt7XG4gICAgICAgIF9rZXk6IGNvbnRleHQua2V5R2VuZXJhdG9yKCksXG4gICAgICAgIF90eXBlOiBjb250ZXh0LnNjaGVtYS5zcGFuLm5hbWUsXG4gICAgICAgIHRleHQ6IFwiXCIsXG4gICAgICAgIG1hcmtzOiBbXVxuICAgICAgfV0gOiBbXV0gOiBbLi4ubm9ybWFsaXplZENoaWxkcmVuMiwgY2hpbGRdO1xuICAgIH0sIFtdKVxuICApIDogY2hpbGRyZW4sIHBhcnNlZEJsb2NrID0ge1xuICAgIF90eXBlOiBjb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lLFxuICAgIF9rZXksXG4gICAgY2hpbGRyZW46IG5vcm1hbGl6ZWRDaGlsZHJlbixcbiAgICAuLi5jdXN0b21GaWVsZHNcbiAgfTtcbiAgcmV0dXJuIHR5cGVvZiBibG9jay5tYXJrRGVmcyA9PSBcIm9iamVjdFwiICYmIGJsb2NrLm1hcmtEZWZzICE9PSBudWxsICYmIChwYXJzZWRCbG9jay5tYXJrRGVmcyA9IG9wdGlvbnMucmVtb3ZlVW51c2VkTWFya0RlZnMgPyBtYXJrRGVmcy5maWx0ZXIoKG1hcmtEZWYpID0+IG1hcmtzLmluY2x1ZGVzKG1hcmtEZWYuX2tleSkpIDogbWFya0RlZnMpLCB0eXBlb2YgYmxvY2suc3R5bGUgPT0gXCJzdHJpbmdcIiAmJiBjb250ZXh0LnNjaGVtYS5zdHlsZXMuZmluZCgoc3R5bGUpID0+IHN0eWxlLm5hbWUgPT09IGJsb2NrLnN0eWxlKSAmJiAocGFyc2VkQmxvY2suc3R5bGUgPSBibG9jay5zdHlsZSksIHR5cGVvZiBibG9jay5saXN0SXRlbSA9PSBcInN0cmluZ1wiICYmIGNvbnRleHQuc2NoZW1hLmxpc3RzLmZpbmQoKGxpc3QpID0+IGxpc3QubmFtZSA9PT0gYmxvY2subGlzdEl0ZW0pICYmIChwYXJzZWRCbG9jay5saXN0SXRlbSA9IGJsb2NrLmxpc3RJdGVtKSwgdHlwZW9mIGJsb2NrLmxldmVsID09IFwibnVtYmVyXCIgJiYgKHBhcnNlZEJsb2NrLmxldmVsID0gYmxvY2subGV2ZWwpLCBwYXJzZWRCbG9jaztcbn1cbmZ1bmN0aW9uIHBhcnNlTWFya0RlZnMoe1xuICBjb250ZXh0LFxuICBtYXJrRGVmcyxcbiAgb3B0aW9uc1xufSkge1xuICBjb25zdCB1bnBhcnNlZE1hcmtEZWZzID0gQXJyYXkuaXNBcnJheShtYXJrRGVmcykgPyBtYXJrRGVmcyA6IFtdLCBtYXJrRGVmS2V5TWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgcmV0dXJuIHtcbiAgICBtYXJrRGVmczogdW5wYXJzZWRNYXJrRGVmcy5mbGF0TWFwKChtYXJrRGVmKSA9PiB7XG4gICAgICBpZiAoIWlzVHlwZWRPYmplY3QobWFya0RlZikpXG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIGNvbnN0IHNjaGVtYVR5cGUgPSBjb250ZXh0LnNjaGVtYS5hbm5vdGF0aW9ucy5maW5kKCh7XG4gICAgICAgIG5hbWVcbiAgICAgIH0pID0+IG5hbWUgPT09IG1hcmtEZWYuX3R5cGUpO1xuICAgICAgaWYgKCFzY2hlbWFUeXBlKVxuICAgICAgICByZXR1cm4gW107XG4gICAgICBpZiAodHlwZW9mIG1hcmtEZWYuX2tleSAhPSBcInN0cmluZ1wiKVxuICAgICAgICByZXR1cm4gW107XG4gICAgICBjb25zdCBwYXJzZWRBbm5vdGF0aW9uID0gcGFyc2VPYmplY3Qoe1xuICAgICAgICBvYmplY3Q6IG1hcmtEZWYsXG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBzY2hlbWFUeXBlLFxuICAgICAgICAgIGtleUdlbmVyYXRvcjogY29udGV4dC5rZXlHZW5lcmF0b3JcbiAgICAgICAgfSxcbiAgICAgICAgb3B0aW9uc1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcGFyc2VkQW5ub3RhdGlvbiA/IChtYXJrRGVmS2V5TWFwLnNldChtYXJrRGVmLl9rZXksIHBhcnNlZEFubm90YXRpb24uX2tleSksIFtwYXJzZWRBbm5vdGF0aW9uXSkgOiBbXTtcbiAgICB9KSxcbiAgICBtYXJrRGVmS2V5TWFwXG4gIH07XG59XG5mdW5jdGlvbiBwYXJzZUNoaWxkKHtcbiAgY2hpbGQsXG4gIGNvbnRleHQsXG4gIG1hcmtEZWZLZXlNYXAsXG4gIG9wdGlvbnNcbn0pIHtcbiAgcmV0dXJuIHBhcnNlU3Bhbih7XG4gICAgc3BhbjogY2hpbGQsXG4gICAgY29udGV4dCxcbiAgICBtYXJrRGVmS2V5TWFwLFxuICAgIG9wdGlvbnNcbiAgfSkgPz8gcGFyc2VJbmxpbmVPYmplY3Qoe1xuICAgIGlubGluZU9iamVjdDogY2hpbGQsXG4gICAgY29udGV4dCxcbiAgICBvcHRpb25zXG4gIH0pO1xufVxuZnVuY3Rpb24gcGFyc2VTcGFuKHtcbiAgc3BhbixcbiAgY29udGV4dCxcbiAgbWFya0RlZktleU1hcCxcbiAgb3B0aW9uc1xufSkge1xuICBpZiAoIWlzUmVjb3JkKHNwYW4pKVxuICAgIHJldHVybjtcbiAgY29uc3QgY3VzdG9tRmllbGRzID0ge307XG4gIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHNwYW4pKVxuICAgIGtleSAhPT0gXCJfdHlwZVwiICYmIGtleSAhPT0gXCJfa2V5XCIgJiYga2V5ICE9PSBcInRleHRcIiAmJiBrZXkgIT09IFwibWFya3NcIiAmJiAoY3VzdG9tRmllbGRzW2tleV0gPSBzcGFuW2tleV0pO1xuICBjb25zdCBtYXJrcyA9IChBcnJheS5pc0FycmF5KHNwYW4ubWFya3MpID8gc3Bhbi5tYXJrcyA6IFtdKS5mbGF0TWFwKChtYXJrKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBtYXJrICE9IFwic3RyaW5nXCIpXG4gICAgICByZXR1cm4gW107XG4gICAgY29uc3QgbWFya0RlZktleSA9IG1hcmtEZWZLZXlNYXAuZ2V0KG1hcmspO1xuICAgIHJldHVybiBtYXJrRGVmS2V5ICE9PSB2b2lkIDAgPyBbbWFya0RlZktleV0gOiBjb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLnNvbWUoKGRlY29yYXRvcikgPT4gZGVjb3JhdG9yLm5hbWUgPT09IG1hcmspID8gW21hcmtdIDogW107XG4gIH0pO1xuICBpZiAoISh0eXBlb2Ygc3Bhbi5fdHlwZSA9PSBcInN0cmluZ1wiICYmIHNwYW4uX3R5cGUgIT09IGNvbnRleHQuc2NoZW1hLnNwYW4ubmFtZSkpXG4gICAgcmV0dXJuIHR5cGVvZiBzcGFuLl90eXBlICE9IFwic3RyaW5nXCIgPyB0eXBlb2Ygc3Bhbi50ZXh0ID09IFwic3RyaW5nXCIgPyB7XG4gICAgICBfdHlwZTogY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgX2tleTogdHlwZW9mIHNwYW4uX2tleSA9PSBcInN0cmluZ1wiID8gc3Bhbi5fa2V5IDogY29udGV4dC5rZXlHZW5lcmF0b3IoKSxcbiAgICAgIHRleHQ6IHNwYW4udGV4dCxcbiAgICAgIG1hcmtzLFxuICAgICAgLi4ub3B0aW9ucy52YWxpZGF0ZUZpZWxkcyA/IHt9IDogY3VzdG9tRmllbGRzXG4gICAgfSA6IHZvaWQgMCA6IHtcbiAgICAgIF90eXBlOiBjb250ZXh0LnNjaGVtYS5zcGFuLm5hbWUsXG4gICAgICBfa2V5OiB0eXBlb2Ygc3Bhbi5fa2V5ID09IFwic3RyaW5nXCIgPyBzcGFuLl9rZXkgOiBjb250ZXh0LmtleUdlbmVyYXRvcigpLFxuICAgICAgdGV4dDogdHlwZW9mIHNwYW4udGV4dCA9PSBcInN0cmluZ1wiID8gc3Bhbi50ZXh0IDogXCJcIixcbiAgICAgIG1hcmtzLFxuICAgICAgLi4ub3B0aW9ucy52YWxpZGF0ZUZpZWxkcyA/IHt9IDogY3VzdG9tRmllbGRzXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHBhcnNlSW5saW5lT2JqZWN0KHtcbiAgaW5saW5lT2JqZWN0LFxuICBjb250ZXh0LFxuICBvcHRpb25zXG59KSB7XG4gIGlmICghaXNUeXBlZE9iamVjdChpbmxpbmVPYmplY3QpKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2NoZW1hVHlwZSA9IGNvbnRleHQuc2NoZW1hLmlubGluZU9iamVjdHMuZmluZCgoe1xuICAgIG5hbWVcbiAgfSkgPT4gbmFtZSA9PT0gaW5saW5lT2JqZWN0Ll90eXBlKTtcbiAgaWYgKHNjaGVtYVR5cGUpXG4gICAgcmV0dXJuIHBhcnNlT2JqZWN0KHtcbiAgICAgIG9iamVjdDogaW5saW5lT2JqZWN0LFxuICAgICAgY29udGV4dDoge1xuICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnRleHQua2V5R2VuZXJhdG9yLFxuICAgICAgICBzY2hlbWFUeXBlXG4gICAgICB9LFxuICAgICAgb3B0aW9uc1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcGFyc2VBbm5vdGF0aW9uKHtcbiAgYW5ub3RhdGlvbixcbiAgY29udGV4dCxcbiAgb3B0aW9uc1xufSkge1xuICBpZiAoIWlzVHlwZWRPYmplY3QoYW5ub3RhdGlvbikpXG4gICAgcmV0dXJuO1xuICBjb25zdCBzY2hlbWFUeXBlID0gY29udGV4dC5zY2hlbWEuYW5ub3RhdGlvbnMuZmluZCgoe1xuICAgIG5hbWVcbiAgfSkgPT4gbmFtZSA9PT0gYW5ub3RhdGlvbi5fdHlwZSk7XG4gIGlmIChzY2hlbWFUeXBlKVxuICAgIHJldHVybiBwYXJzZU9iamVjdCh7XG4gICAgICBvYmplY3Q6IGFubm90YXRpb24sXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIGtleUdlbmVyYXRvcjogY29udGV4dC5rZXlHZW5lcmF0b3IsXG4gICAgICAgIHNjaGVtYVR5cGVcbiAgICAgIH0sXG4gICAgICBvcHRpb25zXG4gICAgfSk7XG59XG5mdW5jdGlvbiBwYXJzZU9iamVjdCh7XG4gIG9iamVjdCxcbiAgY29udGV4dCxcbiAgb3B0aW9uc1xufSkge1xuICBjb25zdCB7XG4gICAgX3R5cGUsXG4gICAgX2tleSxcbiAgICAuLi5jdXN0b21GaWVsZHNcbiAgfSA9IG9iamVjdCwgdmFsdWVzID0gb3B0aW9ucy52YWxpZGF0ZUZpZWxkcyA/IGNvbnRleHQuc2NoZW1hVHlwZS5maWVsZHMucmVkdWNlKChmaWVsZFZhbHVlcywgZmllbGQpID0+IHtcbiAgICBjb25zdCBmaWVsZFZhbHVlID0gb2JqZWN0W2ZpZWxkLm5hbWVdO1xuICAgIHJldHVybiBmaWVsZFZhbHVlICE9PSB2b2lkIDAgJiYgKGZpZWxkVmFsdWVzW2ZpZWxkLm5hbWVdID0gZmllbGRWYWx1ZSksIGZpZWxkVmFsdWVzO1xuICB9LCB7fSkgOiBjdXN0b21GaWVsZHM7XG4gIHJldHVybiB7XG4gICAgX3R5cGU6IGNvbnRleHQuc2NoZW1hVHlwZS5uYW1lLFxuICAgIF9rZXk6IHR5cGVvZiBvYmplY3QuX2tleSA9PSBcInN0cmluZ1wiID8gb2JqZWN0Ll9rZXkgOiBjb250ZXh0LmtleUdlbmVyYXRvcigpLFxuICAgIC4uLnZhbHVlc1xuICB9O1xufVxuY29uc3QgZGVmYXVsdEtleUdlbmVyYXRvciA9ICgpID0+IHJhbmRvbUtleSgxMiksIGdldEJ5dGVIZXhUYWJsZSA9IC8qIEBfX1BVUkVfXyAqLyAoKCkgPT4ge1xuICBsZXQgdGFibGU7XG4gIHJldHVybiAoKSA9PiB7XG4gICAgaWYgKHRhYmxlKVxuICAgICAgcmV0dXJuIHRhYmxlO1xuICAgIHRhYmxlID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSlcbiAgICAgIHRhYmxlW2ldID0gKGkgKyAyNTYpLnRvU3RyaW5nKDE2KS5zbGljZSgxKTtcbiAgICByZXR1cm4gdGFibGU7XG4gIH07XG59KSgpO1xuZnVuY3Rpb24gd2hhdHdnUk5HKGxlbmd0aCA9IDE2KSB7XG4gIGNvbnN0IHJuZHM4ID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTtcbiAgcmV0dXJuIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMocm5kczgpLCBybmRzODtcbn1cbmZ1bmN0aW9uIHJhbmRvbUtleShsZW5ndGgpIHtcbiAgY29uc3QgdGFibGUgPSBnZXRCeXRlSGV4VGFibGUoKTtcbiAgcmV0dXJuIHdoYXR3Z1JORyhsZW5ndGgpLnJlZHVjZSgoc3RyLCBuKSA9PiBzdHIgKyB0YWJsZVtuXSwgXCJcIikuc2xpY2UoMCwgbGVuZ3RoKTtcbn1cbmZ1bmN0aW9uIHNsaWNlQmxvY2tzKHtcbiAgY29udGV4dCxcbiAgYmxvY2tzXG59KSB7XG4gIGNvbnN0IHNsaWNlID0gW107XG4gIGlmICghY29udGV4dC5zZWxlY3Rpb24pXG4gICAgcmV0dXJuIHNsaWNlO1xuICBsZXQgc3RhcnRCbG9jaztcbiAgY29uc3QgbWlkZGxlQmxvY2tzID0gW107XG4gIGxldCBlbmRCbG9jaztcbiAgY29uc3Qgc3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQoY29udGV4dC5zZWxlY3Rpb24pLCBlbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KGNvbnRleHQuc2VsZWN0aW9uKSwgc3RhcnRCbG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHN0YXJ0UG9pbnQpLCBzdGFydENoaWxkS2V5ID0gZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc3RhcnRQb2ludCksIGVuZEJsb2NrS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoZW5kUG9pbnQpLCBlbmRDaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KGVuZFBvaW50KTtcbiAgaWYgKCFzdGFydEJsb2NrS2V5IHx8ICFlbmRCbG9ja0tleSlcbiAgICByZXR1cm4gc2xpY2U7XG4gIGZvciAoY29uc3QgYmxvY2sgb2YgYmxvY2tzKSB7XG4gICAgaWYgKCFpc1RleHRCbG9jayhjb250ZXh0LCBibG9jaykgJiYgYmxvY2suX2tleSA9PT0gc3RhcnRCbG9ja0tleSAmJiBibG9jay5fa2V5ID09PSBlbmRCbG9ja0tleSkge1xuICAgICAgc3RhcnRCbG9jayA9IGJsb2NrO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChibG9jay5fa2V5ID09PSBzdGFydEJsb2NrS2V5KSB7XG4gICAgICBpZiAoIWlzVGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSkge1xuICAgICAgICBzdGFydEJsb2NrID0gYmxvY2s7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXJ0Q2hpbGRLZXkpIHtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbikge1xuICAgICAgICAgIGlmIChjaGlsZC5fa2V5ID09PSBzdGFydENoaWxkS2V5KSB7XG4gICAgICAgICAgICBpZiAoaXNTcGFuKGNvbnRleHQsIGNoaWxkKSkge1xuICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gY2hpbGQuX2tleSA9PT0gZW5kQ2hpbGRLZXkgPyBjaGlsZC50ZXh0LnNsaWNlKHN0YXJ0UG9pbnQub2Zmc2V0LCBlbmRQb2ludC5vZmZzZXQpIDogY2hpbGQudGV4dC5zbGljZShzdGFydFBvaW50Lm9mZnNldCk7XG4gICAgICAgICAgICAgIHN0YXJ0QmxvY2sgPSB7XG4gICAgICAgICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IFt7XG4gICAgICAgICAgICAgICAgICAuLi5jaGlsZCxcbiAgICAgICAgICAgICAgICAgIHRleHRcbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgIHN0YXJ0QmxvY2sgPSB7XG4gICAgICAgICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IFtjaGlsZF1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChibG9jay5fa2V5ID09PSBlbmRCbG9ja0tleSAmJiBzdGFydENoaWxkS2V5ID09PSBlbmRDaGlsZEtleSlcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHN0YXJ0QmxvY2sgJiYgaXNUZXh0QmxvY2soY29udGV4dCwgc3RhcnRCbG9jaykgJiYgKGVuZENoaWxkS2V5ICYmIGNoaWxkLl9rZXkgPT09IGVuZENoaWxkS2V5ICYmIGlzU3Bhbihjb250ZXh0LCBjaGlsZCkgPyBzdGFydEJsb2NrLmNoaWxkcmVuLnB1c2goe1xuICAgICAgICAgICAgLi4uY2hpbGQsXG4gICAgICAgICAgICB0ZXh0OiBjaGlsZC50ZXh0LnNsaWNlKDAsIGVuZFBvaW50Lm9mZnNldClcbiAgICAgICAgICB9KSA6IHN0YXJ0QmxvY2suY2hpbGRyZW4ucHVzaChjaGlsZCksIGJsb2NrLl9rZXkgPT09IGVuZEJsb2NrS2V5ICYmIGVuZENoaWxkS2V5ICYmIGNoaWxkLl9rZXkgPT09IGVuZENoaWxkS2V5KSlcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGFydEJsb2NrS2V5ID09PSBlbmRCbG9ja0tleSlcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoc3RhcnRCbG9jayA9IGJsb2NrLCBzdGFydEJsb2NrS2V5ID09PSBlbmRCbG9ja0tleSlcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChibG9jay5fa2V5ID09PSBlbmRCbG9ja0tleSkge1xuICAgICAgaWYgKCFpc1RleHRCbG9jayhjb250ZXh0LCBibG9jaykpIHtcbiAgICAgICAgZW5kQmxvY2sgPSBibG9jaztcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoZW5kQ2hpbGRLZXkpIHtcbiAgICAgICAgZW5kQmxvY2sgPSB7XG4gICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgY2hpbGRyZW46IFtdXG4gICAgICAgIH07XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgYmxvY2suY2hpbGRyZW4pXG4gICAgICAgICAgaWYgKGVuZEJsb2NrICYmIGlzVGV4dEJsb2NrKGNvbnRleHQsIGVuZEJsb2NrKSkge1xuICAgICAgICAgICAgaWYgKGNoaWxkLl9rZXkgPT09IGVuZENoaWxkS2V5ICYmIGlzU3Bhbihjb250ZXh0LCBjaGlsZCkpIHtcbiAgICAgICAgICAgICAgZW5kQmxvY2suY2hpbGRyZW4ucHVzaCh7XG4gICAgICAgICAgICAgICAgLi4uY2hpbGQsXG4gICAgICAgICAgICAgICAgdGV4dDogY2hpbGQudGV4dC5zbGljZSgwLCBlbmRQb2ludC5vZmZzZXQpXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbmRCbG9jay5jaGlsZHJlbi5wdXNoKGNoaWxkKSwgZW5kQ2hpbGRLZXkgJiYgY2hpbGQuX2tleSA9PT0gZW5kQ2hpbGRLZXkpXG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBlbmRCbG9jayA9IGJsb2NrO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHN0YXJ0QmxvY2sgJiYgbWlkZGxlQmxvY2tzLnB1c2gocGFyc2VCbG9jayh7XG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICAgIGtleUdlbmVyYXRvcjogY29udGV4dC5rZXlHZW5lcmF0b3IgPz8gZGVmYXVsdEtleUdlbmVyYXRvclxuICAgICAgfSxcbiAgICAgIGJsb2NrLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBub3JtYWxpemU6ICExLFxuICAgICAgICByZW1vdmVVbnVzZWRNYXJrRGVmczogITAsXG4gICAgICAgIHZhbGlkYXRlRmllbGRzOiAhMVxuICAgICAgfVxuICAgIH0pID8/IGJsb2NrKTtcbiAgfVxuICBjb25zdCBwYXJzZWRTdGFydEJsb2NrID0gc3RhcnRCbG9jayA/IHBhcnNlQmxvY2soe1xuICAgIGNvbnRleHQ6IHtcbiAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICBrZXlHZW5lcmF0b3I6IGNvbnRleHQua2V5R2VuZXJhdG9yID8/IGRlZmF1bHRLZXlHZW5lcmF0b3JcbiAgICB9LFxuICAgIGJsb2NrOiBzdGFydEJsb2NrLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIG5vcm1hbGl6ZTogITEsXG4gICAgICByZW1vdmVVbnVzZWRNYXJrRGVmczogITAsXG4gICAgICB2YWxpZGF0ZUZpZWxkczogITFcbiAgICB9XG4gIH0pIDogdm9pZCAwLCBwYXJzZWRFbmRCbG9jayA9IGVuZEJsb2NrID8gcGFyc2VCbG9jayh7XG4gICAgY29udGV4dDoge1xuICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYSxcbiAgICAgIGtleUdlbmVyYXRvcjogY29udGV4dC5rZXlHZW5lcmF0b3IgPz8gZGVmYXVsdEtleUdlbmVyYXRvclxuICAgIH0sXG4gICAgYmxvY2s6IGVuZEJsb2NrLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIG5vcm1hbGl6ZTogITEsXG4gICAgICByZW1vdmVVbnVzZWRNYXJrRGVmczogITAsXG4gICAgICB2YWxpZGF0ZUZpZWxkczogITFcbiAgICB9XG4gIH0pIDogdm9pZCAwO1xuICByZXR1cm4gWy4uLnBhcnNlZFN0YXJ0QmxvY2sgPyBbcGFyc2VkU3RhcnRCbG9ja10gOiBbXSwgLi4ubWlkZGxlQmxvY2tzLCAuLi5wYXJzZWRFbmRCbG9jayA/IFtwYXJzZWRFbmRCbG9ja10gOiBbXV07XG59XG5leHBvcnQge1xuICBibG9ja09mZnNldFRvU3BhblNlbGVjdGlvblBvaW50LFxuICBkZWZhdWx0S2V5R2VuZXJhdG9yLFxuICBnZXRCbG9ja0VuZFBvaW50LFxuICBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludCxcbiAgZ2V0QmxvY2tTdGFydFBvaW50LFxuICBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludCxcbiAgZ2V0U2VsZWN0aW9uRW5kUG9pbnQsXG4gIGdldFNlbGVjdGlvblN0YXJ0UG9pbnQsXG4gIGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMsXG4gIGlzS2V5ZWRTZWdtZW50LFxuICBpc0xpc3RCbG9jayxcbiAgaXNTZWxlY3Rpb25Db2xsYXBzZWQsXG4gIGlzVHlwZWRPYmplY3QsXG4gIHBhcnNlQW5ub3RhdGlvbixcbiAgcGFyc2VCbG9jayxcbiAgcGFyc2VCbG9ja3MsXG4gIHBhcnNlSW5saW5lT2JqZWN0LFxuICBwYXJzZU1hcmtEZWZzLFxuICBwYXJzZVNwYW4sXG4gIHNsaWNlQmxvY2tzLFxuICBzcGFuU2VsZWN0aW9uUG9pbnRUb0Jsb2NrT2Zmc2V0XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbC5zbGljZS1ibG9ja3MuanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-text-block.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-text-block.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getTextBlockText: () => (/* binding */ getTextBlockText),\n/* harmony export */   isEmptyTextBlock: () => (/* binding */ isEmptyTextBlock),\n/* harmony export */   sliceTextBlock: () => (/* binding */ sliceTextBlock)\n/* harmony export */ });\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.slice-blocks.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n\n\nfunction getTextBlockText(block) {\n  return block.children.map((child) => child.text ?? \"\").join(\"\");\n}\nfunction isEmptyTextBlock(context, block) {\n  if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isTextBlock)(context, block))\n    return !1;\n  const onlyText = block.children.every((child) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child)), blockText = getTextBlockText(block);\n  return onlyText && blockText === \"\";\n}\nfunction sliceTextBlock({\n  context,\n  block\n}) {\n  const startPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__.getSelectionStartPoint)(context.selection), endPoint = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__.getSelectionEndPoint)(context.selection);\n  if (!startPoint || !endPoint)\n    return block;\n  const startBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__.getBlockKeyFromSelectionPoint)(startPoint), endBlockKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__.getBlockKeyFromSelectionPoint)(endPoint);\n  if (startBlockKey !== endBlockKey || startBlockKey !== block._key)\n    return block;\n  const startChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__.getChildKeyFromSelectionPoint)(startPoint), endChildKey = (0,_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_1__.getChildKeyFromSelectionPoint)(endPoint);\n  if (!startChildKey || !endChildKey)\n    return block;\n  let startChildFound = !1;\n  const children = [];\n  for (const child of block.children) {\n    if (child._key === startChildKey) {\n      if (startChildFound = !0, (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child)) {\n        const text = child._key === endChildKey ? child.text.slice(startPoint.offset, endPoint.offset) : child.text.slice(startPoint.offset);\n        children.push({\n          ...child,\n          text\n        });\n      } else\n        children.push(child);\n      if (startChildKey === endChildKey)\n        break;\n      continue;\n    }\n    if (child._key === endChildKey) {\n      (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_0__.isSpan)(context, child) ? children.push({\n        ...child,\n        text: child.text.slice(0, endPoint.offset)\n      }) : children.push(child);\n      break;\n    }\n    startChildFound && children.push(child);\n  }\n  return {\n    ...block,\n    children\n  };\n}\n\n//# sourceMappingURL=util.slice-text-block.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL19jaHVua3MtZXMvdXRpbC5zbGljZS10ZXh0LWJsb2NrLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTJEO0FBQ3lGO0FBQ3BKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxpRUFBVztBQUNsQjtBQUNBLG1EQUFtRCw0REFBTTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELHFCQUFxQiw2RUFBc0IsZ0NBQWdDLDJFQUFvQjtBQUMvRjtBQUNBO0FBQ0Esd0JBQXdCLG9GQUE2Qiw0QkFBNEIsb0ZBQTZCO0FBQzlHO0FBQ0E7QUFDQSx3QkFBd0Isb0ZBQTZCLDRCQUE0QixvRkFBNkI7QUFDOUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLDREQUFNO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLDREQUFNO0FBQ1o7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL19jaHVua3MtZXMvdXRpbC5zbGljZS10ZXh0LWJsb2NrLmpzPzFmNWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNUZXh0QmxvY2ssIGlzU3BhbiB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3NjaGVtYVwiO1xuaW1wb3J0IHsgZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQsIGdldFNlbGVjdGlvblN0YXJ0UG9pbnQsIGdldFNlbGVjdGlvbkVuZFBvaW50LCBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludCB9IGZyb20gXCIuL3V0aWwuc2xpY2UtYmxvY2tzLmpzXCI7XG5mdW5jdGlvbiBnZXRUZXh0QmxvY2tUZXh0KGJsb2NrKSB7XG4gIHJldHVybiBibG9jay5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC50ZXh0ID8/IFwiXCIpLmpvaW4oXCJcIik7XG59XG5mdW5jdGlvbiBpc0VtcHR5VGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSB7XG4gIGlmICghaXNUZXh0QmxvY2soY29udGV4dCwgYmxvY2spKVxuICAgIHJldHVybiAhMTtcbiAgY29uc3Qgb25seVRleHQgPSBibG9jay5jaGlsZHJlbi5ldmVyeSgoY2hpbGQpID0+IGlzU3Bhbihjb250ZXh0LCBjaGlsZCkpLCBibG9ja1RleHQgPSBnZXRUZXh0QmxvY2tUZXh0KGJsb2NrKTtcbiAgcmV0dXJuIG9ubHlUZXh0ICYmIGJsb2NrVGV4dCA9PT0gXCJcIjtcbn1cbmZ1bmN0aW9uIHNsaWNlVGV4dEJsb2NrKHtcbiAgY29udGV4dCxcbiAgYmxvY2tcbn0pIHtcbiAgY29uc3Qgc3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQoY29udGV4dC5zZWxlY3Rpb24pLCBlbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KGNvbnRleHQuc2VsZWN0aW9uKTtcbiAgaWYgKCFzdGFydFBvaW50IHx8ICFlbmRQb2ludClcbiAgICByZXR1cm4gYmxvY2s7XG4gIGNvbnN0IHN0YXJ0QmxvY2tLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChzdGFydFBvaW50KSwgZW5kQmxvY2tLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChlbmRQb2ludCk7XG4gIGlmIChzdGFydEJsb2NrS2V5ICE9PSBlbmRCbG9ja0tleSB8fCBzdGFydEJsb2NrS2V5ICE9PSBibG9jay5fa2V5KVxuICAgIHJldHVybiBibG9jaztcbiAgY29uc3Qgc3RhcnRDaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHN0YXJ0UG9pbnQpLCBlbmRDaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KGVuZFBvaW50KTtcbiAgaWYgKCFzdGFydENoaWxkS2V5IHx8ICFlbmRDaGlsZEtleSlcbiAgICByZXR1cm4gYmxvY2s7XG4gIGxldCBzdGFydENoaWxkRm91bmQgPSAhMTtcbiAgY29uc3QgY2hpbGRyZW4gPSBbXTtcbiAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbikge1xuICAgIGlmIChjaGlsZC5fa2V5ID09PSBzdGFydENoaWxkS2V5KSB7XG4gICAgICBpZiAoc3RhcnRDaGlsZEZvdW5kID0gITAsIGlzU3Bhbihjb250ZXh0LCBjaGlsZCkpIHtcbiAgICAgICAgY29uc3QgdGV4dCA9IGNoaWxkLl9rZXkgPT09IGVuZENoaWxkS2V5ID8gY2hpbGQudGV4dC5zbGljZShzdGFydFBvaW50Lm9mZnNldCwgZW5kUG9pbnQub2Zmc2V0KSA6IGNoaWxkLnRleHQuc2xpY2Uoc3RhcnRQb2ludC5vZmZzZXQpO1xuICAgICAgICBjaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgICAuLi5jaGlsZCxcbiAgICAgICAgICB0ZXh0XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlXG4gICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgaWYgKHN0YXJ0Q2hpbGRLZXkgPT09IGVuZENoaWxkS2V5KVxuICAgICAgICBicmVhaztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoY2hpbGQuX2tleSA9PT0gZW5kQ2hpbGRLZXkpIHtcbiAgICAgIGlzU3Bhbihjb250ZXh0LCBjaGlsZCkgPyBjaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgLi4uY2hpbGQsXG4gICAgICAgIHRleHQ6IGNoaWxkLnRleHQuc2xpY2UoMCwgZW5kUG9pbnQub2Zmc2V0KVxuICAgICAgfSkgOiBjaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBzdGFydENoaWxkRm91bmQgJiYgY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5ibG9jayxcbiAgICBjaGlsZHJlblxuICB9O1xufVxuZXhwb3J0IHtcbiAgZ2V0VGV4dEJsb2NrVGV4dCxcbiAgaXNFbXB0eVRleHRCbG9jayxcbiAgc2xpY2VUZXh0QmxvY2tcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD11dGlsLnNsaWNlLXRleHQtYmxvY2suanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-text-block.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js":
/*!******************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/behaviors/index.js ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   defineBehavior: () => (/* binding */ defineBehavior),\n/* harmony export */   effect: () => (/* binding */ effect),\n/* harmony export */   execute: () => (/* binding */ execute),\n/* harmony export */   forward: () => (/* binding */ forward),\n/* harmony export */   raise: () => (/* binding */ raise)\n/* harmony export */ });\nfunction execute(event) {\n  return {\n    type: \"execute\",\n    event\n  };\n}\nfunction forward(event) {\n  return {\n    type: \"forward\",\n    event\n  };\n}\nfunction raise(event) {\n  return {\n    type: \"raise\",\n    event\n  };\n}\nfunction effect(effect2) {\n  return {\n    type: \"effect\",\n    effect: effect2\n  };\n}\nfunction defineBehavior(behavior) {\n  return behavior;\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL2JlaGF2aW9ycy9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9FO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L2VkaXRvci9saWIvYmVoYXZpb3JzL2luZGV4LmpzP2U3NjYiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZXhlY3V0ZShldmVudCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiZXhlY3V0ZVwiLFxuICAgIGV2ZW50XG4gIH07XG59XG5mdW5jdGlvbiBmb3J3YXJkKGV2ZW50KSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJmb3J3YXJkXCIsXG4gICAgZXZlbnRcbiAgfTtcbn1cbmZ1bmN0aW9uIHJhaXNlKGV2ZW50KSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJyYWlzZVwiLFxuICAgIGV2ZW50XG4gIH07XG59XG5mdW5jdGlvbiBlZmZlY3QoZWZmZWN0Mikge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiZWZmZWN0XCIsXG4gICAgZWZmZWN0OiBlZmZlY3QyXG4gIH07XG59XG5mdW5jdGlvbiBkZWZpbmVCZWhhdmlvcihiZWhhdmlvcikge1xuICByZXR1cm4gYmVoYXZpb3I7XG59XG5leHBvcnQge1xuICBkZWZpbmVCZWhhdmlvcixcbiAgZWZmZWN0LFxuICBleGVjdXRlLFxuICBmb3J3YXJkLFxuICByYWlzZVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/index.js":
/*!********************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/index.js ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EditorProvider: () => (/* binding */ EditorProvider),\n/* harmony export */   PortableTextEditable: () => (/* binding */ PortableTextEditable),\n/* harmony export */   PortableTextEditor: () => (/* binding */ PortableTextEditor),\n/* harmony export */   defineSchema: () => (/* reexport safe */ _portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.defineSchema),\n/* harmony export */   keyGenerator: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.defaultKeyGenerator),\n/* harmony export */   useEditor: () => (/* reexport safe */ _chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_26__.useEditor),\n/* harmony export */   useEditorSelector: () => (/* binding */ useEditorSelector),\n/* harmony export */   usePortableTextEditor: () => (/* binding */ usePortableTextEditor),\n/* harmony export */   usePortableTextEditorSelection: () => (/* binding */ usePortableTextEditorSelection)\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-jsx-runtime.js\");\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n/* harmony import */ var _xstate_react__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @xstate/react */ \"(ssr)/./node_modules/@xstate/react/dist/xstate-react.development.esm.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var slate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! slate */ \"(ssr)/./node_modules/slate/dist/index.es.js\");\n/* harmony import */ var slate_react__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! slate-react */ \"(ssr)/./node_modules/slate-react/dist/index.es.js\");\n/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! debug */ \"(ssr)/./node_modules/debug/src/index.js\");\n/* harmony import */ var slate_dom__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! slate-dom */ \"(ssr)/./node_modules/slate-dom/dist/index.es.js\");\n/* harmony import */ var _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./_chunks-es/util.slice-blocks.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./_chunks-es/util.slice-text-block.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-text-block.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/xstate.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/assign-ef1b62f6.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/actors/dist/xstate-actors.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/raise-235fa0c7.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/log-3eec9346.development.esm.js\");\n/* harmony import */ var _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./_chunks-es/selector.is-at-the-start-of-block.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n/* harmony import */ var _behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./behaviors/index.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js\");\n/* harmony import */ var _portabletext_sanity_bridge__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @portabletext/sanity-bridge */ \"(ssr)/./node_modules/@portabletext/sanity-bridge/dist/index.js\");\n/* harmony import */ var _portabletext_block_tools__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @portabletext/block-tools */ \"(ssr)/./node_modules/@portabletext/block-tools/lib/index.js\");\n/* harmony import */ var _portabletext_to_html__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @portabletext/to-html */ \"(ssr)/./node_modules/@portabletext/to-html/dist/index.js\");\n/* harmony import */ var _portabletext_markdown__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @portabletext/markdown */ \"(ssr)/./node_modules/@portabletext/markdown/dist/index.js\");\n/* harmony import */ var _sanity_schema__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @sanity/schema */ \"(ssr)/./node_modules/@sanity/schema/lib/index.js\");\n/* harmony import */ var _portabletext_patches__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @portabletext/patches */ \"(ssr)/./node_modules/@portabletext/patches/dist/index.js\");\n/* harmony import */ var _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @portabletext/keyboard-shortcuts */ \"(ssr)/./node_modules/@portabletext/keyboard-shortcuts/dist/index.js\");\n/* harmony import */ var _chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./_chunks-es/use-editor.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\");\n/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! rxjs */ \"(ssr)/./node_modules/rxjs/dist/esm5/internal/Subject.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst rootName = \"sanity-pte:\";\ndebug__WEBPACK_IMPORTED_MODULE_3__(rootName);\nfunction debugWithName(name) {\n  const namespace = `${rootName}${name}`;\n  return debug__WEBPACK_IMPORTED_MODULE_3__ && debug__WEBPACK_IMPORTED_MODULE_3__.enabled(namespace) ? debug__WEBPACK_IMPORTED_MODULE_3__(namespace) : debug__WEBPACK_IMPORTED_MODULE_3__(rootName);\n}\nfunction isEqualValues(context, a, b) {\n  if (!a || !b)\n    return a === b;\n  if (a.length !== b.length)\n    return !1;\n  for (let index = 0; index < a.length; index++) {\n    const blockA = a.at(index), blockB = b.at(index);\n    if (!blockA || !blockB || !isEqualBlocks(context, blockA, blockB))\n      return !1;\n  }\n  return !0;\n}\nfunction isEqualBlocks(context, a, b) {\n  return a._type !== b._type ? !1 : a._type === context.schema.block.name && b._type === context.schema.block.name ? isEqualTextBlocks(context, a, b) : isEqualPortableTextObjects(a, b);\n}\nfunction isEqualTextBlocks(context, a, b) {\n  return !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, a) || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, b) || a._key !== b._key || a.style !== b.style || a.listItem !== b.listItem || a.level !== b.level || \"markDefs\" in a && \"markDefs\" in b && (!Array.isArray(a.markDefs) || !Array.isArray(b.markDefs) || !isEqualMarkDefs(a.markDefs, b.markDefs)) || !isEqualChildren(a.children, b.children) ? !1 : isEqualProps(a, b, [\"_key\", \"_type\", \"style\", \"listItem\", \"level\", \"markDefs\", \"children\"]);\n}\nfunction isEqualProps(a, b, excludeKeys) {\n  const keysA = Object.keys(a).filter((key) => !excludeKeys.includes(key)), keysB = Object.keys(b).filter((key) => !excludeKeys.includes(key));\n  if (keysA.length !== keysB.length)\n    return !1;\n  for (const key of keysA) {\n    if (!(key in a) || !(key in b))\n      return !1;\n    const valueA = a[key], valueB = b[key];\n    if (valueA !== valueB && !isDeepEqual(valueA, valueB))\n      return !1;\n  }\n  return !0;\n}\nfunction isEqualInlineObjects(a, b) {\n  return a._key !== b._key || a._type !== b._type ? !1 : isEqualProps(a, b, [\"_key\", \"_type\"]);\n}\nfunction isEqualMarks(a, b) {\n  if (!a || !b)\n    return a === b;\n  if (a.length !== b.length)\n    return !1;\n  for (let index = 0; index < a.length; index++)\n    if (a.at(index) !== b.at(index))\n      return !1;\n  return !0;\n}\nfunction isEqualSpans(a, b) {\n  return a._key !== b._key || a._type !== b._type || a.text !== b.text || !isEqualMarks(a.marks, b.marks) ? !1 : isEqualProps(a, b, [\"_key\", \"_type\", \"text\", \"marks\"]);\n}\nfunction isEqualMarkDefs(a, b) {\n  if (a.length !== b.length)\n    return !1;\n  for (let index = 0; index < a.length; index++) {\n    const markDefA = a.at(index), markDefB = b.at(index);\n    if (!markDefA || !markDefB || !isDeepEqual(markDefA, markDefB))\n      return !1;\n  }\n  return !0;\n}\nfunction isEqualChildren(a, b) {\n  if (a.length !== b.length)\n    return !1;\n  for (let index = 0; index < a.length; index++) {\n    const childA = a.at(index), childB = b.at(index);\n    if (!childA || !childB || !isEqualChild(childA, childB))\n      return !1;\n  }\n  return !0;\n}\nfunction isEqualChild(a, b) {\n  return a._type === \"span\" && b._type === \"span\" ? isEqualSpans(a, b) : isEqualInlineObjects(a, b);\n}\nfunction isEqualPortableTextObjects(a, b) {\n  return a._key !== b._key || a._type !== b._type ? !1 : isEqualProps(a, b, [\"_key\", \"_type\"]);\n}\nfunction isDeepEqual(data, other) {\n  return isDeepEqualImplementation(data, other);\n}\nfunction isDeepEqualImplementation(data, other) {\n  if (data === other || Object.is(data, other))\n    return !0;\n  if (typeof data != \"object\" || typeof other != \"object\" || data === null || other === null || Object.getPrototypeOf(data) !== Object.getPrototypeOf(other))\n    return !1;\n  if (Array.isArray(data))\n    return isDeepEqualArrays(data, other);\n  if (data instanceof Map)\n    return isDeepEqualMaps(data, other);\n  if (data instanceof Set)\n    return isDeepEqualSets(data, other);\n  if (data instanceof Date)\n    return data.getTime() === other.getTime();\n  if (data instanceof RegExp)\n    return data.toString() === other.toString();\n  if (Object.keys(data).length !== Object.keys(other).length)\n    return !1;\n  for (const [key, value] of Object.entries(data))\n    if (!(key in other) || !isDeepEqualImplementation(\n      value,\n      // @ts-expect-error [ts7053] - We already checked that `other` has `key`\n      other[key]\n    ))\n      return !1;\n  return !0;\n}\nfunction isDeepEqualArrays(data, other) {\n  if (data.length !== other.length)\n    return !1;\n  for (const [index, item] of data.entries())\n    if (!isDeepEqualImplementation(item, other[index]))\n      return !1;\n  return !0;\n}\nfunction isDeepEqualMaps(data, other) {\n  if (data.size !== other.size)\n    return !1;\n  for (const [key, value] of data.entries())\n    if (!other.has(key) || !isDeepEqualImplementation(value, other.get(key)))\n      return !1;\n  return !0;\n}\nfunction isDeepEqualSets(data, other) {\n  if (data.size !== other.size)\n    return !1;\n  const otherCopy = [...other];\n  for (const dataItem of data) {\n    let isFound = !1;\n    for (const [index, otherItem] of otherCopy.entries())\n      if (isDeepEqualImplementation(dataItem, otherItem)) {\n        isFound = !0, otherCopy.splice(index, 1);\n        break;\n      }\n    if (!isFound)\n      return !1;\n  }\n  return !0;\n}\nconst VOID_CHILD_KEY = \"void-child\";\nfunction toSlateBlock(block, {\n  schemaTypes\n}) {\n  const {\n    _type,\n    _key,\n    ...rest\n  } = block;\n  if (block && block._type === schemaTypes.block.name) {\n    const textBlock = block;\n    let hasInlines = !1;\n    const hasMissingMarkDefs = typeof textBlock.markDefs > \"u\", hasMissingChildren = typeof textBlock.children > \"u\", children = (textBlock.children || []).map((child) => {\n      const {\n        _type: childType,\n        _key: childKey,\n        ...childProps\n      } = child, propKeys = Object.keys(childProps);\n      return childType === void 0 && propKeys.length === 1 && propKeys.at(0) === \"text\" ? {\n        _key: childKey,\n        _type: schemaTypes.span.name,\n        text: childProps.text\n      } : childType !== schemaTypes.span.name ? (hasInlines = !0, {\n        _type: childType,\n        _key: childKey,\n        children: [{\n          _key: VOID_CHILD_KEY,\n          _type: schemaTypes.span.name,\n          text: \"\",\n          marks: []\n        }],\n        value: childProps,\n        __inline: !0\n      }) : child;\n    });\n    return !hasMissingMarkDefs && !hasMissingChildren && !hasInlines && slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(block) ? block : {\n      _type,\n      _key,\n      ...rest,\n      children\n    };\n  }\n  return {\n    _type,\n    _key,\n    children: [{\n      _key: VOID_CHILD_KEY,\n      _type: \"span\",\n      text: \"\",\n      marks: []\n    }],\n    value: rest\n  };\n}\nfunction fromSlateBlock(block, textBlockType) {\n  const {\n    _key,\n    _type\n  } = block;\n  if (!_key || !_type)\n    throw new Error(\"Not a valid block\");\n  if (_type === textBlockType && \"children\" in block && Array.isArray(block.children) && _key) {\n    let hasInlines = !1;\n    const children = block.children.map((child) => {\n      const {\n        _type: _cType\n      } = child;\n      if (\"value\" in child && _cType !== \"span\") {\n        hasInlines = !0;\n        const {\n          value: v,\n          _key: k,\n          _type: t,\n          __inline: _i,\n          children: _c,\n          ...rest\n        } = child;\n        return {\n          ...rest,\n          ...v,\n          _key: k,\n          _type: t\n        };\n      }\n      return child;\n    });\n    return hasInlines ? {\n      ...block,\n      children,\n      _key,\n      _type\n    } : block;\n  }\n  const blockValue = \"value\" in block && block.value;\n  return {\n    _key,\n    _type,\n    ...typeof blockValue == \"object\" ? blockValue : {}\n  };\n}\nfunction isEqualToEmptyEditor(initialValue, blocks, schemaTypes) {\n  if (!blocks || blocks.length !== 1)\n    return !1;\n  const firstBlock = blocks.at(0);\n  if (!firstBlock)\n    return !0;\n  if (!slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(firstBlock) || firstBlock._type !== schemaTypes.block.name || \"listItem\" in firstBlock || !(\"style\" in firstBlock) || firstBlock.style !== schemaTypes.styles.at(0)?.name || !Array.isArray(firstBlock.children) || firstBlock.children.length !== 1)\n    return !1;\n  const firstChild = firstBlock.children.at(0);\n  return !(!firstChild || !slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(firstChild) || !(\"_type\" in firstChild) || firstChild._type !== schemaTypes.span.name || firstChild.text !== \"\" || firstChild.marks?.join(\"\") || Object.keys(firstBlock).some((key) => key !== \"_type\" && key !== \"_key\" && key !== \"children\" && key !== \"markDefs\" && key !== \"style\") || isEqualValues({\n    schema: schemaTypes\n  }, initialValue, [firstBlock]));\n}\nfunction getFocusBlock({\n  editor\n}) {\n  if (!editor.selection)\n    return [void 0, void 0];\n  try {\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, editor.selection.focus.path.slice(0, 1)) ?? [void 0, void 0];\n  } catch {\n    return [void 0, void 0];\n  }\n}\nfunction getFocusSpan({\n  editor\n}) {\n  if (!editor.selection)\n    return [void 0, void 0];\n  try {\n    const [focusBlock] = getFocusBlock({\n      editor\n    });\n    if (!focusBlock)\n      return [void 0, void 0];\n    if (!editor.isTextBlock(focusBlock))\n      return [void 0, void 0];\n    const [node, path] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, editor.selection.focus.path.slice(0, 2));\n    if (editor.isTextSpan(node))\n      return [node, path];\n  } catch {\n    return [void 0, void 0];\n  }\n  return [void 0, void 0];\n}\nfunction getPointBlock({\n  editor,\n  point\n}) {\n  try {\n    const [block] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, point.path.slice(0, 1)) ?? [void 0, void 0];\n    return block ? [block, point.path.slice(0, 1)] : [void 0, void 0];\n  } catch {\n    return [void 0, void 0];\n  }\n}\nfunction getFocusChild({\n  editor\n}) {\n  const [focusBlock, focusBlockPath] = getFocusBlock({\n    editor\n  }), childIndex = editor.selection?.focus.path.at(1);\n  if (!focusBlock || !focusBlockPath || childIndex === void 0)\n    return [void 0, void 0];\n  try {\n    const focusChild = slate__WEBPACK_IMPORTED_MODULE_5__.Node.child(focusBlock, childIndex);\n    return focusChild ? [focusChild, [...focusBlockPath, childIndex]] : [void 0, void 0];\n  } catch {\n    return [void 0, void 0];\n  }\n}\nfunction getPointChild({\n  editor,\n  point\n}) {\n  const [block, blockPath] = getPointBlock({\n    editor,\n    point\n  }), childIndex = point.path.at(1);\n  if (!block || !blockPath || childIndex === void 0)\n    return [void 0, void 0];\n  try {\n    const pointChild = slate__WEBPACK_IMPORTED_MODULE_5__.Node.child(block, childIndex);\n    return pointChild ? [pointChild, [...blockPath, childIndex]] : [void 0, void 0];\n  } catch {\n    return [void 0, void 0];\n  }\n}\nfunction getFirstBlock({\n  editor\n}) {\n  if (editor.children.length === 0)\n    return [void 0, void 0];\n  const firstBlockPath = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, []).path.at(0);\n  try {\n    return firstBlockPath !== void 0 ? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, [firstBlockPath]) ?? [void 0, void 0] : [void 0, void 0];\n  } catch {\n    return [void 0, void 0];\n  }\n}\nfunction getLastBlock({\n  editor\n}) {\n  if (editor.children.length === 0)\n    return [void 0, void 0];\n  const lastBlockPath = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, []).path.at(0);\n  try {\n    return lastBlockPath !== void 0 ? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, [lastBlockPath]) ?? [void 0, void 0] : [void 0, void 0];\n  } catch {\n    return [void 0, void 0];\n  }\n}\nfunction getNodeBlock({\n  editor,\n  schema,\n  node\n}) {\n  if (slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(node))\n    return;\n  if (isBlockElement({\n    editor,\n    schema\n  }, node))\n    return elementToBlock({\n      schema,\n      element: node\n    });\n  const parent = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n    mode: \"highest\",\n    at: [],\n    match: (n) => isBlockElement({\n      editor,\n      schema\n    }, n) && n.children.some((child) => child._key === node._key)\n  })).at(0)?.at(0);\n  return slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(parent) ? elementToBlock({\n    schema,\n    element: parent\n  }) : void 0;\n}\nfunction elementToBlock({\n  schema,\n  element\n}) {\n  return fromSlateBlock(element, schema.block.name);\n}\nfunction isBlockElement({\n  editor,\n  schema\n}, node) {\n  return slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node) && !editor.isInline(node) && (schema.block.name === node._type || schema.blockObjects.some((blockObject) => blockObject.name === node._type));\n}\nfunction isListItemActive({\n  editor,\n  listItem\n}) {\n  if (!editor.selection)\n    return !1;\n  const selectedBlocks = [...slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n    at: editor.selection,\n    match: (node) => editor.isTextBlock(node)\n  })];\n  return selectedBlocks.length > 0 ? selectedBlocks.every(([node]) => editor.isListBlock(node) && node.listItem === listItem) : !1;\n}\nfunction isStyleActive({\n  editor,\n  style\n}) {\n  if (!editor.selection)\n    return !1;\n  const selectedBlocks = [...slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n    at: editor.selection,\n    match: (node) => editor.isTextBlock(node)\n  })];\n  return selectedBlocks.length > 0 ? selectedBlocks.every(([node]) => node.style === style) : !1;\n}\nfunction slateRangeToSelection({\n  schema,\n  editor,\n  range\n}) {\n  const [anchorBlock] = getPointBlock({\n    editor,\n    point: range.anchor\n  }), [focusBlock] = getPointBlock({\n    editor,\n    point: range.focus\n  });\n  if (!anchorBlock || !focusBlock)\n    return null;\n  const [anchorChild] = anchorBlock._type === schema.block.name ? getPointChild({\n    editor,\n    point: range.anchor\n  }) : [void 0, void 0], [focusChild] = focusBlock._type === schema.block.name ? getPointChild({\n    editor,\n    point: range.focus\n  }) : [void 0, void 0], selection = {\n    anchor: {\n      path: [{\n        _key: anchorBlock._key\n      }],\n      offset: range.anchor.offset\n    },\n    focus: {\n      path: [{\n        _key: focusBlock._key\n      }],\n      offset: range.focus.offset\n    },\n    backward: slate__WEBPACK_IMPORTED_MODULE_5__.Range.isBackward(range)\n  };\n  return anchorChild && (selection.anchor.path.push(\"children\"), selection.anchor.path.push({\n    _key: anchorChild._key\n  })), focusChild && (selection.focus.path.push(\"children\"), selection.focus.path.push({\n    _key: focusChild._key\n  })), selection;\n}\nfunction slatePointToSelectionPoint({\n  schema,\n  editor,\n  point\n}) {\n  const [block] = getPointBlock({\n    editor,\n    point\n  });\n  if (!block)\n    return;\n  const [child] = block._type === schema.block.name ? getPointChild({\n    editor,\n    point\n  }) : [void 0, void 0];\n  return child ? {\n    path: [{\n      _key: block._key\n    }, \"children\", {\n      _key: child._key\n    }],\n    offset: point.offset\n  } : {\n    path: [{\n      _key: block._key\n    }],\n    offset: point.offset\n  };\n}\nfunction getEventPosition({\n  editorActor,\n  slateEditor,\n  event\n}) {\n  if (editorActor.getSnapshot().matches({\n    setup: \"setting up\"\n  }))\n    return;\n  const eventNode = getEventNode({\n    slateEditor,\n    event\n  });\n  if (!eventNode)\n    return;\n  const eventBlock = getNodeBlock({\n    editor: slateEditor,\n    schema: editorActor.getSnapshot().context.schema,\n    node: eventNode\n  }), eventPositionBlock = getEventPositionBlock({\n    node: eventNode,\n    slateEditor,\n    event\n  }), eventSelection = getEventSelection({\n    schema: editorActor.getSnapshot().context.schema,\n    slateEditor,\n    event\n  });\n  if (eventBlock && eventPositionBlock && !eventSelection && !slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(eventNode))\n    return {\n      block: eventPositionBlock,\n      isEditor: !1,\n      selection: {\n        anchor: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n          context: editorActor.getSnapshot().context,\n          block: {\n            node: eventBlock,\n            path: [{\n              _key: eventBlock._key\n            }]\n          }\n        }),\n        focus: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n          context: editorActor.getSnapshot().context,\n          block: {\n            node: eventBlock,\n            path: [{\n              _key: eventBlock._key\n            }]\n          }\n        })\n      }\n    };\n  if (!eventPositionBlock || !eventSelection)\n    return;\n  const eventSelectionFocusBlockKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockKeyFromSelectionPoint)(eventSelection.focus);\n  if (eventSelectionFocusBlockKey !== void 0)\n    return (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(eventSelection) && eventBlock && eventSelectionFocusBlockKey !== eventBlock._key ? {\n      block: eventPositionBlock,\n      isEditor: !1,\n      selection: {\n        anchor: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n          context: editorActor.getSnapshot().context,\n          block: {\n            node: eventBlock,\n            path: [{\n              _key: eventBlock._key\n            }]\n          }\n        }),\n        focus: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n          context: editorActor.getSnapshot().context,\n          block: {\n            node: eventBlock,\n            path: [{\n              _key: eventBlock._key\n            }]\n          }\n        })\n      }\n    } : {\n      block: eventPositionBlock,\n      isEditor: slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(eventNode),\n      selection: eventSelection\n    };\n}\nfunction getEventNode({\n  slateEditor,\n  event\n}) {\n  if (!slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.hasTarget(slateEditor, event.target))\n    return;\n  let node;\n  try {\n    node = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toSlateNode(slateEditor, event.target);\n  } catch (error) {\n    console.error(error);\n  }\n  return node;\n}\nfunction getEventPositionBlock({\n  node,\n  slateEditor,\n  event\n}) {\n  const [firstBlock] = getFirstBlock({\n    editor: slateEditor\n  });\n  if (!firstBlock)\n    return;\n  let firstBlockElement;\n  try {\n    firstBlockElement = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMNode(slateEditor, firstBlock);\n  } catch (error) {\n    console.error(error);\n  }\n  if (!firstBlockElement)\n    return;\n  const firstBlockRect = firstBlockElement.getBoundingClientRect();\n  if (event.pageY < firstBlockRect.top)\n    return \"start\";\n  const [lastBlock] = getLastBlock({\n    editor: slateEditor\n  });\n  if (!lastBlock)\n    return;\n  let lastBlockElement;\n  try {\n    lastBlockElement = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMNode(slateEditor, lastBlock);\n  } catch (error) {\n    console.error(error);\n  }\n  if (!lastBlockElement)\n    return;\n  const lastBlockRef = lastBlockElement.getBoundingClientRect();\n  if (event.pageY > lastBlockRef.bottom)\n    return \"end\";\n  let element;\n  try {\n    element = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMNode(slateEditor, node);\n  } catch (error) {\n    console.error(error);\n  }\n  if (!element)\n    return;\n  const elementRect = element.getBoundingClientRect(), top = elementRect.top, height = elementRect.height;\n  return Math.abs(top - event.pageY) < height / 2 ? \"start\" : \"end\";\n}\nfunction getEventSelection({\n  schema,\n  slateEditor,\n  event\n}) {\n  const range = getSlateRangeFromEvent(slateEditor, event);\n  return range ? slateRangeToSelection({\n    schema,\n    editor: slateEditor,\n    range\n  }) : null;\n}\nfunction getSlateRangeFromEvent(editor, event) {\n  if (!event.target || !(0,slate_dom__WEBPACK_IMPORTED_MODULE_7__.isDOMNode)(event.target))\n    return;\n  const window2 = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.getWindow(editor);\n  let domRange;\n  if (window2.document.caretPositionFromPoint !== void 0) {\n    const position = window2.document.caretPositionFromPoint(event.clientX, event.clientY);\n    if (position)\n      try {\n        domRange = window2.document.createRange(), domRange.setStart(position.offsetNode, position.offset), domRange.setEnd(position.offsetNode, position.offset);\n      } catch {\n      }\n  } else if (window2.document.caretRangeFromPoint !== void 0)\n    domRange = window2.document.caretRangeFromPoint(event.clientX, event.clientY) ?? void 0;\n  else {\n    console.warn(\"Neither caretPositionFromPoint nor caretRangeFromPoint is supported\");\n    return;\n  }\n  if (!domRange)\n    return;\n  let range;\n  try {\n    range = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toSlateRange(editor, domRange, {\n      exactMatch: !1,\n      // It can still throw even with this option set to true\n      suppressThrow: !1\n    });\n  } catch {\n  }\n  return range;\n}\nfunction normalizePoint(point, value) {\n  if (!point || !value)\n    return null;\n  const newPath = [];\n  let newOffset = point.offset || 0;\n  const blockKey = typeof point.path[0] == \"object\" && \"_key\" in point.path[0] && point.path[0]._key, childKey = typeof point.path[2] == \"object\" && \"_key\" in point.path[2] && point.path[2]._key, block = value.find((blk) => blk._key === blockKey);\n  if (block)\n    newPath.push({\n      _key: block._key\n    });\n  else\n    return null;\n  if (block && point.path[1] === \"children\") {\n    if (!block.children || Array.isArray(block.children) && block.children.length === 0)\n      return null;\n    const child = Array.isArray(block.children) && block.children.find((cld) => cld._key === childKey);\n    if (child)\n      newPath.push(\"children\"), newPath.push({\n        _key: child._key\n      }), newOffset = child.text && child.text.length >= point.offset ? point.offset : child.text && child.text.length || 0;\n    else\n      return null;\n  }\n  return {\n    path: newPath,\n    offset: newOffset\n  };\n}\nfunction normalizeSelection(selection, value) {\n  if (!selection || !value || value.length === 0)\n    return null;\n  let newAnchor = null, newFocus = null;\n  const {\n    anchor,\n    focus\n  } = selection;\n  return anchor && value.find((blk) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(anchor.path[0]) && blk._key === anchor.path[0]._key) && (newAnchor = normalizePoint(anchor, value)), focus && value.find((blk) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(focus.path[0]) && blk._key === focus.path[0]._key) && (newFocus = normalizePoint(focus, value)), newAnchor && newFocus ? {\n    anchor: newAnchor,\n    focus: newFocus,\n    backward: selection.backward\n  } : null;\n}\nfunction toSlateRange(snapshot) {\n  if (!snapshot.context.selection)\n    return null;\n  if ((0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(snapshot.context.selection.anchor, snapshot.context.selection.focus)) {\n    const anchorPoint2 = toSlateSelectionPoint(snapshot, snapshot.context.selection.anchor, snapshot.context.selection.backward ? \"backward\" : \"forward\");\n    return anchorPoint2 ? {\n      anchor: anchorPoint2,\n      focus: anchorPoint2\n    } : null;\n  }\n  const anchorPoint = toSlateSelectionPoint(snapshot, snapshot.context.selection.anchor, snapshot.context.selection.backward ? \"forward\" : \"backward\"), focusPoint = toSlateSelectionPoint(snapshot, snapshot.context.selection.focus, snapshot.context.selection.backward ? \"backward\" : \"forward\");\n  return !anchorPoint || !focusPoint ? null : {\n    anchor: anchorPoint,\n    focus: focusPoint\n  };\n}\nfunction toSlateSelectionPoint(snapshot, selectionPoint, direction) {\n  const blockKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockKeyFromSelectionPoint)(selectionPoint);\n  if (!blockKey)\n    return;\n  const blockIndex = snapshot.blockIndexMap.get(blockKey);\n  if (blockIndex === void 0)\n    return;\n  const block = snapshot.context.value.at(blockIndex);\n  if (!block)\n    return;\n  if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, block))\n    return {\n      path: [blockIndex, 0],\n      offset: 0\n    };\n  let childKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getChildKeyFromSelectionPoint)({\n    path: selectionPoint.path\n  });\n  const spanSelectionPoint = childKey ? void 0 : (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.blockOffsetToSpanSelectionPoint)({\n    context: {\n      schema: snapshot.context.schema,\n      value: [block]\n    },\n    blockOffset: {\n      path: [{\n        _key: blockKey\n      }],\n      offset: selectionPoint.offset\n    },\n    direction\n  });\n  if (childKey = spanSelectionPoint ? (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getChildKeyFromSelectionPoint)(spanSelectionPoint) : childKey, !childKey)\n    return {\n      path: [blockIndex, 0],\n      offset: 0\n    };\n  let offset = spanSelectionPoint?.offset ?? selectionPoint.offset, childPath = [], childIndex = -1, pathChild;\n  for (const child of block.children)\n    if (childIndex++, child._key === childKey) {\n      pathChild = child, (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(snapshot.context, child) ? childPath = [childIndex] : (childPath = [childIndex, 0], offset = 0);\n      break;\n    }\n  return childPath.length === 0 ? {\n    path: [blockIndex, 0],\n    offset: 0\n  } : {\n    path: [blockIndex].concat(childPath),\n    offset: (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(snapshot.context, pathChild) ? Math.min(pathChild.text.length, offset) : offset\n  };\n}\nconst EditorActorContext = (0,react__WEBPACK_IMPORTED_MODULE_2__.createContext)({});\nfunction moveRangeByOperation(range, operation) {\n  const anchor = slate__WEBPACK_IMPORTED_MODULE_5__.Point.transform(range.anchor, operation), focus = slate__WEBPACK_IMPORTED_MODULE_5__.Point.transform(range.focus, operation);\n  return anchor === null || focus === null ? null : slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(anchor, range.anchor) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(focus, range.focus) ? range : {\n    anchor,\n    focus\n  };\n}\nconst slateOperationCallback = ({\n  input,\n  sendBack\n}) => {\n  const originalApply = input.slateEditor.apply;\n  return input.slateEditor.apply = (op) => {\n    op.type !== \"set_selection\" && sendBack({\n      type: \"slate operation\",\n      operation: op\n    }), originalApply(op);\n  }, () => {\n    input.slateEditor.apply = originalApply;\n  };\n}, rangeDecorationsMachine = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    input: {},\n    events: {}\n  },\n  actions: {\n    \"update pending range decorations\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingRangeDecorations: ({\n        context,\n        event\n      }) => event.type !== \"range decorations updated\" ? context.pendingRangeDecorations : event.rangeDecorations\n    }),\n    \"set up initial range decorations\": ({\n      context\n    }) => {\n      const rangeDecorationState = [];\n      for (const rangeDecoration of context.pendingRangeDecorations) {\n        const slateRange = toSlateRange({\n          context: {\n            schema: context.schema,\n            value: context.slateEditor.value,\n            selection: rangeDecoration.selection\n          },\n          blockIndexMap: context.slateEditor.blockIndexMap\n        });\n        if (!slate__WEBPACK_IMPORTED_MODULE_5__.Range.isRange(slateRange)) {\n          rangeDecoration.onMoved?.({\n            newSelection: null,\n            rangeDecoration,\n            origin: \"local\"\n          });\n          continue;\n        }\n        rangeDecorationState.push({\n          rangeDecoration,\n          ...slateRange\n        });\n      }\n      context.slateEditor.decoratedRanges = rangeDecorationState;\n    },\n    \"update range decorations\": ({\n      context,\n      event\n    }) => {\n      if (event.type !== \"range decorations updated\")\n        return;\n      const rangeDecorationState = [];\n      for (const rangeDecoration of event.rangeDecorations) {\n        const slateRange = toSlateRange({\n          context: {\n            schema: context.schema,\n            value: context.slateEditor.value,\n            selection: rangeDecoration.selection\n          },\n          blockIndexMap: context.slateEditor.blockIndexMap\n        });\n        if (!slate__WEBPACK_IMPORTED_MODULE_5__.Range.isRange(slateRange)) {\n          rangeDecoration.onMoved?.({\n            newSelection: null,\n            rangeDecoration,\n            origin: \"local\"\n          });\n          continue;\n        }\n        rangeDecorationState.push({\n          rangeDecoration,\n          ...slateRange\n        });\n      }\n      context.slateEditor.decoratedRanges = rangeDecorationState;\n    },\n    \"move range decorations\": ({\n      context,\n      event\n    }) => {\n      if (event.type !== \"slate operation\")\n        return;\n      const rangeDecorationState = [];\n      for (const decoratedRange of context.slateEditor.decoratedRanges) {\n        const slateRange = toSlateRange({\n          context: {\n            schema: context.schema,\n            value: context.slateEditor.value,\n            selection: decoratedRange.rangeDecoration.selection\n          },\n          blockIndexMap: context.slateEditor.blockIndexMap\n        });\n        if (!slate__WEBPACK_IMPORTED_MODULE_5__.Range.isRange(slateRange)) {\n          decoratedRange.rangeDecoration.onMoved?.({\n            newSelection: null,\n            rangeDecoration: decoratedRange.rangeDecoration,\n            origin: \"local\"\n          });\n          continue;\n        }\n        let newRange;\n        if (newRange = moveRangeByOperation(slateRange, event.operation), newRange && newRange !== slateRange || newRange === null && slateRange) {\n          const newRangeSelection = newRange ? slateRangeToSelection({\n            schema: context.schema,\n            editor: context.slateEditor,\n            range: newRange\n          }) : null;\n          decoratedRange.rangeDecoration.onMoved?.({\n            newSelection: newRangeSelection,\n            rangeDecoration: decoratedRange.rangeDecoration,\n            origin: \"local\"\n          });\n        }\n        newRange !== null && rangeDecorationState.push({\n          ...newRange || slateRange,\n          rangeDecoration: {\n            ...decoratedRange.rangeDecoration,\n            selection: slateRangeToSelection({\n              schema: context.schema,\n              editor: context.slateEditor,\n              range: newRange\n            })\n          }\n        });\n      }\n      context.slateEditor.decoratedRanges = rangeDecorationState;\n    },\n    \"assign readOnly\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      readOnly: ({\n        context,\n        event\n      }) => event.type !== \"update read only\" ? context.readOnly : event.readOnly\n    }),\n    \"update decorate\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      decorate: ({\n        context\n      }) => ({\n        fn: createDecorate(context.schema, context.slateEditor)\n      })\n    })\n  },\n  actors: {\n    \"slate operation listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_10__.fromCallback)(slateOperationCallback)\n  },\n  guards: {\n    \"has pending range decorations\": ({\n      context\n    }) => context.pendingRangeDecorations.length > 0,\n    \"has range decorations\": ({\n      context\n    }) => context.slateEditor.decoratedRanges.length > 0,\n    \"has different decorations\": ({\n      context,\n      event\n    }) => {\n      if (event.type !== \"range decorations updated\")\n        return !1;\n      const existingRangeDecorations = context.slateEditor.decoratedRanges.map((decoratedRange) => ({\n        anchor: decoratedRange.rangeDecoration.selection?.anchor,\n        focus: decoratedRange.rangeDecoration.selection?.focus,\n        payload: decoratedRange.rangeDecoration.payload\n      })), newRangeDecorations = event.rangeDecorations.map((rangeDecoration) => ({\n        anchor: rangeDecoration.selection?.anchor,\n        focus: rangeDecoration.selection?.focus,\n        payload: rangeDecoration.payload\n      }));\n      return !isDeepEqual(existingRangeDecorations, newRangeDecorations);\n    },\n    \"not read only\": ({\n      context\n    }) => !context.readOnly,\n    \"should skip setup\": ({\n      context\n    }) => context.skipSetup\n  }\n}).createMachine({\n  id: \"range decorations\",\n  context: ({\n    input\n  }) => ({\n    readOnly: input.readOnly,\n    pendingRangeDecorations: input.rangeDecorations,\n    decoratedRanges: [],\n    skipSetup: input.skipSetup,\n    schema: input.schema,\n    slateEditor: input.slateEditor,\n    decorate: {\n      fn: createDecorate(input.schema, input.slateEditor)\n    }\n  }),\n  invoke: {\n    src: \"slate operation listener\",\n    input: ({\n      context\n    }) => ({\n      slateEditor: context.slateEditor\n    })\n  },\n  on: {\n    \"update read only\": {\n      actions: [\"assign readOnly\"]\n    }\n  },\n  initial: \"setting up\",\n  states: {\n    \"setting up\": {\n      always: [{\n        guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.d)([\"should skip setup\", \"has pending range decorations\"]),\n        target: \"ready\",\n        actions: [\"set up initial range decorations\", \"update decorate\"]\n      }, {\n        guard: \"should skip setup\",\n        target: \"ready\"\n      }],\n      on: {\n        \"range decorations updated\": {\n          actions: [\"update pending range decorations\"]\n        },\n        ready: [{\n          target: \"ready\",\n          guard: \"has pending range decorations\",\n          actions: [\"set up initial range decorations\", \"update decorate\"]\n        }, {\n          target: \"ready\"\n        }]\n      }\n    },\n    ready: {\n      initial: \"idle\",\n      on: {\n        \"range decorations updated\": {\n          target: \".idle\",\n          guard: \"has different decorations\",\n          actions: [\"update range decorations\", \"update decorate\"]\n        }\n      },\n      states: {\n        idle: {\n          on: {\n            \"slate operation\": {\n              target: \"moving range decorations\",\n              guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.d)([\"has range decorations\", \"not read only\"])\n            }\n          }\n        },\n        \"moving range decorations\": {\n          entry: [\"move range decorations\"],\n          always: {\n            target: \"idle\"\n          }\n        }\n      }\n    }\n  }\n});\nfunction createDecorate(schema, slateEditor) {\n  return function([node, path]) {\n    const defaultStyle = schema.styles.at(0)?.name;\n    if (slateEditor.value.length === 1 && (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)({\n      schema\n    }, slateEditor.value[0]) && (!slateEditor.value[0].style || slateEditor.value[0].style === defaultStyle) && !slateEditor.value[0].listItem)\n      return [{\n        anchor: {\n          path: [0, 0],\n          offset: 0\n        },\n        focus: {\n          path: [0, 0],\n          offset: 0\n        },\n        placeholder: !0\n      }];\n    if (path.length === 0)\n      return [];\n    if (!slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node) || node.children.length === 0)\n      return [];\n    const blockIndex = path.at(0);\n    return blockIndex === void 0 ? [] : slateEditor.decoratedRanges.filter((decoratedRange) => slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(decoratedRange) ? node.children.some((_, childIndex) => slate__WEBPACK_IMPORTED_MODULE_5__.Path.equals(decoratedRange.anchor.path, [blockIndex, childIndex]) && slate__WEBPACK_IMPORTED_MODULE_5__.Path.equals(decoratedRange.focus.path, [blockIndex, childIndex])) : slate__WEBPACK_IMPORTED_MODULE_5__.Range.intersection(decoratedRange, {\n      anchor: {\n        path,\n        offset: 0\n      },\n      focus: {\n        path,\n        offset: 0\n      }\n    }) || slate__WEBPACK_IMPORTED_MODULE_5__.Range.includes(decoratedRange, path));\n  };\n}\nconst RelayActorContext = (0,react__WEBPACK_IMPORTED_MODULE_2__.createContext)({});\nfunction RenderDefaultBlockObject(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(4);\n  let t0;\n  $[0] === /* @__PURE__ */ Symbol.for(\"react.memo_cache_sentinel\") ? (t0 = {\n    userSelect: \"none\"\n  }, $[0] = t0) : t0 = $[0];\n  let t1;\n  return $[1] !== props.blockObject._key || $[2] !== props.blockObject._type ? (t1 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", { style: t0, children: [\n    \"[\",\n    props.blockObject._type,\n    \": \",\n    props.blockObject._key,\n    \"]\"\n  ] }), $[1] = props.blockObject._key, $[2] = props.blockObject._type, $[3] = t1) : t1 = $[3], t1;\n}\nfunction RenderDefaultInlineObject(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(4);\n  let t0;\n  $[0] === /* @__PURE__ */ Symbol.for(\"react.memo_cache_sentinel\") ? (t0 = {\n    userSelect: \"none\"\n  }, $[0] = t0) : t0 = $[0];\n  let t1;\n  return $[1] !== props.inlineObject._key || $[2] !== props.inlineObject._type ? (t1 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"span\", { style: t0, children: [\n    \"[\",\n    props.inlineObject._type,\n    \": \",\n    props.inlineObject._key,\n    \"]\"\n  ] }), $[1] = props.inlineObject._key, $[2] = props.inlineObject._type, $[3] = t1) : t1 = $[3], t1;\n}\nfunction DropIndicator() {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(1);\n  let t0;\n  return $[0] === /* @__PURE__ */ Symbol.for(\"react.memo_cache_sentinel\") ? (t0 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", { contentEditable: !1, className: \"pt-drop-indicator\", style: {\n    position: \"absolute\",\n    width: \"100%\",\n    height: 1,\n    borderBottom: \"1px solid currentColor\",\n    zIndex: 5\n  }, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", {}) }), $[0] = t0) : t0 = $[0], t0;\n}\nfunction createEditorPriority(config) {\n  return {\n    id: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.defaultKeyGenerator)(),\n    name: config?.name,\n    reference: config?.reference\n  };\n}\nconst corePriority = createEditorPriority({\n  name: \"core\"\n});\nfunction getDragSelection({\n  eventSelection,\n  snapshot\n}) {\n  let dragSelection = eventSelection;\n  if ((0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusInlineObject)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: eventSelection\n    }\n  }))\n    return dragSelection;\n  const draggingCollapsedSelection = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)({\n    context: {\n      ...snapshot.context,\n      selection: eventSelection\n    }\n  }), draggedTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: eventSelection\n    }\n  }), draggedSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: eventSelection\n    }\n  });\n  draggingCollapsedSelection && draggedTextBlock && draggedSpan && (dragSelection = {\n    anchor: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n      context: snapshot.context,\n      block: draggedTextBlock\n    }),\n    focus: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: draggedTextBlock\n    })\n  });\n  const selectedBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)(snapshot);\n  if (snapshot.context.selection && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot) && selectedBlocks.length > 1) {\n    const selectionStartBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartBlock)(snapshot), selectionEndBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndBlock)(snapshot);\n    if (!selectionStartBlock || !selectionEndBlock)\n      return dragSelection;\n    const selectionStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n      context: snapshot.context,\n      block: selectionStartBlock\n    }), selectionEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: selectionEndBlock\n    });\n    (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isOverlappingSelection)(eventSelection)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: selectionStartPoint,\n          focus: selectionEndPoint\n        }\n      }\n    }) && (dragSelection = {\n      anchor: selectionStartPoint,\n      focus: selectionEndPoint\n    });\n  }\n  return dragSelection;\n}\nfunction createCoreBlockElementBehaviorsConfig({\n  key,\n  onSetDragPositionBlock\n}) {\n  return [{\n    behavior: (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n      on: \"drag.dragover\",\n      guard: ({\n        snapshot,\n        event\n      }) => {\n        const dropFocusBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlock)({\n          ...snapshot,\n          context: {\n            ...snapshot.context,\n            selection: event.position.selection\n          }\n        });\n        if (!dropFocusBlock || dropFocusBlock.node._key !== key)\n          return !1;\n        const dragOrigin = event.dragOrigin;\n        if (!dragOrigin)\n          return !1;\n        const dragSelection = getDragSelection({\n          eventSelection: dragOrigin.selection,\n          snapshot\n        });\n        return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)({\n          ...snapshot,\n          context: {\n            ...snapshot.context,\n            selection: dragSelection\n          }\n        }).some((draggedBlock) => draggedBlock.node._key === key) ? !1 : (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectingEntireBlocks)({\n          ...snapshot,\n          context: {\n            ...snapshot.context,\n            selection: dragSelection\n          }\n        });\n      },\n      actions: [({\n        event\n      }) => [{\n        type: \"effect\",\n        effect: () => {\n          onSetDragPositionBlock(event.position.block);\n        }\n      }]]\n    }),\n    priority: createEditorPriority({\n      reference: {\n        priority: corePriority,\n        importance: \"lower\"\n      }\n    })\n  }, {\n    behavior: (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n      on: \"drag.*\",\n      guard: ({\n        event\n      }) => event.type !== \"drag.dragover\",\n      actions: [({\n        event\n      }) => [{\n        type: \"effect\",\n        effect: () => {\n          onSetDragPositionBlock(void 0);\n        }\n      }, (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)]]\n    }),\n    priority: createEditorPriority({\n      reference: {\n        priority: corePriority,\n        importance: \"lower\"\n      }\n    })\n  }];\n}\nfunction useCoreBlockElementBehaviors(t0) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(5), {\n    key,\n    onSetDragPositionBlock\n  } = t0, editorActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(EditorActorContext);\n  let t1, t2;\n  $[0] !== editorActor || $[1] !== key || $[2] !== onSetDragPositionBlock ? (t1 = () => {\n    const behaviorConfigs = createCoreBlockElementBehaviorsConfig({\n      key,\n      onSetDragPositionBlock\n    });\n    for (const behaviorConfig of behaviorConfigs)\n      editorActor.send({\n        type: \"add behavior\",\n        behaviorConfig\n      });\n    return () => {\n      for (const behaviorConfig_0 of behaviorConfigs)\n        editorActor.send({\n          type: \"remove behavior\",\n          behaviorConfig: behaviorConfig_0\n        });\n    };\n  }, t2 = [editorActor, key, onSetDragPositionBlock], $[0] = editorActor, $[1] = key, $[2] = onSetDragPositionBlock, $[3] = t1, $[4] = t2) : (t1 = $[3], t2 = $[4]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t1, t2);\n}\nfunction RenderBlockObject(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(35), [dragPositionBlock, setDragPositionBlock] = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(), blockObjectRef = (0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(null), selected = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSelected)();\n  let t0;\n  $[0] !== selected ? (t0 = (editor) => selected && editor.selection !== null && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(editor.selection), $[0] = selected, $[1] = t0) : t0 = $[1];\n  const focused = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateSelector)(t0);\n  let t1;\n  $[2] !== props.element._key ? (t1 = {\n    key: props.element._key,\n    onSetDragPositionBlock: setDragPositionBlock\n  }, $[2] = props.element._key, $[3] = t1) : t1 = $[3], useCoreBlockElementBehaviors(t1);\n  let t2;\n  if ($[4] !== props.element._type || $[5] !== props.legacySchema.blockObjects) {\n    let t32;\n    $[7] !== props.element._type ? (t32 = (schemaType) => schemaType.name === props.element._type, $[7] = props.element._type, $[8] = t32) : t32 = $[8], t2 = props.legacySchema.blockObjects.find(t32), $[4] = props.element._type, $[5] = props.legacySchema.blockObjects, $[6] = t2;\n  } else\n    t2 = $[6];\n  const legacySchemaType = t2;\n  legacySchemaType || console.error(`Unable to find Block Object \"${props.element._type}\" in Schema`);\n  let t3;\n  $[9] !== props.blockObject || $[10] !== props.element._key || $[11] !== props.element._type ? (t3 = props.blockObject ?? {\n    _key: props.element._key,\n    _type: props.element._type\n  }, $[9] = props.blockObject, $[10] = props.element._key, $[11] = props.element._type, $[12] = t3) : t3 = $[12];\n  const blockObject = t3;\n  let t4;\n  $[13] !== dragPositionBlock ? (t4 = dragPositionBlock === \"start\" ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropIndicator, {}) : null, $[13] = dragPositionBlock, $[14] = t4) : t4 = $[14];\n  const t5 = !props.readOnly;\n  let t6;\n  $[15] !== blockObject || $[16] !== focused || $[17] !== legacySchemaType || $[18] !== props.element._key || $[19] !== props.renderBlock || $[20] !== selected ? (t6 = props.renderBlock && legacySchemaType ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderBlock$1, { renderBlock: props.renderBlock, editorElementRef: blockObjectRef, focused, path: [{\n    _key: props.element._key\n  }], schemaType: legacySchemaType, selected, type: legacySchemaType, value: blockObject, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderDefaultBlockObject, { blockObject }) }) : /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderDefaultBlockObject, { blockObject }), $[15] = blockObject, $[16] = focused, $[17] = legacySchemaType, $[18] = props.element._key, $[19] = props.renderBlock, $[20] = selected, $[21] = t6) : t6 = $[21];\n  let t7;\n  $[22] !== t5 || $[23] !== t6 ? (t7 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", { ref: blockObjectRef, contentEditable: !1, draggable: t5, children: t6 }), $[22] = t5, $[23] = t6, $[24] = t7) : t7 = $[24];\n  let t8;\n  $[25] !== dragPositionBlock ? (t8 = dragPositionBlock === \"end\" ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropIndicator, {}) : null, $[25] = dragPositionBlock, $[26] = t8) : t8 = $[26];\n  let t9;\n  return $[27] !== props.attributes || $[28] !== props.children || $[29] !== props.element._key || $[30] !== props.element._type || $[31] !== t4 || $[32] !== t7 || $[33] !== t8 ? (t9 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", { ...props.attributes, className: \"pt-block pt-object-block\", \"data-block-key\": props.element._key, \"data-block-name\": props.element._type, \"data-block-type\": \"object\", children: [\n    t4,\n    props.children,\n    t7,\n    t8\n  ] }), $[27] = props.attributes, $[28] = props.children, $[29] = props.element._key, $[30] = props.element._type, $[31] = t4, $[32] = t7, $[33] = t8, $[34] = t9) : t9 = $[34], t9;\n}\nfunction RenderBlock$1({\n  renderBlock,\n  children,\n  editorElementRef,\n  focused,\n  path,\n  schemaType,\n  selected,\n  type,\n  value\n}) {\n  return renderBlock({\n    children,\n    editorElementRef,\n    focused,\n    path,\n    schemaType,\n    selected,\n    type,\n    value\n  });\n}\nfunction RenderInlineObject(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(32), inlineObjectRef = (0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(null), slateEditor = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateStatic)(), selected = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSelected)();\n  let t0;\n  $[0] !== selected ? (t0 = (editor) => selected && editor.selection !== null && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(editor.selection), $[0] = selected, $[1] = t0) : t0 = $[1];\n  const focused = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateSelector)(t0);\n  let t1;\n  if ($[2] !== props.element._type || $[3] !== props.legacySchema.inlineObjects) {\n    let t22;\n    $[5] !== props.element._type ? (t22 = (inlineObject) => inlineObject.name === props.element._type, $[5] = props.element._type, $[6] = t22) : t22 = $[6], t1 = props.legacySchema.inlineObjects.find(t22), $[2] = props.element._type, $[3] = props.legacySchema.inlineObjects, $[4] = t1;\n  } else\n    t1 = $[4];\n  const legacySchemaType = t1;\n  legacySchemaType || console.error(`Unable to find Inline Object \"${props.element._type}\" in Schema`);\n  let t2;\n  if ($[7] !== props.element || $[8] !== slateEditor) {\n    const path = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.findPath(slateEditor, props.element);\n    t2 = getPointBlock({\n      editor: slateEditor,\n      point: {\n        path,\n        offset: 0\n      }\n    }), $[7] = props.element, $[8] = slateEditor, $[9] = t2;\n  } else\n    t2 = $[9];\n  const [block] = t2;\n  block || console.error(`Unable to find parent block of inline object ${props.element._key}`);\n  let t3;\n  $[10] !== props.element ? (t3 = \"value\" in props.element && typeof props.element.value == \"object\" ? props.element.value : {}, $[10] = props.element, $[11] = t3) : t3 = $[11];\n  let t4;\n  $[12] !== props.element._key || $[13] !== props.element._type || $[14] !== t3 ? (t4 = {\n    _key: props.element._key,\n    _type: props.element._type,\n    ...t3\n  }, $[12] = props.element._key, $[13] = props.element._type, $[14] = t3, $[15] = t4) : t4 = $[15];\n  const inlineObject_0 = t4, t5 = !props.readOnly;\n  let t6;\n  $[16] === /* @__PURE__ */ Symbol.for(\"react.memo_cache_sentinel\") ? (t6 = {\n    display: \"inline-block\"\n  }, $[16] = t6) : t6 = $[16];\n  let t7;\n  $[17] !== block || $[18] !== focused || $[19] !== inlineObject_0 || $[20] !== legacySchemaType || $[21] !== props.element._key || $[22] !== props.renderChild || $[23] !== selected ? (t7 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", { ref: inlineObjectRef, style: t6, children: props.renderChild && block && legacySchemaType ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderChild$1, { renderChild: props.renderChild, annotations: [], editorElementRef: inlineObjectRef, selected, focused, path: [{\n    _key: block._key\n  }, \"children\", {\n    _key: props.element._key\n  }], schemaType: legacySchemaType, value: inlineObject_0, type: legacySchemaType, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderDefaultInlineObject, { inlineObject: inlineObject_0 }) }) : /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderDefaultInlineObject, { inlineObject: inlineObject_0 }) }), $[17] = block, $[18] = focused, $[19] = inlineObject_0, $[20] = legacySchemaType, $[21] = props.element._key, $[22] = props.renderChild, $[23] = selected, $[24] = t7) : t7 = $[24];\n  let t8;\n  return $[25] !== inlineObject_0._key || $[26] !== inlineObject_0._type || $[27] !== props.attributes || $[28] !== props.children || $[29] !== t5 || $[30] !== t7 ? (t8 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"span\", { ...props.attributes, draggable: t5, className: \"pt-inline-object\", \"data-child-key\": inlineObject_0._key, \"data-child-name\": inlineObject_0._type, \"data-child-type\": \"object\", children: [\n    props.children,\n    t7\n  ] }), $[25] = inlineObject_0._key, $[26] = inlineObject_0._type, $[27] = props.attributes, $[28] = props.children, $[29] = t5, $[30] = t7, $[31] = t8) : t8 = $[31], t8;\n}\nfunction RenderChild$1({\n  renderChild,\n  annotations,\n  children,\n  editorElementRef,\n  focused,\n  path,\n  schemaType,\n  selected,\n  value,\n  type\n}) {\n  return renderChild({\n    annotations,\n    children,\n    editorElementRef,\n    focused,\n    path,\n    schemaType,\n    selected,\n    value,\n    type\n  });\n}\nfunction RenderTextBlock(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(77), [dragPositionBlock, setDragPositionBlock] = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(), blockRef = (0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(null), selected = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSelected)();\n  let t0;\n  $[0] !== selected ? (t0 = (editor) => selected && editor.selection !== null && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(editor.selection), $[0] = selected, $[1] = t0) : t0 = $[1];\n  const focused = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateSelector)(t0);\n  let t1;\n  $[2] !== props.element._key ? (t1 = {\n    key: props.element._key,\n    onSetDragPositionBlock: setDragPositionBlock\n  }, $[2] = props.element._key, $[3] = t1) : t1 = $[3], useCoreBlockElementBehaviors(t1);\n  let t2;\n  $[4] !== props.textBlock._key ? (t2 = (editor_0) => editor_0.listIndexMap.get(props.textBlock._key), $[4] = props.textBlock._key, $[5] = t2) : t2 = $[5];\n  const listIndex = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateSelector)(t2);\n  let children = props.children;\n  if (props.renderStyle && props.textBlock.style) {\n    let t32;\n    $[6] !== props.legacySchema || $[7] !== props.textBlock.style ? (t32 = props.textBlock.style !== void 0 ? props.legacySchema.styles.find((style) => style.value === props.textBlock.style) : void 0, $[6] = props.legacySchema, $[7] = props.textBlock.style, $[8] = t32) : t32 = $[8];\n    const legacyStyleSchemaType = t32;\n    if (legacyStyleSchemaType) {\n      let t42;\n      $[9] !== props.textBlock._key ? (t42 = [{\n        _key: props.textBlock._key\n      }], $[9] = props.textBlock._key, $[10] = t42) : t42 = $[10];\n      let t52;\n      $[11] !== children || $[12] !== focused || $[13] !== legacyStyleSchemaType || $[14] !== props.renderStyle || $[15] !== props.textBlock || $[16] !== selected || $[17] !== t42 ? (t52 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderStyle, { renderStyle: props.renderStyle, block: props.textBlock, editorElementRef: blockRef, focused, path: t42, schemaType: legacyStyleSchemaType, selected, value: props.textBlock.style, children }), $[11] = children, $[12] = focused, $[13] = legacyStyleSchemaType, $[14] = props.renderStyle, $[15] = props.textBlock, $[16] = selected, $[17] = t42, $[18] = t52) : t52 = $[18], children = t52;\n    } else\n      console.error(`Unable to find Schema type for text block style ${props.textBlock.style}`);\n  }\n  if (props.renderListItem && props.textBlock.listItem) {\n    let t32;\n    if ($[19] !== props.legacySchema.lists || $[20] !== props.textBlock.listItem) {\n      let t42;\n      $[22] !== props.textBlock.listItem ? (t42 = (list) => list.value === props.textBlock.listItem, $[22] = props.textBlock.listItem, $[23] = t42) : t42 = $[23], t32 = props.legacySchema.lists.find(t42), $[19] = props.legacySchema.lists, $[20] = props.textBlock.listItem, $[21] = t32;\n    } else\n      t32 = $[21];\n    const legacyListItemSchemaType = t32;\n    if (legacyListItemSchemaType) {\n      const t42 = props.textBlock.level ?? 1;\n      let t52;\n      $[24] !== props.textBlock._key ? (t52 = [{\n        _key: props.textBlock._key\n      }], $[24] = props.textBlock._key, $[25] = t52) : t52 = $[25];\n      let t62;\n      $[26] !== children || $[27] !== focused || $[28] !== legacyListItemSchemaType || $[29] !== props.renderListItem || $[30] !== props.textBlock || $[31] !== selected || $[32] !== t42 || $[33] !== t52 ? (t62 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderListItem, { renderListItem: props.renderListItem, block: props.textBlock, editorElementRef: blockRef, focused, level: t42, path: t52, selected, value: props.textBlock.listItem, schemaType: legacyListItemSchemaType, children }), $[26] = children, $[27] = focused, $[28] = legacyListItemSchemaType, $[29] = props.renderListItem, $[30] = props.textBlock, $[31] = selected, $[32] = t42, $[33] = t52, $[34] = t62) : t62 = $[34], children = t62;\n    } else\n      console.error(`Unable to find Schema type for text block list item ${props.textBlock.listItem}`);\n  }\n  const t3 = props.attributes;\n  let t4;\n  $[35] !== props.textBlock.style ? (t4 = props.textBlock.style ? [`pt-text-block-style-${props.textBlock.style}`] : [], $[35] = props.textBlock.style, $[36] = t4) : t4 = $[36];\n  let t5;\n  $[37] !== props.textBlock.level || $[38] !== props.textBlock.listItem ? (t5 = props.textBlock.listItem ? [\"pt-list-item\", `pt-list-item-${props.textBlock.listItem}`, `pt-list-item-level-${props.textBlock.level ?? 1}`] : [], $[37] = props.textBlock.level, $[38] = props.textBlock.listItem, $[39] = t5) : t5 = $[39];\n  let t6;\n  $[40] !== t4 || $[41] !== t5 ? (t6 = [\"pt-block\", \"pt-text-block\", ...t4, ...t5], $[40] = t4, $[41] = t5, $[42] = t6) : t6 = $[42];\n  const t7 = t6.join(\" \");\n  let t8;\n  $[43] !== props.textBlock.listItem ? (t8 = props.textBlock.listItem !== void 0 ? {\n    \"data-list-item\": props.textBlock.listItem\n  } : {}, $[43] = props.textBlock.listItem, $[44] = t8) : t8 = $[44];\n  let t9;\n  $[45] !== props.textBlock.level ? (t9 = props.textBlock.level !== void 0 ? {\n    \"data-level\": props.textBlock.level\n  } : {}, $[45] = props.textBlock.level, $[46] = t9) : t9 = $[46];\n  let t10;\n  $[47] !== props.textBlock.style ? (t10 = props.textBlock.style !== void 0 ? {\n    \"data-style\": props.textBlock.style\n  } : {}, $[47] = props.textBlock.style, $[48] = t10) : t10 = $[48];\n  let t11;\n  $[49] !== listIndex ? (t11 = listIndex !== void 0 ? {\n    \"data-list-index\": listIndex\n  } : {}, $[49] = listIndex, $[50] = t11) : t11 = $[50];\n  let t12;\n  $[51] !== dragPositionBlock ? (t12 = dragPositionBlock === \"start\" ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropIndicator, {}) : null, $[51] = dragPositionBlock, $[52] = t12) : t12 = $[52];\n  let t13;\n  $[53] !== children || $[54] !== focused || $[55] !== props.legacySchema || $[56] !== props.renderBlock || $[57] !== props.textBlock || $[58] !== selected ? (t13 = props.renderBlock ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderBlock, { renderBlock: props.renderBlock, editorElementRef: blockRef, focused, level: props.textBlock.level, listItem: props.textBlock.listItem, path: [{\n    _key: props.textBlock._key\n  }], selected, schemaType: props.legacySchema.block, style: props.textBlock.style, type: props.legacySchema.block, value: props.textBlock, children }) : children, $[53] = children, $[54] = focused, $[55] = props.legacySchema, $[56] = props.renderBlock, $[57] = props.textBlock, $[58] = selected, $[59] = t13) : t13 = $[59];\n  let t14;\n  $[60] !== t13 ? (t14 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", { ref: blockRef, children: t13 }), $[60] = t13, $[61] = t14) : t14 = $[61];\n  let t15;\n  $[62] !== dragPositionBlock ? (t15 = dragPositionBlock === \"end\" ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropIndicator, {}) : null, $[62] = dragPositionBlock, $[63] = t15) : t15 = $[63];\n  let t16;\n  return $[64] !== props.attributes || $[65] !== props.spellCheck || $[66] !== props.textBlock._key || $[67] !== props.textBlock._type || $[68] !== t10 || $[69] !== t11 || $[70] !== t12 || $[71] !== t14 || $[72] !== t15 || $[73] !== t7 || $[74] !== t8 || $[75] !== t9 ? (t16 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", { ...t3, className: t7, spellCheck: props.spellCheck, \"data-block-key\": props.textBlock._key, \"data-block-name\": props.textBlock._type, \"data-block-type\": \"text\", ...t8, ...t9, ...t10, ...t11, children: [\n    t12,\n    t14,\n    t15\n  ] }), $[64] = props.attributes, $[65] = props.spellCheck, $[66] = props.textBlock._key, $[67] = props.textBlock._type, $[68] = t10, $[69] = t11, $[70] = t12, $[71] = t14, $[72] = t15, $[73] = t7, $[74] = t8, $[75] = t9, $[76] = t16) : t16 = $[76], t16;\n}\nfunction RenderBlock({\n  renderBlock,\n  children,\n  editorElementRef,\n  focused,\n  level,\n  listItem,\n  path,\n  selected,\n  style,\n  schemaType,\n  type,\n  value\n}) {\n  return renderBlock({\n    children,\n    editorElementRef,\n    focused,\n    level,\n    listItem,\n    path,\n    selected,\n    style,\n    schemaType,\n    type,\n    value\n  });\n}\nfunction RenderListItem({\n  renderListItem,\n  block,\n  children,\n  editorElementRef,\n  focused,\n  level,\n  path,\n  schemaType,\n  selected,\n  value\n}) {\n  return renderListItem({\n    block,\n    children,\n    editorElementRef,\n    focused,\n    level,\n    path,\n    schemaType,\n    selected,\n    value\n  });\n}\nfunction RenderStyle({\n  renderStyle,\n  block,\n  children,\n  editorElementRef,\n  focused,\n  path,\n  schemaType,\n  selected,\n  value\n}) {\n  return renderStyle({\n    block,\n    children,\n    editorElementRef,\n    focused,\n    path,\n    schemaType,\n    selected,\n    value\n  });\n}\nfunction RenderElement(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(34), editorActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(EditorActorContext), schema = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, _temp$3), legacySchema = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, _temp2$2), slateStatic = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateStatic)();\n  if (\"__inline\" in props.element && props.element.__inline === !0) {\n    let t02;\n    return $[0] !== legacySchema || $[1] !== props.attributes || $[2] !== props.children || $[3] !== props.element || $[4] !== props.readOnly || $[5] !== props.renderChild || $[6] !== schema ? (t02 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderInlineObject, { attributes: props.attributes, element: props.element, legacySchema, readOnly: props.readOnly, renderChild: props.renderChild, schema, children: props.children }), $[0] = legacySchema, $[1] = props.attributes, $[2] = props.children, $[3] = props.element, $[4] = props.readOnly, $[5] = props.renderChild, $[6] = schema, $[7] = t02) : t02 = $[7], t02;\n  }\n  let block, t0;\n  if ($[8] !== props.element._key || $[9] !== schema || $[10] !== slateStatic.blockIndexMap || $[11] !== slateStatic.value) {\n    const blockIndex = slateStatic.blockIndexMap.get(props.element._key);\n    block = blockIndex !== void 0 ? slateStatic.value.at(blockIndex) : void 0, t0 = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n      schema\n    }, block), $[8] = props.element._key, $[9] = schema, $[10] = slateStatic.blockIndexMap, $[11] = slateStatic.value, $[12] = block, $[13] = t0;\n  } else\n    block = $[12], t0 = $[13];\n  if (t0) {\n    let t12;\n    return $[14] !== block || $[15] !== legacySchema || $[16] !== props.attributes || $[17] !== props.children || $[18] !== props.element || $[19] !== props.readOnly || $[20] !== props.renderBlock || $[21] !== props.renderListItem || $[22] !== props.renderStyle || $[23] !== props.spellCheck ? (t12 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderTextBlock, { attributes: props.attributes, element: props.element, legacySchema, readOnly: props.readOnly, renderBlock: props.renderBlock, renderListItem: props.renderListItem, renderStyle: props.renderStyle, spellCheck: props.spellCheck, textBlock: block, children: props.children }), $[14] = block, $[15] = legacySchema, $[16] = props.attributes, $[17] = props.children, $[18] = props.element, $[19] = props.readOnly, $[20] = props.renderBlock, $[21] = props.renderListItem, $[22] = props.renderStyle, $[23] = props.spellCheck, $[24] = t12) : t12 = $[24], t12;\n  }\n  let t1;\n  return $[25] !== block || $[26] !== legacySchema || $[27] !== props.attributes || $[28] !== props.children || $[29] !== props.element || $[30] !== props.readOnly || $[31] !== props.renderBlock || $[32] !== schema ? (t1 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderBlockObject, { attributes: props.attributes, blockObject: block, element: props.element, legacySchema, readOnly: props.readOnly, renderBlock: props.renderBlock, schema, children: props.children }), $[25] = block, $[26] = legacySchema, $[27] = props.attributes, $[28] = props.children, $[29] = props.element, $[30] = props.readOnly, $[31] = props.renderBlock, $[32] = schema, $[33] = t1) : t1 = $[33], t1;\n}\nfunction _temp2$2(s_0) {\n  return s_0.context.getLegacySchema();\n}\nfunction _temp$3(s) {\n  return s.context.schema;\n}\nfunction defaultCompare(a, b) {\n  return a === b;\n}\nfunction useEditorSelector(editor, selector, t0) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(3), compare = t0 === void 0 ? defaultCompare : t0;\n  let t1;\n  return $[0] !== editor || $[1] !== selector ? (t1 = (editorActorSnapshot) => {\n    const snapshot = getEditorSnapshot({\n      editorActorSnapshot,\n      slateEditorInstance: editor._internal.slateEditor.instance\n    });\n    return selector(snapshot);\n  }, $[0] = editor, $[1] = selector, $[2] = t1) : t1 = $[2], (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editor._internal.editorActor, t1, compare);\n}\nfunction getEditorSnapshot({\n  editorActorSnapshot,\n  slateEditorInstance\n}) {\n  const selection = slateEditorInstance.selection ? slateRangeToSelection({\n    schema: editorActorSnapshot.context.schema,\n    editor: slateEditorInstance,\n    range: slateEditorInstance.selection\n  }) : null;\n  return {\n    blockIndexMap: slateEditorInstance.blockIndexMap,\n    context: {\n      converters: [...editorActorSnapshot.context.converters],\n      keyGenerator: editorActorSnapshot.context.keyGenerator,\n      readOnly: editorActorSnapshot.matches({\n        \"edit mode\": \"read only\"\n      }),\n      schema: editorActorSnapshot.context.schema,\n      selection,\n      value: slateEditorInstance.value\n    },\n    decoratorState: slateEditorInstance.decoratorState\n  };\n}\nfunction RenderSpan(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(40), slateEditor = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlateStatic)(), editorActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(EditorActorContext), legacySchema = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, _temp$2), spanRef = (0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(null);\n  let t0;\n  $[0] !== props.leaf._key || $[1] !== slateEditor ? (t0 = (editorActorSnapshot) => {\n    const snapshot = getEditorSnapshot({\n      editorActorSnapshot,\n      slateEditorInstance: slateEditor\n    });\n    if (!snapshot.context.selection || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot))\n      return !1;\n    const focusedSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshot);\n    return focusedSpan ? focusedSpan.node._key === props.leaf._key : !1;\n  }, $[0] = props.leaf._key, $[1] = slateEditor, $[2] = t0) : t0 = $[2];\n  const focused = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, t0);\n  let t1;\n  $[3] !== props.children.props.parent || $[4] !== props.leaf._key || $[5] !== props.leaf.text || $[6] !== slateEditor ? (t1 = (editorActorSnapshot_0) => {\n    const snapshot_0 = getEditorSnapshot({\n      editorActorSnapshot: editorActorSnapshot_0,\n      slateEditorInstance: slateEditor\n    });\n    if (!snapshot_0.context.selection)\n      return !1;\n    const parent = props.children.props.parent, block = parent && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot_0.context, parent) ? parent : void 0, spanSelection = block ? {\n      anchor: {\n        path: [{\n          _key: block._key\n        }, \"children\", {\n          _key: props.leaf._key\n        }],\n        offset: 0\n      },\n      focus: {\n        path: [{\n          _key: block._key\n        }, \"children\", {\n          _key: props.leaf._key\n        }],\n        offset: props.leaf.text.length\n      }\n    } : null;\n    return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isOverlappingSelection)(spanSelection)(snapshot_0);\n  }, $[3] = props.children.props.parent, $[4] = props.leaf._key, $[5] = props.leaf.text, $[6] = slateEditor, $[7] = t1) : t1 = $[7];\n  const selected = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, t1), parent_0 = props.children.props.parent, block_0 = parent_0 && slateEditor.isTextBlock(parent_0) ? parent_0 : void 0;\n  let t2;\n  $[8] !== block_0 || $[9] !== props.leaf._key ? (t2 = block_0 ? [{\n    _key: block_0._key\n  }, \"children\", {\n    _key: props.leaf._key\n  }] : void 0, $[8] = block_0, $[9] = props.leaf._key, $[10] = t2) : t2 = $[10];\n  const path = t2;\n  let annotationMarkDefs, children;\n  if ($[11] !== block_0 || $[12] !== editorActor || $[13] !== focused || $[14] !== legacySchema || $[15] !== path || $[16] !== props.children || $[17] !== props.leaf.marks || $[18] !== props.renderAnnotation || $[19] !== props.renderDecorator || $[20] !== selected) {\n    const decoratorSchemaTypes = editorActor.getSnapshot().context.schema.decorators.map(_temp2$1), decorators = [...new Set((props.leaf.marks ?? []).filter((mark) => decoratorSchemaTypes.includes(mark)))];\n    annotationMarkDefs = (props.leaf.marks ?? []).flatMap((mark_0) => {\n      if (decoratorSchemaTypes.includes(mark_0))\n        return [];\n      const markDef_0 = block_0?.markDefs?.find((markDef) => markDef._key === mark_0);\n      return markDef_0 ? [markDef_0] : [];\n    }), children = props.children;\n    for (const mark_1 of decorators) {\n      const legacyDecoratorSchemaType = legacySchema.decorators.find((dec) => dec.value === mark_1);\n      path && legacyDecoratorSchemaType && props.renderDecorator && (children = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderDecorator, { renderDecorator: props.renderDecorator, editorElementRef: spanRef, focused, path, selected, schemaType: legacyDecoratorSchemaType, value: mark_1, type: legacyDecoratorSchemaType, children }));\n    }\n    for (const annotationMarkDef of annotationMarkDefs) {\n      const legacyAnnotationSchemaType = legacySchema.annotations.find((t) => t.name === annotationMarkDef._type);\n      legacyAnnotationSchemaType && (block_0 && path && props.renderAnnotation ? children = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", { ref: spanRef, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderAnnotation, { renderAnnotation: props.renderAnnotation, block: block_0, editorElementRef: spanRef, focused, path, selected, schemaType: legacyAnnotationSchemaType, value: annotationMarkDef, type: legacyAnnotationSchemaType, children }) }) : children = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", { ref: spanRef, children }));\n    }\n    $[11] = block_0, $[12] = editorActor, $[13] = focused, $[14] = legacySchema, $[15] = path, $[16] = props.children, $[17] = props.leaf.marks, $[18] = props.renderAnnotation, $[19] = props.renderDecorator, $[20] = selected, $[21] = annotationMarkDefs, $[22] = children;\n  } else\n    annotationMarkDefs = $[21], children = $[22];\n  if (block_0 && path && props.renderChild) {\n    let t32;\n    if ($[23] !== block_0.children || $[24] !== props.leaf) {\n      let t4;\n      $[26] !== props.leaf ? (t4 = (_child) => _child._key === props.leaf._key, $[26] = props.leaf, $[27] = t4) : t4 = $[27], t32 = block_0.children.find(t4), $[23] = block_0.children, $[24] = props.leaf, $[25] = t32;\n    } else\n      t32 = $[25];\n    const child = t32;\n    if (child) {\n      let t4;\n      $[28] !== annotationMarkDefs || $[29] !== child || $[30] !== children || $[31] !== focused || $[32] !== legacySchema.span || $[33] !== path || $[34] !== props.renderChild || $[35] !== selected ? (t4 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderChild, { renderChild: props.renderChild, annotations: annotationMarkDefs, editorElementRef: spanRef, focused, path, schemaType: legacySchema.span, selected, value: child, type: legacySchema.span, children }), $[28] = annotationMarkDefs, $[29] = child, $[30] = children, $[31] = focused, $[32] = legacySchema.span, $[33] = path, $[34] = props.renderChild, $[35] = selected, $[36] = t4) : t4 = $[36], children = t4;\n    }\n  }\n  let t3;\n  return $[37] !== children || $[38] !== props.attributes ? (t3 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", { ...props.attributes, ref: spanRef, children }), $[37] = children, $[38] = props.attributes, $[39] = t3) : t3 = $[39], t3;\n}\nfunction _temp2$1(decorator) {\n  return decorator.name;\n}\nfunction _temp$2(s) {\n  return s.context.getLegacySchema();\n}\nfunction RenderAnnotation({\n  renderAnnotation,\n  block,\n  children,\n  editorElementRef,\n  focused,\n  path,\n  schemaType,\n  selected,\n  value,\n  type\n}) {\n  return renderAnnotation({\n    block,\n    children,\n    editorElementRef,\n    focused,\n    path,\n    schemaType,\n    selected,\n    value,\n    type\n  });\n}\nfunction RenderDecorator({\n  renderDecorator,\n  children,\n  editorElementRef,\n  focused,\n  path,\n  schemaType,\n  selected,\n  value,\n  type\n}) {\n  return renderDecorator({\n    children,\n    editorElementRef,\n    focused,\n    path,\n    schemaType,\n    selected,\n    value,\n    type\n  });\n}\nfunction RenderChild({\n  renderChild,\n  annotations,\n  children,\n  editorElementRef,\n  focused,\n  path,\n  schemaType,\n  selected,\n  value,\n  type\n}) {\n  return renderChild({\n    annotations,\n    children,\n    editorElementRef,\n    focused,\n    path,\n    schemaType,\n    selected,\n    value,\n    type\n  });\n}\nconst PLACEHOLDER_STYLE = {\n  position: \"absolute\",\n  userSelect: \"none\",\n  pointerEvents: \"none\",\n  left: 0,\n  right: 0\n};\nfunction RenderLeaf(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(12), editorActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(EditorActorContext), schema = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, _temp$1);\n  if (props.leaf._type !== schema.span.name)\n    return props.children;\n  let t0;\n  $[0] !== props ? (t0 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderSpan, { ...props }), $[0] = props, $[1] = t0) : t0 = $[1];\n  let renderedSpan = t0;\n  if (props.renderPlaceholder && props.leaf.placeholder && props.text.text === \"\") {\n    let t1;\n    $[2] !== props.renderPlaceholder ? (t1 = props.renderPlaceholder(), $[2] = props.renderPlaceholder, $[3] = t1) : t1 = $[3];\n    let t2;\n    $[4] !== t1 ? (t2 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", { style: PLACEHOLDER_STYLE, contentEditable: !1, children: t1 }), $[4] = t1, $[5] = t2) : t2 = $[5];\n    let t3;\n    return $[6] !== renderedSpan || $[7] !== t2 ? (t3 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, { children: [\n      t2,\n      renderedSpan\n    ] }), $[6] = renderedSpan, $[7] = t2, $[8] = t3) : t3 = $[8], t3;\n  }\n  const rangeDecoration = props.leaf.rangeDecoration;\n  if (rangeDecoration) {\n    let t1;\n    $[9] !== rangeDecoration || $[10] !== renderedSpan ? (t1 = rangeDecoration.component({\n      children: renderedSpan\n    }), $[9] = rangeDecoration, $[10] = renderedSpan, $[11] = t1) : t1 = $[11], renderedSpan = t1;\n  }\n  return renderedSpan;\n}\nfunction _temp$1(s) {\n  return s.context.schema;\n}\nfunction RenderText(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(5);\n  let t0;\n  return $[0] !== props.attributes || $[1] !== props.children || $[2] !== props.text._key || $[3] !== props.text._type ? (t0 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", { ...props.attributes, \"data-child-key\": props.text._key, \"data-child-name\": props.text._type, \"data-child-type\": \"span\", children: props.children }), $[0] = props.attributes, $[1] = props.children, $[2] = props.text._key, $[3] = props.text._type, $[4] = t0) : t0 = $[4], t0;\n}\nconst IS_MAC = typeof window < \"u\" && /Mac|iPod|iPhone|iPad/.test(window.navigator.userAgent), modifiers = {\n  alt: \"altKey\",\n  control: \"ctrlKey\",\n  meta: \"metaKey\",\n  shift: \"shiftKey\"\n}, aliases = {\n  add: \"+\",\n  break: \"pause\",\n  cmd: \"meta\",\n  command: \"meta\",\n  ctl: \"control\",\n  ctrl: \"control\",\n  del: \"delete\",\n  down: \"arrowdown\",\n  esc: \"escape\",\n  ins: \"insert\",\n  left: \"arrowleft\",\n  mod: IS_MAC ? \"meta\" : \"control\",\n  opt: \"alt\",\n  option: \"alt\",\n  return: \"enter\",\n  right: \"arrowright\",\n  space: \" \",\n  spacebar: \" \",\n  up: \"arrowup\",\n  win: \"meta\",\n  windows: \"meta\"\n}, keyCodes = {\n  backspace: 8,\n  tab: 9,\n  enter: 13,\n  shift: 16,\n  control: 17,\n  alt: 18,\n  pause: 19,\n  capslock: 20,\n  escape: 27,\n  \" \": 32,\n  pageup: 33,\n  pagedown: 34,\n  end: 35,\n  home: 36,\n  arrowleft: 37,\n  arrowup: 38,\n  arrowright: 39,\n  arrowdown: 40,\n  insert: 45,\n  delete: 46,\n  meta: 91,\n  numlock: 144,\n  scrolllock: 145,\n  \";\": 186,\n  \"=\": 187,\n  \",\": 188,\n  \"-\": 189,\n  \".\": 190,\n  \"/\": 191,\n  \"`\": 192,\n  \"[\": 219,\n  \"\\\\\": 220,\n  \"]\": 221,\n  \"'\": 222,\n  f1: 112,\n  f2: 113,\n  f3: 114,\n  f4: 115,\n  f5: 116,\n  f6: 117,\n  f7: 118,\n  f8: 119,\n  f9: 120,\n  f10: 121,\n  f11: 122,\n  f12: 123,\n  f13: 124,\n  f14: 125,\n  f15: 126,\n  f16: 127,\n  f17: 128,\n  f18: 129,\n  f19: 130,\n  f20: 131\n};\nfunction isHotkey(hotkey, event) {\n  return compareHotkey(parseHotkey(hotkey), event);\n}\nfunction parseHotkey(hotkey) {\n  const parsedHotkey = {\n    altKey: !1,\n    ctrlKey: !1,\n    metaKey: !1,\n    shiftKey: !1\n  }, hotkeySegments = hotkey.replace(\"++\", \"+add\").split(\"+\");\n  for (const rawHotkeySegment of hotkeySegments) {\n    const optional = rawHotkeySegment.endsWith(\"?\") && rawHotkeySegment.length > 1, hotkeySegment = optional ? rawHotkeySegment.slice(0, -1) : rawHotkeySegment, keyName = toKeyName(hotkeySegment), modifier = modifiers[keyName], alias = aliases[hotkeySegment], code2 = keyCodes[keyName];\n    if (hotkeySegment.length > 1 && modifier === void 0 && alias === void 0 && code2 === void 0)\n      throw new TypeError(`Unknown modifier: \"${hotkeySegment}\"`);\n    (hotkeySegments.length === 1 || modifier === void 0) && (parsedHotkey.key = keyName, parsedHotkey.keyCode = toKeyCode(hotkeySegment)), modifier !== void 0 && (parsedHotkey[modifier] = optional ? null : !0);\n  }\n  return parsedHotkey;\n}\nfunction compareHotkey(parsedHotkey, event) {\n  return (parsedHotkey.altKey == null || parsedHotkey.altKey === event.altKey) && (parsedHotkey.ctrlKey == null || parsedHotkey.ctrlKey === event.ctrlKey) && (parsedHotkey.metaKey == null || parsedHotkey.metaKey === event.metaKey) && (parsedHotkey.shiftKey == null || parsedHotkey.shiftKey === event.shiftKey) ? parsedHotkey.keyCode !== void 0 && event.keyCode !== void 0 ? parsedHotkey.keyCode === 91 && event.keyCode === 93 ? !0 : parsedHotkey.keyCode === event.keyCode : parsedHotkey.keyCode === event.keyCode || parsedHotkey.key === event.key.toLowerCase() : !1;\n}\nfunction toKeyCode(name) {\n  const keyName = toKeyName(name);\n  return keyCodes[keyName] ?? keyName.toUpperCase().charCodeAt(0);\n}\nfunction toKeyName(name) {\n  const keyName = name.toLowerCase();\n  return aliases[keyName] ?? keyName;\n}\nconst debug$g = debugWithName(\"plugin:withHotKeys\");\nfunction createWithHotkeys(editorActor, portableTextEditor, hotkeysFromOptions) {\n  const reservedHotkeys = [\"enter\", \"tab\", \"shift\", \"delete\", \"end\"], activeHotkeys = hotkeysFromOptions ?? {};\n  return function(editor) {\n    return editor.pteWithHotKeys = (event) => {\n      Object.keys(activeHotkeys).forEach((cat) => {\n        if (cat === \"marks\")\n          for (const hotkey in activeHotkeys[cat]) {\n            if (reservedHotkeys.includes(hotkey))\n              throw new Error(`The hotkey ${hotkey} is reserved!`);\n            if (isHotkey(hotkey, event.nativeEvent)) {\n              event.preventDefault();\n              const possibleMark = activeHotkeys[cat];\n              if (possibleMark) {\n                const mark = possibleMark[hotkey];\n                debug$g(`HotKey ${hotkey} to toggle ${mark}`), editorActor.send({\n                  type: \"behavior event\",\n                  behaviorEvent: {\n                    type: \"decorator.toggle\",\n                    decorator: mark\n                  },\n                  editor\n                });\n              }\n            }\n          }\n        if (cat === \"custom\")\n          for (const hotkey in activeHotkeys[cat]) {\n            if (reservedHotkeys.includes(hotkey))\n              throw new Error(`The hotkey ${hotkey} is reserved!`);\n            if (isHotkey(hotkey, event.nativeEvent)) {\n              const possibleCommand = activeHotkeys[cat];\n              if (possibleCommand) {\n                const command = possibleCommand[hotkey];\n                command(event, portableTextEditor);\n              }\n            }\n          }\n      });\n    }, editor;\n  };\n}\nconst PortableTextEditorContext = (0,react__WEBPACK_IMPORTED_MODULE_2__.createContext)(null), usePortableTextEditor = () => {\n  const editor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(PortableTextEditorContext);\n  if (!editor)\n    throw new Error(\"The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.\");\n  return editor;\n}, debug$f = debugWithName(\"validate selection machine\"), validateSelectionSetup = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    input: {},\n    events: {}\n  },\n  guards: {\n    \"pending operations\": ({\n      context\n    }) => context.slateEditor.operations.length > 0\n  }\n}), validateSelectionAction = validateSelectionSetup.createAction(({\n  context,\n  event\n}) => {\n  validateSelection(context.slateEditor, event.editorElement);\n}), validateSelectionMachine = validateSelectionSetup.createMachine({\n  id: \"validate selection\",\n  context: ({\n    input\n  }) => ({\n    slateEditor: input.slateEditor\n  }),\n  initial: \"idle\",\n  states: {\n    idle: {\n      on: {\n        \"validate selection\": [{\n          guard: \"pending operations\",\n          target: \"waiting\"\n        }, {\n          actions: [validateSelectionAction],\n          target: \"idle\"\n        }]\n      }\n    },\n    waiting: {\n      after: {\n        0: [{\n          guard: \"pending operations\",\n          target: \".\",\n          reenter: !0\n        }, {\n          target: \"idle\",\n          actions: [validateSelectionAction]\n        }]\n      },\n      on: {\n        \"validate selection\": {\n          target: \".\",\n          reenter: !0\n        }\n      }\n    }\n  }\n});\nfunction validateSelection(slateEditor, editorElement) {\n  if (!slateEditor.selection)\n    return;\n  let root;\n  try {\n    root = slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.findDocumentOrShadowRoot(slateEditor);\n  } catch {\n  }\n  if (!root || editorElement !== root.activeElement)\n    return;\n  const domSelection = slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.getWindow(slateEditor).getSelection();\n  if (!domSelection || domSelection.rangeCount === 0)\n    return;\n  const existingDOMRange = domSelection.getRangeAt(0);\n  try {\n    const newDOMRange = slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.toDOMRange(slateEditor, slateEditor.selection);\n    (newDOMRange.startOffset !== existingDOMRange.startOffset || newDOMRange.endOffset !== existingDOMRange.endOffset) && (debug$f(\"DOM range out of sync, validating selection\"), domSelection?.removeAllRanges(), domSelection.addRange(newDOMRange));\n  } catch {\n    debug$f(\"Could not resolve selection, selecting top document\"), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(slateEditor), slateEditor.children.length > 0 && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(slateEditor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(slateEditor, [])), slateEditor.onChange();\n  }\n}\nconst debug$e = debugWithName(\"component:Editable\"), PortableTextEditable = (0,react__WEBPACK_IMPORTED_MODULE_2__.forwardRef)(function(props, forwardedRef) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(176);\n  let hotkeys, onBeforeInput, onBlur, onClick, onCopy, onCut, onDrag, onDragEnd, onDragEnter, onDragLeave, onDragOver, onDragStart, onDrop, onFocus, onPaste, propsSelection, rangeDecorations, renderAnnotation, renderBlock, renderChild, renderDecorator, renderListItem, renderPlaceholder, renderStyle, restProps, scrollSelectionIntoView, spellCheck;\n  $[0] !== props ? ({\n    hotkeys,\n    onBlur,\n    onFocus,\n    onBeforeInput,\n    onPaste,\n    onCopy,\n    onCut,\n    onClick,\n    onDragStart,\n    onDrag,\n    onDragEnd,\n    onDragEnter,\n    onDragOver,\n    onDrop,\n    onDragLeave,\n    rangeDecorations,\n    renderAnnotation,\n    renderBlock,\n    renderChild,\n    renderDecorator,\n    renderListItem,\n    renderPlaceholder,\n    renderStyle,\n    selection: propsSelection,\n    scrollSelectionIntoView,\n    spellCheck,\n    ...restProps\n  } = props, $[0] = props, $[1] = hotkeys, $[2] = onBeforeInput, $[3] = onBlur, $[4] = onClick, $[5] = onCopy, $[6] = onCut, $[7] = onDrag, $[8] = onDragEnd, $[9] = onDragEnter, $[10] = onDragLeave, $[11] = onDragOver, $[12] = onDragStart, $[13] = onDrop, $[14] = onFocus, $[15] = onPaste, $[16] = propsSelection, $[17] = rangeDecorations, $[18] = renderAnnotation, $[19] = renderBlock, $[20] = renderChild, $[21] = renderDecorator, $[22] = renderListItem, $[23] = renderPlaceholder, $[24] = renderStyle, $[25] = restProps, $[26] = scrollSelectionIntoView, $[27] = spellCheck) : (hotkeys = $[1], onBeforeInput = $[2], onBlur = $[3], onClick = $[4], onCopy = $[5], onCut = $[6], onDrag = $[7], onDragEnd = $[8], onDragEnter = $[9], onDragLeave = $[10], onDragOver = $[11], onDragStart = $[12], onDrop = $[13], onFocus = $[14], onPaste = $[15], propsSelection = $[16], rangeDecorations = $[17], renderAnnotation = $[18], renderBlock = $[19], renderChild = $[20], renderDecorator = $[21], renderListItem = $[22], renderPlaceholder = $[23], renderStyle = $[24], restProps = $[25], scrollSelectionIntoView = $[26], spellCheck = $[27]);\n  const portableTextEditor = usePortableTextEditor(), [hasInvalidValue, setHasInvalidValue] = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(!1), editorActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(EditorActorContext), relayActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(RelayActorContext), readOnly = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(editorActor, _temp), slateEditor = (0,slate_react__WEBPACK_IMPORTED_MODULE_15__.useSlate)();\n  let t0;\n  $[28] !== slateEditor ? (t0 = {\n    input: {\n      slateEditor\n    }\n  }, $[28] = slateEditor, $[29] = t0) : t0 = $[29];\n  const validateSelectionActor = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useActorRef)(validateSelectionMachine, t0);\n  let t1;\n  $[30] !== rangeDecorations ? (t1 = rangeDecorations ?? [], $[30] = rangeDecorations, $[31] = t1) : t1 = $[31];\n  let t2;\n  $[32] !== editorActor ? (t2 = editorActor.getSnapshot(), $[32] = editorActor, $[33] = t2) : t2 = $[33];\n  const t3 = t2.context.schema;\n  let t4;\n  $[34] !== editorActor ? (t4 = editorActor.getSnapshot().matches({\n    setup: \"setting up\"\n  }), $[34] = editorActor, $[35] = t4) : t4 = $[35];\n  const t5 = !t4;\n  let t6;\n  $[36] !== readOnly || $[37] !== slateEditor || $[38] !== t1 || $[39] !== t2.context.schema || $[40] !== t5 ? (t6 = {\n    input: {\n      rangeDecorations: t1,\n      readOnly,\n      schema: t3,\n      slateEditor,\n      skipSetup: t5\n    }\n  }, $[36] = readOnly, $[37] = slateEditor, $[38] = t1, $[39] = t2.context.schema, $[40] = t5, $[41] = t6) : t6 = $[41];\n  const rangeDecorationsActor = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useActorRef)(rangeDecorationsMachine, t6), decorate = (0,_xstate_react__WEBPACK_IMPORTED_MODULE_16__.useSelector)(rangeDecorationsActor, _temp2);\n  let t7, t8;\n  $[42] !== rangeDecorationsActor || $[43] !== readOnly ? (t7 = () => {\n    rangeDecorationsActor.send({\n      type: \"update read only\",\n      readOnly\n    });\n  }, t8 = [rangeDecorationsActor, readOnly], $[42] = rangeDecorationsActor, $[43] = readOnly, $[44] = t7, $[45] = t8) : (t7 = $[44], t8 = $[45]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t7, t8);\n  let t10, t9;\n  $[46] !== rangeDecorations || $[47] !== rangeDecorationsActor ? (t9 = () => {\n    rangeDecorationsActor.send({\n      type: \"range decorations updated\",\n      rangeDecorations: rangeDecorations ?? []\n    });\n  }, t10 = [rangeDecorationsActor, rangeDecorations], $[46] = rangeDecorations, $[47] = rangeDecorationsActor, $[48] = t10, $[49] = t9) : (t10 = $[48], t9 = $[49]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t9, t10);\n  bb0: {\n    if (readOnly)\n      break bb0;\n    createWithHotkeys(editorActor, portableTextEditor, hotkeys)(slateEditor);\n  }\n  let t12;\n  $[50] !== readOnly || $[51] !== renderBlock || $[52] !== renderChild || $[53] !== renderListItem || $[54] !== renderStyle || $[55] !== spellCheck ? (t12 = (eProps) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderElement, { ...eProps, readOnly, renderBlock, renderChild, renderListItem, renderStyle, spellCheck }), $[50] = readOnly, $[51] = renderBlock, $[52] = renderChild, $[53] = renderListItem, $[54] = renderStyle, $[55] = spellCheck, $[56] = t12) : t12 = $[56];\n  const renderElement = t12;\n  let t13;\n  $[57] !== readOnly || $[58] !== renderAnnotation || $[59] !== renderChild || $[60] !== renderDecorator || $[61] !== renderPlaceholder ? (t13 = (leafProps) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderLeaf, { ...leafProps, readOnly, renderAnnotation, renderChild, renderDecorator, renderPlaceholder }), $[57] = readOnly, $[58] = renderAnnotation, $[59] = renderChild, $[60] = renderDecorator, $[61] = renderPlaceholder, $[62] = t13) : t13 = $[62];\n  const renderLeaf = t13, renderText = _temp3;\n  let t14;\n  $[63] !== editorActor || $[64] !== propsSelection || $[65] !== slateEditor ? (t14 = () => {\n    if (propsSelection) {\n      debug$e(`Selection from props ${JSON.stringify(propsSelection)}`);\n      const normalizedSelection = normalizeSelection(propsSelection, slateEditor.value);\n      if (normalizedSelection !== null) {\n        debug$e(`Normalized selection from props ${JSON.stringify(normalizedSelection)}`);\n        const slateRange = toSlateRange({\n          context: {\n            schema: editorActor.getSnapshot().context.schema,\n            value: slateEditor.value,\n            selection: normalizedSelection\n          },\n          blockIndexMap: slateEditor.blockIndexMap\n        });\n        slateRange && (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(slateEditor, slateRange), slateEditor.operations.some(_temp4) || editorActor.send({\n          type: \"update selection\",\n          selection: normalizedSelection\n        }), slateEditor.onChange());\n      }\n    }\n  }, $[63] = editorActor, $[64] = propsSelection, $[65] = slateEditor, $[66] = t14) : t14 = $[66];\n  const restoreSelectionFromProps = t14;\n  let t15, t16;\n  $[67] !== editorActor || $[68] !== rangeDecorationsActor || $[69] !== restoreSelectionFromProps ? (t15 = () => {\n    const onReady = editorActor.on(\"ready\", () => {\n      rangeDecorationsActor.send({\n        type: \"ready\"\n      }), restoreSelectionFromProps();\n    }), onInvalidValue = editorActor.on(\"invalid value\", () => {\n      setHasInvalidValue(!0);\n    }), onValueChanged = editorActor.on(\"value changed\", () => {\n      setHasInvalidValue(!1);\n    });\n    return () => {\n      onReady.unsubscribe(), onInvalidValue.unsubscribe(), onValueChanged.unsubscribe();\n    };\n  }, t16 = [rangeDecorationsActor, editorActor, restoreSelectionFromProps], $[67] = editorActor, $[68] = rangeDecorationsActor, $[69] = restoreSelectionFromProps, $[70] = t15, $[71] = t16) : (t15 = $[70], t16 = $[71]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t15, t16);\n  let t17, t18;\n  $[72] !== hasInvalidValue || $[73] !== propsSelection || $[74] !== restoreSelectionFromProps ? (t17 = () => {\n    propsSelection && !hasInvalidValue && restoreSelectionFromProps();\n  }, t18 = [hasInvalidValue, propsSelection, restoreSelectionFromProps], $[72] = hasInvalidValue, $[73] = propsSelection, $[74] = restoreSelectionFromProps, $[75] = t17, $[76] = t18) : (t17 = $[75], t18 = $[76]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t17, t18);\n  let t19;\n  $[77] !== editorActor || $[78] !== onCopy || $[79] !== slateEditor ? (t19 = (event) => {\n    if (onCopy)\n      onCopy(event) !== void 0 && event.preventDefault();\n    else if (event.nativeEvent.clipboardData) {\n      event.stopPropagation(), event.preventDefault();\n      const selection = slateEditor.selection ? slateRangeToSelection({\n        schema: editorActor.getSnapshot().context.schema,\n        editor: slateEditor,\n        range: slateEditor.selection\n      }) : void 0, position = selection ? {\n        selection\n      } : void 0;\n      if (!position) {\n        console.warn(\"Could not find position for copy event\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"clipboard.copy\",\n          originEvent: {\n            dataTransfer: event.nativeEvent.clipboardData\n          },\n          position\n        },\n        editor: slateEditor,\n        nativeEvent: event\n      });\n    }\n  }, $[77] = editorActor, $[78] = onCopy, $[79] = slateEditor, $[80] = t19) : t19 = $[80];\n  const handleCopy = t19;\n  let t20;\n  $[81] !== editorActor || $[82] !== onCut || $[83] !== slateEditor ? (t20 = (event_0) => {\n    if (onCut)\n      onCut(event_0) !== void 0 && event_0.preventDefault();\n    else if (event_0.nativeEvent.clipboardData) {\n      event_0.stopPropagation(), event_0.preventDefault();\n      const selection_0 = editorActor.getSnapshot().context.selection, position_0 = selection_0 ? {\n        selection: selection_0\n      } : void 0;\n      if (!position_0) {\n        console.warn(\"Could not find position for cut event\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"clipboard.cut\",\n          originEvent: {\n            dataTransfer: event_0.nativeEvent.clipboardData\n          },\n          position: position_0\n        },\n        editor: slateEditor,\n        nativeEvent: event_0\n      });\n    }\n  }, $[81] = editorActor, $[82] = onCut, $[83] = slateEditor, $[84] = t20) : t20 = $[84];\n  const handleCut = t20;\n  let t21;\n  $[85] !== editorActor || $[86] !== onPaste || $[87] !== portableTextEditor || $[88] !== relayActor || $[89] !== slateEditor ? (t21 = (event_1) => {\n    const value = slateEditor.value, path = (slateEditor.selection ? slateRangeToSelection({\n      schema: editorActor.getSnapshot().context.schema,\n      editor: slateEditor,\n      range: slateEditor.selection\n    }) : null)?.focus.path || [], onPasteResult = onPaste?.({\n      event: event_1,\n      value,\n      path,\n      schemaTypes: portableTextEditor.schemaTypes\n    });\n    if (onPasteResult || !slateEditor.selection)\n      event_1.preventDefault(), relayActor.send({\n        type: \"loading\"\n      }), Promise.resolve(onPasteResult).then((result_1) => {\n        if (debug$e(\"Custom paste function from client resolved\", result_1), !result_1 || !result_1.insert) {\n          debug$e(\"No result from custom paste handler, pasting normally\");\n          const selection_1 = editorActor.getSnapshot().context.selection, position_1 = selection_1 ? {\n            selection: selection_1\n          } : void 0;\n          if (!position_1) {\n            console.warn(\"Could not find position for paste event\");\n            return;\n          }\n          editorActor.send({\n            type: \"behavior event\",\n            behaviorEvent: {\n              type: \"clipboard.paste\",\n              originEvent: {\n                dataTransfer: event_1.clipboardData\n              },\n              position: position_1\n            },\n            editor: slateEditor,\n            nativeEvent: event_1\n          });\n        } else\n          result_1.insert ? editorActor.send({\n            type: \"behavior event\",\n            behaviorEvent: {\n              type: \"insert.blocks\",\n              blocks: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlocks)({\n                context: {\n                  keyGenerator: editorActor.getSnapshot().context.keyGenerator,\n                  schema: editorActor.getSnapshot().context.schema\n                },\n                blocks: result_1.insert,\n                options: {\n                  normalize: !1,\n                  removeUnusedMarkDefs: !0,\n                  validateFields: !1\n                }\n              }),\n              placement: \"auto\"\n            },\n            editor: slateEditor\n          }) : console.warn(\"Your onPaste function returned something unexpected:\", result_1);\n      }).catch(_temp5).finally(() => {\n        relayActor.send({\n          type: \"done loading\"\n        });\n      });\n    else if (event_1.nativeEvent.clipboardData) {\n      event_1.preventDefault(), event_1.stopPropagation();\n      const selection_2 = editorActor.getSnapshot().context.selection, position_2 = selection_2 ? {\n        selection: selection_2\n      } : void 0;\n      if (!position_2) {\n        console.warn(\"Could not find position for paste event\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"clipboard.paste\",\n          originEvent: {\n            dataTransfer: event_1.nativeEvent.clipboardData\n          },\n          position: position_2\n        },\n        editor: slateEditor,\n        nativeEvent: event_1\n      });\n    }\n    debug$e(\"No result from custom paste handler, pasting normally\");\n  }, $[85] = editorActor, $[86] = onPaste, $[87] = portableTextEditor, $[88] = relayActor, $[89] = slateEditor, $[90] = t21) : t21 = $[90];\n  const handlePaste = t21;\n  let t22;\n  $[91] !== editorActor || $[92] !== onFocus || $[93] !== relayActor || $[94] !== slateEditor ? (t22 = (event_2) => {\n    onFocus && onFocus(event_2), event_2.isDefaultPrevented() || (relayActor.send({\n      type: \"focused\",\n      event: event_2\n    }), !slateEditor.selection && slateEditor.children.length === 1 && (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(editorActor.getSnapshot().context, slateEditor.value.at(0)) && (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(slateEditor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(slateEditor, [])), slateEditor.onChange()));\n  }, $[91] = editorActor, $[92] = onFocus, $[93] = relayActor, $[94] = slateEditor, $[95] = t22) : t22 = $[95];\n  const handleOnFocus = t22;\n  let t23;\n  $[96] !== editorActor || $[97] !== onClick || $[98] !== slateEditor ? (t23 = (event_3) => {\n    if (onClick && onClick(event_3), event_3.isDefaultPrevented() || event_3.isPropagationStopped())\n      return;\n    const position_3 = getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_3.nativeEvent\n    });\n    position_3 && editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"mouse.click\",\n        position: position_3\n      },\n      editor: slateEditor,\n      nativeEvent: event_3\n    });\n  }, $[96] = editorActor, $[97] = onClick, $[98] = slateEditor, $[99] = t23) : t23 = $[99];\n  const handleClick = t23;\n  let t24;\n  $[100] !== onBlur || $[101] !== relayActor ? (t24 = (event_4) => {\n    onBlur && onBlur(event_4), event_4.isPropagationStopped() || relayActor.send({\n      type: \"blurred\",\n      event: event_4\n    });\n  }, $[100] = onBlur, $[101] = relayActor, $[102] = t24) : t24 = $[102];\n  const handleOnBlur = t24;\n  let t25;\n  $[103] !== onBeforeInput ? (t25 = (event_5) => {\n    onBeforeInput && onBeforeInput(event_5);\n  }, $[103] = onBeforeInput, $[104] = t25) : t25 = $[104];\n  const handleOnBeforeInput = t25;\n  let t26;\n  $[105] !== editorActor || $[106] !== props || $[107] !== slateEditor ? (t26 = (event_6) => {\n    props.onKeyDown && props.onKeyDown(event_6), event_6.isDefaultPrevented() || slateEditor.pteWithHotKeys(event_6), event_6.isDefaultPrevented() || editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"keyboard.keydown\",\n        originEvent: {\n          key: event_6.key,\n          code: event_6.code,\n          altKey: event_6.altKey,\n          ctrlKey: event_6.ctrlKey,\n          metaKey: event_6.metaKey,\n          shiftKey: event_6.shiftKey\n        }\n      },\n      editor: slateEditor,\n      nativeEvent: event_6\n    });\n  }, $[105] = editorActor, $[106] = props, $[107] = slateEditor, $[108] = t26) : t26 = $[108];\n  const handleKeyDown = t26;\n  let t27;\n  $[109] !== editorActor || $[110] !== props || $[111] !== slateEditor ? (t27 = (event_7) => {\n    props.onKeyUp && props.onKeyUp(event_7), event_7.isDefaultPrevented() || editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"keyboard.keyup\",\n        originEvent: {\n          key: event_7.key,\n          code: event_7.code,\n          altKey: event_7.altKey,\n          ctrlKey: event_7.ctrlKey,\n          metaKey: event_7.metaKey,\n          shiftKey: event_7.shiftKey\n        }\n      },\n      editor: slateEditor,\n      nativeEvent: event_7\n    });\n  }, $[109] = editorActor, $[110] = props, $[111] = slateEditor, $[112] = t27) : t27 = $[112];\n  const handleKeyUp = t27;\n  let t28;\n  bb1: {\n    if (scrollSelectionIntoView === void 0) {\n      t28 = void 0;\n      break bb1;\n    }\n    if (scrollSelectionIntoView === null) {\n      t28 = noop;\n      break bb1;\n    }\n    let t292;\n    $[113] !== portableTextEditor || $[114] !== scrollSelectionIntoView ? (t292 = (_editor, domRange) => {\n      scrollSelectionIntoView(portableTextEditor, domRange);\n    }, $[113] = portableTextEditor, $[114] = scrollSelectionIntoView, $[115] = t292) : t292 = $[115], t28 = t292;\n  }\n  const scrollSelectionIntoViewToSlate = t28;\n  let t29, t30;\n  $[116] !== editorActor || $[117] !== slateEditor ? (t29 = () => {\n    const window2 = slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.getWindow(slateEditor), onDragEnd_0 = () => {\n      editorActor.send({\n        type: \"dragend\"\n      });\n    }, onDrop_0 = () => {\n      editorActor.send({\n        type: \"drop\"\n      });\n    };\n    return window2.document.addEventListener(\"dragend\", onDragEnd_0), window2.document.addEventListener(\"drop\", onDrop_0), () => {\n      window2.document.removeEventListener(\"dragend\", onDragEnd_0), window2.document.removeEventListener(\"drop\", onDrop_0);\n    };\n  }, t30 = [slateEditor, editorActor], $[116] = editorActor, $[117] = slateEditor, $[118] = t29, $[119] = t30) : (t29 = $[118], t30 = $[119]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t29, t30);\n  let t31;\n  $[120] !== editorActor || $[121] !== onDragStart || $[122] !== slateEditor ? (t31 = (event_8) => {\n    if (onDragStart?.(event_8), event_8.isDefaultPrevented() || event_8.isPropagationStopped())\n      return;\n    const position_4 = getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_8.nativeEvent\n    });\n    if (!position_4) {\n      console.warn(\"Could not find position for dragstart event\");\n      return;\n    }\n    return editorActor.send({\n      type: \"dragstart\",\n      origin: position_4\n    }), editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"drag.dragstart\",\n        originEvent: {\n          clientX: event_8.clientX,\n          clientY: event_8.clientY,\n          dataTransfer: event_8.dataTransfer\n        },\n        position: position_4\n      },\n      editor: slateEditor\n    }), !0;\n  }, $[120] = editorActor, $[121] = onDragStart, $[122] = slateEditor, $[123] = t31) : t31 = $[123];\n  const handleDragStart = t31;\n  let t32;\n  $[124] !== editorActor || $[125] !== onDrag || $[126] !== slateEditor ? (t32 = (event_9) => {\n    if (onDrag?.(event_9), !(event_9.isDefaultPrevented() || event_9.isPropagationStopped() || !getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_9.nativeEvent\n    })))\n      return editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"drag.drag\",\n          originEvent: {\n            dataTransfer: event_9.dataTransfer\n          }\n        },\n        editor: slateEditor\n      }), !0;\n  }, $[124] = editorActor, $[125] = onDrag, $[126] = slateEditor, $[127] = t32) : t32 = $[127];\n  const handleDrag = t32;\n  let t33;\n  $[128] !== editorActor || $[129] !== onDragEnd || $[130] !== slateEditor ? (t33 = (event_10) => {\n    if (onDragEnd?.(event_10), !(event_10.isDefaultPrevented() || event_10.isPropagationStopped()))\n      return editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"drag.dragend\",\n          originEvent: {\n            dataTransfer: event_10.dataTransfer\n          }\n        },\n        editor: slateEditor\n      }), !0;\n  }, $[128] = editorActor, $[129] = onDragEnd, $[130] = slateEditor, $[131] = t33) : t33 = $[131];\n  const handleDragEnd = t33;\n  let t34;\n  $[132] !== editorActor || $[133] !== onDragEnter || $[134] !== slateEditor ? (t34 = (event_11) => {\n    if (onDragEnter?.(event_11), event_11.isDefaultPrevented() || event_11.isPropagationStopped())\n      return;\n    const position_6 = getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_11.nativeEvent\n    });\n    if (position_6)\n      return editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"drag.dragenter\",\n          originEvent: {\n            dataTransfer: event_11.dataTransfer\n          },\n          position: position_6\n        },\n        editor: slateEditor\n      }), !0;\n  }, $[132] = editorActor, $[133] = onDragEnter, $[134] = slateEditor, $[135] = t34) : t34 = $[135];\n  const handleDragEnter = t34;\n  let t35;\n  $[136] !== editorActor || $[137] !== onDragOver || $[138] !== slateEditor ? (t35 = (event_12) => {\n    if (onDragOver?.(event_12), event_12.isDefaultPrevented() || event_12.isPropagationStopped())\n      return;\n    const position_7 = getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_12.nativeEvent\n    });\n    if (position_7)\n      return editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"drag.dragover\",\n          originEvent: {\n            dataTransfer: event_12.dataTransfer\n          },\n          dragOrigin: editorActor.getSnapshot().context.internalDrag?.origin,\n          position: position_7\n        },\n        editor: slateEditor,\n        nativeEvent: event_12\n      }), !0;\n  }, $[136] = editorActor, $[137] = onDragOver, $[138] = slateEditor, $[139] = t35) : t35 = $[139];\n  const handleDragOver = t35;\n  let t36;\n  $[140] !== editorActor || $[141] !== onDrop || $[142] !== slateEditor ? (t36 = (event_13) => {\n    if (onDrop?.(event_13), event_13.isDefaultPrevented() || event_13.isPropagationStopped())\n      return;\n    const position_8 = getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_13.nativeEvent\n    });\n    if (!position_8) {\n      console.warn(\"Could not find position for drop event\");\n      return;\n    }\n    return editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"drag.drop\",\n        originEvent: {\n          dataTransfer: event_13.dataTransfer\n        },\n        dragOrigin: editorActor.getSnapshot().context.internalDrag?.origin,\n        position: position_8\n      },\n      editor: slateEditor,\n      nativeEvent: event_13\n    }), !0;\n  }, $[140] = editorActor, $[141] = onDrop, $[142] = slateEditor, $[143] = t36) : t36 = $[143];\n  const handleDrop = t36;\n  let t37;\n  $[144] !== editorActor || $[145] !== onDragLeave || $[146] !== slateEditor ? (t37 = (event_14) => {\n    if (onDragLeave?.(event_14), !(event_14.isDefaultPrevented() || event_14.isPropagationStopped() || !getEventPosition({\n      editorActor,\n      slateEditor,\n      event: event_14.nativeEvent\n    })))\n      return editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"drag.dragleave\",\n          originEvent: {\n            dataTransfer: event_14.dataTransfer\n          }\n        },\n        editor: slateEditor\n      }), !0;\n  }, $[144] = editorActor, $[145] = onDragLeave, $[146] = slateEditor, $[147] = t37) : t37 = $[147];\n  const handleDragLeave = t37;\n  let t38;\n  $[148] !== forwardedRef || $[149] !== validateSelectionActor ? (t38 = (editorElement) => {\n    if (typeof forwardedRef == \"function\" ? forwardedRef(editorElement) : forwardedRef && (forwardedRef.current = editorElement), editorElement) {\n      const mutationObserver = new MutationObserver(() => {\n        validateSelectionActor.send({\n          type: \"validate selection\",\n          editorElement\n        });\n      });\n      return mutationObserver.observe(editorElement, {\n        attributeOldValue: !1,\n        attributes: !1,\n        characterData: !1,\n        childList: !0,\n        subtree: !0\n      }), () => {\n        mutationObserver.disconnect();\n      };\n    }\n  }, $[148] = forwardedRef, $[149] = validateSelectionActor, $[150] = t38) : t38 = $[150];\n  const callbackRef = t38;\n  if (!portableTextEditor)\n    return null;\n  let t39;\n  return $[151] !== callbackRef || $[152] !== decorate || $[153] !== handleClick || $[154] !== handleCopy || $[155] !== handleCut || $[156] !== handleDrag || $[157] !== handleDragEnd || $[158] !== handleDragEnter || $[159] !== handleDragLeave || $[160] !== handleDragOver || $[161] !== handleDragStart || $[162] !== handleDrop || $[163] !== handleKeyDown || $[164] !== handleKeyUp || $[165] !== handleOnBeforeInput || $[166] !== handleOnBlur || $[167] !== handleOnFocus || $[168] !== handlePaste || $[169] !== hasInvalidValue || $[170] !== readOnly || $[171] !== renderElement || $[172] !== renderLeaf || $[173] !== restProps || $[174] !== scrollSelectionIntoViewToSlate ? (t39 = hasInvalidValue ? null : /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(slate_react__WEBPACK_IMPORTED_MODULE_15__.Editable, { ...restProps, ref: callbackRef, \"data-read-only\": readOnly, autoFocus: !1, className: restProps.className || \"pt-editable\", decorate, onBlur: handleOnBlur, onCopy: handleCopy, onCut: handleCut, onClick: handleClick, onDOMBeforeInput: handleOnBeforeInput, onDragStart: handleDragStart, onDrag: handleDrag, onDragEnd: handleDragEnd, onDragEnter: handleDragEnter, onDragOver: handleDragOver, onDrop: handleDrop, onDragLeave: handleDragLeave, onFocus: handleOnFocus, onKeyDown: handleKeyDown, onKeyUp: handleKeyUp, onPaste: handlePaste, readOnly, renderPlaceholder: void 0, renderElement, renderLeaf, renderText, scrollSelectionIntoView: scrollSelectionIntoViewToSlate }), $[151] = callbackRef, $[152] = decorate, $[153] = handleClick, $[154] = handleCopy, $[155] = handleCut, $[156] = handleDrag, $[157] = handleDragEnd, $[158] = handleDragEnter, $[159] = handleDragLeave, $[160] = handleDragOver, $[161] = handleDragStart, $[162] = handleDrop, $[163] = handleKeyDown, $[164] = handleKeyUp, $[165] = handleOnBeforeInput, $[166] = handleOnBlur, $[167] = handleOnFocus, $[168] = handlePaste, $[169] = hasInvalidValue, $[170] = readOnly, $[171] = renderElement, $[172] = renderLeaf, $[173] = restProps, $[174] = scrollSelectionIntoViewToSlate, $[175] = t39) : t39 = $[175], t39;\n});\nPortableTextEditable.displayName = \"ForwardRef(PortableTextEditable)\";\nfunction noop() {\n}\nfunction _temp(s) {\n  return s.matches({\n    \"edit mode\": \"read only\"\n  });\n}\nfunction _temp2(s_0) {\n  return s_0.context.decorate?.fn;\n}\nfunction _temp3(props_0) {\n  return /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RenderText, { ...props_0 });\n}\nfunction _temp4(o) {\n  return o.type === \"set_selection\";\n}\nfunction _temp5(error) {\n  return console.warn(error), error;\n}\nconst forEachActor = (actorRef, callback) => {\n  callback(actorRef);\n  const children = actorRef.getSnapshot().children;\n  children && Object.values(children).forEach((child) => {\n    forEachActor(child, callback);\n  });\n};\nfunction stopActor(actorRef) {\n  const persistedSnapshots = [];\n  forEachActor(actorRef, (ref) => {\n    persistedSnapshots.push([ref, ref.getSnapshot()]), ref.observers = /* @__PURE__ */ new Set();\n  });\n  const systemSnapshot = actorRef.system.getSnapshot?.();\n  actorRef.stop(), actorRef.system._snapshot = systemSnapshot, persistedSnapshots.forEach(([ref, snapshot]) => {\n    ref._processingStatus = 0, ref._snapshot = snapshot;\n  });\n}\nconst converterJson = {\n  mimeType: \"application/json\",\n  serialize: ({\n    snapshot,\n    event\n  }) => {\n    const portableTextConverter = snapshot.context.converters.find((converter) => converter.mimeType === \"application/x-portable-text\");\n    return portableTextConverter ? {\n      ...portableTextConverter.serialize({\n        snapshot,\n        event\n      }),\n      mimeType: \"application/json\",\n      originEvent: event.originEvent\n    } : {\n      type: \"serialization.failure\",\n      mimeType: \"application/json\",\n      originEvent: event.originEvent,\n      reason: \"No application/x-portable-text Converter found\"\n    };\n  },\n  deserialize: ({\n    snapshot,\n    event\n  }) => {\n    const portableTextConverter = snapshot.context.converters.find((converter) => converter.mimeType === \"application/x-portable-text\");\n    return portableTextConverter ? {\n      ...portableTextConverter.deserialize({\n        snapshot,\n        event\n      }),\n      mimeType: \"application/json\"\n    } : {\n      type: \"deserialization.failure\",\n      mimeType: \"application/json\",\n      reason: \"No application/x-portable-text Converter found\"\n    };\n  }\n}, converterPortableText = {\n  mimeType: \"application/x-portable-text\",\n  serialize: ({\n    snapshot,\n    event\n  }) => {\n    if (!snapshot.context.selection)\n      return {\n        type: \"serialization.failure\",\n        mimeType: \"application/x-portable-text\",\n        originEvent: event.originEvent,\n        reason: \"No selection\"\n      };\n    const blocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshot);\n    return blocks.length === 0 ? {\n      type: \"serialization.failure\",\n      mimeType: \"application/x-portable-text\",\n      reason: \"No blocks serialized\",\n      originEvent: event.originEvent\n    } : {\n      type: \"serialization.success\",\n      data: JSON.stringify(blocks),\n      mimeType: \"application/x-portable-text\",\n      originEvent: event.originEvent\n    };\n  },\n  deserialize: ({\n    snapshot,\n    event\n  }) => {\n    const blocks = JSON.parse(event.data);\n    if (!Array.isArray(blocks))\n      return {\n        type: \"deserialization.failure\",\n        mimeType: \"application/x-portable-text\",\n        reason: \"Data is not an array\"\n      };\n    const parsedBlocks = blocks.flatMap((block) => {\n      const parsedBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlock)({\n        context: snapshot.context,\n        block,\n        options: {\n          normalize: !1,\n          removeUnusedMarkDefs: !0,\n          validateFields: !1\n        }\n      });\n      return parsedBlock ? [parsedBlock] : [];\n    });\n    return parsedBlocks.length === 0 && blocks.length > 0 ? {\n      type: \"deserialization.failure\",\n      mimeType: \"application/x-portable-text\",\n      reason: \"No blocks were parsed\"\n    } : {\n      type: \"deserialization.success\",\n      data: parsedBlocks,\n      mimeType: \"application/x-portable-text\"\n    };\n  }\n};\nfunction createConverterTextHtml(legacySchema) {\n  return {\n    mimeType: \"text/html\",\n    serialize: ({\n      snapshot,\n      event\n    }) => {\n      if (!snapshot.context.selection)\n        return {\n          type: \"serialization.failure\",\n          mimeType: \"text/html\",\n          originEvent: event.originEvent,\n          reason: \"No selection\"\n        };\n      const blocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshot), html = (0,_portabletext_to_html__WEBPACK_IMPORTED_MODULE_17__.toHTML)(blocks, {\n        onMissingComponent: !1,\n        components: {\n          unknownType: ({\n            children\n          }) => children !== void 0 ? `${children}` : \"\"\n        }\n      });\n      return html === \"\" ? {\n        type: \"serialization.failure\",\n        mimeType: \"text/html\",\n        originEvent: event.originEvent,\n        reason: \"Serialized HTML is empty\"\n      } : {\n        type: \"serialization.success\",\n        data: html,\n        mimeType: \"text/html\",\n        originEvent: event.originEvent\n      };\n    },\n    deserialize: ({\n      snapshot,\n      event\n    }) => {\n      const parsedBlocks = (0,_portabletext_block_tools__WEBPACK_IMPORTED_MODULE_18__.htmlToBlocks)(event.data, legacySchema.portableText, {\n        keyGenerator: snapshot.context.keyGenerator,\n        unstable_whitespaceOnPasteMode: legacySchema.block.options.unstable_whitespaceOnPasteMode\n      }).flatMap((block) => {\n        const parsedBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlock)({\n          context: snapshot.context,\n          block,\n          options: {\n            normalize: !1,\n            removeUnusedMarkDefs: !0,\n            validateFields: !1\n          }\n        });\n        return parsedBlock ? [parsedBlock] : [];\n      });\n      return parsedBlocks.length === 0 ? {\n        type: \"deserialization.failure\",\n        mimeType: \"text/html\",\n        reason: \"No blocks deserialized\"\n      } : {\n        type: \"deserialization.success\",\n        data: parsedBlocks,\n        mimeType: \"text/html\"\n      };\n    }\n  };\n}\nconst converterTextMarkdown = {\n  mimeType: \"text/markdown\",\n  serialize: ({\n    snapshot,\n    event\n  }) => {\n    if (!snapshot.context.selection)\n      return {\n        type: \"serialization.failure\",\n        mimeType: \"text/markdown\",\n        reason: \"No selection\",\n        originEvent: event.originEvent\n      };\n    const blocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshot);\n    return {\n      type: \"serialization.success\",\n      data: (0,_portabletext_markdown__WEBPACK_IMPORTED_MODULE_19__.portableTextToMarkdown)(blocks),\n      mimeType: \"text/markdown\",\n      originEvent: event.originEvent\n    };\n  },\n  deserialize: ({\n    snapshot,\n    event\n  }) => {\n    const parsedBlocks = (0,_portabletext_markdown__WEBPACK_IMPORTED_MODULE_19__.markdownToPortableText)(event.data, {\n      keyGenerator: snapshot.context.keyGenerator,\n      schema: snapshot.context.schema\n    }).flatMap((block) => {\n      const parsedBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlock)({\n        context: snapshot.context,\n        block,\n        options: {\n          normalize: !1,\n          removeUnusedMarkDefs: !0,\n          validateFields: !1\n        }\n      });\n      return parsedBlock ? [parsedBlock] : [];\n    });\n    return parsedBlocks.length === 0 ? {\n      type: \"deserialization.failure\",\n      mimeType: \"text/markdown\",\n      reason: \"No blocks deserialized\"\n    } : {\n      type: \"deserialization.success\",\n      data: parsedBlocks,\n      mimeType: \"text/markdown\"\n    };\n  }\n};\nfunction createConverterTextPlain(legacySchema) {\n  return {\n    mimeType: \"text/plain\",\n    serialize: ({\n      snapshot,\n      event\n    }) => snapshot.context.selection ? {\n      type: \"serialization.success\",\n      data: (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshot).map((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, block) ? block.children.map((child) => child._type === snapshot.context.schema.span.name ? child.text : event.originEvent === \"drag.dragstart\" ? `[${snapshot.context.schema.inlineObjects.find((inlineObjectType) => inlineObjectType.name === child._type)?.title ?? \"Object\"}]` : \"\").join(\"\") : event.originEvent === \"drag.dragstart\" ? `[${snapshot.context.schema.blockObjects.find((blockObjectType) => blockObjectType.name === block._type)?.title ?? \"Object\"}]` : \"\").filter((block) => block !== \"\").join(`\n\n`),\n      mimeType: \"text/plain\",\n      originEvent: event.originEvent\n    } : {\n      type: \"serialization.failure\",\n      mimeType: \"text/plain\",\n      originEvent: event.originEvent,\n      reason: \"No selection\"\n    },\n    deserialize: ({\n      snapshot,\n      event\n    }) => {\n      const textToHtml = `<html><body>${escapeHtml(event.data).split(/\\n{2,}/).map((line) => line ? `<p>${line.replace(/(?:\\r\\n|\\r|\\n)/g, \"<br/>\")}</p>` : \"<p></p>\").join(\"\")}</body></html>`, parsedBlocks = (0,_portabletext_block_tools__WEBPACK_IMPORTED_MODULE_18__.htmlToBlocks)(textToHtml, legacySchema.portableText, {\n        keyGenerator: snapshot.context.keyGenerator\n      }).flatMap((block) => {\n        const parsedBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlock)({\n          context: snapshot.context,\n          block,\n          options: {\n            normalize: !1,\n            removeUnusedMarkDefs: !0,\n            validateFields: !1\n          }\n        });\n        return parsedBlock ? [parsedBlock] : [];\n      });\n      return parsedBlocks.length === 0 ? {\n        type: \"deserialization.failure\",\n        mimeType: \"text/plain\",\n        reason: \"No blocks deserialized\"\n      } : {\n        type: \"deserialization.success\",\n        data: parsedBlocks,\n        mimeType: \"text/plain\"\n      };\n    }\n  };\n}\nconst entityMap = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&#39;\",\n  \"/\": \"&#x2F;\",\n  \"`\": \"&#x60;\",\n  \"=\": \"&#x3D;\"\n};\nfunction escapeHtml(str) {\n  return String(str).replace(/[&<>\"'`=/]/g, (s) => entityMap[s]);\n}\nfunction createCoreConverters(legacySchema) {\n  return [converterJson, converterPortableText, converterTextMarkdown, createConverterTextHtml(legacySchema), createConverterTextPlain(legacySchema)];\n}\nfunction compileType(rawType) {\n  return _sanity_schema__WEBPACK_IMPORTED_MODULE_20__.Schema.compile({\n    name: \"blockTypeSchema\",\n    types: [rawType]\n  }).get(rawType.name);\n}\nfunction createEditableAPI(editor, editorActor) {\n  const types = editorActor.getSnapshot().context.schema;\n  return {\n    focus: () => {\n      editorActor.send({\n        type: \"focus\",\n        editor\n      });\n    },\n    blur: () => {\n      editorActor.send({\n        type: \"blur\",\n        editor\n      });\n    },\n    toggleMark: (mark) => {\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"decorator.toggle\",\n          decorator: mark\n        },\n        editor\n      });\n    },\n    toggleList: (listItem) => {\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"list item.toggle\",\n          listItem\n        },\n        editor\n      });\n    },\n    toggleBlockStyle: (style) => {\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"style.toggle\",\n          style\n        },\n        editor\n      });\n    },\n    isMarkActive: (mark) => {\n      const snapshot = getEditorSnapshot({\n        editorActorSnapshot: editorActor.getSnapshot(),\n        slateEditorInstance: editor\n      });\n      return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveDecorators)(snapshot).includes(mark);\n    },\n    marks: () => {\n      const snapshot = getEditorSnapshot({\n        editorActorSnapshot: editorActor.getSnapshot(),\n        slateEditorInstance: editor\n      }), activeAnnotations = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveAnnotationsMarks)(snapshot), activeDecorators = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveDecorators)(snapshot);\n      return [...activeAnnotations, ...activeDecorators];\n    },\n    undo: () => {\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"history.undo\"\n        },\n        editor\n      });\n    },\n    redo: () => {\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"history.redo\"\n        },\n        editor\n      });\n    },\n    select: (selection) => {\n      const slateSelection = toSlateRange({\n        context: {\n          schema: editorActor.getSnapshot().context.schema,\n          value: editor.value,\n          selection\n        },\n        blockIndexMap: editor.blockIndexMap\n      });\n      slateSelection ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slateSelection) : slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(editor), editor.onChange();\n    },\n    focusBlock: () => {\n      if (!editor.selection)\n        return;\n      const focusBlockIndex = editor.selection.focus.path.at(0);\n      if (focusBlockIndex !== void 0)\n        return editor.value.at(focusBlockIndex);\n    },\n    focusChild: () => {\n      if (!editor.selection)\n        return;\n      const focusBlockIndex = editor.selection.focus.path.at(0), focusChildIndex = editor.selection.focus.path.at(1), block = focusBlockIndex !== void 0 ? editor.value.at(focusBlockIndex) : void 0;\n      if (block && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(editorActor.getSnapshot().context, block))\n        return focusChildIndex === void 0 ? void 0 : block.children.at(focusChildIndex);\n    },\n    insertChild: (type, value) => (editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"insert.child\",\n        child: {\n          _type: type.name,\n          ...value || {}\n        }\n      },\n      editor\n    }), editor.selection ? slateRangeToSelection({\n      schema: editorActor.getSnapshot().context.schema,\n      editor,\n      range: editor.selection\n    })?.focus.path ?? [] : []),\n    insertBlock: (type, value) => (editorActor.send({\n      type: \"behavior event\",\n      behaviorEvent: {\n        type: \"insert.block\",\n        block: {\n          _type: type.name,\n          ...value || {}\n        },\n        placement: \"auto\"\n      },\n      editor\n    }), editor.selection ? slateRangeToSelection({\n      schema: editorActor.getSnapshot().context.schema,\n      editor,\n      range: editor.selection\n    })?.focus.path ?? [] : []),\n    hasBlockStyle: (style) => {\n      try {\n        return isStyleActive({\n          editor,\n          style\n        });\n      } catch {\n        return !1;\n      }\n    },\n    hasListStyle: (listItem) => {\n      try {\n        return isListItemActive({\n          editor,\n          listItem\n        });\n      } catch {\n        return !1;\n      }\n    },\n    isVoid: (element) => ![types.block.name, types.span.name].includes(element._type),\n    findByPath: (path) => {\n      const blockKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockKeyFromSelectionPoint)({\n        path\n      });\n      if (!blockKey)\n        return [void 0, void 0];\n      const blockIndex = editor.blockIndexMap.get(blockKey);\n      if (blockIndex === void 0)\n        return [void 0, void 0];\n      const block = editor.value.at(blockIndex);\n      if (!block)\n        return [void 0, void 0];\n      const childKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getChildKeyFromSelectionPoint)({\n        path\n      });\n      if (path.length === 1 && !childKey)\n        return [block, [{\n          _key: block._key\n        }]];\n      if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(editorActor.getSnapshot().context, block) && childKey) {\n        const child = block.children.find((child2) => child2._key === childKey);\n        if (child)\n          return [child, [{\n            _key: block._key\n          }, \"children\", {\n            _key: child._key\n          }]];\n      }\n      return [void 0, void 0];\n    },\n    findDOMNode: (element) => {\n      let node;\n      try {\n        const [item] = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n          at: [],\n          match: (n) => n._key === element._key\n        }) || [])[0] || [void 0];\n        node = slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.toDOMNode(editor, item);\n      } catch {\n      }\n      return node;\n    },\n    activeAnnotations: () => {\n      if (!editor.selection || editor.selection.focus.path.length < 2)\n        return [];\n      try {\n        const activeAnnotations = [], spans = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n          at: editor.selection,\n          match: (node) => slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(node) && node.marks !== void 0 && Array.isArray(node.marks) && node.marks.length > 0\n        });\n        for (const [span, path] of spans) {\n          const [block] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, path, {\n            depth: 1\n          });\n          editor.isTextBlock(block) && block.markDefs?.forEach((def) => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(span) && span.marks && Array.isArray(span.marks) && span.marks.includes(def._key) && activeAnnotations.push(def);\n          });\n        }\n        return activeAnnotations;\n      } catch {\n        return [];\n      }\n    },\n    isAnnotationActive: (annotationType) => {\n      const snapshot = getEditorSnapshot({\n        editorActorSnapshot: editorActor.getSnapshot(),\n        slateEditorInstance: editor\n      });\n      return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveAnnotation)(annotationType)(snapshot);\n    },\n    addAnnotation: (type, value) => {\n      const snapshotBefore = getEditorSnapshot({\n        editorActorSnapshot: editorActor.getSnapshot(),\n        slateEditorInstance: editor\n      }), selectedValueBefore = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshotBefore), focusSpanBefore = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshotBefore), markDefsBefore = selectedValueBefore.flatMap((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshotBefore.context, block) ? block.markDefs ?? [] : []);\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"annotation.add\",\n          annotation: {\n            name: type.name,\n            value: value ?? {}\n          }\n        },\n        editor\n      });\n      const snapshotAfter = getEditorSnapshot({\n        editorActorSnapshot: editorActor.getSnapshot(),\n        slateEditorInstance: editor\n      }), selectedValueAfter = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshotAfter), focusBlockAfter = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlock)(snapshotAfter), focusSpanAfter = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshotAfter), newMarkDefKeysOnFocusSpan = focusSpanAfter?.node.marks?.filter((mark) => !focusSpanBefore?.node.marks?.includes(mark) && !snapshotAfter.context.schema.decorators.map((decorator) => decorator.name).includes(mark)), markDefs = selectedValueAfter.flatMap((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshotAfter.context, block) ? block.markDefs?.map((markDef2) => ({\n        markDef: markDef2,\n        path: [{\n          _key: block._key\n        }, \"markDefs\", {\n          _key: markDef2._key\n        }]\n      })) ?? [] : []).filter((markDef2) => !markDefsBefore.some((markDefBefore) => markDefBefore._key === markDef2.markDef._key)), spanPath = focusSpanAfter?.path, markDef = markDefs.find((markDef2) => newMarkDefKeysOnFocusSpan?.some((mark) => mark === markDef2.markDef._key));\n      if (focusBlockAfter && spanPath && markDef)\n        return {\n          markDefPath: markDef.path,\n          markDefPaths: markDefs.map((markDef2) => markDef2.path),\n          spanPath\n        };\n    },\n    delete: (selection, options) => {\n      selection && editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"delete\",\n          at: selection,\n          unit: options?.mode === \"blocks\" ? \"block\" : options?.mode === \"children\" ? \"child\" : void 0\n        },\n        editor\n      });\n    },\n    removeAnnotation: (type) => {\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"annotation.remove\",\n          annotation: {\n            name: type.name\n          }\n        },\n        editor\n      });\n    },\n    getSelection: () => {\n      if (!editor.selection)\n        return null;\n      if (editor.selection === editor.lastSlateSelection)\n        return editor.lastSelection;\n      const selection = slateRangeToSelection({\n        schema: editorActor.getSnapshot().context.schema,\n        editor,\n        range: editor.selection\n      });\n      return editor.lastSlateSelection = editor.selection, editor.lastSelection = selection, selection;\n    },\n    getValue: () => editor.value,\n    isCollapsedSelection: () => !!editor.selection && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(editor.selection),\n    isExpandedSelection: () => !!editor.selection && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(editor.selection),\n    insertBreak: () => {\n      editor.insertBreak(), editor.onChange();\n    },\n    getFragment: () => {\n      const snapshot = getEditorSnapshot({\n        editorActorSnapshot: editorActor.getSnapshot(),\n        slateEditorInstance: editor\n      });\n      return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedValue)(snapshot);\n    },\n    isSelectionsOverlapping: (selectionA, selectionB) => {\n      const rangeA = toSlateRange({\n        context: {\n          schema: editorActor.getSnapshot().context.schema,\n          value: editor.value,\n          selection: selectionA\n        },\n        blockIndexMap: editor.blockIndexMap\n      }), rangeB = toSlateRange({\n        context: {\n          schema: editorActor.getSnapshot().context.schema,\n          value: editor.value,\n          selection: selectionB\n        },\n        blockIndexMap: editor.blockIndexMap\n      });\n      return slate__WEBPACK_IMPORTED_MODULE_5__.Range.isRange(rangeA) && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isRange(rangeB) && slate__WEBPACK_IMPORTED_MODULE_5__.Range.includes(rangeA, rangeB);\n    }\n  };\n}\nconst levelIndexMaps = /* @__PURE__ */ new Map();\nfunction buildIndexMaps(context, {\n  blockIndexMap,\n  listIndexMap\n}) {\n  blockIndexMap.clear(), listIndexMap.clear(), levelIndexMaps.clear();\n  let previousListItem;\n  for (let blockIndex = 0; blockIndex < context.value.length; blockIndex++) {\n    const block = context.value.at(blockIndex);\n    if (block === void 0)\n      continue;\n    if (blockIndexMap.set(block._key, blockIndex), !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, block)) {\n      levelIndexMaps.clear(), previousListItem = void 0;\n      continue;\n    }\n    if (block.listItem === void 0 || block.level === void 0) {\n      levelIndexMaps.clear(), previousListItem = void 0;\n      continue;\n    }\n    if (!previousListItem) {\n      const levelIndexMap2 = levelIndexMaps.get(block.listItem) ?? /* @__PURE__ */ new Map();\n      levelIndexMap2.set(block.level, 1), levelIndexMaps.set(block.listItem, levelIndexMap2), listIndexMap.set(block._key, 1), previousListItem = {\n        listItem: block.listItem,\n        level: block.level\n      };\n      continue;\n    }\n    if (previousListItem.listItem === block.listItem && previousListItem.level < block.level) {\n      const levelIndexMap2 = levelIndexMaps.get(block.listItem) ?? /* @__PURE__ */ new Map();\n      levelIndexMap2.set(block.level, 1), levelIndexMaps.set(block.listItem, levelIndexMap2), listIndexMap.set(block._key, 1), previousListItem = {\n        listItem: block.listItem,\n        level: block.level\n      };\n      continue;\n    }\n    levelIndexMaps.forEach((levelIndexMap2, listItem) => {\n      if (listItem === block.listItem)\n        return;\n      const levelsToDelete = [];\n      levelIndexMap2.forEach((_, level) => {\n        level >= block.level && levelsToDelete.push(level);\n      }), levelsToDelete.forEach((level) => {\n        levelIndexMap2.delete(level);\n      });\n    });\n    const levelIndexMap = levelIndexMaps.get(block.listItem) ?? /* @__PURE__ */ new Map(), levelCounter = levelIndexMap.get(block.level) ?? 0;\n    levelIndexMap.set(block.level, levelCounter + 1), levelIndexMaps.set(block.listItem, levelIndexMap), listIndexMap.set(block._key, levelCounter + 1), previousListItem = {\n      listItem: block.listItem,\n      level: block.level\n    };\n  }\n}\nfunction createPlaceholderBlock(context) {\n  return {\n    _type: context.schema.block.name,\n    _key: context.keyGenerator(),\n    style: context.schema.styles[0].name ?? \"normal\",\n    markDefs: [],\n    children: [{\n      _type: context.schema.span.name,\n      _key: context.keyGenerator(),\n      text: \"\",\n      marks: []\n    }]\n  };\n}\nconst addAnnotationOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const parsedAnnotation = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseAnnotation)({\n    annotation: {\n      _type: operation.annotation.name,\n      _key: operation.annotation._key,\n      ...operation.annotation.value\n    },\n    context,\n    options: {\n      validateFields: !0\n    }\n  });\n  if (!parsedAnnotation)\n    throw new Error(`Failed to parse annotation ${JSON.stringify(operation.annotation)}`);\n  const editor = operation.editor;\n  if (!editor.selection || slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(editor.selection))\n    return;\n  const selectedBlocks = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n    at: editor.selection,\n    match: (node) => editor.isTextBlock(node),\n    reverse: slate__WEBPACK_IMPORTED_MODULE_5__.Range.isBackward(editor.selection)\n  });\n  let blockIndex = 0;\n  for (const [block, blockPath] of selectedBlocks) {\n    if (block.children.length === 0 || block.children.length === 1 && block.children[0].text === \"\")\n      continue;\n    const annotationKey = blockIndex === 0 ? parsedAnnotation._key : context.keyGenerator(), markDefs = block.markDefs ?? [];\n    markDefs.find((markDef) => markDef._type === parsedAnnotation._type && markDef._key === annotationKey) === void 0 && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n      markDefs: [...markDefs, {\n        ...parsedAnnotation,\n        _key: annotationKey\n      }]\n    }, {\n      at: blockPath\n    }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {}, {\n      match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText,\n      split: !0\n    });\n    const children = slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, blockPath);\n    for (const [span, path] of children) {\n      if (!editor.isTextSpan(span) || !slate__WEBPACK_IMPORTED_MODULE_5__.Range.includes(editor.selection, path))\n        continue;\n      const marks = span.marks ?? [];\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        marks: [...marks, annotationKey]\n      }, {\n        at: path\n      });\n    }\n    blockIndex++;\n  }\n}, removeAnnotationOperationImplementation = ({\n  operation\n}) => {\n  const editor = operation.editor;\n  if (editor.selection)\n    if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(editor.selection)) {\n      const [block, blockPath] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, editor.selection, {\n        depth: 1\n      });\n      if (!editor.isTextBlock(block))\n        return;\n      const potentialAnnotations = (block.markDefs ?? []).filter((markDef) => markDef._type === operation.annotation.name), [selectedChild, selectedChildPath] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, editor.selection, {\n        depth: 2\n      });\n      if (!editor.isTextSpan(selectedChild))\n        return;\n      const annotationToRemove = selectedChild.marks?.find((mark) => potentialAnnotations.some((markDef) => markDef._key === mark));\n      if (!annotationToRemove)\n        return;\n      const previousSpansWithSameAnnotation = [];\n      for (const [child, childPath] of slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, blockPath, {\n        reverse: !0\n      }))\n        if (editor.isTextSpan(child) && slate__WEBPACK_IMPORTED_MODULE_5__.Path.isBefore(childPath, selectedChildPath))\n          if (child.marks?.includes(annotationToRemove))\n            previousSpansWithSameAnnotation.push([child, childPath]);\n          else\n            break;\n      const nextSpansWithSameAnnotation = [];\n      for (const [child, childPath] of slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, blockPath))\n        if (editor.isTextSpan(child) && slate__WEBPACK_IMPORTED_MODULE_5__.Path.isAfter(childPath, selectedChildPath))\n          if (child.marks?.includes(annotationToRemove))\n            nextSpansWithSameAnnotation.push([child, childPath]);\n          else\n            break;\n      for (const [child, childPath] of [...previousSpansWithSameAnnotation, [selectedChild, selectedChildPath], ...nextSpansWithSameAnnotation])\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n          marks: child.marks?.filter((mark) => mark !== annotationToRemove)\n        }, {\n          at: childPath\n        });\n    } else {\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {}, {\n        match: (node) => editor.isTextSpan(node),\n        split: !0,\n        hanging: !0\n      });\n      const blocks = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n        at: editor.selection,\n        match: (node) => editor.isTextBlock(node)\n      });\n      for (const [block, blockPath] of blocks) {\n        const children = slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, blockPath);\n        for (const [child, childPath] of children) {\n          if (!editor.isTextSpan(child) || !slate__WEBPACK_IMPORTED_MODULE_5__.Range.includes(editor.selection, childPath))\n            continue;\n          const markDefs = block.markDefs ?? [], marks = child.marks ?? [], marksWithoutAnnotation = marks.filter((mark) => markDefs.find((markDef2) => markDef2._key === mark)?._type !== operation.annotation.name);\n          marksWithoutAnnotation.length !== marks.length && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            marks: marksWithoutAnnotation\n          }, {\n            at: childPath\n          });\n        }\n      }\n    }\n}, blockSetOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const blockIndex = operation.editor.blockIndexMap.get(operation.at[0]._key);\n  if (blockIndex === void 0)\n    throw new Error(`Unable to find block index for block at ${JSON.stringify(operation.at)}`);\n  const slateBlock = operation.editor.children.at(blockIndex);\n  if (!slateBlock)\n    throw new Error(`Unable to find block at ${JSON.stringify(operation.at)}`);\n  if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, slateBlock)) {\n    const filteredProps = {};\n    for (const key of Object.keys(operation.props))\n      if (!(key === \"_type\" || key === \"children\")) {\n        if (key === \"style\") {\n          context.schema.styles.some((style) => style.name === operation.props[key]) && (filteredProps[key] = operation.props[key]);\n          continue;\n        }\n        if (key === \"listItem\") {\n          context.schema.lists.some((list) => list.name === operation.props[key]) && (filteredProps[key] = operation.props[key]);\n          continue;\n        }\n        if (key === \"level\") {\n          filteredProps[key] = operation.props[key];\n          continue;\n        }\n        if (key === \"markDefs\") {\n          const {\n            markDefs\n          } = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseMarkDefs)({\n            context,\n            markDefs: operation.props[key],\n            options: {\n              validateFields: !0\n            }\n          });\n          filteredProps[key] = markDefs;\n          continue;\n        }\n        context.schema.block.fields?.some((field) => field.name === key) && (filteredProps[key] = operation.props[key]);\n      }\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, filteredProps, {\n      at: [blockIndex]\n    });\n  } else {\n    const schemaDefinition = context.schema.blockObjects.find((definition) => definition.name === slateBlock._type), filteredProps = {};\n    for (const key of Object.keys(operation.props))\n      if (key !== \"_type\") {\n        if (key === \"_key\") {\n          filteredProps[key] = operation.props[key];\n          continue;\n        }\n        schemaDefinition?.fields.some((field) => field.name === key) && (filteredProps[key] = operation.props[key]);\n      }\n    const patches = Object.entries(filteredProps).map(([key, value]) => key === \"_key\" ? (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [\"_key\"]) : (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [\"value\", key])), updatedSlateBlock = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(slateBlock, patches);\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, updatedSlateBlock, {\n      at: [blockIndex]\n    });\n  }\n}, blockUnsetOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const blockKey = operation.at[0]._key, blockIndex = operation.editor.blockIndexMap.get(blockKey);\n  if (blockIndex === void 0)\n    throw new Error(`Unable to find block index for block key ${blockKey}`);\n  const slateBlock = blockIndex !== void 0 ? operation.editor.children.at(blockIndex) : void 0;\n  if (!slateBlock)\n    throw new Error(`Unable to find block at ${JSON.stringify(operation.at)}`);\n  if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, slateBlock)) {\n    const propsToRemove = operation.props.filter((prop) => prop !== \"_type\" && prop !== \"_key\" && prop !== \"children\");\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.unsetNodes(operation.editor, propsToRemove, {\n      at: [blockIndex]\n    }), operation.props.includes(\"_key\") && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, {\n      _key: context.keyGenerator()\n    }, {\n      at: [blockIndex]\n    });\n    return;\n  }\n  const patches = operation.props.flatMap((key) => key === \"_type\" ? [] : key === \"_key\" ? (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(context.keyGenerator(), [\"_key\"]) : (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([\"value\", key])), updatedSlateBlock = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(slateBlock, patches);\n  slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, updatedSlateBlock, {\n    at: [blockIndex]\n  });\n}, childSetOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const location = toSlateRange({\n    context: {\n      schema: context.schema,\n      value: operation.editor.value,\n      selection: {\n        anchor: {\n          path: operation.at,\n          offset: 0\n        },\n        focus: {\n          path: operation.at,\n          offset: 0\n        }\n      }\n    },\n    blockIndexMap: operation.editor.blockIndexMap\n  });\n  if (!location)\n    throw new Error(`Unable to convert ${JSON.stringify(operation.at)} into a Slate Range`);\n  const childEntry = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(operation.editor, location, {\n    depth: 2\n  }), child = childEntry?.[0], childPath = childEntry?.[1];\n  if (!child || !childPath)\n    throw new Error(`Unable to find child at ${JSON.stringify(operation.at)}`);\n  if (operation.editor.isTextSpan(child)) {\n    const {\n      _type,\n      text,\n      ...rest\n    } = operation.props;\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, {\n      ...child,\n      ...rest\n    }, {\n      at: childPath\n    }), typeof text == \"string\" && child.text !== text && (operation.editor.apply({\n      type: \"remove_text\",\n      path: childPath,\n      offset: 0,\n      text: child.text\n    }), operation.editor.apply({\n      type: \"insert_text\",\n      path: childPath,\n      offset: 0,\n      text\n    }));\n    return;\n  }\n  if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(child)) {\n    const definition = context.schema.inlineObjects.find((definition2) => definition2.name === child._type);\n    if (!definition)\n      throw new Error(`Unable to find schema definition for Inline Object type ${child._type}`);\n    const value = \"value\" in child && typeof child.value == \"object\" ? child.value : {}, {\n      _type,\n      _key,\n      ...rest\n    } = operation.props;\n    for (const prop in rest)\n      definition.fields.some((field) => field.name === prop) || delete rest[prop];\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, {\n      ...child,\n      _key: typeof _key == \"string\" ? _key : child._key,\n      value: {\n        ...value,\n        ...rest\n      }\n    }, {\n      at: childPath\n    });\n    return;\n  }\n  throw new Error(`Unable to determine the type of child at ${JSON.stringify(operation.at)}`);\n}, childUnsetOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const blockKey = operation.at[0]._key, blockIndex = operation.editor.blockIndexMap.get(blockKey);\n  if (blockIndex === void 0)\n    throw new Error(`Unable to find block index for block key ${blockKey}`);\n  const block = blockIndex !== void 0 ? operation.editor.value.at(blockIndex) : void 0;\n  if (!block)\n    throw new Error(`Unable to find block at ${JSON.stringify(operation.at)}`);\n  if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, block))\n    throw new Error(`Block ${JSON.stringify(blockKey)} is not a text block`);\n  const childKey = operation.at[2]._key;\n  if (!childKey)\n    throw new Error(`Unable to find child key at ${JSON.stringify(operation.at)}`);\n  const childIndex = block.children.findIndex((child2) => child2._key === childKey);\n  if (childIndex === -1)\n    throw new Error(`Unable to find child at ${JSON.stringify(operation.at)}`);\n  const childEntry = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(operation.editor, [blockIndex, childIndex], {\n    depth: 2\n  }), child = childEntry?.[0], childPath = childEntry?.[1];\n  if (!child || !childPath)\n    throw new Error(`Unable to find child at ${JSON.stringify(operation.at)}`);\n  if (operation.editor.isTextSpan(child)) {\n    const newNode = {};\n    for (const prop of operation.props)\n      if (prop !== \"text\" && prop !== \"_type\") {\n        if (prop === \"_key\") {\n          newNode._key = context.keyGenerator();\n          continue;\n        }\n        newNode[prop] = null;\n      }\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, newNode, {\n      at: childPath\n    }), operation.props.includes(\"text\") && operation.editor.apply({\n      type: \"remove_text\",\n      path: childPath,\n      offset: 0,\n      text: child.text\n    });\n    return;\n  }\n  if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(child)) {\n    const value = \"value\" in child && typeof child.value == \"object\" ? child.value : {}, patches = operation.props.map((prop) => ({\n      type: \"unset\",\n      path: [prop]\n    })), newValue = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(value, patches);\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(operation.editor, {\n      ...child,\n      _key: operation.props.includes(\"_key\") ? context.keyGenerator() : child._key,\n      value: newValue\n    }, {\n      at: childPath\n    });\n    return;\n  }\n  throw new Error(`Unable to determine the type of child at ${JSON.stringify(operation.at)}`);\n}, decoratorAddOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const editor = operation.editor, mark = operation.decorator;\n  let at = operation.at ? toSlateRange({\n    context: {\n      schema: context.schema,\n      value: operation.editor.value,\n      selection: operation.at\n    },\n    blockIndexMap: operation.editor.blockIndexMap\n  }) : operation.editor.selection;\n  if (!at)\n    throw new Error(\"Unable to add decorator without a selection\");\n  if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(at)) {\n    const rangeRef = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.rangeRef(editor, at, {\n      affinity: \"inward\"\n    }), [start, end] = slate__WEBPACK_IMPORTED_MODULE_5__.Range.edges(at), endAtEndOfNode = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEnd(editor, end, end.path);\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.splitNodes(editor, {\n      at: end,\n      match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText,\n      mode: \"lowest\",\n      voids: !1,\n      always: !endAtEndOfNode\n    });\n    const startAtStartOfNode = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isStart(editor, start, start.path);\n    if (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.splitNodes(editor, {\n      at: start,\n      match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText,\n      mode: \"lowest\",\n      voids: !1,\n      always: !startAtStartOfNode\n    }), at = rangeRef.unref(), !at)\n      throw new Error(\"Unable to add decorator without a selection\");\n    operation.at || slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, at);\n    const splitTextNodes = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n      at,\n      match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText\n    });\n    for (const [node, path] of splitTextNodes) {\n      const marks = [...(Array.isArray(node.marks) ? node.marks : []).filter((eMark) => eMark !== mark), mark];\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        marks\n      }, {\n        at: path,\n        match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText,\n        split: !0,\n        hanging: !0\n      });\n    }\n  } else {\n    if (!Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n      at,\n      match: (node) => editor.isTextSpan(node)\n    }))?.at(0))\n      return;\n    const [block, blockPath] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, at, {\n      depth: 1\n    }), lonelyEmptySpan = editor.isTextBlock(block) && block.children.length === 1 && editor.isTextSpan(block.children[0]) && block.children[0].text === \"\" ? block.children[0] : void 0;\n    if (lonelyEmptySpan) {\n      const existingMarks = lonelyEmptySpan.marks ?? [], existingMarksWithoutDecorator = existingMarks.filter((existingMark) => existingMark !== mark);\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        marks: existingMarks.length === existingMarksWithoutDecorator.length ? [...existingMarks, mark] : existingMarksWithoutDecorator\n      }, {\n        at: blockPath,\n        match: (node) => editor.isTextSpan(node)\n      });\n    } else\n      editor.decoratorState[mark] = !0;\n  }\n  if (editor.selection) {\n    const selection = editor.selection;\n    editor.selection = {\n      ...selection\n    };\n  }\n}, decoratorRemoveOperationImplementation = ({\n  operation\n}) => {\n  const editor = operation.editor, mark = operation.decorator, {\n    selection\n  } = editor;\n  if (selection) {\n    if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(selection))\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {}, {\n        match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText,\n        split: !0,\n        hanging: !0\n      }), editor.selection && [...slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n        at: editor.selection,\n        match: slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText\n      })].forEach(([node, path]) => {\n        const block = editor.children[path[0]];\n        slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(block) && block.children.includes(node) && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n          marks: (Array.isArray(node.marks) ? node.marks : []).filter((eMark) => eMark !== mark),\n          _type: \"span\"\n        }, {\n          at: path\n        });\n      });\n    else {\n      const [block, blockPath] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, selection, {\n        depth: 1\n      }), lonelyEmptySpan = editor.isTextBlock(block) && block.children.length === 1 && editor.isTextSpan(block.children[0]) && block.children[0].text === \"\" ? block.children[0] : void 0;\n      if (lonelyEmptySpan) {\n        const existingMarksWithoutDecorator = (lonelyEmptySpan.marks ?? []).filter((existingMark) => existingMark !== mark);\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n          marks: existingMarksWithoutDecorator\n        }, {\n          at: blockPath,\n          match: (node) => editor.isTextSpan(node)\n        });\n      } else\n        editor.decoratorState[mark] = !1;\n    }\n    if (editor.selection) {\n      const selection2 = editor.selection;\n      editor.selection = {\n        ...selection2\n      };\n    }\n  }\n}, deleteOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const at = operation.at ? toSlateRange({\n    context: {\n      schema: context.schema,\n      value: operation.editor.value,\n      selection: operation.at\n    },\n    blockIndexMap: operation.editor.blockIndexMap\n  }) : operation.editor.selection;\n  if (!at)\n    throw new Error(\"Unable to delete without a selection\");\n  const [start, end] = slate__WEBPACK_IMPORTED_MODULE_5__.Range.edges(at);\n  if (operation.unit === \"block\") {\n    const startBlockIndex = start.path.at(0), endBlockIndex = end.path.at(0);\n    if (startBlockIndex === void 0 || endBlockIndex === void 0)\n      throw new Error(\"Failed to get start or end block index\");\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(operation.editor, {\n      at: {\n        anchor: {\n          path: [startBlockIndex],\n          offset: 0\n        },\n        focus: {\n          path: [endBlockIndex],\n          offset: 0\n        }\n      },\n      mode: \"highest\"\n    });\n    return;\n  }\n  if (operation.unit === \"child\") {\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(operation.editor, {\n      at,\n      match: (node) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(context, node) && node._key !== VOID_CHILD_KEY || \"__inline\" in node && node.__inline === !0\n    });\n    return;\n  }\n  if (operation.direction === \"backward\" && operation.unit === \"line\") {\n    const parentBlockEntry = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.above(operation.editor, {\n      match: (n) => slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(n) && slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isBlock(operation.editor, n),\n      at\n    });\n    if (parentBlockEntry) {\n      const [, parentBlockPath] = parentBlockEntry, parentElementRange = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(operation.editor, parentBlockPath, at.anchor), currentLineRange = findCurrentLineRange(operation.editor, parentElementRange);\n      if (!slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(currentLineRange)) {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.delete(operation.editor, {\n          at: currentLineRange\n        });\n        return;\n      }\n    }\n  }\n  if (operation.unit === \"word\" && slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(at)) {\n    (0,slate__WEBPACK_IMPORTED_MODULE_5__.deleteText)(operation.editor, {\n      at,\n      unit: \"word\",\n      reverse: operation.direction === \"backward\"\n    });\n    return;\n  }\n  const startBlock = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.above(operation.editor, {\n    match: (n) => slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(n) && slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isBlock(operation.editor, n),\n    at: start,\n    voids: !1\n  }), endBlock = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.above(operation.editor, {\n    match: (n) => slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(n) && slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isBlock(operation.editor, n),\n    at: end,\n    voids: !1\n  }), isAcrossBlocks = startBlock && endBlock && !slate__WEBPACK_IMPORTED_MODULE_5__.Path.equals(startBlock[1], endBlock[1]), startNonEditable = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.void(operation.editor, {\n    at: start,\n    mode: \"highest\"\n  }) ?? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.elementReadOnly(operation.editor, {\n    at: start,\n    mode: \"highest\"\n  }), endNonEditable = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.void(operation.editor, {\n    at: end,\n    mode: \"highest\"\n  }) ?? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.elementReadOnly(operation.editor, {\n    at: end,\n    mode: \"highest\"\n  }), matches = [];\n  let lastPath;\n  for (const entry of slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(operation.editor, {\n    at,\n    voids: !1\n  })) {\n    const [node, path] = entry;\n    lastPath && slate__WEBPACK_IMPORTED_MODULE_5__.Path.compare(path, lastPath) === 0 || (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node) && (slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isVoid(operation.editor, node) || slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isElementReadOnly(operation.editor, node)) || !slate__WEBPACK_IMPORTED_MODULE_5__.Path.isCommon(path, start.path) && !slate__WEBPACK_IMPORTED_MODULE_5__.Path.isCommon(path, end.path)) && (matches.push(entry), lastPath = path);\n  }\n  const pathRefs = Array.from(matches, ([, path]) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.pathRef(operation.editor, path)), startRef = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.pointRef(operation.editor, start), endRef = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.pointRef(operation.editor, end);\n  if (startBlock && endBlock && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(start, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(operation.editor, startBlock[1])) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(end, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(operation.editor, endBlock[1])) && isAcrossBlocks && !startNonEditable && !endNonEditable) {\n    if (!startNonEditable) {\n      const point = startRef.current, [node] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.leaf(operation.editor, point);\n      node.text.length > 0 && operation.editor.apply({\n        type: \"remove_text\",\n        path: point.path,\n        offset: 0,\n        text: node.text\n      });\n    }\n    for (const pathRef of pathRefs.reverse()) {\n      const path = pathRef.unref();\n      path && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(operation.editor, {\n        at: path,\n        voids: !1\n      });\n    }\n    if (!endNonEditable) {\n      const point = endRef.current, [node] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.leaf(operation.editor, point), {\n        path\n      } = point, offset = 0, text = node.text.slice(offset, end.offset);\n      text.length > 0 && operation.editor.apply({\n        type: \"remove_text\",\n        path,\n        offset,\n        text\n      });\n    }\n    endRef.current && startRef.current && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(operation.editor, {\n      at: endRef.current,\n      voids: !1\n    });\n    return;\n  }\n  const reverse = operation.direction === \"backward\", hanging = reverse ? end ? (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, endBlock) ? end.offset === 0 : !0 : !1 : start ? (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, startBlock) ? start.offset === 0 : !0 : !1;\n  operation.at ? (0,slate__WEBPACK_IMPORTED_MODULE_5__.deleteText)(operation.editor, {\n    at,\n    hanging,\n    reverse\n  }) : (0,slate__WEBPACK_IMPORTED_MODULE_5__.deleteText)(operation.editor, {\n    hanging,\n    reverse\n  });\n};\nfunction findCurrentLineRange(editor, parentRange) {\n  const parentRangeBoundary = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Range.end(parentRange)), positions = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.positions(editor, {\n    at: parentRange\n  }));\n  let left = 0, right = positions.length, middle = Math.floor(right / 2);\n  if (rangesAreOnSameLine(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, positions[left]), parentRangeBoundary))\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, positions[left], parentRangeBoundary);\n  if (positions.length < 2)\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, positions[positions.length - 1], parentRangeBoundary);\n  for (; middle !== positions.length && middle !== left; )\n    rangesAreOnSameLine(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, positions[middle]), parentRangeBoundary) ? right = middle : left = middle, middle = Math.floor((left + right) / 2);\n  return slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, positions[left], parentRangeBoundary);\n}\nfunction rangesAreOnSameLine(editor, range1, range2) {\n  const rect1 = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMRange(editor, range1).getBoundingClientRect(), rect2 = slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMRange(editor, range2).getBoundingClientRect();\n  return domRectsIntersect(rect1, rect2) && domRectsIntersect(rect2, rect1);\n}\nfunction domRectsIntersect(rect, compareRect) {\n  const middle = (compareRect.top + compareRect.bottom) / 2;\n  return rect.top <= middle && rect.bottom >= middle;\n}\nfunction pluginRedoing(editor, fn) {\n  const prev = editor.isRedoing;\n  editor.isRedoing = !0, fn(), editor.isRedoing = prev;\n}\nfunction pluginWithoutHistory(editor, fn) {\n  const prev = editor.withHistory;\n  editor.withHistory = !1, fn(), editor.withHistory = prev;\n}\nfunction cloneDiff(diff2) {\n  const [type, patch] = diff2;\n  return [type, patch];\n}\nfunction getCommonOverlap(textA, textB) {\n  let text1 = textA, text2 = textB;\n  const text1Length = text1.length, text2Length = text2.length;\n  if (text1Length === 0 || text2Length === 0) return 0;\n  text1Length > text2Length ? text1 = text1.substring(text1Length - text2Length) : text1Length < text2Length && (text2 = text2.substring(0, text1Length));\n  const textLength = Math.min(text1Length, text2Length);\n  if (text1 === text2) return textLength;\n  let best = 0, length = 1;\n  for (let found = 0; found !== -1; ) {\n    const pattern = text1.substring(textLength - length);\n    if (found = text2.indexOf(pattern), found === -1) return best;\n    length += found, (found === 0 || text1.substring(textLength - length) === text2.substring(0, length)) && (best = length, length++);\n  }\n  return best;\n}\nfunction getCommonPrefix(text1, text2) {\n  if (!text1 || !text2 || text1[0] !== text2[0]) return 0;\n  let pointerMin = 0, pointerMax = Math.min(text1.length, text2.length), pointerMid = pointerMax, pointerStart = 0;\n  for (; pointerMin < pointerMid; ) text1.substring(pointerStart, pointerMid) === text2.substring(pointerStart, pointerMid) ? (pointerMin = pointerMid, pointerStart = pointerMin) : pointerMax = pointerMid, pointerMid = Math.floor((pointerMax - pointerMin) / 2 + pointerMin);\n  return pointerMid;\n}\nfunction getCommonSuffix(text1, text2) {\n  if (!text1 || !text2 || text1[text1.length - 1] !== text2[text2.length - 1]) return 0;\n  let pointerMin = 0, pointerMax = Math.min(text1.length, text2.length), pointerMid = pointerMax, pointerEnd = 0;\n  for (; pointerMin < pointerMid; ) text1.substring(text1.length - pointerMid, text1.length - pointerEnd) === text2.substring(text2.length - pointerMid, text2.length - pointerEnd) ? (pointerMin = pointerMid, pointerEnd = pointerMin) : pointerMax = pointerMid, pointerMid = Math.floor((pointerMax - pointerMin) / 2 + pointerMin);\n  return pointerMid;\n}\nfunction isHighSurrogate(char) {\n  const charCode = char.charCodeAt(0);\n  return charCode >= 55296 && charCode <= 56319;\n}\nfunction isLowSurrogate(char) {\n  const charCode = char.charCodeAt(0);\n  return charCode >= 56320 && charCode <= 57343;\n}\nfunction bisect(text1, text2, deadline) {\n  const text1Length = text1.length, text2Length = text2.length, maxD = Math.ceil((text1Length + text2Length) / 2), vOffset = maxD, vLength = 2 * maxD, v1 = new Array(vLength), v2 = new Array(vLength);\n  for (let x = 0; x < vLength; x++) v1[x] = -1, v2[x] = -1;\n  v1[vOffset + 1] = 0, v2[vOffset + 1] = 0;\n  const delta = text1Length - text2Length, front = delta % 2 !== 0;\n  let k1start = 0, k1end = 0, k2start = 0, k2end = 0;\n  for (let d = 0; d < maxD && !(Date.now() > deadline); d++) {\n    for (let k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n      const k1Offset = vOffset + k1;\n      let x1;\n      k1 === -d || k1 !== d && v1[k1Offset - 1] < v1[k1Offset + 1] ? x1 = v1[k1Offset + 1] : x1 = v1[k1Offset - 1] + 1;\n      let y1 = x1 - k1;\n      for (; x1 < text1Length && y1 < text2Length && text1.charAt(x1) === text2.charAt(y1); ) x1++, y1++;\n      if (v1[k1Offset] = x1, x1 > text1Length) k1end += 2;\n      else if (y1 > text2Length) k1start += 2;\n      else if (front) {\n        const k2Offset = vOffset + delta - k1;\n        if (k2Offset >= 0 && k2Offset < vLength && v2[k2Offset] !== -1) {\n          const x2 = text1Length - v2[k2Offset];\n          if (x1 >= x2) return bisectSplit(text1, text2, x1, y1, deadline);\n        }\n      }\n    }\n    for (let k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n      const k2Offset = vOffset + k2;\n      let x2;\n      k2 === -d || k2 !== d && v2[k2Offset - 1] < v2[k2Offset + 1] ? x2 = v2[k2Offset + 1] : x2 = v2[k2Offset - 1] + 1;\n      let y2 = x2 - k2;\n      for (; x2 < text1Length && y2 < text2Length && text1.charAt(text1Length - x2 - 1) === text2.charAt(text2Length - y2 - 1); ) x2++, y2++;\n      if (v2[k2Offset] = x2, x2 > text1Length) k2end += 2;\n      else if (y2 > text2Length) k2start += 2;\n      else if (!front) {\n        const k1Offset = vOffset + delta - k2;\n        if (k1Offset >= 0 && k1Offset < vLength && v1[k1Offset] !== -1) {\n          const x1 = v1[k1Offset], y1 = vOffset + x1 - k1Offset;\n          if (x2 = text1Length - x2, x1 >= x2) return bisectSplit(text1, text2, x1, y1, deadline);\n        }\n      }\n    }\n  }\n  return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n}\nfunction bisectSplit(text1, text2, x, y, deadline) {\n  const text1a = text1.substring(0, x), text2a = text2.substring(0, y), text1b = text1.substring(x), text2b = text2.substring(y), diffs = doDiff(text1a, text2a, {\n    checkLines: !1,\n    deadline\n  }), diffsb = doDiff(text1b, text2b, {\n    checkLines: !1,\n    deadline\n  });\n  return diffs.concat(diffsb);\n}\nfunction findHalfMatch(text1, text2, timeout = 1) {\n  if (timeout <= 0) return null;\n  const longText = text1.length > text2.length ? text1 : text2, shortText = text1.length > text2.length ? text2 : text1;\n  if (longText.length < 4 || shortText.length * 2 < longText.length) return null;\n  const halfMatch1 = halfMatchI(longText, shortText, Math.ceil(longText.length / 4)), halfMatch2 = halfMatchI(longText, shortText, Math.ceil(longText.length / 2));\n  let halfMatch;\n  if (halfMatch1 && halfMatch2) halfMatch = halfMatch1[4].length > halfMatch2[4].length ? halfMatch1 : halfMatch2;\n  else {\n    if (!halfMatch1 && !halfMatch2) return null;\n    halfMatch2 ? halfMatch1 || (halfMatch = halfMatch2) : halfMatch = halfMatch1;\n  }\n  if (!halfMatch) throw new Error(\"Unable to find a half match.\");\n  let text1A, text1B, text2A, text2B;\n  text1.length > text2.length ? (text1A = halfMatch[0], text1B = halfMatch[1], text2A = halfMatch[2], text2B = halfMatch[3]) : (text2A = halfMatch[0], text2B = halfMatch[1], text1A = halfMatch[2], text1B = halfMatch[3]);\n  const midCommon = halfMatch[4];\n  return [text1A, text1B, text2A, text2B, midCommon];\n}\nfunction halfMatchI(longText, shortText, i) {\n  const seed = longText.slice(i, i + Math.floor(longText.length / 4));\n  let j = -1, bestCommon = \"\", bestLongTextA, bestLongTextB, bestShortTextA, bestShortTextB;\n  for (; (j = shortText.indexOf(seed, j + 1)) !== -1; ) {\n    const prefixLength = getCommonPrefix(longText.slice(i), shortText.slice(j)), suffixLength = getCommonSuffix(longText.slice(0, i), shortText.slice(0, j));\n    bestCommon.length < suffixLength + prefixLength && (bestCommon = shortText.slice(j - suffixLength, j) + shortText.slice(j, j + prefixLength), bestLongTextA = longText.slice(0, i - suffixLength), bestLongTextB = longText.slice(i + prefixLength), bestShortTextA = shortText.slice(0, j - suffixLength), bestShortTextB = shortText.slice(j + prefixLength));\n  }\n  return bestCommon.length * 2 >= longText.length ? [bestLongTextA || \"\", bestLongTextB || \"\", bestShortTextA || \"\", bestShortTextB || \"\", bestCommon || \"\"] : null;\n}\nfunction charsToLines(diffs, lineArray) {\n  for (let x = 0; x < diffs.length; x++) {\n    const chars = diffs[x][1], text = [];\n    for (let y = 0; y < chars.length; y++) text[y] = lineArray[chars.charCodeAt(y)];\n    diffs[x][1] = text.join(\"\");\n  }\n}\nfunction linesToChars(textA, textB) {\n  const lineArray = [], lineHash = {};\n  lineArray[0] = \"\";\n  function diffLinesToMunge(text) {\n    let chars = \"\", lineStart = 0, lineEnd = -1, lineArrayLength = lineArray.length;\n    for (; lineEnd < text.length - 1; ) {\n      lineEnd = text.indexOf(`\n`, lineStart), lineEnd === -1 && (lineEnd = text.length - 1);\n      let line = text.slice(lineStart, lineEnd + 1);\n      (lineHash.hasOwnProperty ? lineHash.hasOwnProperty(line) : lineHash[line] !== void 0) ? chars += String.fromCharCode(lineHash[line]) : (lineArrayLength === maxLines && (line = text.slice(lineStart), lineEnd = text.length), chars += String.fromCharCode(lineArrayLength), lineHash[line] = lineArrayLength, lineArray[lineArrayLength++] = line), lineStart = lineEnd + 1;\n    }\n    return chars;\n  }\n  let maxLines = 4e4;\n  const chars1 = diffLinesToMunge(textA);\n  maxLines = 65535;\n  const chars2 = diffLinesToMunge(textB);\n  return {\n    chars1,\n    chars2,\n    lineArray\n  };\n}\nfunction doLineModeDiff(textA, textB, opts) {\n  let text1 = textA, text2 = textB;\n  const a = linesToChars(text1, text2);\n  text1 = a.chars1, text2 = a.chars2;\n  const linearray = a.lineArray;\n  let diffs = doDiff(text1, text2, {\n    checkLines: !1,\n    deadline: opts.deadline\n  });\n  charsToLines(diffs, linearray), diffs = cleanupSemantic(diffs), diffs.push([DIFF_EQUAL, \"\"]);\n  let pointer = 0, countDelete = 0, countInsert = 0, textDelete = \"\", textInsert = \"\";\n  for (; pointer < diffs.length; ) {\n    switch (diffs[pointer][0]) {\n      case DIFF_INSERT:\n        countInsert++, textInsert += diffs[pointer][1];\n        break;\n      case DIFF_DELETE:\n        countDelete++, textDelete += diffs[pointer][1];\n        break;\n      case DIFF_EQUAL:\n        if (countDelete >= 1 && countInsert >= 1) {\n          diffs.splice(pointer - countDelete - countInsert, countDelete + countInsert), pointer = pointer - countDelete - countInsert;\n          const aa = doDiff(textDelete, textInsert, {\n            checkLines: !1,\n            deadline: opts.deadline\n          });\n          for (let j = aa.length - 1; j >= 0; j--) diffs.splice(pointer, 0, aa[j]);\n          pointer += aa.length;\n        }\n        countInsert = 0, countDelete = 0, textDelete = \"\", textInsert = \"\";\n        break;\n      default:\n        throw new Error(\"Unknown diff operation.\");\n    }\n    pointer++;\n  }\n  return diffs.pop(), diffs;\n}\nfunction computeDiff(text1, text2, opts) {\n  let diffs;\n  if (!text1) return [[DIFF_INSERT, text2]];\n  if (!text2) return [[DIFF_DELETE, text1]];\n  const longtext = text1.length > text2.length ? text1 : text2, shorttext = text1.length > text2.length ? text2 : text1, i = longtext.indexOf(shorttext);\n  if (i !== -1) return diffs = [[DIFF_INSERT, longtext.substring(0, i)], [DIFF_EQUAL, shorttext], [DIFF_INSERT, longtext.substring(i + shorttext.length)]], text1.length > text2.length && (diffs[0][0] = DIFF_DELETE, diffs[2][0] = DIFF_DELETE), diffs;\n  if (shorttext.length === 1) return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n  const halfMatch = findHalfMatch(text1, text2);\n  if (halfMatch) {\n    const text1A = halfMatch[0], text1B = halfMatch[1], text2A = halfMatch[2], text2B = halfMatch[3], midCommon = halfMatch[4], diffsA = doDiff(text1A, text2A, opts), diffsB = doDiff(text1B, text2B, opts);\n    return diffsA.concat([[DIFF_EQUAL, midCommon]], diffsB);\n  }\n  return opts.checkLines && text1.length > 100 && text2.length > 100 ? doLineModeDiff(text1, text2, opts) : bisect(text1, text2, opts.deadline);\n}\nvar __defProp$2 = Object.defineProperty, __getOwnPropSymbols$2 = Object.getOwnPropertySymbols, __hasOwnProp$2 = Object.prototype.hasOwnProperty, __propIsEnum$2 = Object.prototype.propertyIsEnumerable, __defNormalProp$2 = (obj, key, value) => key in obj ? __defProp$2(obj, key, {\n  enumerable: !0,\n  configurable: !0,\n  writable: !0,\n  value\n}) : obj[key] = value, __spreadValues$2 = (a, b) => {\n  for (var prop in b || (b = {})) __hasOwnProp$2.call(b, prop) && __defNormalProp$2(a, prop, b[prop]);\n  if (__getOwnPropSymbols$2) for (var prop of __getOwnPropSymbols$2(b)) __propIsEnum$2.call(b, prop) && __defNormalProp$2(a, prop, b[prop]);\n  return a;\n};\nconst DIFF_DELETE = -1, DIFF_INSERT = 1, DIFF_EQUAL = 0;\nfunction diff(textA, textB, opts) {\n  if (textA === null || textB === null) throw new Error(\"Null input. (diff)\");\n  const diffs = doDiff(textA, textB, createInternalOpts(opts || {}));\n  return adjustDiffForSurrogatePairs(diffs), diffs;\n}\nfunction doDiff(textA, textB, options) {\n  let text1 = textA, text2 = textB;\n  if (text1 === text2) return text1 ? [[DIFF_EQUAL, text1]] : [];\n  let commonlength = getCommonPrefix(text1, text2);\n  const commonprefix = text1.substring(0, commonlength);\n  text1 = text1.substring(commonlength), text2 = text2.substring(commonlength), commonlength = getCommonSuffix(text1, text2);\n  const commonsuffix = text1.substring(text1.length - commonlength);\n  text1 = text1.substring(0, text1.length - commonlength), text2 = text2.substring(0, text2.length - commonlength);\n  let diffs = computeDiff(text1, text2, options);\n  return commonprefix && diffs.unshift([DIFF_EQUAL, commonprefix]), commonsuffix && diffs.push([DIFF_EQUAL, commonsuffix]), diffs = cleanupMerge(diffs), diffs;\n}\nfunction createDeadLine(timeout) {\n  let t = 1;\n  return typeof timeout < \"u\" && (t = timeout <= 0 ? Number.MAX_VALUE : timeout), Date.now() + t * 1e3;\n}\nfunction createInternalOpts(opts) {\n  return __spreadValues$2({\n    checkLines: !0,\n    deadline: createDeadLine(opts.timeout || 1)\n  }, opts);\n}\nfunction combineChar(data, char, dir) {\n  return dir === 1 ? data + char : char + data;\n}\nfunction splitChar(data, dir) {\n  return dir === 1 ? [data.substring(0, data.length - 1), data[data.length - 1]] : [data.substring(1), data[0]];\n}\nfunction hasSharedChar(diffs, i, j, dir) {\n  return dir === 1 ? diffs[i][1][diffs[i][1].length - 1] === diffs[j][1][diffs[j][1].length - 1] : diffs[i][1][0] === diffs[j][1][0];\n}\nfunction deisolateChar(diffs, i, dir) {\n  const inv = dir === 1 ? -1 : 1;\n  let insertIdx = null, deleteIdx = null, j = i + dir;\n  for (; j >= 0 && j < diffs.length && (insertIdx === null || deleteIdx === null); j += dir) {\n    const [op, text2] = diffs[j];\n    if (text2.length !== 0) {\n      if (op === DIFF_INSERT) {\n        insertIdx === null && (insertIdx = j);\n        continue;\n      } else if (op === DIFF_DELETE) {\n        deleteIdx === null && (deleteIdx = j);\n        continue;\n      } else if (op === DIFF_EQUAL) {\n        if (insertIdx === null && deleteIdx === null) {\n          const [rest, char2] = splitChar(diffs[i][1], dir);\n          diffs[i][1] = rest, diffs[j][1] = combineChar(diffs[j][1], char2, inv);\n          return;\n        }\n        break;\n      }\n    }\n  }\n  if (insertIdx !== null && deleteIdx !== null && hasSharedChar(diffs, insertIdx, deleteIdx, dir)) {\n    const [insertText, insertChar] = splitChar(diffs[insertIdx][1], inv), [deleteText2] = splitChar(diffs[deleteIdx][1], inv);\n    diffs[insertIdx][1] = insertText, diffs[deleteIdx][1] = deleteText2, diffs[i][1] = combineChar(diffs[i][1], insertChar, dir);\n    return;\n  }\n  const [text, char] = splitChar(diffs[i][1], dir);\n  diffs[i][1] = text, insertIdx === null ? (diffs.splice(j, 0, [DIFF_INSERT, char]), deleteIdx !== null && deleteIdx >= j && deleteIdx++) : diffs[insertIdx][1] = combineChar(diffs[insertIdx][1], char, inv), deleteIdx === null ? diffs.splice(j, 0, [DIFF_DELETE, char]) : diffs[deleteIdx][1] = combineChar(diffs[deleteIdx][1], char, inv);\n}\nfunction adjustDiffForSurrogatePairs(diffs) {\n  for (let i = 0; i < diffs.length; i++) {\n    const [diffType, diffText] = diffs[i];\n    if (diffText.length === 0) continue;\n    const firstChar = diffText[0], lastChar = diffText[diffText.length - 1];\n    isHighSurrogate(lastChar) && diffType === DIFF_EQUAL && deisolateChar(diffs, i, 1), isLowSurrogate(firstChar) && diffType === DIFF_EQUAL && deisolateChar(diffs, i, -1);\n  }\n  for (let i = 0; i < diffs.length; i++) diffs[i][1].length === 0 && diffs.splice(i, 1);\n}\nfunction cleanupSemantic(rawDiffs) {\n  let diffs = rawDiffs.map((diff2) => cloneDiff(diff2)), hasChanges = !1;\n  const equalities = [];\n  let equalitiesLength = 0, lastEquality = null, pointer = 0, lengthInsertions1 = 0, lengthDeletions1 = 0, lengthInsertions2 = 0, lengthDeletions2 = 0;\n  for (; pointer < diffs.length; ) diffs[pointer][0] === DIFF_EQUAL ? (equalities[equalitiesLength++] = pointer, lengthInsertions1 = lengthInsertions2, lengthDeletions1 = lengthDeletions2, lengthInsertions2 = 0, lengthDeletions2 = 0, lastEquality = diffs[pointer][1]) : (diffs[pointer][0] === DIFF_INSERT ? lengthInsertions2 += diffs[pointer][1].length : lengthDeletions2 += diffs[pointer][1].length, lastEquality && lastEquality.length <= Math.max(lengthInsertions1, lengthDeletions1) && lastEquality.length <= Math.max(lengthInsertions2, lengthDeletions2) && (diffs.splice(equalities[equalitiesLength - 1], 0, [DIFF_DELETE, lastEquality]), diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT, equalitiesLength--, equalitiesLength--, pointer = equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1, lengthInsertions1 = 0, lengthDeletions1 = 0, lengthInsertions2 = 0, lengthDeletions2 = 0, lastEquality = null, hasChanges = !0)), pointer++;\n  for (hasChanges && (diffs = cleanupMerge(diffs)), diffs = cleanupSemanticLossless(diffs), pointer = 1; pointer < diffs.length; ) {\n    if (diffs[pointer - 1][0] === DIFF_DELETE && diffs[pointer][0] === DIFF_INSERT) {\n      const deletion = diffs[pointer - 1][1], insertion = diffs[pointer][1], overlapLength1 = getCommonOverlap(deletion, insertion), overlapLength2 = getCommonOverlap(insertion, deletion);\n      overlapLength1 >= overlapLength2 ? (overlapLength1 >= deletion.length / 2 || overlapLength1 >= insertion.length / 2) && (diffs.splice(pointer, 0, [DIFF_EQUAL, insertion.substring(0, overlapLength1)]), diffs[pointer - 1][1] = deletion.substring(0, deletion.length - overlapLength1), diffs[pointer + 1][1] = insertion.substring(overlapLength1), pointer++) : (overlapLength2 >= deletion.length / 2 || overlapLength2 >= insertion.length / 2) && (diffs.splice(pointer, 0, [DIFF_EQUAL, deletion.substring(0, overlapLength2)]), diffs[pointer - 1][0] = DIFF_INSERT, diffs[pointer - 1][1] = insertion.substring(0, insertion.length - overlapLength2), diffs[pointer + 1][0] = DIFF_DELETE, diffs[pointer + 1][1] = deletion.substring(overlapLength2), pointer++), pointer++;\n    }\n    pointer++;\n  }\n  return diffs;\n}\nconst nonAlphaNumericRegex = /[^a-zA-Z0-9]/, whitespaceRegex = /\\s/, linebreakRegex = /[\\r\\n]/, blanklineEndRegex = /\\n\\r?\\n$/, blanklineStartRegex = /^\\r?\\n\\r?\\n/;\nfunction cleanupSemanticLossless(rawDiffs) {\n  const diffs = rawDiffs.map((diff2) => cloneDiff(diff2));\n  function diffCleanupSemanticScore(one, two) {\n    if (!one || !two) return 6;\n    const char1 = one.charAt(one.length - 1), char2 = two.charAt(0), nonAlphaNumeric1 = char1.match(nonAlphaNumericRegex), nonAlphaNumeric2 = char2.match(nonAlphaNumericRegex), whitespace1 = nonAlphaNumeric1 && char1.match(whitespaceRegex), whitespace2 = nonAlphaNumeric2 && char2.match(whitespaceRegex), lineBreak1 = whitespace1 && char1.match(linebreakRegex), lineBreak2 = whitespace2 && char2.match(linebreakRegex), blankLine1 = lineBreak1 && one.match(blanklineEndRegex), blankLine2 = lineBreak2 && two.match(blanklineStartRegex);\n    return blankLine1 || blankLine2 ? 5 : lineBreak1 || lineBreak2 ? 4 : nonAlphaNumeric1 && !whitespace1 && whitespace2 ? 3 : whitespace1 || whitespace2 ? 2 : nonAlphaNumeric1 || nonAlphaNumeric2 ? 1 : 0;\n  }\n  let pointer = 1;\n  for (; pointer < diffs.length - 1; ) {\n    if (diffs[pointer - 1][0] === DIFF_EQUAL && diffs[pointer + 1][0] === DIFF_EQUAL) {\n      let equality1 = diffs[pointer - 1][1], edit = diffs[pointer][1], equality2 = diffs[pointer + 1][1];\n      const commonOffset = getCommonSuffix(equality1, edit);\n      if (commonOffset) {\n        const commonString = edit.substring(edit.length - commonOffset);\n        equality1 = equality1.substring(0, equality1.length - commonOffset), edit = commonString + edit.substring(0, edit.length - commonOffset), equality2 = commonString + equality2;\n      }\n      let bestEquality1 = equality1, bestEdit = edit, bestEquality2 = equality2, bestScore = diffCleanupSemanticScore(equality1, edit) + diffCleanupSemanticScore(edit, equality2);\n      for (; edit.charAt(0) === equality2.charAt(0); ) {\n        equality1 += edit.charAt(0), edit = edit.substring(1) + equality2.charAt(0), equality2 = equality2.substring(1);\n        const score = diffCleanupSemanticScore(equality1, edit) + diffCleanupSemanticScore(edit, equality2);\n        score >= bestScore && (bestScore = score, bestEquality1 = equality1, bestEdit = edit, bestEquality2 = equality2);\n      }\n      diffs[pointer - 1][1] !== bestEquality1 && (bestEquality1 ? diffs[pointer - 1][1] = bestEquality1 : (diffs.splice(pointer - 1, 1), pointer--), diffs[pointer][1] = bestEdit, bestEquality2 ? diffs[pointer + 1][1] = bestEquality2 : (diffs.splice(pointer + 1, 1), pointer--));\n    }\n    pointer++;\n  }\n  return diffs;\n}\nfunction cleanupMerge(rawDiffs) {\n  let diffs = rawDiffs.map((diff2) => cloneDiff(diff2));\n  diffs.push([DIFF_EQUAL, \"\"]);\n  let pointer = 0, countDelete = 0, countInsert = 0, textDelete = \"\", textInsert = \"\", commonlength;\n  for (; pointer < diffs.length; ) switch (diffs[pointer][0]) {\n    case DIFF_INSERT:\n      countInsert++, textInsert += diffs[pointer][1], pointer++;\n      break;\n    case DIFF_DELETE:\n      countDelete++, textDelete += diffs[pointer][1], pointer++;\n      break;\n    case DIFF_EQUAL:\n      countDelete + countInsert > 1 ? (countDelete !== 0 && countInsert !== 0 && (commonlength = getCommonPrefix(textInsert, textDelete), commonlength !== 0 && (pointer - countDelete - countInsert > 0 && diffs[pointer - countDelete - countInsert - 1][0] === DIFF_EQUAL ? diffs[pointer - countDelete - countInsert - 1][1] += textInsert.substring(0, commonlength) : (diffs.splice(0, 0, [DIFF_EQUAL, textInsert.substring(0, commonlength)]), pointer++), textInsert = textInsert.substring(commonlength), textDelete = textDelete.substring(commonlength)), commonlength = getCommonSuffix(textInsert, textDelete), commonlength !== 0 && (diffs[pointer][1] = textInsert.substring(textInsert.length - commonlength) + diffs[pointer][1], textInsert = textInsert.substring(0, textInsert.length - commonlength), textDelete = textDelete.substring(0, textDelete.length - commonlength))), pointer -= countDelete + countInsert, diffs.splice(pointer, countDelete + countInsert), textDelete.length && (diffs.splice(pointer, 0, [DIFF_DELETE, textDelete]), pointer++), textInsert.length && (diffs.splice(pointer, 0, [DIFF_INSERT, textInsert]), pointer++), pointer++) : pointer !== 0 && diffs[pointer - 1][0] === DIFF_EQUAL ? (diffs[pointer - 1][1] += diffs[pointer][1], diffs.splice(pointer, 1)) : pointer++, countInsert = 0, countDelete = 0, textDelete = \"\", textInsert = \"\";\n      break;\n    default:\n      throw new Error(\"Unknown diff operation\");\n  }\n  diffs[diffs.length - 1][1] === \"\" && diffs.pop();\n  let hasChanges = !1;\n  for (pointer = 1; pointer < diffs.length - 1; ) diffs[pointer - 1][0] === DIFF_EQUAL && diffs[pointer + 1][0] === DIFF_EQUAL && (diffs[pointer][1].substring(diffs[pointer][1].length - diffs[pointer - 1][1].length) === diffs[pointer - 1][1] ? (diffs[pointer][1] = diffs[pointer - 1][1] + diffs[pointer][1].substring(0, diffs[pointer][1].length - diffs[pointer - 1][1].length), diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1], diffs.splice(pointer - 1, 1), hasChanges = !0) : diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) === diffs[pointer + 1][1] && (diffs[pointer - 1][1] += diffs[pointer + 1][1], diffs[pointer][1] = diffs[pointer][1].substring(diffs[pointer + 1][1].length) + diffs[pointer + 1][1], diffs.splice(pointer + 1, 1), hasChanges = !0)), pointer++;\n  return hasChanges && (diffs = cleanupMerge(diffs)), diffs;\n}\nfunction trueCount(...args) {\n  return args.reduce((n, bool) => n + (bool ? 1 : 0), 0);\n}\nfunction cleanupEfficiency(rawDiffs, editCost = 4) {\n  let diffs = rawDiffs.map((diff2) => cloneDiff(diff2)), hasChanges = !1;\n  const equalities = [];\n  let equalitiesLength = 0, lastEquality = null, pointer = 0, preIns = !1, preDel = !1, postIns = !1, postDel = !1;\n  for (; pointer < diffs.length; ) diffs[pointer][0] === DIFF_EQUAL ? (diffs[pointer][1].length < editCost && (postIns || postDel) ? (equalities[equalitiesLength++] = pointer, preIns = postIns, preDel = postDel, lastEquality = diffs[pointer][1]) : (equalitiesLength = 0, lastEquality = null), postIns = !1, postDel = !1) : (diffs[pointer][0] === DIFF_DELETE ? postDel = !0 : postIns = !0, lastEquality && (preIns && preDel && postIns && postDel || lastEquality.length < editCost / 2 && trueCount(preIns, preDel, postIns, postDel) === 3) && (diffs.splice(equalities[equalitiesLength - 1], 0, [DIFF_DELETE, lastEquality]), diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT, equalitiesLength--, lastEquality = null, preIns && preDel ? (postIns = !0, postDel = !0, equalitiesLength = 0) : (equalitiesLength--, pointer = equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1, postIns = !1, postDel = !1), hasChanges = !0)), pointer++;\n  return hasChanges && (diffs = cleanupMerge(diffs)), diffs;\n}\nvar __defProp$1 = Object.defineProperty, __getOwnPropSymbols$1 = Object.getOwnPropertySymbols, __hasOwnProp$1 = Object.prototype.hasOwnProperty, __propIsEnum$1 = Object.prototype.propertyIsEnumerable, __defNormalProp$1 = (obj, key, value) => key in obj ? __defProp$1(obj, key, {\n  enumerable: !0,\n  configurable: !0,\n  writable: !0,\n  value\n}) : obj[key] = value, __spreadValues$1 = (a, b) => {\n  for (var prop in b || (b = {})) __hasOwnProp$1.call(b, prop) && __defNormalProp$1(a, prop, b[prop]);\n  if (__getOwnPropSymbols$1) for (var prop of __getOwnPropSymbols$1(b)) __propIsEnum$1.call(b, prop) && __defNormalProp$1(a, prop, b[prop]);\n  return a;\n};\nconst DEFAULT_OPTIONS = {\n  /**\n   * At what point is no match declared (0.0 = perfection, 1.0 = very loose).\n   */\n  threshold: 0.5,\n  /**\n   * How far to search for a match (0 = exact location, 1000+ = broad match).\n   * A match this many characters away from the expected location will add\n   * 1.0 to the score (0.0 is a perfect match).\n   */\n  distance: 1e3\n};\nfunction applyDefaults(options) {\n  return __spreadValues$1(__spreadValues$1({}, DEFAULT_OPTIONS), options);\n}\nconst MAX_BITS$1 = 32;\nfunction bitap(text, pattern, loc, opts = {}) {\n  if (pattern.length > MAX_BITS$1) throw new Error(\"Pattern too long for this browser.\");\n  const options = applyDefaults(opts), s = getAlphabetFromPattern(pattern);\n  function getBitapScore(e, x) {\n    const accuracy = e / pattern.length, proximity = Math.abs(loc - x);\n    return options.distance ? accuracy + proximity / options.distance : proximity ? 1 : accuracy;\n  }\n  let scoreThreshold = options.threshold, bestLoc = text.indexOf(pattern, loc);\n  bestLoc !== -1 && (scoreThreshold = Math.min(getBitapScore(0, bestLoc), scoreThreshold), bestLoc = text.lastIndexOf(pattern, loc + pattern.length), bestLoc !== -1 && (scoreThreshold = Math.min(getBitapScore(0, bestLoc), scoreThreshold)));\n  const matchmask = 1 << pattern.length - 1;\n  bestLoc = -1;\n  let binMin, binMid, binMax = pattern.length + text.length, lastRd = [];\n  for (let d = 0; d < pattern.length; d++) {\n    for (binMin = 0, binMid = binMax; binMin < binMid; ) getBitapScore(d, loc + binMid) <= scoreThreshold ? binMin = binMid : binMax = binMid, binMid = Math.floor((binMax - binMin) / 2 + binMin);\n    binMax = binMid;\n    let start = Math.max(1, loc - binMid + 1);\n    const finish = Math.min(loc + binMid, text.length) + pattern.length, rd = new Array(finish + 2);\n    rd[finish + 1] = (1 << d) - 1;\n    for (let j = finish; j >= start; j--) {\n      const charMatch = s[text.charAt(j - 1)];\n      if (d === 0 ? rd[j] = (rd[j + 1] << 1 | 1) & charMatch : rd[j] = (rd[j + 1] << 1 | 1) & charMatch | ((lastRd[j + 1] | lastRd[j]) << 1 | 1) | lastRd[j + 1], rd[j] & matchmask) {\n        const score = getBitapScore(d, j - 1);\n        if (score <= scoreThreshold) if (scoreThreshold = score, bestLoc = j - 1, bestLoc > loc) start = Math.max(1, 2 * loc - bestLoc);\n        else break;\n      }\n    }\n    if (getBitapScore(d + 1, loc) > scoreThreshold) break;\n    lastRd = rd;\n  }\n  return bestLoc;\n}\nfunction getAlphabetFromPattern(pattern) {\n  const s = {};\n  for (let i = 0; i < pattern.length; i++) s[pattern.charAt(i)] = 0;\n  for (let i = 0; i < pattern.length; i++) s[pattern.charAt(i)] |= 1 << pattern.length - i - 1;\n  return s;\n}\nfunction match(text, pattern, searchLocation, options = {}) {\n  if (text === null || pattern === null || searchLocation === null) throw new Error(\"Null input. (match())\");\n  const loc = Math.max(0, Math.min(searchLocation, text.length));\n  if (text === pattern) return 0;\n  if (text.length) {\n    if (text.substring(loc, loc + pattern.length) === pattern) return loc;\n  } else return -1;\n  return bitap(text, pattern, loc, options);\n}\nfunction diffText1(diffs) {\n  const text = [];\n  for (let x = 0; x < diffs.length; x++) diffs[x][0] !== DIFF_INSERT && (text[x] = diffs[x][1]);\n  return text.join(\"\");\n}\nfunction diffText2(diffs) {\n  const text = [];\n  for (let x = 0; x < diffs.length; x++) diffs[x][0] !== DIFF_DELETE && (text[x] = diffs[x][1]);\n  return text.join(\"\");\n}\nfunction levenshtein(diffs) {\n  let leven = 0, insertions = 0, deletions = 0;\n  for (let x = 0; x < diffs.length; x++) {\n    const op = diffs[x][0], data = diffs[x][1];\n    switch (op) {\n      case DIFF_INSERT:\n        insertions += data.length;\n        break;\n      case DIFF_DELETE:\n        deletions += data.length;\n        break;\n      case DIFF_EQUAL:\n        leven += Math.max(insertions, deletions), insertions = 0, deletions = 0;\n        break;\n      default:\n        throw new Error(\"Unknown diff operation.\");\n    }\n  }\n  return leven += Math.max(insertions, deletions), leven;\n}\nfunction xIndex(diffs, location) {\n  let chars1 = 0, chars2 = 0, lastChars1 = 0, lastChars2 = 0, x;\n  for (x = 0; x < diffs.length && (diffs[x][0] !== DIFF_INSERT && (chars1 += diffs[x][1].length), diffs[x][0] !== DIFF_DELETE && (chars2 += diffs[x][1].length), !(chars1 > location)); x++) lastChars1 = chars1, lastChars2 = chars2;\n  return diffs.length !== x && diffs[x][0] === DIFF_DELETE ? lastChars2 : lastChars2 + (location - lastChars1);\n}\nfunction countUtf8Bytes(str) {\n  let bytes = 0;\n  for (let i = 0; i < str.length; i++) {\n    const codePoint = str.codePointAt(i);\n    if (typeof codePoint > \"u\") throw new Error(\"Failed to get codepoint\");\n    bytes += utf8len(codePoint);\n  }\n  return bytes;\n}\nfunction adjustIndiciesToUcs2(patches, base, options = {}) {\n  let byteOffset = 0, idx = 0;\n  function advanceTo(target) {\n    for (; byteOffset < target; ) {\n      const codePoint = base.codePointAt(idx);\n      if (typeof codePoint > \"u\") return idx;\n      byteOffset += utf8len(codePoint), codePoint > 65535 ? idx += 2 : idx += 1;\n    }\n    if (!options.allowExceedingIndices && byteOffset !== target) throw new Error(\"Failed to determine byte offset\");\n    return idx;\n  }\n  const adjusted = [];\n  for (const patch of patches) adjusted.push({\n    diffs: patch.diffs.map((diff2) => cloneDiff(diff2)),\n    start1: advanceTo(patch.start1),\n    start2: advanceTo(patch.start2),\n    utf8Start1: patch.utf8Start1,\n    utf8Start2: patch.utf8Start2,\n    length1: patch.length1,\n    length2: patch.length2,\n    utf8Length1: patch.utf8Length1,\n    utf8Length2: patch.utf8Length2\n  });\n  return adjusted;\n}\nfunction utf8len(codePoint) {\n  return codePoint <= 127 ? 1 : codePoint <= 2047 ? 2 : codePoint <= 65535 ? 3 : 4;\n}\nconst MAX_BITS = 32, DEFAULT_MARGIN = 4;\nfunction addPadding(patches, margin = DEFAULT_MARGIN) {\n  const paddingLength = margin;\n  let nullPadding = \"\";\n  for (let x = 1; x <= paddingLength; x++) nullPadding += String.fromCharCode(x);\n  for (const p of patches) p.start1 += paddingLength, p.start2 += paddingLength, p.utf8Start1 += paddingLength, p.utf8Start2 += paddingLength;\n  let patch = patches[0], diffs = patch.diffs;\n  if (diffs.length === 0 || diffs[0][0] !== DIFF_EQUAL) diffs.unshift([DIFF_EQUAL, nullPadding]), patch.start1 -= paddingLength, patch.start2 -= paddingLength, patch.utf8Start1 -= paddingLength, patch.utf8Start2 -= paddingLength, patch.length1 += paddingLength, patch.length2 += paddingLength, patch.utf8Length1 += paddingLength, patch.utf8Length2 += paddingLength;\n  else if (paddingLength > diffs[0][1].length) {\n    const firstDiffLength = diffs[0][1].length, extraLength = paddingLength - firstDiffLength;\n    diffs[0][1] = nullPadding.substring(firstDiffLength) + diffs[0][1], patch.start1 -= extraLength, patch.start2 -= extraLength, patch.utf8Start1 -= extraLength, patch.utf8Start2 -= extraLength, patch.length1 += extraLength, patch.length2 += extraLength, patch.utf8Length1 += extraLength, patch.utf8Length2 += extraLength;\n  }\n  if (patch = patches[patches.length - 1], diffs = patch.diffs, diffs.length === 0 || diffs[diffs.length - 1][0] !== DIFF_EQUAL) diffs.push([DIFF_EQUAL, nullPadding]), patch.length1 += paddingLength, patch.length2 += paddingLength, patch.utf8Length1 += paddingLength, patch.utf8Length2 += paddingLength;\n  else if (paddingLength > diffs[diffs.length - 1][1].length) {\n    const extraLength = paddingLength - diffs[diffs.length - 1][1].length;\n    diffs[diffs.length - 1][1] += nullPadding.substring(0, extraLength), patch.length1 += extraLength, patch.length2 += extraLength, patch.utf8Length1 += extraLength, patch.utf8Length2 += extraLength;\n  }\n  return nullPadding;\n}\nfunction createPatchObject(start1, start2) {\n  return {\n    diffs: [],\n    start1,\n    start2,\n    utf8Start1: start1,\n    utf8Start2: start2,\n    length1: 0,\n    length2: 0,\n    utf8Length1: 0,\n    utf8Length2: 0\n  };\n}\nfunction splitMax(patches, margin = DEFAULT_MARGIN) {\n  const patchSize = MAX_BITS;\n  for (let x = 0; x < patches.length; x++) {\n    if (patches[x].length1 <= patchSize) continue;\n    const bigpatch = patches[x];\n    patches.splice(x--, 1);\n    let start1 = bigpatch.start1, start2 = bigpatch.start2, preContext = \"\";\n    for (; bigpatch.diffs.length !== 0; ) {\n      const patch = createPatchObject(start1 - preContext.length, start2 - preContext.length);\n      let empty = !0;\n      if (preContext !== \"\") {\n        const precontextByteCount = countUtf8Bytes(preContext);\n        patch.length1 = preContext.length, patch.utf8Length1 = precontextByteCount, patch.length2 = preContext.length, patch.utf8Length2 = precontextByteCount, patch.diffs.push([DIFF_EQUAL, preContext]);\n      }\n      for (; bigpatch.diffs.length !== 0 && patch.length1 < patchSize - margin; ) {\n        const diffType = bigpatch.diffs[0][0];\n        let diffText = bigpatch.diffs[0][1], diffTextByteCount = countUtf8Bytes(diffText);\n        if (diffType === DIFF_INSERT) {\n          patch.length2 += diffText.length, patch.utf8Length2 += diffTextByteCount, start2 += diffText.length;\n          const diff2 = bigpatch.diffs.shift();\n          diff2 && patch.diffs.push(diff2), empty = !1;\n        } else diffType === DIFF_DELETE && patch.diffs.length === 1 && patch.diffs[0][0] === DIFF_EQUAL && diffText.length > 2 * patchSize ? (patch.length1 += diffText.length, patch.utf8Length1 += diffTextByteCount, start1 += diffText.length, empty = !1, patch.diffs.push([diffType, diffText]), bigpatch.diffs.shift()) : (diffText = diffText.substring(0, patchSize - patch.length1 - margin), diffTextByteCount = countUtf8Bytes(diffText), patch.length1 += diffText.length, patch.utf8Length1 += diffTextByteCount, start1 += diffText.length, diffType === DIFF_EQUAL ? (patch.length2 += diffText.length, patch.utf8Length2 += diffTextByteCount, start2 += diffText.length) : empty = !1, patch.diffs.push([diffType, diffText]), diffText === bigpatch.diffs[0][1] ? bigpatch.diffs.shift() : bigpatch.diffs[0][1] = bigpatch.diffs[0][1].substring(diffText.length));\n      }\n      preContext = diffText2(patch.diffs), preContext = preContext.substring(preContext.length - margin);\n      const postContext = diffText1(bigpatch.diffs).substring(0, margin), postContextByteCount = countUtf8Bytes(postContext);\n      postContext !== \"\" && (patch.length1 += postContext.length, patch.length2 += postContext.length, patch.utf8Length1 += postContextByteCount, patch.utf8Length2 += postContextByteCount, patch.diffs.length !== 0 && patch.diffs[patch.diffs.length - 1][0] === DIFF_EQUAL ? patch.diffs[patch.diffs.length - 1][1] += postContext : patch.diffs.push([DIFF_EQUAL, postContext])), empty || patches.splice(++x, 0, patch);\n    }\n  }\n}\nfunction apply(patches, originalText, opts = {}) {\n  if (typeof patches == \"string\") throw new Error(\"Patches must be an array - pass the patch to `parsePatch()` first\");\n  let text = originalText;\n  if (patches.length === 0) return [text, []];\n  const parsed = adjustIndiciesToUcs2(patches, text, {\n    allowExceedingIndices: opts.allowExceedingIndices\n  }), margin = opts.margin || DEFAULT_MARGIN, deleteThreshold = opts.deleteThreshold || 0.4, nullPadding = addPadding(parsed, margin);\n  text = nullPadding + text + nullPadding, splitMax(parsed, margin);\n  let delta = 0;\n  const results = [];\n  for (let x = 0; x < parsed.length; x++) {\n    const expectedLoc = parsed[x].start2 + delta, text1 = diffText1(parsed[x].diffs);\n    let startLoc, endLoc = -1;\n    if (text1.length > MAX_BITS ? (startLoc = match(text, text1.substring(0, MAX_BITS), expectedLoc), startLoc !== -1 && (endLoc = match(text, text1.substring(text1.length - MAX_BITS), expectedLoc + text1.length - MAX_BITS), (endLoc === -1 || startLoc >= endLoc) && (startLoc = -1))) : startLoc = match(text, text1, expectedLoc), startLoc === -1) results[x] = !1, delta -= parsed[x].length2 - parsed[x].length1;\n    else {\n      results[x] = !0, delta = startLoc - expectedLoc;\n      let text2;\n      if (endLoc === -1 ? text2 = text.substring(startLoc, startLoc + text1.length) : text2 = text.substring(startLoc, endLoc + MAX_BITS), text1 === text2) text = text.substring(0, startLoc) + diffText2(parsed[x].diffs) + text.substring(startLoc + text1.length);\n      else {\n        let diffs = diff(text1, text2, {\n          checkLines: !1\n        });\n        if (text1.length > MAX_BITS && levenshtein(diffs) / text1.length > deleteThreshold) results[x] = !1;\n        else {\n          diffs = cleanupSemanticLossless(diffs);\n          let index1 = 0, index2 = 0;\n          for (let y = 0; y < parsed[x].diffs.length; y++) {\n            const mod = parsed[x].diffs[y];\n            mod[0] !== DIFF_EQUAL && (index2 = xIndex(diffs, index1)), mod[0] === DIFF_INSERT ? text = text.substring(0, startLoc + index2) + mod[1] + text.substring(startLoc + index2) : mod[0] === DIFF_DELETE && (text = text.substring(0, startLoc + index2) + text.substring(startLoc + xIndex(diffs, index1 + mod[1].length))), mod[0] !== DIFF_DELETE && (index1 += mod[1].length);\n          }\n        }\n      }\n    }\n  }\n  return text = text.substring(nullPadding.length, text.length - nullPadding.length), [text, results];\n}\nconst patchHeader = /^@@ -(\\d+),?(\\d*) \\+(\\d+),?(\\d*) @@$/;\nfunction parse(textline) {\n  if (!textline) return [];\n  const patches = [], lines = textline.split(`\n`);\n  let textPointer = 0;\n  for (; textPointer < lines.length; ) {\n    const m = lines[textPointer].match(patchHeader);\n    if (!m) throw new Error(`Invalid patch string: ${lines[textPointer]}`);\n    const patch = createPatchObject(toInt(m[1]), toInt(m[3]));\n    for (patches.push(patch), m[2] === \"\" ? (patch.start1--, patch.utf8Start1--, patch.length1 = 1, patch.utf8Length1 = 1) : m[2] === \"0\" ? (patch.length1 = 0, patch.utf8Length1 = 0) : (patch.start1--, patch.utf8Start1--, patch.utf8Length1 = toInt(m[2]), patch.length1 = patch.utf8Length1), m[4] === \"\" ? (patch.start2--, patch.utf8Start2--, patch.length2 = 1, patch.utf8Length2 = 1) : m[4] === \"0\" ? (patch.length2 = 0, patch.utf8Length2 = 0) : (patch.start2--, patch.utf8Start2--, patch.utf8Length2 = toInt(m[4]), patch.length2 = patch.utf8Length2), textPointer++; textPointer < lines.length; ) {\n      const currentLine = lines[textPointer], sign = currentLine.charAt(0);\n      if (sign === \"@\") break;\n      if (sign === \"\") {\n        textPointer++;\n        continue;\n      }\n      let line;\n      try {\n        line = decodeURI(currentLine.slice(1));\n      } catch {\n        throw new Error(`Illegal escape in parse: ${currentLine}`);\n      }\n      const utf8Diff = countUtf8Bytes(line) - line.length;\n      if (sign === \"-\") patch.diffs.push([DIFF_DELETE, line]), patch.length1 -= utf8Diff;\n      else if (sign === \"+\") patch.diffs.push([DIFF_INSERT, line]), patch.length2 -= utf8Diff;\n      else if (sign === \" \") patch.diffs.push([DIFF_EQUAL, line]), patch.length1 -= utf8Diff, patch.length2 -= utf8Diff;\n      else throw new Error(`Invalid patch mode \"${sign}\" in: ${line}`);\n      textPointer++;\n    }\n  }\n  return patches;\n}\nfunction toInt(num) {\n  return parseInt(num, 10);\n}\nconst debug$d = debugWithName(\"transformOperation\");\nfunction transformOperation(editor, patch, operation, snapshot, previousSnapshot) {\n  const transformedOperation = {\n    ...operation\n  };\n  if (patch.type === \"insert\" && patch.path.length === 1) {\n    const pathSegment = patch.path[0], insertBlockIndex = (snapshot || []).findIndex((blk) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(pathSegment) && blk._key === pathSegment._key);\n    return debug$d(`Adjusting block path (+${patch.items.length}) for '${transformedOperation.type}' operation and patch '${patch.type}'`), [adjustBlockPath(transformedOperation, patch.items.length, insertBlockIndex)];\n  }\n  if (patch.type === \"unset\" && patch.path.length === 1) {\n    const pathSegment = patch.path[0], unsetBlockIndex = (previousSnapshot || []).findIndex((blk) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(pathSegment) && blk._key === pathSegment._key);\n    return \"path\" in transformedOperation && Array.isArray(transformedOperation.path) && transformedOperation.path[0] === unsetBlockIndex ? (debug$d(\"Skipping transformation that targeted removed block\"), []) : [adjustBlockPath(transformedOperation, -1, unsetBlockIndex)];\n  }\n  if (patch.type === \"unset\" && patch.path.length === 0)\n    return debug$d(`Adjusting selection for unset everything patch and ${operation.type} operation`), [];\n  if (patch.type === \"diffMatchPatch\") {\n    const operationTargetBlock = findOperationTargetBlock(editor, transformedOperation), pathSegment = patch.path[0];\n    return !operationTargetBlock || !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(pathSegment) || operationTargetBlock._key !== pathSegment._key ? [transformedOperation] : (parse(patch.value).forEach((diffPatch) => {\n      let adjustOffsetBy = 0, changedOffset = diffPatch.utf8Start1;\n      const {\n        diffs\n      } = diffPatch;\n      if (diffs.forEach((diff2, index) => {\n        const [diffType, text] = diff2;\n        diffType === DIFF_INSERT ? (adjustOffsetBy += text.length, changedOffset += text.length) : diffType === DIFF_DELETE ? (adjustOffsetBy -= text.length, changedOffset -= text.length) : diffType === DIFF_EQUAL && (diffs.slice(index).every(([dType]) => dType === DIFF_EQUAL) || (changedOffset += text.length));\n      }), transformedOperation.type === \"insert_text\" && changedOffset < transformedOperation.offset && (transformedOperation.offset += adjustOffsetBy), transformedOperation.type === \"remove_text\" && changedOffset <= transformedOperation.offset - transformedOperation.text.length && (transformedOperation.offset += adjustOffsetBy), transformedOperation.type === \"set_selection\") {\n        const currentFocus = transformedOperation.properties?.focus ? {\n          ...transformedOperation.properties.focus\n        } : void 0, currentAnchor = transformedOperation?.properties?.anchor ? {\n          ...transformedOperation.properties.anchor\n        } : void 0, newFocus = transformedOperation?.newProperties?.focus ? {\n          ...transformedOperation.newProperties.focus\n        } : void 0, newAnchor = transformedOperation?.newProperties?.anchor ? {\n          ...transformedOperation.newProperties.anchor\n        } : void 0;\n        (currentFocus && currentAnchor || newFocus && newAnchor) && ([currentFocus, currentAnchor, newFocus, newAnchor].forEach((point) => {\n          point && changedOffset < point.offset && (point.offset += adjustOffsetBy);\n        }), currentFocus && currentAnchor && (transformedOperation.properties = {\n          focus: currentFocus,\n          anchor: currentAnchor\n        }), newFocus && newAnchor && (transformedOperation.newProperties = {\n          focus: newFocus,\n          anchor: newAnchor\n        }));\n      }\n    }), [transformedOperation]);\n  }\n  return [transformedOperation];\n}\nfunction adjustBlockPath(operation, level, blockIndex) {\n  const transformedOperation = {\n    ...operation\n  };\n  if (blockIndex >= 0 && transformedOperation.type !== \"set_selection\" && Array.isArray(transformedOperation.path) && transformedOperation.path[0] >= blockIndex + level && transformedOperation.path[0] + level > -1) {\n    const newPath = [transformedOperation.path[0] + level, ...transformedOperation.path.slice(1)];\n    transformedOperation.path = newPath;\n  }\n  if (transformedOperation.type === \"set_selection\") {\n    const currentFocus = transformedOperation.properties?.focus ? {\n      ...transformedOperation.properties.focus\n    } : void 0, currentAnchor = transformedOperation?.properties?.anchor ? {\n      ...transformedOperation.properties.anchor\n    } : void 0, newFocus = transformedOperation?.newProperties?.focus ? {\n      ...transformedOperation.newProperties.focus\n    } : void 0, newAnchor = transformedOperation?.newProperties?.anchor ? {\n      ...transformedOperation.newProperties.anchor\n    } : void 0;\n    (currentFocus && currentAnchor || newFocus && newAnchor) && ([currentFocus, currentAnchor, newFocus, newAnchor].forEach((point) => {\n      point && point.path[0] >= blockIndex + level && point.path[0] + level > -1 && (point.path = [point.path[0] + level, ...point.path.slice(1)]);\n    }), currentFocus && currentAnchor && (transformedOperation.properties = {\n      focus: currentFocus,\n      anchor: currentAnchor\n    }), newFocus && newAnchor && (transformedOperation.newProperties = {\n      focus: newFocus,\n      anchor: newAnchor\n    }));\n  }\n  return transformedOperation;\n}\nfunction findOperationTargetBlock(editor, operation) {\n  let block;\n  return operation.type === \"set_selection\" && editor.selection ? block = editor.children[editor.selection.focus.path[0]] : \"path\" in operation && (block = editor.children[operation.path[0]]), block;\n}\nconst debug$c = debugWithName(\"behavior.operation.history.redo\"), historyRedoOperationImplementation = ({\n  operation\n}) => {\n  const editor = operation.editor, {\n    redos\n  } = editor.history;\n  if (redos.length > 0) {\n    const step = redos[redos.length - 1];\n    if (debug$c(\"Redoing\", step), step.operations.length > 0) {\n      const otherPatches = editor.remotePatches.filter((item) => item.time >= step.timestamp);\n      let transformedOperations = step.operations;\n      otherPatches.forEach((item) => {\n        transformedOperations = transformedOperations.flatMap((op) => transformOperation(editor, item.patch, op, item.snapshot, item.previousSnapshot));\n      });\n      try {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(editor, () => {\n          pluginRedoing(editor, () => {\n            pluginWithoutHistory(editor, () => {\n              transformedOperations.forEach((op) => {\n                editor.apply(op);\n              });\n            });\n          });\n        });\n      } catch (err) {\n        debug$c(\"Could not perform redo step\", err), editor.remotePatches.splice(0, editor.remotePatches.length), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(editor), editor.history = {\n          undos: [],\n          redos: []\n        }, editor.withHistory = !0, editor.isRedoing = !1, editor.onChange();\n        return;\n      }\n      editor.history.undos.push(step), editor.history.redos.pop();\n    }\n  }\n};\nfunction pluginUndoing(editor, fn) {\n  const prev = editor.isUndoing;\n  editor.isUndoing = !0, fn(), editor.isUndoing = prev;\n}\nconst debug$b = debugWithName(\"behavior.operation.history.undo\"), historyUndoOperationImplementation = ({\n  operation\n}) => {\n  const editor = operation.editor, {\n    undos\n  } = editor.history;\n  if (undos.length > 0) {\n    const step = undos[undos.length - 1];\n    if (debug$b(\"Undoing\", step), step.operations.length > 0) {\n      const otherPatches = editor.remotePatches.filter((item) => item.time >= step.timestamp);\n      let transformedOperations = step.operations;\n      otherPatches.forEach((item) => {\n        transformedOperations = transformedOperations.flatMap((op) => transformOperation(editor, item.patch, op, item.snapshot, item.previousSnapshot));\n      });\n      const reversedOperations = transformedOperations.map(slate__WEBPACK_IMPORTED_MODULE_5__.Operation.inverse).reverse();\n      try {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(editor, () => {\n          pluginUndoing(editor, () => {\n            pluginWithoutHistory(editor, () => {\n              reversedOperations.forEach((op) => {\n                editor.apply(op);\n              });\n            });\n          });\n        });\n      } catch (err) {\n        debug$b(\"Could not perform undo step\", err), editor.remotePatches.splice(0, editor.remotePatches.length), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(editor), editor.history = {\n          undos: [],\n          redos: []\n        }, editor.withHistory = !0, editor.isUndoing = !1, editor.onChange();\n        return;\n      }\n      editor.history.redos.push(step), editor.history.undos.pop();\n    }\n  }\n}, insertBlockOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const parsedBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlock)({\n    block: operation.block,\n    context,\n    options: {\n      normalize: !0,\n      removeUnusedMarkDefs: !0,\n      validateFields: !0\n    }\n  });\n  if (!parsedBlock)\n    throw new Error(`Failed to parse block ${JSON.stringify(operation.block)}`);\n  const block = toSlateBlock(parsedBlock, {\n    schemaTypes: context.schema\n  });\n  insertBlock({\n    context,\n    block,\n    placement: operation.placement,\n    select: operation.select ?? \"start\",\n    at: operation.at,\n    editor: operation.editor\n  });\n};\nfunction insertBlock(options) {\n  const {\n    context,\n    block,\n    placement,\n    select,\n    editor\n  } = options, at = options.at ? toSlateRange({\n    context: {\n      schema: context.schema,\n      value: editor.value,\n      selection: options.at\n    },\n    blockIndexMap: editor.blockIndexMap\n  }) : editor.selection;\n  editor.children.length === 0 && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, createPlaceholderBlock(context), {\n    at: [0]\n  });\n  const start = at ? slate__WEBPACK_IMPORTED_MODULE_5__.Range.start(at) : slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, []), end = at ? slate__WEBPACK_IMPORTED_MODULE_5__.Range.end(at) : slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, []), [startBlock, startBlockPath] = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n    at: start,\n    mode: \"lowest\",\n    match: (node, path) => slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node) && path.length <= start.path.length\n  })).at(0) ?? [void 0, void 0], [endBlock, endBlockPath] = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n    at: end,\n    mode: \"lowest\",\n    match: (node, path) => slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node) && path.length <= end.path.length\n  })).at(0) ?? [void 0, void 0];\n  if (!startBlock || !startBlockPath || !endBlock || !endBlockPath)\n    throw new Error(\"Unable to insert block without a start and end block\");\n  if (!editor.selection && select !== \"none\" && slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.focus(editor), !at) {\n    if (placement === \"before\")\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n        at: [0]\n      }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, [0])) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, [0]));\n    else if (placement === \"after\") {\n      const nextPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath);\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n        at: nextPath\n      }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, nextPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, nextPath));\n    } else {\n      if ((0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(context, endBlock)) {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n          at: endBlockPath,\n          select: !1\n        }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n          at: slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath)\n        }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(editor), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, endBlockPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath));\n        return;\n      }\n      if (editor.isTextBlock(block) && endBlock && editor.isTextBlock(endBlock)) {\n        const selectionBefore = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath);\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [block], {\n          at: slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath)\n        }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, selectionBefore) : select === \"none\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(editor);\n        return;\n      }\n      const nextPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath);\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n        at: nextPath,\n        select: !1\n      }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, nextPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, nextPath));\n    }\n    return;\n  }\n  if (!at)\n    throw new Error(\"Unable to insert block without a selection\");\n  if (placement === \"before\")\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n      at: startBlockPath,\n      select: !1\n    }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, startBlockPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, startBlockPath));\n  else if (placement === \"after\") {\n    const nextPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath);\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n      at: nextPath,\n      select: !1\n    }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, nextPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, nextPath));\n  } else {\n    const endBlockEndPoint = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, endBlockPath);\n    if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(at) && !editor.isTextBlock(block)) {\n      const atBeforeDelete = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.rangeRef(editor, at, {\n        affinity: \"inward\"\n      });\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.delete(editor, {\n        at\n      });\n      const [focusBlock, focusBlockPath] = getFocusBlock({\n        editor\n      }), atAfterDelete = atBeforeDelete.unref() ?? editor.selection, atBeforeInsert = atAfterDelete ? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.rangeRef(editor, atAfterDelete, {\n        affinity: \"inward\"\n      }) : void 0;\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n        voids: !0,\n        at: atAfterDelete ?? void 0,\n        select: select !== \"none\"\n      });\n      const atAfterInsert = atBeforeInsert?.unref() ?? editor.selection;\n      select === \"none\" && atAfterInsert && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, atAfterInsert), (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(context, focusBlock) && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n        at: focusBlockPath\n      });\n      return;\n    }\n    if (editor.isTextBlock(endBlock) && editor.isTextBlock(block)) {\n      const selectionStartPoint = slate__WEBPACK_IMPORTED_MODULE_5__.Range.start(at);\n      if ((0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(context, endBlock)) {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n          at: endBlockPath,\n          select: !1\n        }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n          at: slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath)\n        }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, selectionStartPoint) : select === \"end\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath)) : slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, at);\n        return;\n      }\n      const endBlockChildKeys = endBlock.children.map((child) => child._key), endBlockMarkDefsKeys = endBlock.markDefs?.map((markDef) => markDef._key) ?? [], markDefKeyMap = /* @__PURE__ */ new Map(), adjustedMarkDefs = block.markDefs?.map((markDef) => {\n        if (endBlockMarkDefsKeys.includes(markDef._key)) {\n          const newKey = context.keyGenerator();\n          return markDefKeyMap.set(markDef._key, newKey), {\n            ...markDef,\n            _key: newKey\n          };\n        }\n        return markDef;\n      }), adjustedChildren = block.children.map((child) => {\n        if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(context, child)) {\n          const marks = child.marks?.map((mark) => markDefKeyMap.get(mark) || mark) ?? [];\n          if (!isEqualMarks(child.marks, marks))\n            return {\n              ...child,\n              _key: endBlockChildKeys.includes(child._key) ? context.keyGenerator() : child._key,\n              marks\n            };\n        }\n        return endBlockChildKeys.includes(child._key) ? {\n          ...child,\n          _key: context.keyGenerator()\n        } : child;\n      });\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        markDefs: [...endBlock.markDefs ?? [], ...adjustedMarkDefs ?? []]\n      }, {\n        at: endBlockPath\n      });\n      const adjustedBlock = isEqualChildren(block.children, adjustedChildren) ? block : {\n        ...block,\n        children: adjustedChildren\n      };\n      if (select === \"end\") {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [adjustedBlock], {\n          voids: !0\n        });\n        return;\n      }\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [adjustedBlock], {\n        at,\n        voids: !0\n      }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, selectionStartPoint) : slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionStartPoint, endBlockEndPoint) || slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, selectionStartPoint);\n    } else if (editor.isTextBlock(endBlock)) {\n      const endBlockStartPoint = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, endBlockPath), endBlockEndPoint2 = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath), selectionStartPoint = slate__WEBPACK_IMPORTED_MODULE_5__.Range.start(at), selectionEndPoint = slate__WEBPACK_IMPORTED_MODULE_5__.Range.end(at);\n      if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(at) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionStartPoint, endBlockStartPoint))\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n          at: endBlockPath,\n          select: !1\n        }), (select === \"start\" || select === \"end\") && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, endBlockPath)), (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(context, endBlock) && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n          at: slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath)\n        });\n      else if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed(at) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionEndPoint, endBlockEndPoint2)) {\n        const nextPath = [endBlockPath[0] + 1];\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n          at: nextPath,\n          select: !1\n        }), (select === \"start\" || select === \"end\") && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, nextPath));\n      } else if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(at) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionStartPoint, endBlockStartPoint) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionEndPoint, endBlockEndPoint2))\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [block], {\n          at\n        }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, endBlockPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath));\n      else if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(at) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionStartPoint, endBlockStartPoint))\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [block], {\n          at\n        }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, endBlockPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, endBlockPath));\n      else if (slate__WEBPACK_IMPORTED_MODULE_5__.Range.isExpanded(at) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(selectionEndPoint, endBlockEndPoint2))\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [block], {\n          at\n        }), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath))) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Path.next(endBlockPath)));\n      else {\n        const [focusChild] = getFocusChild({\n          editor\n        });\n        if (focusChild && editor.isTextSpan(focusChild))\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.splitNodes(editor, {\n            at\n          }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertFragment(editor, [block], {\n            at\n          }), select === \"start\" || select === \"end\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, [endBlockPath[0] + 1]) : slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, at);\n        else {\n          const nextPath = [endBlockPath[0] + 1];\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n            at: nextPath,\n            select: !1\n          }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, at), select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, nextPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, nextPath));\n        }\n      }\n    } else {\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, [block], {\n        select: !1\n      });\n      const nextPath = [endBlockPath[0] + 1];\n      select === \"start\" ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.start(editor, nextPath)) : select === \"end\" && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, slate__WEBPACK_IMPORTED_MODULE_5__.Editor.end(editor, nextPath));\n    }\n  }\n}\nconst insertChildOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const focus = operation.editor.selection?.focus, focusBlockIndex = focus?.path.at(0), focusChildIndex = focus?.path.at(1);\n  if (focusBlockIndex === void 0 || focusChildIndex === void 0)\n    throw new Error(\"Unable to insert child without a focus\");\n  const [focusBlock, focusBlockPath] = getFocusBlock({\n    editor: operation.editor\n  });\n  if (!focus || !focusBlock || !focusBlockPath)\n    throw new Error(\"Unable to insert child without a focus block\");\n  if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, focusBlock))\n    throw new Error(\"Unable to insert child into a non-text block\");\n  const markDefs = focusBlock.markDefs ?? [], markDefKeyMap = /* @__PURE__ */ new Map();\n  for (const markDef of markDefs)\n    markDefKeyMap.set(markDef._key, markDef._key);\n  const span = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseSpan)({\n    span: operation.child,\n    context,\n    markDefKeyMap,\n    options: {\n      validateFields: !0\n    }\n  });\n  if (span) {\n    const [focusSpan] = getFocusSpan({\n      editor: operation.editor\n    });\n    focusSpan ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(operation.editor, span, {\n      at: focus,\n      select: !0\n    }) : slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(operation.editor, span, {\n      at: [focusBlockIndex, focusChildIndex + 1],\n      select: !0\n    }), slate_dom__WEBPACK_IMPORTED_MODULE_7__.EDITOR_TO_PENDING_SELECTION.set(operation.editor, operation.editor.selection);\n    return;\n  }\n  const inlineObject = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseInlineObject)({\n    inlineObject: operation.child,\n    context,\n    options: {\n      validateFields: !0\n    }\n  });\n  if (inlineObject) {\n    const {\n      _key,\n      _type,\n      ...rest\n    } = inlineObject, [focusSpan] = getFocusSpan({\n      editor: operation.editor\n    });\n    focusSpan ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(operation.editor, {\n      _key,\n      _type,\n      children: [{\n        _key: VOID_CHILD_KEY,\n        _type: \"span\",\n        text: \"\",\n        marks: []\n      }],\n      value: rest,\n      __inline: !0\n    }, {\n      at: focus,\n      select: !0\n    }) : slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(operation.editor, {\n      _key,\n      _type,\n      children: [{\n        _key: VOID_CHILD_KEY,\n        _type: \"span\",\n        text: \"\",\n        marks: []\n      }],\n      value: rest,\n      __inline: !0\n    }, {\n      at: [focusBlockIndex, focusChildIndex + 1],\n      select: !0\n    });\n    return;\n  }\n  throw new Error(\"Unable to parse child\");\n}, insertTextOperationImplementation = ({\n  operation\n}) => {\n  slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertText(operation.editor, operation.text);\n}, moveBackwardOperationImplementation = ({\n  operation\n}) => {\n  slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.move(operation.editor, {\n    unit: \"character\",\n    distance: operation.distance,\n    reverse: !0\n  });\n}, moveBlockOperationImplementation = ({\n  operation\n}) => {\n  const originKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockKeyFromSelectionPoint)({\n    path: operation.at\n  });\n  if (!originKey)\n    throw new Error(\"Failed to get block key from selection point\");\n  const originBlockIndex = operation.editor.blockIndexMap.get(originKey);\n  if (originBlockIndex === void 0)\n    throw new Error(\"Failed to get block index from block key\");\n  const destinationKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockKeyFromSelectionPoint)({\n    path: operation.to\n  });\n  if (!destinationKey)\n    throw new Error(\"Failed to get block key from selection point\");\n  const destinationBlockIndex = operation.editor.blockIndexMap.get(destinationKey);\n  if (destinationBlockIndex === void 0)\n    throw new Error(\"Failed to get block index from block key\");\n  slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.moveNodes(operation.editor, {\n    at: [originBlockIndex],\n    to: [destinationBlockIndex],\n    mode: \"highest\"\n  });\n}, moveForwardOperationImplementation = ({\n  operation\n}) => {\n  slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.move(operation.editor, {\n    unit: \"character\",\n    distance: operation.distance\n  });\n}, selectOperationImplementation = ({\n  context,\n  operation\n}) => {\n  const newSelection = toSlateRange({\n    context: {\n      schema: context.schema,\n      value: operation.editor.value,\n      selection: operation.at\n    },\n    blockIndexMap: operation.editor.blockIndexMap\n  });\n  newSelection ? slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(operation.editor, newSelection) : slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(operation.editor), slate_dom__WEBPACK_IMPORTED_MODULE_7__.IS_FOCUSED.get(operation.editor) && slate_dom__WEBPACK_IMPORTED_MODULE_7__.IS_READ_ONLY.get(operation.editor) && slate_dom__WEBPACK_IMPORTED_MODULE_7__.IS_FOCUSED.set(operation.editor, !1);\n}, behaviorOperationImplementations = {\n  \"annotation.add\": addAnnotationOperationImplementation,\n  \"annotation.remove\": removeAnnotationOperationImplementation,\n  \"block.set\": blockSetOperationImplementation,\n  \"block.unset\": blockUnsetOperationImplementation,\n  \"child.set\": childSetOperationImplementation,\n  \"child.unset\": childUnsetOperationImplementation,\n  \"decorator.add\": decoratorAddOperationImplementation,\n  \"decorator.remove\": decoratorRemoveOperationImplementation,\n  delete: deleteOperationImplementation,\n  \"history.redo\": historyRedoOperationImplementation,\n  \"history.undo\": historyUndoOperationImplementation,\n  \"insert.block\": insertBlockOperationImplementation,\n  \"insert.child\": insertChildOperationImplementation,\n  \"insert.text\": insertTextOperationImplementation,\n  \"move.backward\": moveBackwardOperationImplementation,\n  \"move.block\": moveBlockOperationImplementation,\n  \"move.forward\": moveForwardOperationImplementation,\n  select: selectOperationImplementation\n};\nfunction performOperation({\n  context,\n  operation\n}) {\n  slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(operation.editor, () => {\n    try {\n      switch (operation.type) {\n        case \"annotation.add\": {\n          behaviorOperationImplementations[\"annotation.add\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"annotation.remove\": {\n          behaviorOperationImplementations[\"annotation.remove\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"block.set\": {\n          behaviorOperationImplementations[\"block.set\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"block.unset\": {\n          behaviorOperationImplementations[\"block.unset\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"child.set\": {\n          behaviorOperationImplementations[\"child.set\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"child.unset\": {\n          behaviorOperationImplementations[\"child.unset\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"decorator.add\": {\n          behaviorOperationImplementations[\"decorator.add\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"decorator.remove\": {\n          behaviorOperationImplementations[\"decorator.remove\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"delete\": {\n          behaviorOperationImplementations.delete({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"history.redo\": {\n          behaviorOperationImplementations[\"history.redo\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"history.undo\": {\n          behaviorOperationImplementations[\"history.undo\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"insert.block\": {\n          behaviorOperationImplementations[\"insert.block\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"insert.child\": {\n          behaviorOperationImplementations[\"insert.child\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"insert.text\": {\n          behaviorOperationImplementations[\"insert.text\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"move.backward\": {\n          behaviorOperationImplementations[\"move.backward\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"move.block\": {\n          behaviorOperationImplementations[\"move.block\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        case \"move.forward\": {\n          behaviorOperationImplementations[\"move.forward\"]({\n            context,\n            operation\n          });\n          break;\n        }\n        default: {\n          behaviorOperationImplementations.select({\n            context,\n            operation\n          });\n          break;\n        }\n      }\n    } catch (error) {\n      console.error(new Error(`Executing \"${operation.type}\" failed due to: ${error.message}`));\n    }\n  });\n}\nfunction createWithEventListeners(editorActor) {\n  return function(editor) {\n    const {\n      delete: editorDelete,\n      insertNodes,\n      select,\n      setSelection\n    } = editor;\n    return editor.delete = (options) => {\n      if (editor.isPerformingBehaviorOperation) {\n        editorDelete(options);\n        return;\n      }\n      const range = options?.at ? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, options.at) : void 0, selection = range ? slateRangeToSelection({\n        schema: editorActor.getSnapshot().context.schema,\n        editor,\n        range\n      }) : void 0;\n      selection ? editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"delete\",\n          at: selection,\n          direction: options?.reverse ? \"backward\" : \"forward\",\n          unit: options?.unit\n        },\n        editor\n      }) : editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"delete\",\n          direction: options?.reverse ? \"backward\" : \"forward\",\n          unit: options?.unit\n        },\n        editor\n      });\n    }, editor.deleteBackward = (unit) => {\n      if (editor.isPerformingBehaviorOperation) {\n        console.error(\"Unexpected call to .deleteBackward(...)\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"delete.backward\",\n          unit\n        },\n        editor\n      });\n    }, editor.deleteForward = (unit) => {\n      if (editor.isPerformingBehaviorOperation) {\n        console.error(\"Unexpected call to .deleteForward(...)\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"delete.forward\",\n          unit\n        },\n        editor\n      });\n    }, editor.insertBreak = () => {\n      if (editor.isPerformingBehaviorOperation) {\n        console.error(\"Unexpected call to .insertBreak(...)\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"insert.break\"\n        },\n        editor\n      });\n    }, editor.insertData = (dataTransfer) => {\n      if (editor.isPerformingBehaviorOperation) {\n        console.error(\"Unexpected call to .insertData(...)\");\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"input.*\",\n          originEvent: {\n            dataTransfer\n          }\n        },\n        editor\n      });\n    }, editor.insertNodes = (nodes, options) => {\n      if (editor.isNormalizingNode) {\n        const normalizedNodes = (slate__WEBPACK_IMPORTED_MODULE_5__.Node.isNode(nodes) ? [nodes] : nodes).map((node) => slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(node) && typeof node._type != \"string\" ? {\n          ...node,\n          _type: editorActor.getSnapshot().context.schema.span.name\n        } : node);\n        insertNodes(normalizedNodes, options);\n        return;\n      }\n      insertNodes(nodes, options);\n    }, editor.insertSoftBreak = () => {\n      if (editor.isPerformingBehaviorOperation) {\n        performOperation({\n          context: {\n            keyGenerator: editorActor.getSnapshot().context.keyGenerator,\n            schema: editorActor.getSnapshot().context.schema\n          },\n          operation: {\n            type: \"insert.text\",\n            text: `\n`,\n            editor\n          }\n        });\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"insert.soft break\"\n        },\n        editor\n      });\n    }, editor.insertText = (text) => {\n      if (editor.isPerformingBehaviorOperation) {\n        performOperation({\n          context: {\n            keyGenerator: editorActor.getSnapshot().context.keyGenerator,\n            schema: editorActor.getSnapshot().context.schema\n          },\n          operation: {\n            type: \"insert.text\",\n            text,\n            editor\n          }\n        });\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"insert.text\",\n          text\n        },\n        editor\n      });\n    }, editor.redo = () => {\n      if (editor.isPerformingBehaviorOperation) {\n        performOperation({\n          context: {\n            keyGenerator: editorActor.getSnapshot().context.keyGenerator,\n            schema: editorActor.getSnapshot().context.schema\n          },\n          operation: {\n            type: \"history.redo\",\n            editor\n          }\n        });\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"history.redo\"\n        },\n        editor\n      });\n    }, editor.select = (location) => {\n      if (editor.isPerformingBehaviorOperation) {\n        select(location);\n        return;\n      }\n      if (editor.selection) {\n        select(location);\n        return;\n      }\n      const range = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.range(editor, location);\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"select\",\n          at: slateRangeToSelection({\n            schema: editorActor.getSnapshot().context.schema,\n            editor,\n            range\n          })\n        },\n        editor\n      });\n    }, editor.setSelection = (partialRange) => {\n      if (editor.isPerformingBehaviorOperation) {\n        setSelection(partialRange);\n        return;\n      }\n      const anchor = partialRange.anchor ? slatePointToSelectionPoint({\n        schema: editorActor.getSnapshot().context.schema,\n        editor,\n        point: partialRange.anchor\n      }) : void 0, focus = partialRange.focus ? slatePointToSelectionPoint({\n        schema: editorActor.getSnapshot().context.schema,\n        editor,\n        point: partialRange.focus\n      }) : void 0, backward = editor.selection ? slate__WEBPACK_IMPORTED_MODULE_5__.Range.isBackward({\n        anchor: partialRange.anchor ?? editor.selection.anchor,\n        focus: partialRange.focus ?? editor.selection.focus\n      }) : partialRange.anchor && partialRange.focus ? slate__WEBPACK_IMPORTED_MODULE_5__.Range.isBackward({\n        anchor: partialRange.anchor,\n        focus: partialRange.focus\n      }) : void 0;\n      if (editor.selection) {\n        const newAnchor = partialRange.anchor ?? editor.selection.anchor, newFocus = partialRange.focus ?? editor.selection.focus;\n        if (slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(newAnchor, editor.selection.anchor) && slate__WEBPACK_IMPORTED_MODULE_5__.Point.equals(newFocus, editor.selection.focus)) {\n          setSelection(partialRange);\n          return;\n        }\n      }\n      if (!anchor || !focus) {\n        setSelection(partialRange);\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"select\",\n          at: {\n            anchor,\n            focus,\n            backward\n          }\n        },\n        editor\n      });\n    }, editor.setFragmentData = () => {\n      console.error(\"Unexpected call to .setFragmentData(...)\");\n    }, editor.undo = () => {\n      if (editor.isPerformingBehaviorOperation) {\n        performOperation({\n          context: {\n            keyGenerator: editorActor.getSnapshot().context.keyGenerator,\n            schema: editorActor.getSnapshot().context.schema\n          },\n          operation: {\n            type: \"history.undo\",\n            editor\n          }\n        });\n        return;\n      }\n      editorActor.send({\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"history.undo\"\n        },\n        editor\n      });\n    }, editor;\n  };\n}\nfunction createUndoSteps({\n  steps,\n  op,\n  editor,\n  currentUndoStepId,\n  previousUndoStepId\n}) {\n  const lastStep = steps.at(-1);\n  if (!lastStep)\n    return createNewStep(steps, op, editor);\n  if (editor.operations.length > 0)\n    return currentUndoStepId === previousUndoStepId || editor.isNormalizingNode ? mergeIntoLastStep(steps, lastStep, op) : createNewStep(steps, op, editor);\n  if (op.type === \"set_selection\" && currentUndoStepId === void 0 && previousUndoStepId !== void 0 || op.type === \"set_selection\" && currentUndoStepId !== void 0 && previousUndoStepId !== void 0 && previousUndoStepId !== currentUndoStepId)\n    return mergeIntoLastStep(steps, lastStep, op);\n  if (currentUndoStepId === void 0 && previousUndoStepId === void 0) {\n    if (op.type === \"set_selection\")\n      return mergeIntoLastStep(steps, lastStep, op);\n    const lastOp = lastStep.operations.at(-1);\n    return lastOp && op.type === \"insert_text\" && lastOp.type === \"insert_text\" && op.offset === lastOp.offset + lastOp.text.length && slate__WEBPACK_IMPORTED_MODULE_5__.Path.equals(op.path, lastOp.path) && op.text !== \" \" || lastOp && op.type === \"remove_text\" && lastOp.type === \"remove_text\" && op.offset + op.text.length === lastOp.offset && slate__WEBPACK_IMPORTED_MODULE_5__.Path.equals(op.path, lastOp.path) ? mergeIntoLastStep(steps, lastStep, op) : createNewStep(steps, op, editor);\n  }\n  return createNewStep(steps, op, editor);\n}\nfunction createNewStep(steps, op, editor) {\n  const operations = editor.selection === null ? [op] : [{\n    type: \"set_selection\",\n    properties: {\n      ...editor.selection\n    },\n    newProperties: {\n      ...editor.selection\n    }\n  }, op];\n  return [...steps, {\n    operations,\n    timestamp: /* @__PURE__ */ new Date()\n  }];\n}\nfunction mergeIntoLastStep(steps, lastStep, op) {\n  return [...steps.slice(0, -1), {\n    timestamp: lastStep.timestamp,\n    operations: [...lastStep.operations, op]\n  }];\n}\nconst debug$a = debugWithName(\"plugin:history\"), UNDO_STEP_LIMIT = 1e3;\nfunction pluginHistory({\n  editorActor,\n  subscriptions\n}) {\n  return (editor) => {\n    let previousSnapshot = editor.value, previousUndoStepId = editor.undoStepId;\n    subscriptions.push(() => {\n      const subscription = editorActor.on(\"patches\", ({\n        patches,\n        snapshot\n      }) => {\n        let reset = !1;\n        for (const patch of patches)\n          if (!reset && patch.origin !== \"local\") {\n            if (patch.type === \"unset\" && patch.path.length === 0) {\n              debug$a(\"Someone else cleared the content, resetting undo/redo history\"), editor.history = {\n                undos: [],\n                redos: []\n              }, editor.remotePatches.splice(0, editor.remotePatches.length), editor.withHistory = !0, reset = !0;\n              return;\n            }\n            editor.remotePatches.push({\n              patch,\n              time: /* @__PURE__ */ new Date(),\n              snapshot,\n              previousSnapshot\n            });\n          }\n        previousSnapshot = snapshot;\n      });\n      return () => {\n        subscription.unsubscribe();\n      };\n    });\n    const {\n      apply: apply2\n    } = editor;\n    return editor.apply = (op) => {\n      if (editorActor.getSnapshot().matches({\n        \"edit mode\": \"read only\"\n      })) {\n        apply2(op);\n        return;\n      }\n      if (editor.isProcessingRemoteChanges) {\n        apply2(op);\n        return;\n      }\n      if (editor.isUndoing || editor.isRedoing) {\n        apply2(op);\n        return;\n      }\n      const withHistory = editor.withHistory, currentUndoStepId = editor.undoStepId;\n      if (!withHistory) {\n        previousUndoStepId = currentUndoStepId, apply2(op);\n        return;\n      }\n      for (op.type !== \"set_selection\" && (editor.history.redos = []), editor.history.undos = createUndoSteps({\n        steps: editor.history.undos,\n        op,\n        editor,\n        currentUndoStepId,\n        previousUndoStepId\n      }); editor.history.undos.length > UNDO_STEP_LIMIT; )\n        editor.history.undos.shift();\n      previousUndoStepId = currentUndoStepId, apply2(op);\n    }, editor;\n  };\n}\nfunction withNormalizeNode(editor, fn) {\n  const prev = editor.isNormalizingNode;\n  editor.isNormalizingNode = !0, fn(), editor.isNormalizingNode = prev;\n}\nfunction withoutPatching(editor, fn) {\n  const prev = editor.isPatching;\n  editor.isPatching = !1, fn(), editor.isPatching = prev;\n}\nconst debug$9 = debugWithName(\"plugin:withPortableTextMarkModel\");\nfunction createWithNormalize(editorActor) {\n  return function(editor) {\n    const {\n      apply: apply2,\n      normalizeNode\n    } = editor, defaultStyle = editorActor.getSnapshot().context.schema.styles.at(0)?.name;\n    return editor.normalizeNode = (nodeEntry) => {\n      const [node, path] = nodeEntry;\n      if (slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(node) && node.children.length === 0 && withoutPatching(editor, () => {\n        withNormalizeNode(editor, () => {\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, createPlaceholderBlock(editorActor.getSnapshot().context), {\n            at: [0],\n            select: !0\n          });\n        });\n      }), editor.isTextBlock(node)) {\n        const children = slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, path);\n        for (const [child, childPath] of children) {\n          const nextNode = node.children[childPath[1] + 1];\n          if (editor.isTextSpan(child) && editor.isTextSpan(nextNode) && child.marks?.every((mark) => nextNode.marks?.includes(mark)) && nextNode.marks?.every((mark) => child.marks?.includes(mark))) {\n            debug$9(\"Merging spans\", JSON.stringify(child, null, 2), JSON.stringify(nextNode, null, 2)), withNormalizeNode(editor, () => {\n              slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.mergeNodes(editor, {\n                at: [childPath[0], childPath[1] + 1],\n                voids: !0\n              });\n            });\n            return;\n          }\n        }\n      }\n      if (editor.isTextBlock(node) && !Array.isArray(node.markDefs)) {\n        debug$9(\"Adding .markDefs to block node\"), withNormalizeNode(editor, () => {\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            markDefs: []\n          }, {\n            at: path\n          });\n        });\n        return;\n      }\n      if (defaultStyle && editor.isTextBlock(node) && typeof node.style > \"u\") {\n        debug$9(\"Adding .style to block node\"), withNormalizeNode(editor, () => {\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            style: defaultStyle\n          }, {\n            at: path\n          });\n        });\n        return;\n      }\n      if (editor.isTextSpan(node) && !Array.isArray(node.marks)) {\n        debug$9(\"Adding .marks to span node\"), withNormalizeNode(editor, () => {\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            marks: []\n          }, {\n            at: path\n          });\n        });\n        return;\n      }\n      if (editor.isTextSpan(node)) {\n        const blockPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.parent(path), [block] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, blockPath), decorators = editorActor.getSnapshot().context.schema.decorators.map((decorator) => decorator.name), annotations = node.marks?.filter((mark) => !decorators.includes(mark));\n        if (editor.isTextBlock(block) && node.text === \"\" && annotations && annotations.length > 0) {\n          debug$9(\"Removing annotations from empty span node\"), withNormalizeNode(editor, () => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n              marks: node.marks?.filter((mark) => decorators.includes(mark))\n            }, {\n              at: path\n            });\n          });\n          return;\n        }\n      }\n      if (editor.isTextBlock(node)) {\n        const decorators = editorActor.getSnapshot().context.schema.decorators.map((decorator) => decorator.name);\n        for (const [child, childPath] of slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, path))\n          if (editor.isTextSpan(child)) {\n            const marks = child.marks ?? [], orphanedAnnotations = marks.filter((mark) => !decorators.includes(mark) && !node.markDefs?.find((def) => def._key === mark));\n            if (orphanedAnnotations.length > 0) {\n              debug$9(\"Removing orphaned annotations from span node\"), withNormalizeNode(editor, () => {\n                slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n                  marks: marks.filter((mark) => !orphanedAnnotations.includes(mark))\n                }, {\n                  at: childPath\n                });\n              });\n              return;\n            }\n          }\n      }\n      if (editor.isTextSpan(node)) {\n        const blockPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.parent(path), [block] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, blockPath);\n        if (editor.isTextBlock(block)) {\n          const decorators = editorActor.getSnapshot().context.schema.decorators.map((decorator) => decorator.name), marks = node.marks ?? [], orphanedAnnotations = marks.filter((mark) => !decorators.includes(mark) && !block.markDefs?.find((def) => def._key === mark));\n          if (orphanedAnnotations.length > 0) {\n            debug$9(\"Removing orphaned annotations from span node\"), withNormalizeNode(editor, () => {\n              slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n                marks: marks.filter((mark) => !orphanedAnnotations.includes(mark))\n              }, {\n                at: path\n              });\n            });\n            return;\n          }\n        }\n      }\n      if (editor.isTextBlock(node)) {\n        const markDefs = node.markDefs ?? [], markDefKeys = /* @__PURE__ */ new Set(), newMarkDefs = [];\n        for (const markDef of markDefs)\n          markDefKeys.has(markDef._key) || (markDefKeys.add(markDef._key), newMarkDefs.push(markDef));\n        if (markDefs.length !== newMarkDefs.length) {\n          debug$9(\"Removing duplicate markDefs\"), withNormalizeNode(editor, () => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n              markDefs: newMarkDefs\n            }, {\n              at: path\n            });\n          });\n          return;\n        }\n      }\n      if (editor.isTextBlock(node) && !editor.operations.some((op) => op.type === \"merge_node\" && \"markDefs\" in op.properties && op.path.length === 1)) {\n        const newMarkDefs = (node.markDefs || []).filter((def) => node.children.find((child) => slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(child) && Array.isArray(child.marks) && child.marks.includes(def._key)));\n        if (node.markDefs && !isEqualMarkDefs(newMarkDefs, node.markDefs)) {\n          debug$9(\"Removing markDef not in use\"), withNormalizeNode(editor, () => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n              markDefs: newMarkDefs\n            }, {\n              at: path\n            });\n          });\n          return;\n        }\n      }\n      withNormalizeNode(editor, () => {\n        normalizeNode(nodeEntry);\n      });\n    }, editor.apply = (op) => {\n      if (editor.isProcessingRemoteChanges) {\n        apply2(op);\n        return;\n      }\n      if (editor.isUndoing || editor.isRedoing) {\n        apply2(op);\n        return;\n      }\n      if (op.type === \"set_selection\")\n        if (op.properties && op.newProperties && op.properties.anchor && op.properties.focus && op.newProperties.anchor && op.newProperties.focus) {\n          const previousSelectionIsCollapsed = slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed({\n            anchor: op.properties.anchor,\n            focus: op.properties.focus\n          }), newSelectionIsCollapsed = slate__WEBPACK_IMPORTED_MODULE_5__.Range.isCollapsed({\n            anchor: op.newProperties.anchor,\n            focus: op.newProperties.focus\n          });\n          if (previousSelectionIsCollapsed && newSelectionIsCollapsed) {\n            const focusSpan = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n              mode: \"lowest\",\n              at: op.properties.focus,\n              match: (n) => editor.isTextSpan(n),\n              voids: !1\n            }))[0]?.[0], newFocusSpan = Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n              mode: \"lowest\",\n              at: op.newProperties.focus,\n              match: (n) => editor.isTextSpan(n),\n              voids: !1\n            }))[0]?.[0], movedToNextSpan = focusSpan && newFocusSpan && op.newProperties.focus.path[0] === op.properties.focus.path[0] && op.newProperties.focus.path[1] === op.properties.focus.path[1] + 1 && focusSpan.text.length === op.properties.focus.offset && op.newProperties.focus.offset === 0, movedToPreviousSpan = focusSpan && newFocusSpan && op.newProperties.focus.path[0] === op.properties.focus.path[0] && op.newProperties.focus.path[1] === op.properties.focus.path[1] - 1 && op.properties.focus.offset === 0 && newFocusSpan.text.length === op.newProperties.focus.offset;\n            !movedToNextSpan && !movedToPreviousSpan && (editor.decoratorState = {});\n          }\n        } else\n          editor.decoratorState = {};\n      if (op.type === \"merge_node\" && op.path.length === 1 && \"markDefs\" in op.properties && op.properties._type === editorActor.getSnapshot().context.schema.block.name && Array.isArray(op.properties.markDefs) && op.properties.markDefs.length > 0 && op.path[0] - 1 >= 0) {\n        const [targetBlock, targetPath] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.node(editor, [op.path[0] - 1]);\n        if (editor.isTextBlock(targetBlock)) {\n          const oldDefs = Array.isArray(targetBlock.markDefs) && targetBlock.markDefs || [], newMarkDefs = [...new Map([...oldDefs, ...op.properties.markDefs].map((def) => [def._key, def])).values()];\n          debug$9(\"Copying markDefs over to merged block\", op), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            markDefs: newMarkDefs\n          }, {\n            at: targetPath,\n            voids: !1\n          }), apply2(op);\n          return;\n        }\n      }\n      apply2(op);\n    }, editor;\n  };\n}\nfunction createWithObjectKeys(editorActor) {\n  return function(editor) {\n    const {\n      apply: apply2,\n      normalizeNode\n    } = editor;\n    return editor.apply = (operation) => {\n      if (editor.isProcessingRemoteChanges) {\n        apply2(operation);\n        return;\n      }\n      if (editor.isUndoing || editor.isRedoing) {\n        apply2(operation);\n        return;\n      }\n      if (operation.type === \"split_node\") {\n        const existingKeys = [...slate__WEBPACK_IMPORTED_MODULE_5__.Node.descendants(editor)].map(([node]) => node._key);\n        apply2({\n          ...operation,\n          properties: {\n            ...operation.properties,\n            _key: operation.properties._key === void 0 || existingKeys.includes(operation.properties._key) ? editorActor.getSnapshot().context.keyGenerator() : operation.properties._key\n          }\n        });\n        return;\n      }\n      if (operation.type === \"insert_node\" && !slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(operation.node)) {\n        const existingKeys = [...slate__WEBPACK_IMPORTED_MODULE_5__.Node.descendants(editor)].map(([node]) => node._key);\n        apply2({\n          ...operation,\n          node: {\n            ...operation.node,\n            _key: operation.node._key === void 0 || existingKeys.includes(operation.node._key) ? editorActor.getSnapshot().context.keyGenerator() : operation.node._key\n          }\n        });\n        return;\n      }\n      if (operation.type === \"merge_node\") {\n        const index = operation.path[operation.path.length - 1], prevPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.previous(operation.path), prevIndex = prevPath[prevPath.length - 1];\n        if (operation.path.length !== 1 || prevPath.length !== 1) {\n          apply2(operation);\n          return;\n        }\n        const block = editor.value.at(index), previousBlock = editor.value.at(prevIndex);\n        if (!block || !previousBlock) {\n          apply2(operation);\n          return;\n        }\n        if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(editorActor.getSnapshot().context, block) || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(editorActor.getSnapshot().context, previousBlock)) {\n          apply2(operation);\n          return;\n        }\n        const previousBlockChildKeys = previousBlock.children.map((child) => child._key), previousBlockMarkDefKeys = previousBlock.markDefs?.map((markDef) => markDef._key) ?? [], markDefKeyMap = /* @__PURE__ */ new Map(), adjustedMarkDefs = block.markDefs?.map((markDef) => {\n          if (previousBlockMarkDefKeys.includes(markDef._key)) {\n            const newKey = editorActor.getSnapshot().context.keyGenerator();\n            return markDefKeyMap.set(markDef._key, newKey), {\n              ...markDef,\n              _key: newKey\n            };\n          }\n          return markDef;\n        });\n        let childIndex = 0;\n        for (const child of block.children) {\n          if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(editorActor.getSnapshot().context, child)) {\n            const marks = child.marks?.map((mark) => markDefKeyMap.get(mark) || mark) ?? [];\n            isEqualMarks(child.marks, marks) || slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n              marks\n            }, {\n              at: [index, childIndex]\n            });\n          }\n          previousBlockChildKeys.includes(child._key) && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            _key: editorActor.getSnapshot().context.keyGenerator()\n          }, {\n            at: [index, childIndex]\n          }), childIndex++;\n        }\n        apply2({\n          ...operation,\n          properties: {\n            ...operation.properties,\n            // Make sure the adjusted markDefs are carried along for the merge\n            // operation\n            markDefs: adjustedMarkDefs\n          }\n        });\n        return;\n      }\n      apply2(operation);\n    }, editor.normalizeNode = (entry) => {\n      const [node, path] = entry;\n      if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node)) {\n        const [parent] = slate__WEBPACK_IMPORTED_MODULE_5__.Editor.parent(editor, path);\n        if (parent && slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(parent)) {\n          const blockKeys = /* @__PURE__ */ new Set();\n          for (const sibling of parent.children) {\n            if (sibling._key && blockKeys.has(sibling._key)) {\n              const _key = editorActor.getSnapshot().context.keyGenerator();\n              blockKeys.add(_key), withNormalizeNode(editor, () => {\n                slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n                  _key\n                }, {\n                  at: path\n                });\n              });\n              return;\n            }\n            if (!sibling._key) {\n              const _key = editorActor.getSnapshot().context.keyGenerator();\n              blockKeys.add(_key), withNormalizeNode(editor, () => {\n                slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n                  _key\n                }, {\n                  at: path\n                });\n              });\n              return;\n            }\n            blockKeys.add(sibling._key);\n          }\n        }\n      }\n      if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(node) && node._type === editorActor.getSnapshot().context.schema.block.name) {\n        if (!node._key) {\n          withNormalizeNode(editor, () => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n              _key: editorActor.getSnapshot().context.keyGenerator()\n            }, {\n              at: path\n            });\n          });\n          return;\n        }\n        const childKeys = /* @__PURE__ */ new Set();\n        for (const [child, childPath] of slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, path)) {\n          if (child._key && childKeys.has(child._key)) {\n            const _key = editorActor.getSnapshot().context.keyGenerator();\n            childKeys.add(_key), withNormalizeNode(editor, () => {\n              slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n                _key\n              }, {\n                at: childPath\n              });\n            });\n            return;\n          }\n          if (!child._key) {\n            const _key = editorActor.getSnapshot().context.keyGenerator();\n            childKeys.add(_key), withNormalizeNode(editor, () => {\n              slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n                _key\n              }, {\n                at: childPath\n              });\n            });\n            return;\n          }\n          childKeys.add(child._key);\n        }\n      }\n      withNormalizeNode(editor, () => {\n        normalizeNode(entry);\n      });\n    }, editor;\n  };\n}\nfunction createApplyPatch(context) {\n  return (editor, patch) => {\n    let changed = !1;\n    try {\n      switch (patch.type) {\n        case \"insert\":\n          changed = insertPatch(context, editor, patch);\n          break;\n        case \"unset\":\n          changed = unsetPatch(editor, patch);\n          break;\n        case \"set\":\n          changed = setPatch(editor, patch);\n          break;\n        case \"diffMatchPatch\":\n          changed = diffMatchPatch(editor, patch);\n          break;\n      }\n    } catch (err) {\n      console.error(err);\n    }\n    return changed;\n  };\n}\nfunction diffMatchPatch(editor, patch) {\n  const block = findBlock(editor.children, patch.path);\n  if (!block)\n    return !1;\n  const child = findBlockChild(block, patch.path);\n  if (!child || !(block && editor.isTextBlock(block.node) && patch.path.length === 4 && patch.path[1] === \"children\" && patch.path[3] === \"text\") || !slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(child.node))\n    return !1;\n  const patches = parse(patch.value), [newValue] = apply(patches, child.node.text, {\n    allowExceedingIndices: !0\n  }), diff$1 = cleanupEfficiency(diff(child.node.text, newValue), 5);\n  let offset = 0;\n  for (const [op, text] of diff$1)\n    op === DIFF_INSERT ? (editor.apply({\n      type: \"insert_text\",\n      path: [block.index, child.index],\n      offset,\n      text\n    }), offset += text.length) : op === DIFF_DELETE ? editor.apply({\n      type: \"remove_text\",\n      path: [block.index, child.index],\n      offset,\n      text\n    }) : op === DIFF_EQUAL && (offset += text.length);\n  return !0;\n}\nfunction insertPatch(context, editor, patch) {\n  const block = findBlock(editor.children, patch.path);\n  if (!block) {\n    if (patch.path.length === 1 && patch.path[0] === 0) {\n      const blocksToInsert = patch.items.map((item) => toSlateBlock(item, {\n        schemaTypes: context.schema\n      }));\n      return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, blocksToInsert, {\n        at: [0]\n      }), !0;\n    }\n    return !1;\n  }\n  if (patch.path.length > 1 && patch.path[1] !== \"children\")\n    return !1;\n  if (patch.path.length === 1) {\n    const {\n      items: items2,\n      position: position2\n    } = patch, blocksToInsert = items2.map((item) => toSlateBlock(item, {\n      schemaTypes: context.schema\n    })), targetBlockIndex = block.index, normalizedIdx2 = position2 === \"after\" ? targetBlockIndex + 1 : targetBlockIndex, editorWasEmptyBefore = isEqualToEmptyEditor(context.initialValue, editor.value, context.schema);\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, blocksToInsert, {\n      at: [normalizedIdx2]\n    }), editorWasEmptyBefore && typeof patch.path[0] == \"number\" && patch.path[0] === 0 && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n      at: [position2 === \"before\" ? targetBlockIndex + blocksToInsert.length : targetBlockIndex]\n    }), !0;\n  }\n  const {\n    items,\n    position\n  } = patch, targetChild = findBlockChild(block, patch.path);\n  if (!targetChild)\n    return !1;\n  const childrenToInsert = toSlateBlock({\n    ...block.node,\n    children: items\n  }, {\n    schemaTypes: context.schema\n  }), normalizedIdx = position === \"after\" ? targetChild.index + 1 : targetChild.index, childInsertPath = [block.index, normalizedIdx];\n  return childrenToInsert && slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(childrenToInsert) && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, childrenToInsert.children, {\n    at: childInsertPath\n  }), !0;\n}\nfunction setPatch(editor, patch) {\n  let value = patch.value;\n  typeof patch.path[3] == \"string\" && (value = {}, value[patch.path[3]] = patch.value);\n  const block = findBlock(editor.children, patch.path);\n  if (!block)\n    return !1;\n  const isTextBlock2 = editor.isTextBlock(block.node);\n  if (patch.path.length === 1) {\n    const updatedBlock = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(block.node, [{\n      ...patch,\n      path: patch.path.slice(1)\n    }]);\n    if (editor.isTextBlock(block.node) && slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(updatedBlock)) {\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, updatedBlock, {\n        at: [block.index]\n      });\n      const previousSelection = editor.selection;\n      for (const [_, childPath] of slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(editor, {\n        at: [block.index],\n        reverse: !0,\n        mode: \"lowest\"\n      }))\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n          at: childPath\n        });\n      return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(editor, updatedBlock.children, {\n        at: [block.index, 0]\n      }), previousSelection && (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setSelection(editor, previousSelection), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(editor, previousSelection)), !0;\n    } else\n      return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, updatedBlock, {\n        at: [block.index]\n      }), !0;\n  }\n  if (isTextBlock2 && patch.path[1] !== \"children\") {\n    const updatedBlock = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(block.node, [{\n      ...patch,\n      path: patch.path.slice(1)\n    }]);\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, updatedBlock, {\n      at: [block.index]\n    }), !0;\n  }\n  const child = findBlockChild(block, patch.path);\n  if (isTextBlock2 && child) {\n    if (slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(child.node))\n      if (slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(value)) {\n        const oldText = child.node.text, newText = value.text;\n        oldText !== newText && (editor.apply({\n          type: \"remove_text\",\n          path: [block.index, child.index],\n          offset: 0,\n          text: oldText\n        }), editor.apply({\n          type: \"insert_text\",\n          path: [block.index, child.index],\n          offset: 0,\n          text: newText\n        }), editor.onChange());\n      } else {\n        const propPath = patch.path.slice(3), propEntry = propPath.at(0);\n        if (propEntry === void 0 || typeof propEntry == \"string\" && [\"_key\", \"_type\", \"text\"].includes(propEntry))\n          return !1;\n        const newNode = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(child.node, [{\n          ...patch,\n          path: propPath\n        }]);\n        slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, newNode, {\n          at: [block.index, child.index]\n        });\n      }\n    else {\n      const propPath = patch.path.slice(3), reservedProps = [\"_key\", \"_type\", \"children\", \"__inline\"], propEntry = propPath.at(0);\n      if (propEntry === void 0 || typeof propEntry == \"string\" && reservedProps.includes(propEntry))\n        return !1;\n      const value2 = \"value\" in child.node && typeof child.node.value == \"object\" ? child.node.value : {}, newValue = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(value2, [{\n        ...patch,\n        path: patch.path.slice(3)\n      }]);\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        ...child.node,\n        value: newValue\n      }, {\n        at: [block.index, child.index]\n      });\n    }\n    return !0;\n  } else if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(block.node) && patch.path.length === 1) {\n    const {\n      children,\n      ...nextRest\n    } = value, {\n      children: _prevChildren,\n      ...prevRest\n    } = block.node || {\n      children: void 0\n    };\n    editor.apply({\n      type: \"set_node\",\n      path: [block.index],\n      properties: {\n        ...prevRest\n      },\n      newProperties: nextRest\n    });\n    const blockNode = block.node;\n    blockNode.children.forEach((child2, childIndex) => {\n      editor.apply({\n        type: \"remove_node\",\n        path: [block.index, blockNode.children.length - 1 - childIndex],\n        node: child2\n      });\n    }), Array.isArray(children) && children.forEach((child2, childIndex) => {\n      editor.apply({\n        type: \"insert_node\",\n        path: [block.index, childIndex],\n        node: child2\n      });\n    });\n  } else if (block && \"value\" in block.node)\n    if (patch.path.length > 1 && patch.path[1] !== \"children\") {\n      const newVal = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(block.node.value, [{\n        ...patch,\n        path: patch.path.slice(1)\n      }]);\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        ...block.node,\n        value: newVal\n      }, {\n        at: [block.index]\n      });\n    } else\n      return !1;\n  return !0;\n}\nfunction unsetPatch(editor, patch) {\n  if (patch.path.length === 0) {\n    slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(editor);\n    const children = slate__WEBPACK_IMPORTED_MODULE_5__.Node.children(editor, [], {\n      reverse: !0\n    });\n    for (const [_, path] of children)\n      slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n        at: path\n      });\n    return !0;\n  }\n  const block = findBlock(editor.children, patch.path);\n  if (!block)\n    return !1;\n  if (patch.path.length === 1)\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n      at: [block.index]\n    }), !0;\n  const child = findBlockChild(block, patch.path);\n  if (editor.isTextBlock(block.node) && child && patch.path[1] === \"children\" && patch.path.length === 3)\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(editor, {\n      at: [block.index, child.index]\n    }), !0;\n  if (child && !slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(child.node)) {\n    const propEntry = patch.path.slice(3).at(0);\n    if (propEntry === void 0 || typeof propEntry == \"string\" && [\"_key\", \"_type\", \"children\", \"__inline\"].includes(propEntry))\n      return !1;\n    const value = \"value\" in child.node && typeof child.node.value == \"object\" ? child.node.value : {}, newValue = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(value, [{\n      ...patch,\n      path: patch.path.slice(3)\n    }]);\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n      ...child.node,\n      value: newValue\n    }, {\n      at: [block.index, child.index]\n    }), !0;\n  }\n  if (child && slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(child.node)) {\n    const propPath = patch.path.slice(3), propEntry = propPath.at(0);\n    if (propEntry === void 0 || typeof propEntry == \"string\" && [\"_key\", \"_type\"].includes(propEntry))\n      return !1;\n    if (typeof propEntry == \"string\" && propEntry === \"text\")\n      return editor.apply({\n        type: \"remove_text\",\n        path: [block.index, child.index],\n        offset: 0,\n        text: child.node.text\n      }), !0;\n    const newNode = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(child.node, [{\n      ...patch,\n      path: propPath\n    }]), newKeys = Object.keys(newNode), removedProperties = Object.keys(child.node).filter((property) => !newKeys.includes(property));\n    return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.unsetNodes(editor, removedProperties, {\n      at: [block.index, child.index]\n    }), !0;\n  }\n  if (!child) {\n    if (\"value\" in block.node) {\n      const newVal = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.applyAll)(block.node.value, [{\n        ...patch,\n        path: patch.path.slice(1)\n      }]);\n      return slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n        ...block.node,\n        value: newVal\n      }, {\n        at: [block.index]\n      }), !0;\n    }\n    return !1;\n  }\n  return !1;\n}\nfunction findBlock(children, path) {\n  let blockIndex = -1;\n  const block = children.find((node, index) => {\n    const isMatch = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(path[0]) ? node._key === path[0]._key : index === path[0];\n    return isMatch && (blockIndex = index), isMatch;\n  });\n  if (block)\n    return {\n      node: block,\n      index: blockIndex\n    };\n}\nfunction findBlockChild(block, path) {\n  const blockNode = block.node;\n  if (!slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(blockNode) || path[1] !== \"children\")\n    return;\n  let childIndex = -1;\n  const child = blockNode.children.find((node, index) => {\n    const isMatch = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isKeyedSegment)(path[2]) ? node._key === path[2]._key : index === path[2];\n    return isMatch && (childIndex = index), isMatch;\n  });\n  if (child)\n    return {\n      node: child,\n      index: childIndex\n    };\n}\nfunction insertTextPatch(schema, children, operation, beforeValue) {\n  const block = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, children[operation.path[0]]) && children[operation.path[0]];\n  if (!block)\n    throw new Error(\"Could not find block\");\n  const textChild = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, block) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n    schema\n  }, block.children[operation.path[1]]) && block.children[operation.path[1]];\n  if (!textChild)\n    throw new Error(\"Could not find child\");\n  const path = [{\n    _key: block._key\n  }, \"children\", {\n    _key: textChild._key\n  }, \"text\"], prevBlock = beforeValue[operation.path[0]], prevChild = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, prevBlock) && prevBlock.children[operation.path[1]], prevText = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n    schema\n  }, prevChild) ? prevChild.text : \"\", patch = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.diffMatchPatch)(prevText, textChild.text, path);\n  return patch.value.length ? [patch] : [];\n}\nfunction removeTextPatch(schema, children, operation, beforeValue) {\n  const block = children[operation.path[0]];\n  if (!block)\n    throw new Error(\"Could not find block\");\n  const child = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, block) && block.children[operation.path[1]] || void 0, textChild = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n    schema\n  }, child) ? child : void 0;\n  if (child && !textChild)\n    throw new Error(\"Expected span\");\n  if (!textChild)\n    throw new Error(\"Could not find child\");\n  const path = [{\n    _key: block._key\n  }, \"children\", {\n    _key: textChild._key\n  }, \"text\"], beforeBlock = beforeValue[operation.path[0]], prevTextChild = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, beforeBlock) && beforeBlock.children[operation.path[1]], prevText = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n    schema\n  }, prevTextChild) && prevTextChild.text, patch = (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.diffMatchPatch)(prevText || \"\", textChild.text, path);\n  return patch.value ? [patch] : [];\n}\nfunction setNodePatch(schema, children, operation) {\n  const blockIndex = operation.path.at(0);\n  if (blockIndex !== void 0 && operation.path.length === 1) {\n    const block = children.at(blockIndex);\n    if (!block)\n      return console.error(\"Could not find block at index\", blockIndex), [];\n    if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n      schema\n    }, block)) {\n      const patches = [];\n      for (const key of Object.keys(operation.newProperties)) {\n        const value = operation.newProperties[key];\n        key === \"_key\" ? patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [blockIndex, \"_key\"])) : patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [{\n          _key: block._key\n        }, key]));\n      }\n      for (const key of Object.keys(operation.properties))\n        key in operation.newProperties || patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n          _key: block._key\n        }, key]));\n      return patches;\n    } else {\n      const patches = [], _key = operation.newProperties._key;\n      _key !== void 0 && patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(_key, [blockIndex, \"_key\"]));\n      const newValue = \"value\" in operation.newProperties && typeof operation.newProperties.value == \"object\" ? operation.newProperties.value : {}, keys = Object.keys(newValue);\n      for (const key of keys) {\n        const value2 = newValue[key];\n        patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value2, [{\n          _key: block._key\n        }, key]));\n      }\n      const value = \"value\" in operation.properties && typeof operation.properties.value == \"object\" ? operation.properties.value : {};\n      for (const key of Object.keys(value))\n        key in newValue || patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n          _key: block._key\n        }, key]));\n      return patches;\n    }\n  } else if (operation.path.length === 2) {\n    const block = children[operation.path[0]];\n    if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n      schema\n    }, block)) {\n      const child = block.children[operation.path[1]];\n      if (child) {\n        const blockKey = block._key, childKey = child._key, patches = [];\n        if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(child)) {\n          const _key = operation.newProperties._key;\n          _key !== void 0 && patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(_key, [{\n            _key: blockKey\n          }, \"children\", block.children.indexOf(child), \"_key\"]));\n          const properties = \"value\" in operation.newProperties && typeof operation.newProperties.value == \"object\" ? operation.newProperties.value : {}, keys = Object.keys(properties);\n          for (const key of keys) {\n            const value = properties[key];\n            patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [{\n              _key: blockKey\n            }, \"children\", {\n              _key: childKey\n            }, key]));\n          }\n          return patches;\n        }\n        const newPropNames = Object.keys(operation.newProperties);\n        for (const keyName of newPropNames) {\n          const value = operation.newProperties[keyName];\n          if (keyName === \"_key\") {\n            patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [{\n              _key: blockKey\n            }, \"children\", block.children.indexOf(child), keyName]));\n            continue;\n          }\n          patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(value, [{\n            _key: blockKey\n          }, \"children\", {\n            _key: childKey\n          }, keyName]));\n        }\n        const propNames = Object.keys(operation.properties);\n        for (const keyName of propNames)\n          keyName in operation.newProperties || patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n            _key: blockKey\n          }, \"children\", {\n            _key: childKey\n          }, keyName]));\n        return patches;\n      }\n      throw new Error(\"Could not find a valid child\");\n    }\n    throw new Error(\"Could not find a valid block\");\n  } else\n    throw new Error(`Unexpected path encountered: ${JSON.stringify(operation.path)}`);\n}\nfunction insertNodePatch(schema, children, operation, beforeValue) {\n  const block = beforeValue[operation.path[0]];\n  if (operation.path.length === 1) {\n    const position = operation.path[0] === 0 ? \"before\" : \"after\", beforeBlock = beforeValue[operation.path[0] - 1], targetKey = operation.path[0] === 0 ? block?._key : beforeBlock?._key;\n    return targetKey ? [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([fromSlateBlock(operation.node, schema.block.name)], position, [{\n      _key: targetKey\n    }])] : [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.setIfMissing)(beforeValue, []), (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([fromSlateBlock(operation.node, schema.block.name)], \"before\", [operation.path[0]])];\n  } else if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, block) && operation.path.length === 2 && children[operation.path[0]]) {\n    const position = block.children.length === 0 || !block.children[operation.path[1] - 1] ? \"before\" : \"after\", path = block.children.length <= 1 || !block.children[operation.path[1] - 1] ? [{\n      _key: block._key\n    }, \"children\", 0] : [{\n      _key: block._key\n    }, \"children\", {\n      _key: block.children[operation.path[1] - 1]._key\n    }];\n    if (slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(operation.node))\n      return [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([operation.node], position, path)];\n    const _type = operation.node._type, _key = operation.node._key, value = \"value\" in operation.node && typeof operation.node.value == \"object\" ? operation.node.value : {};\n    return [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([{\n      _type,\n      _key,\n      ...value\n    }], position, path)];\n  }\n  return [];\n}\nfunction splitNodePatch(schema, children, operation, beforeValue) {\n  const patches = [], splitBlock = children[operation.path[0]];\n  if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, splitBlock))\n    throw new Error(`Block with path ${JSON.stringify(operation.path[0])} is not a text block and can't be split`);\n  if (operation.path.length === 1) {\n    const oldBlock = beforeValue[operation.path[0]];\n    if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n      schema\n    }, oldBlock)) {\n      const targetValue = fromSlateBlock(children[operation.path[0] + 1], schema.block.name);\n      targetValue && (patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([targetValue], \"after\", [{\n        _key: splitBlock._key\n      }])), oldBlock.children.slice(operation.position).forEach((span) => {\n        const path = [{\n          _key: oldBlock._key\n        }, \"children\", {\n          _key: span._key\n        }];\n        patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)(path));\n      }));\n    }\n    return patches;\n  }\n  if (operation.path.length === 2) {\n    const splitSpan = splitBlock.children[operation.path[1]];\n    if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n      schema\n    }, splitSpan)) {\n      const targetSpans = fromSlateBlock({\n        ...splitBlock,\n        children: splitBlock.children.slice(operation.path[1] + 1, operation.path[1] + 2)\n      }, schema.block.name).children;\n      patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)(targetSpans, \"after\", [{\n        _key: splitBlock._key\n      }, \"children\", {\n        _key: splitSpan._key\n      }])), patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(splitSpan.text, [{\n        _key: splitBlock._key\n      }, \"children\", {\n        _key: splitSpan._key\n      }, \"text\"]));\n    }\n    return patches;\n  }\n  return patches;\n}\nfunction removeNodePatch(schema, beforeValue, operation) {\n  const block = beforeValue[operation.path[0]];\n  if (operation.path.length === 1) {\n    if (block && block._key)\n      return [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n        _key: block._key\n      }])];\n    throw new Error(\"Block not found\");\n  } else if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, block) && operation.path.length === 2) {\n    const spanToRemove = block.children[operation.path[1]];\n    return spanToRemove ? block.children.filter((span) => span._key === operation.node._key).length > 1 ? (console.warn(`Multiple spans have \\`_key\\` ${operation.node._key}. It's ambiguous which one to remove.`, JSON.stringify(block, null, 2)), []) : [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n      _key: block._key\n    }, \"children\", {\n      _key: spanToRemove._key\n    }])] : [];\n  } else\n    return [];\n}\nfunction mergeNodePatch(schema, children, operation, beforeValue) {\n  const patches = [], block = beforeValue[operation.path[0]], updatedBlock = children[operation.path[0]];\n  if (operation.path.length === 1)\n    if (block?._key) {\n      const newBlock = fromSlateBlock(children[operation.path[0] - 1], schema.block.name);\n      patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(newBlock, [{\n        _key: newBlock._key\n      }])), patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n        _key: block._key\n      }]));\n    } else\n      throw new Error(\"Target key not found!\");\n  else if ((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, block) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, updatedBlock) && operation.path.length === 2) {\n    const updatedSpan = updatedBlock.children[operation.path[1] - 1] && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n      schema\n    }, updatedBlock.children[operation.path[1] - 1]) ? updatedBlock.children[operation.path[1] - 1] : void 0, removedSpan = block.children[operation.path[1]] && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n      schema\n    }, block.children[operation.path[1]]) ? block.children[operation.path[1]] : void 0;\n    updatedSpan && (block.children.filter((span) => span._key === updatedSpan._key).length === 1 ? patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(updatedSpan.text, [{\n      _key: block._key\n    }, \"children\", {\n      _key: updatedSpan._key\n    }, \"text\"])) : console.warn(`Multiple spans have \\`_key\\` ${updatedSpan._key}. It's ambiguous which one to update.`, JSON.stringify(block, null, 2))), removedSpan && (block.children.filter((span) => span._key === removedSpan._key).length === 1 ? patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n      _key: block._key\n    }, \"children\", {\n      _key: removedSpan._key\n    }])) : console.warn(`Multiple spans have \\`_key\\` ${removedSpan._key}. It's ambiguous which one to remove.`, JSON.stringify(block, null, 2)));\n  }\n  return patches;\n}\nfunction moveNodePatch(schema, beforeValue, operation) {\n  const patches = [], block = beforeValue[operation.path[0]], targetBlock = beforeValue[operation.newPath[0]];\n  if (!targetBlock)\n    return patches;\n  if (operation.path.length === 1) {\n    const position = operation.path[0] > operation.newPath[0] ? \"before\" : \"after\";\n    patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n      _key: block._key\n    }])), patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([block], position, [{\n      _key: targetBlock._key\n    }]));\n  } else if (operation.path.length === 2 && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, block) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n    schema\n  }, targetBlock)) {\n    const child = block.children[operation.path[1]], targetChild = targetBlock.children[operation.newPath[1]], position = operation.newPath[1] === targetBlock.children.length ? \"after\" : \"before\", childToInsert = block.children[operation.path[1]];\n    patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n      _key: block._key\n    }, \"children\", {\n      _key: child._key\n    }])), patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([childToInsert], position, [{\n      _key: targetBlock._key\n    }, \"children\", {\n      _key: targetChild._key\n    }]));\n  }\n  return patches;\n}\nfunction withRemoteChanges(editor, fn) {\n  const prev = editor.isProcessingRemoteChanges;\n  editor.isProcessingRemoteChanges = !0, fn(), editor.isProcessingRemoteChanges = prev;\n}\nconst debug$8 = debugWithName(\"plugin:withPatches\");\nfunction createWithPatches({\n  editorActor,\n  relayActor,\n  subscriptions\n}) {\n  let previousValue;\n  const applyPatch = createApplyPatch(editorActor.getSnapshot().context);\n  return function(editor) {\n    previousValue = [...editor.value];\n    const {\n      apply: apply2\n    } = editor;\n    let bufferedPatches = [];\n    const handleBufferedRemotePatches = () => {\n      if (bufferedPatches.length === 0)\n        return;\n      const patches = bufferedPatches;\n      bufferedPatches = [];\n      let changed = !1;\n      withRemoteChanges(editor, () => {\n        slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(editor, () => {\n          withoutPatching(editor, () => {\n            pluginWithoutHistory(editor, () => {\n              for (const patch of patches) {\n                debug$8.enabled && debug$8(`Handling remote patch ${JSON.stringify(patch)}`);\n                try {\n                  changed = applyPatch(editor, patch);\n                } catch (error) {\n                  console.error(`Applying patch ${JSON.stringify(patch)} failed due to: ${error.message}`);\n                }\n              }\n            });\n          });\n        }), changed && (editor.normalize(), editor.onChange());\n      });\n    }, handlePatches = ({\n      patches\n    }) => {\n      const remotePatches = patches.filter((p) => p.origin !== \"local\");\n      remotePatches.length !== 0 && (bufferedPatches = bufferedPatches.concat(remotePatches), handleBufferedRemotePatches());\n    };\n    return subscriptions.push(() => {\n      debug$8(\"Subscribing to remote patches\");\n      const sub = editorActor.on(\"patches\", handlePatches);\n      return () => {\n        debug$8(\"Unsubscribing to remote patches\"), sub.unsubscribe();\n      };\n    }), editor.apply = (operation) => {\n      let patches = [];\n      previousValue = editor.value;\n      const editorWasEmpty = isEqualToEmptyEditor(editorActor.getSnapshot().context.initialValue, previousValue, editorActor.getSnapshot().context.schema);\n      apply2(operation);\n      const editorIsEmpty = isEqualToEmptyEditor(editorActor.getSnapshot().context.initialValue, editor.value, editorActor.getSnapshot().context.schema);\n      if (!editor.isPatching)\n        return editor;\n      switch (editorWasEmpty && !editorIsEmpty && operation.type !== \"set_selection\" && patches.push((0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)(previousValue, \"before\", [0])), operation.type) {\n        case \"insert_text\":\n          patches = [...patches, ...insertTextPatch(editorActor.getSnapshot().context.schema, editor.children, operation, previousValue)];\n          break;\n        case \"remove_text\":\n          patches = [...patches, ...removeTextPatch(editorActor.getSnapshot().context.schema, editor.children, operation, previousValue)];\n          break;\n        case \"remove_node\":\n          patches = [...patches, ...removeNodePatch(editorActor.getSnapshot().context.schema, previousValue, operation)];\n          break;\n        case \"split_node\":\n          patches = [...patches, ...splitNodePatch(editorActor.getSnapshot().context.schema, editor.children, operation, previousValue)];\n          break;\n        case \"insert_node\":\n          patches = [...patches, ...insertNodePatch(editorActor.getSnapshot().context.schema, editor.children, operation, previousValue)];\n          break;\n        case \"set_node\":\n          patches = [...patches, ...setNodePatch(editorActor.getSnapshot().context.schema, editor.children, operation)];\n          break;\n        case \"merge_node\":\n          patches = [...patches, ...mergeNodePatch(editorActor.getSnapshot().context.schema, editor.children, operation, previousValue)];\n          break;\n        case \"move_node\":\n          patches = [...patches, ...moveNodePatch(editorActor.getSnapshot().context.schema, previousValue, operation)];\n          break;\n      }\n      if (!editorWasEmpty && editorIsEmpty && [\"merge_node\", \"set_node\", \"remove_text\", \"remove_node\"].includes(operation.type) && (patches = [...patches, (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([])], relayActor.send({\n        type: \"unset\",\n        previousValue\n      })), editorWasEmpty && patches.length > 0 && (patches = [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.setIfMissing)([], []), ...patches]), patches.length > 0)\n        for (const patch of patches)\n          editorActor.send({\n            type: \"internal.patch\",\n            patch: {\n              ...patch,\n              origin: \"local\"\n            },\n            operationId: editor.undoStepId,\n            value: editor.value\n          });\n      return editor;\n    }, editor;\n  };\n}\nconst debug$7 = debugWithName(\"plugin:withSchemaTypes\");\nfunction createWithSchema({\n  editorActor\n}) {\n  return function(editor) {\n    editor.isTextBlock = (value) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(value) ? !1 : (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(editorActor.getSnapshot().context, value), editor.isTextSpan = (value) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(value) ? !1 : (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(editorActor.getSnapshot().context, value), editor.isListBlock = (value) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(value) ? !1 : (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(editorActor.getSnapshot().context, value), editor.isVoid = (element) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(element) ? !1 : editorActor.getSnapshot().context.schema.block.name !== element._type && (editorActor.getSnapshot().context.schema.blockObjects.map((obj) => obj.name).includes(element._type) || editorActor.getSnapshot().context.schema.inlineObjects.map((obj) => obj.name).includes(element._type)), editor.isInline = (element) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(element) ? !1 : editorActor.getSnapshot().context.schema.inlineObjects.map((obj) => obj.name).includes(element._type) && \"__inline\" in element && element.__inline === !0;\n    const {\n      normalizeNode\n    } = editor;\n    return editor.normalizeNode = (entry) => {\n      const [node, path] = entry;\n      if (node._type === void 0 && path.length === 2) {\n        debug$7(\"Setting span type on text node without a type\");\n        const span = node, key = span._key || editorActor.getSnapshot().context.keyGenerator();\n        withNormalizeNode(editor, () => {\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            ...span,\n            _type: editorActor.getSnapshot().context.schema.span.name,\n            _key: key\n          }, {\n            at: path\n          });\n        });\n        return;\n      }\n      if (node._key === void 0 && (path.length === 1 || path.length === 2)) {\n        debug$7(\"Setting missing key on child node without a key\");\n        const key = editorActor.getSnapshot().context.keyGenerator();\n        withNormalizeNode(editor, () => {\n          slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(editor, {\n            _key: key\n          }, {\n            at: path\n          });\n        });\n        return;\n      }\n      withNormalizeNode(editor, () => {\n        normalizeNode(entry);\n      });\n    }, editor;\n  };\n}\nfunction pluginUpdateSelection({\n  editor,\n  editorActor\n}) {\n  const updateSelection = () => {\n    if (editor.selection)\n      if (editor.selection === editor.lastSlateSelection)\n        editorActor.send({\n          type: \"update selection\",\n          selection: editor.lastSelection\n        });\n      else {\n        const selection = slateRangeToSelection({\n          schema: editorActor.getSnapshot().context.schema,\n          editor,\n          range: editor.selection\n        });\n        editor.lastSlateSelection = editor.selection, editor.lastSelection = selection, editorActor.send({\n          type: \"update selection\",\n          selection\n        });\n      }\n    else\n      editorActor.send({\n        type: \"update selection\",\n        selection: null\n      });\n  }, {\n    onChange\n  } = editor;\n  return editor.onChange = () => {\n    onChange(), editorActor.getSnapshot().matches({\n      setup: \"setting up\"\n    }) || updateSelection();\n  }, editor;\n}\nfunction isEditorNode(node) {\n  return typeof node == \"object\" && node !== null ? !(\"_type\" in node) && \"children\" in node && Array.isArray(node.children) : !1;\n}\nfunction isTextBlockNode(context, node) {\n  return (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isTypedObject)(node) && node._type === context.schema.block.name;\n}\nfunction isSpanNode(context, node) {\n  return typeof node != \"object\" || node === null || \"children\" in node ? !1 : \"_type\" in node ? node._type === context.schema.span.name : \"text\" in node;\n}\nfunction isPartialSpanNode(node) {\n  return typeof node == \"object\" && node !== null && \"text\" in node && typeof node.text == \"string\";\n}\nfunction isObjectNode(context, node) {\n  return !isEditorNode(node) && !isTextBlockNode(context, node) && !isSpanNode(context, node) && !isPartialSpanNode(node);\n}\nfunction getBlock(root, path) {\n  const index = path.at(0);\n  if (!(index === void 0 || path.length !== 1))\n    return root.children.at(index);\n}\nfunction getNode(context, root, path) {\n  if (path.length === 0)\n    return root;\n  if (path.length === 1)\n    return getBlock(root, path);\n  if (path.length === 2) {\n    const block = getBlock(root, path.slice(0, 1));\n    return !block || !isTextBlockNode(context, block) ? void 0 : block.children.at(path[1]) || void 0;\n  }\n}\nfunction getSpan(context, root, path) {\n  const node = getNode(context, root, path);\n  if (node && isSpanNode(context, node))\n    return node;\n}\nfunction getParent(context, root, path) {\n  if (path.length === 0)\n    return;\n  const parentPath = path.slice(0, -1);\n  if (parentPath.length === 0)\n    return root;\n  const blockIndex = parentPath.at(0);\n  if (blockIndex === void 0 || parentPath.length !== 1)\n    return;\n  const block = root.children.at(blockIndex);\n  if (block && isTextBlockNode(context, block))\n    return block;\n}\nfunction applyOperationToPortableText(context, value, operation) {\n  const root = {\n    children: value\n  };\n  try {\n    return applyOperationToPortableTextImmutable(context, root, operation).children;\n  } catch (e) {\n    return console.error(e), value;\n  }\n}\nfunction applyOperationToPortableTextImmutable(context, root, operation) {\n  switch (operation.type) {\n    case \"insert_node\": {\n      const {\n        path,\n        node: insertedNode\n      } = operation, parent = getParent(context, root, path), index = path[path.length - 1];\n      if (!parent || index > parent.children.length)\n        return root;\n      if (path.length === 1) {\n        if (isTextBlockNode(context, insertedNode)) {\n          const newBlock = {\n            ...insertedNode,\n            children: insertedNode.children.map((child) => \"__inline\" in child ? {\n              _key: child._key,\n              _type: child._type,\n              ...\"value\" in child && typeof child.value == \"object\" ? child.value : {}\n            } : child)\n          };\n          return {\n            ...root,\n            children: insertChildren(root.children, index, newBlock)\n          };\n        }\n        if (slate__WEBPACK_IMPORTED_MODULE_5__.Element.isElement(insertedNode) && !(\"__inline\" in insertedNode)) {\n          const newBlock = {\n            _key: insertedNode._key,\n            _type: insertedNode._type,\n            ...\"value\" in insertedNode && typeof insertedNode.value == \"object\" ? insertedNode.value : {}\n          };\n          return {\n            ...root,\n            children: insertChildren(root.children, index, newBlock)\n          };\n        }\n      }\n      if (path.length === 2) {\n        const blockIndex = path[0];\n        if (!isTextBlockNode(context, parent))\n          return root;\n        let newChild;\n        if (isPartialSpanNode(insertedNode))\n          newChild = insertedNode;\n        else if (\"__inline\" in insertedNode)\n          newChild = {\n            _key: insertedNode._key,\n            _type: insertedNode._type,\n            ...\"value\" in insertedNode && typeof insertedNode.value == \"object\" ? insertedNode.value : {}\n          };\n        else\n          return root;\n        return updateTextBlockAtIndex(context, root, blockIndex, (block) => ({\n          ...block,\n          children: insertChildren(block.children, index, newChild)\n        }));\n      }\n      return root;\n    }\n    case \"insert_text\": {\n      const {\n        path,\n        offset,\n        text\n      } = operation;\n      if (text.length === 0)\n        return root;\n      const span = getSpan(context, root, path);\n      if (!span)\n        return root;\n      const blockIndex = path[0], childIndex = path[1], before = span.text.slice(0, offset), after = span.text.slice(offset), newSpan = {\n        ...span,\n        text: before + text + after\n      };\n      return updateTextBlockAtIndex(context, root, blockIndex, (block) => ({\n        ...block,\n        children: replaceChild(block.children, childIndex, newSpan)\n      }));\n    }\n    case \"merge_node\": {\n      const {\n        path\n      } = operation;\n      if (path.at(-1) === 0)\n        return root;\n      const node = getNode(context, root, path), prevPath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.previous(path), prev = getNode(context, root, prevPath), parent = getParent(context, root, path);\n      if (!node || !prev || !parent)\n        return root;\n      const index = path[path.length - 1];\n      if (isPartialSpanNode(node) && isPartialSpanNode(prev)) {\n        const blockIndex = path[0], newPrev = {\n          ...prev,\n          text: prev.text + node.text\n        };\n        return updateTextBlockAtIndex(context, root, blockIndex, (block) => {\n          const newChildren = replaceChild(block.children, index - 1, newPrev);\n          return {\n            ...block,\n            children: removeChildren(newChildren, index)\n          };\n        });\n      }\n      if (isTextBlockNode(context, node) && isTextBlockNode(context, prev)) {\n        const newPrev = {\n          ...prev,\n          children: [...prev.children, ...node.children]\n        }, newChildren = replaceChild(root.children, index - 1, newPrev);\n        return {\n          ...root,\n          children: removeChildren(newChildren, index)\n        };\n      }\n      return root;\n    }\n    case \"move_node\": {\n      const {\n        path,\n        newPath\n      } = operation;\n      if (slate__WEBPACK_IMPORTED_MODULE_5__.Path.isAncestor(path, newPath))\n        return root;\n      const node = getNode(context, root, path), parent = getParent(context, root, path), index = path[path.length - 1];\n      if (!node || !parent)\n        return root;\n      let newRoot;\n      if (path.length === 1)\n        newRoot = {\n          ...root,\n          children: removeChildren(root.children, index)\n        };\n      else if (path.length === 2) {\n        const blockIndex = path[0];\n        newRoot = updateTextBlockAtIndex(context, root, blockIndex, (block) => ({\n          ...block,\n          children: removeChildren(block.children, index)\n        }));\n      } else\n        return root;\n      const truePath = slate__WEBPACK_IMPORTED_MODULE_5__.Path.transform(path, operation), newIndex = truePath[truePath.length - 1];\n      if (truePath.length === 1)\n        return {\n          ...newRoot,\n          children: insertChildren(newRoot.children, newIndex, node)\n        };\n      if (truePath.length === 2) {\n        const newBlockIndex = truePath[0], newParent = newRoot.children[newBlockIndex];\n        return !newParent || !isTextBlockNode(context, newParent) ? root : updateTextBlockAtIndex(context, newRoot, newBlockIndex, (block) => ({\n          ...block,\n          children: insertChildren(block.children, newIndex, node)\n        }));\n      }\n      return root;\n    }\n    case \"remove_node\": {\n      const {\n        path\n      } = operation, index = path[path.length - 1];\n      if (!getParent(context, root, path))\n        return root;\n      if (path.length === 1)\n        return {\n          ...root,\n          children: removeChildren(root.children, index)\n        };\n      if (path.length === 2) {\n        const blockIndex = path[0];\n        return updateTextBlockAtIndex(context, root, blockIndex, (block) => ({\n          ...block,\n          children: removeChildren(block.children, index)\n        }));\n      }\n      return root;\n    }\n    case \"remove_text\": {\n      const {\n        path,\n        offset,\n        text\n      } = operation;\n      if (text.length === 0)\n        return root;\n      const span = getSpan(context, root, path);\n      if (!span)\n        return root;\n      const blockIndex = path[0], childIndex = path[1], before = span.text.slice(0, offset), after = span.text.slice(offset + text.length), newSpan = {\n        ...span,\n        text: before + after\n      };\n      return updateTextBlockAtIndex(context, root, blockIndex, (block) => ({\n        ...block,\n        children: replaceChild(block.children, childIndex, newSpan)\n      }));\n    }\n    case \"set_node\": {\n      const {\n        path,\n        properties,\n        newProperties\n      } = operation, node = getNode(context, root, path);\n      if (!node || isEditorNode(node))\n        return root;\n      if (isObjectNode(context, node)) {\n        const valueBefore = \"value\" in properties && typeof properties.value == \"object\" ? properties.value : {}, valueAfter = \"value\" in newProperties && typeof newProperties.value == \"object\" ? newProperties.value : {}, newNode = {\n          ...node\n        };\n        for (const key in newProperties) {\n          if (key === \"value\")\n            continue;\n          const value = newProperties[key];\n          value == null ? delete newNode[key] : newNode[key] = value;\n        }\n        for (const key in properties)\n          key !== \"value\" && (newProperties.hasOwnProperty(key) || delete newNode[key]);\n        for (const key in valueAfter) {\n          const value = valueAfter[key];\n          value == null ? delete newNode[key] : newNode[key] = value;\n        }\n        for (const key in valueBefore)\n          valueAfter.hasOwnProperty(key) || delete newNode[key];\n        return path.length === 1 ? {\n          ...root,\n          children: replaceChild(root.children, path[0], newNode)\n        } : path.length === 2 ? updateTextBlockAtIndex(context, root, path[0], (block) => ({\n          ...block,\n          children: replaceChild(block.children, path[1], newNode)\n        })) : root;\n      }\n      if (isTextBlockNode(context, node)) {\n        const newNode = {\n          ...node\n        };\n        for (const key in newProperties) {\n          if (key === \"children\" || key === \"text\")\n            continue;\n          const value = newProperties[key];\n          value == null ? delete newNode[key] : newNode[key] = value;\n        }\n        for (const key in properties)\n          newProperties.hasOwnProperty(key) || delete newNode[key];\n        return {\n          ...root,\n          children: replaceChild(root.children, path[0], newNode)\n        };\n      }\n      if (isPartialSpanNode(node)) {\n        const newNode = {\n          ...node\n        };\n        for (const key in newProperties) {\n          if (key === \"text\")\n            continue;\n          const value = newProperties[key];\n          value == null ? delete newNode[key] : newNode[key] = value;\n        }\n        for (const key in properties)\n          newProperties.hasOwnProperty(key) || delete newNode[key];\n        return updateTextBlockAtIndex(context, root, path[0], (block) => ({\n          ...block,\n          children: replaceChild(block.children, path[1], newNode)\n        }));\n      }\n      return root;\n    }\n    case \"split_node\": {\n      const {\n        path,\n        position,\n        properties\n      } = operation;\n      if (path.length === 0)\n        return root;\n      const parent = getParent(context, root, path), index = path[path.length - 1];\n      if (!parent)\n        return root;\n      if (isEditorNode(parent)) {\n        const block = getBlock(root, path);\n        if (!block || !isTextBlockNode(context, block))\n          return root;\n        const before = block.children.slice(0, position), after = block.children.slice(position), updatedTextBlockNode = {\n          ...block,\n          children: before\n        }, newTextBlockNode = {\n          ...properties,\n          children: after,\n          _type: context.schema.block.name\n        };\n        return {\n          ...root,\n          children: insertChildren(replaceChild(root.children, index, updatedTextBlockNode), index + 1, newTextBlockNode)\n        };\n      }\n      if (isTextBlockNode(context, parent)) {\n        const node = getNode(context, root, path);\n        if (!node || !isSpanNode(context, node))\n          return root;\n        const blockIndex = path[0], before = node.text.slice(0, position), after = node.text.slice(position), updatedSpanNode = {\n          ...node,\n          text: before\n        }, newSpanNode = {\n          ...properties,\n          text: after\n        };\n        return updateTextBlockAtIndex(context, root, blockIndex, (block) => ({\n          ...block,\n          children: insertChildren(replaceChild(block.children, index, updatedSpanNode), index + 1, newSpanNode)\n        }));\n      }\n      return root;\n    }\n  }\n}\nfunction insertChildren(children, index, ...nodes) {\n  return [...children.slice(0, index), ...nodes, ...children.slice(index)];\n}\nfunction removeChildren(children, index, count = 1) {\n  return [...children.slice(0, index), ...children.slice(index + count)];\n}\nfunction replaceChild(children, index, newChild) {\n  return [...children.slice(0, index), newChild, ...children.slice(index + 1)];\n}\nfunction updateTextBlockAtIndex(context, root, blockIndex, updater) {\n  const block = root.children.at(blockIndex);\n  if (!block || !isTextBlockNode(context, block))\n    return root;\n  const newBlock = updater(block);\n  return {\n    ...root,\n    children: replaceChild(root.children, blockIndex, newBlock)\n  };\n}\nfunction pluginUpdateValue(context, editor) {\n  const {\n    apply: apply2\n  } = editor;\n  return editor.apply = (operation) => {\n    if (operation.type === \"set_selection\") {\n      apply2(operation);\n      return;\n    }\n    if (editor.value = applyOperationToPortableText(context, editor.value, operation), operation.type === \"insert_text\" || operation.type === \"remove_text\") {\n      apply2(operation);\n      return;\n    }\n    buildIndexMaps({\n      schema: context.schema,\n      value: editor.value\n    }, {\n      blockIndexMap: editor.blockIndexMap,\n      listIndexMap: editor.listIndexMap\n    }), apply2(operation);\n  }, editor;\n}\nconst withPlugins = (editor, options) => {\n  const e = editor, {\n    editorActor,\n    relayActor\n  } = options, withObjectKeys = createWithObjectKeys(editorActor), withSchema = createWithSchema({\n    editorActor\n  }), withPatches = createWithPatches({\n    editorActor,\n    relayActor,\n    subscriptions: options.subscriptions\n  }), withUndoRedo = pluginHistory({\n    editorActor,\n    subscriptions: options.subscriptions\n  }), withNormalize = createWithNormalize(editorActor);\n  return createWithEventListeners(editorActor)(withSchema(withObjectKeys(withNormalize(withUndoRedo(withPatches(pluginUpdateValue(editorActor.getSnapshot().context, pluginUpdateSelection({\n    editorActor,\n    editor: e\n  }))))))));\n}, debug$6 = debugWithName(\"setup\");\nfunction createSlateEditor(config) {\n  debug$6(\"Creating new Slate editor instance\");\n  const placeholderBlock = createPlaceholderBlock(config.editorActor.getSnapshot().context), editor = (0,slate__WEBPACK_IMPORTED_MODULE_5__.createEditor)();\n  editor.decoratedRanges = [], editor.decoratorState = {}, editor.blockIndexMap = /* @__PURE__ */ new Map(), editor.history = {\n    undos: [],\n    redos: []\n  }, editor.lastSelection = null, editor.lastSlateSelection = null, editor.listIndexMap = /* @__PURE__ */ new Map(), editor.remotePatches = [], editor.undoStepId = void 0, editor.value = [placeholderBlock], editor.isNormalizingNode = !1, editor.isPatching = !0, editor.isPerformingBehaviorOperation = !1, editor.isProcessingRemoteChanges = !1, editor.isRedoing = !1, editor.isUndoing = !1, editor.withHistory = !0;\n  const instance = withPlugins((0,slate_react__WEBPACK_IMPORTED_MODULE_15__.withReact)(editor), {\n    editorActor: config.editorActor,\n    relayActor: config.relayActor,\n    subscriptions: config.subscriptions\n  });\n  return buildIndexMaps({\n    schema: config.editorActor.getSnapshot().context.schema,\n    value: instance.value\n  }, {\n    blockIndexMap: instance.blockIndexMap,\n    listIndexMap: instance.listIndexMap\n  }), {\n    instance,\n    initialValue: [placeholderBlock]\n  };\n}\nfunction createEditorDom(sendBack, slateEditor) {\n  return {\n    getBlockNodes: (snapshot) => getBlockNodes(slateEditor, snapshot),\n    getChildNodes: (snapshot) => getChildNodes(slateEditor, snapshot),\n    getEditorElement: () => getEditorElement(slateEditor),\n    getSelectionRect: (snapshot) => getSelectionRect(snapshot),\n    getStartBlockElement: (snapshot) => getStartBlockElement(slateEditor, snapshot),\n    getEndBlockElement: (snapshot) => getEndBlockElement(slateEditor, snapshot),\n    setDragGhost: ({\n      event,\n      ghost\n    }) => setDragGhost({\n      sendBack,\n      event,\n      ghost\n    })\n  };\n}\nfunction getBlockNodes(slateEditor, snapshot) {\n  if (!snapshot.context.selection)\n    return [];\n  const range = toSlateRange(snapshot);\n  if (!range)\n    return [];\n  try {\n    return Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(slateEditor, {\n      at: range,\n      mode: \"highest\",\n      match: (n) => !slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(n)\n    })).map(([blockNode]) => slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMNode(slateEditor, blockNode));\n  } catch {\n    return [];\n  }\n}\nfunction getChildNodes(slateEditor, snapshot) {\n  if (!snapshot.context.selection)\n    return [];\n  const range = toSlateRange(snapshot);\n  if (!range)\n    return [];\n  try {\n    return Array.from(slate__WEBPACK_IMPORTED_MODULE_5__.Editor.nodes(slateEditor, {\n      at: range,\n      mode: \"lowest\",\n      match: (n) => !slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isEditor(n)\n    })).map(([childNode]) => slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMNode(slateEditor, childNode));\n  } catch {\n    return [];\n  }\n}\nfunction getEditorElement(slateEditor) {\n  try {\n    return slate_dom__WEBPACK_IMPORTED_MODULE_7__.DOMEditor.toDOMNode(slateEditor, slateEditor);\n  } catch {\n    return;\n  }\n}\nfunction getSelectionRect(snapshot) {\n  if (!snapshot.context.selection)\n    return null;\n  try {\n    const selection = window.getSelection();\n    return selection ? selection.getRangeAt(0).getBoundingClientRect() : null;\n  } catch {\n    return null;\n  }\n}\nfunction getStartBlockElement(slateEditor, snapshot) {\n  const startBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartBlock)(snapshot);\n  if (!startBlock)\n    return null;\n  const startBlockNode = getBlockNodes(slateEditor, {\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: {\n          path: startBlock.path,\n          offset: 0\n        },\n        focus: {\n          path: startBlock.path,\n          offset: 0\n        }\n      }\n    }\n  })?.at(0);\n  return startBlockNode && startBlockNode instanceof Element ? startBlockNode : null;\n}\nfunction getEndBlockElement(slateEditor, snapshot) {\n  const endBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndBlock)(snapshot);\n  if (!endBlock)\n    return null;\n  const endBlockNode = getBlockNodes(slateEditor, {\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: {\n          path: endBlock.path,\n          offset: 0\n        },\n        focus: {\n          path: endBlock.path,\n          offset: 0\n        }\n      }\n    }\n  })?.at(0);\n  return endBlockNode && endBlockNode instanceof Element ? endBlockNode : null;\n}\nfunction setDragGhost({\n  sendBack,\n  event,\n  ghost\n}) {\n  event.originEvent.dataTransfer.setDragImage(ghost.element, ghost.x, ghost.y), sendBack({\n    type: \"set drag ghost\",\n    ghost: ghost.element\n  });\n}\nconst addAnnotationOnCollapsedSelection = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"annotation.add\",\n  guard: ({\n    snapshot\n  }) => {\n    if (!(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot))\n      return !1;\n    const caretWordSelection = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getCaretWordSelection)(snapshot);\n    return !caretWordSelection || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)({\n      context: {\n        ...snapshot.context,\n        selection: caretWordSelection\n      }\n    }) ? !1 : {\n      caretWordSelection\n    };\n  },\n  actions: [({\n    event\n  }, {\n    caretWordSelection\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: caretWordSelection\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"annotation.add\",\n    annotation: event.annotation\n  })]]\n}), preventOverlappingAnnotations = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  // Given an `annotation.add` event\n  on: \"annotation.add\",\n  // When the annotation is active in the selection\n  guard: ({\n    snapshot,\n    event\n  }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveAnnotation)(event.annotation.name, {\n    mode: \"partial\"\n  })(snapshot),\n  // Then the existing annotation is removed\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"annotation.remove\",\n    annotation: event.annotation\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(event)]]\n}), stripAnnotationsOnFullSpanDeletion = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const effectiveSnapshot = {\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: event.at ?? snapshot.context.selection\n      }\n    };\n    if (!(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(effectiveSnapshot))\n      return !1;\n    const startChild = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartChild)(effectiveSnapshot), startPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartPoint)(effectiveSnapshot), endChild = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndChild)(effectiveSnapshot), endPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndPoint)(effectiveSnapshot);\n    if (!startChild || !endChild || !startPoint || !endPoint || startChild.path[2]._key !== endChild.path[2]._key || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(snapshot.context, startChild.node) || !(startPoint.offset === 0 && endPoint.offset === startChild.node.text.length))\n      return !1;\n    const decorators = snapshot.context.schema.decorators.map((decorator) => decorator.name), marks = startChild.node.marks ?? [];\n    if (!marks.some((mark) => !decorators.includes(mark)))\n      return !1;\n    const previousSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousSpan)(effectiveSnapshot), nextSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextSpan)(effectiveSnapshot), previousSpanHasSameAnnotation = previousSpan ? previousSpan.node.marks?.some((mark) => !decorators.includes(mark) && marks.includes(mark)) : !1, nextSpanHasSameAnnotation = nextSpan ? nextSpan.node.marks?.some((mark) => !decorators.includes(mark) && marks.includes(mark)) : !1;\n    if (previousSpanHasSameAnnotation || nextSpanHasSameAnnotation)\n      return !1;\n    const activeDecorators = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveDecorators)(effectiveSnapshot);\n    return {\n      spanPath: startChild.path,\n      activeDecorators\n    };\n  },\n  actions: [({\n    event\n  }, {\n    spanPath,\n    activeDecorators\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"child.set\",\n    at: spanPath,\n    props: {\n      marks: activeDecorators\n    }\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)]]\n}), coreAnnotationBehaviors = [addAnnotationOnCollapsedSelection, preventOverlappingAnnotations, stripAnnotationsOnFullSpanDeletion], defaultKeyboardShortcuts = {\n  arrowDown: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"ArrowDown\",\n      alt: !1,\n      ctrl: !1,\n      meta: !1,\n      shift: !1\n    }]\n  }),\n  arrowUp: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"ArrowUp\",\n      alt: !1,\n      ctrl: !1,\n      meta: !1,\n      shift: !1\n    }]\n  }),\n  backspace: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"Backspace\",\n      alt: !1,\n      ctrl: !1,\n      meta: !1,\n      shift: !1\n    }]\n  }),\n  break: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"Enter\",\n      shift: !1\n    }]\n  }),\n  lineBreak: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"Enter\",\n      shift: !0\n    }]\n  }),\n  decorators: {\n    strong: _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.bold,\n    em: _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.italic,\n    underline: _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.underline,\n    code: _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.code\n  },\n  delete: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"Delete\",\n      alt: !1,\n      ctrl: !1,\n      meta: !1,\n      shift: !1\n    }]\n  }),\n  deleteWord: {\n    backward: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n      default: [{\n        key: \"Backspace\",\n        alt: !1,\n        ctrl: !0,\n        meta: !1\n        // shift is optional\n      }],\n      apple: [{\n        key: \"Backspace\",\n        alt: !0,\n        ctrl: !1,\n        meta: !1\n        // shift is optional\n      }]\n    }),\n    forward: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n      default: [{\n        key: \"Delete\",\n        alt: !1,\n        ctrl: !0,\n        meta: !1\n        // shift is optional\n      }],\n      apple: [{\n        key: \"Delete\",\n        alt: !0,\n        ctrl: !1,\n        meta: !1\n        // shift is optional\n      }]\n    })\n  },\n  history: {\n    undo: _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.undo,\n    redo: _portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.redo\n  },\n  tab: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"Tab\",\n      alt: !1,\n      ctrl: !1,\n      meta: !1,\n      shift: !1\n    }]\n  }),\n  shiftTab: (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n    default: [{\n      key: \"Tab\",\n      alt: !1,\n      ctrl: !1,\n      meta: !1,\n      shift: !0\n    }]\n  })\n}, arrowDownOnLonelyBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"keyboard.keydown\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (!defaultKeyboardShortcuts.arrowDown.guard(event.originEvent) || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot))\n      return !1;\n    const focusBlockObject = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlockObject)(snapshot), nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)(snapshot);\n    return focusBlockObject && !nextBlock;\n  },\n  actions: [({\n    snapshot\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name\n    },\n    placement: \"after\"\n  })]]\n}), arrowUpOnLonelyBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"keyboard.keydown\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (!defaultKeyboardShortcuts.arrowUp.guard(event.originEvent) || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot))\n      return !1;\n    const focusBlockObject = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlockObject)(snapshot), previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)(snapshot);\n    return focusBlockObject && !previousBlock;\n  },\n  actions: [({\n    snapshot\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name\n    },\n    placement: \"before\"\n  })]]\n}), breakingBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.break\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusBlockObject = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlockObject)(snapshot);\n    return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot) && focusBlockObject !== void 0;\n  },\n  actions: [({\n    snapshot\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name\n    },\n    placement: \"after\"\n  })]]\n}), clickingAboveLonelyBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"mouse.click\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (snapshot.context.readOnly || snapshot.context.selection && !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot))\n      return !1;\n    const focusBlockObject = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlockObject)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: event.position.selection\n      }\n    }), previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: event.position.selection\n      }\n    });\n    return event.position.isEditor && event.position.block === \"start\" && focusBlockObject && !previousBlock;\n  },\n  actions: [({\n    snapshot,\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: event.position.selection\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name\n    },\n    placement: \"before\",\n    select: \"start\"\n  })]]\n}), clickingBelowLonelyBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"mouse.click\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (snapshot.context.readOnly || snapshot.context.selection && !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot))\n      return !1;\n    const focusBlockObject = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlockObject)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: event.position.selection\n      }\n    }), nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: event.position.selection\n      }\n    });\n    return event.position.isEditor && event.position.block === \"end\" && focusBlockObject && !nextBlock;\n  },\n  actions: [({\n    snapshot,\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: event.position.selection\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name\n    },\n    placement: \"after\",\n    select: \"start\"\n  })]]\n}), deletingEmptyTextBlockAfterBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.backward\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot), selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot), previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)(snapshot);\n    return !focusTextBlock || !selectionCollapsed || !previousBlock ? !1 : (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusTextBlock.node) && !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, previousBlock.node) ? {\n      focusTextBlock,\n      previousBlock\n    } : !1;\n  },\n  actions: [(_, {\n    focusTextBlock,\n    previousBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: focusTextBlock.path\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: {\n        path: previousBlock.path,\n        offset: 0\n      },\n      focus: {\n        path: previousBlock.path,\n        offset: 0\n      }\n    }\n  })]]\n}), deletingEmptyTextBlockBeforeBlockObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.forward\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot), selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot), nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)(snapshot);\n    return !focusTextBlock || !selectionCollapsed || !nextBlock ? !1 : (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusTextBlock.node) && !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, nextBlock.node) ? {\n      focusTextBlock,\n      nextBlock\n    } : !1;\n  },\n  actions: [(_, {\n    focusTextBlock,\n    nextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: focusTextBlock.path\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: {\n        path: nextBlock.path,\n        offset: 0\n      },\n      focus: {\n        path: nextBlock.path,\n        offset: 0\n      }\n    }\n  })]]\n}), coreBlockObjectBehaviors = {\n  arrowDownOnLonelyBlockObject,\n  arrowUpOnLonelyBlockObject,\n  breakingBlockObject,\n  clickingAboveLonelyBlockObject,\n  clickingBelowLonelyBlockObject,\n  deletingEmptyTextBlockAfterBlockObject,\n  deletingEmptyTextBlockBeforeBlockObject\n}, coreDecoratorBehaviors = {\n  strongShortcut: (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.decorators.strong.guard(event.originEvent) && snapshot.context.schema.decorators.some((decorator) => decorator.name === \"strong\"),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"decorator.toggle\",\n      decorator: \"strong\"\n    })]]\n  }),\n  emShortcut: (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.decorators.em.guard(event.originEvent) && snapshot.context.schema.decorators.some((decorator) => decorator.name === \"em\"),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"decorator.toggle\",\n      decorator: \"em\"\n    })]]\n  }),\n  underlineShortcut: (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.decorators.underline.guard(event.originEvent) && snapshot.context.schema.decorators.some((decorator) => decorator.name === \"underline\"),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"decorator.toggle\",\n      decorator: \"underline\"\n    })]]\n  }),\n  codeShortcut: (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.decorators.code.guard(event.originEvent) && snapshot.context.schema.decorators.some((decorator) => decorator.name === \"code\"),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"decorator.toggle\",\n      decorator: \"code\"\n    })]]\n  })\n};\nfunction getCompoundClientRect(nodes) {\n  if (nodes.length === 0)\n    return new DOMRect(0, 0, 0, 0);\n  const elements = nodes.filter((node) => node instanceof Element), firstRect = elements.at(0)?.getBoundingClientRect();\n  if (!firstRect)\n    return new DOMRect(0, 0, 0, 0);\n  let left = firstRect.left, top = firstRect.top, right = firstRect.right, bottom = firstRect.bottom;\n  for (let i = 1; i < elements.length; i++) {\n    const rect = elements[i].getBoundingClientRect();\n    left = Math.min(left, rect.left), top = Math.min(top, rect.top), right = Math.max(right, rect.right), bottom = Math.max(bottom, rect.bottom);\n  }\n  return new DOMRect(left, top, right - left, bottom - top);\n}\nconst coreDndBehaviors = [\n  /**\n   * Core Behavior that:\n   * 1. Calculates and selects a \"drag selection\"\n   * 2. Constructs and sets a drag ghost element\n   * 3. Forwards the dragstart event\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"drag.dragstart\",\n    guard: ({\n      snapshot,\n      dom,\n      event\n    }) => {\n      const dragSelection = getDragSelection({\n        snapshot,\n        eventSelection: event.position.selection\n      }), selectingEntireBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectingEntireBlocks)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: dragSelection\n        }\n      }), draggedDomNodes = {\n        blockNodes: dom.getBlockNodes({\n          ...snapshot,\n          context: {\n            ...snapshot.context,\n            selection: dragSelection\n          }\n        }),\n        childNodes: dom.getChildNodes({\n          ...snapshot,\n          context: {\n            ...snapshot.context,\n            selection: dragSelection\n          }\n        })\n      };\n      return {\n        dragSelection,\n        draggedDomNodes,\n        selectingEntireBlocks\n      };\n    },\n    actions: [({\n      dom,\n      event\n    }, {\n      dragSelection,\n      draggedDomNodes,\n      selectingEntireBlocks\n    }) => {\n      const dragGhost = document.createElement(\"div\");\n      if (selectingEntireBlocks) {\n        const clonedBlockNodes = draggedDomNodes.blockNodes.map((node) => node.cloneNode(!0));\n        for (const block of clonedBlockNodes)\n          block instanceof HTMLElement && (block.style.position = \"relative\"), dragGhost.appendChild(block);\n        const customGhost = dragGhost.querySelector(\"[data-pt-drag-ghost-element]\");\n        if (customGhost && dragGhost.replaceChildren(customGhost), dragGhost.setAttribute(\"data-dragged\", \"\"), dragGhost.style.position = \"absolute\", dragGhost.style.left = \"-99999px\", dragGhost.style.boxSizing = \"border-box\", document.body.appendChild(dragGhost), customGhost) {\n          const customGhostRect = customGhost.getBoundingClientRect(), x = event.originEvent.clientX - customGhostRect.left, y = event.originEvent.clientY - customGhostRect.top;\n          return dragGhost.style.width = `${customGhostRect.width}px`, dragGhost.style.height = `${customGhostRect.height}px`, [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n            type: \"select\",\n            at: dragSelection\n          }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.effect)(() => {\n            dom.setDragGhost({\n              event,\n              ghost: {\n                element: dragGhost,\n                x,\n                y\n              }\n            });\n          }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)];\n        } else {\n          const blocksDomRect = getCompoundClientRect(draggedDomNodes.blockNodes), x = event.originEvent.clientX - blocksDomRect.left, y = event.originEvent.clientY - blocksDomRect.top;\n          return dragGhost.style.width = `${blocksDomRect.width}px`, dragGhost.style.height = `${blocksDomRect.height}px`, [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n            type: \"select\",\n            at: dragSelection\n          }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.effect)(() => {\n            dom.setDragGhost({\n              event,\n              ghost: {\n                element: dragGhost,\n                x,\n                y\n              }\n            });\n          }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)];\n        }\n      } else {\n        const clonedChildNodes = draggedDomNodes.childNodes.map((node) => node.cloneNode(!0));\n        for (const child of clonedChildNodes)\n          dragGhost.appendChild(child);\n        dragGhost.style.position = \"absolute\", dragGhost.style.left = \"-99999px\", dragGhost.style.boxSizing = \"border-box\", document.body.appendChild(dragGhost);\n        const childrenDomRect = getCompoundClientRect(draggedDomNodes.childNodes), x = event.originEvent.clientX - childrenDomRect.left, y = event.originEvent.clientY - childrenDomRect.top;\n        return dragGhost.style.width = `${childrenDomRect.width}px`, dragGhost.style.height = `${childrenDomRect.height}px`, [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n          type: \"select\",\n          at: dragSelection\n        }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.effect)(() => {\n          dom.setDragGhost({\n            event,\n            ghost: {\n              element: dragGhost,\n              x,\n              y\n            }\n          });\n        }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)];\n      }\n    }]\n  }),\n  /**\n   * When dragging over the drag origin, we don't want to show the caret in the\n   * text.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"drag.dragover\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const dragOrigin = event.dragOrigin;\n      return dragOrigin ? (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isOverlappingSelection)(event.position.selection)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: dragOrigin.selection\n        }\n      }) : !1;\n    },\n    actions: []\n  }),\n  /**\n   * If the drop position overlaps the drag origin, then the event should be\n   * cancelled.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"drag.drop\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const dragOrigin = event.dragOrigin, dropPosition = event.position.selection;\n      return dragOrigin ? (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isOverlappingSelection)(dropPosition)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: dragOrigin.selection\n        }\n      }) : !1;\n    },\n    actions: []\n  }),\n  /**\n   * If we drop and have access to a drag origin, then we can deserialize\n   * without creating a new selection.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"drag.drop\",\n    guard: ({\n      event\n    }) => event.dragOrigin !== void 0,\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"deserialize\",\n      originEvent: event\n    })]]\n  }),\n  /**\n   * Otherwise, we should to create a new selection.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"drag.drop\",\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: event.position.selection\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"deserialize\",\n      originEvent: event\n    })]]\n  }),\n  /**\n   * Core Behavior that uses the drag origin to mimic a move operation during\n   * internal dragging.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialization.success\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (event.originEvent.type !== \"drag.drop\" || event.originEvent.dragOrigin === void 0)\n        return !1;\n      const dragOrigin = event.originEvent.dragOrigin, dragSelection = getDragSelection({\n        eventSelection: dragOrigin.selection,\n        snapshot\n      }), dropPosition = event.originEvent.position.selection, droppingOnDragOrigin = dragOrigin ? (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isOverlappingSelection)(dropPosition)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: dragSelection\n        }\n      }) : !1, draggingEntireBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectingEntireBlocks)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: dragSelection\n        }\n      }), draggedBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: dragSelection\n        }\n      });\n      return droppingOnDragOrigin ? !1 : {\n        dropPosition,\n        draggingEntireBlocks,\n        draggedBlocks,\n        dragOrigin,\n        originEvent: event.originEvent\n      };\n    },\n    actions: [({\n      event\n    }, {\n      draggingEntireBlocks,\n      draggedBlocks,\n      dragOrigin,\n      dropPosition,\n      originEvent\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: dropPosition\n    }), ...draggingEntireBlocks ? draggedBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.block\",\n      at: block.path\n    })) : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\",\n      at: dragOrigin.selection\n    })], (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.blocks\",\n      blocks: event.data,\n      placement: draggingEntireBlocks ? originEvent.position.block === \"start\" ? \"before\" : originEvent.position.block === \"end\" ? \"after\" : \"auto\" : \"auto\"\n    })]]\n  })\n], coreInsertBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.text\",\n  guard: ({\n    snapshot\n  }) => {\n    if (!(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshot))\n      return !1;\n    const markState = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getMarkState)(snapshot), activeDecorators = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveDecorators)(snapshot), activeAnnotations = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveAnnotationsMarks)(snapshot);\n    if (markState && markState.state === \"unchanged\") {\n      const markStateDecorators = (markState.marks ?? []).filter((mark) => snapshot.context.schema.decorators.map((decorator) => decorator.name).includes(mark));\n      if (markStateDecorators.length === activeDecorators.length && markStateDecorators.every((mark) => activeDecorators.includes(mark)))\n        return !1;\n    }\n    return {\n      activeDecorators,\n      activeAnnotations\n    };\n  },\n  actions: [({\n    snapshot,\n    event\n  }, {\n    activeDecorators,\n    activeAnnotations\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.child\",\n    child: {\n      _type: snapshot.context.schema.span.name,\n      text: event.text,\n      marks: [...activeDecorators, ...activeAnnotations]\n    }\n  })]]\n})], breakingAtTheEndOfTextBlock = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.break\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot), selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot);\n    if (!snapshot.context.selection || !focusTextBlock || !selectionCollapsed)\n      return !1;\n    const atTheEndOfBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isAtTheEndOfBlock)(focusTextBlock)(snapshot), focusListItem = focusTextBlock.node.listItem, focusLevel = focusTextBlock.node.level;\n    return atTheEndOfBlock ? {\n      focusListItem,\n      focusLevel\n    } : !1;\n  },\n  actions: [({\n    snapshot\n  }, {\n    focusListItem,\n    focusLevel\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name,\n      children: [{\n        _type: snapshot.context.schema.span.name,\n        text: \"\",\n        marks: []\n      }],\n      markDefs: [],\n      listItem: focusListItem,\n      level: focusLevel,\n      style: snapshot.context.schema.styles[0]?.name\n    },\n    placement: \"after\"\n  })]]\n}), breakingAtTheStartOfTextBlock = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.break\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot), selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot);\n    if (!snapshot.context.selection || !focusTextBlock || !selectionCollapsed)\n      return !1;\n    const focusSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshot), focusDecorators = focusSpan?.node.marks?.filter((mark) => snapshot.context.schema.decorators.some((decorator) => decorator.name === mark) ?? []), focusAnnotations = focusSpan?.node.marks?.filter((mark) => !snapshot.context.schema.decorators.some((decorator) => decorator.name === mark)) ?? [], focusListItem = focusTextBlock.node.listItem, focusLevel = focusTextBlock.node.level;\n    return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isAtTheStartOfBlock)(focusTextBlock)(snapshot) ? {\n      focusAnnotations,\n      focusDecorators,\n      focusListItem,\n      focusLevel\n    } : !1;\n  },\n  actions: [({\n    snapshot\n  }, {\n    focusAnnotations,\n    focusDecorators,\n    focusListItem,\n    focusLevel\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name,\n      children: [{\n        _type: snapshot.context.schema.span.name,\n        marks: focusAnnotations.length === 0 ? focusDecorators : [],\n        text: \"\"\n      }],\n      listItem: focusListItem,\n      level: focusLevel,\n      style: snapshot.context.schema.styles[0]?.name\n    },\n    placement: \"before\",\n    select: \"none\"\n  })]]\n}), breakingEntireBlocks = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.break\",\n  guard: ({\n    snapshot\n  }) => {\n    if (!snapshot.context.selection || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot))\n      return !1;\n    const selectedBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)(snapshot), selectionStartBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartBlock)(snapshot), selectionEndBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndBlock)(snapshot);\n    if (!selectionStartBlock || !selectionEndBlock)\n      return !1;\n    const startBlockStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n      context: snapshot.context,\n      block: selectionStartBlock\n    }), selectionStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getSelectionStartPoint)(snapshot.context.selection), endBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: selectionEndBlock\n    }), selectionEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getSelectionEndPoint)(snapshot.context.selection);\n    return (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(selectionStartPoint, startBlockStartPoint) && (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(selectionEndPoint, endBlockEndPoint) ? {\n      selectedBlocks\n    } : !1;\n  },\n  actions: [({\n    snapshot\n  }, {\n    selectedBlocks\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: {\n      _type: snapshot.context.schema.block.name,\n      children: [{\n        _type: snapshot.context.schema.span.name,\n        text: \"\",\n        marks: []\n      }]\n    },\n    placement: \"before\",\n    select: \"start\"\n  }), ...selectedBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: block.path\n  }))]]\n}), breakingInlineObject = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.break\",\n  guard: ({\n    snapshot\n  }) => {\n    const selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot), focusInlineObject = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusInlineObject)(snapshot);\n    return selectionCollapsed && focusInlineObject;\n  },\n  actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"move.forward\",\n    distance: 1\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"split\"\n  })]]\n}), coreInsertBreakBehaviors = {\n  breakingAtTheEndOfTextBlock,\n  breakingAtTheStartOfTextBlock,\n  breakingEntireBlocks,\n  breakingInlineObject\n};\nfunction isAtTheBeginningOfBlock({\n  context,\n  block\n}) {\n  return !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(context, block) || !context.selection || !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(context.selection) ? !1 : (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getChildKeyFromSelectionPoint)(context.selection.focus) === block.children[0]._key && context.selection.focus.offset === 0;\n}\nconst MAX_LIST_LEVEL = 10, clearListOnBackspace = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.backward\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n    return !focusTextBlock || focusTextBlock.node.level !== 1 || !isAtTheBeginningOfBlock({\n      context: snapshot.context,\n      block: focusTextBlock.node\n    }) ? !1 : {\n      focusTextBlock\n    };\n  },\n  actions: [(_, {\n    focusTextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.unset\",\n    props: [\"listItem\", \"level\"],\n    at: focusTextBlock.path\n  })]]\n}), unindentListOnBackspace = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.backward\",\n  guard: ({\n    snapshot\n  }) => {\n    const selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot), focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot), focusSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshot);\n    return !selectionCollapsed || !focusTextBlock || !focusSpan ? !1 : focusTextBlock.node.children[0]._key === focusSpan.node._key && snapshot.context.selection?.focus.offset === 0 && focusTextBlock.node.level !== void 0 && focusTextBlock.node.level > 1 ? {\n      focusTextBlock,\n      level: focusTextBlock.node.level - 1\n    } : !1;\n  },\n  actions: [(_, {\n    focusTextBlock,\n    level\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.set\",\n    props: {\n      level\n    },\n    at: focusTextBlock.path\n  })]]\n}), mergeTextIntoListOnDelete = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.forward\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusListBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusListBlock)(snapshot), nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)(snapshot);\n    return !focusListBlock || !nextBlock || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, nextBlock.node) || !(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusListBlock.node) ? !1 : {\n      focusListBlock,\n      nextBlock\n    };\n  },\n  actions: [(_, {\n    nextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: nextBlock.node,\n    placement: \"auto\",\n    select: \"start\"\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: nextBlock.path\n  })]]\n}), mergeTextIntoListOnBackspace = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.backward\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot), previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)(snapshot);\n    if (!focusTextBlock || !previousBlock || !isAtTheBeginningOfBlock({\n      context: snapshot.context,\n      block: focusTextBlock.node\n    }) || !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, previousBlock.node) || !(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, previousBlock.node))\n      return !1;\n    const previousBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: previousBlock\n    });\n    return {\n      focusTextBlock,\n      previousBlockEndPoint\n    };\n  },\n  actions: [(_, {\n    focusTextBlock,\n    previousBlockEndPoint\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: previousBlockEndPoint,\n      focus: previousBlockEndPoint\n    }\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: focusTextBlock.node,\n    placement: \"auto\",\n    select: \"start\"\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: focusTextBlock.path\n  })]]\n}), deletingListFromStart = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const at = event.at ?? snapshot.context.selection;\n    if (!at)\n      return !1;\n    const blocksToDelete = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: at\n      }\n    });\n    if (blocksToDelete.length < 2)\n      return !1;\n    const startBlock = blocksToDelete.at(0)?.node, middleBlocks = blocksToDelete.slice(1, -1), endBlock = blocksToDelete.at(-1)?.node;\n    if (!(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, startBlock) || !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, endBlock))\n      return !1;\n    const deleteStartPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartPoint)({\n      context: {\n        ...snapshot.context,\n        selection: at\n      }\n    }), deleteEndPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndPoint)({\n      context: {\n        ...snapshot.context,\n        selection: at\n      }\n    });\n    if (!deleteStartPoint || !deleteEndPoint)\n      return !1;\n    const startBlockStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n      context: snapshot.context,\n      block: {\n        node: startBlock,\n        path: [{\n          _key: startBlock._key\n        }]\n      }\n    });\n    if (!(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(deleteStartPoint, startBlockStartPoint))\n      return !1;\n    const startBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: {\n        node: startBlock,\n        path: [{\n          _key: startBlock._key\n        }]\n      }\n    }), endBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: {\n        node: endBlock,\n        path: [{\n          _key: endBlock._key\n        }]\n      }\n    }), slicedEndBlock = (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.sliceTextBlock)({\n      context: {\n        schema: snapshot.context.schema,\n        selection: {\n          anchor: deleteEndPoint,\n          focus: endBlockEndPoint\n        }\n      },\n      block: endBlock\n    });\n    return {\n      startBlockStartPoint,\n      startBlockEndPoint,\n      middleBlocks,\n      endBlock,\n      slicedEndBlock\n    };\n  },\n  actions: [(_, {\n    startBlockStartPoint,\n    startBlockEndPoint,\n    middleBlocks,\n    endBlock,\n    slicedEndBlock\n  }) => [\n    // All block in between can safely be deleted.\n    ...middleBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.block\",\n      at: block.path\n    })),\n    // The last block is deleted as well.\n    (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.block\",\n      at: [{\n        _key: endBlock._key\n      }]\n    }),\n    // But in case the delete operation didn't reach all the way to the end\n    // of it, we first place the caret at the end of the start block...\n    (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: {\n        anchor: startBlockEndPoint,\n        focus: startBlockEndPoint\n      }\n    }),\n    // ...and insert the rest of the end block at the end of it.\n    (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: slicedEndBlock,\n      placement: \"auto\",\n      select: \"none\"\n    }),\n    // And finally, we delete the original text of the start block.\n    (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\",\n      at: {\n        anchor: startBlockStartPoint,\n        focus: startBlockEndPoint\n      }\n    })\n  ]]\n}), clearListOnEnter = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.break\",\n  guard: ({\n    snapshot\n  }) => {\n    const selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot), focusListBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusListBlock)(snapshot);\n    return !selectionCollapsed || !focusListBlock || !(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusListBlock.node) ? !1 : {\n      focusListBlock\n    };\n  },\n  actions: [(_, {\n    focusListBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.unset\",\n    props: [\"listItem\", \"level\"],\n    at: focusListBlock.path\n  })]]\n}), indentListOnTab = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"keyboard.keydown\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (!defaultKeyboardShortcuts.tab.guard(event.originEvent))\n      return !1;\n    const selectedBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)(snapshot), selectedListBlocks = selectedBlocks.flatMap((block) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, block.node) ? [{\n      node: block.node,\n      path: block.path\n    }] : []);\n    return selectedListBlocks.length === selectedBlocks.length ? {\n      selectedListBlocks\n    } : !1;\n  },\n  actions: [(_, {\n    selectedListBlocks\n  }) => selectedListBlocks.map((selectedListBlock) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.set\",\n    props: {\n      level: Math.min(MAX_LIST_LEVEL, Math.max(1, selectedListBlock.node.level + 1))\n    },\n    at: selectedListBlock.path\n  }))]\n}), unindentListOnShiftTab = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"keyboard.keydown\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (!defaultKeyboardShortcuts.shiftTab.guard(event.originEvent))\n      return !1;\n    const selectedBlocks = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedBlocks)(snapshot), selectedListBlocks = selectedBlocks.flatMap((block) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, block.node) ? [{\n      node: block.node,\n      path: block.path\n    }] : []);\n    return selectedListBlocks.length === selectedBlocks.length ? {\n      selectedListBlocks\n    } : !1;\n  },\n  actions: [(_, {\n    selectedListBlocks\n  }) => selectedListBlocks.map((selectedListBlock) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.set\",\n    props: {\n      level: Math.min(MAX_LIST_LEVEL, Math.max(1, selectedListBlock.node.level - 1))\n    },\n    at: selectedListBlock.path\n  }))]\n}), inheritListLevel = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.blocks\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const focusListBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusListBlock)(snapshot);\n    if (!focusListBlock)\n      return !1;\n    const firstInsertedBlock = event.blocks.at(0), secondInsertedBlock = event.blocks.at(1), insertedListBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, firstInsertedBlock) ? firstInsertedBlock : (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, secondInsertedBlock) ? secondInsertedBlock : void 0;\n    if (!insertedListBlock)\n      return !1;\n    const levelDifference = focusListBlock.node.level - insertedListBlock.level;\n    return levelDifference === 0 ? !1 : {\n      levelDifference,\n      insertedListBlock\n    };\n  },\n  actions: [({\n    snapshot,\n    event\n  }, {\n    levelDifference,\n    insertedListBlock\n  }) => {\n    let adjustLevel = !0, listStartBlockFound = !1;\n    return [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      ...event,\n      blocks: event.blocks.map((block) => (block._key === insertedListBlock._key && (listStartBlockFound = !0), adjustLevel ? listStartBlockFound && adjustLevel && (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, block) ? {\n        ...block,\n        level: Math.min(MAX_LIST_LEVEL, Math.max(1, block.level + levelDifference))\n      } : (listStartBlockFound && (adjustLevel = !1), block) : block))\n    })];\n  }]\n}), inheritListItem = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.blocks\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const focusListBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusListBlock)(snapshot);\n    if (!focusListBlock || (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusListBlock.node))\n      return !1;\n    const firstInsertedBlock = event.blocks.at(0), secondInsertedBlock = event.blocks.at(1), insertedListBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, firstInsertedBlock) ? firstInsertedBlock : (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, secondInsertedBlock) ? secondInsertedBlock : void 0;\n    return !insertedListBlock || focusListBlock.node.level !== insertedListBlock.level || focusListBlock.node.listItem === insertedListBlock.listItem ? !1 : {\n      listItem: focusListBlock.node.listItem,\n      insertedListBlock\n    };\n  },\n  actions: [({\n    snapshot,\n    event\n  }, {\n    listItem,\n    insertedListBlock\n  }) => {\n    let adjustListItem = !0, listStartBlockFound = !1;\n    return [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      ...event,\n      blocks: event.blocks.map((block) => (block._key === insertedListBlock._key && (listStartBlockFound = !0), adjustListItem ? listStartBlockFound && adjustListItem && (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isListBlock)(snapshot.context, block) ? {\n        ...block,\n        listItem: block.level === insertedListBlock.level ? listItem : block.listItem\n      } : (listStartBlockFound && (adjustListItem = !1), block) : block))\n    })];\n  }]\n}), inheritListProperties = (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"insert.block\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (event.placement !== \"auto\" || event.block._type !== snapshot.context.schema.block.name || event.block.listItem !== void 0)\n      return !1;\n    const focusListBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusListBlock)(snapshot);\n    return !focusListBlock || !(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusListBlock.node) ? !1 : {\n      level: focusListBlock.node.level,\n      listItem: focusListBlock.node.listItem\n    };\n  },\n  actions: [({\n    event\n  }, {\n    level,\n    listItem\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    ...event,\n    block: {\n      ...event.block,\n      level,\n      listItem\n    }\n  })]]\n}), coreListBehaviors = {\n  clearListOnBackspace,\n  unindentListOnBackspace,\n  mergeTextIntoListOnDelete,\n  mergeTextIntoListOnBackspace,\n  deletingListFromStart,\n  clearListOnEnter,\n  indentListOnTab,\n  unindentListOnShiftTab,\n  inheritListLevel,\n  inheritListItem,\n  inheritListProperties\n}, coreBehaviorsConfig = [...coreAnnotationBehaviors, coreDecoratorBehaviors.strongShortcut, coreDecoratorBehaviors.emShortcut, coreDecoratorBehaviors.underlineShortcut, coreDecoratorBehaviors.codeShortcut, ...coreDndBehaviors, coreBlockObjectBehaviors.clickingAboveLonelyBlockObject, coreBlockObjectBehaviors.clickingBelowLonelyBlockObject, coreBlockObjectBehaviors.arrowDownOnLonelyBlockObject, coreBlockObjectBehaviors.arrowUpOnLonelyBlockObject, coreBlockObjectBehaviors.breakingBlockObject, coreBlockObjectBehaviors.deletingEmptyTextBlockAfterBlockObject, coreBlockObjectBehaviors.deletingEmptyTextBlockBeforeBlockObject, ...coreInsertBehaviors, coreListBehaviors.clearListOnBackspace, coreListBehaviors.unindentListOnBackspace, coreListBehaviors.mergeTextIntoListOnDelete, coreListBehaviors.mergeTextIntoListOnBackspace, coreListBehaviors.deletingListFromStart, coreListBehaviors.clearListOnEnter, coreListBehaviors.indentListOnTab, coreListBehaviors.unindentListOnShiftTab, coreListBehaviors.inheritListLevel, coreListBehaviors.inheritListItem, coreListBehaviors.inheritListProperties, coreInsertBreakBehaviors.breakingAtTheEndOfTextBlock, coreInsertBreakBehaviors.breakingAtTheStartOfTextBlock, coreInsertBreakBehaviors.breakingEntireBlocks, coreInsertBreakBehaviors.breakingInlineObject].map((behavior) => ({\n  behavior,\n  priority: corePriority\n}));\nfunction withPerformingBehaviorOperation(editor, fn) {\n  const prev = editor.isPerformingBehaviorOperation;\n  editor.isPerformingBehaviorOperation = !0, fn(), editor.isPerformingBehaviorOperation = prev;\n}\nfunction withoutNormalizingConditional(editor, predicate, fn) {\n  predicate() ? slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(editor, fn) : fn();\n}\nconst abstractAnnotationBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"annotation.set\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const blockKey = event.at[0]._key, markDefKey = event.at[2]._key, block = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: {\n            path: [{\n              _key: blockKey\n            }],\n            offset: 0\n          },\n          focus: {\n            path: [{\n              _key: blockKey\n            }],\n            offset: 0\n          }\n        }\n      }\n    });\n    if (!block)\n      return !1;\n    const updatedMarkDefs = block.node.markDefs?.map((markDef) => markDef._key === markDefKey ? {\n      ...markDef,\n      ...event.props\n    } : markDef);\n    return {\n      blockKey,\n      updatedMarkDefs\n    };\n  },\n  actions: [(_, {\n    blockKey,\n    updatedMarkDefs\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.set\",\n    at: [{\n      _key: blockKey\n    }],\n    props: {\n      markDefs: updatedMarkDefs\n    }\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"annotation.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveAnnotation)(event.annotation.name)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"annotation.remove\",\n    annotation: event.annotation\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"annotation.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveAnnotation)(event.annotation.name)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"annotation.add\",\n    annotation: event.annotation\n  })]]\n})], abstractDecoratorBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"decorator.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveDecorator)(event.decorator)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"decorator.remove\",\n    decorator: event.decorator\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"decorator.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => event.at ? !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveDecorator)(event.decorator)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: event.at\n    }\n  }) : !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveDecorator)(event.decorator)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    ...event,\n    type: \"decorator.add\"\n  })]]\n})], abstractDeleteBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.backward\",\n  guard: ({\n    snapshot\n  }) => snapshot.context.selection,\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete\",\n    direction: \"backward\",\n    unit: event.unit\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (event.direction !== \"backward\")\n      return !1;\n    const previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)(snapshot), focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n    if (!previousBlock || !focusTextBlock || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isAtTheStartOfBlock)(focusTextBlock)(snapshot))\n      return !1;\n    const previousBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n      context: snapshot.context,\n      block: previousBlock\n    });\n    return (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, previousBlock.node) ? {\n      previousBlockEndPoint,\n      focusTextBlock\n    } : !1;\n  },\n  actions: [(_, {\n    previousBlockEndPoint,\n    focusTextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: focusTextBlock.path\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: previousBlockEndPoint,\n      focus: previousBlockEndPoint\n    }\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: focusTextBlock.node,\n    placement: \"auto\",\n    select: \"start\"\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.forward\",\n  guard: ({\n    snapshot\n  }) => snapshot.context.selection,\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete\",\n    direction: \"forward\",\n    unit: event.unit\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (event.direction !== \"forward\")\n      return !1;\n    const at = event.at ?? snapshot.context.selection;\n    if (!at)\n      return !1;\n    const nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: at\n      }\n    }), focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: at\n      }\n    });\n    if (!nextBlock || !focusTextBlock || !(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusTextBlock.node))\n      return !1;\n    const nextBlockStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n      context: snapshot.context,\n      block: nextBlock\n    });\n    return {\n      focusTextBlock,\n      nextBlockStartPoint\n    };\n  },\n  actions: [(_, {\n    focusTextBlock,\n    nextBlockStartPoint\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: focusTextBlock.path\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: nextBlockStartPoint,\n      focus: nextBlockStartPoint\n    }\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (event.direction !== \"forward\")\n      return !1;\n    const nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)(snapshot), focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n    return !nextBlock || !focusTextBlock || !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isAtTheEndOfBlock)(focusTextBlock)(snapshot) || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, nextBlock.node) ? !1 : {\n      nextBlock\n    };\n  },\n  actions: [(_, {\n    nextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete.block\",\n    at: nextBlock.path\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"insert.block\",\n    block: nextBlock.node,\n    placement: \"auto\",\n    select: \"none\"\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.block\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete\",\n    at: {\n      anchor: {\n        path: event.at,\n        offset: 0\n      },\n      focus: {\n        path: event.at,\n        offset: 0\n      }\n    },\n    unit: \"block\"\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.child\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const focusChild = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusChild)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: {\n            path: event.at,\n            offset: 0\n          },\n          focus: {\n            path: event.at,\n            offset: 0\n          }\n        }\n      }\n    });\n    return focusChild ? (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)(snapshot.context, focusChild.node) ? {\n      selection: {\n        anchor: {\n          path: event.at,\n          offset: 0\n        },\n        focus: {\n          path: event.at,\n          offset: focusChild.node.text.length\n        }\n      }\n    } : {\n      selection: {\n        anchor: {\n          path: event.at,\n          offset: 0\n        },\n        focus: {\n          path: event.at,\n          offset: 0\n        }\n      }\n    } : !1;\n  },\n  actions: [(_, {\n    selection\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete\",\n    at: selection\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"delete.text\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    ...event,\n    type: \"delete\"\n  })]]\n})], mimeTypePriority = [\"application/x-portable-text\", \"application/json\", \"text/markdown\", \"text/html\", \"text/plain\"];\nfunction getFirstAvailableData({\n  dataTransfer,\n  startAfter\n}) {\n  const startIndex = startAfter ? mimeTypePriority.indexOf(startAfter) + 1 : 0;\n  for (let index = startIndex; index < mimeTypePriority.length; index++) {\n    const mimeType = mimeTypePriority.at(index);\n    if (!mimeType)\n      continue;\n    const data = dataTransfer.getData(mimeType);\n    if (data)\n      return {\n        mimeType,\n        data\n      };\n  }\n}\nconst abstractDeserializeBehaviors = [\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialize\",\n    guard: ({\n      event\n    }) => {\n      const availableData = getFirstAvailableData({\n        dataTransfer: event.originEvent.originEvent.dataTransfer\n      });\n      return availableData ? {\n        type: \"deserialize.data\",\n        mimeType: availableData.mimeType,\n        data: availableData.data,\n        originEvent: event.originEvent\n      } : !1;\n    },\n    actions: [(_, deserializeEvent) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(deserializeEvent)]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialize\",\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"deserialization.failure\",\n      mimeType: \"*/*\",\n      reason: \"No Behavior was able to handle the incoming data\",\n      originEvent: event.originEvent\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialize.data\",\n    guard: ({\n      event\n    }) => {\n      if (event.mimeType !== \"text/html\")\n        return !1;\n      const plainText = event.originEvent.originEvent.dataTransfer.getData(\"text/plain\");\n      return event.data !== plainText ? !1 : {\n        type: \"deserialize.data\",\n        mimeType: \"text/plain\",\n        data: plainText,\n        originEvent: event.originEvent\n      };\n    },\n    actions: [(_, deserializeDataEvent) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(deserializeDataEvent)]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialize.data\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const converter = snapshot.context.converters.find((converter2) => converter2.mimeType === event.mimeType);\n      return converter ? converter.deserialize({\n        snapshot,\n        event: {\n          type: \"deserialize\",\n          data: event.data\n        }\n      }) : !1;\n    },\n    actions: [({\n      event\n    }, deserializeEvent) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      ...deserializeEvent,\n      originEvent: event.originEvent\n    })]]\n  }),\n  /**\n   * If we are pasting text/plain into a text block then we can probably\n   * assume that the intended behavior is that the pasted text inherits\n   * formatting from the text it's pasted into.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialization.success\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if ((0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot) && event.mimeType === \"text/plain\" && event.originEvent.type !== \"drag.drop\") {\n        const activeDecorators = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveDecorators)(snapshot);\n        return {\n          activeAnnotations: (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getActiveAnnotations)(snapshot),\n          activeDecorators,\n          textRuns: event.data.flatMap((block) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, block) ? [(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.getTextBlockText)(block)] : [])\n        };\n      }\n      return !1;\n    },\n    actions: [(_, {\n      activeAnnotations,\n      activeDecorators,\n      textRuns\n    }) => textRuns.flatMap((textRun, index) => index !== textRuns.length - 1 ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.span\",\n      text: textRun,\n      decorators: activeDecorators,\n      annotations: activeAnnotations.map(({\n        _key,\n        _type,\n        ...value\n      }) => ({\n        name: _type,\n        value\n      }))\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.break\"\n    })] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.span\",\n      text: textRun,\n      decorators: activeDecorators,\n      annotations: activeAnnotations.map(({\n        _key,\n        _type,\n        ...value\n      }) => ({\n        name: _type,\n        value\n      }))\n    })])]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialization.success\",\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.blocks\",\n      blocks: event.data,\n      placement: \"auto\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialization.failure\",\n    guard: ({\n      event\n    }) => {\n      if (event.mimeType === \"*/*\")\n        return !1;\n      const availableData = getFirstAvailableData({\n        dataTransfer: event.originEvent.originEvent.dataTransfer,\n        startAfter: event.mimeType\n      });\n      return availableData ? {\n        type: \"deserialize.data\",\n        mimeType: availableData.mimeType,\n        data: availableData.data,\n        originEvent: event.originEvent\n      } : !1;\n    },\n    actions: [(_, deserializeDataEvent) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(deserializeDataEvent)]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"deserialization.failure\",\n    actions: [({\n      event\n    }) => [{\n      type: \"effect\",\n      effect: () => {\n        console.warn(`Deserialization of ${event.mimeType} failed with reason \"${event.reason}\"`);\n      }\n    }]]\n  })\n], abstractInputBehaviors = [\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"input.*\",\n    guard: ({\n      snapshot\n    }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot),\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\"\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)]]\n  }),\n  /**\n   * Handle input events where HTML equals plain text (e.g., Safari autocorrect).\n   * In this case, we use insert.text to preserve existing marks.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"input.*\",\n    guard: ({\n      event\n    }) => {\n      const text = event.originEvent.dataTransfer.getData(\"text/plain\"), html = event.originEvent.dataTransfer.getData(\"text/html\"), types = event.originEvent.dataTransfer.types;\n      return !text || text.includes(`\n`) ? !1 : types.length === 1 ? {\n        text\n      } : types.length > 2 ? !1 : html && text === html ? {\n        text\n      } : !1;\n    },\n    actions: [(_, {\n      text\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.text\",\n      text\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"input.*\",\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"deserialize\",\n      originEvent: event\n    })]]\n  })\n], abstractInsertBehaviors = [\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      event\n    }) => {\n      const onlyBlock = event.blocks.length === 1 ? event.blocks.at(0) : void 0;\n      return onlyBlock ? {\n        onlyBlock\n      } : !1;\n    },\n    actions: [({\n      event\n    }, {\n      onlyBlock\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: onlyBlock,\n      placement: event.placement,\n      select: event.select ?? \"end\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (event.placement !== \"before\")\n        return !1;\n      const firstBlockKey = event.blocks.at(0)?._key ?? snapshot.context.keyGenerator(), lastBlockKey = event.blocks.at(-1)?._key ?? snapshot.context.keyGenerator();\n      return {\n        firstBlockKey,\n        lastBlockKey\n      };\n    },\n    actions: [({\n      snapshot,\n      event\n    }, {\n      firstBlockKey,\n      lastBlockKey\n    }) => [...event.blocks.map((block, index) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: index === 0 ? \"before\" : \"after\",\n      select: index !== event.blocks.length - 1 ? \"end\" : \"none\"\n    })), ...event.select === \"none\" ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: snapshot.context.selection\n    })] : event.select === \"start\" ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: firstBlockKey\n      }],\n      select: \"start\"\n    })] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: lastBlockKey\n      }],\n      select: \"end\"\n    })]]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (event.placement !== \"after\")\n        return !1;\n      const firstBlockKey = event.blocks.at(0)?._key ?? snapshot.context.keyGenerator(), lastBlockKey = event.blocks.at(-1)?._key ?? snapshot.context.keyGenerator();\n      return {\n        firstBlockKey,\n        lastBlockKey\n      };\n    },\n    actions: [({\n      snapshot,\n      event\n    }, {\n      firstBlockKey,\n      lastBlockKey\n    }) => [...event.blocks.map((block, index) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: \"after\",\n      select: index !== event.blocks.length - 1 ? \"end\" : \"none\"\n    })), ...event.select === \"none\" ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: snapshot.context.selection\n    })] : event.select === \"start\" ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: firstBlockKey\n      }],\n      select: \"start\"\n    })] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: lastBlockKey\n      }],\n      select: \"end\"\n    })]]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (event.placement !== \"auto\")\n        return !1;\n      const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n      if (!focusTextBlock || !(0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusTextBlock.node))\n        return !1;\n      const firstBlockKey = event.blocks.at(0)?._key ?? snapshot.context.keyGenerator(), lastBlockKey = event.blocks.at(-1)?._key ?? snapshot.context.keyGenerator();\n      return {\n        focusTextBlock,\n        firstBlockKey,\n        lastBlockKey\n      };\n    },\n    actions: [({\n      event\n    }, {\n      firstBlockKey,\n      lastBlockKey\n    }) => [...event.blocks.map((block, index) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: index === 0 ? \"auto\" : \"after\",\n      select: index !== event.blocks.length - 1 ? \"end\" : \"none\"\n    })), ...event.select === \"none\" || event.select === \"start\" ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: firstBlockKey\n      }],\n      select: \"start\"\n    })] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: lastBlockKey\n      }],\n      select: \"end\"\n    })]]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (event.placement !== \"auto\")\n        return !1;\n      const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n      if (!focusTextBlock || !snapshot.context.selection)\n        return !1;\n      const focusBlockStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n        context: snapshot.context,\n        block: focusTextBlock\n      }), focusBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n        context: snapshot.context,\n        block: focusTextBlock\n      }), focusTextBlockAfter = (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.sliceTextBlock)({\n        context: {\n          schema: snapshot.context.schema,\n          selection: {\n            anchor: snapshot.context.selection.focus,\n            focus: focusBlockEndPoint\n          }\n        },\n        block: focusTextBlock.node\n      });\n      return {\n        firstBlockKey: event.blocks.at(0)?._key ?? snapshot.context.keyGenerator(),\n        focusBlockStartPoint,\n        focusBlockEndPoint,\n        focusTextBlockAfter,\n        selection: snapshot.context.selection\n      };\n    },\n    actions: [({\n      event\n    }, {\n      focusBlockEndPoint,\n      focusTextBlockAfter,\n      selection,\n      firstBlockKey,\n      focusBlockStartPoint\n    }) => [...event.blocks.flatMap((block, index) => index === 0 ? [...(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(selection.focus, focusBlockEndPoint) ? [] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\",\n      at: {\n        anchor: selection.focus,\n        focus: focusBlockEndPoint\n      }\n    })], (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: \"auto\",\n      select: \"end\"\n    })] : index === event.blocks.length - 1 ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: \"after\",\n      select: \"end\"\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: focusTextBlockAfter,\n      placement: \"auto\",\n      select: event.select === \"end\" ? \"none\" : \"end\"\n    })] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: \"after\",\n      select: \"end\"\n    })]), ...event.select === \"none\" ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: selection\n    })] : event.select === \"start\" ? [(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(selection.focus, focusBlockStartPoint) ? (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select.block\",\n      at: [{\n        _key: firstBlockKey\n      }],\n      select: \"start\"\n    }) : (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: {\n        anchor: selection.focus,\n        focus: selection.focus\n      }\n    })] : []]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      event\n    }) => event.placement === \"auto\",\n    actions: [({\n      event\n    }) => event.blocks.map((block, index) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block,\n      placement: index === 0 ? \"auto\" : \"after\",\n      select: event.select ?? \"end\"\n    }))]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.break\",\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"split\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.child\",\n    guard: ({\n      snapshot\n    }) => {\n      const lastBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getLastBlock)(snapshot);\n      return !lastBlock || snapshot.context.selection ? !1 : {\n        lastBlockEndPoint: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n          context: snapshot.context,\n          block: lastBlock\n        })\n      };\n    },\n    actions: [({\n      event\n    }, {\n      lastBlockEndPoint\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: {\n        anchor: lastBlockEndPoint,\n        focus: lastBlockEndPoint\n      }\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(event)]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.child\",\n    guard: ({\n      snapshot\n    }) => {\n      const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n      return snapshot.context.selection && !focusTextBlock;\n    },\n    actions: [({\n      snapshot,\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: {\n        _type: snapshot.context.schema.block.name,\n        children: [{\n          _type: snapshot.context.schema.span.name,\n          text: \"\",\n          marks: []\n        }]\n      },\n      placement: \"auto\",\n      select: \"end\"\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(event)]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.inline object\",\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.child\",\n      child: {\n        _type: event.inlineObject.name,\n        ...event.inlineObject.value\n      }\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.soft break\",\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.text\",\n      text: `\n`\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.span\",\n    guard: ({\n      snapshot\n    }) => !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot),\n    actions: [({\n      snapshot,\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: {\n        _type: snapshot.context.schema.block.name,\n        children: [{\n          _type: snapshot.context.schema.span.name,\n          text: \"\",\n          marks: []\n        }]\n      },\n      placement: \"auto\",\n      select: \"end\"\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(event)]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.span\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n      return {\n        markDefs: event.annotations?.map((annotation) => ({\n          _type: annotation.name,\n          _key: snapshot.context.keyGenerator(),\n          ...annotation.value\n        })) ?? [],\n        focusTextBlock\n      };\n    },\n    actions: [({\n      snapshot,\n      event\n    }, {\n      markDefs,\n      focusTextBlock\n    }) => [...focusTextBlock ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"block.set\",\n      at: focusTextBlock.path,\n      props: {\n        markDefs: [...focusTextBlock.node.markDefs ?? [], ...markDefs]\n      }\n    })] : [], (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.child\",\n      child: {\n        _type: snapshot.context.schema.span.name,\n        text: event.text,\n        marks: [...event.decorators ?? [], ...markDefs.map((markDef) => markDef._key)]\n      }\n    })]]\n  }),\n  /**\n   * If there's an expanded selection, then we delete the selection before we\n   * insert the text.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.text\",\n    guard: ({\n      snapshot\n    }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot),\n    actions: [({\n      event\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\"\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(event)]]\n  }),\n  /**\n   * If there's no selection, then we select the end of the editor before we\n   * we insert the text.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"insert.text\",\n    guard: ({\n      snapshot\n    }) => {\n      if (snapshot.context.selection)\n        return !1;\n      const lastBlok = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getLastBlock)(snapshot);\n      return lastBlok ? {\n        endPoint: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n          context: snapshot.context,\n          block: lastBlok\n        })\n      } : !1;\n    },\n    actions: [({\n      event\n    }, {\n      endPoint\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: {\n        anchor: endPoint,\n        focus: endPoint\n      }\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)(event)]]\n  })\n], shiftLeft = (0,_portabletext_keyboard_shortcuts__WEBPACK_IMPORTED_MODULE_22__.createKeyboardShortcut)({\n  default: [{\n    key: \"ArrowLeft\",\n    shift: !0,\n    meta: !1,\n    ctrl: !1,\n    alt: !1\n  }]\n}), abstractKeyboardBehaviors = [\n  /**\n   * When Backspace is pressed on an inline object, Slate will raise a\n   * `delete.backward` event with `unit: 'block'`. This is wrong and this\n   * Behavior adjusts that.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.backspace.guard(event.originEvent) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusInlineObject)(snapshot),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.backward\",\n      unit: \"character\"\n    })]]\n  }),\n  /**\n   * When Delete is pressed on an inline object, Slate will raise a\n   * `delete.forward` event with `unit: 'block'`. This is wrong and this\n   * Behavior adjusts that.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.delete.guard(event.originEvent) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusInlineObject)(snapshot),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.forward\",\n      unit: \"character\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      event\n    }) => defaultKeyboardShortcuts.deleteWord.backward.guard(event.originEvent),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.backward\",\n      unit: \"word\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      event\n    }) => defaultKeyboardShortcuts.deleteWord.forward.guard(event.originEvent),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete.forward\",\n      unit: \"word\"\n    })]]\n  }),\n  /**\n   * Allow raising an `insert.break` event when pressing Enter on an inline\n   * object.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.break.guard(event.originEvent) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusInlineObject)(snapshot),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.break\"\n    })]]\n  }),\n  /**\n   * On Firefox, Enter might collapse the selection. To mitigate this, we\n   * `raise` an `insert.break` event manually.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => defaultKeyboardShortcuts.break.guard(event.originEvent) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.break\"\n    })]]\n  }),\n  /**\n   * On WebKit, Shift+Enter results in an `insertParagraph` input event rather\n   * than an `insertLineBreak` input event. This Behavior makes sure we catch\n   * that `keyboard.keydown` event beforehand and raise an `insert.soft break` manually.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      event\n    }) => defaultKeyboardShortcuts.lineBreak.guard(event.originEvent),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.soft break\"\n    })]]\n  }),\n  /**\n   * Manual handling of undo shortcuts.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      event\n    }) => defaultKeyboardShortcuts.history.undo.guard(event.originEvent),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"history.undo\"\n    })]]\n  }),\n  /**\n   * Manual handling of redo shortcuts.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      event\n    }) => defaultKeyboardShortcuts.history.redo.guard(event.originEvent),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"history.redo\"\n    })]]\n  }),\n  /**\n   * Fix edge case where Shift+ArrowLeft didn't reduce a selection hanging\n   * onto an empty text block.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"keyboard.keydown\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (!snapshot.context.selection || !shiftLeft.guard(event.originEvent))\n        return !1;\n      const focusBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlock)(snapshot);\n      if (!focusBlock)\n        return !1;\n      const previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: {\n            anchor: {\n              path: focusBlock.path,\n              offset: 0\n            },\n            focus: {\n              path: focusBlock.path,\n              offset: 0\n            }\n          }\n        }\n      });\n      return previousBlock && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, focusBlock.node) && snapshot.context.selection.focus.offset === 0 && (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.isEmptyTextBlock)(snapshot.context, focusBlock.node) ? {\n        previousBlock,\n        selection: snapshot.context.selection\n      } : !1;\n    },\n    actions: [({\n      snapshot\n    }, {\n      previousBlock,\n      selection\n    }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"select\",\n      at: {\n        anchor: selection.anchor,\n        focus: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n          context: snapshot.context,\n          block: previousBlock\n        })\n      }\n    })]]\n  })\n], abstractListItemBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"list item.add\",\n  guard: ({\n    snapshot,\n    event\n  }) => snapshot.context.schema.lists.some((list) => list.name === event.listItem) ? {\n    selectedTextBlocks: (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedTextBlocks)(snapshot)\n  } : !1,\n  actions: [({\n    event\n  }, {\n    selectedTextBlocks\n  }) => selectedTextBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.set\",\n    at: block.path,\n    props: {\n      level: block.node.level ?? 1,\n      listItem: event.listItem\n    }\n  }))]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"list item.remove\",\n  guard: ({\n    snapshot\n  }) => ({\n    selectedTextBlocks: (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedTextBlocks)(snapshot)\n  }),\n  actions: [(_, {\n    selectedTextBlocks\n  }) => selectedTextBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.unset\",\n    at: block.path,\n    props: [\"level\", \"listItem\"]\n  }))]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"list item.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveListItem)(event.listItem)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"list item.remove\",\n    listItem: event.listItem\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"list item.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveListItem)(event.listItem)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"list item.add\",\n    listItem: event.listItem\n  })]]\n})], abstractMoveBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"move.block up\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: {\n            path: event.at,\n            offset: 0\n          },\n          focus: {\n            path: event.at,\n            offset: 0\n          }\n        }\n      }\n    });\n    return previousBlock ? {\n      previousBlock\n    } : !1;\n  },\n  actions: [({\n    event\n  }, {\n    previousBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"move.block\",\n    at: event.at,\n    to: previousBlock.path\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"move.block down\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: {\n            path: event.at,\n            offset: 0\n          },\n          focus: {\n            path: event.at,\n            offset: 0\n          }\n        }\n      }\n    });\n    return nextBlock ? {\n      nextBlock\n    } : !1;\n  },\n  actions: [({\n    event\n  }, {\n    nextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"move.block\",\n    at: event.at,\n    to: nextBlock.path\n  })]]\n})], abstractSelectBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"select.block\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    if (event.select !== \"end\")\n      return !1;\n    const block = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlock)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: {\n          anchor: {\n            path: event.at,\n            offset: 0\n          },\n          focus: {\n            path: event.at,\n            offset: 0\n          }\n        }\n      }\n    });\n    return block ? {\n      blockEndPoint: (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n        context: snapshot.context,\n        block\n      })\n    } : !1;\n  },\n  actions: [(_, {\n    blockEndPoint\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: blockEndPoint,\n      focus: blockEndPoint\n    }\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"select.block\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select\",\n    at: {\n      anchor: {\n        path: event.at,\n        offset: 0\n      },\n      focus: {\n        path: event.at,\n        offset: 0\n      }\n    }\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"select.previous block\",\n  guard: ({\n    snapshot\n  }) => {\n    const previousBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getPreviousBlock)(snapshot);\n    return previousBlock ? {\n      previousBlock\n    } : !1;\n  },\n  actions: [({\n    event\n  }, {\n    previousBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select.block\",\n    at: previousBlock.path,\n    select: event.select\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"select.next block\",\n  guard: ({\n    snapshot\n  }) => {\n    const nextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getNextBlock)(snapshot);\n    return nextBlock ? {\n      nextBlock\n    } : !1;\n  },\n  actions: [({\n    event\n  }, {\n    nextBlock\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"select.block\",\n    at: nextBlock.path,\n    select: event.select\n  })]]\n})], abstractSerializeBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"serialize\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize.data\",\n    mimeType: \"application/x-portable-text\",\n    originEvent: event.originEvent\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize.data\",\n    mimeType: \"application/json\",\n    originEvent: event.originEvent\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize.data\",\n    mimeType: \"text/markdown\",\n    originEvent: event.originEvent\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize.data\",\n    mimeType: \"text/html\",\n    originEvent: event.originEvent\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize.data\",\n    mimeType: \"text/plain\",\n    originEvent: event.originEvent\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"serialize.data\",\n  guard: ({\n    snapshot,\n    event\n  }) => {\n    const converter = snapshot.context.converters.find((converter2) => converter2.mimeType === event.mimeType);\n    return converter ? converter.serialize({\n      snapshot,\n      event: {\n        type: \"serialize\",\n        originEvent: event.originEvent.type\n      }\n    }) : !1;\n  },\n  actions: [({\n    event\n  }, serializeEvent) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    ...serializeEvent,\n    originEvent: event.originEvent\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"serialization.success\",\n  actions: [({\n    event\n  }) => [{\n    type: \"effect\",\n    effect: () => {\n      event.originEvent.originEvent.dataTransfer.setData(event.mimeType, event.data);\n    }\n  }]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"serialization.failure\",\n  actions: [({\n    event\n  }) => [{\n    type: \"effect\",\n    effect: () => {\n      console.warn(`Serialization of ${event.mimeType} failed with reason \"${event.reason}\"`);\n    }\n  }]]\n})], abstractSplitBehaviors = [\n  /**\n   * You can't split an inline object.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"split\",\n    guard: ({\n      snapshot\n    }) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(snapshot.context.selection) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusInlineObject)(snapshot),\n    actions: []\n  }),\n  /**\n   * You can't split a block object.\n   */\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"split\",\n    guard: ({\n      snapshot\n    }) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(snapshot.context.selection) && (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusBlockObject)(snapshot),\n    actions: []\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"split\",\n    guard: ({\n      snapshot\n    }) => {\n      const selection = snapshot.context.selection;\n      if (!selection || (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(selection))\n        return !1;\n      const startPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getSelectionStartPoint)(selection), endPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getSelectionEndPoint)(selection);\n      if (!startPoint || !endPoint)\n        return !1;\n      const startBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionStartBlock)(snapshot), endBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectionEndBlock)(snapshot);\n      if (!startBlock || !endBlock)\n        return !1;\n      const startBlockStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockStartPoint)({\n        context: snapshot.context,\n        block: startBlock\n      }), endBlockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n        context: snapshot.context,\n        block: endBlock\n      });\n      return !!((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, startBlock.node) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)(snapshot.context, endBlock.node) && !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(startPoint, startBlockStartPoint) && !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isEqualSelectionPoints)(endPoint, endBlockEndPoint));\n    },\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\"\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"split\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"split\",\n    guard: ({\n      snapshot\n    }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot),\n    actions: [() => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\"\n    })]]\n  }),\n  (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n    on: \"split\",\n    guard: ({\n      snapshot\n    }) => {\n      const selection = snapshot.context.selection;\n      if (!selection || !(0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(selection))\n        return !1;\n      const selectionStartPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getSelectionStartPoint)(selection), focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusTextBlock)(snapshot);\n      if (!focusTextBlock)\n        return !1;\n      const blockEndPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.getBlockEndPoint)({\n        context: snapshot.context,\n        block: focusTextBlock\n      }), newTextBlockSelection = {\n        anchor: selectionStartPoint,\n        focus: blockEndPoint\n      }, newTextBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.parseBlock)({\n        block: (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_12__.sliceTextBlock)({\n          context: {\n            ...snapshot.context,\n            selection: newTextBlockSelection\n          },\n          block: focusTextBlock.node\n        }),\n        context: snapshot.context,\n        options: {\n          normalize: !1,\n          removeUnusedMarkDefs: !0,\n          validateFields: !1\n        }\n      });\n      return newTextBlock ? {\n        newTextBlock,\n        newTextBlockSelection\n      } : !1;\n    },\n    actions: [(_, {\n      newTextBlock,\n      newTextBlockSelection\n    }) => (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.isSelectionCollapsed)(newTextBlockSelection) ? [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: newTextBlock,\n      placement: \"after\",\n      select: \"start\"\n    })] : [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"delete\",\n      at: newTextBlockSelection\n    }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n      type: \"insert.block\",\n      block: newTextBlock,\n      placement: \"after\",\n      select: \"start\"\n    })]]\n  })\n], abstractStyleBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"style.add\",\n  guard: ({\n    snapshot\n  }) => ({\n    selectedTextBlocks: (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedTextBlocks)(snapshot)\n  }),\n  actions: [({\n    event\n  }, {\n    selectedTextBlocks\n  }) => selectedTextBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.set\",\n    at: block.path,\n    props: {\n      style: event.style\n    }\n  }))]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"style.remove\",\n  guard: ({\n    snapshot\n  }) => ({\n    selectedTextBlocks: (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getSelectedTextBlocks)(snapshot)\n  }),\n  actions: [(_, {\n    selectedTextBlocks\n  }) => selectedTextBlocks.map((block) => (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"block.unset\",\n    at: block.path,\n    props: [\"style\"]\n  }))]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"style.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveStyle)(event.style)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"style.remove\",\n    style: event.style\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"style.toggle\",\n  guard: ({\n    snapshot,\n    event\n  }) => !(0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isActiveStyle)(event.style)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"style.add\",\n    style: event.style\n  })]]\n})], abstractBehaviors = [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"clipboard.copy\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshot), selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot);\n    return focusSpan && selectionCollapsed;\n  },\n  actions: []\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"clipboard.copy\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize\",\n    originEvent: event\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"clipboard.cut\",\n  guard: ({\n    snapshot\n  }) => {\n    const focusSpan = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.getFocusSpan)(snapshot), selectionCollapsed = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionCollapsed)(snapshot);\n    return focusSpan && selectionCollapsed;\n  },\n  actions: []\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"clipboard.cut\",\n  guard: ({\n    snapshot\n  }) => snapshot.context.selection,\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize\",\n    originEvent: event\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete\"\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"drag.dragstart\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"serialize\",\n    originEvent: event\n  })]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"clipboard.paste\",\n  guard: ({\n    snapshot\n  }) => (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_13__.isSelectionExpanded)(snapshot),\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"delete\"\n  }), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.forward)(event)]]\n}), (0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.defineBehavior)({\n  on: \"clipboard.paste\",\n  actions: [({\n    event\n  }) => [(0,_behaviors_index_js__WEBPACK_IMPORTED_MODULE_14__.raise)({\n    type: \"deserialize\",\n    originEvent: event\n  })]]\n}), ...abstractAnnotationBehaviors, ...abstractDecoratorBehaviors, ...abstractDeleteBehaviors, ...abstractDeserializeBehaviors, ...abstractInputBehaviors, ...abstractInsertBehaviors, ...abstractKeyboardBehaviors, ...abstractListItemBehaviors, ...abstractMoveBehaviors, ...abstractStyleBehaviors, ...abstractSelectBehaviors, ...abstractSerializeBehaviors, ...abstractSplitBehaviors];\nfunction isSyntheticBehaviorEvent(event) {\n  return !isCustomBehaviorEvent(event) && !isNativeBehaviorEvent(event) && !isAbstractBehaviorEvent(event);\n}\nconst abstractBehaviorEventTypes = [\"annotation.set\", \"annotation.toggle\", \"decorator.toggle\", \"delete.backward\", \"delete.block\", \"delete.child\", \"delete.forward\", \"delete.text\", \"deserialize\", \"deserialize.data\", \"deserialization.success\", \"deserialization.failure\", \"insert.blocks\", \"insert.break\", \"insert.inline object\", \"insert.soft break\", \"insert.span\", \"list item.add\", \"list item.remove\", \"list item.toggle\", \"move.block down\", \"move.block up\", \"select.block\", \"select.previous block\", \"select.next block\", \"serialize\", \"serialize.data\", \"serialization.success\", \"serialization.failure\", \"split\", \"style.add\", \"style.remove\", \"style.toggle\"];\nfunction isAbstractBehaviorEvent(event) {\n  return abstractBehaviorEventTypes.includes(event.type);\n}\nconst nativeBehaviorEventTypes = [\"clipboard.copy\", \"clipboard.cut\", \"clipboard.paste\", \"drag.dragstart\", \"drag.drag\", \"drag.dragend\", \"drag.dragenter\", \"drag.dragover\", \"drag.dragleave\", \"drag.drop\", \"input.*\", \"keyboard.keydown\", \"keyboard.keyup\", \"mouse.click\"];\nfunction isNativeBehaviorEvent(event) {\n  return nativeBehaviorEventTypes.includes(event.type);\n}\nfunction isCustomBehaviorEvent(event) {\n  return event.type.startsWith(\"custom.\");\n}\nconst debug$5 = debugWithName(\"behaviors:event\");\nfunction eventCategory(event) {\n  return isNativeBehaviorEvent(event) ? \"native\" : isAbstractBehaviorEvent(event) ? \"synthetic\" : isCustomBehaviorEvent(event) ? \"custom\" : \"synthetic\";\n}\nfunction performEvent({\n  mode,\n  behaviors,\n  remainingEventBehaviors,\n  event,\n  editor,\n  keyGenerator,\n  schema,\n  getSnapshot,\n  nativeEvent,\n  sendBack\n}) {\n  mode === \"send\" && !isNativeBehaviorEvent(event) && (editor.undoStepId = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.defaultKeyGenerator)()), debug$5(`(${mode}:${eventCategory(event)})`, JSON.stringify(event, null, 2));\n  const eventBehaviors = [...remainingEventBehaviors, ...abstractBehaviors].filter((behavior) => {\n    if (behavior.on === \"*\")\n      return !0;\n    const [listenedNamespace] = behavior.on.includes(\"*\") && behavior.on.includes(\".\") ? behavior.on.split(\".\") : [void 0], [eventNamespace] = event.type.includes(\".\") ? event.type.split(\".\") : [void 0];\n    return listenedNamespace !== void 0 && eventNamespace !== void 0 && listenedNamespace === eventNamespace || listenedNamespace !== void 0 && eventNamespace === void 0 && listenedNamespace === event.type ? !0 : behavior.on === event.type;\n  });\n  if (eventBehaviors.length === 0 && isSyntheticBehaviorEvent(event)) {\n    nativeEvent?.preventDefault(), mode === \"send\" && (editor.undoStepId = void 0), withPerformingBehaviorOperation(editor, () => {\n      debug$5(`(execute:${eventCategory(event)})`, JSON.stringify(event, null, 2)), performOperation({\n        context: {\n          keyGenerator,\n          schema\n        },\n        operation: {\n          ...event,\n          editor\n        }\n      });\n    }), editor.onChange();\n    return;\n  }\n  const guardSnapshot = getSnapshot();\n  let nativeEventPrevented = !1, defaultBehaviorOverwritten = !1, eventBehaviorIndex = -1;\n  for (const eventBehavior of eventBehaviors) {\n    eventBehaviorIndex++;\n    let shouldRun = !1;\n    try {\n      shouldRun = eventBehavior.guard === void 0 || eventBehavior.guard({\n        snapshot: guardSnapshot,\n        event,\n        dom: createEditorDom(sendBack, editor)\n      });\n    } catch (error) {\n      console.error(new Error(`Evaluating guard for \"${event.type}\" failed due to: ${error.message}`));\n    }\n    if (!shouldRun)\n      continue;\n    defaultBehaviorOverwritten = !0, eventBehavior.actions.length === 0 && (nativeEventPrevented = !0);\n    let actionSetIndex = -1;\n    for (const actionSet of eventBehavior.actions) {\n      actionSetIndex++;\n      const actionsSnapshot = getSnapshot();\n      let actions = [];\n      try {\n        actions = actionSet({\n          snapshot: actionsSnapshot,\n          event,\n          dom: createEditorDom(sendBack, editor)\n        }, shouldRun);\n      } catch (error) {\n        console.error(new Error(`Evaluating actions for \"${event.type}\" failed due to: ${error.message}`));\n      }\n      if (actions.length === 0)\n        continue;\n      nativeEventPrevented = actions.some((action) => action.type === \"raise\" || action.type === \"execute\") || !actions.some((action) => action.type === \"forward\");\n      let undoStepCreated = !1;\n      actionSetIndex > 0 && (editor.undoStepId = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.defaultKeyGenerator)(), undoStepCreated = !0), !undoStepCreated && actions.some((action) => action.type === \"execute\") && (editor.undoStepId = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.defaultKeyGenerator)(), undoStepCreated = !0);\n      const actionTypes = actions.map((action) => action.type), uniqueActionTypes = new Set(actionTypes), raiseGroup = actionTypes.length > 1 && uniqueActionTypes.size === 1 && uniqueActionTypes.has(\"raise\"), executeGroup = actionTypes.length > 1 && uniqueActionTypes.size === 1 && uniqueActionTypes.has(\"execute\");\n      withoutNormalizingConditional(editor, () => raiseGroup || executeGroup, () => {\n        for (const action of actions) {\n          if (action.type === \"effect\") {\n            try {\n              action.effect({\n                send: sendBack\n              });\n            } catch (error) {\n              console.error(new Error(`Executing effect as a result of \"${event.type}\" failed due to: ${error.message}`));\n            }\n            continue;\n          }\n          if (action.type === \"forward\") {\n            const remainingEventBehaviors2 = eventBehaviors.slice(eventBehaviorIndex + 1);\n            performEvent({\n              mode: mode === \"execute\" ? \"execute\" : \"forward\",\n              behaviors,\n              remainingEventBehaviors: remainingEventBehaviors2,\n              event: action.event,\n              editor,\n              keyGenerator,\n              schema,\n              getSnapshot,\n              nativeEvent,\n              sendBack\n            });\n            continue;\n          }\n          if (action.type === \"raise\") {\n            performEvent({\n              mode: mode === \"execute\" ? \"execute\" : \"raise\",\n              behaviors,\n              remainingEventBehaviors: mode === \"execute\" ? remainingEventBehaviors : behaviors,\n              event: action.event,\n              editor,\n              keyGenerator,\n              schema,\n              getSnapshot,\n              nativeEvent,\n              sendBack\n            });\n            continue;\n          }\n          performEvent({\n            mode: \"execute\",\n            behaviors,\n            remainingEventBehaviors: [],\n            event: action.event,\n            editor,\n            keyGenerator,\n            schema,\n            getSnapshot,\n            nativeEvent: void 0,\n            sendBack\n          });\n        }\n      }), undoStepCreated && (editor.undoStepId = void 0);\n    }\n    break;\n  }\n  !defaultBehaviorOverwritten && isSyntheticBehaviorEvent(event) ? (nativeEvent?.preventDefault(), mode === \"send\" && (editor.undoStepId = void 0), withPerformingBehaviorOperation(editor, () => {\n    debug$5(`(execute:${eventCategory(event)})`, JSON.stringify(event, null, 2)), performOperation({\n      context: {\n        keyGenerator,\n        schema\n      },\n      operation: {\n        ...event,\n        editor\n      }\n    });\n  }), editor.onChange()) : nativeEventPrevented && nativeEvent?.preventDefault();\n}\nfunction sortByPriority(items) {\n  if (items.length === 0)\n    return [];\n  const itemsWithPriority = items.filter((item) => item.priority !== void 0), itemsWithoutPriority = items.filter((item) => item.priority === void 0);\n  if (itemsWithPriority.length === 0)\n    return items;\n  const itemsByPriorityId = new Map(itemsWithPriority.map((item) => [item.priority.id, item])), graph = /* @__PURE__ */ new Map(), inDegree = /* @__PURE__ */ new Map();\n  function ensureNode(id) {\n    graph.has(id) || (graph.set(id, /* @__PURE__ */ new Set()), inDegree.set(id, 0));\n  }\n  for (const item of itemsWithPriority) {\n    const id = item.priority.id;\n    ensureNode(id);\n  }\n  function addEdge(fromId, toId) {\n    !graph.has(fromId) || !graph.has(toId) || (graph.get(fromId)?.add(toId), inDegree.set(toId, (inDegree.get(toId) ?? 0) + 1));\n  }\n  for (const item of itemsWithPriority) {\n    const id = item.priority.id, visited = /* @__PURE__ */ new Set();\n    let ref = item.priority.reference;\n    for (; ref; ) {\n      const refId = ref.priority.id;\n      if (ensureNode(refId), visited.has(refId))\n        throw new Error(\"Circular dependency detected in priorities\");\n      visited.add(refId), ref.importance === \"higher\" ? addEdge(id, refId) : addEdge(refId, id), ref = ref.priority.reference;\n    }\n  }\n  const queue = [];\n  for (const [id, degree] of inDegree)\n    degree === 0 && queue.push(id);\n  const result = [];\n  for (; queue.length > 0; ) {\n    const currentId = queue.shift(), currentItem = itemsByPriorityId.get(currentId);\n    currentItem && result.push(currentItem);\n    for (const neighborId of graph.get(currentId) ?? []) {\n      const newDegree = (inDegree.get(neighborId) ?? 0) - 1;\n      inDegree.set(neighborId, newDegree), newDegree === 0 && queue.push(neighborId);\n    }\n  }\n  for (const item of itemsWithPriority)\n    result.includes(item) || result.push(item);\n  return [...result, ...itemsWithoutPriority];\n}\nfunction createEditorSnapshot({\n  converters,\n  editor,\n  keyGenerator,\n  readOnly,\n  schema\n}) {\n  const selection = editor.selection ? slateRangeToSelection({\n    schema,\n    editor,\n    range: editor.selection\n  }) : null, context = {\n    converters,\n    keyGenerator,\n    readOnly,\n    schema,\n    selection,\n    value: editor.value\n  };\n  return {\n    blockIndexMap: editor.blockIndexMap,\n    context,\n    decoratorState: editor.decoratorState\n  };\n}\nconst debug$4 = debugWithName(\"editor machine\");\nfunction rerouteExternalBehaviorEvent({\n  event,\n  slateEditor\n}) {\n  switch (event.type) {\n    case \"blur\":\n      return {\n        type: \"blur\",\n        editor: slateEditor\n      };\n    case \"focus\":\n      return {\n        type: \"focus\",\n        editor: slateEditor\n      };\n    case \"insert.block object\":\n      return {\n        type: \"behavior event\",\n        behaviorEvent: {\n          type: \"insert.block\",\n          block: {\n            _type: event.blockObject.name,\n            ...event.blockObject.value ?? {}\n          },\n          placement: event.placement\n        },\n        editor: slateEditor\n      };\n    default:\n      return {\n        type: \"behavior event\",\n        behaviorEvent: event,\n        editor: slateEditor\n      };\n  }\n}\nconst editorMachine = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    events: {},\n    emitted: {},\n    input: {},\n    tags: {}\n  },\n  actions: {\n    \"add behavior to context\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      behaviors: ({\n        context,\n        event\n      }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"add behavior\"), /* @__PURE__ */ new Set([...context.behaviors, event.behaviorConfig])),\n      behaviorsSorted: !1\n    }),\n    \"remove behavior from context\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      behaviors: ({\n        context,\n        event\n      }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"remove behavior\"), context.behaviors.delete(event.behaviorConfig), /* @__PURE__ */ new Set([...context.behaviors]))\n    }),\n    \"add slate editor to context\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      slateEditor: ({\n        context,\n        event\n      }) => event.type === \"add slate editor\" ? event.editor : context.slateEditor\n    }),\n    \"emit patch event\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n      event\n    }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"internal.patch\"), event)),\n    \"emit mutation event\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n      event\n    }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"mutation\"), event)),\n    \"emit read only\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n      type: \"read only\"\n    }),\n    \"emit editable\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n      type: \"editable\"\n    }),\n    \"defer event\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingEvents: ({\n        context,\n        event\n      }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, [\"internal.patch\", \"mutation\"]), [...context.pendingEvents, event])\n    }),\n    \"emit pending events\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.e)(({\n      context,\n      enqueue\n    }) => {\n      for (const event of context.pendingEvents)\n        enqueue.emit(event);\n    }),\n    \"emit ready\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n      type: \"ready\"\n    }),\n    \"clear pending events\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingEvents: []\n    }),\n    \"defer incoming patches\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingIncomingPatchesEvents: ({\n        context,\n        event\n      }) => event.type === \"patches\" ? [...context.pendingIncomingPatchesEvents, event] : context.pendingIncomingPatchesEvents\n    }),\n    \"emit pending incoming patches\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.e)(({\n      context,\n      enqueue\n    }) => {\n      for (const event of context.pendingIncomingPatchesEvents)\n        enqueue.emit(event);\n    }),\n    \"clear pending incoming patches\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingIncomingPatchesEvents: []\n    }),\n    \"handle blur\": ({\n      event\n    }) => {\n      (0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"blur\");\n      try {\n        slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.blur(event.editor);\n      } catch (error) {\n        console.error(new Error(`Failed to blur editor: ${error.message}`));\n      }\n    },\n    \"handle focus\": ({\n      context\n    }) => {\n      const slateEditor = context.slateEditor;\n      if (!slateEditor) {\n        console.error(\"No Slate editor found to focus\");\n        return;\n      }\n      try {\n        const currentSelection = slateEditor.selection;\n        slate_react__WEBPACK_IMPORTED_MODULE_15__.ReactEditor.focus(slateEditor), currentSelection && (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(slateEditor, currentSelection), slate_dom__WEBPACK_IMPORTED_MODULE_7__.EDITOR_TO_PENDING_SELECTION.set(slateEditor, slateEditor.selection), slateEditor.onChange());\n      } catch (error) {\n        console.error(new Error(`Failed to focus editor: ${error.message}`));\n      }\n    },\n    \"handle behavior event\": ({\n      context,\n      event,\n      self\n    }) => {\n      (0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, [\"behavior event\"]);\n      try {\n        const behaviors = [...context.behaviors.values()].map((config) => config.behavior);\n        performEvent({\n          mode: \"send\",\n          behaviors,\n          remainingEventBehaviors: behaviors,\n          event: event.behaviorEvent,\n          editor: event.editor,\n          keyGenerator: context.keyGenerator,\n          schema: context.schema,\n          getSnapshot: () => createEditorSnapshot({\n            converters: [...context.converters],\n            editor: event.editor,\n            keyGenerator: context.keyGenerator,\n            readOnly: self.getSnapshot().matches({\n              \"edit mode\": \"read only\"\n            }),\n            schema: context.schema\n          }),\n          nativeEvent: event.nativeEvent,\n          sendBack: (eventSentBack) => {\n            if (eventSentBack.type === \"set drag ghost\") {\n              self.send(eventSentBack);\n              return;\n            }\n            self.send(rerouteExternalBehaviorEvent({\n              event: eventSentBack,\n              slateEditor: event.editor\n            }));\n          }\n        });\n      } catch (error) {\n        console.error(new Error(`Raising \"${event.behaviorEvent.type}\" failed due to: ${error.message}`));\n      }\n    },\n    \"sort behaviors\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      behaviors: ({\n        context\n      }) => context.behaviorsSorted ? context.behaviors : new Set(sortByPriority([...context.behaviors.values()])),\n      behaviorsSorted: !0\n    })\n  },\n  guards: {\n    \"slate is busy\": ({\n      context\n    }) => context.slateEditor ? context.slateEditor.operations.length > 0 : !1,\n    \"slate is normalizing node\": ({\n      context\n    }) => context.slateEditor ? context.slateEditor.isNormalizingNode : !1\n  }\n}).createMachine({\n  id: \"editor\",\n  context: ({\n    input\n  }) => ({\n    behaviors: new Set(coreBehaviorsConfig),\n    behaviorsSorted: !1,\n    converters: new Set(input.converters ?? []),\n    getLegacySchema: input.getLegacySchema,\n    keyGenerator: input.keyGenerator,\n    pendingEvents: [],\n    pendingIncomingPatchesEvents: [],\n    schema: input.schema,\n    selection: null,\n    initialReadOnly: input.readOnly ?? !1,\n    initialValue: input.initialValue\n  }),\n  on: {\n    \"add behavior\": {\n      actions: \"add behavior to context\"\n    },\n    \"remove behavior\": {\n      actions: \"remove behavior from context\"\n    },\n    \"add slate editor\": {\n      actions: \"add slate editor to context\"\n    },\n    \"update selection\": {\n      actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        selection: ({\n          event\n        }) => event.selection\n      }), (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n        event\n      }) => ({\n        ...event,\n        type: \"selection\"\n      }))]\n    },\n    \"set drag ghost\": {\n      actions: (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        dragGhost: ({\n          event\n        }) => event.ghost\n      })\n    }\n  },\n  type: \"parallel\",\n  states: {\n    \"edit mode\": {\n      initial: \"read only\",\n      states: {\n        \"read only\": {\n          initial: \"determine initial edit mode\",\n          on: {\n            \"behavior event\": {\n              actions: [\"sort behaviors\", \"handle behavior event\"],\n              guard: ({\n                event\n              }) => event.behaviorEvent.type === \"clipboard.copy\" || event.behaviorEvent.type === \"mouse.click\" || event.behaviorEvent.type === \"serialize\" || event.behaviorEvent.type === \"serialization.failure\" || event.behaviorEvent.type === \"serialization.success\" || event.behaviorEvent.type === \"select\"\n            }\n          },\n          states: {\n            \"determine initial edit mode\": {\n              entry: [() => {\n                debug$4(\"entry: edit mode->read only->determine initial edit mode\");\n              }],\n              exit: [() => {\n                debug$4(\"exit: edit mode->read only->determine initial edit mode\");\n              }],\n              on: {\n                \"done syncing value\": [{\n                  target: \"#editor.edit mode.read only.read only\",\n                  guard: ({\n                    context\n                  }) => context.initialReadOnly\n                }, {\n                  target: \"#editor.edit mode.editable\"\n                }]\n              }\n            },\n            \"read only\": {\n              entry: [() => {\n                debug$4(\"entry: edit mode->read only->read only\");\n              }],\n              exit: [() => {\n                debug$4(\"exit: edit mode->read only->read only\");\n              }],\n              on: {\n                \"update readOnly\": {\n                  guard: ({\n                    event\n                  }) => !event.readOnly,\n                  target: \"#editor.edit mode.editable\",\n                  actions: [\"emit editable\"]\n                }\n              }\n            }\n          }\n        },\n        editable: {\n          on: {\n            \"update readOnly\": {\n              guard: ({\n                event\n              }) => event.readOnly,\n              target: \"#editor.edit mode.read only.read only\",\n              actions: [\"emit read only\"]\n            },\n            \"behavior event\": {\n              actions: [\"sort behaviors\", \"handle behavior event\"]\n            },\n            blur: {\n              actions: \"handle blur\"\n            },\n            focus: {\n              target: \".focusing\",\n              actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n                slateEditor: ({\n                  event\n                }) => event.editor\n              })]\n            }\n          },\n          initial: \"idle\",\n          states: {\n            idle: {\n              entry: [() => {\n                debug$4(\"entry: edit mode->editable->idle\");\n              }],\n              exit: [() => {\n                debug$4(\"exit: edit mode->editable-idle\");\n              }],\n              on: {\n                dragstart: {\n                  actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n                    internalDrag: ({\n                      event\n                    }) => ({\n                      origin: event.origin\n                    })\n                  })],\n                  target: \"dragging internally\"\n                }\n              }\n            },\n            focusing: {\n              initial: \"checking if busy\",\n              states: {\n                \"checking if busy\": {\n                  entry: [() => {\n                    debug$4(\"entry: edit mode->editable->focusing->checking if busy\");\n                  }],\n                  exit: [() => {\n                    debug$4(\"exit: edit mode->editable->focusing->checking if busy\");\n                  }],\n                  always: [{\n                    guard: \"slate is busy\",\n                    target: \"busy\"\n                  }, {\n                    target: \"#editor.edit mode.editable.idle\",\n                    actions: [\"handle focus\"]\n                  }]\n                },\n                busy: {\n                  entry: [() => {\n                    debug$4(\"entry: edit mode->editable->focusing-busy\");\n                  }],\n                  exit: [() => {\n                    debug$4(\"exit: edit mode->editable->focusing->busy\");\n                  }],\n                  after: {\n                    10: {\n                      target: \"checking if busy\"\n                    }\n                  }\n                }\n              }\n            },\n            \"dragging internally\": {\n              entry: [() => {\n                debug$4(\"entry: edit mode->editable->dragging internally\");\n              }],\n              exit: [() => {\n                debug$4(\"exit: edit mode->editable->dragging internally\");\n              }, ({\n                context\n              }) => {\n                if (context.dragGhost)\n                  try {\n                    context.dragGhost.parentNode?.removeChild(context.dragGhost);\n                  } catch (error) {\n                    console.error(new Error(`Removing the drag ghost failed due to: ${error.message}`));\n                  }\n              }, (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n                dragGhost: void 0\n              }), (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n                internalDrag: void 0\n              })],\n              tags: [\"dragging internally\"],\n              on: {\n                dragend: {\n                  target: \"idle\"\n                },\n                drop: {\n                  target: \"idle\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    setup: {\n      initial: \"setting up\",\n      states: {\n        \"setting up\": {\n          entry: [() => {\n            debug$4(\"entry: setup->setting up\");\n          }],\n          exit: [() => {\n            debug$4(\"exit: setup->setting up\");\n          }, \"emit ready\", \"emit pending incoming patches\", \"clear pending incoming patches\"],\n          on: {\n            \"internal.patch\": {\n              actions: \"defer event\"\n            },\n            mutation: {\n              actions: \"defer event\"\n            },\n            \"done syncing value\": {\n              target: \"set up\"\n            },\n            patches: {\n              actions: [\"defer incoming patches\"]\n            }\n          }\n        },\n        \"set up\": {\n          type: \"parallel\",\n          states: {\n            \"value sync\": {\n              initial: \"idle\",\n              states: {\n                idle: {\n                  entry: [() => {\n                    debug$4(\"entry: setup->set up->value sync->idle\");\n                  }],\n                  exit: [() => {\n                    debug$4(\"exit: setup->set up->value sync->idle\");\n                  }],\n                  on: {\n                    patches: {\n                      actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n                        event\n                      }) => event)]\n                    },\n                    \"syncing value\": {\n                      target: \"syncing value\"\n                    }\n                  }\n                },\n                \"syncing value\": {\n                  entry: [() => {\n                    debug$4(\"entry: setup->set up->value sync->syncing value\");\n                  }],\n                  exit: [() => {\n                    debug$4(\"exit: setup->set up->value sync->syncing value\");\n                  }, \"emit pending incoming patches\", \"clear pending incoming patches\"],\n                  on: {\n                    patches: {\n                      actions: [\"defer incoming patches\"]\n                    },\n                    \"done syncing value\": {\n                      target: \"idle\"\n                    }\n                  }\n                }\n              }\n            },\n            writing: {\n              initial: \"pristine\",\n              states: {\n                pristine: {\n                  initial: \"idle\",\n                  states: {\n                    idle: {\n                      entry: [() => {\n                        debug$4(\"entry: setup->set up->writing->pristine->idle\");\n                      }],\n                      exit: [() => {\n                        debug$4(\"exit: setup->set up->writing->pristine->idle\");\n                      }],\n                      on: {\n                        \"internal.patch\": [{\n                          guard: \"slate is normalizing node\",\n                          actions: \"defer event\"\n                        }, {\n                          actions: \"defer event\",\n                          target: \"#editor.setup.set up.writing.dirty\"\n                        }],\n                        mutation: [{\n                          guard: \"slate is normalizing node\",\n                          actions: \"defer event\"\n                        }, {\n                          actions: \"defer event\",\n                          target: \"#editor.setup.set up.writing.dirty\"\n                        }]\n                      }\n                    }\n                  }\n                },\n                dirty: {\n                  entry: [() => {\n                    debug$4(\"entry: setup->set up->writing->dirty\");\n                  }, \"emit pending events\", \"clear pending events\"],\n                  exit: [() => {\n                    debug$4(\"exit: setup->set up->writing->dirty\");\n                  }],\n                  on: {\n                    \"internal.patch\": {\n                      actions: \"emit patch event\"\n                    },\n                    mutation: {\n                      actions: \"emit mutation event\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}), debug$3 = debugWithName(\"mutation-machine\"), mutationMachine = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    events: {},\n    input: {},\n    emitted: {}\n  },\n  actions: {\n    \"assign readOnly\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      readOnly: ({\n        context,\n        event\n      }) => event.type === \"update readOnly\" ? event.readOnly : context.readOnly\n    }),\n    \"emit patch\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n      event\n    }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"patch\"), {\n      type: \"patch\",\n      patch: event.patch\n    })),\n    \"emit has pending mutations\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n      type: \"has pending mutations\"\n    }),\n    \"emit mutations\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.e)(({\n      context,\n      enqueue\n    }) => {\n      for (const bulk of context.pendingMutations)\n        enqueue.emit({\n          type: \"mutation\",\n          patches: bulk.patches,\n          snapshot: bulk.value\n        });\n    }),\n    \"clear pending mutations\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingMutations: []\n    }),\n    \"defer mutation\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingMutations: ({\n        context,\n        event\n      }) => {\n        if ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"patch\"), context.pendingMutations.length === 0)\n          return [{\n            operationId: event.operationId,\n            value: event.value,\n            patches: [event.patch]\n          }];\n        const lastBulk = context.pendingMutations.at(-1);\n        return lastBulk && lastBulk.operationId === event.operationId ? context.pendingMutations.slice(0, -1).concat({\n          value: event.value,\n          operationId: lastBulk.operationId,\n          patches: [...lastBulk.patches, event.patch]\n        }) : context.pendingMutations.concat({\n          value: event.value,\n          operationId: event.operationId,\n          patches: [event.patch]\n        });\n      }\n    }),\n    \"clear pending patch events\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingPatchEvents: []\n    }),\n    \"defer patch\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingPatchEvents: ({\n        context,\n        event\n      }) => event.type === \"patch\" ? [...context.pendingPatchEvents, event] : context.pendingPatchEvents\n    }),\n    \"emit pending patch events\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.e)(({\n      context,\n      enqueue\n    }) => {\n      for (const event of context.pendingPatchEvents)\n        enqueue.emit(event);\n    })\n  },\n  actors: {\n    \"type listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_10__.fromCallback)(({\n      input,\n      sendBack\n    }) => {\n      const originalApply = input.slateEditor.apply;\n      return input.slateEditor.apply = (op) => {\n        op.type === \"insert_text\" || op.type === \"remove_text\" ? sendBack({\n          type: \"typing\"\n        }) : sendBack({\n          type: \"not typing\"\n        }), originalApply(op);\n      }, () => {\n        input.slateEditor.apply = originalApply;\n      };\n    }),\n    \"mutation interval\": (0,xstate__WEBPACK_IMPORTED_MODULE_10__.fromCallback)(({\n      sendBack\n    }) => {\n      const interval = setInterval(() => {\n        sendBack({\n          type: \"emit changes\"\n        });\n      },  false ? 0 : 1e3);\n      return () => {\n        clearInterval(interval);\n      };\n    })\n  },\n  guards: {\n    \"is read-only\": ({\n      context\n    }) => context.readOnly,\n    \"slate is normalizing\": ({\n      context\n    }) => slate__WEBPACK_IMPORTED_MODULE_5__.Editor.isNormalizing(context.slateEditor)\n  },\n  delays: {\n    \"type debounce\": 250\n  }\n}).createMachine({\n  id: \"mutation\",\n  context: ({\n    input\n  }) => ({\n    pendingMutations: [],\n    pendingPatchEvents: [],\n    readOnly: input.readOnly,\n    schema: input.schema,\n    slateEditor: input.slateEditor\n  }),\n  on: {\n    \"update readOnly\": {\n      actions: [\"assign readOnly\"]\n    }\n  },\n  type: \"parallel\",\n  states: {\n    typing: {\n      initial: \"idle\",\n      invoke: {\n        src: \"type listener\",\n        input: ({\n          context\n        }) => ({\n          slateEditor: context.slateEditor\n        })\n      },\n      states: {\n        idle: {\n          entry: [() => {\n            debug$3(\"entry: typing->idle\");\n          }],\n          exit: [() => {\n            debug$3(\"exit: typing->idle\"), debug$3(\"entry: typing->typing\");\n          }],\n          on: {\n            typing: {\n              target: \"typing\"\n            }\n          }\n        },\n        typing: {\n          after: {\n            \"type debounce\": {\n              target: \"idle\",\n              actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_11__.r)({\n                type: \"emit changes\"\n              }), () => {\n                debug$3(\"exit: typing->typing\");\n              }]\n            }\n          },\n          on: {\n            \"not typing\": {\n              target: \"idle\",\n              actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_11__.r)({\n                type: \"emit changes\"\n              })]\n            },\n            typing: {\n              target: \"typing\",\n              reenter: !0\n            }\n          }\n        }\n      }\n    },\n    mutations: {\n      initial: \"idle\",\n      states: {\n        idle: {\n          entry: [() => {\n            debug$3(\"entry: mutations->idle\");\n          }],\n          exit: [() => {\n            debug$3(\"exit: mutations->idle\");\n          }],\n          on: {\n            patch: [{\n              guard: \"is read-only\",\n              actions: [\"defer patch\", \"defer mutation\"],\n              target: \"has pending mutations\"\n            }, {\n              actions: [\"emit patch\", \"defer mutation\"],\n              target: \"has pending mutations\"\n            }]\n          }\n        },\n        \"has pending mutations\": {\n          entry: [() => {\n            debug$3(\"entry: mutations->has pending mutations\");\n          }, \"emit has pending mutations\"],\n          exit: [() => {\n            debug$3(\"exit: mutations->has pending mutations\");\n          }],\n          invoke: {\n            src: \"mutation interval\"\n          },\n          on: {\n            \"emit changes\": {\n              guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.d)([(0,xstate__WEBPACK_IMPORTED_MODULE_11__.n)(\"is read-only\"), \"slate is normalizing\"]),\n              target: \"idle\",\n              actions: [\"emit pending patch events\", \"clear pending patch events\", \"emit mutations\", \"clear pending mutations\"]\n            },\n            patch: [{\n              guard: \"is read-only\",\n              actions: [\"defer patch\", \"defer mutation\"]\n            }, {\n              actions: [\"emit patch\", \"defer mutation\"]\n            }]\n          }\n        }\n      }\n    }\n  }\n}), relayMachine = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    events: {},\n    emitted: {}\n  }\n}).createMachine({\n  id: \"relay\",\n  context: {\n    prevSelection: null,\n    lastEventWasFocused: !1\n  },\n  on: {\n    focused: {\n      actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        lastEventWasFocused: !0\n      }), (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n        event\n      }) => event)]\n    },\n    selection: [{\n      guard: ({\n        context\n      }) => context.lastEventWasFocused,\n      actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        prevSelection: ({\n          event\n        }) => event.selection\n      }), (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n        event\n      }) => event), (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        lastEventWasFocused: !1\n      })]\n    }, {\n      guard: ({\n        context,\n        event\n      }) => context.prevSelection !== event.selection,\n      actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        prevSelection: ({\n          event\n        }) => event.selection\n      }), (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n        event\n      }) => event), (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        lastEventWasFocused: !1\n      })]\n    }],\n    \"*\": {\n      actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n        event\n      }) => event), (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        lastEventWasFocused: !1\n      })]\n    }\n  }\n});\nfunction validateValue(value, types, keyGenerator) {\n  let resolution = null, valid = !0;\n  const validChildTypes = [types.span.name, ...types.inlineObjects.map((t) => t.name)], validBlockTypes = [types.block.name, ...types.blockObjects.map((t) => t.name)];\n  return value === void 0 ? {\n    valid: !0,\n    resolution: null,\n    value\n  } : !Array.isArray(value) || value.length === 0 ? {\n    valid: !1,\n    resolution: {\n      patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([])],\n      description: \"Editor value must be an array of Portable Text blocks, or undefined.\",\n      action: \"Unset the value\",\n      item: value,\n      i18n: {\n        description: \"inputs.portable-text.invalid-value.not-an-array.description\",\n        action: \"inputs.portable-text.invalid-value.not-an-array.action\"\n      }\n    },\n    value\n  } : (value.some((blk, index) => {\n    if (typeof blk != \"object\" || blk === null)\n      return resolution = {\n        patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([index])],\n        description: `Block must be an object, got ${String(blk)}`,\n        action: \"Unset invalid item\",\n        item: blk,\n        i18n: {\n          description: \"inputs.portable-text.invalid-value.not-an-object.description\",\n          action: \"inputs.portable-text.invalid-value.not-an-object.action\",\n          values: {\n            index\n          }\n        }\n      }, !0;\n    if (!blk._key || typeof blk._key != \"string\")\n      return resolution = {\n        patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)({\n          ...blk,\n          _key: keyGenerator()\n        }, [index])],\n        description: `Block at index ${index} is missing required _key.`,\n        action: \"Set the block with a random _key value\",\n        item: blk,\n        i18n: {\n          description: \"inputs.portable-text.invalid-value.missing-key.description\",\n          action: \"inputs.portable-text.invalid-value.missing-key.action\",\n          values: {\n            index\n          }\n        }\n      }, !0;\n    if (!blk._type || !validBlockTypes.includes(blk._type)) {\n      if (blk._type === \"block\") {\n        const currentBlockTypeName = types.block.name;\n        return resolution = {\n          patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)({\n            ...blk,\n            _type: currentBlockTypeName\n          }, [{\n            _key: blk._key\n          }])],\n          description: `Block with _key '${blk._key}' has invalid type name '${blk._type}'. According to the schema, the block type name is '${currentBlockTypeName}'`,\n          action: `Use type '${currentBlockTypeName}'`,\n          item: blk,\n          i18n: {\n            description: \"inputs.portable-text.invalid-value.incorrect-block-type.description\",\n            action: \"inputs.portable-text.invalid-value.incorrect-block-type.action\",\n            values: {\n              key: blk._key,\n              expectedTypeName: currentBlockTypeName\n            }\n          }\n        }, !0;\n      }\n      return !blk._type && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isTextBlock)({\n        schema: types\n      }, {\n        ...blk,\n        _type: types.block.name\n      }) ? (resolution = {\n        patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)({\n          ...blk,\n          _type: types.block.name\n        }, [{\n          _key: blk._key\n        }])],\n        description: `Block with _key '${blk._key}' is missing a type name. According to the schema, the block type name is '${types.block.name}'`,\n        action: `Use type '${types.block.name}'`,\n        item: blk,\n        i18n: {\n          description: \"inputs.portable-text.invalid-value.missing-block-type.description\",\n          action: \"inputs.portable-text.invalid-value.missing-block-type.action\",\n          values: {\n            key: blk._key,\n            expectedTypeName: types.block.name\n          }\n        }\n      }, !0) : blk._type ? (resolution = {\n        patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n          _key: blk._key\n        }])],\n        description: `Block with _key '${blk._key}' has invalid _type '${blk._type}'`,\n        action: \"Remove the block\",\n        item: blk,\n        i18n: {\n          description: \"inputs.portable-text.invalid-value.disallowed-type.description\",\n          action: \"inputs.portable-text.invalid-value.disallowed-type.action\",\n          values: {\n            key: blk._key,\n            typeName: blk._type\n          }\n        }\n      }, !0) : (resolution = {\n        patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n          _key: blk._key\n        }])],\n        description: `Block with _key '${blk._key}' is missing an _type property`,\n        action: \"Remove the block\",\n        item: blk,\n        i18n: {\n          description: \"inputs.portable-text.invalid-value.missing-type.description\",\n          action: \"inputs.portable-text.invalid-value.missing-type.action\",\n          values: {\n            key: blk._key\n          }\n        }\n      }, !0);\n    }\n    if (blk._type === types.block.name) {\n      const textBlock = blk;\n      if (textBlock.children && !Array.isArray(textBlock.children))\n        return resolution = {\n          patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)({\n            children: []\n          }, [{\n            _key: textBlock._key\n          }])],\n          description: `Text block with _key '${textBlock._key}' has a invalid required property 'children'.`,\n          action: \"Reset the children property\",\n          item: textBlock,\n          i18n: {\n            description: \"inputs.portable-text.invalid-value.missing-or-invalid-children.description\",\n            action: \"inputs.portable-text.invalid-value.missing-or-invalid-children.action\",\n            values: {\n              key: textBlock._key\n            }\n          }\n        }, !0;\n      if (textBlock.children === void 0 || Array.isArray(textBlock.children) && textBlock.children.length === 0) {\n        const newSpan = {\n          _type: types.span.name,\n          _key: keyGenerator(),\n          text: \"\",\n          marks: []\n        };\n        return resolution = {\n          autoResolve: !0,\n          patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.setIfMissing)([], [{\n            _key: blk._key\n          }, \"children\"]), (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.insert)([newSpan], \"after\", [{\n            _key: blk._key\n          }, \"children\", 0])],\n          description: `Children for text block with _key '${blk._key}' is empty.`,\n          action: \"Insert an empty text\",\n          item: blk,\n          i18n: {\n            description: \"inputs.portable-text.invalid-value.empty-children.description\",\n            action: \"inputs.portable-text.invalid-value.empty-children.action\",\n            values: {\n              key: blk._key\n            }\n          }\n        }, !0;\n      }\n      const allUsedMarks = [...new Set(textBlock.children.filter((child) => (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n        schema: types\n      }, child)).flatMap((cld) => cld.marks || []))];\n      if (Array.isArray(blk.markDefs) && blk.markDefs.length > 0) {\n        const unusedMarkDefs = [...new Set(blk.markDefs.map((def) => def._key).filter((key) => !allUsedMarks.includes(key)))];\n        if (unusedMarkDefs.length > 0)\n          return resolution = {\n            autoResolve: !0,\n            patches: unusedMarkDefs.map((markDefKey) => (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n              _key: blk._key\n            }, \"markDefs\", {\n              _key: markDefKey\n            }])),\n            description: `Block contains orphaned data (unused mark definitions): ${unusedMarkDefs.join(\", \")}.`,\n            action: \"Remove unused mark definition item\",\n            item: blk,\n            i18n: {\n              description: \"inputs.portable-text.invalid-value.orphaned-mark-defs.description\",\n              action: \"inputs.portable-text.invalid-value.orphaned-mark-defs.action\",\n              values: {\n                key: blk._key,\n                unusedMarkDefs: unusedMarkDefs.map((m) => m.toString())\n              }\n            }\n          }, !0;\n      }\n      const orphanedMarks = allUsedMarks.filter((mark) => !types.decorators.map((dec) => dec.name).includes(mark)).filter((mark) => textBlock.markDefs === void 0 || !textBlock.markDefs.find((def) => def._key === mark));\n      if (orphanedMarks.length > 0) {\n        const spanChildren = textBlock.children.filter((cld) => cld._type === types.span.name && Array.isArray(cld.marks) && cld.marks.some((mark) => orphanedMarks.includes(mark)));\n        if (spanChildren) {\n          const orphaned = orphanedMarks.join(\", \");\n          return resolution = {\n            autoResolve: !0,\n            patches: spanChildren.map((child) => (0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)((child.marks || []).filter((cMrk) => !orphanedMarks.includes(cMrk)), [{\n              _key: blk._key\n            }, \"children\", {\n              _key: child._key\n            }, \"marks\"])),\n            description: `Block with _key '${blk._key}' contains marks (${orphaned}) not supported by the current content model.`,\n            action: \"Remove invalid marks\",\n            item: blk,\n            i18n: {\n              description: \"inputs.portable-text.invalid-value.orphaned-marks.description\",\n              action: \"inputs.portable-text.invalid-value.orphaned-marks.action\",\n              values: {\n                key: blk._key,\n                orphanedMarks: orphanedMarks.map((m) => m.toString())\n              }\n            }\n          }, !0;\n        }\n      }\n      textBlock.children.some((child, cIndex) => {\n        if (typeof child != \"object\" || child === null)\n          return resolution = {\n            patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n              _key: blk._key\n            }, \"children\", cIndex])],\n            description: `Child at index '${cIndex}' in block with key '${blk._key}' is not an object.`,\n            action: \"Remove the item\",\n            item: blk,\n            i18n: {\n              description: \"inputs.portable-text.invalid-value.non-object-child.description\",\n              action: \"inputs.portable-text.invalid-value.non-object-child.action\",\n              values: {\n                key: blk._key,\n                index: cIndex\n              }\n            }\n          }, !0;\n        if (!child._key || typeof child._key != \"string\") {\n          const newChild = {\n            ...child,\n            _key: keyGenerator()\n          };\n          return resolution = {\n            autoResolve: !0,\n            patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)(newChild, [{\n              _key: blk._key\n            }, \"children\", cIndex])],\n            description: `Child at index ${cIndex} is missing required _key in block with _key ${blk._key}.`,\n            action: \"Set a new random _key on the object\",\n            item: blk,\n            i18n: {\n              description: \"inputs.portable-text.invalid-value.missing-child-key.description\",\n              action: \"inputs.portable-text.invalid-value.missing-child-key.action\",\n              values: {\n                key: blk._key,\n                index: cIndex\n              }\n            }\n          }, !0;\n        }\n        return child._type ? validChildTypes.includes(child._type) ? child._type === types.span.name && typeof child.text != \"string\" ? (resolution = {\n          patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.set)({\n            ...child,\n            text: \"\"\n          }, [{\n            _key: blk._key\n          }, \"children\", {\n            _key: child._key\n          }])],\n          description: `Child with _key '${child._key}' in block with key '${blk._key}' has missing or invalid text property!`,\n          action: \"Write an empty text property to the object\",\n          item: blk,\n          i18n: {\n            description: \"inputs.portable-text.invalid-value.invalid-span-text.description\",\n            action: \"inputs.portable-text.invalid-value.invalid-span-text.action\",\n            values: {\n              key: blk._key,\n              childKey: child._key\n            }\n          }\n        }, !0) : !1 : (resolution = {\n          patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n            _key: blk._key\n          }, \"children\", {\n            _key: child._key\n          }])],\n          description: `Child with _key '${child._key}' in block with key '${blk._key}' has invalid '_type' property (${child._type}).`,\n          action: \"Remove the object\",\n          item: blk,\n          i18n: {\n            description: \"inputs.portable-text.invalid-value.disallowed-child-type.description\",\n            action: \"inputs.portable-text.invalid-value.disallowed-child-type.action\",\n            values: {\n              key: blk._key,\n              childKey: child._key,\n              childType: child._type\n            }\n          }\n        }, !0) : (resolution = {\n          patches: [(0,_portabletext_patches__WEBPACK_IMPORTED_MODULE_21__.unset)([{\n            _key: blk._key\n          }, \"children\", {\n            _key: child._key\n          }])],\n          description: `Child with _key '${child._key}' in block with key '${blk._key}' is missing '_type' property.`,\n          action: \"Remove the object\",\n          item: blk,\n          i18n: {\n            description: \"inputs.portable-text.invalid-value.missing-child-type.description\",\n            action: \"inputs.portable-text.invalid-value.missing-child-type.action\",\n            values: {\n              key: blk._key,\n              childKey: child._key\n            }\n          }\n        }, !0);\n      }) && (valid = !1);\n    }\n    return !1;\n  }) && (valid = !1), {\n    valid,\n    resolution,\n    value\n  });\n}\nconst debug$2 = debugWithName(\"sync machine\"), syncValueCallback = ({\n  sendBack,\n  input\n}) => {\n  updateValue({\n    context: input.context,\n    sendBack,\n    slateEditor: input.slateEditor,\n    value: input.value,\n    streamBlocks: input.streamBlocks\n  });\n}, syncValueLogic = (0,xstate__WEBPACK_IMPORTED_MODULE_10__.fromCallback)(syncValueCallback), syncMachine = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    input: {},\n    events: {},\n    emitted: {}\n  },\n  actions: {\n    \"assign initial value synced\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      initialValueSynced: !0\n    }),\n    \"assign readOnly\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      readOnly: ({\n        event\n      }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"update readOnly\"), event.readOnly)\n    }),\n    \"assign pending value\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingValue: ({\n        event\n      }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"update value\"), event.value)\n    }),\n    \"clear pending value\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      pendingValue: void 0\n    }),\n    \"assign previous value\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n      previousValue: ({\n        event\n      }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"done syncing\"), event.value)\n    }),\n    \"emit done syncing value\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n      type: \"done syncing value\"\n    }),\n    \"emit syncing value\": (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n      type: \"syncing value\"\n    })\n  },\n  guards: {\n    \"initial value synced\": ({\n      context\n    }) => context.initialValueSynced,\n    \"is busy\": ({\n      context\n    }) => {\n      const isProcessingLocalChanges = context.isProcessingLocalChanges, isChanging = context.slateEditor.isProcessingRemoteChanges ?? !1, isBusy = isProcessingLocalChanges || isChanging;\n      return debug$2(\"isBusy\", {\n        isBusy,\n        isProcessingLocalChanges,\n        isChanging\n      }), isBusy;\n    },\n    \"is empty value\": ({\n      event\n    }) => event.type === \"update value\" && event.value === void 0,\n    \"is empty array\": ({\n      event\n    }) => event.type === \"update value\" && Array.isArray(event.value) && event.value.length === 0,\n    \"is new value\": ({\n      context,\n      event\n    }) => event.type === \"update value\" && context.previousValue !== event.value,\n    \"value changed while syncing\": ({\n      context,\n      event\n    }) => ((0,xstate__WEBPACK_IMPORTED_MODULE_8__.assertEvent)(event, \"done syncing\"), context.pendingValue !== event.value),\n    \"pending value equals previous value\": ({\n      context\n    }) => isEqualValues({\n      schema: context.schema\n    }, context.pendingValue, context.previousValue)\n  },\n  actors: {\n    \"sync value\": syncValueLogic\n  }\n}).createMachine({\n  id: \"sync\",\n  context: ({\n    input\n  }) => ({\n    initialValue: input.initialValue,\n    initialValueSynced: !1,\n    isProcessingLocalChanges: !1,\n    keyGenerator: input.keyGenerator,\n    schema: input.schema,\n    readOnly: input.readOnly,\n    slateEditor: input.slateEditor,\n    pendingValue: void 0,\n    previousValue: void 0\n  }),\n  entry: [(0,xstate__WEBPACK_IMPORTED_MODULE_11__.r)(({\n    context\n  }) => ({\n    type: \"update value\",\n    value: context.initialValue\n  }))],\n  on: {\n    \"has pending mutations\": {\n      actions: (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        isProcessingLocalChanges: !0\n      })\n    },\n    mutation: {\n      actions: (0,xstate__WEBPACK_IMPORTED_MODULE_9__.a)({\n        isProcessingLocalChanges: !1\n      })\n    },\n    \"update readOnly\": {\n      actions: [\"assign readOnly\"]\n    }\n  },\n  initial: \"idle\",\n  states: {\n    idle: {\n      entry: [() => {\n        debug$2(\"entry: syncing->idle\");\n      }],\n      exit: [() => {\n        debug$2(\"exit: syncing->idle\");\n      }],\n      on: {\n        \"update value\": [{\n          guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.d)([\"is empty value\", (0,xstate__WEBPACK_IMPORTED_MODULE_11__.n)(\"initial value synced\")]),\n          actions: [\"assign initial value synced\", \"emit done syncing value\"]\n        }, {\n          guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.d)([\"is empty array\", (0,xstate__WEBPACK_IMPORTED_MODULE_11__.n)(\"initial value synced\")]),\n          actions: [\"assign initial value synced\", (0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)({\n            type: \"value changed\",\n            value: []\n          }), \"emit done syncing value\"]\n        }, {\n          guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.d)([\"is busy\", \"is new value\"]),\n          target: \"busy\",\n          actions: [\"assign pending value\"]\n        }, {\n          guard: \"is new value\",\n          target: \"syncing\",\n          actions: [\"assign pending value\"]\n        }, {\n          guard: (0,xstate__WEBPACK_IMPORTED_MODULE_11__.n)(\"initial value synced\"),\n          actions: [() => {\n            debug$2(\"no new value \\u2013 setting initial value as synced\");\n          }, \"assign initial value synced\", \"emit done syncing value\"]\n        }, {\n          actions: [() => {\n            debug$2(\"no new value and initial value already synced\");\n          }]\n        }]\n      }\n    },\n    busy: {\n      entry: [() => {\n        debug$2(\"entry: syncing->busy\");\n      }],\n      exit: [() => {\n        debug$2(\"exit: syncing->busy\");\n      }],\n      after: {\n        1e3: [{\n          guard: \"is busy\",\n          target: \".\",\n          reenter: !0,\n          actions: [() => {\n            debug$2(\"reenter: syncing->busy\");\n          }]\n        }, {\n          target: \"syncing\"\n        }]\n      },\n      on: {\n        \"update value\": [{\n          guard: \"is new value\",\n          actions: [\"assign pending value\"]\n        }]\n      }\n    },\n    syncing: {\n      entry: [() => {\n        debug$2(\"entry: syncing->syncing\");\n      }, \"emit syncing value\"],\n      exit: [() => {\n        debug$2(\"exit: syncing->syncing\");\n      }, \"emit done syncing value\"],\n      invoke: {\n        src: \"sync value\",\n        id: \"sync value\",\n        input: ({\n          context\n        }) => ({\n          context: {\n            keyGenerator: context.keyGenerator,\n            previousValue: context.previousValue,\n            readOnly: context.readOnly,\n            schema: context.schema\n          },\n          slateEditor: context.slateEditor,\n          streamBlocks: !context.initialValueSynced,\n          value: context.pendingValue\n        })\n      },\n      on: {\n        \"update value\": {\n          guard: \"is new value\",\n          actions: [\"assign pending value\"]\n        },\n        patch: {\n          actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n            event\n          }) => event)]\n        },\n        \"invalid value\": {\n          actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n            event\n          }) => event)]\n        },\n        \"value changed\": {\n          actions: [(0,xstate__WEBPACK_IMPORTED_MODULE_23__.a)(({\n            event\n          }) => event)]\n        },\n        \"done syncing\": [{\n          guard: \"value changed while syncing\",\n          actions: [\"assign previous value\", \"assign initial value synced\"],\n          target: \"syncing\",\n          reenter: !0\n        }, {\n          target: \"idle\",\n          actions: [\"clear pending value\", \"assign previous value\", \"assign initial value synced\"]\n        }]\n      }\n    }\n  }\n});\nasync function updateValue({\n  context,\n  sendBack,\n  slateEditor,\n  streamBlocks,\n  value\n}) {\n  let doneSyncing = !1, isChanged = !1, isValid = !0;\n  const hadSelection = !!slateEditor.selection;\n  if ((!value || value.length === 0) && (debug$2(\"Value is empty\"), clearEditor({\n    slateEditor,\n    doneSyncing\n  }), isChanged = !0), value && value.length > 0)\n    if (streamBlocks)\n      await new Promise((resolve) => {\n        if (doneSyncing) {\n          resolve();\n          return;\n        }\n        isChanged = removeExtraBlocks({\n          slateEditor,\n          value\n        }), (async () => {\n          for await (const [currentBlock, currentBlockIndex] of getStreamedBlocks({\n            value\n          })) {\n            const {\n              blockChanged,\n              blockValid\n            } = syncBlock({\n              context,\n              sendBack,\n              block: currentBlock,\n              index: currentBlockIndex,\n              slateEditor,\n              value\n            });\n            if (isChanged = blockChanged || isChanged, isValid = isValid && blockValid, !isValid)\n              break;\n          }\n          resolve();\n        })();\n      });\n    else {\n      if (doneSyncing)\n        return;\n      isChanged = removeExtraBlocks({\n        slateEditor,\n        value\n      });\n      let index = 0;\n      for (const block of value) {\n        const {\n          blockChanged,\n          blockValid\n        } = syncBlock({\n          context,\n          sendBack,\n          block,\n          index,\n          slateEditor,\n          value\n        });\n        if (isChanged = blockChanged || isChanged, isValid = isValid && blockValid, !blockValid)\n          break;\n        index++;\n      }\n    }\n  if (!isValid) {\n    debug$2(\"Invalid value, returning\"), doneSyncing = !0, sendBack({\n      type: \"done syncing\",\n      value\n    });\n    return;\n  }\n  if (isChanged) {\n    debug$2(\"Server value changed, syncing editor\");\n    try {\n      slateEditor.onChange();\n    } catch (err) {\n      console.error(err), sendBack({\n        type: \"invalid value\",\n        resolution: null,\n        value\n      }), doneSyncing = !0, sendBack({\n        type: \"done syncing\",\n        value\n      });\n      return;\n    }\n    hadSelection && !slateEditor.selection && (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(slateEditor, {\n      anchor: {\n        path: [0, 0],\n        offset: 0\n      },\n      focus: {\n        path: [0, 0],\n        offset: 0\n      }\n    }), slateEditor.onChange()), sendBack({\n      type: \"value changed\",\n      value\n    });\n  } else\n    debug$2(\"Server value and editor value is equal, no need to sync.\");\n  doneSyncing = !0, sendBack({\n    type: \"done syncing\",\n    value\n  });\n}\nasync function* getStreamedBlocks({\n  value\n}) {\n  let index = 0;\n  for await (const block of value)\n    index % 10 === 0 && await new Promise((resolve) => setTimeout(resolve, 0)), yield [block, index], index++;\n}\nfunction clearEditor({\n  slateEditor,\n  doneSyncing\n}) {\n  slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(slateEditor, () => {\n    pluginWithoutHistory(slateEditor, () => {\n      withRemoteChanges(slateEditor, () => {\n        withoutPatching(slateEditor, () => {\n          if (doneSyncing)\n            return;\n          const childrenLength = slateEditor.children.length;\n          slateEditor.children.forEach((_, index) => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(slateEditor, {\n              at: [childrenLength - 1 - index]\n            });\n          });\n        });\n      });\n    });\n  });\n}\nfunction removeExtraBlocks({\n  slateEditor,\n  value\n}) {\n  let isChanged = !1;\n  return slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(slateEditor, () => {\n    withRemoteChanges(slateEditor, () => {\n      withoutPatching(slateEditor, () => {\n        const childrenLength = slateEditor.children.length;\n        if (value.length < childrenLength) {\n          for (let i = childrenLength - 1; i > value.length - 1; i--)\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(slateEditor, {\n              at: [i]\n            });\n          isChanged = !0;\n        }\n      });\n    });\n  }), isChanged;\n}\nfunction syncBlock({\n  context,\n  sendBack,\n  block,\n  index,\n  slateEditor,\n  value\n}) {\n  const oldBlock = slateEditor.children.at(index);\n  if (!oldBlock) {\n    const validation2 = validateValue([block], context.schema, context.keyGenerator);\n    if (debug$2.enabled && debug$2(\"Validating and inserting new block in the end of the value\", block), validation2.valid || validation2.resolution?.autoResolve) {\n      const slateBlock = toSlateBlock(block, {\n        schemaTypes: context.schema\n      });\n      return slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(slateEditor, () => {\n        withRemoteChanges(slateEditor, () => {\n          withoutPatching(slateEditor, () => {\n            slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(slateEditor, slateBlock, {\n              at: [index]\n            });\n          });\n        });\n      }), {\n        blockChanged: !0,\n        blockValid: !0\n      };\n    }\n    return debug$2(\"Invalid\", validation2), sendBack({\n      type: \"invalid value\",\n      resolution: validation2.resolution,\n      value\n    }), {\n      blockChanged: !1,\n      blockValid: !1\n    };\n  }\n  if (isEqualBlocks(context, block, oldBlock))\n    return {\n      blockChanged: !1,\n      blockValid: !0\n    };\n  const validationValue = [value[index]], validation = validateValue(validationValue, context.schema, context.keyGenerator);\n  return !validation.valid && validation.resolution?.autoResolve && validation.resolution?.patches.length > 0 && !context.readOnly && context.previousValue && context.previousValue !== value && (console.warn(`${validation.resolution.action} for block with _key '${validationValue[0]._key}'. ${validation.resolution?.description}`), validation.resolution.patches.forEach((patch) => {\n    sendBack({\n      type: \"patch\",\n      patch\n    });\n  })), validation.valid || validation.resolution?.autoResolve ? (oldBlock._key === block._key ? (debug$2.enabled && debug$2(\"Updating block\", oldBlock, block), slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(slateEditor, () => {\n    withRemoteChanges(slateEditor, () => {\n      withoutPatching(slateEditor, () => {\n        updateBlock({\n          context,\n          slateEditor,\n          oldBlock,\n          block,\n          index\n        });\n      });\n    });\n  })) : (debug$2.enabled && debug$2(\"Replacing block\", oldBlock, block), slate__WEBPACK_IMPORTED_MODULE_5__.Editor.withoutNormalizing(slateEditor, () => {\n    withRemoteChanges(slateEditor, () => {\n      withoutPatching(slateEditor, () => {\n        replaceBlock({\n          context,\n          slateEditor,\n          block,\n          index\n        });\n      });\n    });\n  })), {\n    blockChanged: !0,\n    blockValid: !0\n  }) : (sendBack({\n    type: \"invalid value\",\n    resolution: validation.resolution,\n    value\n  }), {\n    blockChanged: !1,\n    blockValid: !1\n  });\n}\nfunction replaceBlock({\n  context,\n  slateEditor,\n  block,\n  index\n}) {\n  const slateBlock = toSlateBlock(block, {\n    schemaTypes: context.schema\n  }), currentSelection = slateEditor.selection, selectionFocusOnBlock = currentSelection && currentSelection.focus.path[0] === index;\n  selectionFocusOnBlock && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.deselect(slateEditor), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(slateEditor, {\n    at: [index]\n  }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(slateEditor, slateBlock, {\n    at: [index]\n  }), slateEditor.onChange(), selectionFocusOnBlock && slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.select(slateEditor, currentSelection);\n}\nfunction updateBlock({\n  context,\n  slateEditor,\n  oldBlock,\n  block,\n  index\n}) {\n  const slateBlock = toSlateBlock(block, {\n    schemaTypes: context.schema\n  });\n  if (slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(slateEditor, slateBlock, {\n    at: [index]\n  }), slateEditor.isTextBlock(slateBlock) && slateEditor.isTextBlock(oldBlock)) {\n    const oldBlockChildrenLength = oldBlock.children.length;\n    slateBlock.children.length < oldBlockChildrenLength && Array.from(Array(oldBlockChildrenLength - slateBlock.children.length)).forEach((_, index2) => {\n      const childIndex = oldBlockChildrenLength - 1 - index2;\n      childIndex > 0 && (debug$2(\"Removing child\"), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(slateEditor, {\n        at: [index2, childIndex]\n      }));\n    }), slateBlock.children.forEach((currentBlockChild, currentBlockChildIndex) => {\n      const oldBlockChild = oldBlock.children.at(currentBlockChildIndex), isChildChanged = oldBlockChild && !isEqualChild(currentBlockChild, oldBlockChild), isTextChanged = oldBlockChild && slate__WEBPACK_IMPORTED_MODULE_5__.Text.isText(oldBlockChild) && currentBlockChild.text !== oldBlockChild.text, path = [index, currentBlockChildIndex];\n      if (isChildChanged)\n        if (currentBlockChild._key === oldBlockChild?._key) {\n          debug$2(\"Updating changed child\", currentBlockChild, oldBlockChild), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(slateEditor, currentBlockChild, {\n            at: path\n          });\n          const isSpanNode2 = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n            schema: context.schema\n          }, currentBlockChild) && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.isSpan)({\n            schema: context.schema\n          }, oldBlockChild);\n          isSpanNode2 && isTextChanged ? (oldBlockChild.text.length > 0 && (0,slate__WEBPACK_IMPORTED_MODULE_5__.deleteText)(slateEditor, {\n            at: {\n              focus: {\n                path,\n                offset: 0\n              },\n              anchor: {\n                path,\n                offset: oldBlockChild.text.length\n              }\n            }\n          }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertText(slateEditor, currentBlockChild.text, {\n            at: path\n          }), slateEditor.onChange()) : isSpanNode2 || (debug$2(\"Updating changed inline object child\", currentBlockChild), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.setNodes(slateEditor, {\n            _key: VOID_CHILD_KEY\n          }, {\n            at: [...path, 0],\n            voids: !0\n          }));\n        } else oldBlockChild ? (debug$2(\"Replacing child\", currentBlockChild), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.removeNodes(slateEditor, {\n          at: [index, currentBlockChildIndex]\n        }), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(slateEditor, currentBlockChild, {\n          at: [index, currentBlockChildIndex]\n        }), slateEditor.onChange()) : oldBlockChild || (debug$2(\"Inserting new child\", currentBlockChild), slate__WEBPACK_IMPORTED_MODULE_5__.Transforms.insertNodes(slateEditor, currentBlockChild, {\n          at: [index, currentBlockChildIndex]\n        }), slateEditor.onChange());\n    });\n  }\n}\nconst debug$1 = debugWithName(\"setup\");\nfunction createInternalEditor(config) {\n  debug$1(\"Creating new Editor instance\");\n  const subscriptions = [], editorActor = (0,xstate__WEBPACK_IMPORTED_MODULE_11__.c)(editorMachine, {\n    input: editorConfigToMachineInput(config)\n  }), relayActor = (0,xstate__WEBPACK_IMPORTED_MODULE_11__.c)(relayMachine), slateEditor = createSlateEditor({\n    editorActor,\n    relayActor,\n    subscriptions\n  }), editable = createEditableAPI(slateEditor.instance, editorActor), {\n    mutationActor,\n    syncActor\n  } = createActors({\n    editorActor,\n    relayActor,\n    slateEditor: slateEditor.instance,\n    subscriptions\n  }), editor = {\n    dom: createEditorDom((event) => editorActor.send(event), slateEditor.instance),\n    getSnapshot: () => getEditorSnapshot({\n      editorActorSnapshot: editorActor.getSnapshot(),\n      slateEditorInstance: slateEditor.instance\n    }),\n    registerBehavior: (behaviorConfig) => {\n      const priority = createEditorPriority({\n        name: \"custom\",\n        reference: {\n          priority: corePriority,\n          importance: \"higher\"\n        }\n      }), behaviorConfigWithPriority = {\n        ...behaviorConfig,\n        priority\n      };\n      return editorActor.send({\n        type: \"add behavior\",\n        behaviorConfig: behaviorConfigWithPriority\n      }), () => {\n        editorActor.send({\n          type: \"remove behavior\",\n          behaviorConfig: behaviorConfigWithPriority\n        });\n      };\n    },\n    send: (event) => {\n      switch (event.type) {\n        case \"update value\":\n          syncActor.send(event);\n          break;\n        case \"update readOnly\":\n        case \"patches\":\n          editorActor.send(event);\n          break;\n        default:\n          editorActor.send(rerouteExternalBehaviorEvent({\n            event,\n            slateEditor: slateEditor.instance\n          }));\n      }\n    },\n    on: (event, listener) => relayActor.on(event, (event2) => {\n      switch (event2.type) {\n        case \"blurred\":\n        case \"done loading\":\n        case \"editable\":\n        case \"focused\":\n        case \"invalid value\":\n        case \"loading\":\n        case \"mutation\":\n        case \"patch\":\n        case \"read only\":\n        case \"ready\":\n        case \"selection\":\n        case \"value changed\":\n          listener(event2);\n          break;\n      }\n    }),\n    _internal: {\n      editable,\n      editorActor,\n      slateEditor\n    }\n  };\n  return {\n    actors: {\n      editorActor,\n      mutationActor,\n      relayActor,\n      syncActor\n    },\n    editor,\n    subscriptions\n  };\n}\nfunction editorConfigToMachineInput(config) {\n  const {\n    legacySchema,\n    schema\n  } = compileSchemasFromEditorConfig(config);\n  return {\n    converters: createCoreConverters(legacySchema),\n    getLegacySchema: () => legacySchema,\n    keyGenerator: config.keyGenerator ?? _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_6__.defaultKeyGenerator,\n    readOnly: config.readOnly,\n    schema,\n    initialValue: config.initialValue\n  };\n}\nfunction compileSchemasFromEditorConfig(config) {\n  const legacySchema = config.schemaDefinition ? (0,_portabletext_sanity_bridge__WEBPACK_IMPORTED_MODULE_24__.compileSchemaDefinitionToPortableTextMemberSchemaTypes)(config.schemaDefinition) : (0,_portabletext_sanity_bridge__WEBPACK_IMPORTED_MODULE_24__.createPortableTextMemberSchemaTypes)(config.schema.hasOwnProperty(\"jsonType\") ? config.schema : compileType(config.schema)), schema = config.schemaDefinition ? (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_4__.compileSchema)(config.schemaDefinition) : (0,_portabletext_sanity_bridge__WEBPACK_IMPORTED_MODULE_24__.portableTextMemberSchemaTypesToSchema)(legacySchema);\n  return {\n    legacySchema,\n    schema\n  };\n}\nfunction createActors(config) {\n  debug$1(\"Creating new Actors\");\n  const mutationActor = (0,xstate__WEBPACK_IMPORTED_MODULE_11__.c)(mutationMachine, {\n    input: {\n      readOnly: config.editorActor.getSnapshot().matches({\n        \"edit mode\": \"read only\"\n      }),\n      schema: config.editorActor.getSnapshot().context.schema,\n      slateEditor: config.slateEditor\n    }\n  }), syncActor = (0,xstate__WEBPACK_IMPORTED_MODULE_11__.c)(syncMachine, {\n    input: {\n      initialValue: config.editorActor.getSnapshot().context.initialValue,\n      keyGenerator: config.editorActor.getSnapshot().context.keyGenerator,\n      readOnly: config.editorActor.getSnapshot().matches({\n        \"edit mode\": \"read only\"\n      }),\n      schema: config.editorActor.getSnapshot().context.schema,\n      slateEditor: config.slateEditor\n    }\n  });\n  return config.subscriptions.push(() => {\n    const subscription = mutationActor.on(\"*\", (event) => {\n      event.type === \"has pending mutations\" && syncActor.send({\n        type: \"has pending mutations\"\n      }), event.type === \"mutation\" && (syncActor.send({\n        type: \"mutation\"\n      }), config.editorActor.send({\n        type: \"mutation\",\n        patches: event.patches,\n        value: event.snapshot\n      })), event.type === \"patch\" && config.relayActor.send(event);\n    });\n    return () => {\n      mutationActor.send({\n        type: \"emit changes\"\n      }), subscription.unsubscribe();\n    };\n  }), config.subscriptions.push(() => {\n    const subscription = syncActor.on(\"*\", (event) => {\n      switch (event.type) {\n        case \"invalid value\":\n          config.relayActor.send(event);\n          break;\n        case \"value changed\":\n          config.relayActor.send(event);\n          break;\n        case \"patch\":\n          config.editorActor.send({\n            ...event,\n            type: \"internal.patch\",\n            value: config.slateEditor.value\n          });\n          break;\n        default:\n          config.editorActor.send(event);\n      }\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }), config.subscriptions.push(() => {\n    const subscription = config.editorActor.subscribe((snapshot) => {\n      snapshot.matches({\n        \"edit mode\": \"read only\"\n      }) ? (mutationActor.send({\n        type: \"update readOnly\",\n        readOnly: !0\n      }), syncActor.send({\n        type: \"update readOnly\",\n        readOnly: !0\n      })) : (mutationActor.send({\n        type: \"update readOnly\",\n        readOnly: !1\n      }), syncActor.send({\n        type: \"update readOnly\",\n        readOnly: !1\n      }));\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }), config.subscriptions.push(() => {\n    const subscription = config.editorActor.on(\"*\", (event) => {\n      switch (event.type) {\n        case \"editable\":\n        case \"mutation\":\n        case \"ready\":\n        case \"read only\":\n        case \"selection\":\n          config.relayActor.send(event);\n          break;\n        case \"internal.patch\":\n          mutationActor.send({\n            ...event,\n            type: \"patch\"\n          });\n          break;\n      }\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }), {\n    mutationActor,\n    syncActor\n  };\n}\nfunction eventToChange(event) {\n  switch (event.type) {\n    case \"blurred\":\n      return {\n        type: \"blur\",\n        event: event.event\n      };\n    case \"patch\":\n      return event;\n    case \"loading\":\n      return {\n        type: \"loading\",\n        isLoading: !0\n      };\n    case \"done loading\":\n      return {\n        type: \"loading\",\n        isLoading: !1\n      };\n    case \"focused\":\n      return {\n        type: \"focus\",\n        event: event.event\n      };\n    case \"value changed\":\n      return {\n        type: \"value\",\n        value: event.value\n      };\n    case \"invalid value\":\n      return {\n        type: \"invalidValue\",\n        resolution: event.resolution,\n        value: event.value\n      };\n    case \"mutation\":\n      return {\n        type: \"mutation\",\n        patches: event.patches,\n        snapshot: event.value\n      };\n    case \"ready\":\n      return event;\n    case \"selection\":\n      return event;\n    case \"unset\":\n      return event;\n  }\n}\nconst debug = debugWithName(\"component:PortableTextEditor\");\nclass PortableTextEditor extends react__WEBPACK_IMPORTED_MODULE_2__.Component {\n  static displayName = \"PortableTextEditor\";\n  /**\n   * An observable of all the editor changes.\n   */\n  change$ = new rxjs__WEBPACK_IMPORTED_MODULE_25__.Subject();\n  /**\n   * A lookup table for all the relevant schema types for this portable text type.\n   */\n  /**\n   * The editor instance\n   */\n  /*\n   * The editor API (currently implemented with Slate).\n   */\n  subscriptions = [];\n  unsubscribers = [];\n  constructor(props) {\n    if (super(props), props.editor)\n      this.editor = props.editor, this.schemaTypes = this.editor._internal.editorActor.getSnapshot().context.getLegacySchema();\n    else {\n      const {\n        actors,\n        editor,\n        subscriptions\n      } = createInternalEditor({\n        initialValue: props.value,\n        keyGenerator: props.keyGenerator,\n        readOnly: props.readOnly,\n        schema: props.schemaType\n      });\n      this.subscriptions = subscriptions, this.actors = actors, this.editor = editor, this.schemaTypes = actors.editorActor.getSnapshot().context.getLegacySchema();\n    }\n    this.editable = this.editor._internal.editable;\n  }\n  componentDidMount() {\n    if (!this.actors)\n      return;\n    for (const subscription of this.subscriptions)\n      this.unsubscribers.push(subscription());\n    const relayActorSubscription = this.actors.relayActor.on(\"*\", (event) => {\n      const change = eventToChange(event);\n      change && (this.props.editor || this.props.onChange(change), this.change$.next(change));\n    });\n    this.unsubscribers.push(relayActorSubscription.unsubscribe), this.actors.editorActor.start(), this.actors.mutationActor.start(), this.actors.relayActor.start(), this.actors.syncActor.start();\n  }\n  componentDidUpdate(prevProps) {\n    !this.props.editor && !prevProps.editor && this.props.schemaType !== prevProps.schemaType && console.warn(\"Updating schema type is no longer supported\"), !this.props.editor && !prevProps.editor && (this.props.readOnly !== prevProps.readOnly && this.editor._internal.editorActor.send({\n      type: \"update readOnly\",\n      readOnly: this.props.readOnly ?? !1\n    }), this.props.value !== prevProps.value && this.editor.send({\n      type: \"update value\",\n      value: this.props.value\n    }), this.props.editorRef !== prevProps.editorRef && this.props.editorRef && (this.props.editorRef.current = this));\n  }\n  componentWillUnmount() {\n    for (const unsubscribe of this.unsubscribers)\n      unsubscribe();\n    this.actors && (stopActor(this.actors.editorActor), stopActor(this.actors.mutationActor), stopActor(this.actors.relayActor), stopActor(this.actors.syncActor));\n  }\n  setEditable = (editable) => {\n    this.editor._internal.editable = {\n      ...this.editor._internal.editable,\n      ...editable\n    };\n  };\n  render() {\n    const legacyPatches = this.props.editor ? void 0 : this.props.incomingPatches$ ?? this.props.patches$;\n    return /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, { children: [\n      legacyPatches ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RoutePatchesObservableToEditorActor, { editorActor: this.editor._internal.editorActor, patches$: legacyPatches }) : null,\n      /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(EditorActorContext.Provider, { value: this.editor._internal.editorActor, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RelayActorContext.Provider, { value: this.actors.relayActor, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(slate_react__WEBPACK_IMPORTED_MODULE_15__.Slate, { editor: this.editor._internal.slateEditor.instance, initialValue: this.editor._internal.slateEditor.initialValue, children: /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(PortableTextEditorContext.Provider, { value: this, children: this.props.children }) }) }) })\n    ] });\n  }\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isActive = useEditorSelector(editor, selectors.getActiveAnnotations)\n   * ```\n   */\n  static activeAnnotations = (editor) => editor && editor.editable ? editor.editable.activeAnnotations() : [];\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isActive = useEditorSelector(editor, selectors.isActiveAnnotation(...))\n   * ```\n   */\n  static isAnnotationActive = (editor, annotationType) => editor && editor.editable ? editor.editable.isAnnotationActive(annotationType) : !1;\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'annotation.add',\n   *  annotation: {\n   *    name: '...',\n   *    value: {...},\n   *  }\n   * })\n   * ```\n   */\n  static addAnnotation = (editor, type, value) => editor.editable?.addAnnotation(type, value);\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'blur',\n   * })\n   * ```\n   */\n  static blur = (editor) => {\n    debug(\"Host blurred\"), editor.editable?.blur();\n  };\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'delete',\n   *  at: {...},\n   *  direction: '...',\n   *  unit: '...',\n   * })\n   * ```\n   */\n  static delete = (editor, selection, options) => editor.editable?.delete(selection, options);\n  static findDOMNode = (editor, element) => editor.editable?.findDOMNode(element);\n  static findByPath = (editor, path) => editor.editable?.findByPath(path) || [];\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'focus',\n   * })\n   * ```\n   */\n  static focus = (editor) => {\n    debug(\"Host requesting focus\"), editor.editable?.focus();\n  };\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const focusBlock = useEditorSelector(editor, selectors.getFocusBlock)\n   * ```\n   */\n  static focusBlock = (editor) => editor.editable?.focusBlock();\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const focusChild = useEditorSelector(editor, selectors.getFocusChild)\n   * ```\n   */\n  static focusChild = (editor) => editor.editable?.focusChild();\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const selection = useEditorSelector(editor, selectors.getSelection)\n   * ```\n   */\n  static getSelection = (editor) => editor.editable ? editor.editable.getSelection() : null;\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const value = useEditorSelector(editor, selectors.getValue)\n   * ```\n   */\n  static getValue = (editor) => editor.editable?.getValue();\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isActive = useEditorSelector(editor, selectors.isActiveStyle(...))\n   * ```\n   */\n  static hasBlockStyle = (editor, blockStyle) => editor.editable?.hasBlockStyle(blockStyle);\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isActive = useEditorSelector(editor, selectors.isActiveListItem(...))\n   * ```\n   */\n  static hasListStyle = (editor, listStyle) => editor.editable?.hasListStyle(listStyle);\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isSelectionCollapsed = useEditorSelector(editor, selectors.isSelectionCollapsed)\n   * ```\n   */\n  static isCollapsedSelection = (editor) => editor.editable?.isCollapsedSelection();\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isSelectionExpanded = useEditorSelector(editor, selectors.isSelectionExpanded)\n   * ```\n   */\n  static isExpandedSelection = (editor) => editor.editable?.isExpandedSelection();\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isActive = useEditorSelector(editor, selectors.isActiveDecorator(...))\n   * ```\n   */\n  static isMarkActive = (editor, mark) => editor.editable?.isMarkActive(mark);\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'insert.span',\n   *  text: '...',\n   *  annotations: [{name: '...', value: {...}}],\n   *  decorators: ['...'],\n   * })\n   * editor.send({\n   *  type: 'insert.inline object',\n   *  inlineObject: {\n   *    name: '...',\n   *    value: {...},\n   *  },\n   * })\n   * ```\n   */\n  static insertChild = (editor, type, value) => (debug(\"Host inserting child\"), editor.editable?.insertChild(type, value));\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'insert.block object',\n   *  blockObject: {\n   *    name: '...',\n   *    value: {...},\n   *  },\n   *  placement: 'auto' | 'after' | 'before',\n   * })\n   * ```\n   */\n  static insertBlock = (editor, type, value) => editor.editable?.insertBlock(type, value);\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'insert.break',\n   * })\n   * ```\n   */\n  static insertBreak = (editor) => editor.editable?.insertBreak();\n  static isVoid = (editor, element) => editor.editable?.isVoid(element);\n  static isObjectPath = (_editor, path) => {\n    if (!path || !Array.isArray(path))\n      return !1;\n    const isChildObjectEditPath = path.length > 3 && path[1] === \"children\";\n    return path.length > 1 && path[1] !== \"children\" || isChildObjectEditPath;\n  };\n  static marks = (editor) => editor.editable?.marks();\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'select',\n   *  selection: {...},\n   * })\n   * ```\n   */\n  static select = (editor, selection) => {\n    debug(\"Host setting selection\", selection), editor.editable?.select(selection);\n  };\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'annotation.remove',\n   *  annotation: {\n   *    name: '...',\n   *  },\n   * })\n   * ```\n   */\n  static removeAnnotation = (editor, type) => editor.editable?.removeAnnotation(type);\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'style.toggle',\n   *  style: '...',\n   * })\n   * ```\n   */\n  static toggleBlockStyle = (editor, blockStyle) => (debug(\"Host is toggling block style\"), editor.editable?.toggleBlockStyle(blockStyle));\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'list item.toggle',\n   *  listItem: '...',\n   * })\n   * ```\n   */\n  static toggleList = (editor, listStyle) => editor.editable?.toggleList(listStyle);\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *  type: 'decorator.toggle',\n   *  decorator: '...',\n   * })\n   * ```\n   */\n  static toggleMark = (editor, mark) => {\n    debug(\"Host toggling mark\", mark), editor.editable?.toggleMark(mark);\n  };\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const selectedValue = useEditorSelector(editor, selectors.getSelectedValue)\n   * ```\n   */\n  static getFragment = (editor) => editor.editable?.getFragment();\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *   type: 'history.undo',\n   * })\n   * ```\n   */\n  static undo = (editor) => {\n    debug(\"Host undoing\"), editor.editable?.undo();\n  };\n  /**\n   * @deprecated\n   * Use `editor.send(...)` instead\n   *\n   * ```\n   * const editor = useEditor()\n   * editor.send({\n   *   type: 'history.redo',\n   * })\n   * ```\n   */\n  static redo = (editor) => {\n    debug(\"Host redoing\"), editor.editable?.redo();\n  };\n  /**\n   * @deprecated\n   * Use built-in selectors or write your own: https://www.portabletext.org/reference/selectors/\n   *\n   * ```\n   * import * as selectors from '@portabletext/editor/selectors'\n   * const editor = useEditor()\n   * const isOverlapping = useEditorSelector(editor, selectors.isOverlappingSelection(selectionB))\n   * ```\n   */\n  static isSelectionsOverlapping = (editor, selectionA, selectionB) => editor.editable?.isSelectionsOverlapping(selectionA, selectionB);\n}\nfunction RoutePatchesObservableToEditorActor(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(4);\n  let t0, t1;\n  return $[0] !== props.editorActor || $[1] !== props.patches$ ? (t0 = () => {\n    const subscription = props.patches$.subscribe((payload) => {\n      props.editorActor.send({\n        type: \"patches\",\n        ...payload\n      });\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, t1 = [props.editorActor, props.patches$], $[0] = props.editorActor, $[1] = props.patches$, $[2] = t0, $[3] = t1) : (t0 = $[2], t1 = $[3]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t0, t1), null;\n}\nfunction EditorProvider(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(29);\n  let t0;\n  $[0] !== props.initialConfig ? (t0 = () => {\n    const internalEditor = createInternalEditor(props.initialConfig), portableTextEditor = new PortableTextEditor({\n      editor: internalEditor.editor\n    });\n    return {\n      internalEditor,\n      portableTextEditor\n    };\n  }, $[0] = props.initialConfig, $[1] = t0) : t0 = $[1];\n  const [t1] = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(t0), {\n    internalEditor: internalEditor_0,\n    portableTextEditor: portableTextEditor_0\n  } = t1;\n  let t2;\n  $[2] !== internalEditor_0.actors.editorActor || $[3] !== internalEditor_0.actors.mutationActor || $[4] !== internalEditor_0.actors.relayActor || $[5] !== internalEditor_0.actors.syncActor || $[6] !== internalEditor_0.editor._internal.slateEditor.instance || $[7] !== internalEditor_0.subscriptions || $[8] !== portableTextEditor_0 ? (t2 = () => {\n    const unsubscribers = [];\n    for (const subscription of internalEditor_0.subscriptions)\n      unsubscribers.push(subscription());\n    const relayActorSubscription = internalEditor_0.actors.relayActor.on(\"*\", (event) => {\n      const change = eventToChange(event);\n      change && portableTextEditor_0.change$.next(change);\n    });\n    return unsubscribers.push(relayActorSubscription.unsubscribe), internalEditor_0.actors.editorActor.start(), internalEditor_0.actors.editorActor.send({\n      type: \"add slate editor\",\n      editor: internalEditor_0.editor._internal.slateEditor.instance\n    }), internalEditor_0.actors.mutationActor.start(), internalEditor_0.actors.relayActor.start(), internalEditor_0.actors.syncActor.start(), () => {\n      for (const unsubscribe of unsubscribers)\n        unsubscribe();\n      stopActor(internalEditor_0.actors.editorActor), stopActor(internalEditor_0.actors.mutationActor), stopActor(internalEditor_0.actors.relayActor), stopActor(internalEditor_0.actors.syncActor);\n    };\n  }, $[2] = internalEditor_0.actors.editorActor, $[3] = internalEditor_0.actors.mutationActor, $[4] = internalEditor_0.actors.relayActor, $[5] = internalEditor_0.actors.syncActor, $[6] = internalEditor_0.editor._internal.slateEditor.instance, $[7] = internalEditor_0.subscriptions, $[8] = portableTextEditor_0, $[9] = t2) : t2 = $[9];\n  let t3;\n  $[10] !== internalEditor_0 || $[11] !== portableTextEditor_0 ? (t3 = [internalEditor_0, portableTextEditor_0], $[10] = internalEditor_0, $[11] = portableTextEditor_0, $[12] = t3) : t3 = $[12], (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t2, t3);\n  let t4;\n  $[13] !== portableTextEditor_0 || $[14] !== props.children ? (t4 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(PortableTextEditorContext.Provider, { value: portableTextEditor_0, children: props.children }), $[13] = portableTextEditor_0, $[14] = props.children, $[15] = t4) : t4 = $[15];\n  let t5;\n  $[16] !== internalEditor_0.editor._internal.slateEditor.initialValue || $[17] !== internalEditor_0.editor._internal.slateEditor.instance || $[18] !== t4 ? (t5 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(slate_react__WEBPACK_IMPORTED_MODULE_15__.Slate, { editor: internalEditor_0.editor._internal.slateEditor.instance, initialValue: internalEditor_0.editor._internal.slateEditor.initialValue, children: t4 }), $[16] = internalEditor_0.editor._internal.slateEditor.initialValue, $[17] = internalEditor_0.editor._internal.slateEditor.instance, $[18] = t4, $[19] = t5) : t5 = $[19];\n  let t6;\n  $[20] !== internalEditor_0.actors.relayActor || $[21] !== t5 ? (t6 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(RelayActorContext.Provider, { value: internalEditor_0.actors.relayActor, children: t5 }), $[20] = internalEditor_0.actors.relayActor, $[21] = t5, $[22] = t6) : t6 = $[22];\n  let t7;\n  $[23] !== internalEditor_0.actors.editorActor || $[24] !== t6 ? (t7 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(EditorActorContext.Provider, { value: internalEditor_0.actors.editorActor, children: t6 }), $[23] = internalEditor_0.actors.editorActor, $[24] = t6, $[25] = t7) : t7 = $[25];\n  let t8;\n  return $[26] !== internalEditor_0.editor || $[27] !== t7 ? (t8 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_26__.EditorContext.Provider, { value: internalEditor_0.editor, children: t7 }), $[26] = internalEditor_0.editor, $[27] = t7, $[28] = t8) : t8 = $[28], t8;\n}\nconst usePortableTextEditorSelection = () => {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(5), editorActor = (0,react__WEBPACK_IMPORTED_MODULE_2__.useContext)(EditorActorContext);\n  let t0;\n  $[0] !== editorActor ? (t0 = editorActor.getSnapshot(), $[0] = editorActor, $[1] = t0) : t0 = $[1];\n  const [selection, setSelection] = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(t0.context.selection);\n  let t1, t2;\n  return $[2] !== editorActor ? (t1 = () => {\n    const subscription = editorActor.on(\"selection\", (event) => {\n      (0,react__WEBPACK_IMPORTED_MODULE_2__.startTransition)(() => {\n        setSelection(event.selection);\n      });\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, t2 = [editorActor], $[2] = editorActor, $[3] = t1, $[4] = t2) : (t1 = $[3], t2 = $[4]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t1, t2), selection;\n};\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3RDtBQUNiO0FBQ2M7QUFDOEQ7QUFDZTtBQUNQO0FBQ25HO0FBQzRFO0FBQzBYO0FBQ3haO0FBQ3RCO0FBQ3VEO0FBQ3NCO0FBQzR1QjtBQUMveEI7QUFDbUc7QUFDeEg7QUFDVjtBQUN5QztBQUNoRDtBQUMrRTtBQUNGO0FBQzFEO0FBQ0o7QUFDeEI7QUFDL0I7QUFDQSxrQ0FBTztBQUNQO0FBQ0EsdUJBQXVCLFNBQVMsRUFBRSxLQUFLO0FBQ3ZDLFNBQVMsa0NBQU8sSUFBSSwwQ0FBZSxjQUFjLGtDQUFPLGNBQWMsa0NBQU87QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGtCQUFrQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsaUVBQVcsaUJBQWlCLGlFQUFXO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGtCQUFrQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixrQkFBa0I7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGtCQUFrQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLDRDQUE0QyxlQUFlLG1CQUFtQixjQUFjO0FBQzVGO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyx5Q0FBTTtBQUN4QztBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBDQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLDREQUE0RCx1Q0FBSTtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixVQUFVLHVDQUFJO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBLHVCQUF1Qix1Q0FBSTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxnSEFBZ0gsNEdBQTRHO0FBQzVOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7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TztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsNENBQVM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMENBQU87QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsdURBQUksQ0FBQyx1REFBUSxJQUFJO0FBQzVDLHNDQUFzQyxzREFBRyx3Q0FBd0MseUVBQXlFO0FBQzFKLHNCQUFzQixzREFBRyxnQ0FBZ0Msb0VBQW9FLHNEQUFHLCtCQUErQix5REFBeUQsc0RBQUcsQ0FBQywrQ0FBSyxJQUFJLDRJQUE0SSxzREFBRyx1Q0FBdUMsNENBQTRDLEdBQUcsR0FBRyxHQUFHO0FBQ2hkLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsSUFBSTtBQUNwQjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxJQUFJO0FBQ2Y7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHFCQUFxQixLQUFLO0FBQy9DO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLElBQUk7QUFDcEIsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixJQUFJO0FBQ3BCLE9BQU87QUFDUDtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLElBQUk7QUFDdEIsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkseURBQUM7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUcsNklBQTZJLGdEQUFTO0FBQ3pKO0FBQ0E7QUFDQSxZQUFZLHlEQUFDO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsZUFBZSwrQ0FBUTtBQUN2QjtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsbU1BQW1NLGdEQUFTO0FBQzVNO0FBQ0EscUZBQXFGLHNEQUFHLHVDQUF1Qyx1REFBdUQ7QUFDdEw7QUFDQSxtTEFBbUwsc0RBQUcsQ0FBQywrQ0FBSyxJQUFJLHdKQUF3SjtBQUN4VjtBQUNBLHVGQUF1RixzREFBRywrQkFBK0IseURBQXlEO0FBQ2xMO0FBQ0Esd0ZBQXdGLHNEQUFHLGdDQUFnQywwREFBMEQ7QUFDckw7QUFDQSxtRkFBbUYsc0RBQUcsQ0FBQyxvRUFBYSxhQUFhLDhDQUE4QztBQUMvSjtBQUNBO0FBQ0EsWUFBWSx5REFBQyxtQkFBbUIsaURBQVU7QUFDMUM7QUFDQTtBQUNBLG9DQUFvQywrQ0FBUTtBQUM1QztBQUNBO0FBQ0E7QUFDQSxNQUFNLHNEQUFlO0FBQ3JCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHLDBGQUEwRixnREFBUztBQUN0RztBQVdFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L2VkaXRvci9saWIvaW5kZXguanM/NDg5MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBqc3hzLCBqc3gsIEZyYWdtZW50IH0gZnJvbSBcInJlYWN0L2pzeC1ydW50aW1lXCI7XG5pbXBvcnQgeyBjIH0gZnJvbSBcInJlYWN0LWNvbXBpbGVyLXJ1bnRpbWVcIjtcbmltcG9ydCB7IHVzZVNlbGVjdG9yLCB1c2VBY3RvclJlZiB9IGZyb20gXCJAeHN0YXRlL3JlYWN0XCI7XG5pbXBvcnQgeyBjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VFZmZlY3QsIHVzZVN0YXRlLCB1c2VSZWYsIGZvcndhcmRSZWYsIENvbXBvbmVudCwgc3RhcnRUcmFuc2l0aW9uIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBFbGVtZW50IGFzIEVsZW1lbnQkMSwgVGV4dCwgUmFuZ2UsIEVkaXRvciwgTm9kZSwgUG9pbnQsIFBhdGgsIFRyYW5zZm9ybXMsIGRlbGV0ZVRleHQsIE9wZXJhdGlvbiwgY3JlYXRlRWRpdG9yIH0gZnJvbSBcInNsYXRlXCI7XG5pbXBvcnQgeyB1c2VTZWxlY3RlZCwgdXNlU2xhdGVTZWxlY3RvciwgdXNlU2xhdGVTdGF0aWMsIFJlYWN0RWRpdG9yLCB1c2VTbGF0ZSwgRWRpdGFibGUsIHdpdGhSZWFjdCwgU2xhdGUgfSBmcm9tIFwic2xhdGUtcmVhY3RcIjtcbmltcG9ydCBkZWJ1ZyRoIGZyb20gXCJkZWJ1Z1wiO1xuaW1wb3J0IHsgRE9NRWRpdG9yLCBpc0RPTU5vZGUsIEVESVRPUl9UT19QRU5ESU5HX1NFTEVDVElPTiwgSVNfRk9DVVNFRCwgSVNfUkVBRF9PTkxZIH0gZnJvbSBcInNsYXRlLWRvbVwiO1xuaW1wb3J0IHsgZ2V0QmxvY2tFbmRQb2ludCwgZ2V0QmxvY2tTdGFydFBvaW50LCBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludCwgaXNTZWxlY3Rpb25Db2xsYXBzZWQsIGlzS2V5ZWRTZWdtZW50LCBpc0VxdWFsU2VsZWN0aW9uUG9pbnRzLCBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludCwgYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCwgZGVmYXVsdEtleUdlbmVyYXRvciwgcGFyc2VCbG9ja3MsIHBhcnNlQmxvY2ssIHBhcnNlQW5ub3RhdGlvbiwgcGFyc2VNYXJrRGVmcywgcGFyc2VTcGFuLCBwYXJzZUlubGluZU9iamVjdCwgaXNMaXN0QmxvY2ssIGlzVHlwZWRPYmplY3QsIGdldFNlbGVjdGlvblN0YXJ0UG9pbnQgYXMgZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCQxLCBnZXRTZWxlY3Rpb25FbmRQb2ludCBhcyBnZXRTZWxlY3Rpb25FbmRQb2ludCQxIH0gZnJvbSBcIi4vX2NodW5rcy1lcy91dGlsLnNsaWNlLWJsb2Nrcy5qc1wiO1xuaW1wb3J0IHsgaXNUZXh0QmxvY2ssIGlzU3BhbiwgY29tcGlsZVNjaGVtYSB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3NjaGVtYVwiO1xuaW1wb3J0IHsgZGVmaW5lU2NoZW1hIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvc2NoZW1hXCI7XG5pbXBvcnQgeyBpc0VtcHR5VGV4dEJsb2NrLCBzbGljZVRleHRCbG9jaywgZ2V0VGV4dEJsb2NrVGV4dCB9IGZyb20gXCIuL19jaHVua3MtZXMvdXRpbC5zbGljZS10ZXh0LWJsb2NrLmpzXCI7XG5pbXBvcnQgeyBzZXR1cCwgZnJvbUNhbGxiYWNrLCBhc3NpZ24sIGFuZCwgZW5xdWV1ZUFjdGlvbnMsIGVtaXQsIGFzc2VydEV2ZW50LCByYWlzZSBhcyByYWlzZSQxLCBub3QsIGNyZWF0ZUFjdG9yIH0gZnJvbSBcInhzdGF0ZVwiO1xuaW1wb3J0IHsgZ2V0Rm9jdXNJbmxpbmVPYmplY3QsIGlzU2VsZWN0aW9uQ29sbGFwc2VkIGFzIGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEsIGdldEZvY3VzVGV4dEJsb2NrLCBnZXRGb2N1c1NwYW4gYXMgZ2V0Rm9jdXNTcGFuJDEsIGdldFNlbGVjdGVkQmxvY2tzLCBpc1NlbGVjdGlvbkV4cGFuZGVkLCBnZXRTZWxlY3Rpb25TdGFydEJsb2NrLCBnZXRTZWxlY3Rpb25FbmRCbG9jaywgaXNPdmVybGFwcGluZ1NlbGVjdGlvbiwgZ2V0Rm9jdXNCbG9jayBhcyBnZXRGb2N1c0Jsb2NrJDEsIGlzU2VsZWN0aW5nRW50aXJlQmxvY2tzLCBnZXRTZWxlY3RlZFZhbHVlLCBpc0FjdGl2ZUFubm90YXRpb24sIGdldEFjdGl2ZUFubm90YXRpb25zTWFya3MsIGdldEFjdGl2ZURlY29yYXRvcnMsIGdldFNlbGVjdGlvblN0YXJ0Q2hpbGQsIGdldFNlbGVjdGlvbkVuZENoaWxkLCBnZXRTZWxlY3Rpb25TdGFydFBvaW50LCBnZXRTZWxlY3Rpb25FbmRQb2ludCwgZ2V0UHJldmlvdXNTcGFuLCBnZXROZXh0U3BhbiwgZ2V0Q2FyZXRXb3JkU2VsZWN0aW9uLCBnZXRGb2N1c0Jsb2NrT2JqZWN0LCBnZXRQcmV2aW91c0Jsb2NrLCBnZXROZXh0QmxvY2ssIGdldE1hcmtTdGF0ZSwgaXNBdFRoZUVuZE9mQmxvY2ssIGlzQXRUaGVTdGFydE9mQmxvY2ssIGdldEZvY3VzTGlzdEJsb2NrLCBpc0FjdGl2ZURlY29yYXRvciwgZ2V0Rm9jdXNDaGlsZCBhcyBnZXRGb2N1c0NoaWxkJDEsIGdldEFjdGl2ZUFubm90YXRpb25zLCBnZXRMYXN0QmxvY2sgYXMgZ2V0TGFzdEJsb2NrJDEsIGdldFNlbGVjdGVkVGV4dEJsb2NrcywgaXNBY3RpdmVMaXN0SXRlbSwgaXNBY3RpdmVTdHlsZSB9IGZyb20gXCIuL19jaHVua3MtZXMvc2VsZWN0b3IuaXMtYXQtdGhlLXN0YXJ0LW9mLWJsb2NrLmpzXCI7XG5pbXBvcnQgeyBkZWZpbmVCZWhhdmlvciwgZm9yd2FyZCwgcmFpc2UsIGVmZmVjdCB9IGZyb20gXCIuL2JlaGF2aW9ycy9pbmRleC5qc1wiO1xuaW1wb3J0IHsgY29tcGlsZVNjaGVtYURlZmluaXRpb25Ub1BvcnRhYmxlVGV4dE1lbWJlclNjaGVtYVR5cGVzLCBjcmVhdGVQb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlcywgcG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXNUb1NjaGVtYSB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3Nhbml0eS1icmlkZ2VcIjtcbmltcG9ydCB7IGh0bWxUb0Jsb2NrcyB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L2Jsb2NrLXRvb2xzXCI7XG5pbXBvcnQgeyB0b0hUTUwgfSBmcm9tIFwiQHBvcnRhYmxldGV4dC90by1odG1sXCI7XG5pbXBvcnQgeyBtYXJrZG93blRvUG9ydGFibGVUZXh0LCBwb3J0YWJsZVRleHRUb01hcmtkb3duIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvbWFya2Rvd25cIjtcbmltcG9ydCB7IFNjaGVtYSB9IGZyb20gXCJAc2FuaXR5L3NjaGVtYVwiO1xuaW1wb3J0IHsgc2V0LCBhcHBseUFsbCwgdW5zZXQsIGluc2VydCwgc2V0SWZNaXNzaW5nLCBkaWZmTWF0Y2hQYXRjaCBhcyBkaWZmTWF0Y2hQYXRjaCQxIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvcGF0Y2hlc1wiO1xuaW1wb3J0IHsgY3JlYXRlS2V5Ym9hcmRTaG9ydGN1dCwgY29kZSwgdW5kZXJsaW5lLCBpdGFsaWMsIGJvbGQsIHVuZG8sIHJlZG8gfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9rZXlib2FyZC1zaG9ydGN1dHNcIjtcbmltcG9ydCB7IEVkaXRvckNvbnRleHQgfSBmcm9tIFwiLi9fY2h1bmtzLWVzL3VzZS1lZGl0b3IuanNcIjtcbmltcG9ydCB7IHVzZUVkaXRvciB9IGZyb20gXCIuL19jaHVua3MtZXMvdXNlLWVkaXRvci5qc1wiO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XG5jb25zdCByb290TmFtZSA9IFwic2FuaXR5LXB0ZTpcIjtcbmRlYnVnJGgocm9vdE5hbWUpO1xuZnVuY3Rpb24gZGVidWdXaXRoTmFtZShuYW1lKSB7XG4gIGNvbnN0IG5hbWVzcGFjZSA9IGAke3Jvb3ROYW1lfSR7bmFtZX1gO1xuICByZXR1cm4gZGVidWckaCAmJiBkZWJ1ZyRoLmVuYWJsZWQobmFtZXNwYWNlKSA/IGRlYnVnJGgobmFtZXNwYWNlKSA6IGRlYnVnJGgocm9vdE5hbWUpO1xufVxuZnVuY3Rpb24gaXNFcXVhbFZhbHVlcyhjb250ZXh0LCBhLCBiKSB7XG4gIGlmICghYSB8fCAhYilcbiAgICByZXR1cm4gYSA9PT0gYjtcbiAgaWYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aClcbiAgICByZXR1cm4gITE7XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IGJsb2NrQSA9IGEuYXQoaW5kZXgpLCBibG9ja0IgPSBiLmF0KGluZGV4KTtcbiAgICBpZiAoIWJsb2NrQSB8fCAhYmxvY2tCIHx8ICFpc0VxdWFsQmxvY2tzKGNvbnRleHQsIGJsb2NrQSwgYmxvY2tCKSlcbiAgICAgIHJldHVybiAhMTtcbiAgfVxuICByZXR1cm4gITA7XG59XG5mdW5jdGlvbiBpc0VxdWFsQmxvY2tzKGNvbnRleHQsIGEsIGIpIHtcbiAgcmV0dXJuIGEuX3R5cGUgIT09IGIuX3R5cGUgPyAhMSA6IGEuX3R5cGUgPT09IGNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWUgJiYgYi5fdHlwZSA9PT0gY29udGV4dC5zY2hlbWEuYmxvY2submFtZSA/IGlzRXF1YWxUZXh0QmxvY2tzKGNvbnRleHQsIGEsIGIpIDogaXNFcXVhbFBvcnRhYmxlVGV4dE9iamVjdHMoYSwgYik7XG59XG5mdW5jdGlvbiBpc0VxdWFsVGV4dEJsb2Nrcyhjb250ZXh0LCBhLCBiKSB7XG4gIHJldHVybiAhaXNUZXh0QmxvY2soY29udGV4dCwgYSkgfHwgIWlzVGV4dEJsb2NrKGNvbnRleHQsIGIpIHx8IGEuX2tleSAhPT0gYi5fa2V5IHx8IGEuc3R5bGUgIT09IGIuc3R5bGUgfHwgYS5saXN0SXRlbSAhPT0gYi5saXN0SXRlbSB8fCBhLmxldmVsICE9PSBiLmxldmVsIHx8IFwibWFya0RlZnNcIiBpbiBhICYmIFwibWFya0RlZnNcIiBpbiBiICYmICghQXJyYXkuaXNBcnJheShhLm1hcmtEZWZzKSB8fCAhQXJyYXkuaXNBcnJheShiLm1hcmtEZWZzKSB8fCAhaXNFcXVhbE1hcmtEZWZzKGEubWFya0RlZnMsIGIubWFya0RlZnMpKSB8fCAhaXNFcXVhbENoaWxkcmVuKGEuY2hpbGRyZW4sIGIuY2hpbGRyZW4pID8gITEgOiBpc0VxdWFsUHJvcHMoYSwgYiwgW1wiX2tleVwiLCBcIl90eXBlXCIsIFwic3R5bGVcIiwgXCJsaXN0SXRlbVwiLCBcImxldmVsXCIsIFwibWFya0RlZnNcIiwgXCJjaGlsZHJlblwiXSk7XG59XG5mdW5jdGlvbiBpc0VxdWFsUHJvcHMoYSwgYiwgZXhjbHVkZUtleXMpIHtcbiAgY29uc3Qga2V5c0EgPSBPYmplY3Qua2V5cyhhKS5maWx0ZXIoKGtleSkgPT4gIWV4Y2x1ZGVLZXlzLmluY2x1ZGVzKGtleSkpLCBrZXlzQiA9IE9iamVjdC5rZXlzKGIpLmZpbHRlcigoa2V5KSA9PiAhZXhjbHVkZUtleXMuaW5jbHVkZXMoa2V5KSk7XG4gIGlmIChrZXlzQS5sZW5ndGggIT09IGtleXNCLmxlbmd0aClcbiAgICByZXR1cm4gITE7XG4gIGZvciAoY29uc3Qga2V5IG9mIGtleXNBKSB7XG4gICAgaWYgKCEoa2V5IGluIGEpIHx8ICEoa2V5IGluIGIpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IHZhbHVlQSA9IGFba2V5XSwgdmFsdWVCID0gYltrZXldO1xuICAgIGlmICh2YWx1ZUEgIT09IHZhbHVlQiAmJiAhaXNEZWVwRXF1YWwodmFsdWVBLCB2YWx1ZUIpKVxuICAgICAgcmV0dXJuICExO1xuICB9XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGlzRXF1YWxJbmxpbmVPYmplY3RzKGEsIGIpIHtcbiAgcmV0dXJuIGEuX2tleSAhPT0gYi5fa2V5IHx8IGEuX3R5cGUgIT09IGIuX3R5cGUgPyAhMSA6IGlzRXF1YWxQcm9wcyhhLCBiLCBbXCJfa2V5XCIsIFwiX3R5cGVcIl0pO1xufVxuZnVuY3Rpb24gaXNFcXVhbE1hcmtzKGEsIGIpIHtcbiAgaWYgKCFhIHx8ICFiKVxuICAgIHJldHVybiBhID09PSBiO1xuICBpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKVxuICAgIHJldHVybiAhMTtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGEubGVuZ3RoOyBpbmRleCsrKVxuICAgIGlmIChhLmF0KGluZGV4KSAhPT0gYi5hdChpbmRleCkpXG4gICAgICByZXR1cm4gITE7XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGlzRXF1YWxTcGFucyhhLCBiKSB7XG4gIHJldHVybiBhLl9rZXkgIT09IGIuX2tleSB8fCBhLl90eXBlICE9PSBiLl90eXBlIHx8IGEudGV4dCAhPT0gYi50ZXh0IHx8ICFpc0VxdWFsTWFya3MoYS5tYXJrcywgYi5tYXJrcykgPyAhMSA6IGlzRXF1YWxQcm9wcyhhLCBiLCBbXCJfa2V5XCIsIFwiX3R5cGVcIiwgXCJ0ZXh0XCIsIFwibWFya3NcIl0pO1xufVxuZnVuY3Rpb24gaXNFcXVhbE1hcmtEZWZzKGEsIGIpIHtcbiAgaWYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aClcbiAgICByZXR1cm4gITE7XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IG1hcmtEZWZBID0gYS5hdChpbmRleCksIG1hcmtEZWZCID0gYi5hdChpbmRleCk7XG4gICAgaWYgKCFtYXJrRGVmQSB8fCAhbWFya0RlZkIgfHwgIWlzRGVlcEVxdWFsKG1hcmtEZWZBLCBtYXJrRGVmQikpXG4gICAgICByZXR1cm4gITE7XG4gIH1cbiAgcmV0dXJuICEwO1xufVxuZnVuY3Rpb24gaXNFcXVhbENoaWxkcmVuKGEsIGIpIHtcbiAgaWYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aClcbiAgICByZXR1cm4gITE7XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IGNoaWxkQSA9IGEuYXQoaW5kZXgpLCBjaGlsZEIgPSBiLmF0KGluZGV4KTtcbiAgICBpZiAoIWNoaWxkQSB8fCAhY2hpbGRCIHx8ICFpc0VxdWFsQ2hpbGQoY2hpbGRBLCBjaGlsZEIpKVxuICAgICAgcmV0dXJuICExO1xuICB9XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGlzRXF1YWxDaGlsZChhLCBiKSB7XG4gIHJldHVybiBhLl90eXBlID09PSBcInNwYW5cIiAmJiBiLl90eXBlID09PSBcInNwYW5cIiA/IGlzRXF1YWxTcGFucyhhLCBiKSA6IGlzRXF1YWxJbmxpbmVPYmplY3RzKGEsIGIpO1xufVxuZnVuY3Rpb24gaXNFcXVhbFBvcnRhYmxlVGV4dE9iamVjdHMoYSwgYikge1xuICByZXR1cm4gYS5fa2V5ICE9PSBiLl9rZXkgfHwgYS5fdHlwZSAhPT0gYi5fdHlwZSA/ICExIDogaXNFcXVhbFByb3BzKGEsIGIsIFtcIl9rZXlcIiwgXCJfdHlwZVwiXSk7XG59XG5mdW5jdGlvbiBpc0RlZXBFcXVhbChkYXRhLCBvdGhlcikge1xuICByZXR1cm4gaXNEZWVwRXF1YWxJbXBsZW1lbnRhdGlvbihkYXRhLCBvdGhlcik7XG59XG5mdW5jdGlvbiBpc0RlZXBFcXVhbEltcGxlbWVudGF0aW9uKGRhdGEsIG90aGVyKSB7XG4gIGlmIChkYXRhID09PSBvdGhlciB8fCBPYmplY3QuaXMoZGF0YSwgb3RoZXIpKVxuICAgIHJldHVybiAhMDtcbiAgaWYgKHR5cGVvZiBkYXRhICE9IFwib2JqZWN0XCIgfHwgdHlwZW9mIG90aGVyICE9IFwib2JqZWN0XCIgfHwgZGF0YSA9PT0gbnVsbCB8fCBvdGhlciA9PT0gbnVsbCB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZGF0YSkgIT09IE9iamVjdC5nZXRQcm90b3R5cGVPZihvdGhlcikpXG4gICAgcmV0dXJuICExO1xuICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSlcbiAgICByZXR1cm4gaXNEZWVwRXF1YWxBcnJheXMoZGF0YSwgb3RoZXIpO1xuICBpZiAoZGF0YSBpbnN0YW5jZW9mIE1hcClcbiAgICByZXR1cm4gaXNEZWVwRXF1YWxNYXBzKGRhdGEsIG90aGVyKTtcbiAgaWYgKGRhdGEgaW5zdGFuY2VvZiBTZXQpXG4gICAgcmV0dXJuIGlzRGVlcEVxdWFsU2V0cyhkYXRhLCBvdGhlcik7XG4gIGlmIChkYXRhIGluc3RhbmNlb2YgRGF0ZSlcbiAgICByZXR1cm4gZGF0YS5nZXRUaW1lKCkgPT09IG90aGVyLmdldFRpbWUoKTtcbiAgaWYgKGRhdGEgaW5zdGFuY2VvZiBSZWdFeHApXG4gICAgcmV0dXJuIGRhdGEudG9TdHJpbmcoKSA9PT0gb3RoZXIudG9TdHJpbmcoKTtcbiAgaWYgKE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCAhPT0gT2JqZWN0LmtleXMob3RoZXIpLmxlbmd0aClcbiAgICByZXR1cm4gITE7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKVxuICAgIGlmICghKGtleSBpbiBvdGhlcikgfHwgIWlzRGVlcEVxdWFsSW1wbGVtZW50YXRpb24oXG4gICAgICB2YWx1ZSxcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgW3RzNzA1M10gLSBXZSBhbHJlYWR5IGNoZWNrZWQgdGhhdCBgb3RoZXJgIGhhcyBga2V5YFxuICAgICAgb3RoZXJba2V5XVxuICAgICkpXG4gICAgICByZXR1cm4gITE7XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGlzRGVlcEVxdWFsQXJyYXlzKGRhdGEsIG90aGVyKSB7XG4gIGlmIChkYXRhLmxlbmd0aCAhPT0gb3RoZXIubGVuZ3RoKVxuICAgIHJldHVybiAhMTtcbiAgZm9yIChjb25zdCBbaW5kZXgsIGl0ZW1dIG9mIGRhdGEuZW50cmllcygpKVxuICAgIGlmICghaXNEZWVwRXF1YWxJbXBsZW1lbnRhdGlvbihpdGVtLCBvdGhlcltpbmRleF0pKVxuICAgICAgcmV0dXJuICExO1xuICByZXR1cm4gITA7XG59XG5mdW5jdGlvbiBpc0RlZXBFcXVhbE1hcHMoZGF0YSwgb3RoZXIpIHtcbiAgaWYgKGRhdGEuc2l6ZSAhPT0gb3RoZXIuc2l6ZSlcbiAgICByZXR1cm4gITE7XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGRhdGEuZW50cmllcygpKVxuICAgIGlmICghb3RoZXIuaGFzKGtleSkgfHwgIWlzRGVlcEVxdWFsSW1wbGVtZW50YXRpb24odmFsdWUsIG90aGVyLmdldChrZXkpKSlcbiAgICAgIHJldHVybiAhMTtcbiAgcmV0dXJuICEwO1xufVxuZnVuY3Rpb24gaXNEZWVwRXF1YWxTZXRzKGRhdGEsIG90aGVyKSB7XG4gIGlmIChkYXRhLnNpemUgIT09IG90aGVyLnNpemUpXG4gICAgcmV0dXJuICExO1xuICBjb25zdCBvdGhlckNvcHkgPSBbLi4ub3RoZXJdO1xuICBmb3IgKGNvbnN0IGRhdGFJdGVtIG9mIGRhdGEpIHtcbiAgICBsZXQgaXNGb3VuZCA9ICExO1xuICAgIGZvciAoY29uc3QgW2luZGV4LCBvdGhlckl0ZW1dIG9mIG90aGVyQ29weS5lbnRyaWVzKCkpXG4gICAgICBpZiAoaXNEZWVwRXF1YWxJbXBsZW1lbnRhdGlvbihkYXRhSXRlbSwgb3RoZXJJdGVtKSkge1xuICAgICAgICBpc0ZvdW5kID0gITAsIG90aGVyQ29weS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICBpZiAoIWlzRm91bmQpXG4gICAgICByZXR1cm4gITE7XG4gIH1cbiAgcmV0dXJuICEwO1xufVxuY29uc3QgVk9JRF9DSElMRF9LRVkgPSBcInZvaWQtY2hpbGRcIjtcbmZ1bmN0aW9uIHRvU2xhdGVCbG9jayhibG9jaywge1xuICBzY2hlbWFUeXBlc1xufSkge1xuICBjb25zdCB7XG4gICAgX3R5cGUsXG4gICAgX2tleSxcbiAgICAuLi5yZXN0XG4gIH0gPSBibG9jaztcbiAgaWYgKGJsb2NrICYmIGJsb2NrLl90eXBlID09PSBzY2hlbWFUeXBlcy5ibG9jay5uYW1lKSB7XG4gICAgY29uc3QgdGV4dEJsb2NrID0gYmxvY2s7XG4gICAgbGV0IGhhc0lubGluZXMgPSAhMTtcbiAgICBjb25zdCBoYXNNaXNzaW5nTWFya0RlZnMgPSB0eXBlb2YgdGV4dEJsb2NrLm1hcmtEZWZzID4gXCJ1XCIsIGhhc01pc3NpbmdDaGlsZHJlbiA9IHR5cGVvZiB0ZXh0QmxvY2suY2hpbGRyZW4gPiBcInVcIiwgY2hpbGRyZW4gPSAodGV4dEJsb2NrLmNoaWxkcmVuIHx8IFtdKS5tYXAoKGNoaWxkKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIF90eXBlOiBjaGlsZFR5cGUsXG4gICAgICAgIF9rZXk6IGNoaWxkS2V5LFxuICAgICAgICAuLi5jaGlsZFByb3BzXG4gICAgICB9ID0gY2hpbGQsIHByb3BLZXlzID0gT2JqZWN0LmtleXMoY2hpbGRQcm9wcyk7XG4gICAgICByZXR1cm4gY2hpbGRUeXBlID09PSB2b2lkIDAgJiYgcHJvcEtleXMubGVuZ3RoID09PSAxICYmIHByb3BLZXlzLmF0KDApID09PSBcInRleHRcIiA/IHtcbiAgICAgICAgX2tleTogY2hpbGRLZXksXG4gICAgICAgIF90eXBlOiBzY2hlbWFUeXBlcy5zcGFuLm5hbWUsXG4gICAgICAgIHRleHQ6IGNoaWxkUHJvcHMudGV4dFxuICAgICAgfSA6IGNoaWxkVHlwZSAhPT0gc2NoZW1hVHlwZXMuc3Bhbi5uYW1lID8gKGhhc0lubGluZXMgPSAhMCwge1xuICAgICAgICBfdHlwZTogY2hpbGRUeXBlLFxuICAgICAgICBfa2V5OiBjaGlsZEtleSxcbiAgICAgICAgY2hpbGRyZW46IFt7XG4gICAgICAgICAgX2tleTogVk9JRF9DSElMRF9LRVksXG4gICAgICAgICAgX3R5cGU6IHNjaGVtYVR5cGVzLnNwYW4ubmFtZSxcbiAgICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICAgIG1hcmtzOiBbXVxuICAgICAgICB9XSxcbiAgICAgICAgdmFsdWU6IGNoaWxkUHJvcHMsXG4gICAgICAgIF9faW5saW5lOiAhMFxuICAgICAgfSkgOiBjaGlsZDtcbiAgICB9KTtcbiAgICByZXR1cm4gIWhhc01pc3NpbmdNYXJrRGVmcyAmJiAhaGFzTWlzc2luZ0NoaWxkcmVuICYmICFoYXNJbmxpbmVzICYmIEVsZW1lbnQkMS5pc0VsZW1lbnQoYmxvY2spID8gYmxvY2sgOiB7XG4gICAgICBfdHlwZSxcbiAgICAgIF9rZXksXG4gICAgICAuLi5yZXN0LFxuICAgICAgY2hpbGRyZW5cbiAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgX3R5cGUsXG4gICAgX2tleSxcbiAgICBjaGlsZHJlbjogW3tcbiAgICAgIF9rZXk6IFZPSURfQ0hJTERfS0VZLFxuICAgICAgX3R5cGU6IFwic3BhblwiLFxuICAgICAgdGV4dDogXCJcIixcbiAgICAgIG1hcmtzOiBbXVxuICAgIH1dLFxuICAgIHZhbHVlOiByZXN0XG4gIH07XG59XG5mdW5jdGlvbiBmcm9tU2xhdGVCbG9jayhibG9jaywgdGV4dEJsb2NrVHlwZSkge1xuICBjb25zdCB7XG4gICAgX2tleSxcbiAgICBfdHlwZVxuICB9ID0gYmxvY2s7XG4gIGlmICghX2tleSB8fCAhX3R5cGUpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm90IGEgdmFsaWQgYmxvY2tcIik7XG4gIGlmIChfdHlwZSA9PT0gdGV4dEJsb2NrVHlwZSAmJiBcImNoaWxkcmVuXCIgaW4gYmxvY2sgJiYgQXJyYXkuaXNBcnJheShibG9jay5jaGlsZHJlbikgJiYgX2tleSkge1xuICAgIGxldCBoYXNJbmxpbmVzID0gITE7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBibG9jay5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIF90eXBlOiBfY1R5cGVcbiAgICAgIH0gPSBjaGlsZDtcbiAgICAgIGlmIChcInZhbHVlXCIgaW4gY2hpbGQgJiYgX2NUeXBlICE9PSBcInNwYW5cIikge1xuICAgICAgICBoYXNJbmxpbmVzID0gITA7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICB2YWx1ZTogdixcbiAgICAgICAgICBfa2V5OiBrLFxuICAgICAgICAgIF90eXBlOiB0LFxuICAgICAgICAgIF9faW5saW5lOiBfaSxcbiAgICAgICAgICBjaGlsZHJlbjogX2MsXG4gICAgICAgICAgLi4ucmVzdFxuICAgICAgICB9ID0gY2hpbGQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAuLi52LFxuICAgICAgICAgIF9rZXk6IGssXG4gICAgICAgICAgX3R5cGU6IHRcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGlsZDtcbiAgICB9KTtcbiAgICByZXR1cm4gaGFzSW5saW5lcyA/IHtcbiAgICAgIC4uLmJsb2NrLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICBfa2V5LFxuICAgICAgX3R5cGVcbiAgICB9IDogYmxvY2s7XG4gIH1cbiAgY29uc3QgYmxvY2tWYWx1ZSA9IFwidmFsdWVcIiBpbiBibG9jayAmJiBibG9jay52YWx1ZTtcbiAgcmV0dXJuIHtcbiAgICBfa2V5LFxuICAgIF90eXBlLFxuICAgIC4uLnR5cGVvZiBibG9ja1ZhbHVlID09IFwib2JqZWN0XCIgPyBibG9ja1ZhbHVlIDoge31cbiAgfTtcbn1cbmZ1bmN0aW9uIGlzRXF1YWxUb0VtcHR5RWRpdG9yKGluaXRpYWxWYWx1ZSwgYmxvY2tzLCBzY2hlbWFUeXBlcykge1xuICBpZiAoIWJsb2NrcyB8fCBibG9ja3MubGVuZ3RoICE9PSAxKVxuICAgIHJldHVybiAhMTtcbiAgY29uc3QgZmlyc3RCbG9jayA9IGJsb2Nrcy5hdCgwKTtcbiAgaWYgKCFmaXJzdEJsb2NrKVxuICAgIHJldHVybiAhMDtcbiAgaWYgKCFFbGVtZW50JDEuaXNFbGVtZW50KGZpcnN0QmxvY2spIHx8IGZpcnN0QmxvY2suX3R5cGUgIT09IHNjaGVtYVR5cGVzLmJsb2NrLm5hbWUgfHwgXCJsaXN0SXRlbVwiIGluIGZpcnN0QmxvY2sgfHwgIShcInN0eWxlXCIgaW4gZmlyc3RCbG9jaykgfHwgZmlyc3RCbG9jay5zdHlsZSAhPT0gc2NoZW1hVHlwZXMuc3R5bGVzLmF0KDApPy5uYW1lIHx8ICFBcnJheS5pc0FycmF5KGZpcnN0QmxvY2suY2hpbGRyZW4pIHx8IGZpcnN0QmxvY2suY2hpbGRyZW4ubGVuZ3RoICE9PSAxKVxuICAgIHJldHVybiAhMTtcbiAgY29uc3QgZmlyc3RDaGlsZCA9IGZpcnN0QmxvY2suY2hpbGRyZW4uYXQoMCk7XG4gIHJldHVybiAhKCFmaXJzdENoaWxkIHx8ICFUZXh0LmlzVGV4dChmaXJzdENoaWxkKSB8fCAhKFwiX3R5cGVcIiBpbiBmaXJzdENoaWxkKSB8fCBmaXJzdENoaWxkLl90eXBlICE9PSBzY2hlbWFUeXBlcy5zcGFuLm5hbWUgfHwgZmlyc3RDaGlsZC50ZXh0ICE9PSBcIlwiIHx8IGZpcnN0Q2hpbGQubWFya3M/LmpvaW4oXCJcIikgfHwgT2JqZWN0LmtleXMoZmlyc3RCbG9jaykuc29tZSgoa2V5KSA9PiBrZXkgIT09IFwiX3R5cGVcIiAmJiBrZXkgIT09IFwiX2tleVwiICYmIGtleSAhPT0gXCJjaGlsZHJlblwiICYmIGtleSAhPT0gXCJtYXJrRGVmc1wiICYmIGtleSAhPT0gXCJzdHlsZVwiKSB8fCBpc0VxdWFsVmFsdWVzKHtcbiAgICBzY2hlbWE6IHNjaGVtYVR5cGVzXG4gIH0sIGluaXRpYWxWYWx1ZSwgW2ZpcnN0QmxvY2tdKSk7XG59XG5mdW5jdGlvbiBnZXRGb2N1c0Jsb2NrKHtcbiAgZWRpdG9yXG59KSB7XG4gIGlmICghZWRpdG9yLnNlbGVjdGlvbilcbiAgICByZXR1cm4gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gRWRpdG9yLm5vZGUoZWRpdG9yLCBlZGl0b3Iuc2VsZWN0aW9uLmZvY3VzLnBhdGguc2xpY2UoMCwgMSkpID8/IFt2b2lkIDAsIHZvaWQgMF07XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICB9XG59XG5mdW5jdGlvbiBnZXRGb2N1c1NwYW4oe1xuICBlZGl0b3Jcbn0pIHtcbiAgaWYgKCFlZGl0b3Iuc2VsZWN0aW9uKVxuICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICB0cnkge1xuICAgIGNvbnN0IFtmb2N1c0Jsb2NrXSA9IGdldEZvY3VzQmxvY2soe1xuICAgICAgZWRpdG9yXG4gICAgfSk7XG4gICAgaWYgKCFmb2N1c0Jsb2NrKVxuICAgICAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG4gICAgaWYgKCFlZGl0b3IuaXNUZXh0QmxvY2soZm9jdXNCbG9jaykpXG4gICAgICByZXR1cm4gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgICBjb25zdCBbbm9kZSwgcGF0aF0gPSBFZGl0b3Iubm9kZShlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24uZm9jdXMucGF0aC5zbGljZSgwLCAyKSk7XG4gICAgaWYgKGVkaXRvci5pc1RleHRTcGFuKG5vZGUpKVxuICAgICAgcmV0dXJuIFtub2RlLCBwYXRoXTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG4gIH1cbiAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG59XG5mdW5jdGlvbiBnZXRQb2ludEJsb2NrKHtcbiAgZWRpdG9yLFxuICBwb2ludFxufSkge1xuICB0cnkge1xuICAgIGNvbnN0IFtibG9ja10gPSBFZGl0b3Iubm9kZShlZGl0b3IsIHBvaW50LnBhdGguc2xpY2UoMCwgMSkpID8/IFt2b2lkIDAsIHZvaWQgMF07XG4gICAgcmV0dXJuIGJsb2NrID8gW2Jsb2NrLCBwb2ludC5wYXRoLnNsaWNlKDAsIDEpXSA6IFt2b2lkIDAsIHZvaWQgMF07XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICB9XG59XG5mdW5jdGlvbiBnZXRGb2N1c0NoaWxkKHtcbiAgZWRpdG9yXG59KSB7XG4gIGNvbnN0IFtmb2N1c0Jsb2NrLCBmb2N1c0Jsb2NrUGF0aF0gPSBnZXRGb2N1c0Jsb2NrKHtcbiAgICBlZGl0b3JcbiAgfSksIGNoaWxkSW5kZXggPSBlZGl0b3Iuc2VsZWN0aW9uPy5mb2N1cy5wYXRoLmF0KDEpO1xuICBpZiAoIWZvY3VzQmxvY2sgfHwgIWZvY3VzQmxvY2tQYXRoIHx8IGNoaWxkSW5kZXggPT09IHZvaWQgMClcbiAgICByZXR1cm4gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgdHJ5IHtcbiAgICBjb25zdCBmb2N1c0NoaWxkID0gTm9kZS5jaGlsZChmb2N1c0Jsb2NrLCBjaGlsZEluZGV4KTtcbiAgICByZXR1cm4gZm9jdXNDaGlsZCA/IFtmb2N1c0NoaWxkLCBbLi4uZm9jdXNCbG9ja1BhdGgsIGNoaWxkSW5kZXhdXSA6IFt2b2lkIDAsIHZvaWQgMF07XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICB9XG59XG5mdW5jdGlvbiBnZXRQb2ludENoaWxkKHtcbiAgZWRpdG9yLFxuICBwb2ludFxufSkge1xuICBjb25zdCBbYmxvY2ssIGJsb2NrUGF0aF0gPSBnZXRQb2ludEJsb2NrKHtcbiAgICBlZGl0b3IsXG4gICAgcG9pbnRcbiAgfSksIGNoaWxkSW5kZXggPSBwb2ludC5wYXRoLmF0KDEpO1xuICBpZiAoIWJsb2NrIHx8ICFibG9ja1BhdGggfHwgY2hpbGRJbmRleCA9PT0gdm9pZCAwKVxuICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICB0cnkge1xuICAgIGNvbnN0IHBvaW50Q2hpbGQgPSBOb2RlLmNoaWxkKGJsb2NrLCBjaGlsZEluZGV4KTtcbiAgICByZXR1cm4gcG9pbnRDaGlsZCA/IFtwb2ludENoaWxkLCBbLi4uYmxvY2tQYXRoLCBjaGlsZEluZGV4XV0gOiBbdm9pZCAwLCB2b2lkIDBdO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0Rmlyc3RCbG9jayh7XG4gIGVkaXRvclxufSkge1xuICBpZiAoZWRpdG9yLmNoaWxkcmVuLmxlbmd0aCA9PT0gMClcbiAgICByZXR1cm4gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgY29uc3QgZmlyc3RCbG9ja1BhdGggPSBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBbXSkucGF0aC5hdCgwKTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gZmlyc3RCbG9ja1BhdGggIT09IHZvaWQgMCA/IEVkaXRvci5ub2RlKGVkaXRvciwgW2ZpcnN0QmxvY2tQYXRoXSkgPz8gW3ZvaWQgMCwgdm9pZCAwXSA6IFt2b2lkIDAsIHZvaWQgMF07XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICB9XG59XG5mdW5jdGlvbiBnZXRMYXN0QmxvY2soe1xuICBlZGl0b3Jcbn0pIHtcbiAgaWYgKGVkaXRvci5jaGlsZHJlbi5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG4gIGNvbnN0IGxhc3RCbG9ja1BhdGggPSBFZGl0b3IuZW5kKGVkaXRvciwgW10pLnBhdGguYXQoMCk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGxhc3RCbG9ja1BhdGggIT09IHZvaWQgMCA/IEVkaXRvci5ub2RlKGVkaXRvciwgW2xhc3RCbG9ja1BhdGhdKSA/PyBbdm9pZCAwLCB2b2lkIDBdIDogW3ZvaWQgMCwgdm9pZCAwXTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG4gIH1cbn1cbmZ1bmN0aW9uIGdldE5vZGVCbG9jayh7XG4gIGVkaXRvcixcbiAgc2NoZW1hLFxuICBub2RlXG59KSB7XG4gIGlmIChFZGl0b3IuaXNFZGl0b3Iobm9kZSkpXG4gICAgcmV0dXJuO1xuICBpZiAoaXNCbG9ja0VsZW1lbnQoe1xuICAgIGVkaXRvcixcbiAgICBzY2hlbWFcbiAgfSwgbm9kZSkpXG4gICAgcmV0dXJuIGVsZW1lbnRUb0Jsb2NrKHtcbiAgICAgIHNjaGVtYSxcbiAgICAgIGVsZW1lbnQ6IG5vZGVcbiAgICB9KTtcbiAgY29uc3QgcGFyZW50ID0gQXJyYXkuZnJvbShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgbW9kZTogXCJoaWdoZXN0XCIsXG4gICAgYXQ6IFtdLFxuICAgIG1hdGNoOiAobikgPT4gaXNCbG9ja0VsZW1lbnQoe1xuICAgICAgZWRpdG9yLFxuICAgICAgc2NoZW1hXG4gICAgfSwgbikgJiYgbi5jaGlsZHJlbi5zb21lKChjaGlsZCkgPT4gY2hpbGQuX2tleSA9PT0gbm9kZS5fa2V5KVxuICB9KSkuYXQoMCk/LmF0KDApO1xuICByZXR1cm4gRWxlbWVudCQxLmlzRWxlbWVudChwYXJlbnQpID8gZWxlbWVudFRvQmxvY2soe1xuICAgIHNjaGVtYSxcbiAgICBlbGVtZW50OiBwYXJlbnRcbiAgfSkgOiB2b2lkIDA7XG59XG5mdW5jdGlvbiBlbGVtZW50VG9CbG9jayh7XG4gIHNjaGVtYSxcbiAgZWxlbWVudFxufSkge1xuICByZXR1cm4gZnJvbVNsYXRlQmxvY2soZWxlbWVudCwgc2NoZW1hLmJsb2NrLm5hbWUpO1xufVxuZnVuY3Rpb24gaXNCbG9ja0VsZW1lbnQoe1xuICBlZGl0b3IsXG4gIHNjaGVtYVxufSwgbm9kZSkge1xuICByZXR1cm4gRWxlbWVudCQxLmlzRWxlbWVudChub2RlKSAmJiAhZWRpdG9yLmlzSW5saW5lKG5vZGUpICYmIChzY2hlbWEuYmxvY2submFtZSA9PT0gbm9kZS5fdHlwZSB8fCBzY2hlbWEuYmxvY2tPYmplY3RzLnNvbWUoKGJsb2NrT2JqZWN0KSA9PiBibG9ja09iamVjdC5uYW1lID09PSBub2RlLl90eXBlKSk7XG59XG5mdW5jdGlvbiBpc0xpc3RJdGVtQWN0aXZlKHtcbiAgZWRpdG9yLFxuICBsaXN0SXRlbVxufSkge1xuICBpZiAoIWVkaXRvci5zZWxlY3Rpb24pXG4gICAgcmV0dXJuICExO1xuICBjb25zdCBzZWxlY3RlZEJsb2NrcyA9IFsuLi5FZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgYXQ6IGVkaXRvci5zZWxlY3Rpb24sXG4gICAgbWF0Y2g6IChub2RlKSA9PiBlZGl0b3IuaXNUZXh0QmxvY2sobm9kZSlcbiAgfSldO1xuICByZXR1cm4gc2VsZWN0ZWRCbG9ja3MubGVuZ3RoID4gMCA/IHNlbGVjdGVkQmxvY2tzLmV2ZXJ5KChbbm9kZV0pID0+IGVkaXRvci5pc0xpc3RCbG9jayhub2RlKSAmJiBub2RlLmxpc3RJdGVtID09PSBsaXN0SXRlbSkgOiAhMTtcbn1cbmZ1bmN0aW9uIGlzU3R5bGVBY3RpdmUoe1xuICBlZGl0b3IsXG4gIHN0eWxlXG59KSB7XG4gIGlmICghZWRpdG9yLnNlbGVjdGlvbilcbiAgICByZXR1cm4gITE7XG4gIGNvbnN0IHNlbGVjdGVkQmxvY2tzID0gWy4uLkVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICBhdDogZWRpdG9yLnNlbGVjdGlvbixcbiAgICBtYXRjaDogKG5vZGUpID0+IGVkaXRvci5pc1RleHRCbG9jayhub2RlKVxuICB9KV07XG4gIHJldHVybiBzZWxlY3RlZEJsb2Nrcy5sZW5ndGggPiAwID8gc2VsZWN0ZWRCbG9ja3MuZXZlcnkoKFtub2RlXSkgPT4gbm9kZS5zdHlsZSA9PT0gc3R5bGUpIDogITE7XG59XG5mdW5jdGlvbiBzbGF0ZVJhbmdlVG9TZWxlY3Rpb24oe1xuICBzY2hlbWEsXG4gIGVkaXRvcixcbiAgcmFuZ2Vcbn0pIHtcbiAgY29uc3QgW2FuY2hvckJsb2NrXSA9IGdldFBvaW50QmxvY2soe1xuICAgIGVkaXRvcixcbiAgICBwb2ludDogcmFuZ2UuYW5jaG9yXG4gIH0pLCBbZm9jdXNCbG9ja10gPSBnZXRQb2ludEJsb2NrKHtcbiAgICBlZGl0b3IsXG4gICAgcG9pbnQ6IHJhbmdlLmZvY3VzXG4gIH0pO1xuICBpZiAoIWFuY2hvckJsb2NrIHx8ICFmb2N1c0Jsb2NrKVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBbYW5jaG9yQ2hpbGRdID0gYW5jaG9yQmxvY2suX3R5cGUgPT09IHNjaGVtYS5ibG9jay5uYW1lID8gZ2V0UG9pbnRDaGlsZCh7XG4gICAgZWRpdG9yLFxuICAgIHBvaW50OiByYW5nZS5hbmNob3JcbiAgfSkgOiBbdm9pZCAwLCB2b2lkIDBdLCBbZm9jdXNDaGlsZF0gPSBmb2N1c0Jsb2NrLl90eXBlID09PSBzY2hlbWEuYmxvY2submFtZSA/IGdldFBvaW50Q2hpbGQoe1xuICAgIGVkaXRvcixcbiAgICBwb2ludDogcmFuZ2UuZm9jdXNcbiAgfSkgOiBbdm9pZCAwLCB2b2lkIDBdLCBzZWxlY3Rpb24gPSB7XG4gICAgYW5jaG9yOiB7XG4gICAgICBwYXRoOiBbe1xuICAgICAgICBfa2V5OiBhbmNob3JCbG9jay5fa2V5XG4gICAgICB9XSxcbiAgICAgIG9mZnNldDogcmFuZ2UuYW5jaG9yLm9mZnNldFxuICAgIH0sXG4gICAgZm9jdXM6IHtcbiAgICAgIHBhdGg6IFt7XG4gICAgICAgIF9rZXk6IGZvY3VzQmxvY2suX2tleVxuICAgICAgfV0sXG4gICAgICBvZmZzZXQ6IHJhbmdlLmZvY3VzLm9mZnNldFxuICAgIH0sXG4gICAgYmFja3dhcmQ6IFJhbmdlLmlzQmFja3dhcmQocmFuZ2UpXG4gIH07XG4gIHJldHVybiBhbmNob3JDaGlsZCAmJiAoc2VsZWN0aW9uLmFuY2hvci5wYXRoLnB1c2goXCJjaGlsZHJlblwiKSwgc2VsZWN0aW9uLmFuY2hvci5wYXRoLnB1c2goe1xuICAgIF9rZXk6IGFuY2hvckNoaWxkLl9rZXlcbiAgfSkpLCBmb2N1c0NoaWxkICYmIChzZWxlY3Rpb24uZm9jdXMucGF0aC5wdXNoKFwiY2hpbGRyZW5cIiksIHNlbGVjdGlvbi5mb2N1cy5wYXRoLnB1c2goe1xuICAgIF9rZXk6IGZvY3VzQ2hpbGQuX2tleVxuICB9KSksIHNlbGVjdGlvbjtcbn1cbmZ1bmN0aW9uIHNsYXRlUG9pbnRUb1NlbGVjdGlvblBvaW50KHtcbiAgc2NoZW1hLFxuICBlZGl0b3IsXG4gIHBvaW50XG59KSB7XG4gIGNvbnN0IFtibG9ja10gPSBnZXRQb2ludEJsb2NrKHtcbiAgICBlZGl0b3IsXG4gICAgcG9pbnRcbiAgfSk7XG4gIGlmICghYmxvY2spXG4gICAgcmV0dXJuO1xuICBjb25zdCBbY2hpbGRdID0gYmxvY2suX3R5cGUgPT09IHNjaGVtYS5ibG9jay5uYW1lID8gZ2V0UG9pbnRDaGlsZCh7XG4gICAgZWRpdG9yLFxuICAgIHBvaW50XG4gIH0pIDogW3ZvaWQgMCwgdm9pZCAwXTtcbiAgcmV0dXJuIGNoaWxkID8ge1xuICAgIHBhdGg6IFt7XG4gICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgfV0sXG4gICAgb2Zmc2V0OiBwb2ludC5vZmZzZXRcbiAgfSA6IHtcbiAgICBwYXRoOiBbe1xuICAgICAgX2tleTogYmxvY2suX2tleVxuICAgIH1dLFxuICAgIG9mZnNldDogcG9pbnQub2Zmc2V0XG4gIH07XG59XG5mdW5jdGlvbiBnZXRFdmVudFBvc2l0aW9uKHtcbiAgZWRpdG9yQWN0b3IsXG4gIHNsYXRlRWRpdG9yLFxuICBldmVudFxufSkge1xuICBpZiAoZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5tYXRjaGVzKHtcbiAgICBzZXR1cDogXCJzZXR0aW5nIHVwXCJcbiAgfSkpXG4gICAgcmV0dXJuO1xuICBjb25zdCBldmVudE5vZGUgPSBnZXRFdmVudE5vZGUoe1xuICAgIHNsYXRlRWRpdG9yLFxuICAgIGV2ZW50XG4gIH0pO1xuICBpZiAoIWV2ZW50Tm9kZSlcbiAgICByZXR1cm47XG4gIGNvbnN0IGV2ZW50QmxvY2sgPSBnZXROb2RlQmxvY2soe1xuICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLFxuICAgIG5vZGU6IGV2ZW50Tm9kZVxuICB9KSwgZXZlbnRQb3NpdGlvbkJsb2NrID0gZ2V0RXZlbnRQb3NpdGlvbkJsb2NrKHtcbiAgICBub2RlOiBldmVudE5vZGUsXG4gICAgc2xhdGVFZGl0b3IsXG4gICAgZXZlbnRcbiAgfSksIGV2ZW50U2VsZWN0aW9uID0gZ2V0RXZlbnRTZWxlY3Rpb24oe1xuICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICBzbGF0ZUVkaXRvcixcbiAgICBldmVudFxuICB9KTtcbiAgaWYgKGV2ZW50QmxvY2sgJiYgZXZlbnRQb3NpdGlvbkJsb2NrICYmICFldmVudFNlbGVjdGlvbiAmJiAhRWRpdG9yLmlzRWRpdG9yKGV2ZW50Tm9kZSkpXG4gICAgcmV0dXJuIHtcbiAgICAgIGJsb2NrOiBldmVudFBvc2l0aW9uQmxvY2ssXG4gICAgICBpc0VkaXRvcjogITEsXG4gICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgYW5jaG9yOiBnZXRCbG9ja1N0YXJ0UG9pbnQoe1xuICAgICAgICAgIGNvbnRleHQ6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dCxcbiAgICAgICAgICBibG9jazoge1xuICAgICAgICAgICAgbm9kZTogZXZlbnRCbG9jayxcbiAgICAgICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgICAgIF9rZXk6IGV2ZW50QmxvY2suX2tleVxuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBmb2N1czogZ2V0QmxvY2tFbmRQb2ludCh7XG4gICAgICAgICAgY29udGV4dDogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LFxuICAgICAgICAgIGJsb2NrOiB7XG4gICAgICAgICAgICBub2RlOiBldmVudEJsb2NrLFxuICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgX2tleTogZXZlbnRCbG9jay5fa2V5XG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9O1xuICBpZiAoIWV2ZW50UG9zaXRpb25CbG9jayB8fCAhZXZlbnRTZWxlY3Rpb24pXG4gICAgcmV0dXJuO1xuICBjb25zdCBldmVudFNlbGVjdGlvbkZvY3VzQmxvY2tLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChldmVudFNlbGVjdGlvbi5mb2N1cyk7XG4gIGlmIChldmVudFNlbGVjdGlvbkZvY3VzQmxvY2tLZXkgIT09IHZvaWQgMClcbiAgICByZXR1cm4gaXNTZWxlY3Rpb25Db2xsYXBzZWQoZXZlbnRTZWxlY3Rpb24pICYmIGV2ZW50QmxvY2sgJiYgZXZlbnRTZWxlY3Rpb25Gb2N1c0Jsb2NrS2V5ICE9PSBldmVudEJsb2NrLl9rZXkgPyB7XG4gICAgICBibG9jazogZXZlbnRQb3NpdGlvbkJsb2NrLFxuICAgICAgaXNFZGl0b3I6ICExLFxuICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgIGFuY2hvcjogZ2V0QmxvY2tTdGFydFBvaW50KHtcbiAgICAgICAgICBjb250ZXh0OiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQsXG4gICAgICAgICAgYmxvY2s6IHtcbiAgICAgICAgICAgIG5vZGU6IGV2ZW50QmxvY2ssXG4gICAgICAgICAgICBwYXRoOiBbe1xuICAgICAgICAgICAgICBfa2V5OiBldmVudEJsb2NrLl9rZXlcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgZm9jdXM6IGdldEJsb2NrRW5kUG9pbnQoe1xuICAgICAgICAgIGNvbnRleHQ6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dCxcbiAgICAgICAgICBibG9jazoge1xuICAgICAgICAgICAgbm9kZTogZXZlbnRCbG9jayxcbiAgICAgICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgICAgIF9rZXk6IGV2ZW50QmxvY2suX2tleVxuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSA6IHtcbiAgICAgIGJsb2NrOiBldmVudFBvc2l0aW9uQmxvY2ssXG4gICAgICBpc0VkaXRvcjogRWRpdG9yLmlzRWRpdG9yKGV2ZW50Tm9kZSksXG4gICAgICBzZWxlY3Rpb246IGV2ZW50U2VsZWN0aW9uXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldEV2ZW50Tm9kZSh7XG4gIHNsYXRlRWRpdG9yLFxuICBldmVudFxufSkge1xuICBpZiAoIURPTUVkaXRvci5oYXNUYXJnZXQoc2xhdGVFZGl0b3IsIGV2ZW50LnRhcmdldCkpXG4gICAgcmV0dXJuO1xuICBsZXQgbm9kZTtcbiAgdHJ5IHtcbiAgICBub2RlID0gRE9NRWRpdG9yLnRvU2xhdGVOb2RlKHNsYXRlRWRpdG9yLCBldmVudC50YXJnZXQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG4gIHJldHVybiBub2RlO1xufVxuZnVuY3Rpb24gZ2V0RXZlbnRQb3NpdGlvbkJsb2NrKHtcbiAgbm9kZSxcbiAgc2xhdGVFZGl0b3IsXG4gIGV2ZW50XG59KSB7XG4gIGNvbnN0IFtmaXJzdEJsb2NrXSA9IGdldEZpcnN0QmxvY2soe1xuICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgfSk7XG4gIGlmICghZmlyc3RCbG9jaylcbiAgICByZXR1cm47XG4gIGxldCBmaXJzdEJsb2NrRWxlbWVudDtcbiAgdHJ5IHtcbiAgICBmaXJzdEJsb2NrRWxlbWVudCA9IERPTUVkaXRvci50b0RPTU5vZGUoc2xhdGVFZGl0b3IsIGZpcnN0QmxvY2spO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG4gIGlmICghZmlyc3RCbG9ja0VsZW1lbnQpXG4gICAgcmV0dXJuO1xuICBjb25zdCBmaXJzdEJsb2NrUmVjdCA9IGZpcnN0QmxvY2tFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBpZiAoZXZlbnQucGFnZVkgPCBmaXJzdEJsb2NrUmVjdC50b3ApXG4gICAgcmV0dXJuIFwic3RhcnRcIjtcbiAgY29uc3QgW2xhc3RCbG9ja10gPSBnZXRMYXN0QmxvY2soe1xuICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgfSk7XG4gIGlmICghbGFzdEJsb2NrKVxuICAgIHJldHVybjtcbiAgbGV0IGxhc3RCbG9ja0VsZW1lbnQ7XG4gIHRyeSB7XG4gICAgbGFzdEJsb2NrRWxlbWVudCA9IERPTUVkaXRvci50b0RPTU5vZGUoc2xhdGVFZGl0b3IsIGxhc3RCbG9jayk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gIH1cbiAgaWYgKCFsYXN0QmxvY2tFbGVtZW50KVxuICAgIHJldHVybjtcbiAgY29uc3QgbGFzdEJsb2NrUmVmID0gbGFzdEJsb2NrRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgaWYgKGV2ZW50LnBhZ2VZID4gbGFzdEJsb2NrUmVmLmJvdHRvbSlcbiAgICByZXR1cm4gXCJlbmRcIjtcbiAgbGV0IGVsZW1lbnQ7XG4gIHRyeSB7XG4gICAgZWxlbWVudCA9IERPTUVkaXRvci50b0RPTU5vZGUoc2xhdGVFZGl0b3IsIG5vZGUpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG4gIGlmICghZWxlbWVudClcbiAgICByZXR1cm47XG4gIGNvbnN0IGVsZW1lbnRSZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgdG9wID0gZWxlbWVudFJlY3QudG9wLCBoZWlnaHQgPSBlbGVtZW50UmVjdC5oZWlnaHQ7XG4gIHJldHVybiBNYXRoLmFicyh0b3AgLSBldmVudC5wYWdlWSkgPCBoZWlnaHQgLyAyID8gXCJzdGFydFwiIDogXCJlbmRcIjtcbn1cbmZ1bmN0aW9uIGdldEV2ZW50U2VsZWN0aW9uKHtcbiAgc2NoZW1hLFxuICBzbGF0ZUVkaXRvcixcbiAgZXZlbnRcbn0pIHtcbiAgY29uc3QgcmFuZ2UgPSBnZXRTbGF0ZVJhbmdlRnJvbUV2ZW50KHNsYXRlRWRpdG9yLCBldmVudCk7XG4gIHJldHVybiByYW5nZSA/IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgc2NoZW1hLFxuICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgcmFuZ2VcbiAgfSkgOiBudWxsO1xufVxuZnVuY3Rpb24gZ2V0U2xhdGVSYW5nZUZyb21FdmVudChlZGl0b3IsIGV2ZW50KSB7XG4gIGlmICghZXZlbnQudGFyZ2V0IHx8ICFpc0RPTU5vZGUoZXZlbnQudGFyZ2V0KSlcbiAgICByZXR1cm47XG4gIGNvbnN0IHdpbmRvdzIgPSBET01FZGl0b3IuZ2V0V2luZG93KGVkaXRvcik7XG4gIGxldCBkb21SYW5nZTtcbiAgaWYgKHdpbmRvdzIuZG9jdW1lbnQuY2FyZXRQb3NpdGlvbkZyb21Qb2ludCAhPT0gdm9pZCAwKSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB3aW5kb3cyLmRvY3VtZW50LmNhcmV0UG9zaXRpb25Gcm9tUG9pbnQoZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSk7XG4gICAgaWYgKHBvc2l0aW9uKVxuICAgICAgdHJ5IHtcbiAgICAgICAgZG9tUmFuZ2UgPSB3aW5kb3cyLmRvY3VtZW50LmNyZWF0ZVJhbmdlKCksIGRvbVJhbmdlLnNldFN0YXJ0KHBvc2l0aW9uLm9mZnNldE5vZGUsIHBvc2l0aW9uLm9mZnNldCksIGRvbVJhbmdlLnNldEVuZChwb3NpdGlvbi5vZmZzZXROb2RlLCBwb3NpdGlvbi5vZmZzZXQpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICB9XG4gIH0gZWxzZSBpZiAod2luZG93Mi5kb2N1bWVudC5jYXJldFJhbmdlRnJvbVBvaW50ICE9PSB2b2lkIDApXG4gICAgZG9tUmFuZ2UgPSB3aW5kb3cyLmRvY3VtZW50LmNhcmV0UmFuZ2VGcm9tUG9pbnQoZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSkgPz8gdm9pZCAwO1xuICBlbHNlIHtcbiAgICBjb25zb2xlLndhcm4oXCJOZWl0aGVyIGNhcmV0UG9zaXRpb25Gcm9tUG9pbnQgbm9yIGNhcmV0UmFuZ2VGcm9tUG9pbnQgaXMgc3VwcG9ydGVkXCIpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIWRvbVJhbmdlKVxuICAgIHJldHVybjtcbiAgbGV0IHJhbmdlO1xuICB0cnkge1xuICAgIHJhbmdlID0gRE9NRWRpdG9yLnRvU2xhdGVSYW5nZShlZGl0b3IsIGRvbVJhbmdlLCB7XG4gICAgICBleGFjdE1hdGNoOiAhMSxcbiAgICAgIC8vIEl0IGNhbiBzdGlsbCB0aHJvdyBldmVuIHdpdGggdGhpcyBvcHRpb24gc2V0IHRvIHRydWVcbiAgICAgIHN1cHByZXNzVGhyb3c6ICExXG4gICAgfSk7XG4gIH0gY2F0Y2gge1xuICB9XG4gIHJldHVybiByYW5nZTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBvaW50KHBvaW50LCB2YWx1ZSkge1xuICBpZiAoIXBvaW50IHx8ICF2YWx1ZSlcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3QgbmV3UGF0aCA9IFtdO1xuICBsZXQgbmV3T2Zmc2V0ID0gcG9pbnQub2Zmc2V0IHx8IDA7XG4gIGNvbnN0IGJsb2NrS2V5ID0gdHlwZW9mIHBvaW50LnBhdGhbMF0gPT0gXCJvYmplY3RcIiAmJiBcIl9rZXlcIiBpbiBwb2ludC5wYXRoWzBdICYmIHBvaW50LnBhdGhbMF0uX2tleSwgY2hpbGRLZXkgPSB0eXBlb2YgcG9pbnQucGF0aFsyXSA9PSBcIm9iamVjdFwiICYmIFwiX2tleVwiIGluIHBvaW50LnBhdGhbMl0gJiYgcG9pbnQucGF0aFsyXS5fa2V5LCBibG9jayA9IHZhbHVlLmZpbmQoKGJsaykgPT4gYmxrLl9rZXkgPT09IGJsb2NrS2V5KTtcbiAgaWYgKGJsb2NrKVxuICAgIG5ld1BhdGgucHVzaCh7XG4gICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgfSk7XG4gIGVsc2VcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKGJsb2NrICYmIHBvaW50LnBhdGhbMV0gPT09IFwiY2hpbGRyZW5cIikge1xuICAgIGlmICghYmxvY2suY2hpbGRyZW4gfHwgQXJyYXkuaXNBcnJheShibG9jay5jaGlsZHJlbikgJiYgYmxvY2suY2hpbGRyZW4ubGVuZ3RoID09PSAwKVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgY2hpbGQgPSBBcnJheS5pc0FycmF5KGJsb2NrLmNoaWxkcmVuKSAmJiBibG9jay5jaGlsZHJlbi5maW5kKChjbGQpID0+IGNsZC5fa2V5ID09PSBjaGlsZEtleSk7XG4gICAgaWYgKGNoaWxkKVxuICAgICAgbmV3UGF0aC5wdXNoKFwiY2hpbGRyZW5cIiksIG5ld1BhdGgucHVzaCh7XG4gICAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICAgIH0pLCBuZXdPZmZzZXQgPSBjaGlsZC50ZXh0ICYmIGNoaWxkLnRleHQubGVuZ3RoID49IHBvaW50Lm9mZnNldCA/IHBvaW50Lm9mZnNldCA6IGNoaWxkLnRleHQgJiYgY2hpbGQudGV4dC5sZW5ndGggfHwgMDtcbiAgICBlbHNlXG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4ge1xuICAgIHBhdGg6IG5ld1BhdGgsXG4gICAgb2Zmc2V0OiBuZXdPZmZzZXRcbiAgfTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZVNlbGVjdGlvbihzZWxlY3Rpb24sIHZhbHVlKSB7XG4gIGlmICghc2VsZWN0aW9uIHx8ICF2YWx1ZSB8fCB2YWx1ZS5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIG51bGw7XG4gIGxldCBuZXdBbmNob3IgPSBudWxsLCBuZXdGb2N1cyA9IG51bGw7XG4gIGNvbnN0IHtcbiAgICBhbmNob3IsXG4gICAgZm9jdXNcbiAgfSA9IHNlbGVjdGlvbjtcbiAgcmV0dXJuIGFuY2hvciAmJiB2YWx1ZS5maW5kKChibGspID0+IGlzS2V5ZWRTZWdtZW50KGFuY2hvci5wYXRoWzBdKSAmJiBibGsuX2tleSA9PT0gYW5jaG9yLnBhdGhbMF0uX2tleSkgJiYgKG5ld0FuY2hvciA9IG5vcm1hbGl6ZVBvaW50KGFuY2hvciwgdmFsdWUpKSwgZm9jdXMgJiYgdmFsdWUuZmluZCgoYmxrKSA9PiBpc0tleWVkU2VnbWVudChmb2N1cy5wYXRoWzBdKSAmJiBibGsuX2tleSA9PT0gZm9jdXMucGF0aFswXS5fa2V5KSAmJiAobmV3Rm9jdXMgPSBub3JtYWxpemVQb2ludChmb2N1cywgdmFsdWUpKSwgbmV3QW5jaG9yICYmIG5ld0ZvY3VzID8ge1xuICAgIGFuY2hvcjogbmV3QW5jaG9yLFxuICAgIGZvY3VzOiBuZXdGb2N1cyxcbiAgICBiYWNrd2FyZDogc2VsZWN0aW9uLmJhY2t3YXJkXG4gIH0gOiBudWxsO1xufVxuZnVuY3Rpb24gdG9TbGF0ZVJhbmdlKHNuYXBzaG90KSB7XG4gIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmIChpc0VxdWFsU2VsZWN0aW9uUG9pbnRzKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmFuY2hvciwgc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMpKSB7XG4gICAgY29uc3QgYW5jaG9yUG9pbnQyID0gdG9TbGF0ZVNlbGVjdGlvblBvaW50KHNuYXBzaG90LCBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5hbmNob3IsIHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmJhY2t3YXJkID8gXCJiYWNrd2FyZFwiIDogXCJmb3J3YXJkXCIpO1xuICAgIHJldHVybiBhbmNob3JQb2ludDIgPyB7XG4gICAgICBhbmNob3I6IGFuY2hvclBvaW50MixcbiAgICAgIGZvY3VzOiBhbmNob3JQb2ludDJcbiAgICB9IDogbnVsbDtcbiAgfVxuICBjb25zdCBhbmNob3JQb2ludCA9IHRvU2xhdGVTZWxlY3Rpb25Qb2ludChzbmFwc2hvdCwgc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uYW5jaG9yLCBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5iYWNrd2FyZCA/IFwiZm9yd2FyZFwiIDogXCJiYWNrd2FyZFwiKSwgZm9jdXNQb2ludCA9IHRvU2xhdGVTZWxlY3Rpb25Qb2ludChzbmFwc2hvdCwgc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMsIHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uLmJhY2t3YXJkID8gXCJiYWNrd2FyZFwiIDogXCJmb3J3YXJkXCIpO1xuICByZXR1cm4gIWFuY2hvclBvaW50IHx8ICFmb2N1c1BvaW50ID8gbnVsbCA6IHtcbiAgICBhbmNob3I6IGFuY2hvclBvaW50LFxuICAgIGZvY3VzOiBmb2N1c1BvaW50XG4gIH07XG59XG5mdW5jdGlvbiB0b1NsYXRlU2VsZWN0aW9uUG9pbnQoc25hcHNob3QsIHNlbGVjdGlvblBvaW50LCBkaXJlY3Rpb24pIHtcbiAgY29uc3QgYmxvY2tLZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChzZWxlY3Rpb25Qb2ludCk7XG4gIGlmICghYmxvY2tLZXkpXG4gICAgcmV0dXJuO1xuICBjb25zdCBibG9ja0luZGV4ID0gc25hcHNob3QuYmxvY2tJbmRleE1hcC5nZXQoYmxvY2tLZXkpO1xuICBpZiAoYmxvY2tJbmRleCA9PT0gdm9pZCAwKVxuICAgIHJldHVybjtcbiAgY29uc3QgYmxvY2sgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlLmF0KGJsb2NrSW5kZXgpO1xuICBpZiAoIWJsb2NrKVxuICAgIHJldHVybjtcbiAgaWYgKCFpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBibG9jaykpXG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdGg6IFtibG9ja0luZGV4LCAwXSxcbiAgICAgIG9mZnNldDogMFxuICAgIH07XG4gIGxldCBjaGlsZEtleSA9IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHtcbiAgICBwYXRoOiBzZWxlY3Rpb25Qb2ludC5wYXRoXG4gIH0pO1xuICBjb25zdCBzcGFuU2VsZWN0aW9uUG9pbnQgPSBjaGlsZEtleSA/IHZvaWQgMCA6IGJsb2NrT2Zmc2V0VG9TcGFuU2VsZWN0aW9uUG9pbnQoe1xuICAgIGNvbnRleHQ6IHtcbiAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWEsXG4gICAgICB2YWx1ZTogW2Jsb2NrXVxuICAgIH0sXG4gICAgYmxvY2tPZmZzZXQ6IHtcbiAgICAgIHBhdGg6IFt7XG4gICAgICAgIF9rZXk6IGJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIG9mZnNldDogc2VsZWN0aW9uUG9pbnQub2Zmc2V0XG4gICAgfSxcbiAgICBkaXJlY3Rpb25cbiAgfSk7XG4gIGlmIChjaGlsZEtleSA9IHNwYW5TZWxlY3Rpb25Qb2ludCA/IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KHNwYW5TZWxlY3Rpb25Qb2ludCkgOiBjaGlsZEtleSwgIWNoaWxkS2V5KVxuICAgIHJldHVybiB7XG4gICAgICBwYXRoOiBbYmxvY2tJbmRleCwgMF0sXG4gICAgICBvZmZzZXQ6IDBcbiAgICB9O1xuICBsZXQgb2Zmc2V0ID0gc3BhblNlbGVjdGlvblBvaW50Py5vZmZzZXQgPz8gc2VsZWN0aW9uUG9pbnQub2Zmc2V0LCBjaGlsZFBhdGggPSBbXSwgY2hpbGRJbmRleCA9IC0xLCBwYXRoQ2hpbGQ7XG4gIGZvciAoY29uc3QgY2hpbGQgb2YgYmxvY2suY2hpbGRyZW4pXG4gICAgaWYgKGNoaWxkSW5kZXgrKywgY2hpbGQuX2tleSA9PT0gY2hpbGRLZXkpIHtcbiAgICAgIHBhdGhDaGlsZCA9IGNoaWxkLCBpc1NwYW4oc25hcHNob3QuY29udGV4dCwgY2hpbGQpID8gY2hpbGRQYXRoID0gW2NoaWxkSW5kZXhdIDogKGNoaWxkUGF0aCA9IFtjaGlsZEluZGV4LCAwXSwgb2Zmc2V0ID0gMCk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIHJldHVybiBjaGlsZFBhdGgubGVuZ3RoID09PSAwID8ge1xuICAgIHBhdGg6IFtibG9ja0luZGV4LCAwXSxcbiAgICBvZmZzZXQ6IDBcbiAgfSA6IHtcbiAgICBwYXRoOiBbYmxvY2tJbmRleF0uY29uY2F0KGNoaWxkUGF0aCksXG4gICAgb2Zmc2V0OiBpc1NwYW4oc25hcHNob3QuY29udGV4dCwgcGF0aENoaWxkKSA/IE1hdGgubWluKHBhdGhDaGlsZC50ZXh0Lmxlbmd0aCwgb2Zmc2V0KSA6IG9mZnNldFxuICB9O1xufVxuY29uc3QgRWRpdG9yQWN0b3JDb250ZXh0ID0gY3JlYXRlQ29udGV4dCh7fSk7XG5mdW5jdGlvbiBtb3ZlUmFuZ2VCeU9wZXJhdGlvbihyYW5nZSwgb3BlcmF0aW9uKSB7XG4gIGNvbnN0IGFuY2hvciA9IFBvaW50LnRyYW5zZm9ybShyYW5nZS5hbmNob3IsIG9wZXJhdGlvbiksIGZvY3VzID0gUG9pbnQudHJhbnNmb3JtKHJhbmdlLmZvY3VzLCBvcGVyYXRpb24pO1xuICByZXR1cm4gYW5jaG9yID09PSBudWxsIHx8IGZvY3VzID09PSBudWxsID8gbnVsbCA6IFBvaW50LmVxdWFscyhhbmNob3IsIHJhbmdlLmFuY2hvcikgJiYgUG9pbnQuZXF1YWxzKGZvY3VzLCByYW5nZS5mb2N1cykgPyByYW5nZSA6IHtcbiAgICBhbmNob3IsXG4gICAgZm9jdXNcbiAgfTtcbn1cbmNvbnN0IHNsYXRlT3BlcmF0aW9uQ2FsbGJhY2sgPSAoe1xuICBpbnB1dCxcbiAgc2VuZEJhY2tcbn0pID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxBcHBseSA9IGlucHV0LnNsYXRlRWRpdG9yLmFwcGx5O1xuICByZXR1cm4gaW5wdXQuc2xhdGVFZGl0b3IuYXBwbHkgPSAob3ApID0+IHtcbiAgICBvcC50eXBlICE9PSBcInNldF9zZWxlY3Rpb25cIiAmJiBzZW5kQmFjayh7XG4gICAgICB0eXBlOiBcInNsYXRlIG9wZXJhdGlvblwiLFxuICAgICAgb3BlcmF0aW9uOiBvcFxuICAgIH0pLCBvcmlnaW5hbEFwcGx5KG9wKTtcbiAgfSwgKCkgPT4ge1xuICAgIGlucHV0LnNsYXRlRWRpdG9yLmFwcGx5ID0gb3JpZ2luYWxBcHBseTtcbiAgfTtcbn0sIHJhbmdlRGVjb3JhdGlvbnNNYWNoaW5lID0gc2V0dXAoe1xuICB0eXBlczoge1xuICAgIGNvbnRleHQ6IHt9LFxuICAgIGlucHV0OiB7fSxcbiAgICBldmVudHM6IHt9XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBcInVwZGF0ZSBwZW5kaW5nIHJhbmdlIGRlY29yYXRpb25zXCI6IGFzc2lnbih7XG4gICAgICBwZW5kaW5nUmFuZ2VEZWNvcmF0aW9uczogKHtcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IGV2ZW50LnR5cGUgIT09IFwicmFuZ2UgZGVjb3JhdGlvbnMgdXBkYXRlZFwiID8gY29udGV4dC5wZW5kaW5nUmFuZ2VEZWNvcmF0aW9ucyA6IGV2ZW50LnJhbmdlRGVjb3JhdGlvbnNcbiAgICB9KSxcbiAgICBcInNldCB1cCBpbml0aWFsIHJhbmdlIGRlY29yYXRpb25zXCI6ICh7XG4gICAgICBjb250ZXh0XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgcmFuZ2VEZWNvcmF0aW9uU3RhdGUgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgcmFuZ2VEZWNvcmF0aW9uIG9mIGNvbnRleHQucGVuZGluZ1JhbmdlRGVjb3JhdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc2xhdGVSYW5nZSA9IHRvU2xhdGVSYW5nZSh7XG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICAgIHZhbHVlOiBjb250ZXh0LnNsYXRlRWRpdG9yLnZhbHVlLFxuICAgICAgICAgICAgc2VsZWN0aW9uOiByYW5nZURlY29yYXRpb24uc2VsZWN0aW9uXG4gICAgICAgICAgfSxcbiAgICAgICAgICBibG9ja0luZGV4TWFwOiBjb250ZXh0LnNsYXRlRWRpdG9yLmJsb2NrSW5kZXhNYXBcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghUmFuZ2UuaXNSYW5nZShzbGF0ZVJhbmdlKSkge1xuICAgICAgICAgIHJhbmdlRGVjb3JhdGlvbi5vbk1vdmVkPy4oe1xuICAgICAgICAgICAgbmV3U2VsZWN0aW9uOiBudWxsLFxuICAgICAgICAgICAgcmFuZ2VEZWNvcmF0aW9uLFxuICAgICAgICAgICAgb3JpZ2luOiBcImxvY2FsXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICByYW5nZURlY29yYXRpb25TdGF0ZS5wdXNoKHtcbiAgICAgICAgICByYW5nZURlY29yYXRpb24sXG4gICAgICAgICAgLi4uc2xhdGVSYW5nZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnRleHQuc2xhdGVFZGl0b3IuZGVjb3JhdGVkUmFuZ2VzID0gcmFuZ2VEZWNvcmF0aW9uU3RhdGU7XG4gICAgfSxcbiAgICBcInVwZGF0ZSByYW5nZSBkZWNvcmF0aW9uc1wiOiAoe1xuICAgICAgY29udGV4dCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnR5cGUgIT09IFwicmFuZ2UgZGVjb3JhdGlvbnMgdXBkYXRlZFwiKVxuICAgICAgICByZXR1cm47XG4gICAgICBjb25zdCByYW5nZURlY29yYXRpb25TdGF0ZSA9IFtdO1xuICAgICAgZm9yIChjb25zdCByYW5nZURlY29yYXRpb24gb2YgZXZlbnQucmFuZ2VEZWNvcmF0aW9ucykge1xuICAgICAgICBjb25zdCBzbGF0ZVJhbmdlID0gdG9TbGF0ZVJhbmdlKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hLFxuICAgICAgICAgICAgdmFsdWU6IGNvbnRleHQuc2xhdGVFZGl0b3IudmFsdWUsXG4gICAgICAgICAgICBzZWxlY3Rpb246IHJhbmdlRGVjb3JhdGlvbi5zZWxlY3Rpb25cbiAgICAgICAgICB9LFxuICAgICAgICAgIGJsb2NrSW5kZXhNYXA6IGNvbnRleHQuc2xhdGVFZGl0b3IuYmxvY2tJbmRleE1hcFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFSYW5nZS5pc1JhbmdlKHNsYXRlUmFuZ2UpKSB7XG4gICAgICAgICAgcmFuZ2VEZWNvcmF0aW9uLm9uTW92ZWQ/Lih7XG4gICAgICAgICAgICBuZXdTZWxlY3Rpb246IG51bGwsXG4gICAgICAgICAgICByYW5nZURlY29yYXRpb24sXG4gICAgICAgICAgICBvcmlnaW46IFwibG9jYWxcIlxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHJhbmdlRGVjb3JhdGlvblN0YXRlLnB1c2goe1xuICAgICAgICAgIHJhbmdlRGVjb3JhdGlvbixcbiAgICAgICAgICAuLi5zbGF0ZVJhbmdlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29udGV4dC5zbGF0ZUVkaXRvci5kZWNvcmF0ZWRSYW5nZXMgPSByYW5nZURlY29yYXRpb25TdGF0ZTtcbiAgICB9LFxuICAgIFwibW92ZSByYW5nZSBkZWNvcmF0aW9uc1wiOiAoe1xuICAgICAgY29udGV4dCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnR5cGUgIT09IFwic2xhdGUgb3BlcmF0aW9uXCIpXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNvbnN0IHJhbmdlRGVjb3JhdGlvblN0YXRlID0gW107XG4gICAgICBmb3IgKGNvbnN0IGRlY29yYXRlZFJhbmdlIG9mIGNvbnRleHQuc2xhdGVFZGl0b3IuZGVjb3JhdGVkUmFuZ2VzKSB7XG4gICAgICAgIGNvbnN0IHNsYXRlUmFuZ2UgPSB0b1NsYXRlUmFuZ2Uoe1xuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICAgICAgICB2YWx1ZTogY29udGV4dC5zbGF0ZUVkaXRvci52YWx1ZSxcbiAgICAgICAgICAgIHNlbGVjdGlvbjogZGVjb3JhdGVkUmFuZ2UucmFuZ2VEZWNvcmF0aW9uLnNlbGVjdGlvblxuICAgICAgICAgIH0sXG4gICAgICAgICAgYmxvY2tJbmRleE1hcDogY29udGV4dC5zbGF0ZUVkaXRvci5ibG9ja0luZGV4TWFwXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIVJhbmdlLmlzUmFuZ2Uoc2xhdGVSYW5nZSkpIHtcbiAgICAgICAgICBkZWNvcmF0ZWRSYW5nZS5yYW5nZURlY29yYXRpb24ub25Nb3ZlZD8uKHtcbiAgICAgICAgICAgIG5ld1NlbGVjdGlvbjogbnVsbCxcbiAgICAgICAgICAgIHJhbmdlRGVjb3JhdGlvbjogZGVjb3JhdGVkUmFuZ2UucmFuZ2VEZWNvcmF0aW9uLFxuICAgICAgICAgICAgb3JpZ2luOiBcImxvY2FsXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3UmFuZ2U7XG4gICAgICAgIGlmIChuZXdSYW5nZSA9IG1vdmVSYW5nZUJ5T3BlcmF0aW9uKHNsYXRlUmFuZ2UsIGV2ZW50Lm9wZXJhdGlvbiksIG5ld1JhbmdlICYmIG5ld1JhbmdlICE9PSBzbGF0ZVJhbmdlIHx8IG5ld1JhbmdlID09PSBudWxsICYmIHNsYXRlUmFuZ2UpIHtcbiAgICAgICAgICBjb25zdCBuZXdSYW5nZVNlbGVjdGlvbiA9IG5ld1JhbmdlID8gc2xhdGVSYW5nZVRvU2VsZWN0aW9uKHtcbiAgICAgICAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICAgICAgICBlZGl0b3I6IGNvbnRleHQuc2xhdGVFZGl0b3IsXG4gICAgICAgICAgICByYW5nZTogbmV3UmFuZ2VcbiAgICAgICAgICB9KSA6IG51bGw7XG4gICAgICAgICAgZGVjb3JhdGVkUmFuZ2UucmFuZ2VEZWNvcmF0aW9uLm9uTW92ZWQ/Lih7XG4gICAgICAgICAgICBuZXdTZWxlY3Rpb246IG5ld1JhbmdlU2VsZWN0aW9uLFxuICAgICAgICAgICAgcmFuZ2VEZWNvcmF0aW9uOiBkZWNvcmF0ZWRSYW5nZS5yYW5nZURlY29yYXRpb24sXG4gICAgICAgICAgICBvcmlnaW46IFwibG9jYWxcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIG5ld1JhbmdlICE9PSBudWxsICYmIHJhbmdlRGVjb3JhdGlvblN0YXRlLnB1c2goe1xuICAgICAgICAgIC4uLm5ld1JhbmdlIHx8IHNsYXRlUmFuZ2UsXG4gICAgICAgICAgcmFuZ2VEZWNvcmF0aW9uOiB7XG4gICAgICAgICAgICAuLi5kZWNvcmF0ZWRSYW5nZS5yYW5nZURlY29yYXRpb24sXG4gICAgICAgICAgICBzZWxlY3Rpb246IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgICAgICAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICAgICAgICAgIGVkaXRvcjogY29udGV4dC5zbGF0ZUVkaXRvcixcbiAgICAgICAgICAgICAgcmFuZ2U6IG5ld1JhbmdlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb250ZXh0LnNsYXRlRWRpdG9yLmRlY29yYXRlZFJhbmdlcyA9IHJhbmdlRGVjb3JhdGlvblN0YXRlO1xuICAgIH0sXG4gICAgXCJhc3NpZ24gcmVhZE9ubHlcIjogYXNzaWduKHtcbiAgICAgIHJlYWRPbmx5OiAoe1xuICAgICAgICBjb250ZXh0LFxuICAgICAgICBldmVudFxuICAgICAgfSkgPT4gZXZlbnQudHlwZSAhPT0gXCJ1cGRhdGUgcmVhZCBvbmx5XCIgPyBjb250ZXh0LnJlYWRPbmx5IDogZXZlbnQucmVhZE9ubHlcbiAgICB9KSxcbiAgICBcInVwZGF0ZSBkZWNvcmF0ZVwiOiBhc3NpZ24oe1xuICAgICAgZGVjb3JhdGU6ICh7XG4gICAgICAgIGNvbnRleHRcbiAgICAgIH0pID0+ICh7XG4gICAgICAgIGZuOiBjcmVhdGVEZWNvcmF0ZShjb250ZXh0LnNjaGVtYSwgY29udGV4dC5zbGF0ZUVkaXRvcilcbiAgICAgIH0pXG4gICAgfSlcbiAgfSxcbiAgYWN0b3JzOiB7XG4gICAgXCJzbGF0ZSBvcGVyYXRpb24gbGlzdGVuZXJcIjogZnJvbUNhbGxiYWNrKHNsYXRlT3BlcmF0aW9uQ2FsbGJhY2spXG4gIH0sXG4gIGd1YXJkczoge1xuICAgIFwiaGFzIHBlbmRpbmcgcmFuZ2UgZGVjb3JhdGlvbnNcIjogKHtcbiAgICAgIGNvbnRleHRcbiAgICB9KSA9PiBjb250ZXh0LnBlbmRpbmdSYW5nZURlY29yYXRpb25zLmxlbmd0aCA+IDAsXG4gICAgXCJoYXMgcmFuZ2UgZGVjb3JhdGlvbnNcIjogKHtcbiAgICAgIGNvbnRleHRcbiAgICB9KSA9PiBjb250ZXh0LnNsYXRlRWRpdG9yLmRlY29yYXRlZFJhbmdlcy5sZW5ndGggPiAwLFxuICAgIFwiaGFzIGRpZmZlcmVudCBkZWNvcmF0aW9uc1wiOiAoe1xuICAgICAgY29udGV4dCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnR5cGUgIT09IFwicmFuZ2UgZGVjb3JhdGlvbnMgdXBkYXRlZFwiKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBleGlzdGluZ1JhbmdlRGVjb3JhdGlvbnMgPSBjb250ZXh0LnNsYXRlRWRpdG9yLmRlY29yYXRlZFJhbmdlcy5tYXAoKGRlY29yYXRlZFJhbmdlKSA9PiAoe1xuICAgICAgICBhbmNob3I6IGRlY29yYXRlZFJhbmdlLnJhbmdlRGVjb3JhdGlvbi5zZWxlY3Rpb24/LmFuY2hvcixcbiAgICAgICAgZm9jdXM6IGRlY29yYXRlZFJhbmdlLnJhbmdlRGVjb3JhdGlvbi5zZWxlY3Rpb24/LmZvY3VzLFxuICAgICAgICBwYXlsb2FkOiBkZWNvcmF0ZWRSYW5nZS5yYW5nZURlY29yYXRpb24ucGF5bG9hZFxuICAgICAgfSkpLCBuZXdSYW5nZURlY29yYXRpb25zID0gZXZlbnQucmFuZ2VEZWNvcmF0aW9ucy5tYXAoKHJhbmdlRGVjb3JhdGlvbikgPT4gKHtcbiAgICAgICAgYW5jaG9yOiByYW5nZURlY29yYXRpb24uc2VsZWN0aW9uPy5hbmNob3IsXG4gICAgICAgIGZvY3VzOiByYW5nZURlY29yYXRpb24uc2VsZWN0aW9uPy5mb2N1cyxcbiAgICAgICAgcGF5bG9hZDogcmFuZ2VEZWNvcmF0aW9uLnBheWxvYWRcbiAgICAgIH0pKTtcbiAgICAgIHJldHVybiAhaXNEZWVwRXF1YWwoZXhpc3RpbmdSYW5nZURlY29yYXRpb25zLCBuZXdSYW5nZURlY29yYXRpb25zKTtcbiAgICB9LFxuICAgIFwibm90IHJlYWQgb25seVwiOiAoe1xuICAgICAgY29udGV4dFxuICAgIH0pID0+ICFjb250ZXh0LnJlYWRPbmx5LFxuICAgIFwic2hvdWxkIHNraXAgc2V0dXBcIjogKHtcbiAgICAgIGNvbnRleHRcbiAgICB9KSA9PiBjb250ZXh0LnNraXBTZXR1cFxuICB9XG59KS5jcmVhdGVNYWNoaW5lKHtcbiAgaWQ6IFwicmFuZ2UgZGVjb3JhdGlvbnNcIixcbiAgY29udGV4dDogKHtcbiAgICBpbnB1dFxuICB9KSA9PiAoe1xuICAgIHJlYWRPbmx5OiBpbnB1dC5yZWFkT25seSxcbiAgICBwZW5kaW5nUmFuZ2VEZWNvcmF0aW9uczogaW5wdXQucmFuZ2VEZWNvcmF0aW9ucyxcbiAgICBkZWNvcmF0ZWRSYW5nZXM6IFtdLFxuICAgIHNraXBTZXR1cDogaW5wdXQuc2tpcFNldHVwLFxuICAgIHNjaGVtYTogaW5wdXQuc2NoZW1hLFxuICAgIHNsYXRlRWRpdG9yOiBpbnB1dC5zbGF0ZUVkaXRvcixcbiAgICBkZWNvcmF0ZToge1xuICAgICAgZm46IGNyZWF0ZURlY29yYXRlKGlucHV0LnNjaGVtYSwgaW5wdXQuc2xhdGVFZGl0b3IpXG4gICAgfVxuICB9KSxcbiAgaW52b2tlOiB7XG4gICAgc3JjOiBcInNsYXRlIG9wZXJhdGlvbiBsaXN0ZW5lclwiLFxuICAgIGlucHV0OiAoe1xuICAgICAgY29udGV4dFxuICAgIH0pID0+ICh7XG4gICAgICBzbGF0ZUVkaXRvcjogY29udGV4dC5zbGF0ZUVkaXRvclxuICAgIH0pXG4gIH0sXG4gIG9uOiB7XG4gICAgXCJ1cGRhdGUgcmVhZCBvbmx5XCI6IHtcbiAgICAgIGFjdGlvbnM6IFtcImFzc2lnbiByZWFkT25seVwiXVxuICAgIH1cbiAgfSxcbiAgaW5pdGlhbDogXCJzZXR0aW5nIHVwXCIsXG4gIHN0YXRlczoge1xuICAgIFwic2V0dGluZyB1cFwiOiB7XG4gICAgICBhbHdheXM6IFt7XG4gICAgICAgIGd1YXJkOiBhbmQoW1wic2hvdWxkIHNraXAgc2V0dXBcIiwgXCJoYXMgcGVuZGluZyByYW5nZSBkZWNvcmF0aW9uc1wiXSksXG4gICAgICAgIHRhcmdldDogXCJyZWFkeVwiLFxuICAgICAgICBhY3Rpb25zOiBbXCJzZXQgdXAgaW5pdGlhbCByYW5nZSBkZWNvcmF0aW9uc1wiLCBcInVwZGF0ZSBkZWNvcmF0ZVwiXVxuICAgICAgfSwge1xuICAgICAgICBndWFyZDogXCJzaG91bGQgc2tpcCBzZXR1cFwiLFxuICAgICAgICB0YXJnZXQ6IFwicmVhZHlcIlxuICAgICAgfV0sXG4gICAgICBvbjoge1xuICAgICAgICBcInJhbmdlIGRlY29yYXRpb25zIHVwZGF0ZWRcIjoge1xuICAgICAgICAgIGFjdGlvbnM6IFtcInVwZGF0ZSBwZW5kaW5nIHJhbmdlIGRlY29yYXRpb25zXCJdXG4gICAgICAgIH0sXG4gICAgICAgIHJlYWR5OiBbe1xuICAgICAgICAgIHRhcmdldDogXCJyZWFkeVwiLFxuICAgICAgICAgIGd1YXJkOiBcImhhcyBwZW5kaW5nIHJhbmdlIGRlY29yYXRpb25zXCIsXG4gICAgICAgICAgYWN0aW9uczogW1wic2V0IHVwIGluaXRpYWwgcmFuZ2UgZGVjb3JhdGlvbnNcIiwgXCJ1cGRhdGUgZGVjb3JhdGVcIl1cbiAgICAgICAgfSwge1xuICAgICAgICAgIHRhcmdldDogXCJyZWFkeVwiXG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfSxcbiAgICByZWFkeToge1xuICAgICAgaW5pdGlhbDogXCJpZGxlXCIsXG4gICAgICBvbjoge1xuICAgICAgICBcInJhbmdlIGRlY29yYXRpb25zIHVwZGF0ZWRcIjoge1xuICAgICAgICAgIHRhcmdldDogXCIuaWRsZVwiLFxuICAgICAgICAgIGd1YXJkOiBcImhhcyBkaWZmZXJlbnQgZGVjb3JhdGlvbnNcIixcbiAgICAgICAgICBhY3Rpb25zOiBbXCJ1cGRhdGUgcmFuZ2UgZGVjb3JhdGlvbnNcIiwgXCJ1cGRhdGUgZGVjb3JhdGVcIl1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHN0YXRlczoge1xuICAgICAgICBpZGxlOiB7XG4gICAgICAgICAgb246IHtcbiAgICAgICAgICAgIFwic2xhdGUgb3BlcmF0aW9uXCI6IHtcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcIm1vdmluZyByYW5nZSBkZWNvcmF0aW9uc1wiLFxuICAgICAgICAgICAgICBndWFyZDogYW5kKFtcImhhcyByYW5nZSBkZWNvcmF0aW9uc1wiLCBcIm5vdCByZWFkIG9ubHlcIl0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcIm1vdmluZyByYW5nZSBkZWNvcmF0aW9uc1wiOiB7XG4gICAgICAgICAgZW50cnk6IFtcIm1vdmUgcmFuZ2UgZGVjb3JhdGlvbnNcIl0sXG4gICAgICAgICAgYWx3YXlzOiB7XG4gICAgICAgICAgICB0YXJnZXQ6IFwiaWRsZVwiXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcbmZ1bmN0aW9uIGNyZWF0ZURlY29yYXRlKHNjaGVtYSwgc2xhdGVFZGl0b3IpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKFtub2RlLCBwYXRoXSkge1xuICAgIGNvbnN0IGRlZmF1bHRTdHlsZSA9IHNjaGVtYS5zdHlsZXMuYXQoMCk/Lm5hbWU7XG4gICAgaWYgKHNsYXRlRWRpdG9yLnZhbHVlLmxlbmd0aCA9PT0gMSAmJiBpc0VtcHR5VGV4dEJsb2NrKHtcbiAgICAgIHNjaGVtYVxuICAgIH0sIHNsYXRlRWRpdG9yLnZhbHVlWzBdKSAmJiAoIXNsYXRlRWRpdG9yLnZhbHVlWzBdLnN0eWxlIHx8IHNsYXRlRWRpdG9yLnZhbHVlWzBdLnN0eWxlID09PSBkZWZhdWx0U3R5bGUpICYmICFzbGF0ZUVkaXRvci52YWx1ZVswXS5saXN0SXRlbSlcbiAgICAgIHJldHVybiBbe1xuICAgICAgICBhbmNob3I6IHtcbiAgICAgICAgICBwYXRoOiBbMCwgMF0sXG4gICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgcGF0aDogWzAsIDBdLFxuICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICB9LFxuICAgICAgICBwbGFjZWhvbGRlcjogITBcbiAgICAgIH1dO1xuICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMClcbiAgICAgIHJldHVybiBbXTtcbiAgICBpZiAoIUVsZW1lbnQkMS5pc0VsZW1lbnQobm9kZSkgfHwgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDApXG4gICAgICByZXR1cm4gW107XG4gICAgY29uc3QgYmxvY2tJbmRleCA9IHBhdGguYXQoMCk7XG4gICAgcmV0dXJuIGJsb2NrSW5kZXggPT09IHZvaWQgMCA/IFtdIDogc2xhdGVFZGl0b3IuZGVjb3JhdGVkUmFuZ2VzLmZpbHRlcigoZGVjb3JhdGVkUmFuZ2UpID0+IFJhbmdlLmlzQ29sbGFwc2VkKGRlY29yYXRlZFJhbmdlKSA/IG5vZGUuY2hpbGRyZW4uc29tZSgoXywgY2hpbGRJbmRleCkgPT4gUGF0aC5lcXVhbHMoZGVjb3JhdGVkUmFuZ2UuYW5jaG9yLnBhdGgsIFtibG9ja0luZGV4LCBjaGlsZEluZGV4XSkgJiYgUGF0aC5lcXVhbHMoZGVjb3JhdGVkUmFuZ2UuZm9jdXMucGF0aCwgW2Jsb2NrSW5kZXgsIGNoaWxkSW5kZXhdKSkgOiBSYW5nZS5pbnRlcnNlY3Rpb24oZGVjb3JhdGVkUmFuZ2UsIHtcbiAgICAgIGFuY2hvcjoge1xuICAgICAgICBwYXRoLFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH0sXG4gICAgICBmb2N1czoge1xuICAgICAgICBwYXRoLFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH1cbiAgICB9KSB8fCBSYW5nZS5pbmNsdWRlcyhkZWNvcmF0ZWRSYW5nZSwgcGF0aCkpO1xuICB9O1xufVxuY29uc3QgUmVsYXlBY3RvckNvbnRleHQgPSBjcmVhdGVDb250ZXh0KHt9KTtcbmZ1bmN0aW9uIFJlbmRlckRlZmF1bHRCbG9ja09iamVjdChwcm9wcykge1xuICBjb25zdCAkID0gYyg0KTtcbiAgbGV0IHQwO1xuICAkWzBdID09PSAvKiBAX19QVVJFX18gKi8gU3ltYm9sLmZvcihcInJlYWN0Lm1lbW9fY2FjaGVfc2VudGluZWxcIikgPyAodDAgPSB7XG4gICAgdXNlclNlbGVjdDogXCJub25lXCJcbiAgfSwgJFswXSA9IHQwKSA6IHQwID0gJFswXTtcbiAgbGV0IHQxO1xuICByZXR1cm4gJFsxXSAhPT0gcHJvcHMuYmxvY2tPYmplY3QuX2tleSB8fCAkWzJdICE9PSBwcm9wcy5ibG9ja09iamVjdC5fdHlwZSA/ICh0MSA9IC8qIEBfX1BVUkVfXyAqLyBqc3hzKFwiZGl2XCIsIHsgc3R5bGU6IHQwLCBjaGlsZHJlbjogW1xuICAgIFwiW1wiLFxuICAgIHByb3BzLmJsb2NrT2JqZWN0Ll90eXBlLFxuICAgIFwiOiBcIixcbiAgICBwcm9wcy5ibG9ja09iamVjdC5fa2V5LFxuICAgIFwiXVwiXG4gIF0gfSksICRbMV0gPSBwcm9wcy5ibG9ja09iamVjdC5fa2V5LCAkWzJdID0gcHJvcHMuYmxvY2tPYmplY3QuX3R5cGUsICRbM10gPSB0MSkgOiB0MSA9ICRbM10sIHQxO1xufVxuZnVuY3Rpb24gUmVuZGVyRGVmYXVsdElubGluZU9iamVjdChwcm9wcykge1xuICBjb25zdCAkID0gYyg0KTtcbiAgbGV0IHQwO1xuICAkWzBdID09PSAvKiBAX19QVVJFX18gKi8gU3ltYm9sLmZvcihcInJlYWN0Lm1lbW9fY2FjaGVfc2VudGluZWxcIikgPyAodDAgPSB7XG4gICAgdXNlclNlbGVjdDogXCJub25lXCJcbiAgfSwgJFswXSA9IHQwKSA6IHQwID0gJFswXTtcbiAgbGV0IHQxO1xuICByZXR1cm4gJFsxXSAhPT0gcHJvcHMuaW5saW5lT2JqZWN0Ll9rZXkgfHwgJFsyXSAhPT0gcHJvcHMuaW5saW5lT2JqZWN0Ll90eXBlID8gKHQxID0gLyogQF9fUFVSRV9fICovIGpzeHMoXCJzcGFuXCIsIHsgc3R5bGU6IHQwLCBjaGlsZHJlbjogW1xuICAgIFwiW1wiLFxuICAgIHByb3BzLmlubGluZU9iamVjdC5fdHlwZSxcbiAgICBcIjogXCIsXG4gICAgcHJvcHMuaW5saW5lT2JqZWN0Ll9rZXksXG4gICAgXCJdXCJcbiAgXSB9KSwgJFsxXSA9IHByb3BzLmlubGluZU9iamVjdC5fa2V5LCAkWzJdID0gcHJvcHMuaW5saW5lT2JqZWN0Ll90eXBlLCAkWzNdID0gdDEpIDogdDEgPSAkWzNdLCB0MTtcbn1cbmZ1bmN0aW9uIERyb3BJbmRpY2F0b3IoKSB7XG4gIGNvbnN0ICQgPSBjKDEpO1xuICBsZXQgdDA7XG4gIHJldHVybiAkWzBdID09PSAvKiBAX19QVVJFX18gKi8gU3ltYm9sLmZvcihcInJlYWN0Lm1lbW9fY2FjaGVfc2VudGluZWxcIikgPyAodDAgPSAvKiBAX19QVVJFX18gKi8ganN4KFwiZGl2XCIsIHsgY29udGVudEVkaXRhYmxlOiAhMSwgY2xhc3NOYW1lOiBcInB0LWRyb3AtaW5kaWNhdG9yXCIsIHN0eWxlOiB7XG4gICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgaGVpZ2h0OiAxLFxuICAgIGJvcmRlckJvdHRvbTogXCIxcHggc29saWQgY3VycmVudENvbG9yXCIsXG4gICAgekluZGV4OiA1XG4gIH0sIGNoaWxkcmVuOiAvKiBAX19QVVJFX18gKi8ganN4KFwic3BhblwiLCB7fSkgfSksICRbMF0gPSB0MCkgOiB0MCA9ICRbMF0sIHQwO1xufVxuZnVuY3Rpb24gY3JlYXRlRWRpdG9yUHJpb3JpdHkoY29uZmlnKSB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGRlZmF1bHRLZXlHZW5lcmF0b3IoKSxcbiAgICBuYW1lOiBjb25maWc/Lm5hbWUsXG4gICAgcmVmZXJlbmNlOiBjb25maWc/LnJlZmVyZW5jZVxuICB9O1xufVxuY29uc3QgY29yZVByaW9yaXR5ID0gY3JlYXRlRWRpdG9yUHJpb3JpdHkoe1xuICBuYW1lOiBcImNvcmVcIlxufSk7XG5mdW5jdGlvbiBnZXREcmFnU2VsZWN0aW9uKHtcbiAgZXZlbnRTZWxlY3Rpb24sXG4gIHNuYXBzaG90XG59KSB7XG4gIGxldCBkcmFnU2VsZWN0aW9uID0gZXZlbnRTZWxlY3Rpb247XG4gIGlmIChnZXRGb2N1c0lubGluZU9iamVjdCh7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvbjogZXZlbnRTZWxlY3Rpb25cbiAgICB9XG4gIH0pKVxuICAgIHJldHVybiBkcmFnU2VsZWN0aW9uO1xuICBjb25zdCBkcmFnZ2luZ0NvbGxhcHNlZFNlbGVjdGlvbiA9IGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoe1xuICAgIGNvbnRleHQ6IHtcbiAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICBzZWxlY3Rpb246IGV2ZW50U2VsZWN0aW9uXG4gICAgfVxuICB9KSwgZHJhZ2dlZFRleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHtcbiAgICAuLi5zbmFwc2hvdCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uOiBldmVudFNlbGVjdGlvblxuICAgIH1cbiAgfSksIGRyYWdnZWRTcGFuID0gZ2V0Rm9jdXNTcGFuJDEoe1xuICAgIC4uLnNuYXBzaG90LFxuICAgIGNvbnRleHQ6IHtcbiAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICBzZWxlY3Rpb246IGV2ZW50U2VsZWN0aW9uXG4gICAgfVxuICB9KTtcbiAgZHJhZ2dpbmdDb2xsYXBzZWRTZWxlY3Rpb24gJiYgZHJhZ2dlZFRleHRCbG9jayAmJiBkcmFnZ2VkU3BhbiAmJiAoZHJhZ1NlbGVjdGlvbiA9IHtcbiAgICBhbmNob3I6IGdldEJsb2NrU3RhcnRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2s6IGRyYWdnZWRUZXh0QmxvY2tcbiAgICB9KSxcbiAgICBmb2N1czogZ2V0QmxvY2tFbmRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2s6IGRyYWdnZWRUZXh0QmxvY2tcbiAgICB9KVxuICB9KTtcbiAgY29uc3Qgc2VsZWN0ZWRCbG9ja3MgPSBnZXRTZWxlY3RlZEJsb2NrcyhzbmFwc2hvdCk7XG4gIGlmIChzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiAmJiBpc1NlbGVjdGlvbkV4cGFuZGVkKHNuYXBzaG90KSAmJiBzZWxlY3RlZEJsb2Nrcy5sZW5ndGggPiAxKSB7XG4gICAgY29uc3Qgc2VsZWN0aW9uU3RhcnRCbG9jayA9IGdldFNlbGVjdGlvblN0YXJ0QmxvY2soc25hcHNob3QpLCBzZWxlY3Rpb25FbmRCbG9jayA9IGdldFNlbGVjdGlvbkVuZEJsb2NrKHNuYXBzaG90KTtcbiAgICBpZiAoIXNlbGVjdGlvblN0YXJ0QmxvY2sgfHwgIXNlbGVjdGlvbkVuZEJsb2NrKVxuICAgICAgcmV0dXJuIGRyYWdTZWxlY3Rpb247XG4gICAgY29uc3Qgc2VsZWN0aW9uU3RhcnRQb2ludCA9IGdldEJsb2NrU3RhcnRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2s6IHNlbGVjdGlvblN0YXJ0QmxvY2tcbiAgICB9KSwgc2VsZWN0aW9uRW5kUG9pbnQgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICBibG9jazogc2VsZWN0aW9uRW5kQmxvY2tcbiAgICB9KTtcbiAgICBpc092ZXJsYXBwaW5nU2VsZWN0aW9uKGV2ZW50U2VsZWN0aW9uKSh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiBzZWxlY3Rpb25TdGFydFBvaW50LFxuICAgICAgICAgIGZvY3VzOiBzZWxlY3Rpb25FbmRQb2ludFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSkgJiYgKGRyYWdTZWxlY3Rpb24gPSB7XG4gICAgICBhbmNob3I6IHNlbGVjdGlvblN0YXJ0UG9pbnQsXG4gICAgICBmb2N1czogc2VsZWN0aW9uRW5kUG9pbnRcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gZHJhZ1NlbGVjdGlvbjtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUNvcmVCbG9ja0VsZW1lbnRCZWhhdmlvcnNDb25maWcoe1xuICBrZXksXG4gIG9uU2V0RHJhZ1Bvc2l0aW9uQmxvY2tcbn0pIHtcbiAgcmV0dXJuIFt7XG4gICAgYmVoYXZpb3I6IGRlZmluZUJlaGF2aW9yKHtcbiAgICAgIG9uOiBcImRyYWcuZHJhZ292ZXJcIixcbiAgICAgIGd1YXJkOiAoe1xuICAgICAgICBzbmFwc2hvdCxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IHtcbiAgICAgICAgY29uc3QgZHJvcEZvY3VzQmxvY2sgPSBnZXRGb2N1c0Jsb2NrJDEoe1xuICAgICAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgICBzZWxlY3Rpb246IGV2ZW50LnBvc2l0aW9uLnNlbGVjdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghZHJvcEZvY3VzQmxvY2sgfHwgZHJvcEZvY3VzQmxvY2subm9kZS5fa2V5ICE9PSBrZXkpXG4gICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBkcmFnT3JpZ2luID0gZXZlbnQuZHJhZ09yaWdpbjtcbiAgICAgICAgaWYgKCFkcmFnT3JpZ2luKVxuICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgZHJhZ1NlbGVjdGlvbiA9IGdldERyYWdTZWxlY3Rpb24oe1xuICAgICAgICAgIGV2ZW50U2VsZWN0aW9uOiBkcmFnT3JpZ2luLnNlbGVjdGlvbixcbiAgICAgICAgICBzbmFwc2hvdFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGdldFNlbGVjdGVkQmxvY2tzKHtcbiAgICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICAgICAgc2VsZWN0aW9uOiBkcmFnU2VsZWN0aW9uXG4gICAgICAgICAgfVxuICAgICAgICB9KS5zb21lKChkcmFnZ2VkQmxvY2spID0+IGRyYWdnZWRCbG9jay5ub2RlLl9rZXkgPT09IGtleSkgPyAhMSA6IGlzU2VsZWN0aW5nRW50aXJlQmxvY2tzKHtcbiAgICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICAgICAgc2VsZWN0aW9uOiBkcmFnU2VsZWN0aW9uXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBhY3Rpb25zOiBbKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IFt7XG4gICAgICAgIHR5cGU6IFwiZWZmZWN0XCIsXG4gICAgICAgIGVmZmVjdDogKCkgPT4ge1xuICAgICAgICAgIG9uU2V0RHJhZ1Bvc2l0aW9uQmxvY2soZXZlbnQucG9zaXRpb24uYmxvY2spO1xuICAgICAgICB9XG4gICAgICB9XV1cbiAgICB9KSxcbiAgICBwcmlvcml0eTogY3JlYXRlRWRpdG9yUHJpb3JpdHkoe1xuICAgICAgcmVmZXJlbmNlOiB7XG4gICAgICAgIHByaW9yaXR5OiBjb3JlUHJpb3JpdHksXG4gICAgICAgIGltcG9ydGFuY2U6IFwibG93ZXJcIlxuICAgICAgfVxuICAgIH0pXG4gIH0sIHtcbiAgICBiZWhhdmlvcjogZGVmaW5lQmVoYXZpb3Ioe1xuICAgICAgb246IFwiZHJhZy4qXCIsXG4gICAgICBndWFyZDogKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IGV2ZW50LnR5cGUgIT09IFwiZHJhZy5kcmFnb3ZlclwiLFxuICAgICAgYWN0aW9uczogWyh7XG4gICAgICAgIGV2ZW50XG4gICAgICB9KSA9PiBbe1xuICAgICAgICB0eXBlOiBcImVmZmVjdFwiLFxuICAgICAgICBlZmZlY3Q6ICgpID0+IHtcbiAgICAgICAgICBvblNldERyYWdQb3NpdGlvbkJsb2NrKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgIH0sIGZvcndhcmQoZXZlbnQpXV1cbiAgICB9KSxcbiAgICBwcmlvcml0eTogY3JlYXRlRWRpdG9yUHJpb3JpdHkoe1xuICAgICAgcmVmZXJlbmNlOiB7XG4gICAgICAgIHByaW9yaXR5OiBjb3JlUHJpb3JpdHksXG4gICAgICAgIGltcG9ydGFuY2U6IFwibG93ZXJcIlxuICAgICAgfVxuICAgIH0pXG4gIH1dO1xufVxuZnVuY3Rpb24gdXNlQ29yZUJsb2NrRWxlbWVudEJlaGF2aW9ycyh0MCkge1xuICBjb25zdCAkID0gYyg1KSwge1xuICAgIGtleSxcbiAgICBvblNldERyYWdQb3NpdGlvbkJsb2NrXG4gIH0gPSB0MCwgZWRpdG9yQWN0b3IgPSB1c2VDb250ZXh0KEVkaXRvckFjdG9yQ29udGV4dCk7XG4gIGxldCB0MSwgdDI7XG4gICRbMF0gIT09IGVkaXRvckFjdG9yIHx8ICRbMV0gIT09IGtleSB8fCAkWzJdICE9PSBvblNldERyYWdQb3NpdGlvbkJsb2NrID8gKHQxID0gKCkgPT4ge1xuICAgIGNvbnN0IGJlaGF2aW9yQ29uZmlncyA9IGNyZWF0ZUNvcmVCbG9ja0VsZW1lbnRCZWhhdmlvcnNDb25maWcoe1xuICAgICAga2V5LFxuICAgICAgb25TZXREcmFnUG9zaXRpb25CbG9ja1xuICAgIH0pO1xuICAgIGZvciAoY29uc3QgYmVoYXZpb3JDb25maWcgb2YgYmVoYXZpb3JDb25maWdzKVxuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYWRkIGJlaGF2aW9yXCIsXG4gICAgICAgIGJlaGF2aW9yQ29uZmlnXG4gICAgICB9KTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBiZWhhdmlvckNvbmZpZ18wIG9mIGJlaGF2aW9yQ29uZmlncylcbiAgICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgICAgdHlwZTogXCJyZW1vdmUgYmVoYXZpb3JcIixcbiAgICAgICAgICBiZWhhdmlvckNvbmZpZzogYmVoYXZpb3JDb25maWdfMFxuICAgICAgICB9KTtcbiAgICB9O1xuICB9LCB0MiA9IFtlZGl0b3JBY3Rvciwga2V5LCBvblNldERyYWdQb3NpdGlvbkJsb2NrXSwgJFswXSA9IGVkaXRvckFjdG9yLCAkWzFdID0ga2V5LCAkWzJdID0gb25TZXREcmFnUG9zaXRpb25CbG9jaywgJFszXSA9IHQxLCAkWzRdID0gdDIpIDogKHQxID0gJFszXSwgdDIgPSAkWzRdKSwgdXNlRWZmZWN0KHQxLCB0Mik7XG59XG5mdW5jdGlvbiBSZW5kZXJCbG9ja09iamVjdChwcm9wcykge1xuICBjb25zdCAkID0gYygzNSksIFtkcmFnUG9zaXRpb25CbG9jaywgc2V0RHJhZ1Bvc2l0aW9uQmxvY2tdID0gdXNlU3RhdGUoKSwgYmxvY2tPYmplY3RSZWYgPSB1c2VSZWYobnVsbCksIHNlbGVjdGVkID0gdXNlU2VsZWN0ZWQoKTtcbiAgbGV0IHQwO1xuICAkWzBdICE9PSBzZWxlY3RlZCA/ICh0MCA9IChlZGl0b3IpID0+IHNlbGVjdGVkICYmIGVkaXRvci5zZWxlY3Rpb24gIT09IG51bGwgJiYgUmFuZ2UuaXNDb2xsYXBzZWQoZWRpdG9yLnNlbGVjdGlvbiksICRbMF0gPSBzZWxlY3RlZCwgJFsxXSA9IHQwKSA6IHQwID0gJFsxXTtcbiAgY29uc3QgZm9jdXNlZCA9IHVzZVNsYXRlU2VsZWN0b3IodDApO1xuICBsZXQgdDE7XG4gICRbMl0gIT09IHByb3BzLmVsZW1lbnQuX2tleSA/ICh0MSA9IHtcbiAgICBrZXk6IHByb3BzLmVsZW1lbnQuX2tleSxcbiAgICBvblNldERyYWdQb3NpdGlvbkJsb2NrOiBzZXREcmFnUG9zaXRpb25CbG9ja1xuICB9LCAkWzJdID0gcHJvcHMuZWxlbWVudC5fa2V5LCAkWzNdID0gdDEpIDogdDEgPSAkWzNdLCB1c2VDb3JlQmxvY2tFbGVtZW50QmVoYXZpb3JzKHQxKTtcbiAgbGV0IHQyO1xuICBpZiAoJFs0XSAhPT0gcHJvcHMuZWxlbWVudC5fdHlwZSB8fCAkWzVdICE9PSBwcm9wcy5sZWdhY3lTY2hlbWEuYmxvY2tPYmplY3RzKSB7XG4gICAgbGV0IHQzMjtcbiAgICAkWzddICE9PSBwcm9wcy5lbGVtZW50Ll90eXBlID8gKHQzMiA9IChzY2hlbWFUeXBlKSA9PiBzY2hlbWFUeXBlLm5hbWUgPT09IHByb3BzLmVsZW1lbnQuX3R5cGUsICRbN10gPSBwcm9wcy5lbGVtZW50Ll90eXBlLCAkWzhdID0gdDMyKSA6IHQzMiA9ICRbOF0sIHQyID0gcHJvcHMubGVnYWN5U2NoZW1hLmJsb2NrT2JqZWN0cy5maW5kKHQzMiksICRbNF0gPSBwcm9wcy5lbGVtZW50Ll90eXBlLCAkWzVdID0gcHJvcHMubGVnYWN5U2NoZW1hLmJsb2NrT2JqZWN0cywgJFs2XSA9IHQyO1xuICB9IGVsc2VcbiAgICB0MiA9ICRbNl07XG4gIGNvbnN0IGxlZ2FjeVNjaGVtYVR5cGUgPSB0MjtcbiAgbGVnYWN5U2NoZW1hVHlwZSB8fCBjb25zb2xlLmVycm9yKGBVbmFibGUgdG8gZmluZCBCbG9jayBPYmplY3QgXCIke3Byb3BzLmVsZW1lbnQuX3R5cGV9XCIgaW4gU2NoZW1hYCk7XG4gIGxldCB0MztcbiAgJFs5XSAhPT0gcHJvcHMuYmxvY2tPYmplY3QgfHwgJFsxMF0gIT09IHByb3BzLmVsZW1lbnQuX2tleSB8fCAkWzExXSAhPT0gcHJvcHMuZWxlbWVudC5fdHlwZSA/ICh0MyA9IHByb3BzLmJsb2NrT2JqZWN0ID8/IHtcbiAgICBfa2V5OiBwcm9wcy5lbGVtZW50Ll9rZXksXG4gICAgX3R5cGU6IHByb3BzLmVsZW1lbnQuX3R5cGVcbiAgfSwgJFs5XSA9IHByb3BzLmJsb2NrT2JqZWN0LCAkWzEwXSA9IHByb3BzLmVsZW1lbnQuX2tleSwgJFsxMV0gPSBwcm9wcy5lbGVtZW50Ll90eXBlLCAkWzEyXSA9IHQzKSA6IHQzID0gJFsxMl07XG4gIGNvbnN0IGJsb2NrT2JqZWN0ID0gdDM7XG4gIGxldCB0NDtcbiAgJFsxM10gIT09IGRyYWdQb3NpdGlvbkJsb2NrID8gKHQ0ID0gZHJhZ1Bvc2l0aW9uQmxvY2sgPT09IFwic3RhcnRcIiA/IC8qIEBfX1BVUkVfXyAqLyBqc3goRHJvcEluZGljYXRvciwge30pIDogbnVsbCwgJFsxM10gPSBkcmFnUG9zaXRpb25CbG9jaywgJFsxNF0gPSB0NCkgOiB0NCA9ICRbMTRdO1xuICBjb25zdCB0NSA9ICFwcm9wcy5yZWFkT25seTtcbiAgbGV0IHQ2O1xuICAkWzE1XSAhPT0gYmxvY2tPYmplY3QgfHwgJFsxNl0gIT09IGZvY3VzZWQgfHwgJFsxN10gIT09IGxlZ2FjeVNjaGVtYVR5cGUgfHwgJFsxOF0gIT09IHByb3BzLmVsZW1lbnQuX2tleSB8fCAkWzE5XSAhPT0gcHJvcHMucmVuZGVyQmxvY2sgfHwgJFsyMF0gIT09IHNlbGVjdGVkID8gKHQ2ID0gcHJvcHMucmVuZGVyQmxvY2sgJiYgbGVnYWN5U2NoZW1hVHlwZSA/IC8qIEBfX1BVUkVfXyAqLyBqc3goUmVuZGVyQmxvY2skMSwgeyByZW5kZXJCbG9jazogcHJvcHMucmVuZGVyQmxvY2ssIGVkaXRvckVsZW1lbnRSZWY6IGJsb2NrT2JqZWN0UmVmLCBmb2N1c2VkLCBwYXRoOiBbe1xuICAgIF9rZXk6IHByb3BzLmVsZW1lbnQuX2tleVxuICB9XSwgc2NoZW1hVHlwZTogbGVnYWN5U2NoZW1hVHlwZSwgc2VsZWN0ZWQsIHR5cGU6IGxlZ2FjeVNjaGVtYVR5cGUsIHZhbHVlOiBibG9ja09iamVjdCwgY2hpbGRyZW46IC8qIEBfX1BVUkVfXyAqLyBqc3goUmVuZGVyRGVmYXVsdEJsb2NrT2JqZWN0LCB7IGJsb2NrT2JqZWN0IH0pIH0pIDogLyogQF9fUFVSRV9fICovIGpzeChSZW5kZXJEZWZhdWx0QmxvY2tPYmplY3QsIHsgYmxvY2tPYmplY3QgfSksICRbMTVdID0gYmxvY2tPYmplY3QsICRbMTZdID0gZm9jdXNlZCwgJFsxN10gPSBsZWdhY3lTY2hlbWFUeXBlLCAkWzE4XSA9IHByb3BzLmVsZW1lbnQuX2tleSwgJFsxOV0gPSBwcm9wcy5yZW5kZXJCbG9jaywgJFsyMF0gPSBzZWxlY3RlZCwgJFsyMV0gPSB0NikgOiB0NiA9ICRbMjFdO1xuICBsZXQgdDc7XG4gICRbMjJdICE9PSB0NSB8fCAkWzIzXSAhPT0gdDYgPyAodDcgPSAvKiBAX19QVVJFX18gKi8ganN4KFwiZGl2XCIsIHsgcmVmOiBibG9ja09iamVjdFJlZiwgY29udGVudEVkaXRhYmxlOiAhMSwgZHJhZ2dhYmxlOiB0NSwgY2hpbGRyZW46IHQ2IH0pLCAkWzIyXSA9IHQ1LCAkWzIzXSA9IHQ2LCAkWzI0XSA9IHQ3KSA6IHQ3ID0gJFsyNF07XG4gIGxldCB0ODtcbiAgJFsyNV0gIT09IGRyYWdQb3NpdGlvbkJsb2NrID8gKHQ4ID0gZHJhZ1Bvc2l0aW9uQmxvY2sgPT09IFwiZW5kXCIgPyAvKiBAX19QVVJFX18gKi8ganN4KERyb3BJbmRpY2F0b3IsIHt9KSA6IG51bGwsICRbMjVdID0gZHJhZ1Bvc2l0aW9uQmxvY2ssICRbMjZdID0gdDgpIDogdDggPSAkWzI2XTtcbiAgbGV0IHQ5O1xuICByZXR1cm4gJFsyN10gIT09IHByb3BzLmF0dHJpYnV0ZXMgfHwgJFsyOF0gIT09IHByb3BzLmNoaWxkcmVuIHx8ICRbMjldICE9PSBwcm9wcy5lbGVtZW50Ll9rZXkgfHwgJFszMF0gIT09IHByb3BzLmVsZW1lbnQuX3R5cGUgfHwgJFszMV0gIT09IHQ0IHx8ICRbMzJdICE9PSB0NyB8fCAkWzMzXSAhPT0gdDggPyAodDkgPSAvKiBAX19QVVJFX18gKi8ganN4cyhcImRpdlwiLCB7IC4uLnByb3BzLmF0dHJpYnV0ZXMsIGNsYXNzTmFtZTogXCJwdC1ibG9jayBwdC1vYmplY3QtYmxvY2tcIiwgXCJkYXRhLWJsb2NrLWtleVwiOiBwcm9wcy5lbGVtZW50Ll9rZXksIFwiZGF0YS1ibG9jay1uYW1lXCI6IHByb3BzLmVsZW1lbnQuX3R5cGUsIFwiZGF0YS1ibG9jay10eXBlXCI6IFwib2JqZWN0XCIsIGNoaWxkcmVuOiBbXG4gICAgdDQsXG4gICAgcHJvcHMuY2hpbGRyZW4sXG4gICAgdDcsXG4gICAgdDhcbiAgXSB9KSwgJFsyN10gPSBwcm9wcy5hdHRyaWJ1dGVzLCAkWzI4XSA9IHByb3BzLmNoaWxkcmVuLCAkWzI5XSA9IHByb3BzLmVsZW1lbnQuX2tleSwgJFszMF0gPSBwcm9wcy5lbGVtZW50Ll90eXBlLCAkWzMxXSA9IHQ0LCAkWzMyXSA9IHQ3LCAkWzMzXSA9IHQ4LCAkWzM0XSA9IHQ5KSA6IHQ5ID0gJFszNF0sIHQ5O1xufVxuZnVuY3Rpb24gUmVuZGVyQmxvY2skMSh7XG4gIHJlbmRlckJsb2NrLFxuICBjaGlsZHJlbixcbiAgZWRpdG9yRWxlbWVudFJlZixcbiAgZm9jdXNlZCxcbiAgcGF0aCxcbiAgc2NoZW1hVHlwZSxcbiAgc2VsZWN0ZWQsXG4gIHR5cGUsXG4gIHZhbHVlXG59KSB7XG4gIHJldHVybiByZW5kZXJCbG9jayh7XG4gICAgY2hpbGRyZW4sXG4gICAgZWRpdG9yRWxlbWVudFJlZixcbiAgICBmb2N1c2VkLFxuICAgIHBhdGgsXG4gICAgc2NoZW1hVHlwZSxcbiAgICBzZWxlY3RlZCxcbiAgICB0eXBlLFxuICAgIHZhbHVlXG4gIH0pO1xufVxuZnVuY3Rpb24gUmVuZGVySW5saW5lT2JqZWN0KHByb3BzKSB7XG4gIGNvbnN0ICQgPSBjKDMyKSwgaW5saW5lT2JqZWN0UmVmID0gdXNlUmVmKG51bGwpLCBzbGF0ZUVkaXRvciA9IHVzZVNsYXRlU3RhdGljKCksIHNlbGVjdGVkID0gdXNlU2VsZWN0ZWQoKTtcbiAgbGV0IHQwO1xuICAkWzBdICE9PSBzZWxlY3RlZCA/ICh0MCA9IChlZGl0b3IpID0+IHNlbGVjdGVkICYmIGVkaXRvci5zZWxlY3Rpb24gIT09IG51bGwgJiYgUmFuZ2UuaXNDb2xsYXBzZWQoZWRpdG9yLnNlbGVjdGlvbiksICRbMF0gPSBzZWxlY3RlZCwgJFsxXSA9IHQwKSA6IHQwID0gJFsxXTtcbiAgY29uc3QgZm9jdXNlZCA9IHVzZVNsYXRlU2VsZWN0b3IodDApO1xuICBsZXQgdDE7XG4gIGlmICgkWzJdICE9PSBwcm9wcy5lbGVtZW50Ll90eXBlIHx8ICRbM10gIT09IHByb3BzLmxlZ2FjeVNjaGVtYS5pbmxpbmVPYmplY3RzKSB7XG4gICAgbGV0IHQyMjtcbiAgICAkWzVdICE9PSBwcm9wcy5lbGVtZW50Ll90eXBlID8gKHQyMiA9IChpbmxpbmVPYmplY3QpID0+IGlubGluZU9iamVjdC5uYW1lID09PSBwcm9wcy5lbGVtZW50Ll90eXBlLCAkWzVdID0gcHJvcHMuZWxlbWVudC5fdHlwZSwgJFs2XSA9IHQyMikgOiB0MjIgPSAkWzZdLCB0MSA9IHByb3BzLmxlZ2FjeVNjaGVtYS5pbmxpbmVPYmplY3RzLmZpbmQodDIyKSwgJFsyXSA9IHByb3BzLmVsZW1lbnQuX3R5cGUsICRbM10gPSBwcm9wcy5sZWdhY3lTY2hlbWEuaW5saW5lT2JqZWN0cywgJFs0XSA9IHQxO1xuICB9IGVsc2VcbiAgICB0MSA9ICRbNF07XG4gIGNvbnN0IGxlZ2FjeVNjaGVtYVR5cGUgPSB0MTtcbiAgbGVnYWN5U2NoZW1hVHlwZSB8fCBjb25zb2xlLmVycm9yKGBVbmFibGUgdG8gZmluZCBJbmxpbmUgT2JqZWN0IFwiJHtwcm9wcy5lbGVtZW50Ll90eXBlfVwiIGluIFNjaGVtYWApO1xuICBsZXQgdDI7XG4gIGlmICgkWzddICE9PSBwcm9wcy5lbGVtZW50IHx8ICRbOF0gIT09IHNsYXRlRWRpdG9yKSB7XG4gICAgY29uc3QgcGF0aCA9IERPTUVkaXRvci5maW5kUGF0aChzbGF0ZUVkaXRvciwgcHJvcHMuZWxlbWVudCk7XG4gICAgdDIgPSBnZXRQb2ludEJsb2NrKHtcbiAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgICBwb2ludDoge1xuICAgICAgICBwYXRoLFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH1cbiAgICB9KSwgJFs3XSA9IHByb3BzLmVsZW1lbnQsICRbOF0gPSBzbGF0ZUVkaXRvciwgJFs5XSA9IHQyO1xuICB9IGVsc2VcbiAgICB0MiA9ICRbOV07XG4gIGNvbnN0IFtibG9ja10gPSB0MjtcbiAgYmxvY2sgfHwgY29uc29sZS5lcnJvcihgVW5hYmxlIHRvIGZpbmQgcGFyZW50IGJsb2NrIG9mIGlubGluZSBvYmplY3QgJHtwcm9wcy5lbGVtZW50Ll9rZXl9YCk7XG4gIGxldCB0MztcbiAgJFsxMF0gIT09IHByb3BzLmVsZW1lbnQgPyAodDMgPSBcInZhbHVlXCIgaW4gcHJvcHMuZWxlbWVudCAmJiB0eXBlb2YgcHJvcHMuZWxlbWVudC52YWx1ZSA9PSBcIm9iamVjdFwiID8gcHJvcHMuZWxlbWVudC52YWx1ZSA6IHt9LCAkWzEwXSA9IHByb3BzLmVsZW1lbnQsICRbMTFdID0gdDMpIDogdDMgPSAkWzExXTtcbiAgbGV0IHQ0O1xuICAkWzEyXSAhPT0gcHJvcHMuZWxlbWVudC5fa2V5IHx8ICRbMTNdICE9PSBwcm9wcy5lbGVtZW50Ll90eXBlIHx8ICRbMTRdICE9PSB0MyA/ICh0NCA9IHtcbiAgICBfa2V5OiBwcm9wcy5lbGVtZW50Ll9rZXksXG4gICAgX3R5cGU6IHByb3BzLmVsZW1lbnQuX3R5cGUsXG4gICAgLi4udDNcbiAgfSwgJFsxMl0gPSBwcm9wcy5lbGVtZW50Ll9rZXksICRbMTNdID0gcHJvcHMuZWxlbWVudC5fdHlwZSwgJFsxNF0gPSB0MywgJFsxNV0gPSB0NCkgOiB0NCA9ICRbMTVdO1xuICBjb25zdCBpbmxpbmVPYmplY3RfMCA9IHQ0LCB0NSA9ICFwcm9wcy5yZWFkT25seTtcbiAgbGV0IHQ2O1xuICAkWzE2XSA9PT0gLyogQF9fUFVSRV9fICovIFN5bWJvbC5mb3IoXCJyZWFjdC5tZW1vX2NhY2hlX3NlbnRpbmVsXCIpID8gKHQ2ID0ge1xuICAgIGRpc3BsYXk6IFwiaW5saW5lLWJsb2NrXCJcbiAgfSwgJFsxNl0gPSB0NikgOiB0NiA9ICRbMTZdO1xuICBsZXQgdDc7XG4gICRbMTddICE9PSBibG9jayB8fCAkWzE4XSAhPT0gZm9jdXNlZCB8fCAkWzE5XSAhPT0gaW5saW5lT2JqZWN0XzAgfHwgJFsyMF0gIT09IGxlZ2FjeVNjaGVtYVR5cGUgfHwgJFsyMV0gIT09IHByb3BzLmVsZW1lbnQuX2tleSB8fCAkWzIyXSAhPT0gcHJvcHMucmVuZGVyQ2hpbGQgfHwgJFsyM10gIT09IHNlbGVjdGVkID8gKHQ3ID0gLyogQF9fUFVSRV9fICovIGpzeChcInNwYW5cIiwgeyByZWY6IGlubGluZU9iamVjdFJlZiwgc3R5bGU6IHQ2LCBjaGlsZHJlbjogcHJvcHMucmVuZGVyQ2hpbGQgJiYgYmxvY2sgJiYgbGVnYWN5U2NoZW1hVHlwZSA/IC8qIEBfX1BVUkVfXyAqLyBqc3goUmVuZGVyQ2hpbGQkMSwgeyByZW5kZXJDaGlsZDogcHJvcHMucmVuZGVyQ2hpbGQsIGFubm90YXRpb25zOiBbXSwgZWRpdG9yRWxlbWVudFJlZjogaW5saW5lT2JqZWN0UmVmLCBzZWxlY3RlZCwgZm9jdXNlZCwgcGF0aDogW3tcbiAgICBfa2V5OiBibG9jay5fa2V5XG4gIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgIF9rZXk6IHByb3BzLmVsZW1lbnQuX2tleVxuICB9XSwgc2NoZW1hVHlwZTogbGVnYWN5U2NoZW1hVHlwZSwgdmFsdWU6IGlubGluZU9iamVjdF8wLCB0eXBlOiBsZWdhY3lTY2hlbWFUeXBlLCBjaGlsZHJlbjogLyogQF9fUFVSRV9fICovIGpzeChSZW5kZXJEZWZhdWx0SW5saW5lT2JqZWN0LCB7IGlubGluZU9iamVjdDogaW5saW5lT2JqZWN0XzAgfSkgfSkgOiAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlckRlZmF1bHRJbmxpbmVPYmplY3QsIHsgaW5saW5lT2JqZWN0OiBpbmxpbmVPYmplY3RfMCB9KSB9KSwgJFsxN10gPSBibG9jaywgJFsxOF0gPSBmb2N1c2VkLCAkWzE5XSA9IGlubGluZU9iamVjdF8wLCAkWzIwXSA9IGxlZ2FjeVNjaGVtYVR5cGUsICRbMjFdID0gcHJvcHMuZWxlbWVudC5fa2V5LCAkWzIyXSA9IHByb3BzLnJlbmRlckNoaWxkLCAkWzIzXSA9IHNlbGVjdGVkLCAkWzI0XSA9IHQ3KSA6IHQ3ID0gJFsyNF07XG4gIGxldCB0ODtcbiAgcmV0dXJuICRbMjVdICE9PSBpbmxpbmVPYmplY3RfMC5fa2V5IHx8ICRbMjZdICE9PSBpbmxpbmVPYmplY3RfMC5fdHlwZSB8fCAkWzI3XSAhPT0gcHJvcHMuYXR0cmlidXRlcyB8fCAkWzI4XSAhPT0gcHJvcHMuY2hpbGRyZW4gfHwgJFsyOV0gIT09IHQ1IHx8ICRbMzBdICE9PSB0NyA/ICh0OCA9IC8qIEBfX1BVUkVfXyAqLyBqc3hzKFwic3BhblwiLCB7IC4uLnByb3BzLmF0dHJpYnV0ZXMsIGRyYWdnYWJsZTogdDUsIGNsYXNzTmFtZTogXCJwdC1pbmxpbmUtb2JqZWN0XCIsIFwiZGF0YS1jaGlsZC1rZXlcIjogaW5saW5lT2JqZWN0XzAuX2tleSwgXCJkYXRhLWNoaWxkLW5hbWVcIjogaW5saW5lT2JqZWN0XzAuX3R5cGUsIFwiZGF0YS1jaGlsZC10eXBlXCI6IFwib2JqZWN0XCIsIGNoaWxkcmVuOiBbXG4gICAgcHJvcHMuY2hpbGRyZW4sXG4gICAgdDdcbiAgXSB9KSwgJFsyNV0gPSBpbmxpbmVPYmplY3RfMC5fa2V5LCAkWzI2XSA9IGlubGluZU9iamVjdF8wLl90eXBlLCAkWzI3XSA9IHByb3BzLmF0dHJpYnV0ZXMsICRbMjhdID0gcHJvcHMuY2hpbGRyZW4sICRbMjldID0gdDUsICRbMzBdID0gdDcsICRbMzFdID0gdDgpIDogdDggPSAkWzMxXSwgdDg7XG59XG5mdW5jdGlvbiBSZW5kZXJDaGlsZCQxKHtcbiAgcmVuZGVyQ2hpbGQsXG4gIGFubm90YXRpb25zLFxuICBjaGlsZHJlbixcbiAgZWRpdG9yRWxlbWVudFJlZixcbiAgZm9jdXNlZCxcbiAgcGF0aCxcbiAgc2NoZW1hVHlwZSxcbiAgc2VsZWN0ZWQsXG4gIHZhbHVlLFxuICB0eXBlXG59KSB7XG4gIHJldHVybiByZW5kZXJDaGlsZCh7XG4gICAgYW5ub3RhdGlvbnMsXG4gICAgY2hpbGRyZW4sXG4gICAgZWRpdG9yRWxlbWVudFJlZixcbiAgICBmb2N1c2VkLFxuICAgIHBhdGgsXG4gICAgc2NoZW1hVHlwZSxcbiAgICBzZWxlY3RlZCxcbiAgICB2YWx1ZSxcbiAgICB0eXBlXG4gIH0pO1xufVxuZnVuY3Rpb24gUmVuZGVyVGV4dEJsb2NrKHByb3BzKSB7XG4gIGNvbnN0ICQgPSBjKDc3KSwgW2RyYWdQb3NpdGlvbkJsb2NrLCBzZXREcmFnUG9zaXRpb25CbG9ja10gPSB1c2VTdGF0ZSgpLCBibG9ja1JlZiA9IHVzZVJlZihudWxsKSwgc2VsZWN0ZWQgPSB1c2VTZWxlY3RlZCgpO1xuICBsZXQgdDA7XG4gICRbMF0gIT09IHNlbGVjdGVkID8gKHQwID0gKGVkaXRvcikgPT4gc2VsZWN0ZWQgJiYgZWRpdG9yLnNlbGVjdGlvbiAhPT0gbnVsbCAmJiBSYW5nZS5pc0NvbGxhcHNlZChlZGl0b3Iuc2VsZWN0aW9uKSwgJFswXSA9IHNlbGVjdGVkLCAkWzFdID0gdDApIDogdDAgPSAkWzFdO1xuICBjb25zdCBmb2N1c2VkID0gdXNlU2xhdGVTZWxlY3Rvcih0MCk7XG4gIGxldCB0MTtcbiAgJFsyXSAhPT0gcHJvcHMuZWxlbWVudC5fa2V5ID8gKHQxID0ge1xuICAgIGtleTogcHJvcHMuZWxlbWVudC5fa2V5LFxuICAgIG9uU2V0RHJhZ1Bvc2l0aW9uQmxvY2s6IHNldERyYWdQb3NpdGlvbkJsb2NrXG4gIH0sICRbMl0gPSBwcm9wcy5lbGVtZW50Ll9rZXksICRbM10gPSB0MSkgOiB0MSA9ICRbM10sIHVzZUNvcmVCbG9ja0VsZW1lbnRCZWhhdmlvcnModDEpO1xuICBsZXQgdDI7XG4gICRbNF0gIT09IHByb3BzLnRleHRCbG9jay5fa2V5ID8gKHQyID0gKGVkaXRvcl8wKSA9PiBlZGl0b3JfMC5saXN0SW5kZXhNYXAuZ2V0KHByb3BzLnRleHRCbG9jay5fa2V5KSwgJFs0XSA9IHByb3BzLnRleHRCbG9jay5fa2V5LCAkWzVdID0gdDIpIDogdDIgPSAkWzVdO1xuICBjb25zdCBsaXN0SW5kZXggPSB1c2VTbGF0ZVNlbGVjdG9yKHQyKTtcbiAgbGV0IGNoaWxkcmVuID0gcHJvcHMuY2hpbGRyZW47XG4gIGlmIChwcm9wcy5yZW5kZXJTdHlsZSAmJiBwcm9wcy50ZXh0QmxvY2suc3R5bGUpIHtcbiAgICBsZXQgdDMyO1xuICAgICRbNl0gIT09IHByb3BzLmxlZ2FjeVNjaGVtYSB8fCAkWzddICE9PSBwcm9wcy50ZXh0QmxvY2suc3R5bGUgPyAodDMyID0gcHJvcHMudGV4dEJsb2NrLnN0eWxlICE9PSB2b2lkIDAgPyBwcm9wcy5sZWdhY3lTY2hlbWEuc3R5bGVzLmZpbmQoKHN0eWxlKSA9PiBzdHlsZS52YWx1ZSA9PT0gcHJvcHMudGV4dEJsb2NrLnN0eWxlKSA6IHZvaWQgMCwgJFs2XSA9IHByb3BzLmxlZ2FjeVNjaGVtYSwgJFs3XSA9IHByb3BzLnRleHRCbG9jay5zdHlsZSwgJFs4XSA9IHQzMikgOiB0MzIgPSAkWzhdO1xuICAgIGNvbnN0IGxlZ2FjeVN0eWxlU2NoZW1hVHlwZSA9IHQzMjtcbiAgICBpZiAobGVnYWN5U3R5bGVTY2hlbWFUeXBlKSB7XG4gICAgICBsZXQgdDQyO1xuICAgICAgJFs5XSAhPT0gcHJvcHMudGV4dEJsb2NrLl9rZXkgPyAodDQyID0gW3tcbiAgICAgICAgX2tleTogcHJvcHMudGV4dEJsb2NrLl9rZXlcbiAgICAgIH1dLCAkWzldID0gcHJvcHMudGV4dEJsb2NrLl9rZXksICRbMTBdID0gdDQyKSA6IHQ0MiA9ICRbMTBdO1xuICAgICAgbGV0IHQ1MjtcbiAgICAgICRbMTFdICE9PSBjaGlsZHJlbiB8fCAkWzEyXSAhPT0gZm9jdXNlZCB8fCAkWzEzXSAhPT0gbGVnYWN5U3R5bGVTY2hlbWFUeXBlIHx8ICRbMTRdICE9PSBwcm9wcy5yZW5kZXJTdHlsZSB8fCAkWzE1XSAhPT0gcHJvcHMudGV4dEJsb2NrIHx8ICRbMTZdICE9PSBzZWxlY3RlZCB8fCAkWzE3XSAhPT0gdDQyID8gKHQ1MiA9IC8qIEBfX1BVUkVfXyAqLyBqc3goUmVuZGVyU3R5bGUsIHsgcmVuZGVyU3R5bGU6IHByb3BzLnJlbmRlclN0eWxlLCBibG9jazogcHJvcHMudGV4dEJsb2NrLCBlZGl0b3JFbGVtZW50UmVmOiBibG9ja1JlZiwgZm9jdXNlZCwgcGF0aDogdDQyLCBzY2hlbWFUeXBlOiBsZWdhY3lTdHlsZVNjaGVtYVR5cGUsIHNlbGVjdGVkLCB2YWx1ZTogcHJvcHMudGV4dEJsb2NrLnN0eWxlLCBjaGlsZHJlbiB9KSwgJFsxMV0gPSBjaGlsZHJlbiwgJFsxMl0gPSBmb2N1c2VkLCAkWzEzXSA9IGxlZ2FjeVN0eWxlU2NoZW1hVHlwZSwgJFsxNF0gPSBwcm9wcy5yZW5kZXJTdHlsZSwgJFsxNV0gPSBwcm9wcy50ZXh0QmxvY2ssICRbMTZdID0gc2VsZWN0ZWQsICRbMTddID0gdDQyLCAkWzE4XSA9IHQ1MikgOiB0NTIgPSAkWzE4XSwgY2hpbGRyZW4gPSB0NTI7XG4gICAgfSBlbHNlXG4gICAgICBjb25zb2xlLmVycm9yKGBVbmFibGUgdG8gZmluZCBTY2hlbWEgdHlwZSBmb3IgdGV4dCBibG9jayBzdHlsZSAke3Byb3BzLnRleHRCbG9jay5zdHlsZX1gKTtcbiAgfVxuICBpZiAocHJvcHMucmVuZGVyTGlzdEl0ZW0gJiYgcHJvcHMudGV4dEJsb2NrLmxpc3RJdGVtKSB7XG4gICAgbGV0IHQzMjtcbiAgICBpZiAoJFsxOV0gIT09IHByb3BzLmxlZ2FjeVNjaGVtYS5saXN0cyB8fCAkWzIwXSAhPT0gcHJvcHMudGV4dEJsb2NrLmxpc3RJdGVtKSB7XG4gICAgICBsZXQgdDQyO1xuICAgICAgJFsyMl0gIT09IHByb3BzLnRleHRCbG9jay5saXN0SXRlbSA/ICh0NDIgPSAobGlzdCkgPT4gbGlzdC52YWx1ZSA9PT0gcHJvcHMudGV4dEJsb2NrLmxpc3RJdGVtLCAkWzIyXSA9IHByb3BzLnRleHRCbG9jay5saXN0SXRlbSwgJFsyM10gPSB0NDIpIDogdDQyID0gJFsyM10sIHQzMiA9IHByb3BzLmxlZ2FjeVNjaGVtYS5saXN0cy5maW5kKHQ0MiksICRbMTldID0gcHJvcHMubGVnYWN5U2NoZW1hLmxpc3RzLCAkWzIwXSA9IHByb3BzLnRleHRCbG9jay5saXN0SXRlbSwgJFsyMV0gPSB0MzI7XG4gICAgfSBlbHNlXG4gICAgICB0MzIgPSAkWzIxXTtcbiAgICBjb25zdCBsZWdhY3lMaXN0SXRlbVNjaGVtYVR5cGUgPSB0MzI7XG4gICAgaWYgKGxlZ2FjeUxpc3RJdGVtU2NoZW1hVHlwZSkge1xuICAgICAgY29uc3QgdDQyID0gcHJvcHMudGV4dEJsb2NrLmxldmVsID8/IDE7XG4gICAgICBsZXQgdDUyO1xuICAgICAgJFsyNF0gIT09IHByb3BzLnRleHRCbG9jay5fa2V5ID8gKHQ1MiA9IFt7XG4gICAgICAgIF9rZXk6IHByb3BzLnRleHRCbG9jay5fa2V5XG4gICAgICB9XSwgJFsyNF0gPSBwcm9wcy50ZXh0QmxvY2suX2tleSwgJFsyNV0gPSB0NTIpIDogdDUyID0gJFsyNV07XG4gICAgICBsZXQgdDYyO1xuICAgICAgJFsyNl0gIT09IGNoaWxkcmVuIHx8ICRbMjddICE9PSBmb2N1c2VkIHx8ICRbMjhdICE9PSBsZWdhY3lMaXN0SXRlbVNjaGVtYVR5cGUgfHwgJFsyOV0gIT09IHByb3BzLnJlbmRlckxpc3RJdGVtIHx8ICRbMzBdICE9PSBwcm9wcy50ZXh0QmxvY2sgfHwgJFszMV0gIT09IHNlbGVjdGVkIHx8ICRbMzJdICE9PSB0NDIgfHwgJFszM10gIT09IHQ1MiA/ICh0NjIgPSAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlckxpc3RJdGVtLCB7IHJlbmRlckxpc3RJdGVtOiBwcm9wcy5yZW5kZXJMaXN0SXRlbSwgYmxvY2s6IHByb3BzLnRleHRCbG9jaywgZWRpdG9yRWxlbWVudFJlZjogYmxvY2tSZWYsIGZvY3VzZWQsIGxldmVsOiB0NDIsIHBhdGg6IHQ1Miwgc2VsZWN0ZWQsIHZhbHVlOiBwcm9wcy50ZXh0QmxvY2subGlzdEl0ZW0sIHNjaGVtYVR5cGU6IGxlZ2FjeUxpc3RJdGVtU2NoZW1hVHlwZSwgY2hpbGRyZW4gfSksICRbMjZdID0gY2hpbGRyZW4sICRbMjddID0gZm9jdXNlZCwgJFsyOF0gPSBsZWdhY3lMaXN0SXRlbVNjaGVtYVR5cGUsICRbMjldID0gcHJvcHMucmVuZGVyTGlzdEl0ZW0sICRbMzBdID0gcHJvcHMudGV4dEJsb2NrLCAkWzMxXSA9IHNlbGVjdGVkLCAkWzMyXSA9IHQ0MiwgJFszM10gPSB0NTIsICRbMzRdID0gdDYyKSA6IHQ2MiA9ICRbMzRdLCBjaGlsZHJlbiA9IHQ2MjtcbiAgICB9IGVsc2VcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFVuYWJsZSB0byBmaW5kIFNjaGVtYSB0eXBlIGZvciB0ZXh0IGJsb2NrIGxpc3QgaXRlbSAke3Byb3BzLnRleHRCbG9jay5saXN0SXRlbX1gKTtcbiAgfVxuICBjb25zdCB0MyA9IHByb3BzLmF0dHJpYnV0ZXM7XG4gIGxldCB0NDtcbiAgJFszNV0gIT09IHByb3BzLnRleHRCbG9jay5zdHlsZSA/ICh0NCA9IHByb3BzLnRleHRCbG9jay5zdHlsZSA/IFtgcHQtdGV4dC1ibG9jay1zdHlsZS0ke3Byb3BzLnRleHRCbG9jay5zdHlsZX1gXSA6IFtdLCAkWzM1XSA9IHByb3BzLnRleHRCbG9jay5zdHlsZSwgJFszNl0gPSB0NCkgOiB0NCA9ICRbMzZdO1xuICBsZXQgdDU7XG4gICRbMzddICE9PSBwcm9wcy50ZXh0QmxvY2subGV2ZWwgfHwgJFszOF0gIT09IHByb3BzLnRleHRCbG9jay5saXN0SXRlbSA/ICh0NSA9IHByb3BzLnRleHRCbG9jay5saXN0SXRlbSA/IFtcInB0LWxpc3QtaXRlbVwiLCBgcHQtbGlzdC1pdGVtLSR7cHJvcHMudGV4dEJsb2NrLmxpc3RJdGVtfWAsIGBwdC1saXN0LWl0ZW0tbGV2ZWwtJHtwcm9wcy50ZXh0QmxvY2subGV2ZWwgPz8gMX1gXSA6IFtdLCAkWzM3XSA9IHByb3BzLnRleHRCbG9jay5sZXZlbCwgJFszOF0gPSBwcm9wcy50ZXh0QmxvY2subGlzdEl0ZW0sICRbMzldID0gdDUpIDogdDUgPSAkWzM5XTtcbiAgbGV0IHQ2O1xuICAkWzQwXSAhPT0gdDQgfHwgJFs0MV0gIT09IHQ1ID8gKHQ2ID0gW1wicHQtYmxvY2tcIiwgXCJwdC10ZXh0LWJsb2NrXCIsIC4uLnQ0LCAuLi50NV0sICRbNDBdID0gdDQsICRbNDFdID0gdDUsICRbNDJdID0gdDYpIDogdDYgPSAkWzQyXTtcbiAgY29uc3QgdDcgPSB0Ni5qb2luKFwiIFwiKTtcbiAgbGV0IHQ4O1xuICAkWzQzXSAhPT0gcHJvcHMudGV4dEJsb2NrLmxpc3RJdGVtID8gKHQ4ID0gcHJvcHMudGV4dEJsb2NrLmxpc3RJdGVtICE9PSB2b2lkIDAgPyB7XG4gICAgXCJkYXRhLWxpc3QtaXRlbVwiOiBwcm9wcy50ZXh0QmxvY2subGlzdEl0ZW1cbiAgfSA6IHt9LCAkWzQzXSA9IHByb3BzLnRleHRCbG9jay5saXN0SXRlbSwgJFs0NF0gPSB0OCkgOiB0OCA9ICRbNDRdO1xuICBsZXQgdDk7XG4gICRbNDVdICE9PSBwcm9wcy50ZXh0QmxvY2subGV2ZWwgPyAodDkgPSBwcm9wcy50ZXh0QmxvY2subGV2ZWwgIT09IHZvaWQgMCA/IHtcbiAgICBcImRhdGEtbGV2ZWxcIjogcHJvcHMudGV4dEJsb2NrLmxldmVsXG4gIH0gOiB7fSwgJFs0NV0gPSBwcm9wcy50ZXh0QmxvY2subGV2ZWwsICRbNDZdID0gdDkpIDogdDkgPSAkWzQ2XTtcbiAgbGV0IHQxMDtcbiAgJFs0N10gIT09IHByb3BzLnRleHRCbG9jay5zdHlsZSA/ICh0MTAgPSBwcm9wcy50ZXh0QmxvY2suc3R5bGUgIT09IHZvaWQgMCA/IHtcbiAgICBcImRhdGEtc3R5bGVcIjogcHJvcHMudGV4dEJsb2NrLnN0eWxlXG4gIH0gOiB7fSwgJFs0N10gPSBwcm9wcy50ZXh0QmxvY2suc3R5bGUsICRbNDhdID0gdDEwKSA6IHQxMCA9ICRbNDhdO1xuICBsZXQgdDExO1xuICAkWzQ5XSAhPT0gbGlzdEluZGV4ID8gKHQxMSA9IGxpc3RJbmRleCAhPT0gdm9pZCAwID8ge1xuICAgIFwiZGF0YS1saXN0LWluZGV4XCI6IGxpc3RJbmRleFxuICB9IDoge30sICRbNDldID0gbGlzdEluZGV4LCAkWzUwXSA9IHQxMSkgOiB0MTEgPSAkWzUwXTtcbiAgbGV0IHQxMjtcbiAgJFs1MV0gIT09IGRyYWdQb3NpdGlvbkJsb2NrID8gKHQxMiA9IGRyYWdQb3NpdGlvbkJsb2NrID09PSBcInN0YXJ0XCIgPyAvKiBAX19QVVJFX18gKi8ganN4KERyb3BJbmRpY2F0b3IsIHt9KSA6IG51bGwsICRbNTFdID0gZHJhZ1Bvc2l0aW9uQmxvY2ssICRbNTJdID0gdDEyKSA6IHQxMiA9ICRbNTJdO1xuICBsZXQgdDEzO1xuICAkWzUzXSAhPT0gY2hpbGRyZW4gfHwgJFs1NF0gIT09IGZvY3VzZWQgfHwgJFs1NV0gIT09IHByb3BzLmxlZ2FjeVNjaGVtYSB8fCAkWzU2XSAhPT0gcHJvcHMucmVuZGVyQmxvY2sgfHwgJFs1N10gIT09IHByb3BzLnRleHRCbG9jayB8fCAkWzU4XSAhPT0gc2VsZWN0ZWQgPyAodDEzID0gcHJvcHMucmVuZGVyQmxvY2sgPyAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlckJsb2NrLCB7IHJlbmRlckJsb2NrOiBwcm9wcy5yZW5kZXJCbG9jaywgZWRpdG9yRWxlbWVudFJlZjogYmxvY2tSZWYsIGZvY3VzZWQsIGxldmVsOiBwcm9wcy50ZXh0QmxvY2subGV2ZWwsIGxpc3RJdGVtOiBwcm9wcy50ZXh0QmxvY2subGlzdEl0ZW0sIHBhdGg6IFt7XG4gICAgX2tleTogcHJvcHMudGV4dEJsb2NrLl9rZXlcbiAgfV0sIHNlbGVjdGVkLCBzY2hlbWFUeXBlOiBwcm9wcy5sZWdhY3lTY2hlbWEuYmxvY2ssIHN0eWxlOiBwcm9wcy50ZXh0QmxvY2suc3R5bGUsIHR5cGU6IHByb3BzLmxlZ2FjeVNjaGVtYS5ibG9jaywgdmFsdWU6IHByb3BzLnRleHRCbG9jaywgY2hpbGRyZW4gfSkgOiBjaGlsZHJlbiwgJFs1M10gPSBjaGlsZHJlbiwgJFs1NF0gPSBmb2N1c2VkLCAkWzU1XSA9IHByb3BzLmxlZ2FjeVNjaGVtYSwgJFs1Nl0gPSBwcm9wcy5yZW5kZXJCbG9jaywgJFs1N10gPSBwcm9wcy50ZXh0QmxvY2ssICRbNThdID0gc2VsZWN0ZWQsICRbNTldID0gdDEzKSA6IHQxMyA9ICRbNTldO1xuICBsZXQgdDE0O1xuICAkWzYwXSAhPT0gdDEzID8gKHQxNCA9IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJkaXZcIiwgeyByZWY6IGJsb2NrUmVmLCBjaGlsZHJlbjogdDEzIH0pLCAkWzYwXSA9IHQxMywgJFs2MV0gPSB0MTQpIDogdDE0ID0gJFs2MV07XG4gIGxldCB0MTU7XG4gICRbNjJdICE9PSBkcmFnUG9zaXRpb25CbG9jayA/ICh0MTUgPSBkcmFnUG9zaXRpb25CbG9jayA9PT0gXCJlbmRcIiA/IC8qIEBfX1BVUkVfXyAqLyBqc3goRHJvcEluZGljYXRvciwge30pIDogbnVsbCwgJFs2Ml0gPSBkcmFnUG9zaXRpb25CbG9jaywgJFs2M10gPSB0MTUpIDogdDE1ID0gJFs2M107XG4gIGxldCB0MTY7XG4gIHJldHVybiAkWzY0XSAhPT0gcHJvcHMuYXR0cmlidXRlcyB8fCAkWzY1XSAhPT0gcHJvcHMuc3BlbGxDaGVjayB8fCAkWzY2XSAhPT0gcHJvcHMudGV4dEJsb2NrLl9rZXkgfHwgJFs2N10gIT09IHByb3BzLnRleHRCbG9jay5fdHlwZSB8fCAkWzY4XSAhPT0gdDEwIHx8ICRbNjldICE9PSB0MTEgfHwgJFs3MF0gIT09IHQxMiB8fCAkWzcxXSAhPT0gdDE0IHx8ICRbNzJdICE9PSB0MTUgfHwgJFs3M10gIT09IHQ3IHx8ICRbNzRdICE9PSB0OCB8fCAkWzc1XSAhPT0gdDkgPyAodDE2ID0gLyogQF9fUFVSRV9fICovIGpzeHMoXCJkaXZcIiwgeyAuLi50MywgY2xhc3NOYW1lOiB0Nywgc3BlbGxDaGVjazogcHJvcHMuc3BlbGxDaGVjaywgXCJkYXRhLWJsb2NrLWtleVwiOiBwcm9wcy50ZXh0QmxvY2suX2tleSwgXCJkYXRhLWJsb2NrLW5hbWVcIjogcHJvcHMudGV4dEJsb2NrLl90eXBlLCBcImRhdGEtYmxvY2stdHlwZVwiOiBcInRleHRcIiwgLi4udDgsIC4uLnQ5LCAuLi50MTAsIC4uLnQxMSwgY2hpbGRyZW46IFtcbiAgICB0MTIsXG4gICAgdDE0LFxuICAgIHQxNVxuICBdIH0pLCAkWzY0XSA9IHByb3BzLmF0dHJpYnV0ZXMsICRbNjVdID0gcHJvcHMuc3BlbGxDaGVjaywgJFs2Nl0gPSBwcm9wcy50ZXh0QmxvY2suX2tleSwgJFs2N10gPSBwcm9wcy50ZXh0QmxvY2suX3R5cGUsICRbNjhdID0gdDEwLCAkWzY5XSA9IHQxMSwgJFs3MF0gPSB0MTIsICRbNzFdID0gdDE0LCAkWzcyXSA9IHQxNSwgJFs3M10gPSB0NywgJFs3NF0gPSB0OCwgJFs3NV0gPSB0OSwgJFs3Nl0gPSB0MTYpIDogdDE2ID0gJFs3Nl0sIHQxNjtcbn1cbmZ1bmN0aW9uIFJlbmRlckJsb2NrKHtcbiAgcmVuZGVyQmxvY2ssXG4gIGNoaWxkcmVuLFxuICBlZGl0b3JFbGVtZW50UmVmLFxuICBmb2N1c2VkLFxuICBsZXZlbCxcbiAgbGlzdEl0ZW0sXG4gIHBhdGgsXG4gIHNlbGVjdGVkLFxuICBzdHlsZSxcbiAgc2NoZW1hVHlwZSxcbiAgdHlwZSxcbiAgdmFsdWVcbn0pIHtcbiAgcmV0dXJuIHJlbmRlckJsb2NrKHtcbiAgICBjaGlsZHJlbixcbiAgICBlZGl0b3JFbGVtZW50UmVmLFxuICAgIGZvY3VzZWQsXG4gICAgbGV2ZWwsXG4gICAgbGlzdEl0ZW0sXG4gICAgcGF0aCxcbiAgICBzZWxlY3RlZCxcbiAgICBzdHlsZSxcbiAgICBzY2hlbWFUeXBlLFxuICAgIHR5cGUsXG4gICAgdmFsdWVcbiAgfSk7XG59XG5mdW5jdGlvbiBSZW5kZXJMaXN0SXRlbSh7XG4gIHJlbmRlckxpc3RJdGVtLFxuICBibG9jayxcbiAgY2hpbGRyZW4sXG4gIGVkaXRvckVsZW1lbnRSZWYsXG4gIGZvY3VzZWQsXG4gIGxldmVsLFxuICBwYXRoLFxuICBzY2hlbWFUeXBlLFxuICBzZWxlY3RlZCxcbiAgdmFsdWVcbn0pIHtcbiAgcmV0dXJuIHJlbmRlckxpc3RJdGVtKHtcbiAgICBibG9jayxcbiAgICBjaGlsZHJlbixcbiAgICBlZGl0b3JFbGVtZW50UmVmLFxuICAgIGZvY3VzZWQsXG4gICAgbGV2ZWwsXG4gICAgcGF0aCxcbiAgICBzY2hlbWFUeXBlLFxuICAgIHNlbGVjdGVkLFxuICAgIHZhbHVlXG4gIH0pO1xufVxuZnVuY3Rpb24gUmVuZGVyU3R5bGUoe1xuICByZW5kZXJTdHlsZSxcbiAgYmxvY2ssXG4gIGNoaWxkcmVuLFxuICBlZGl0b3JFbGVtZW50UmVmLFxuICBmb2N1c2VkLFxuICBwYXRoLFxuICBzY2hlbWFUeXBlLFxuICBzZWxlY3RlZCxcbiAgdmFsdWVcbn0pIHtcbiAgcmV0dXJuIHJlbmRlclN0eWxlKHtcbiAgICBibG9jayxcbiAgICBjaGlsZHJlbixcbiAgICBlZGl0b3JFbGVtZW50UmVmLFxuICAgIGZvY3VzZWQsXG4gICAgcGF0aCxcbiAgICBzY2hlbWFUeXBlLFxuICAgIHNlbGVjdGVkLFxuICAgIHZhbHVlXG4gIH0pO1xufVxuZnVuY3Rpb24gUmVuZGVyRWxlbWVudChwcm9wcykge1xuICBjb25zdCAkID0gYygzNCksIGVkaXRvckFjdG9yID0gdXNlQ29udGV4dChFZGl0b3JBY3RvckNvbnRleHQpLCBzY2hlbWEgPSB1c2VTZWxlY3RvcihlZGl0b3JBY3RvciwgX3RlbXAkMyksIGxlZ2FjeVNjaGVtYSA9IHVzZVNlbGVjdG9yKGVkaXRvckFjdG9yLCBfdGVtcDIkMiksIHNsYXRlU3RhdGljID0gdXNlU2xhdGVTdGF0aWMoKTtcbiAgaWYgKFwiX19pbmxpbmVcIiBpbiBwcm9wcy5lbGVtZW50ICYmIHByb3BzLmVsZW1lbnQuX19pbmxpbmUgPT09ICEwKSB7XG4gICAgbGV0IHQwMjtcbiAgICByZXR1cm4gJFswXSAhPT0gbGVnYWN5U2NoZW1hIHx8ICRbMV0gIT09IHByb3BzLmF0dHJpYnV0ZXMgfHwgJFsyXSAhPT0gcHJvcHMuY2hpbGRyZW4gfHwgJFszXSAhPT0gcHJvcHMuZWxlbWVudCB8fCAkWzRdICE9PSBwcm9wcy5yZWFkT25seSB8fCAkWzVdICE9PSBwcm9wcy5yZW5kZXJDaGlsZCB8fCAkWzZdICE9PSBzY2hlbWEgPyAodDAyID0gLyogQF9fUFVSRV9fICovIGpzeChSZW5kZXJJbmxpbmVPYmplY3QsIHsgYXR0cmlidXRlczogcHJvcHMuYXR0cmlidXRlcywgZWxlbWVudDogcHJvcHMuZWxlbWVudCwgbGVnYWN5U2NoZW1hLCByZWFkT25seTogcHJvcHMucmVhZE9ubHksIHJlbmRlckNoaWxkOiBwcm9wcy5yZW5kZXJDaGlsZCwgc2NoZW1hLCBjaGlsZHJlbjogcHJvcHMuY2hpbGRyZW4gfSksICRbMF0gPSBsZWdhY3lTY2hlbWEsICRbMV0gPSBwcm9wcy5hdHRyaWJ1dGVzLCAkWzJdID0gcHJvcHMuY2hpbGRyZW4sICRbM10gPSBwcm9wcy5lbGVtZW50LCAkWzRdID0gcHJvcHMucmVhZE9ubHksICRbNV0gPSBwcm9wcy5yZW5kZXJDaGlsZCwgJFs2XSA9IHNjaGVtYSwgJFs3XSA9IHQwMikgOiB0MDIgPSAkWzddLCB0MDI7XG4gIH1cbiAgbGV0IGJsb2NrLCB0MDtcbiAgaWYgKCRbOF0gIT09IHByb3BzLmVsZW1lbnQuX2tleSB8fCAkWzldICE9PSBzY2hlbWEgfHwgJFsxMF0gIT09IHNsYXRlU3RhdGljLmJsb2NrSW5kZXhNYXAgfHwgJFsxMV0gIT09IHNsYXRlU3RhdGljLnZhbHVlKSB7XG4gICAgY29uc3QgYmxvY2tJbmRleCA9IHNsYXRlU3RhdGljLmJsb2NrSW5kZXhNYXAuZ2V0KHByb3BzLmVsZW1lbnQuX2tleSk7XG4gICAgYmxvY2sgPSBibG9ja0luZGV4ICE9PSB2b2lkIDAgPyBzbGF0ZVN0YXRpYy52YWx1ZS5hdChibG9ja0luZGV4KSA6IHZvaWQgMCwgdDAgPSBpc1RleHRCbG9jayh7XG4gICAgICBzY2hlbWFcbiAgICB9LCBibG9jayksICRbOF0gPSBwcm9wcy5lbGVtZW50Ll9rZXksICRbOV0gPSBzY2hlbWEsICRbMTBdID0gc2xhdGVTdGF0aWMuYmxvY2tJbmRleE1hcCwgJFsxMV0gPSBzbGF0ZVN0YXRpYy52YWx1ZSwgJFsxMl0gPSBibG9jaywgJFsxM10gPSB0MDtcbiAgfSBlbHNlXG4gICAgYmxvY2sgPSAkWzEyXSwgdDAgPSAkWzEzXTtcbiAgaWYgKHQwKSB7XG4gICAgbGV0IHQxMjtcbiAgICByZXR1cm4gJFsxNF0gIT09IGJsb2NrIHx8ICRbMTVdICE9PSBsZWdhY3lTY2hlbWEgfHwgJFsxNl0gIT09IHByb3BzLmF0dHJpYnV0ZXMgfHwgJFsxN10gIT09IHByb3BzLmNoaWxkcmVuIHx8ICRbMThdICE9PSBwcm9wcy5lbGVtZW50IHx8ICRbMTldICE9PSBwcm9wcy5yZWFkT25seSB8fCAkWzIwXSAhPT0gcHJvcHMucmVuZGVyQmxvY2sgfHwgJFsyMV0gIT09IHByb3BzLnJlbmRlckxpc3RJdGVtIHx8ICRbMjJdICE9PSBwcm9wcy5yZW5kZXJTdHlsZSB8fCAkWzIzXSAhPT0gcHJvcHMuc3BlbGxDaGVjayA/ICh0MTIgPSAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlclRleHRCbG9jaywgeyBhdHRyaWJ1dGVzOiBwcm9wcy5hdHRyaWJ1dGVzLCBlbGVtZW50OiBwcm9wcy5lbGVtZW50LCBsZWdhY3lTY2hlbWEsIHJlYWRPbmx5OiBwcm9wcy5yZWFkT25seSwgcmVuZGVyQmxvY2s6IHByb3BzLnJlbmRlckJsb2NrLCByZW5kZXJMaXN0SXRlbTogcHJvcHMucmVuZGVyTGlzdEl0ZW0sIHJlbmRlclN0eWxlOiBwcm9wcy5yZW5kZXJTdHlsZSwgc3BlbGxDaGVjazogcHJvcHMuc3BlbGxDaGVjaywgdGV4dEJsb2NrOiBibG9jaywgY2hpbGRyZW46IHByb3BzLmNoaWxkcmVuIH0pLCAkWzE0XSA9IGJsb2NrLCAkWzE1XSA9IGxlZ2FjeVNjaGVtYSwgJFsxNl0gPSBwcm9wcy5hdHRyaWJ1dGVzLCAkWzE3XSA9IHByb3BzLmNoaWxkcmVuLCAkWzE4XSA9IHByb3BzLmVsZW1lbnQsICRbMTldID0gcHJvcHMucmVhZE9ubHksICRbMjBdID0gcHJvcHMucmVuZGVyQmxvY2ssICRbMjFdID0gcHJvcHMucmVuZGVyTGlzdEl0ZW0sICRbMjJdID0gcHJvcHMucmVuZGVyU3R5bGUsICRbMjNdID0gcHJvcHMuc3BlbGxDaGVjaywgJFsyNF0gPSB0MTIpIDogdDEyID0gJFsyNF0sIHQxMjtcbiAgfVxuICBsZXQgdDE7XG4gIHJldHVybiAkWzI1XSAhPT0gYmxvY2sgfHwgJFsyNl0gIT09IGxlZ2FjeVNjaGVtYSB8fCAkWzI3XSAhPT0gcHJvcHMuYXR0cmlidXRlcyB8fCAkWzI4XSAhPT0gcHJvcHMuY2hpbGRyZW4gfHwgJFsyOV0gIT09IHByb3BzLmVsZW1lbnQgfHwgJFszMF0gIT09IHByb3BzLnJlYWRPbmx5IHx8ICRbMzFdICE9PSBwcm9wcy5yZW5kZXJCbG9jayB8fCAkWzMyXSAhPT0gc2NoZW1hID8gKHQxID0gLyogQF9fUFVSRV9fICovIGpzeChSZW5kZXJCbG9ja09iamVjdCwgeyBhdHRyaWJ1dGVzOiBwcm9wcy5hdHRyaWJ1dGVzLCBibG9ja09iamVjdDogYmxvY2ssIGVsZW1lbnQ6IHByb3BzLmVsZW1lbnQsIGxlZ2FjeVNjaGVtYSwgcmVhZE9ubHk6IHByb3BzLnJlYWRPbmx5LCByZW5kZXJCbG9jazogcHJvcHMucmVuZGVyQmxvY2ssIHNjaGVtYSwgY2hpbGRyZW46IHByb3BzLmNoaWxkcmVuIH0pLCAkWzI1XSA9IGJsb2NrLCAkWzI2XSA9IGxlZ2FjeVNjaGVtYSwgJFsyN10gPSBwcm9wcy5hdHRyaWJ1dGVzLCAkWzI4XSA9IHByb3BzLmNoaWxkcmVuLCAkWzI5XSA9IHByb3BzLmVsZW1lbnQsICRbMzBdID0gcHJvcHMucmVhZE9ubHksICRbMzFdID0gcHJvcHMucmVuZGVyQmxvY2ssICRbMzJdID0gc2NoZW1hLCAkWzMzXSA9IHQxKSA6IHQxID0gJFszM10sIHQxO1xufVxuZnVuY3Rpb24gX3RlbXAyJDIoc18wKSB7XG4gIHJldHVybiBzXzAuY29udGV4dC5nZXRMZWdhY3lTY2hlbWEoKTtcbn1cbmZ1bmN0aW9uIF90ZW1wJDMocykge1xuICByZXR1cm4gcy5jb250ZXh0LnNjaGVtYTtcbn1cbmZ1bmN0aW9uIGRlZmF1bHRDb21wYXJlKGEsIGIpIHtcbiAgcmV0dXJuIGEgPT09IGI7XG59XG5mdW5jdGlvbiB1c2VFZGl0b3JTZWxlY3RvcihlZGl0b3IsIHNlbGVjdG9yLCB0MCkge1xuICBjb25zdCAkID0gYygzKSwgY29tcGFyZSA9IHQwID09PSB2b2lkIDAgPyBkZWZhdWx0Q29tcGFyZSA6IHQwO1xuICBsZXQgdDE7XG4gIHJldHVybiAkWzBdICE9PSBlZGl0b3IgfHwgJFsxXSAhPT0gc2VsZWN0b3IgPyAodDEgPSAoZWRpdG9yQWN0b3JTbmFwc2hvdCkgPT4ge1xuICAgIGNvbnN0IHNuYXBzaG90ID0gZ2V0RWRpdG9yU25hcHNob3Qoe1xuICAgICAgZWRpdG9yQWN0b3JTbmFwc2hvdCxcbiAgICAgIHNsYXRlRWRpdG9ySW5zdGFuY2U6IGVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5zdGFuY2VcbiAgICB9KTtcbiAgICByZXR1cm4gc2VsZWN0b3Ioc25hcHNob3QpO1xuICB9LCAkWzBdID0gZWRpdG9yLCAkWzFdID0gc2VsZWN0b3IsICRbMl0gPSB0MSkgOiB0MSA9ICRbMl0sIHVzZVNlbGVjdG9yKGVkaXRvci5faW50ZXJuYWwuZWRpdG9yQWN0b3IsIHQxLCBjb21wYXJlKTtcbn1cbmZ1bmN0aW9uIGdldEVkaXRvclNuYXBzaG90KHtcbiAgZWRpdG9yQWN0b3JTbmFwc2hvdCxcbiAgc2xhdGVFZGl0b3JJbnN0YW5jZVxufSkge1xuICBjb25zdCBzZWxlY3Rpb24gPSBzbGF0ZUVkaXRvckluc3RhbmNlLnNlbGVjdGlvbiA/IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgc2NoZW1hOiBlZGl0b3JBY3RvclNuYXBzaG90LmNvbnRleHQuc2NoZW1hLFxuICAgIGVkaXRvcjogc2xhdGVFZGl0b3JJbnN0YW5jZSxcbiAgICByYW5nZTogc2xhdGVFZGl0b3JJbnN0YW5jZS5zZWxlY3Rpb25cbiAgfSkgOiBudWxsO1xuICByZXR1cm4ge1xuICAgIGJsb2NrSW5kZXhNYXA6IHNsYXRlRWRpdG9ySW5zdGFuY2UuYmxvY2tJbmRleE1hcCxcbiAgICBjb250ZXh0OiB7XG4gICAgICBjb252ZXJ0ZXJzOiBbLi4uZWRpdG9yQWN0b3JTbmFwc2hvdC5jb250ZXh0LmNvbnZlcnRlcnNdLFxuICAgICAga2V5R2VuZXJhdG9yOiBlZGl0b3JBY3RvclNuYXBzaG90LmNvbnRleHQua2V5R2VuZXJhdG9yLFxuICAgICAgcmVhZE9ubHk6IGVkaXRvckFjdG9yU25hcHNob3QubWF0Y2hlcyh7XG4gICAgICAgIFwiZWRpdCBtb2RlXCI6IFwicmVhZCBvbmx5XCJcbiAgICAgIH0pLFxuICAgICAgc2NoZW1hOiBlZGl0b3JBY3RvclNuYXBzaG90LmNvbnRleHQuc2NoZW1hLFxuICAgICAgc2VsZWN0aW9uLFxuICAgICAgdmFsdWU6IHNsYXRlRWRpdG9ySW5zdGFuY2UudmFsdWVcbiAgICB9LFxuICAgIGRlY29yYXRvclN0YXRlOiBzbGF0ZUVkaXRvckluc3RhbmNlLmRlY29yYXRvclN0YXRlXG4gIH07XG59XG5mdW5jdGlvbiBSZW5kZXJTcGFuKHByb3BzKSB7XG4gIGNvbnN0ICQgPSBjKDQwKSwgc2xhdGVFZGl0b3IgPSB1c2VTbGF0ZVN0YXRpYygpLCBlZGl0b3JBY3RvciA9IHVzZUNvbnRleHQoRWRpdG9yQWN0b3JDb250ZXh0KSwgbGVnYWN5U2NoZW1hID0gdXNlU2VsZWN0b3IoZWRpdG9yQWN0b3IsIF90ZW1wJDIpLCBzcGFuUmVmID0gdXNlUmVmKG51bGwpO1xuICBsZXQgdDA7XG4gICRbMF0gIT09IHByb3BzLmxlYWYuX2tleSB8fCAkWzFdICE9PSBzbGF0ZUVkaXRvciA/ICh0MCA9IChlZGl0b3JBY3RvclNuYXBzaG90KSA9PiB7XG4gICAgY29uc3Qgc25hcHNob3QgPSBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICBlZGl0b3JBY3RvclNuYXBzaG90LFxuICAgICAgc2xhdGVFZGl0b3JJbnN0YW5jZTogc2xhdGVFZGl0b3JcbiAgICB9KTtcbiAgICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uIHx8ICFpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBmb2N1c2VkU3BhbiA9IGdldEZvY3VzU3BhbiQxKHNuYXBzaG90KTtcbiAgICByZXR1cm4gZm9jdXNlZFNwYW4gPyBmb2N1c2VkU3Bhbi5ub2RlLl9rZXkgPT09IHByb3BzLmxlYWYuX2tleSA6ICExO1xuICB9LCAkWzBdID0gcHJvcHMubGVhZi5fa2V5LCAkWzFdID0gc2xhdGVFZGl0b3IsICRbMl0gPSB0MCkgOiB0MCA9ICRbMl07XG4gIGNvbnN0IGZvY3VzZWQgPSB1c2VTZWxlY3RvcihlZGl0b3JBY3RvciwgdDApO1xuICBsZXQgdDE7XG4gICRbM10gIT09IHByb3BzLmNoaWxkcmVuLnByb3BzLnBhcmVudCB8fCAkWzRdICE9PSBwcm9wcy5sZWFmLl9rZXkgfHwgJFs1XSAhPT0gcHJvcHMubGVhZi50ZXh0IHx8ICRbNl0gIT09IHNsYXRlRWRpdG9yID8gKHQxID0gKGVkaXRvckFjdG9yU25hcHNob3RfMCkgPT4ge1xuICAgIGNvbnN0IHNuYXBzaG90XzAgPSBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICBlZGl0b3JBY3RvclNuYXBzaG90OiBlZGl0b3JBY3RvclNuYXBzaG90XzAsXG4gICAgICBzbGF0ZUVkaXRvckluc3RhbmNlOiBzbGF0ZUVkaXRvclxuICAgIH0pO1xuICAgIGlmICghc25hcHNob3RfMC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBwYXJlbnQgPSBwcm9wcy5jaGlsZHJlbi5wcm9wcy5wYXJlbnQsIGJsb2NrID0gcGFyZW50ICYmIGlzVGV4dEJsb2NrKHNuYXBzaG90XzAuY29udGV4dCwgcGFyZW50KSA/IHBhcmVudCA6IHZvaWQgMCwgc3BhblNlbGVjdGlvbiA9IGJsb2NrID8ge1xuICAgICAgYW5jaG9yOiB7XG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICBfa2V5OiBwcm9wcy5sZWFmLl9rZXlcbiAgICAgICAgfV0sXG4gICAgICAgIG9mZnNldDogMFxuICAgICAgfSxcbiAgICAgIGZvY3VzOiB7XG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICBfa2V5OiBwcm9wcy5sZWFmLl9rZXlcbiAgICAgICAgfV0sXG4gICAgICAgIG9mZnNldDogcHJvcHMubGVhZi50ZXh0Lmxlbmd0aFxuICAgICAgfVxuICAgIH0gOiBudWxsO1xuICAgIHJldHVybiBpc092ZXJsYXBwaW5nU2VsZWN0aW9uKHNwYW5TZWxlY3Rpb24pKHNuYXBzaG90XzApO1xuICB9LCAkWzNdID0gcHJvcHMuY2hpbGRyZW4ucHJvcHMucGFyZW50LCAkWzRdID0gcHJvcHMubGVhZi5fa2V5LCAkWzVdID0gcHJvcHMubGVhZi50ZXh0LCAkWzZdID0gc2xhdGVFZGl0b3IsICRbN10gPSB0MSkgOiB0MSA9ICRbN107XG4gIGNvbnN0IHNlbGVjdGVkID0gdXNlU2VsZWN0b3IoZWRpdG9yQWN0b3IsIHQxKSwgcGFyZW50XzAgPSBwcm9wcy5jaGlsZHJlbi5wcm9wcy5wYXJlbnQsIGJsb2NrXzAgPSBwYXJlbnRfMCAmJiBzbGF0ZUVkaXRvci5pc1RleHRCbG9jayhwYXJlbnRfMCkgPyBwYXJlbnRfMCA6IHZvaWQgMDtcbiAgbGV0IHQyO1xuICAkWzhdICE9PSBibG9ja18wIHx8ICRbOV0gIT09IHByb3BzLmxlYWYuX2tleSA/ICh0MiA9IGJsb2NrXzAgPyBbe1xuICAgIF9rZXk6IGJsb2NrXzAuX2tleVxuICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICBfa2V5OiBwcm9wcy5sZWFmLl9rZXlcbiAgfV0gOiB2b2lkIDAsICRbOF0gPSBibG9ja18wLCAkWzldID0gcHJvcHMubGVhZi5fa2V5LCAkWzEwXSA9IHQyKSA6IHQyID0gJFsxMF07XG4gIGNvbnN0IHBhdGggPSB0MjtcbiAgbGV0IGFubm90YXRpb25NYXJrRGVmcywgY2hpbGRyZW47XG4gIGlmICgkWzExXSAhPT0gYmxvY2tfMCB8fCAkWzEyXSAhPT0gZWRpdG9yQWN0b3IgfHwgJFsxM10gIT09IGZvY3VzZWQgfHwgJFsxNF0gIT09IGxlZ2FjeVNjaGVtYSB8fCAkWzE1XSAhPT0gcGF0aCB8fCAkWzE2XSAhPT0gcHJvcHMuY2hpbGRyZW4gfHwgJFsxN10gIT09IHByb3BzLmxlYWYubWFya3MgfHwgJFsxOF0gIT09IHByb3BzLnJlbmRlckFubm90YXRpb24gfHwgJFsxOV0gIT09IHByb3BzLnJlbmRlckRlY29yYXRvciB8fCAkWzIwXSAhPT0gc2VsZWN0ZWQpIHtcbiAgICBjb25zdCBkZWNvcmF0b3JTY2hlbWFUeXBlcyA9IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEuZGVjb3JhdG9ycy5tYXAoX3RlbXAyJDEpLCBkZWNvcmF0b3JzID0gWy4uLm5ldyBTZXQoKHByb3BzLmxlYWYubWFya3MgPz8gW10pLmZpbHRlcigobWFyaykgPT4gZGVjb3JhdG9yU2NoZW1hVHlwZXMuaW5jbHVkZXMobWFyaykpKV07XG4gICAgYW5ub3RhdGlvbk1hcmtEZWZzID0gKHByb3BzLmxlYWYubWFya3MgPz8gW10pLmZsYXRNYXAoKG1hcmtfMCkgPT4ge1xuICAgICAgaWYgKGRlY29yYXRvclNjaGVtYVR5cGVzLmluY2x1ZGVzKG1hcmtfMCkpXG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIGNvbnN0IG1hcmtEZWZfMCA9IGJsb2NrXzA/Lm1hcmtEZWZzPy5maW5kKChtYXJrRGVmKSA9PiBtYXJrRGVmLl9rZXkgPT09IG1hcmtfMCk7XG4gICAgICByZXR1cm4gbWFya0RlZl8wID8gW21hcmtEZWZfMF0gOiBbXTtcbiAgICB9KSwgY2hpbGRyZW4gPSBwcm9wcy5jaGlsZHJlbjtcbiAgICBmb3IgKGNvbnN0IG1hcmtfMSBvZiBkZWNvcmF0b3JzKSB7XG4gICAgICBjb25zdCBsZWdhY3lEZWNvcmF0b3JTY2hlbWFUeXBlID0gbGVnYWN5U2NoZW1hLmRlY29yYXRvcnMuZmluZCgoZGVjKSA9PiBkZWMudmFsdWUgPT09IG1hcmtfMSk7XG4gICAgICBwYXRoICYmIGxlZ2FjeURlY29yYXRvclNjaGVtYVR5cGUgJiYgcHJvcHMucmVuZGVyRGVjb3JhdG9yICYmIChjaGlsZHJlbiA9IC8qIEBfX1BVUkVfXyAqLyBqc3goUmVuZGVyRGVjb3JhdG9yLCB7IHJlbmRlckRlY29yYXRvcjogcHJvcHMucmVuZGVyRGVjb3JhdG9yLCBlZGl0b3JFbGVtZW50UmVmOiBzcGFuUmVmLCBmb2N1c2VkLCBwYXRoLCBzZWxlY3RlZCwgc2NoZW1hVHlwZTogbGVnYWN5RGVjb3JhdG9yU2NoZW1hVHlwZSwgdmFsdWU6IG1hcmtfMSwgdHlwZTogbGVnYWN5RGVjb3JhdG9yU2NoZW1hVHlwZSwgY2hpbGRyZW4gfSkpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGFubm90YXRpb25NYXJrRGVmIG9mIGFubm90YXRpb25NYXJrRGVmcykge1xuICAgICAgY29uc3QgbGVnYWN5QW5ub3RhdGlvblNjaGVtYVR5cGUgPSBsZWdhY3lTY2hlbWEuYW5ub3RhdGlvbnMuZmluZCgodCkgPT4gdC5uYW1lID09PSBhbm5vdGF0aW9uTWFya0RlZi5fdHlwZSk7XG4gICAgICBsZWdhY3lBbm5vdGF0aW9uU2NoZW1hVHlwZSAmJiAoYmxvY2tfMCAmJiBwYXRoICYmIHByb3BzLnJlbmRlckFubm90YXRpb24gPyBjaGlsZHJlbiA9IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJzcGFuXCIsIHsgcmVmOiBzcGFuUmVmLCBjaGlsZHJlbjogLyogQF9fUFVSRV9fICovIGpzeChSZW5kZXJBbm5vdGF0aW9uLCB7IHJlbmRlckFubm90YXRpb246IHByb3BzLnJlbmRlckFubm90YXRpb24sIGJsb2NrOiBibG9ja18wLCBlZGl0b3JFbGVtZW50UmVmOiBzcGFuUmVmLCBmb2N1c2VkLCBwYXRoLCBzZWxlY3RlZCwgc2NoZW1hVHlwZTogbGVnYWN5QW5ub3RhdGlvblNjaGVtYVR5cGUsIHZhbHVlOiBhbm5vdGF0aW9uTWFya0RlZiwgdHlwZTogbGVnYWN5QW5ub3RhdGlvblNjaGVtYVR5cGUsIGNoaWxkcmVuIH0pIH0pIDogY2hpbGRyZW4gPSAvKiBAX19QVVJFX18gKi8ganN4KFwic3BhblwiLCB7IHJlZjogc3BhblJlZiwgY2hpbGRyZW4gfSkpO1xuICAgIH1cbiAgICAkWzExXSA9IGJsb2NrXzAsICRbMTJdID0gZWRpdG9yQWN0b3IsICRbMTNdID0gZm9jdXNlZCwgJFsxNF0gPSBsZWdhY3lTY2hlbWEsICRbMTVdID0gcGF0aCwgJFsxNl0gPSBwcm9wcy5jaGlsZHJlbiwgJFsxN10gPSBwcm9wcy5sZWFmLm1hcmtzLCAkWzE4XSA9IHByb3BzLnJlbmRlckFubm90YXRpb24sICRbMTldID0gcHJvcHMucmVuZGVyRGVjb3JhdG9yLCAkWzIwXSA9IHNlbGVjdGVkLCAkWzIxXSA9IGFubm90YXRpb25NYXJrRGVmcywgJFsyMl0gPSBjaGlsZHJlbjtcbiAgfSBlbHNlXG4gICAgYW5ub3RhdGlvbk1hcmtEZWZzID0gJFsyMV0sIGNoaWxkcmVuID0gJFsyMl07XG4gIGlmIChibG9ja18wICYmIHBhdGggJiYgcHJvcHMucmVuZGVyQ2hpbGQpIHtcbiAgICBsZXQgdDMyO1xuICAgIGlmICgkWzIzXSAhPT0gYmxvY2tfMC5jaGlsZHJlbiB8fCAkWzI0XSAhPT0gcHJvcHMubGVhZikge1xuICAgICAgbGV0IHQ0O1xuICAgICAgJFsyNl0gIT09IHByb3BzLmxlYWYgPyAodDQgPSAoX2NoaWxkKSA9PiBfY2hpbGQuX2tleSA9PT0gcHJvcHMubGVhZi5fa2V5LCAkWzI2XSA9IHByb3BzLmxlYWYsICRbMjddID0gdDQpIDogdDQgPSAkWzI3XSwgdDMyID0gYmxvY2tfMC5jaGlsZHJlbi5maW5kKHQ0KSwgJFsyM10gPSBibG9ja18wLmNoaWxkcmVuLCAkWzI0XSA9IHByb3BzLmxlYWYsICRbMjVdID0gdDMyO1xuICAgIH0gZWxzZVxuICAgICAgdDMyID0gJFsyNV07XG4gICAgY29uc3QgY2hpbGQgPSB0MzI7XG4gICAgaWYgKGNoaWxkKSB7XG4gICAgICBsZXQgdDQ7XG4gICAgICAkWzI4XSAhPT0gYW5ub3RhdGlvbk1hcmtEZWZzIHx8ICRbMjldICE9PSBjaGlsZCB8fCAkWzMwXSAhPT0gY2hpbGRyZW4gfHwgJFszMV0gIT09IGZvY3VzZWQgfHwgJFszMl0gIT09IGxlZ2FjeVNjaGVtYS5zcGFuIHx8ICRbMzNdICE9PSBwYXRoIHx8ICRbMzRdICE9PSBwcm9wcy5yZW5kZXJDaGlsZCB8fCAkWzM1XSAhPT0gc2VsZWN0ZWQgPyAodDQgPSAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlckNoaWxkLCB7IHJlbmRlckNoaWxkOiBwcm9wcy5yZW5kZXJDaGlsZCwgYW5ub3RhdGlvbnM6IGFubm90YXRpb25NYXJrRGVmcywgZWRpdG9yRWxlbWVudFJlZjogc3BhblJlZiwgZm9jdXNlZCwgcGF0aCwgc2NoZW1hVHlwZTogbGVnYWN5U2NoZW1hLnNwYW4sIHNlbGVjdGVkLCB2YWx1ZTogY2hpbGQsIHR5cGU6IGxlZ2FjeVNjaGVtYS5zcGFuLCBjaGlsZHJlbiB9KSwgJFsyOF0gPSBhbm5vdGF0aW9uTWFya0RlZnMsICRbMjldID0gY2hpbGQsICRbMzBdID0gY2hpbGRyZW4sICRbMzFdID0gZm9jdXNlZCwgJFszMl0gPSBsZWdhY3lTY2hlbWEuc3BhbiwgJFszM10gPSBwYXRoLCAkWzM0XSA9IHByb3BzLnJlbmRlckNoaWxkLCAkWzM1XSA9IHNlbGVjdGVkLCAkWzM2XSA9IHQ0KSA6IHQ0ID0gJFszNl0sIGNoaWxkcmVuID0gdDQ7XG4gICAgfVxuICB9XG4gIGxldCB0MztcbiAgcmV0dXJuICRbMzddICE9PSBjaGlsZHJlbiB8fCAkWzM4XSAhPT0gcHJvcHMuYXR0cmlidXRlcyA/ICh0MyA9IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJzcGFuXCIsIHsgLi4ucHJvcHMuYXR0cmlidXRlcywgcmVmOiBzcGFuUmVmLCBjaGlsZHJlbiB9KSwgJFszN10gPSBjaGlsZHJlbiwgJFszOF0gPSBwcm9wcy5hdHRyaWJ1dGVzLCAkWzM5XSA9IHQzKSA6IHQzID0gJFszOV0sIHQzO1xufVxuZnVuY3Rpb24gX3RlbXAyJDEoZGVjb3JhdG9yKSB7XG4gIHJldHVybiBkZWNvcmF0b3IubmFtZTtcbn1cbmZ1bmN0aW9uIF90ZW1wJDIocykge1xuICByZXR1cm4gcy5jb250ZXh0LmdldExlZ2FjeVNjaGVtYSgpO1xufVxuZnVuY3Rpb24gUmVuZGVyQW5ub3RhdGlvbih7XG4gIHJlbmRlckFubm90YXRpb24sXG4gIGJsb2NrLFxuICBjaGlsZHJlbixcbiAgZWRpdG9yRWxlbWVudFJlZixcbiAgZm9jdXNlZCxcbiAgcGF0aCxcbiAgc2NoZW1hVHlwZSxcbiAgc2VsZWN0ZWQsXG4gIHZhbHVlLFxuICB0eXBlXG59KSB7XG4gIHJldHVybiByZW5kZXJBbm5vdGF0aW9uKHtcbiAgICBibG9jayxcbiAgICBjaGlsZHJlbixcbiAgICBlZGl0b3JFbGVtZW50UmVmLFxuICAgIGZvY3VzZWQsXG4gICAgcGF0aCxcbiAgICBzY2hlbWFUeXBlLFxuICAgIHNlbGVjdGVkLFxuICAgIHZhbHVlLFxuICAgIHR5cGVcbiAgfSk7XG59XG5mdW5jdGlvbiBSZW5kZXJEZWNvcmF0b3Ioe1xuICByZW5kZXJEZWNvcmF0b3IsXG4gIGNoaWxkcmVuLFxuICBlZGl0b3JFbGVtZW50UmVmLFxuICBmb2N1c2VkLFxuICBwYXRoLFxuICBzY2hlbWFUeXBlLFxuICBzZWxlY3RlZCxcbiAgdmFsdWUsXG4gIHR5cGVcbn0pIHtcbiAgcmV0dXJuIHJlbmRlckRlY29yYXRvcih7XG4gICAgY2hpbGRyZW4sXG4gICAgZWRpdG9yRWxlbWVudFJlZixcbiAgICBmb2N1c2VkLFxuICAgIHBhdGgsXG4gICAgc2NoZW1hVHlwZSxcbiAgICBzZWxlY3RlZCxcbiAgICB2YWx1ZSxcbiAgICB0eXBlXG4gIH0pO1xufVxuZnVuY3Rpb24gUmVuZGVyQ2hpbGQoe1xuICByZW5kZXJDaGlsZCxcbiAgYW5ub3RhdGlvbnMsXG4gIGNoaWxkcmVuLFxuICBlZGl0b3JFbGVtZW50UmVmLFxuICBmb2N1c2VkLFxuICBwYXRoLFxuICBzY2hlbWFUeXBlLFxuICBzZWxlY3RlZCxcbiAgdmFsdWUsXG4gIHR5cGVcbn0pIHtcbiAgcmV0dXJuIHJlbmRlckNoaWxkKHtcbiAgICBhbm5vdGF0aW9ucyxcbiAgICBjaGlsZHJlbixcbiAgICBlZGl0b3JFbGVtZW50UmVmLFxuICAgIGZvY3VzZWQsXG4gICAgcGF0aCxcbiAgICBzY2hlbWFUeXBlLFxuICAgIHNlbGVjdGVkLFxuICAgIHZhbHVlLFxuICAgIHR5cGVcbiAgfSk7XG59XG5jb25zdCBQTEFDRUhPTERFUl9TVFlMRSA9IHtcbiAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgdXNlclNlbGVjdDogXCJub25lXCIsXG4gIHBvaW50ZXJFdmVudHM6IFwibm9uZVwiLFxuICBsZWZ0OiAwLFxuICByaWdodDogMFxufTtcbmZ1bmN0aW9uIFJlbmRlckxlYWYocHJvcHMpIHtcbiAgY29uc3QgJCA9IGMoMTIpLCBlZGl0b3JBY3RvciA9IHVzZUNvbnRleHQoRWRpdG9yQWN0b3JDb250ZXh0KSwgc2NoZW1hID0gdXNlU2VsZWN0b3IoZWRpdG9yQWN0b3IsIF90ZW1wJDEpO1xuICBpZiAocHJvcHMubGVhZi5fdHlwZSAhPT0gc2NoZW1hLnNwYW4ubmFtZSlcbiAgICByZXR1cm4gcHJvcHMuY2hpbGRyZW47XG4gIGxldCB0MDtcbiAgJFswXSAhPT0gcHJvcHMgPyAodDAgPSAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlclNwYW4sIHsgLi4ucHJvcHMgfSksICRbMF0gPSBwcm9wcywgJFsxXSA9IHQwKSA6IHQwID0gJFsxXTtcbiAgbGV0IHJlbmRlcmVkU3BhbiA9IHQwO1xuICBpZiAocHJvcHMucmVuZGVyUGxhY2Vob2xkZXIgJiYgcHJvcHMubGVhZi5wbGFjZWhvbGRlciAmJiBwcm9wcy50ZXh0LnRleHQgPT09IFwiXCIpIHtcbiAgICBsZXQgdDE7XG4gICAgJFsyXSAhPT0gcHJvcHMucmVuZGVyUGxhY2Vob2xkZXIgPyAodDEgPSBwcm9wcy5yZW5kZXJQbGFjZWhvbGRlcigpLCAkWzJdID0gcHJvcHMucmVuZGVyUGxhY2Vob2xkZXIsICRbM10gPSB0MSkgOiB0MSA9ICRbM107XG4gICAgbGV0IHQyO1xuICAgICRbNF0gIT09IHQxID8gKHQyID0gLyogQF9fUFVSRV9fICovIGpzeChcInNwYW5cIiwgeyBzdHlsZTogUExBQ0VIT0xERVJfU1RZTEUsIGNvbnRlbnRFZGl0YWJsZTogITEsIGNoaWxkcmVuOiB0MSB9KSwgJFs0XSA9IHQxLCAkWzVdID0gdDIpIDogdDIgPSAkWzVdO1xuICAgIGxldCB0MztcbiAgICByZXR1cm4gJFs2XSAhPT0gcmVuZGVyZWRTcGFuIHx8ICRbN10gIT09IHQyID8gKHQzID0gLyogQF9fUFVSRV9fICovIGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtcbiAgICAgIHQyLFxuICAgICAgcmVuZGVyZWRTcGFuXG4gICAgXSB9KSwgJFs2XSA9IHJlbmRlcmVkU3BhbiwgJFs3XSA9IHQyLCAkWzhdID0gdDMpIDogdDMgPSAkWzhdLCB0MztcbiAgfVxuICBjb25zdCByYW5nZURlY29yYXRpb24gPSBwcm9wcy5sZWFmLnJhbmdlRGVjb3JhdGlvbjtcbiAgaWYgKHJhbmdlRGVjb3JhdGlvbikge1xuICAgIGxldCB0MTtcbiAgICAkWzldICE9PSByYW5nZURlY29yYXRpb24gfHwgJFsxMF0gIT09IHJlbmRlcmVkU3BhbiA/ICh0MSA9IHJhbmdlRGVjb3JhdGlvbi5jb21wb25lbnQoe1xuICAgICAgY2hpbGRyZW46IHJlbmRlcmVkU3BhblxuICAgIH0pLCAkWzldID0gcmFuZ2VEZWNvcmF0aW9uLCAkWzEwXSA9IHJlbmRlcmVkU3BhbiwgJFsxMV0gPSB0MSkgOiB0MSA9ICRbMTFdLCByZW5kZXJlZFNwYW4gPSB0MTtcbiAgfVxuICByZXR1cm4gcmVuZGVyZWRTcGFuO1xufVxuZnVuY3Rpb24gX3RlbXAkMShzKSB7XG4gIHJldHVybiBzLmNvbnRleHQuc2NoZW1hO1xufVxuZnVuY3Rpb24gUmVuZGVyVGV4dChwcm9wcykge1xuICBjb25zdCAkID0gYyg1KTtcbiAgbGV0IHQwO1xuICByZXR1cm4gJFswXSAhPT0gcHJvcHMuYXR0cmlidXRlcyB8fCAkWzFdICE9PSBwcm9wcy5jaGlsZHJlbiB8fCAkWzJdICE9PSBwcm9wcy50ZXh0Ll9rZXkgfHwgJFszXSAhPT0gcHJvcHMudGV4dC5fdHlwZSA/ICh0MCA9IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJzcGFuXCIsIHsgLi4ucHJvcHMuYXR0cmlidXRlcywgXCJkYXRhLWNoaWxkLWtleVwiOiBwcm9wcy50ZXh0Ll9rZXksIFwiZGF0YS1jaGlsZC1uYW1lXCI6IHByb3BzLnRleHQuX3R5cGUsIFwiZGF0YS1jaGlsZC10eXBlXCI6IFwic3BhblwiLCBjaGlsZHJlbjogcHJvcHMuY2hpbGRyZW4gfSksICRbMF0gPSBwcm9wcy5hdHRyaWJ1dGVzLCAkWzFdID0gcHJvcHMuY2hpbGRyZW4sICRbMl0gPSBwcm9wcy50ZXh0Ll9rZXksICRbM10gPSBwcm9wcy50ZXh0Ll90eXBlLCAkWzRdID0gdDApIDogdDAgPSAkWzRdLCB0MDtcbn1cbmNvbnN0IElTX01BQyA9IHR5cGVvZiB3aW5kb3cgPCBcInVcIiAmJiAvTWFjfGlQb2R8aVBob25lfGlQYWQvLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpLCBtb2RpZmllcnMgPSB7XG4gIGFsdDogXCJhbHRLZXlcIixcbiAgY29udHJvbDogXCJjdHJsS2V5XCIsXG4gIG1ldGE6IFwibWV0YUtleVwiLFxuICBzaGlmdDogXCJzaGlmdEtleVwiXG59LCBhbGlhc2VzID0ge1xuICBhZGQ6IFwiK1wiLFxuICBicmVhazogXCJwYXVzZVwiLFxuICBjbWQ6IFwibWV0YVwiLFxuICBjb21tYW5kOiBcIm1ldGFcIixcbiAgY3RsOiBcImNvbnRyb2xcIixcbiAgY3RybDogXCJjb250cm9sXCIsXG4gIGRlbDogXCJkZWxldGVcIixcbiAgZG93bjogXCJhcnJvd2Rvd25cIixcbiAgZXNjOiBcImVzY2FwZVwiLFxuICBpbnM6IFwiaW5zZXJ0XCIsXG4gIGxlZnQ6IFwiYXJyb3dsZWZ0XCIsXG4gIG1vZDogSVNfTUFDID8gXCJtZXRhXCIgOiBcImNvbnRyb2xcIixcbiAgb3B0OiBcImFsdFwiLFxuICBvcHRpb246IFwiYWx0XCIsXG4gIHJldHVybjogXCJlbnRlclwiLFxuICByaWdodDogXCJhcnJvd3JpZ2h0XCIsXG4gIHNwYWNlOiBcIiBcIixcbiAgc3BhY2ViYXI6IFwiIFwiLFxuICB1cDogXCJhcnJvd3VwXCIsXG4gIHdpbjogXCJtZXRhXCIsXG4gIHdpbmRvd3M6IFwibWV0YVwiXG59LCBrZXlDb2RlcyA9IHtcbiAgYmFja3NwYWNlOiA4LFxuICB0YWI6IDksXG4gIGVudGVyOiAxMyxcbiAgc2hpZnQ6IDE2LFxuICBjb250cm9sOiAxNyxcbiAgYWx0OiAxOCxcbiAgcGF1c2U6IDE5LFxuICBjYXBzbG9jazogMjAsXG4gIGVzY2FwZTogMjcsXG4gIFwiIFwiOiAzMixcbiAgcGFnZXVwOiAzMyxcbiAgcGFnZWRvd246IDM0LFxuICBlbmQ6IDM1LFxuICBob21lOiAzNixcbiAgYXJyb3dsZWZ0OiAzNyxcbiAgYXJyb3d1cDogMzgsXG4gIGFycm93cmlnaHQ6IDM5LFxuICBhcnJvd2Rvd246IDQwLFxuICBpbnNlcnQ6IDQ1LFxuICBkZWxldGU6IDQ2LFxuICBtZXRhOiA5MSxcbiAgbnVtbG9jazogMTQ0LFxuICBzY3JvbGxsb2NrOiAxNDUsXG4gIFwiO1wiOiAxODYsXG4gIFwiPVwiOiAxODcsXG4gIFwiLFwiOiAxODgsXG4gIFwiLVwiOiAxODksXG4gIFwiLlwiOiAxOTAsXG4gIFwiL1wiOiAxOTEsXG4gIFwiYFwiOiAxOTIsXG4gIFwiW1wiOiAyMTksXG4gIFwiXFxcXFwiOiAyMjAsXG4gIFwiXVwiOiAyMjEsXG4gIFwiJ1wiOiAyMjIsXG4gIGYxOiAxMTIsXG4gIGYyOiAxMTMsXG4gIGYzOiAxMTQsXG4gIGY0OiAxMTUsXG4gIGY1OiAxMTYsXG4gIGY2OiAxMTcsXG4gIGY3OiAxMTgsXG4gIGY4OiAxMTksXG4gIGY5OiAxMjAsXG4gIGYxMDogMTIxLFxuICBmMTE6IDEyMixcbiAgZjEyOiAxMjMsXG4gIGYxMzogMTI0LFxuICBmMTQ6IDEyNSxcbiAgZjE1OiAxMjYsXG4gIGYxNjogMTI3LFxuICBmMTc6IDEyOCxcbiAgZjE4OiAxMjksXG4gIGYxOTogMTMwLFxuICBmMjA6IDEzMVxufTtcbmZ1bmN0aW9uIGlzSG90a2V5KGhvdGtleSwgZXZlbnQpIHtcbiAgcmV0dXJuIGNvbXBhcmVIb3RrZXkocGFyc2VIb3RrZXkoaG90a2V5KSwgZXZlbnQpO1xufVxuZnVuY3Rpb24gcGFyc2VIb3RrZXkoaG90a2V5KSB7XG4gIGNvbnN0IHBhcnNlZEhvdGtleSA9IHtcbiAgICBhbHRLZXk6ICExLFxuICAgIGN0cmxLZXk6ICExLFxuICAgIG1ldGFLZXk6ICExLFxuICAgIHNoaWZ0S2V5OiAhMVxuICB9LCBob3RrZXlTZWdtZW50cyA9IGhvdGtleS5yZXBsYWNlKFwiKytcIiwgXCIrYWRkXCIpLnNwbGl0KFwiK1wiKTtcbiAgZm9yIChjb25zdCByYXdIb3RrZXlTZWdtZW50IG9mIGhvdGtleVNlZ21lbnRzKSB7XG4gICAgY29uc3Qgb3B0aW9uYWwgPSByYXdIb3RrZXlTZWdtZW50LmVuZHNXaXRoKFwiP1wiKSAmJiByYXdIb3RrZXlTZWdtZW50Lmxlbmd0aCA+IDEsIGhvdGtleVNlZ21lbnQgPSBvcHRpb25hbCA/IHJhd0hvdGtleVNlZ21lbnQuc2xpY2UoMCwgLTEpIDogcmF3SG90a2V5U2VnbWVudCwga2V5TmFtZSA9IHRvS2V5TmFtZShob3RrZXlTZWdtZW50KSwgbW9kaWZpZXIgPSBtb2RpZmllcnNba2V5TmFtZV0sIGFsaWFzID0gYWxpYXNlc1tob3RrZXlTZWdtZW50XSwgY29kZTIgPSBrZXlDb2Rlc1trZXlOYW1lXTtcbiAgICBpZiAoaG90a2V5U2VnbWVudC5sZW5ndGggPiAxICYmIG1vZGlmaWVyID09PSB2b2lkIDAgJiYgYWxpYXMgPT09IHZvaWQgMCAmJiBjb2RlMiA9PT0gdm9pZCAwKVxuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgVW5rbm93biBtb2RpZmllcjogXCIke2hvdGtleVNlZ21lbnR9XCJgKTtcbiAgICAoaG90a2V5U2VnbWVudHMubGVuZ3RoID09PSAxIHx8IG1vZGlmaWVyID09PSB2b2lkIDApICYmIChwYXJzZWRIb3RrZXkua2V5ID0ga2V5TmFtZSwgcGFyc2VkSG90a2V5LmtleUNvZGUgPSB0b0tleUNvZGUoaG90a2V5U2VnbWVudCkpLCBtb2RpZmllciAhPT0gdm9pZCAwICYmIChwYXJzZWRIb3RrZXlbbW9kaWZpZXJdID0gb3B0aW9uYWwgPyBudWxsIDogITApO1xuICB9XG4gIHJldHVybiBwYXJzZWRIb3RrZXk7XG59XG5mdW5jdGlvbiBjb21wYXJlSG90a2V5KHBhcnNlZEhvdGtleSwgZXZlbnQpIHtcbiAgcmV0dXJuIChwYXJzZWRIb3RrZXkuYWx0S2V5ID09IG51bGwgfHwgcGFyc2VkSG90a2V5LmFsdEtleSA9PT0gZXZlbnQuYWx0S2V5KSAmJiAocGFyc2VkSG90a2V5LmN0cmxLZXkgPT0gbnVsbCB8fCBwYXJzZWRIb3RrZXkuY3RybEtleSA9PT0gZXZlbnQuY3RybEtleSkgJiYgKHBhcnNlZEhvdGtleS5tZXRhS2V5ID09IG51bGwgfHwgcGFyc2VkSG90a2V5Lm1ldGFLZXkgPT09IGV2ZW50Lm1ldGFLZXkpICYmIChwYXJzZWRIb3RrZXkuc2hpZnRLZXkgPT0gbnVsbCB8fCBwYXJzZWRIb3RrZXkuc2hpZnRLZXkgPT09IGV2ZW50LnNoaWZ0S2V5KSA/IHBhcnNlZEhvdGtleS5rZXlDb2RlICE9PSB2b2lkIDAgJiYgZXZlbnQua2V5Q29kZSAhPT0gdm9pZCAwID8gcGFyc2VkSG90a2V5LmtleUNvZGUgPT09IDkxICYmIGV2ZW50LmtleUNvZGUgPT09IDkzID8gITAgOiBwYXJzZWRIb3RrZXkua2V5Q29kZSA9PT0gZXZlbnQua2V5Q29kZSA6IHBhcnNlZEhvdGtleS5rZXlDb2RlID09PSBldmVudC5rZXlDb2RlIHx8IHBhcnNlZEhvdGtleS5rZXkgPT09IGV2ZW50LmtleS50b0xvd2VyQ2FzZSgpIDogITE7XG59XG5mdW5jdGlvbiB0b0tleUNvZGUobmFtZSkge1xuICBjb25zdCBrZXlOYW1lID0gdG9LZXlOYW1lKG5hbWUpO1xuICByZXR1cm4ga2V5Q29kZXNba2V5TmFtZV0gPz8ga2V5TmFtZS50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCk7XG59XG5mdW5jdGlvbiB0b0tleU5hbWUobmFtZSkge1xuICBjb25zdCBrZXlOYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuICByZXR1cm4gYWxpYXNlc1trZXlOYW1lXSA/PyBrZXlOYW1lO1xufVxuY29uc3QgZGVidWckZyA9IGRlYnVnV2l0aE5hbWUoXCJwbHVnaW46d2l0aEhvdEtleXNcIik7XG5mdW5jdGlvbiBjcmVhdGVXaXRoSG90a2V5cyhlZGl0b3JBY3RvciwgcG9ydGFibGVUZXh0RWRpdG9yLCBob3RrZXlzRnJvbU9wdGlvbnMpIHtcbiAgY29uc3QgcmVzZXJ2ZWRIb3RrZXlzID0gW1wiZW50ZXJcIiwgXCJ0YWJcIiwgXCJzaGlmdFwiLCBcImRlbGV0ZVwiLCBcImVuZFwiXSwgYWN0aXZlSG90a2V5cyA9IGhvdGtleXNGcm9tT3B0aW9ucyA/PyB7fTtcbiAgcmV0dXJuIGZ1bmN0aW9uKGVkaXRvcikge1xuICAgIHJldHVybiBlZGl0b3IucHRlV2l0aEhvdEtleXMgPSAoZXZlbnQpID0+IHtcbiAgICAgIE9iamVjdC5rZXlzKGFjdGl2ZUhvdGtleXMpLmZvckVhY2goKGNhdCkgPT4ge1xuICAgICAgICBpZiAoY2F0ID09PSBcIm1hcmtzXCIpXG4gICAgICAgICAgZm9yIChjb25zdCBob3RrZXkgaW4gYWN0aXZlSG90a2V5c1tjYXRdKSB7XG4gICAgICAgICAgICBpZiAocmVzZXJ2ZWRIb3RrZXlzLmluY2x1ZGVzKGhvdGtleSkpXG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGhvdGtleSAke2hvdGtleX0gaXMgcmVzZXJ2ZWQhYCk7XG4gICAgICAgICAgICBpZiAoaXNIb3RrZXkoaG90a2V5LCBldmVudC5uYXRpdmVFdmVudCkpIHtcbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgY29uc3QgcG9zc2libGVNYXJrID0gYWN0aXZlSG90a2V5c1tjYXRdO1xuICAgICAgICAgICAgICBpZiAocG9zc2libGVNYXJrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFyayA9IHBvc3NpYmxlTWFya1tob3RrZXldO1xuICAgICAgICAgICAgICAgIGRlYnVnJGcoYEhvdEtleSAke2hvdGtleX0gdG8gdG9nZ2xlICR7bWFya31gKSwgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgICAgICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZGVjb3JhdG9yLnRvZ2dsZVwiLFxuICAgICAgICAgICAgICAgICAgICBkZWNvcmF0b3I6IG1hcmtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBlZGl0b3JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgaWYgKGNhdCA9PT0gXCJjdXN0b21cIilcbiAgICAgICAgICBmb3IgKGNvbnN0IGhvdGtleSBpbiBhY3RpdmVIb3RrZXlzW2NhdF0pIHtcbiAgICAgICAgICAgIGlmIChyZXNlcnZlZEhvdGtleXMuaW5jbHVkZXMoaG90a2V5KSlcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgaG90a2V5ICR7aG90a2V5fSBpcyByZXNlcnZlZCFgKTtcbiAgICAgICAgICAgIGlmIChpc0hvdGtleShob3RrZXksIGV2ZW50Lm5hdGl2ZUV2ZW50KSkge1xuICAgICAgICAgICAgICBjb25zdCBwb3NzaWJsZUNvbW1hbmQgPSBhY3RpdmVIb3RrZXlzW2NhdF07XG4gICAgICAgICAgICAgIGlmIChwb3NzaWJsZUNvbW1hbmQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kID0gcG9zc2libGVDb21tYW5kW2hvdGtleV07XG4gICAgICAgICAgICAgICAgY29tbWFuZChldmVudCwgcG9ydGFibGVUZXh0RWRpdG9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIGVkaXRvcjtcbiAgfTtcbn1cbmNvbnN0IFBvcnRhYmxlVGV4dEVkaXRvckNvbnRleHQgPSBjcmVhdGVDb250ZXh0KG51bGwpLCB1c2VQb3J0YWJsZVRleHRFZGl0b3IgPSAoKSA9PiB7XG4gIGNvbnN0IGVkaXRvciA9IHVzZUNvbnRleHQoUG9ydGFibGVUZXh0RWRpdG9yQ29udGV4dCk7XG4gIGlmICghZWRpdG9yKVxuICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBgdXNlUG9ydGFibGVUZXh0RWRpdG9yYCBob29rIG11c3QgYmUgdXNlZCBpbnNpZGUgdGhlIDxQb3J0YWJsZVRleHRFZGl0b3I+IGNvbXBvbmVudCdzIGNvbnRleHQuXCIpO1xuICByZXR1cm4gZWRpdG9yO1xufSwgZGVidWckZiA9IGRlYnVnV2l0aE5hbWUoXCJ2YWxpZGF0ZSBzZWxlY3Rpb24gbWFjaGluZVwiKSwgdmFsaWRhdGVTZWxlY3Rpb25TZXR1cCA9IHNldHVwKHtcbiAgdHlwZXM6IHtcbiAgICBjb250ZXh0OiB7fSxcbiAgICBpbnB1dDoge30sXG4gICAgZXZlbnRzOiB7fVxuICB9LFxuICBndWFyZHM6IHtcbiAgICBcInBlbmRpbmcgb3BlcmF0aW9uc1wiOiAoe1xuICAgICAgY29udGV4dFxuICAgIH0pID0+IGNvbnRleHQuc2xhdGVFZGl0b3Iub3BlcmF0aW9ucy5sZW5ndGggPiAwXG4gIH1cbn0pLCB2YWxpZGF0ZVNlbGVjdGlvbkFjdGlvbiA9IHZhbGlkYXRlU2VsZWN0aW9uU2V0dXAuY3JlYXRlQWN0aW9uKCh7XG4gIGNvbnRleHQsXG4gIGV2ZW50XG59KSA9PiB7XG4gIHZhbGlkYXRlU2VsZWN0aW9uKGNvbnRleHQuc2xhdGVFZGl0b3IsIGV2ZW50LmVkaXRvckVsZW1lbnQpO1xufSksIHZhbGlkYXRlU2VsZWN0aW9uTWFjaGluZSA9IHZhbGlkYXRlU2VsZWN0aW9uU2V0dXAuY3JlYXRlTWFjaGluZSh7XG4gIGlkOiBcInZhbGlkYXRlIHNlbGVjdGlvblwiLFxuICBjb250ZXh0OiAoe1xuICAgIGlucHV0XG4gIH0pID0+ICh7XG4gICAgc2xhdGVFZGl0b3I6IGlucHV0LnNsYXRlRWRpdG9yXG4gIH0pLFxuICBpbml0aWFsOiBcImlkbGVcIixcbiAgc3RhdGVzOiB7XG4gICAgaWRsZToge1xuICAgICAgb246IHtcbiAgICAgICAgXCJ2YWxpZGF0ZSBzZWxlY3Rpb25cIjogW3tcbiAgICAgICAgICBndWFyZDogXCJwZW5kaW5nIG9wZXJhdGlvbnNcIixcbiAgICAgICAgICB0YXJnZXQ6IFwid2FpdGluZ1wiXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBhY3Rpb25zOiBbdmFsaWRhdGVTZWxlY3Rpb25BY3Rpb25dLFxuICAgICAgICAgIHRhcmdldDogXCJpZGxlXCJcbiAgICAgICAgfV1cbiAgICAgIH1cbiAgICB9LFxuICAgIHdhaXRpbmc6IHtcbiAgICAgIGFmdGVyOiB7XG4gICAgICAgIDA6IFt7XG4gICAgICAgICAgZ3VhcmQ6IFwicGVuZGluZyBvcGVyYXRpb25zXCIsXG4gICAgICAgICAgdGFyZ2V0OiBcIi5cIixcbiAgICAgICAgICByZWVudGVyOiAhMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgdGFyZ2V0OiBcImlkbGVcIixcbiAgICAgICAgICBhY3Rpb25zOiBbdmFsaWRhdGVTZWxlY3Rpb25BY3Rpb25dXG4gICAgICAgIH1dXG4gICAgICB9LFxuICAgICAgb246IHtcbiAgICAgICAgXCJ2YWxpZGF0ZSBzZWxlY3Rpb25cIjoge1xuICAgICAgICAgIHRhcmdldDogXCIuXCIsXG4gICAgICAgICAgcmVlbnRlcjogITBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5mdW5jdGlvbiB2YWxpZGF0ZVNlbGVjdGlvbihzbGF0ZUVkaXRvciwgZWRpdG9yRWxlbWVudCkge1xuICBpZiAoIXNsYXRlRWRpdG9yLnNlbGVjdGlvbilcbiAgICByZXR1cm47XG4gIGxldCByb290O1xuICB0cnkge1xuICAgIHJvb3QgPSBSZWFjdEVkaXRvci5maW5kRG9jdW1lbnRPclNoYWRvd1Jvb3Qoc2xhdGVFZGl0b3IpO1xuICB9IGNhdGNoIHtcbiAgfVxuICBpZiAoIXJvb3QgfHwgZWRpdG9yRWxlbWVudCAhPT0gcm9vdC5hY3RpdmVFbGVtZW50KVxuICAgIHJldHVybjtcbiAgY29uc3QgZG9tU2VsZWN0aW9uID0gUmVhY3RFZGl0b3IuZ2V0V2luZG93KHNsYXRlRWRpdG9yKS5nZXRTZWxlY3Rpb24oKTtcbiAgaWYgKCFkb21TZWxlY3Rpb24gfHwgZG9tU2VsZWN0aW9uLnJhbmdlQ291bnQgPT09IDApXG4gICAgcmV0dXJuO1xuICBjb25zdCBleGlzdGluZ0RPTVJhbmdlID0gZG9tU2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XG4gIHRyeSB7XG4gICAgY29uc3QgbmV3RE9NUmFuZ2UgPSBSZWFjdEVkaXRvci50b0RPTVJhbmdlKHNsYXRlRWRpdG9yLCBzbGF0ZUVkaXRvci5zZWxlY3Rpb24pO1xuICAgIChuZXdET01SYW5nZS5zdGFydE9mZnNldCAhPT0gZXhpc3RpbmdET01SYW5nZS5zdGFydE9mZnNldCB8fCBuZXdET01SYW5nZS5lbmRPZmZzZXQgIT09IGV4aXN0aW5nRE9NUmFuZ2UuZW5kT2Zmc2V0KSAmJiAoZGVidWckZihcIkRPTSByYW5nZSBvdXQgb2Ygc3luYywgdmFsaWRhdGluZyBzZWxlY3Rpb25cIiksIGRvbVNlbGVjdGlvbj8ucmVtb3ZlQWxsUmFuZ2VzKCksIGRvbVNlbGVjdGlvbi5hZGRSYW5nZShuZXdET01SYW5nZSkpO1xuICB9IGNhdGNoIHtcbiAgICBkZWJ1ZyRmKFwiQ291bGQgbm90IHJlc29sdmUgc2VsZWN0aW9uLCBzZWxlY3RpbmcgdG9wIGRvY3VtZW50XCIpLCBUcmFuc2Zvcm1zLmRlc2VsZWN0KHNsYXRlRWRpdG9yKSwgc2xhdGVFZGl0b3IuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiBUcmFuc2Zvcm1zLnNlbGVjdChzbGF0ZUVkaXRvciwgRWRpdG9yLnN0YXJ0KHNsYXRlRWRpdG9yLCBbXSkpLCBzbGF0ZUVkaXRvci5vbkNoYW5nZSgpO1xuICB9XG59XG5jb25zdCBkZWJ1ZyRlID0gZGVidWdXaXRoTmFtZShcImNvbXBvbmVudDpFZGl0YWJsZVwiKSwgUG9ydGFibGVUZXh0RWRpdGFibGUgPSBmb3J3YXJkUmVmKGZ1bmN0aW9uKHByb3BzLCBmb3J3YXJkZWRSZWYpIHtcbiAgY29uc3QgJCA9IGMoMTc2KTtcbiAgbGV0IGhvdGtleXMsIG9uQmVmb3JlSW5wdXQsIG9uQmx1ciwgb25DbGljaywgb25Db3B5LCBvbkN1dCwgb25EcmFnLCBvbkRyYWdFbmQsIG9uRHJhZ0VudGVyLCBvbkRyYWdMZWF2ZSwgb25EcmFnT3Zlciwgb25EcmFnU3RhcnQsIG9uRHJvcCwgb25Gb2N1cywgb25QYXN0ZSwgcHJvcHNTZWxlY3Rpb24sIHJhbmdlRGVjb3JhdGlvbnMsIHJlbmRlckFubm90YXRpb24sIHJlbmRlckJsb2NrLCByZW5kZXJDaGlsZCwgcmVuZGVyRGVjb3JhdG9yLCByZW5kZXJMaXN0SXRlbSwgcmVuZGVyUGxhY2Vob2xkZXIsIHJlbmRlclN0eWxlLCByZXN0UHJvcHMsIHNjcm9sbFNlbGVjdGlvbkludG9WaWV3LCBzcGVsbENoZWNrO1xuICAkWzBdICE9PSBwcm9wcyA/ICh7XG4gICAgaG90a2V5cyxcbiAgICBvbkJsdXIsXG4gICAgb25Gb2N1cyxcbiAgICBvbkJlZm9yZUlucHV0LFxuICAgIG9uUGFzdGUsXG4gICAgb25Db3B5LFxuICAgIG9uQ3V0LFxuICAgIG9uQ2xpY2ssXG4gICAgb25EcmFnU3RhcnQsXG4gICAgb25EcmFnLFxuICAgIG9uRHJhZ0VuZCxcbiAgICBvbkRyYWdFbnRlcixcbiAgICBvbkRyYWdPdmVyLFxuICAgIG9uRHJvcCxcbiAgICBvbkRyYWdMZWF2ZSxcbiAgICByYW5nZURlY29yYXRpb25zLFxuICAgIHJlbmRlckFubm90YXRpb24sXG4gICAgcmVuZGVyQmxvY2ssXG4gICAgcmVuZGVyQ2hpbGQsXG4gICAgcmVuZGVyRGVjb3JhdG9yLFxuICAgIHJlbmRlckxpc3RJdGVtLFxuICAgIHJlbmRlclBsYWNlaG9sZGVyLFxuICAgIHJlbmRlclN0eWxlLFxuICAgIHNlbGVjdGlvbjogcHJvcHNTZWxlY3Rpb24sXG4gICAgc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXcsXG4gICAgc3BlbGxDaGVjayxcbiAgICAuLi5yZXN0UHJvcHNcbiAgfSA9IHByb3BzLCAkWzBdID0gcHJvcHMsICRbMV0gPSBob3RrZXlzLCAkWzJdID0gb25CZWZvcmVJbnB1dCwgJFszXSA9IG9uQmx1ciwgJFs0XSA9IG9uQ2xpY2ssICRbNV0gPSBvbkNvcHksICRbNl0gPSBvbkN1dCwgJFs3XSA9IG9uRHJhZywgJFs4XSA9IG9uRHJhZ0VuZCwgJFs5XSA9IG9uRHJhZ0VudGVyLCAkWzEwXSA9IG9uRHJhZ0xlYXZlLCAkWzExXSA9IG9uRHJhZ092ZXIsICRbMTJdID0gb25EcmFnU3RhcnQsICRbMTNdID0gb25Ecm9wLCAkWzE0XSA9IG9uRm9jdXMsICRbMTVdID0gb25QYXN0ZSwgJFsxNl0gPSBwcm9wc1NlbGVjdGlvbiwgJFsxN10gPSByYW5nZURlY29yYXRpb25zLCAkWzE4XSA9IHJlbmRlckFubm90YXRpb24sICRbMTldID0gcmVuZGVyQmxvY2ssICRbMjBdID0gcmVuZGVyQ2hpbGQsICRbMjFdID0gcmVuZGVyRGVjb3JhdG9yLCAkWzIyXSA9IHJlbmRlckxpc3RJdGVtLCAkWzIzXSA9IHJlbmRlclBsYWNlaG9sZGVyLCAkWzI0XSA9IHJlbmRlclN0eWxlLCAkWzI1XSA9IHJlc3RQcm9wcywgJFsyNl0gPSBzY3JvbGxTZWxlY3Rpb25JbnRvVmlldywgJFsyN10gPSBzcGVsbENoZWNrKSA6IChob3RrZXlzID0gJFsxXSwgb25CZWZvcmVJbnB1dCA9ICRbMl0sIG9uQmx1ciA9ICRbM10sIG9uQ2xpY2sgPSAkWzRdLCBvbkNvcHkgPSAkWzVdLCBvbkN1dCA9ICRbNl0sIG9uRHJhZyA9ICRbN10sIG9uRHJhZ0VuZCA9ICRbOF0sIG9uRHJhZ0VudGVyID0gJFs5XSwgb25EcmFnTGVhdmUgPSAkWzEwXSwgb25EcmFnT3ZlciA9ICRbMTFdLCBvbkRyYWdTdGFydCA9ICRbMTJdLCBvbkRyb3AgPSAkWzEzXSwgb25Gb2N1cyA9ICRbMTRdLCBvblBhc3RlID0gJFsxNV0sIHByb3BzU2VsZWN0aW9uID0gJFsxNl0sIHJhbmdlRGVjb3JhdGlvbnMgPSAkWzE3XSwgcmVuZGVyQW5ub3RhdGlvbiA9ICRbMThdLCByZW5kZXJCbG9jayA9ICRbMTldLCByZW5kZXJDaGlsZCA9ICRbMjBdLCByZW5kZXJEZWNvcmF0b3IgPSAkWzIxXSwgcmVuZGVyTGlzdEl0ZW0gPSAkWzIyXSwgcmVuZGVyUGxhY2Vob2xkZXIgPSAkWzIzXSwgcmVuZGVyU3R5bGUgPSAkWzI0XSwgcmVzdFByb3BzID0gJFsyNV0sIHNjcm9sbFNlbGVjdGlvbkludG9WaWV3ID0gJFsyNl0sIHNwZWxsQ2hlY2sgPSAkWzI3XSk7XG4gIGNvbnN0IHBvcnRhYmxlVGV4dEVkaXRvciA9IHVzZVBvcnRhYmxlVGV4dEVkaXRvcigpLCBbaGFzSW52YWxpZFZhbHVlLCBzZXRIYXNJbnZhbGlkVmFsdWVdID0gdXNlU3RhdGUoITEpLCBlZGl0b3JBY3RvciA9IHVzZUNvbnRleHQoRWRpdG9yQWN0b3JDb250ZXh0KSwgcmVsYXlBY3RvciA9IHVzZUNvbnRleHQoUmVsYXlBY3RvckNvbnRleHQpLCByZWFkT25seSA9IHVzZVNlbGVjdG9yKGVkaXRvckFjdG9yLCBfdGVtcCksIHNsYXRlRWRpdG9yID0gdXNlU2xhdGUoKTtcbiAgbGV0IHQwO1xuICAkWzI4XSAhPT0gc2xhdGVFZGl0b3IgPyAodDAgPSB7XG4gICAgaW5wdXQ6IHtcbiAgICAgIHNsYXRlRWRpdG9yXG4gICAgfVxuICB9LCAkWzI4XSA9IHNsYXRlRWRpdG9yLCAkWzI5XSA9IHQwKSA6IHQwID0gJFsyOV07XG4gIGNvbnN0IHZhbGlkYXRlU2VsZWN0aW9uQWN0b3IgPSB1c2VBY3RvclJlZih2YWxpZGF0ZVNlbGVjdGlvbk1hY2hpbmUsIHQwKTtcbiAgbGV0IHQxO1xuICAkWzMwXSAhPT0gcmFuZ2VEZWNvcmF0aW9ucyA/ICh0MSA9IHJhbmdlRGVjb3JhdGlvbnMgPz8gW10sICRbMzBdID0gcmFuZ2VEZWNvcmF0aW9ucywgJFszMV0gPSB0MSkgOiB0MSA9ICRbMzFdO1xuICBsZXQgdDI7XG4gICRbMzJdICE9PSBlZGl0b3JBY3RvciA/ICh0MiA9IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCksICRbMzJdID0gZWRpdG9yQWN0b3IsICRbMzNdID0gdDIpIDogdDIgPSAkWzMzXTtcbiAgY29uc3QgdDMgPSB0Mi5jb250ZXh0LnNjaGVtYTtcbiAgbGV0IHQ0O1xuICAkWzM0XSAhPT0gZWRpdG9yQWN0b3IgPyAodDQgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLm1hdGNoZXMoe1xuICAgIHNldHVwOiBcInNldHRpbmcgdXBcIlxuICB9KSwgJFszNF0gPSBlZGl0b3JBY3RvciwgJFszNV0gPSB0NCkgOiB0NCA9ICRbMzVdO1xuICBjb25zdCB0NSA9ICF0NDtcbiAgbGV0IHQ2O1xuICAkWzM2XSAhPT0gcmVhZE9ubHkgfHwgJFszN10gIT09IHNsYXRlRWRpdG9yIHx8ICRbMzhdICE9PSB0MSB8fCAkWzM5XSAhPT0gdDIuY29udGV4dC5zY2hlbWEgfHwgJFs0MF0gIT09IHQ1ID8gKHQ2ID0ge1xuICAgIGlucHV0OiB7XG4gICAgICByYW5nZURlY29yYXRpb25zOiB0MSxcbiAgICAgIHJlYWRPbmx5LFxuICAgICAgc2NoZW1hOiB0MyxcbiAgICAgIHNsYXRlRWRpdG9yLFxuICAgICAgc2tpcFNldHVwOiB0NVxuICAgIH1cbiAgfSwgJFszNl0gPSByZWFkT25seSwgJFszN10gPSBzbGF0ZUVkaXRvciwgJFszOF0gPSB0MSwgJFszOV0gPSB0Mi5jb250ZXh0LnNjaGVtYSwgJFs0MF0gPSB0NSwgJFs0MV0gPSB0NikgOiB0NiA9ICRbNDFdO1xuICBjb25zdCByYW5nZURlY29yYXRpb25zQWN0b3IgPSB1c2VBY3RvclJlZihyYW5nZURlY29yYXRpb25zTWFjaGluZSwgdDYpLCBkZWNvcmF0ZSA9IHVzZVNlbGVjdG9yKHJhbmdlRGVjb3JhdGlvbnNBY3RvciwgX3RlbXAyKTtcbiAgbGV0IHQ3LCB0ODtcbiAgJFs0Ml0gIT09IHJhbmdlRGVjb3JhdGlvbnNBY3RvciB8fCAkWzQzXSAhPT0gcmVhZE9ubHkgPyAodDcgPSAoKSA9PiB7XG4gICAgcmFuZ2VEZWNvcmF0aW9uc0FjdG9yLnNlbmQoe1xuICAgICAgdHlwZTogXCJ1cGRhdGUgcmVhZCBvbmx5XCIsXG4gICAgICByZWFkT25seVxuICAgIH0pO1xuICB9LCB0OCA9IFtyYW5nZURlY29yYXRpb25zQWN0b3IsIHJlYWRPbmx5XSwgJFs0Ml0gPSByYW5nZURlY29yYXRpb25zQWN0b3IsICRbNDNdID0gcmVhZE9ubHksICRbNDRdID0gdDcsICRbNDVdID0gdDgpIDogKHQ3ID0gJFs0NF0sIHQ4ID0gJFs0NV0pLCB1c2VFZmZlY3QodDcsIHQ4KTtcbiAgbGV0IHQxMCwgdDk7XG4gICRbNDZdICE9PSByYW5nZURlY29yYXRpb25zIHx8ICRbNDddICE9PSByYW5nZURlY29yYXRpb25zQWN0b3IgPyAodDkgPSAoKSA9PiB7XG4gICAgcmFuZ2VEZWNvcmF0aW9uc0FjdG9yLnNlbmQoe1xuICAgICAgdHlwZTogXCJyYW5nZSBkZWNvcmF0aW9ucyB1cGRhdGVkXCIsXG4gICAgICByYW5nZURlY29yYXRpb25zOiByYW5nZURlY29yYXRpb25zID8/IFtdXG4gICAgfSk7XG4gIH0sIHQxMCA9IFtyYW5nZURlY29yYXRpb25zQWN0b3IsIHJhbmdlRGVjb3JhdGlvbnNdLCAkWzQ2XSA9IHJhbmdlRGVjb3JhdGlvbnMsICRbNDddID0gcmFuZ2VEZWNvcmF0aW9uc0FjdG9yLCAkWzQ4XSA9IHQxMCwgJFs0OV0gPSB0OSkgOiAodDEwID0gJFs0OF0sIHQ5ID0gJFs0OV0pLCB1c2VFZmZlY3QodDksIHQxMCk7XG4gIGJiMDoge1xuICAgIGlmIChyZWFkT25seSlcbiAgICAgIGJyZWFrIGJiMDtcbiAgICBjcmVhdGVXaXRoSG90a2V5cyhlZGl0b3JBY3RvciwgcG9ydGFibGVUZXh0RWRpdG9yLCBob3RrZXlzKShzbGF0ZUVkaXRvcik7XG4gIH1cbiAgbGV0IHQxMjtcbiAgJFs1MF0gIT09IHJlYWRPbmx5IHx8ICRbNTFdICE9PSByZW5kZXJCbG9jayB8fCAkWzUyXSAhPT0gcmVuZGVyQ2hpbGQgfHwgJFs1M10gIT09IHJlbmRlckxpc3RJdGVtIHx8ICRbNTRdICE9PSByZW5kZXJTdHlsZSB8fCAkWzU1XSAhPT0gc3BlbGxDaGVjayA/ICh0MTIgPSAoZVByb3BzKSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlckVsZW1lbnQsIHsgLi4uZVByb3BzLCByZWFkT25seSwgcmVuZGVyQmxvY2ssIHJlbmRlckNoaWxkLCByZW5kZXJMaXN0SXRlbSwgcmVuZGVyU3R5bGUsIHNwZWxsQ2hlY2sgfSksICRbNTBdID0gcmVhZE9ubHksICRbNTFdID0gcmVuZGVyQmxvY2ssICRbNTJdID0gcmVuZGVyQ2hpbGQsICRbNTNdID0gcmVuZGVyTGlzdEl0ZW0sICRbNTRdID0gcmVuZGVyU3R5bGUsICRbNTVdID0gc3BlbGxDaGVjaywgJFs1Nl0gPSB0MTIpIDogdDEyID0gJFs1Nl07XG4gIGNvbnN0IHJlbmRlckVsZW1lbnQgPSB0MTI7XG4gIGxldCB0MTM7XG4gICRbNTddICE9PSByZWFkT25seSB8fCAkWzU4XSAhPT0gcmVuZGVyQW5ub3RhdGlvbiB8fCAkWzU5XSAhPT0gcmVuZGVyQ2hpbGQgfHwgJFs2MF0gIT09IHJlbmRlckRlY29yYXRvciB8fCAkWzYxXSAhPT0gcmVuZGVyUGxhY2Vob2xkZXIgPyAodDEzID0gKGxlYWZQcm9wcykgPT4gLyogQF9fUFVSRV9fICovIGpzeChSZW5kZXJMZWFmLCB7IC4uLmxlYWZQcm9wcywgcmVhZE9ubHksIHJlbmRlckFubm90YXRpb24sIHJlbmRlckNoaWxkLCByZW5kZXJEZWNvcmF0b3IsIHJlbmRlclBsYWNlaG9sZGVyIH0pLCAkWzU3XSA9IHJlYWRPbmx5LCAkWzU4XSA9IHJlbmRlckFubm90YXRpb24sICRbNTldID0gcmVuZGVyQ2hpbGQsICRbNjBdID0gcmVuZGVyRGVjb3JhdG9yLCAkWzYxXSA9IHJlbmRlclBsYWNlaG9sZGVyLCAkWzYyXSA9IHQxMykgOiB0MTMgPSAkWzYyXTtcbiAgY29uc3QgcmVuZGVyTGVhZiA9IHQxMywgcmVuZGVyVGV4dCA9IF90ZW1wMztcbiAgbGV0IHQxNDtcbiAgJFs2M10gIT09IGVkaXRvckFjdG9yIHx8ICRbNjRdICE9PSBwcm9wc1NlbGVjdGlvbiB8fCAkWzY1XSAhPT0gc2xhdGVFZGl0b3IgPyAodDE0ID0gKCkgPT4ge1xuICAgIGlmIChwcm9wc1NlbGVjdGlvbikge1xuICAgICAgZGVidWckZShgU2VsZWN0aW9uIGZyb20gcHJvcHMgJHtKU09OLnN0cmluZ2lmeShwcm9wc1NlbGVjdGlvbil9YCk7XG4gICAgICBjb25zdCBub3JtYWxpemVkU2VsZWN0aW9uID0gbm9ybWFsaXplU2VsZWN0aW9uKHByb3BzU2VsZWN0aW9uLCBzbGF0ZUVkaXRvci52YWx1ZSk7XG4gICAgICBpZiAobm9ybWFsaXplZFNlbGVjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICBkZWJ1ZyRlKGBOb3JtYWxpemVkIHNlbGVjdGlvbiBmcm9tIHByb3BzICR7SlNPTi5zdHJpbmdpZnkobm9ybWFsaXplZFNlbGVjdGlvbil9YCk7XG4gICAgICAgIGNvbnN0IHNsYXRlUmFuZ2UgPSB0b1NsYXRlUmFuZ2Uoe1xuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICAgIHZhbHVlOiBzbGF0ZUVkaXRvci52YWx1ZSxcbiAgICAgICAgICAgIHNlbGVjdGlvbjogbm9ybWFsaXplZFNlbGVjdGlvblxuICAgICAgICAgIH0sXG4gICAgICAgICAgYmxvY2tJbmRleE1hcDogc2xhdGVFZGl0b3IuYmxvY2tJbmRleE1hcFxuICAgICAgICB9KTtcbiAgICAgICAgc2xhdGVSYW5nZSAmJiAoVHJhbnNmb3Jtcy5zZWxlY3Qoc2xhdGVFZGl0b3IsIHNsYXRlUmFuZ2UpLCBzbGF0ZUVkaXRvci5vcGVyYXRpb25zLnNvbWUoX3RlbXA0KSB8fCBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgICB0eXBlOiBcInVwZGF0ZSBzZWxlY3Rpb25cIixcbiAgICAgICAgICBzZWxlY3Rpb246IG5vcm1hbGl6ZWRTZWxlY3Rpb25cbiAgICAgICAgfSksIHNsYXRlRWRpdG9yLm9uQ2hhbmdlKCkpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgJFs2M10gPSBlZGl0b3JBY3RvciwgJFs2NF0gPSBwcm9wc1NlbGVjdGlvbiwgJFs2NV0gPSBzbGF0ZUVkaXRvciwgJFs2Nl0gPSB0MTQpIDogdDE0ID0gJFs2Nl07XG4gIGNvbnN0IHJlc3RvcmVTZWxlY3Rpb25Gcm9tUHJvcHMgPSB0MTQ7XG4gIGxldCB0MTUsIHQxNjtcbiAgJFs2N10gIT09IGVkaXRvckFjdG9yIHx8ICRbNjhdICE9PSByYW5nZURlY29yYXRpb25zQWN0b3IgfHwgJFs2OV0gIT09IHJlc3RvcmVTZWxlY3Rpb25Gcm9tUHJvcHMgPyAodDE1ID0gKCkgPT4ge1xuICAgIGNvbnN0IG9uUmVhZHkgPSBlZGl0b3JBY3Rvci5vbihcInJlYWR5XCIsICgpID0+IHtcbiAgICAgIHJhbmdlRGVjb3JhdGlvbnNBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJyZWFkeVwiXG4gICAgICB9KSwgcmVzdG9yZVNlbGVjdGlvbkZyb21Qcm9wcygpO1xuICAgIH0pLCBvbkludmFsaWRWYWx1ZSA9IGVkaXRvckFjdG9yLm9uKFwiaW52YWxpZCB2YWx1ZVwiLCAoKSA9PiB7XG4gICAgICBzZXRIYXNJbnZhbGlkVmFsdWUoITApO1xuICAgIH0pLCBvblZhbHVlQ2hhbmdlZCA9IGVkaXRvckFjdG9yLm9uKFwidmFsdWUgY2hhbmdlZFwiLCAoKSA9PiB7XG4gICAgICBzZXRIYXNJbnZhbGlkVmFsdWUoITEpO1xuICAgIH0pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBvblJlYWR5LnVuc3Vic2NyaWJlKCksIG9uSW52YWxpZFZhbHVlLnVuc3Vic2NyaWJlKCksIG9uVmFsdWVDaGFuZ2VkLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgfSwgdDE2ID0gW3JhbmdlRGVjb3JhdGlvbnNBY3RvciwgZWRpdG9yQWN0b3IsIHJlc3RvcmVTZWxlY3Rpb25Gcm9tUHJvcHNdLCAkWzY3XSA9IGVkaXRvckFjdG9yLCAkWzY4XSA9IHJhbmdlRGVjb3JhdGlvbnNBY3RvciwgJFs2OV0gPSByZXN0b3JlU2VsZWN0aW9uRnJvbVByb3BzLCAkWzcwXSA9IHQxNSwgJFs3MV0gPSB0MTYpIDogKHQxNSA9ICRbNzBdLCB0MTYgPSAkWzcxXSksIHVzZUVmZmVjdCh0MTUsIHQxNik7XG4gIGxldCB0MTcsIHQxODtcbiAgJFs3Ml0gIT09IGhhc0ludmFsaWRWYWx1ZSB8fCAkWzczXSAhPT0gcHJvcHNTZWxlY3Rpb24gfHwgJFs3NF0gIT09IHJlc3RvcmVTZWxlY3Rpb25Gcm9tUHJvcHMgPyAodDE3ID0gKCkgPT4ge1xuICAgIHByb3BzU2VsZWN0aW9uICYmICFoYXNJbnZhbGlkVmFsdWUgJiYgcmVzdG9yZVNlbGVjdGlvbkZyb21Qcm9wcygpO1xuICB9LCB0MTggPSBbaGFzSW52YWxpZFZhbHVlLCBwcm9wc1NlbGVjdGlvbiwgcmVzdG9yZVNlbGVjdGlvbkZyb21Qcm9wc10sICRbNzJdID0gaGFzSW52YWxpZFZhbHVlLCAkWzczXSA9IHByb3BzU2VsZWN0aW9uLCAkWzc0XSA9IHJlc3RvcmVTZWxlY3Rpb25Gcm9tUHJvcHMsICRbNzVdID0gdDE3LCAkWzc2XSA9IHQxOCkgOiAodDE3ID0gJFs3NV0sIHQxOCA9ICRbNzZdKSwgdXNlRWZmZWN0KHQxNywgdDE4KTtcbiAgbGV0IHQxOTtcbiAgJFs3N10gIT09IGVkaXRvckFjdG9yIHx8ICRbNzhdICE9PSBvbkNvcHkgfHwgJFs3OV0gIT09IHNsYXRlRWRpdG9yID8gKHQxOSA9IChldmVudCkgPT4ge1xuICAgIGlmIChvbkNvcHkpXG4gICAgICBvbkNvcHkoZXZlbnQpICE9PSB2b2lkIDAgJiYgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBlbHNlIGlmIChldmVudC5uYXRpdmVFdmVudC5jbGlwYm9hcmREYXRhKSB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKSwgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHNsYXRlRWRpdG9yLnNlbGVjdGlvbiA/IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgZWRpdG9yOiBzbGF0ZUVkaXRvcixcbiAgICAgICAgcmFuZ2U6IHNsYXRlRWRpdG9yLnNlbGVjdGlvblxuICAgICAgfSkgOiB2b2lkIDAsIHBvc2l0aW9uID0gc2VsZWN0aW9uID8ge1xuICAgICAgICBzZWxlY3Rpb25cbiAgICAgIH0gOiB2b2lkIDA7XG4gICAgICBpZiAoIXBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCBmaW5kIHBvc2l0aW9uIGZvciBjb3B5IGV2ZW50XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJjbGlwYm9hcmQuY29weVwiLFxuICAgICAgICAgIG9yaWdpbkV2ZW50OiB7XG4gICAgICAgICAgICBkYXRhVHJhbnNmZXI6IGV2ZW50Lm5hdGl2ZUV2ZW50LmNsaXBib2FyZERhdGFcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvc2l0aW9uXG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgICAgIG5hdGl2ZUV2ZW50OiBldmVudFxuICAgICAgfSk7XG4gICAgfVxuICB9LCAkWzc3XSA9IGVkaXRvckFjdG9yLCAkWzc4XSA9IG9uQ29weSwgJFs3OV0gPSBzbGF0ZUVkaXRvciwgJFs4MF0gPSB0MTkpIDogdDE5ID0gJFs4MF07XG4gIGNvbnN0IGhhbmRsZUNvcHkgPSB0MTk7XG4gIGxldCB0MjA7XG4gICRbODFdICE9PSBlZGl0b3JBY3RvciB8fCAkWzgyXSAhPT0gb25DdXQgfHwgJFs4M10gIT09IHNsYXRlRWRpdG9yID8gKHQyMCA9IChldmVudF8wKSA9PiB7XG4gICAgaWYgKG9uQ3V0KVxuICAgICAgb25DdXQoZXZlbnRfMCkgIT09IHZvaWQgMCAmJiBldmVudF8wLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZWxzZSBpZiAoZXZlbnRfMC5uYXRpdmVFdmVudC5jbGlwYm9hcmREYXRhKSB7XG4gICAgICBldmVudF8wLnN0b3BQcm9wYWdhdGlvbigpLCBldmVudF8wLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBzZWxlY3Rpb25fMCA9IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zZWxlY3Rpb24sIHBvc2l0aW9uXzAgPSBzZWxlY3Rpb25fMCA/IHtcbiAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25fMFxuICAgICAgfSA6IHZvaWQgMDtcbiAgICAgIGlmICghcG9zaXRpb25fMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgZmluZCBwb3NpdGlvbiBmb3IgY3V0IGV2ZW50XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJjbGlwYm9hcmQuY3V0XCIsXG4gICAgICAgICAgb3JpZ2luRXZlbnQ6IHtcbiAgICAgICAgICAgIGRhdGFUcmFuc2ZlcjogZXZlbnRfMC5uYXRpdmVFdmVudC5jbGlwYm9hcmREYXRhXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb25fMFxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3I6IHNsYXRlRWRpdG9yLFxuICAgICAgICBuYXRpdmVFdmVudDogZXZlbnRfMFxuICAgICAgfSk7XG4gICAgfVxuICB9LCAkWzgxXSA9IGVkaXRvckFjdG9yLCAkWzgyXSA9IG9uQ3V0LCAkWzgzXSA9IHNsYXRlRWRpdG9yLCAkWzg0XSA9IHQyMCkgOiB0MjAgPSAkWzg0XTtcbiAgY29uc3QgaGFuZGxlQ3V0ID0gdDIwO1xuICBsZXQgdDIxO1xuICAkWzg1XSAhPT0gZWRpdG9yQWN0b3IgfHwgJFs4Nl0gIT09IG9uUGFzdGUgfHwgJFs4N10gIT09IHBvcnRhYmxlVGV4dEVkaXRvciB8fCAkWzg4XSAhPT0gcmVsYXlBY3RvciB8fCAkWzg5XSAhPT0gc2xhdGVFZGl0b3IgPyAodDIxID0gKGV2ZW50XzEpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IHNsYXRlRWRpdG9yLnZhbHVlLCBwYXRoID0gKHNsYXRlRWRpdG9yLnNlbGVjdGlvbiA/IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgICBzY2hlbWE6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsXG4gICAgICBlZGl0b3I6IHNsYXRlRWRpdG9yLFxuICAgICAgcmFuZ2U6IHNsYXRlRWRpdG9yLnNlbGVjdGlvblxuICAgIH0pIDogbnVsbCk/LmZvY3VzLnBhdGggfHwgW10sIG9uUGFzdGVSZXN1bHQgPSBvblBhc3RlPy4oe1xuICAgICAgZXZlbnQ6IGV2ZW50XzEsXG4gICAgICB2YWx1ZSxcbiAgICAgIHBhdGgsXG4gICAgICBzY2hlbWFUeXBlczogcG9ydGFibGVUZXh0RWRpdG9yLnNjaGVtYVR5cGVzXG4gICAgfSk7XG4gICAgaWYgKG9uUGFzdGVSZXN1bHQgfHwgIXNsYXRlRWRpdG9yLnNlbGVjdGlvbilcbiAgICAgIGV2ZW50XzEucHJldmVudERlZmF1bHQoKSwgcmVsYXlBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJsb2FkaW5nXCJcbiAgICAgIH0pLCBQcm9taXNlLnJlc29sdmUob25QYXN0ZVJlc3VsdCkudGhlbigocmVzdWx0XzEpID0+IHtcbiAgICAgICAgaWYgKGRlYnVnJGUoXCJDdXN0b20gcGFzdGUgZnVuY3Rpb24gZnJvbSBjbGllbnQgcmVzb2x2ZWRcIiwgcmVzdWx0XzEpLCAhcmVzdWx0XzEgfHwgIXJlc3VsdF8xLmluc2VydCkge1xuICAgICAgICAgIGRlYnVnJGUoXCJObyByZXN1bHQgZnJvbSBjdXN0b20gcGFzdGUgaGFuZGxlciwgcGFzdGluZyBub3JtYWxseVwiKTtcbiAgICAgICAgICBjb25zdCBzZWxlY3Rpb25fMSA9IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zZWxlY3Rpb24sIHBvc2l0aW9uXzEgPSBzZWxlY3Rpb25fMSA/IHtcbiAgICAgICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uXzFcbiAgICAgICAgICB9IDogdm9pZCAwO1xuICAgICAgICAgIGlmICghcG9zaXRpb25fMSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGZpbmQgcG9zaXRpb24gZm9yIHBhc3RlIGV2ZW50XCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJjbGlwYm9hcmQucGFzdGVcIixcbiAgICAgICAgICAgICAgb3JpZ2luRXZlbnQ6IHtcbiAgICAgICAgICAgICAgICBkYXRhVHJhbnNmZXI6IGV2ZW50XzEuY2xpcGJvYXJkRGF0YVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb25fMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgICAgICAgICBuYXRpdmVFdmVudDogZXZlbnRfMVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgICByZXN1bHRfMS5pbnNlcnQgPyBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tzXCIsXG4gICAgICAgICAgICAgIGJsb2NrczogcGFyc2VCbG9ja3Moe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAgIGtleUdlbmVyYXRvcjogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmtleUdlbmVyYXRvcixcbiAgICAgICAgICAgICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmxvY2tzOiByZXN1bHRfMS5pbnNlcnQsXG4gICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgbm9ybWFsaXplOiAhMSxcbiAgICAgICAgICAgICAgICAgIHJlbW92ZVVudXNlZE1hcmtEZWZzOiAhMCxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRlRmllbGRzOiAhMVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHBsYWNlbWVudDogXCJhdXRvXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlZGl0b3I6IHNsYXRlRWRpdG9yXG4gICAgICAgICAgfSkgOiBjb25zb2xlLndhcm4oXCJZb3VyIG9uUGFzdGUgZnVuY3Rpb24gcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQ6XCIsIHJlc3VsdF8xKTtcbiAgICAgIH0pLmNhdGNoKF90ZW1wNSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIHJlbGF5QWN0b3Iuc2VuZCh7XG4gICAgICAgICAgdHlwZTogXCJkb25lIGxvYWRpbmdcIlxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIGVsc2UgaWYgKGV2ZW50XzEubmF0aXZlRXZlbnQuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgZXZlbnRfMS5wcmV2ZW50RGVmYXVsdCgpLCBldmVudF8xLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3Qgc2VsZWN0aW9uXzIgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2VsZWN0aW9uLCBwb3NpdGlvbl8yID0gc2VsZWN0aW9uXzIgPyB7XG4gICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uXzJcbiAgICAgIH0gOiB2b2lkIDA7XG4gICAgICBpZiAoIXBvc2l0aW9uXzIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGZpbmQgcG9zaXRpb24gZm9yIHBhc3RlIGV2ZW50XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJjbGlwYm9hcmQucGFzdGVcIixcbiAgICAgICAgICBvcmlnaW5FdmVudDoge1xuICAgICAgICAgICAgZGF0YVRyYW5zZmVyOiBldmVudF8xLm5hdGl2ZUV2ZW50LmNsaXBib2FyZERhdGFcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbl8yXG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgICAgIG5hdGl2ZUV2ZW50OiBldmVudF8xXG4gICAgICB9KTtcbiAgICB9XG4gICAgZGVidWckZShcIk5vIHJlc3VsdCBmcm9tIGN1c3RvbSBwYXN0ZSBoYW5kbGVyLCBwYXN0aW5nIG5vcm1hbGx5XCIpO1xuICB9LCAkWzg1XSA9IGVkaXRvckFjdG9yLCAkWzg2XSA9IG9uUGFzdGUsICRbODddID0gcG9ydGFibGVUZXh0RWRpdG9yLCAkWzg4XSA9IHJlbGF5QWN0b3IsICRbODldID0gc2xhdGVFZGl0b3IsICRbOTBdID0gdDIxKSA6IHQyMSA9ICRbOTBdO1xuICBjb25zdCBoYW5kbGVQYXN0ZSA9IHQyMTtcbiAgbGV0IHQyMjtcbiAgJFs5MV0gIT09IGVkaXRvckFjdG9yIHx8ICRbOTJdICE9PSBvbkZvY3VzIHx8ICRbOTNdICE9PSByZWxheUFjdG9yIHx8ICRbOTRdICE9PSBzbGF0ZUVkaXRvciA/ICh0MjIgPSAoZXZlbnRfMikgPT4ge1xuICAgIG9uRm9jdXMgJiYgb25Gb2N1cyhldmVudF8yKSwgZXZlbnRfMi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCAocmVsYXlBY3Rvci5zZW5kKHtcbiAgICAgIHR5cGU6IFwiZm9jdXNlZFwiLFxuICAgICAgZXZlbnQ6IGV2ZW50XzJcbiAgICB9KSwgIXNsYXRlRWRpdG9yLnNlbGVjdGlvbiAmJiBzbGF0ZUVkaXRvci5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgaXNFbXB0eVRleHRCbG9jayhlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQsIHNsYXRlRWRpdG9yLnZhbHVlLmF0KDApKSAmJiAoVHJhbnNmb3Jtcy5zZWxlY3Qoc2xhdGVFZGl0b3IsIEVkaXRvci5zdGFydChzbGF0ZUVkaXRvciwgW10pKSwgc2xhdGVFZGl0b3Iub25DaGFuZ2UoKSkpO1xuICB9LCAkWzkxXSA9IGVkaXRvckFjdG9yLCAkWzkyXSA9IG9uRm9jdXMsICRbOTNdID0gcmVsYXlBY3RvciwgJFs5NF0gPSBzbGF0ZUVkaXRvciwgJFs5NV0gPSB0MjIpIDogdDIyID0gJFs5NV07XG4gIGNvbnN0IGhhbmRsZU9uRm9jdXMgPSB0MjI7XG4gIGxldCB0MjM7XG4gICRbOTZdICE9PSBlZGl0b3JBY3RvciB8fCAkWzk3XSAhPT0gb25DbGljayB8fCAkWzk4XSAhPT0gc2xhdGVFZGl0b3IgPyAodDIzID0gKGV2ZW50XzMpID0+IHtcbiAgICBpZiAob25DbGljayAmJiBvbkNsaWNrKGV2ZW50XzMpLCBldmVudF8zLmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGV2ZW50XzMuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSlcbiAgICAgIHJldHVybjtcbiAgICBjb25zdCBwb3NpdGlvbl8zID0gZ2V0RXZlbnRQb3NpdGlvbih7XG4gICAgICBlZGl0b3JBY3RvcixcbiAgICAgIHNsYXRlRWRpdG9yLFxuICAgICAgZXZlbnQ6IGV2ZW50XzMubmF0aXZlRXZlbnRcbiAgICB9KTtcbiAgICBwb3NpdGlvbl8zICYmIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICB0eXBlOiBcIm1vdXNlLmNsaWNrXCIsXG4gICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbl8zXG4gICAgICB9LFxuICAgICAgZWRpdG9yOiBzbGF0ZUVkaXRvcixcbiAgICAgIG5hdGl2ZUV2ZW50OiBldmVudF8zXG4gICAgfSk7XG4gIH0sICRbOTZdID0gZWRpdG9yQWN0b3IsICRbOTddID0gb25DbGljaywgJFs5OF0gPSBzbGF0ZUVkaXRvciwgJFs5OV0gPSB0MjMpIDogdDIzID0gJFs5OV07XG4gIGNvbnN0IGhhbmRsZUNsaWNrID0gdDIzO1xuICBsZXQgdDI0O1xuICAkWzEwMF0gIT09IG9uQmx1ciB8fCAkWzEwMV0gIT09IHJlbGF5QWN0b3IgPyAodDI0ID0gKGV2ZW50XzQpID0+IHtcbiAgICBvbkJsdXIgJiYgb25CbHVyKGV2ZW50XzQpLCBldmVudF80LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgfHwgcmVsYXlBY3Rvci5zZW5kKHtcbiAgICAgIHR5cGU6IFwiYmx1cnJlZFwiLFxuICAgICAgZXZlbnQ6IGV2ZW50XzRcbiAgICB9KTtcbiAgfSwgJFsxMDBdID0gb25CbHVyLCAkWzEwMV0gPSByZWxheUFjdG9yLCAkWzEwMl0gPSB0MjQpIDogdDI0ID0gJFsxMDJdO1xuICBjb25zdCBoYW5kbGVPbkJsdXIgPSB0MjQ7XG4gIGxldCB0MjU7XG4gICRbMTAzXSAhPT0gb25CZWZvcmVJbnB1dCA/ICh0MjUgPSAoZXZlbnRfNSkgPT4ge1xuICAgIG9uQmVmb3JlSW5wdXQgJiYgb25CZWZvcmVJbnB1dChldmVudF81KTtcbiAgfSwgJFsxMDNdID0gb25CZWZvcmVJbnB1dCwgJFsxMDRdID0gdDI1KSA6IHQyNSA9ICRbMTA0XTtcbiAgY29uc3QgaGFuZGxlT25CZWZvcmVJbnB1dCA9IHQyNTtcbiAgbGV0IHQyNjtcbiAgJFsxMDVdICE9PSBlZGl0b3JBY3RvciB8fCAkWzEwNl0gIT09IHByb3BzIHx8ICRbMTA3XSAhPT0gc2xhdGVFZGl0b3IgPyAodDI2ID0gKGV2ZW50XzYpID0+IHtcbiAgICBwcm9wcy5vbktleURvd24gJiYgcHJvcHMub25LZXlEb3duKGV2ZW50XzYpLCBldmVudF82LmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IHNsYXRlRWRpdG9yLnB0ZVdpdGhIb3RLZXlzKGV2ZW50XzYpLCBldmVudF82LmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICB0eXBlOiBcImtleWJvYXJkLmtleWRvd25cIixcbiAgICAgICAgb3JpZ2luRXZlbnQ6IHtcbiAgICAgICAgICBrZXk6IGV2ZW50XzYua2V5LFxuICAgICAgICAgIGNvZGU6IGV2ZW50XzYuY29kZSxcbiAgICAgICAgICBhbHRLZXk6IGV2ZW50XzYuYWx0S2V5LFxuICAgICAgICAgIGN0cmxLZXk6IGV2ZW50XzYuY3RybEtleSxcbiAgICAgICAgICBtZXRhS2V5OiBldmVudF82Lm1ldGFLZXksXG4gICAgICAgICAgc2hpZnRLZXk6IGV2ZW50XzYuc2hpZnRLZXlcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgICBuYXRpdmVFdmVudDogZXZlbnRfNlxuICAgIH0pO1xuICB9LCAkWzEwNV0gPSBlZGl0b3JBY3RvciwgJFsxMDZdID0gcHJvcHMsICRbMTA3XSA9IHNsYXRlRWRpdG9yLCAkWzEwOF0gPSB0MjYpIDogdDI2ID0gJFsxMDhdO1xuICBjb25zdCBoYW5kbGVLZXlEb3duID0gdDI2O1xuICBsZXQgdDI3O1xuICAkWzEwOV0gIT09IGVkaXRvckFjdG9yIHx8ICRbMTEwXSAhPT0gcHJvcHMgfHwgJFsxMTFdICE9PSBzbGF0ZUVkaXRvciA/ICh0MjcgPSAoZXZlbnRfNykgPT4ge1xuICAgIHByb3BzLm9uS2V5VXAgJiYgcHJvcHMub25LZXlVcChldmVudF83KSwgZXZlbnRfNy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgdHlwZTogXCJrZXlib2FyZC5rZXl1cFwiLFxuICAgICAgICBvcmlnaW5FdmVudDoge1xuICAgICAgICAgIGtleTogZXZlbnRfNy5rZXksXG4gICAgICAgICAgY29kZTogZXZlbnRfNy5jb2RlLFxuICAgICAgICAgIGFsdEtleTogZXZlbnRfNy5hbHRLZXksXG4gICAgICAgICAgY3RybEtleTogZXZlbnRfNy5jdHJsS2V5LFxuICAgICAgICAgIG1ldGFLZXk6IGV2ZW50XzcubWV0YUtleSxcbiAgICAgICAgICBzaGlmdEtleTogZXZlbnRfNy5zaGlmdEtleVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZWRpdG9yOiBzbGF0ZUVkaXRvcixcbiAgICAgIG5hdGl2ZUV2ZW50OiBldmVudF83XG4gICAgfSk7XG4gIH0sICRbMTA5XSA9IGVkaXRvckFjdG9yLCAkWzExMF0gPSBwcm9wcywgJFsxMTFdID0gc2xhdGVFZGl0b3IsICRbMTEyXSA9IHQyNykgOiB0MjcgPSAkWzExMl07XG4gIGNvbnN0IGhhbmRsZUtleVVwID0gdDI3O1xuICBsZXQgdDI4O1xuICBiYjE6IHtcbiAgICBpZiAoc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXcgPT09IHZvaWQgMCkge1xuICAgICAgdDI4ID0gdm9pZCAwO1xuICAgICAgYnJlYWsgYmIxO1xuICAgIH1cbiAgICBpZiAoc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXcgPT09IG51bGwpIHtcbiAgICAgIHQyOCA9IG5vb3A7XG4gICAgICBicmVhayBiYjE7XG4gICAgfVxuICAgIGxldCB0MjkyO1xuICAgICRbMTEzXSAhPT0gcG9ydGFibGVUZXh0RWRpdG9yIHx8ICRbMTE0XSAhPT0gc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXcgPyAodDI5MiA9IChfZWRpdG9yLCBkb21SYW5nZSkgPT4ge1xuICAgICAgc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXcocG9ydGFibGVUZXh0RWRpdG9yLCBkb21SYW5nZSk7XG4gICAgfSwgJFsxMTNdID0gcG9ydGFibGVUZXh0RWRpdG9yLCAkWzExNF0gPSBzY3JvbGxTZWxlY3Rpb25JbnRvVmlldywgJFsxMTVdID0gdDI5MikgOiB0MjkyID0gJFsxMTVdLCB0MjggPSB0MjkyO1xuICB9XG4gIGNvbnN0IHNjcm9sbFNlbGVjdGlvbkludG9WaWV3VG9TbGF0ZSA9IHQyODtcbiAgbGV0IHQyOSwgdDMwO1xuICAkWzExNl0gIT09IGVkaXRvckFjdG9yIHx8ICRbMTE3XSAhPT0gc2xhdGVFZGl0b3IgPyAodDI5ID0gKCkgPT4ge1xuICAgIGNvbnN0IHdpbmRvdzIgPSBSZWFjdEVkaXRvci5nZXRXaW5kb3coc2xhdGVFZGl0b3IpLCBvbkRyYWdFbmRfMCA9ICgpID0+IHtcbiAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImRyYWdlbmRcIlxuICAgICAgfSk7XG4gICAgfSwgb25Ecm9wXzAgPSAoKSA9PiB7XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJkcm9wXCJcbiAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIHdpbmRvdzIuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbmRcIiwgb25EcmFnRW5kXzApLCB3aW5kb3cyLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIG9uRHJvcF8wKSwgKCkgPT4ge1xuICAgICAgd2luZG93Mi5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZHJhZ2VuZFwiLCBvbkRyYWdFbmRfMCksIHdpbmRvdzIuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgb25Ecm9wXzApO1xuICAgIH07XG4gIH0sIHQzMCA9IFtzbGF0ZUVkaXRvciwgZWRpdG9yQWN0b3JdLCAkWzExNl0gPSBlZGl0b3JBY3RvciwgJFsxMTddID0gc2xhdGVFZGl0b3IsICRbMTE4XSA9IHQyOSwgJFsxMTldID0gdDMwKSA6ICh0MjkgPSAkWzExOF0sIHQzMCA9ICRbMTE5XSksIHVzZUVmZmVjdCh0MjksIHQzMCk7XG4gIGxldCB0MzE7XG4gICRbMTIwXSAhPT0gZWRpdG9yQWN0b3IgfHwgJFsxMjFdICE9PSBvbkRyYWdTdGFydCB8fCAkWzEyMl0gIT09IHNsYXRlRWRpdG9yID8gKHQzMSA9IChldmVudF84KSA9PiB7XG4gICAgaWYgKG9uRHJhZ1N0YXJ0Py4oZXZlbnRfOCksIGV2ZW50XzguaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZXZlbnRfOC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKVxuICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IHBvc2l0aW9uXzQgPSBnZXRFdmVudFBvc2l0aW9uKHtcbiAgICAgIGVkaXRvckFjdG9yLFxuICAgICAgc2xhdGVFZGl0b3IsXG4gICAgICBldmVudDogZXZlbnRfOC5uYXRpdmVFdmVudFxuICAgIH0pO1xuICAgIGlmICghcG9zaXRpb25fNCkge1xuICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGZpbmQgcG9zaXRpb24gZm9yIGRyYWdzdGFydCBldmVudFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgdHlwZTogXCJkcmFnc3RhcnRcIixcbiAgICAgIG9yaWdpbjogcG9zaXRpb25fNFxuICAgIH0pLCBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgdHlwZTogXCJkcmFnLmRyYWdzdGFydFwiLFxuICAgICAgICBvcmlnaW5FdmVudDoge1xuICAgICAgICAgIGNsaWVudFg6IGV2ZW50XzguY2xpZW50WCxcbiAgICAgICAgICBjbGllbnRZOiBldmVudF84LmNsaWVudFksXG4gICAgICAgICAgZGF0YVRyYW5zZmVyOiBldmVudF84LmRhdGFUcmFuc2ZlclxuICAgICAgICB9LFxuICAgICAgICBwb3NpdGlvbjogcG9zaXRpb25fNFxuICAgICAgfSxcbiAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgICB9KSwgITA7XG4gIH0sICRbMTIwXSA9IGVkaXRvckFjdG9yLCAkWzEyMV0gPSBvbkRyYWdTdGFydCwgJFsxMjJdID0gc2xhdGVFZGl0b3IsICRbMTIzXSA9IHQzMSkgOiB0MzEgPSAkWzEyM107XG4gIGNvbnN0IGhhbmRsZURyYWdTdGFydCA9IHQzMTtcbiAgbGV0IHQzMjtcbiAgJFsxMjRdICE9PSBlZGl0b3JBY3RvciB8fCAkWzEyNV0gIT09IG9uRHJhZyB8fCAkWzEyNl0gIT09IHNsYXRlRWRpdG9yID8gKHQzMiA9IChldmVudF85KSA9PiB7XG4gICAgaWYgKG9uRHJhZz8uKGV2ZW50XzkpLCAhKGV2ZW50XzkuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZXZlbnRfOS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpIHx8ICFnZXRFdmVudFBvc2l0aW9uKHtcbiAgICAgIGVkaXRvckFjdG9yLFxuICAgICAgc2xhdGVFZGl0b3IsXG4gICAgICBldmVudDogZXZlbnRfOS5uYXRpdmVFdmVudFxuICAgIH0pKSlcbiAgICAgIHJldHVybiBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkcmFnLmRyYWdcIixcbiAgICAgICAgICBvcmlnaW5FdmVudDoge1xuICAgICAgICAgICAgZGF0YVRyYW5zZmVyOiBldmVudF85LmRhdGFUcmFuc2ZlclxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yOiBzbGF0ZUVkaXRvclxuICAgICAgfSksICEwO1xuICB9LCAkWzEyNF0gPSBlZGl0b3JBY3RvciwgJFsxMjVdID0gb25EcmFnLCAkWzEyNl0gPSBzbGF0ZUVkaXRvciwgJFsxMjddID0gdDMyKSA6IHQzMiA9ICRbMTI3XTtcbiAgY29uc3QgaGFuZGxlRHJhZyA9IHQzMjtcbiAgbGV0IHQzMztcbiAgJFsxMjhdICE9PSBlZGl0b3JBY3RvciB8fCAkWzEyOV0gIT09IG9uRHJhZ0VuZCB8fCAkWzEzMF0gIT09IHNsYXRlRWRpdG9yID8gKHQzMyA9IChldmVudF8xMCkgPT4ge1xuICAgIGlmIChvbkRyYWdFbmQ/LihldmVudF8xMCksICEoZXZlbnRfMTAuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZXZlbnRfMTAuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkpXG4gICAgICByZXR1cm4gZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiZHJhZy5kcmFnZW5kXCIsXG4gICAgICAgICAgb3JpZ2luRXZlbnQ6IHtcbiAgICAgICAgICAgIGRhdGFUcmFuc2ZlcjogZXZlbnRfMTAuZGF0YVRyYW5zZmVyXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3I6IHNsYXRlRWRpdG9yXG4gICAgICB9KSwgITA7XG4gIH0sICRbMTI4XSA9IGVkaXRvckFjdG9yLCAkWzEyOV0gPSBvbkRyYWdFbmQsICRbMTMwXSA9IHNsYXRlRWRpdG9yLCAkWzEzMV0gPSB0MzMpIDogdDMzID0gJFsxMzFdO1xuICBjb25zdCBoYW5kbGVEcmFnRW5kID0gdDMzO1xuICBsZXQgdDM0O1xuICAkWzEzMl0gIT09IGVkaXRvckFjdG9yIHx8ICRbMTMzXSAhPT0gb25EcmFnRW50ZXIgfHwgJFsxMzRdICE9PSBzbGF0ZUVkaXRvciA/ICh0MzQgPSAoZXZlbnRfMTEpID0+IHtcbiAgICBpZiAob25EcmFnRW50ZXI/LihldmVudF8xMSksIGV2ZW50XzExLmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGV2ZW50XzExLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpXG4gICAgICByZXR1cm47XG4gICAgY29uc3QgcG9zaXRpb25fNiA9IGdldEV2ZW50UG9zaXRpb24oe1xuICAgICAgZWRpdG9yQWN0b3IsXG4gICAgICBzbGF0ZUVkaXRvcixcbiAgICAgIGV2ZW50OiBldmVudF8xMS5uYXRpdmVFdmVudFxuICAgIH0pO1xuICAgIGlmIChwb3NpdGlvbl82KVxuICAgICAgcmV0dXJuIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRyYWcuZHJhZ2VudGVyXCIsXG4gICAgICAgICAgb3JpZ2luRXZlbnQ6IHtcbiAgICAgICAgICAgIGRhdGFUcmFuc2ZlcjogZXZlbnRfMTEuZGF0YVRyYW5zZmVyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb25fNlxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3I6IHNsYXRlRWRpdG9yXG4gICAgICB9KSwgITA7XG4gIH0sICRbMTMyXSA9IGVkaXRvckFjdG9yLCAkWzEzM10gPSBvbkRyYWdFbnRlciwgJFsxMzRdID0gc2xhdGVFZGl0b3IsICRbMTM1XSA9IHQzNCkgOiB0MzQgPSAkWzEzNV07XG4gIGNvbnN0IGhhbmRsZURyYWdFbnRlciA9IHQzNDtcbiAgbGV0IHQzNTtcbiAgJFsxMzZdICE9PSBlZGl0b3JBY3RvciB8fCAkWzEzN10gIT09IG9uRHJhZ092ZXIgfHwgJFsxMzhdICE9PSBzbGF0ZUVkaXRvciA/ICh0MzUgPSAoZXZlbnRfMTIpID0+IHtcbiAgICBpZiAob25EcmFnT3Zlcj8uKGV2ZW50XzEyKSwgZXZlbnRfMTIuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZXZlbnRfMTIuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSlcbiAgICAgIHJldHVybjtcbiAgICBjb25zdCBwb3NpdGlvbl83ID0gZ2V0RXZlbnRQb3NpdGlvbih7XG4gICAgICBlZGl0b3JBY3RvcixcbiAgICAgIHNsYXRlRWRpdG9yLFxuICAgICAgZXZlbnQ6IGV2ZW50XzEyLm5hdGl2ZUV2ZW50XG4gICAgfSk7XG4gICAgaWYgKHBvc2l0aW9uXzcpXG4gICAgICByZXR1cm4gZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiZHJhZy5kcmFnb3ZlclwiLFxuICAgICAgICAgIG9yaWdpbkV2ZW50OiB7XG4gICAgICAgICAgICBkYXRhVHJhbnNmZXI6IGV2ZW50XzEyLmRhdGFUcmFuc2ZlclxuICAgICAgICAgIH0sXG4gICAgICAgICAgZHJhZ09yaWdpbjogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmludGVybmFsRHJhZz8ub3JpZ2luLFxuICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbl83XG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3IsXG4gICAgICAgIG5hdGl2ZUV2ZW50OiBldmVudF8xMlxuICAgICAgfSksICEwO1xuICB9LCAkWzEzNl0gPSBlZGl0b3JBY3RvciwgJFsxMzddID0gb25EcmFnT3ZlciwgJFsxMzhdID0gc2xhdGVFZGl0b3IsICRbMTM5XSA9IHQzNSkgOiB0MzUgPSAkWzEzOV07XG4gIGNvbnN0IGhhbmRsZURyYWdPdmVyID0gdDM1O1xuICBsZXQgdDM2O1xuICAkWzE0MF0gIT09IGVkaXRvckFjdG9yIHx8ICRbMTQxXSAhPT0gb25Ecm9wIHx8ICRbMTQyXSAhPT0gc2xhdGVFZGl0b3IgPyAodDM2ID0gKGV2ZW50XzEzKSA9PiB7XG4gICAgaWYgKG9uRHJvcD8uKGV2ZW50XzEzKSwgZXZlbnRfMTMuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZXZlbnRfMTMuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSlcbiAgICAgIHJldHVybjtcbiAgICBjb25zdCBwb3NpdGlvbl84ID0gZ2V0RXZlbnRQb3NpdGlvbih7XG4gICAgICBlZGl0b3JBY3RvcixcbiAgICAgIHNsYXRlRWRpdG9yLFxuICAgICAgZXZlbnQ6IGV2ZW50XzEzLm5hdGl2ZUV2ZW50XG4gICAgfSk7XG4gICAgaWYgKCFwb3NpdGlvbl84KSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgZmluZCBwb3NpdGlvbiBmb3IgZHJvcCBldmVudFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICB0eXBlOiBcImRyYWcuZHJvcFwiLFxuICAgICAgICBvcmlnaW5FdmVudDoge1xuICAgICAgICAgIGRhdGFUcmFuc2ZlcjogZXZlbnRfMTMuZGF0YVRyYW5zZmVyXG4gICAgICAgIH0sXG4gICAgICAgIGRyYWdPcmlnaW46IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5pbnRlcm5hbERyYWc/Lm9yaWdpbixcbiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uXzhcbiAgICAgIH0sXG4gICAgICBlZGl0b3I6IHNsYXRlRWRpdG9yLFxuICAgICAgbmF0aXZlRXZlbnQ6IGV2ZW50XzEzXG4gICAgfSksICEwO1xuICB9LCAkWzE0MF0gPSBlZGl0b3JBY3RvciwgJFsxNDFdID0gb25Ecm9wLCAkWzE0Ml0gPSBzbGF0ZUVkaXRvciwgJFsxNDNdID0gdDM2KSA6IHQzNiA9ICRbMTQzXTtcbiAgY29uc3QgaGFuZGxlRHJvcCA9IHQzNjtcbiAgbGV0IHQzNztcbiAgJFsxNDRdICE9PSBlZGl0b3JBY3RvciB8fCAkWzE0NV0gIT09IG9uRHJhZ0xlYXZlIHx8ICRbMTQ2XSAhPT0gc2xhdGVFZGl0b3IgPyAodDM3ID0gKGV2ZW50XzE0KSA9PiB7XG4gICAgaWYgKG9uRHJhZ0xlYXZlPy4oZXZlbnRfMTQpLCAhKGV2ZW50XzE0LmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGV2ZW50XzE0LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgfHwgIWdldEV2ZW50UG9zaXRpb24oe1xuICAgICAgZWRpdG9yQWN0b3IsXG4gICAgICBzbGF0ZUVkaXRvcixcbiAgICAgIGV2ZW50OiBldmVudF8xNC5uYXRpdmVFdmVudFxuICAgIH0pKSlcbiAgICAgIHJldHVybiBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkcmFnLmRyYWdsZWF2ZVwiLFxuICAgICAgICAgIG9yaWdpbkV2ZW50OiB7XG4gICAgICAgICAgICBkYXRhVHJhbnNmZXI6IGV2ZW50XzE0LmRhdGFUcmFuc2ZlclxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yOiBzbGF0ZUVkaXRvclxuICAgICAgfSksICEwO1xuICB9LCAkWzE0NF0gPSBlZGl0b3JBY3RvciwgJFsxNDVdID0gb25EcmFnTGVhdmUsICRbMTQ2XSA9IHNsYXRlRWRpdG9yLCAkWzE0N10gPSB0MzcpIDogdDM3ID0gJFsxNDddO1xuICBjb25zdCBoYW5kbGVEcmFnTGVhdmUgPSB0Mzc7XG4gIGxldCB0Mzg7XG4gICRbMTQ4XSAhPT0gZm9yd2FyZGVkUmVmIHx8ICRbMTQ5XSAhPT0gdmFsaWRhdGVTZWxlY3Rpb25BY3RvciA/ICh0MzggPSAoZWRpdG9yRWxlbWVudCkgPT4ge1xuICAgIGlmICh0eXBlb2YgZm9yd2FyZGVkUmVmID09IFwiZnVuY3Rpb25cIiA/IGZvcndhcmRlZFJlZihlZGl0b3JFbGVtZW50KSA6IGZvcndhcmRlZFJlZiAmJiAoZm9yd2FyZGVkUmVmLmN1cnJlbnQgPSBlZGl0b3JFbGVtZW50KSwgZWRpdG9yRWxlbWVudCkge1xuICAgICAgY29uc3QgbXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICAgICAgdmFsaWRhdGVTZWxlY3Rpb25BY3Rvci5zZW5kKHtcbiAgICAgICAgICB0eXBlOiBcInZhbGlkYXRlIHNlbGVjdGlvblwiLFxuICAgICAgICAgIGVkaXRvckVsZW1lbnRcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtdXRhdGlvbk9ic2VydmVyLm9ic2VydmUoZWRpdG9yRWxlbWVudCwge1xuICAgICAgICBhdHRyaWJ1dGVPbGRWYWx1ZTogITEsXG4gICAgICAgIGF0dHJpYnV0ZXM6ICExLFxuICAgICAgICBjaGFyYWN0ZXJEYXRhOiAhMSxcbiAgICAgICAgY2hpbGRMaXN0OiAhMCxcbiAgICAgICAgc3VidHJlZTogITBcbiAgICAgIH0pLCAoKSA9PiB7XG4gICAgICAgIG11dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgfTtcbiAgICB9XG4gIH0sICRbMTQ4XSA9IGZvcndhcmRlZFJlZiwgJFsxNDldID0gdmFsaWRhdGVTZWxlY3Rpb25BY3RvciwgJFsxNTBdID0gdDM4KSA6IHQzOCA9ICRbMTUwXTtcbiAgY29uc3QgY2FsbGJhY2tSZWYgPSB0Mzg7XG4gIGlmICghcG9ydGFibGVUZXh0RWRpdG9yKVxuICAgIHJldHVybiBudWxsO1xuICBsZXQgdDM5O1xuICByZXR1cm4gJFsxNTFdICE9PSBjYWxsYmFja1JlZiB8fCAkWzE1Ml0gIT09IGRlY29yYXRlIHx8ICRbMTUzXSAhPT0gaGFuZGxlQ2xpY2sgfHwgJFsxNTRdICE9PSBoYW5kbGVDb3B5IHx8ICRbMTU1XSAhPT0gaGFuZGxlQ3V0IHx8ICRbMTU2XSAhPT0gaGFuZGxlRHJhZyB8fCAkWzE1N10gIT09IGhhbmRsZURyYWdFbmQgfHwgJFsxNThdICE9PSBoYW5kbGVEcmFnRW50ZXIgfHwgJFsxNTldICE9PSBoYW5kbGVEcmFnTGVhdmUgfHwgJFsxNjBdICE9PSBoYW5kbGVEcmFnT3ZlciB8fCAkWzE2MV0gIT09IGhhbmRsZURyYWdTdGFydCB8fCAkWzE2Ml0gIT09IGhhbmRsZURyb3AgfHwgJFsxNjNdICE9PSBoYW5kbGVLZXlEb3duIHx8ICRbMTY0XSAhPT0gaGFuZGxlS2V5VXAgfHwgJFsxNjVdICE9PSBoYW5kbGVPbkJlZm9yZUlucHV0IHx8ICRbMTY2XSAhPT0gaGFuZGxlT25CbHVyIHx8ICRbMTY3XSAhPT0gaGFuZGxlT25Gb2N1cyB8fCAkWzE2OF0gIT09IGhhbmRsZVBhc3RlIHx8ICRbMTY5XSAhPT0gaGFzSW52YWxpZFZhbHVlIHx8ICRbMTcwXSAhPT0gcmVhZE9ubHkgfHwgJFsxNzFdICE9PSByZW5kZXJFbGVtZW50IHx8ICRbMTcyXSAhPT0gcmVuZGVyTGVhZiB8fCAkWzE3M10gIT09IHJlc3RQcm9wcyB8fCAkWzE3NF0gIT09IHNjcm9sbFNlbGVjdGlvbkludG9WaWV3VG9TbGF0ZSA/ICh0MzkgPSBoYXNJbnZhbGlkVmFsdWUgPyBudWxsIDogLyogQF9fUFVSRV9fICovIGpzeChFZGl0YWJsZSwgeyAuLi5yZXN0UHJvcHMsIHJlZjogY2FsbGJhY2tSZWYsIFwiZGF0YS1yZWFkLW9ubHlcIjogcmVhZE9ubHksIGF1dG9Gb2N1czogITEsIGNsYXNzTmFtZTogcmVzdFByb3BzLmNsYXNzTmFtZSB8fCBcInB0LWVkaXRhYmxlXCIsIGRlY29yYXRlLCBvbkJsdXI6IGhhbmRsZU9uQmx1ciwgb25Db3B5OiBoYW5kbGVDb3B5LCBvbkN1dDogaGFuZGxlQ3V0LCBvbkNsaWNrOiBoYW5kbGVDbGljaywgb25ET01CZWZvcmVJbnB1dDogaGFuZGxlT25CZWZvcmVJbnB1dCwgb25EcmFnU3RhcnQ6IGhhbmRsZURyYWdTdGFydCwgb25EcmFnOiBoYW5kbGVEcmFnLCBvbkRyYWdFbmQ6IGhhbmRsZURyYWdFbmQsIG9uRHJhZ0VudGVyOiBoYW5kbGVEcmFnRW50ZXIsIG9uRHJhZ092ZXI6IGhhbmRsZURyYWdPdmVyLCBvbkRyb3A6IGhhbmRsZURyb3AsIG9uRHJhZ0xlYXZlOiBoYW5kbGVEcmFnTGVhdmUsIG9uRm9jdXM6IGhhbmRsZU9uRm9jdXMsIG9uS2V5RG93bjogaGFuZGxlS2V5RG93biwgb25LZXlVcDogaGFuZGxlS2V5VXAsIG9uUGFzdGU6IGhhbmRsZVBhc3RlLCByZWFkT25seSwgcmVuZGVyUGxhY2Vob2xkZXI6IHZvaWQgMCwgcmVuZGVyRWxlbWVudCwgcmVuZGVyTGVhZiwgcmVuZGVyVGV4dCwgc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXc6IHNjcm9sbFNlbGVjdGlvbkludG9WaWV3VG9TbGF0ZSB9KSwgJFsxNTFdID0gY2FsbGJhY2tSZWYsICRbMTUyXSA9IGRlY29yYXRlLCAkWzE1M10gPSBoYW5kbGVDbGljaywgJFsxNTRdID0gaGFuZGxlQ29weSwgJFsxNTVdID0gaGFuZGxlQ3V0LCAkWzE1Nl0gPSBoYW5kbGVEcmFnLCAkWzE1N10gPSBoYW5kbGVEcmFnRW5kLCAkWzE1OF0gPSBoYW5kbGVEcmFnRW50ZXIsICRbMTU5XSA9IGhhbmRsZURyYWdMZWF2ZSwgJFsxNjBdID0gaGFuZGxlRHJhZ092ZXIsICRbMTYxXSA9IGhhbmRsZURyYWdTdGFydCwgJFsxNjJdID0gaGFuZGxlRHJvcCwgJFsxNjNdID0gaGFuZGxlS2V5RG93biwgJFsxNjRdID0gaGFuZGxlS2V5VXAsICRbMTY1XSA9IGhhbmRsZU9uQmVmb3JlSW5wdXQsICRbMTY2XSA9IGhhbmRsZU9uQmx1ciwgJFsxNjddID0gaGFuZGxlT25Gb2N1cywgJFsxNjhdID0gaGFuZGxlUGFzdGUsICRbMTY5XSA9IGhhc0ludmFsaWRWYWx1ZSwgJFsxNzBdID0gcmVhZE9ubHksICRbMTcxXSA9IHJlbmRlckVsZW1lbnQsICRbMTcyXSA9IHJlbmRlckxlYWYsICRbMTczXSA9IHJlc3RQcm9wcywgJFsxNzRdID0gc2Nyb2xsU2VsZWN0aW9uSW50b1ZpZXdUb1NsYXRlLCAkWzE3NV0gPSB0MzkpIDogdDM5ID0gJFsxNzVdLCB0Mzk7XG59KTtcblBvcnRhYmxlVGV4dEVkaXRhYmxlLmRpc3BsYXlOYW1lID0gXCJGb3J3YXJkUmVmKFBvcnRhYmxlVGV4dEVkaXRhYmxlKVwiO1xuZnVuY3Rpb24gbm9vcCgpIHtcbn1cbmZ1bmN0aW9uIF90ZW1wKHMpIHtcbiAgcmV0dXJuIHMubWF0Y2hlcyh7XG4gICAgXCJlZGl0IG1vZGVcIjogXCJyZWFkIG9ubHlcIlxuICB9KTtcbn1cbmZ1bmN0aW9uIF90ZW1wMihzXzApIHtcbiAgcmV0dXJuIHNfMC5jb250ZXh0LmRlY29yYXRlPy5mbjtcbn1cbmZ1bmN0aW9uIF90ZW1wMyhwcm9wc18wKSB7XG4gIHJldHVybiAvKiBAX19QVVJFX18gKi8ganN4KFJlbmRlclRleHQsIHsgLi4ucHJvcHNfMCB9KTtcbn1cbmZ1bmN0aW9uIF90ZW1wNChvKSB7XG4gIHJldHVybiBvLnR5cGUgPT09IFwic2V0X3NlbGVjdGlvblwiO1xufVxuZnVuY3Rpb24gX3RlbXA1KGVycm9yKSB7XG4gIHJldHVybiBjb25zb2xlLndhcm4oZXJyb3IpLCBlcnJvcjtcbn1cbmNvbnN0IGZvckVhY2hBY3RvciA9IChhY3RvclJlZiwgY2FsbGJhY2spID0+IHtcbiAgY2FsbGJhY2soYWN0b3JSZWYpO1xuICBjb25zdCBjaGlsZHJlbiA9IGFjdG9yUmVmLmdldFNuYXBzaG90KCkuY2hpbGRyZW47XG4gIGNoaWxkcmVuICYmIE9iamVjdC52YWx1ZXMoY2hpbGRyZW4pLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgZm9yRWFjaEFjdG9yKGNoaWxkLCBjYWxsYmFjayk7XG4gIH0pO1xufTtcbmZ1bmN0aW9uIHN0b3BBY3RvcihhY3RvclJlZikge1xuICBjb25zdCBwZXJzaXN0ZWRTbmFwc2hvdHMgPSBbXTtcbiAgZm9yRWFjaEFjdG9yKGFjdG9yUmVmLCAocmVmKSA9PiB7XG4gICAgcGVyc2lzdGVkU25hcHNob3RzLnB1c2goW3JlZiwgcmVmLmdldFNuYXBzaG90KCldKSwgcmVmLm9ic2VydmVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gIH0pO1xuICBjb25zdCBzeXN0ZW1TbmFwc2hvdCA9IGFjdG9yUmVmLnN5c3RlbS5nZXRTbmFwc2hvdD8uKCk7XG4gIGFjdG9yUmVmLnN0b3AoKSwgYWN0b3JSZWYuc3lzdGVtLl9zbmFwc2hvdCA9IHN5c3RlbVNuYXBzaG90LCBwZXJzaXN0ZWRTbmFwc2hvdHMuZm9yRWFjaCgoW3JlZiwgc25hcHNob3RdKSA9PiB7XG4gICAgcmVmLl9wcm9jZXNzaW5nU3RhdHVzID0gMCwgcmVmLl9zbmFwc2hvdCA9IHNuYXBzaG90O1xuICB9KTtcbn1cbmNvbnN0IGNvbnZlcnRlckpzb24gPSB7XG4gIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgc2VyaWFsaXplOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBjb25zdCBwb3J0YWJsZVRleHRDb252ZXJ0ZXIgPSBzbmFwc2hvdC5jb250ZXh0LmNvbnZlcnRlcnMuZmluZCgoY29udmVydGVyKSA9PiBjb252ZXJ0ZXIubWltZVR5cGUgPT09IFwiYXBwbGljYXRpb24veC1wb3J0YWJsZS10ZXh0XCIpO1xuICAgIHJldHVybiBwb3J0YWJsZVRleHRDb252ZXJ0ZXIgPyB7XG4gICAgICAuLi5wb3J0YWJsZVRleHRDb252ZXJ0ZXIuc2VyaWFsaXplKHtcbiAgICAgICAgc25hcHNob3QsXG4gICAgICAgIGV2ZW50XG4gICAgICB9KSxcbiAgICAgIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICAgIH0gOiB7XG4gICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICAgICAgbWltZVR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50LFxuICAgICAgcmVhc29uOiBcIk5vIGFwcGxpY2F0aW9uL3gtcG9ydGFibGUtdGV4dCBDb252ZXJ0ZXIgZm91bmRcIlxuICAgIH07XG4gIH0sXG4gIGRlc2VyaWFsaXplOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBjb25zdCBwb3J0YWJsZVRleHRDb252ZXJ0ZXIgPSBzbmFwc2hvdC5jb250ZXh0LmNvbnZlcnRlcnMuZmluZCgoY29udmVydGVyKSA9PiBjb252ZXJ0ZXIubWltZVR5cGUgPT09IFwiYXBwbGljYXRpb24veC1wb3J0YWJsZS10ZXh0XCIpO1xuICAgIHJldHVybiBwb3J0YWJsZVRleHRDb252ZXJ0ZXIgPyB7XG4gICAgICAuLi5wb3J0YWJsZVRleHRDb252ZXJ0ZXIuZGVzZXJpYWxpemUoe1xuICAgICAgICBzbmFwc2hvdCxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pLFxuICAgICAgbWltZVR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfSA6IHtcbiAgICAgIHR5cGU6IFwiZGVzZXJpYWxpemF0aW9uLmZhaWx1cmVcIixcbiAgICAgIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIHJlYXNvbjogXCJObyBhcHBsaWNhdGlvbi94LXBvcnRhYmxlLXRleHQgQ29udmVydGVyIGZvdW5kXCJcbiAgICB9O1xuICB9XG59LCBjb252ZXJ0ZXJQb3J0YWJsZVRleHQgPSB7XG4gIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL3gtcG9ydGFibGUtdGV4dFwiLFxuICBzZXJpYWxpemU6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICAgICAgICBtaW1lVHlwZTogXCJhcHBsaWNhdGlvbi94LXBvcnRhYmxlLXRleHRcIixcbiAgICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50LFxuICAgICAgICByZWFzb246IFwiTm8gc2VsZWN0aW9uXCJcbiAgICAgIH07XG4gICAgY29uc3QgYmxvY2tzID0gZ2V0U2VsZWN0ZWRWYWx1ZShzbmFwc2hvdCk7XG4gICAgcmV0dXJuIGJsb2Nrcy5sZW5ndGggPT09IDAgPyB7XG4gICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICAgICAgbWltZVR5cGU6IFwiYXBwbGljYXRpb24veC1wb3J0YWJsZS10ZXh0XCIsXG4gICAgICByZWFzb246IFwiTm8gYmxvY2tzIHNlcmlhbGl6ZWRcIixcbiAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICAgIH0gOiB7XG4gICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoYmxvY2tzKSxcbiAgICAgIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL3gtcG9ydGFibGUtdGV4dFwiLFxuICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgfTtcbiAgfSxcbiAgZGVzZXJpYWxpemU6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGJsb2NrcyA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGJsb2NrcykpXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcImRlc2VyaWFsaXphdGlvbi5mYWlsdXJlXCIsXG4gICAgICAgIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL3gtcG9ydGFibGUtdGV4dFwiLFxuICAgICAgICByZWFzb246IFwiRGF0YSBpcyBub3QgYW4gYXJyYXlcIlxuICAgICAgfTtcbiAgICBjb25zdCBwYXJzZWRCbG9ja3MgPSBibG9ja3MuZmxhdE1hcCgoYmxvY2spID0+IHtcbiAgICAgIGNvbnN0IHBhcnNlZEJsb2NrID0gcGFyc2VCbG9jayh7XG4gICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIGJsb2NrLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgbm9ybWFsaXplOiAhMSxcbiAgICAgICAgICByZW1vdmVVbnVzZWRNYXJrRGVmczogITAsXG4gICAgICAgICAgdmFsaWRhdGVGaWVsZHM6ICExXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhcnNlZEJsb2NrID8gW3BhcnNlZEJsb2NrXSA6IFtdO1xuICAgIH0pO1xuICAgIHJldHVybiBwYXJzZWRCbG9ja3MubGVuZ3RoID09PSAwICYmIGJsb2Nrcy5sZW5ndGggPiAwID8ge1xuICAgICAgdHlwZTogXCJkZXNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICAgICAgbWltZVR5cGU6IFwiYXBwbGljYXRpb24veC1wb3J0YWJsZS10ZXh0XCIsXG4gICAgICByZWFzb246IFwiTm8gYmxvY2tzIHdlcmUgcGFyc2VkXCJcbiAgICB9IDoge1xuICAgICAgdHlwZTogXCJkZXNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgICAgZGF0YTogcGFyc2VkQmxvY2tzLFxuICAgICAgbWltZVR5cGU6IFwiYXBwbGljYXRpb24veC1wb3J0YWJsZS10ZXh0XCJcbiAgICB9O1xuICB9XG59O1xuZnVuY3Rpb24gY3JlYXRlQ29udmVydGVyVGV4dEh0bWwobGVnYWN5U2NoZW1hKSB7XG4gIHJldHVybiB7XG4gICAgbWltZVR5cGU6IFwidGV4dC9odG1sXCIsXG4gICAgc2VyaWFsaXplOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogXCJzZXJpYWxpemF0aW9uLmZhaWx1cmVcIixcbiAgICAgICAgICBtaW1lVHlwZTogXCJ0ZXh0L2h0bWxcIixcbiAgICAgICAgICBvcmlnaW5FdmVudDogZXZlbnQub3JpZ2luRXZlbnQsXG4gICAgICAgICAgcmVhc29uOiBcIk5vIHNlbGVjdGlvblwiXG4gICAgICAgIH07XG4gICAgICBjb25zdCBibG9ja3MgPSBnZXRTZWxlY3RlZFZhbHVlKHNuYXBzaG90KSwgaHRtbCA9IHRvSFRNTChibG9ja3MsIHtcbiAgICAgICAgb25NaXNzaW5nQ29tcG9uZW50OiAhMSxcbiAgICAgICAgY29tcG9uZW50czoge1xuICAgICAgICAgIHVua25vd25UeXBlOiAoe1xuICAgICAgICAgICAgY2hpbGRyZW5cbiAgICAgICAgICB9KSA9PiBjaGlsZHJlbiAhPT0gdm9pZCAwID8gYCR7Y2hpbGRyZW59YCA6IFwiXCJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaHRtbCA9PT0gXCJcIiA/IHtcbiAgICAgICAgdHlwZTogXCJzZXJpYWxpemF0aW9uLmZhaWx1cmVcIixcbiAgICAgICAgbWltZVR5cGU6IFwidGV4dC9odG1sXCIsXG4gICAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudCxcbiAgICAgICAgcmVhc29uOiBcIlNlcmlhbGl6ZWQgSFRNTCBpcyBlbXB0eVwiXG4gICAgICB9IDoge1xuICAgICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgICAgICBkYXRhOiBodG1sLFxuICAgICAgICBtaW1lVHlwZTogXCJ0ZXh0L2h0bWxcIixcbiAgICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgICB9O1xuICAgIH0sXG4gICAgZGVzZXJpYWxpemU6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgcGFyc2VkQmxvY2tzID0gaHRtbFRvQmxvY2tzKGV2ZW50LmRhdGEsIGxlZ2FjeVNjaGVtYS5wb3J0YWJsZVRleHQsIHtcbiAgICAgICAga2V5R2VuZXJhdG9yOiBzbmFwc2hvdC5jb250ZXh0LmtleUdlbmVyYXRvcixcbiAgICAgICAgdW5zdGFibGVfd2hpdGVzcGFjZU9uUGFzdGVNb2RlOiBsZWdhY3lTY2hlbWEuYmxvY2sub3B0aW9ucy51bnN0YWJsZV93aGl0ZXNwYWNlT25QYXN0ZU1vZGVcbiAgICAgIH0pLmZsYXRNYXAoKGJsb2NrKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhcnNlZEJsb2NrID0gcGFyc2VCbG9jayh7XG4gICAgICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICBibG9jayxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICBub3JtYWxpemU6ICExLFxuICAgICAgICAgICAgcmVtb3ZlVW51c2VkTWFya0RlZnM6ICEwLFxuICAgICAgICAgICAgdmFsaWRhdGVGaWVsZHM6ICExXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHBhcnNlZEJsb2NrID8gW3BhcnNlZEJsb2NrXSA6IFtdO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcGFyc2VkQmxvY2tzLmxlbmd0aCA9PT0gMCA/IHtcbiAgICAgICAgdHlwZTogXCJkZXNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICAgICAgICBtaW1lVHlwZTogXCJ0ZXh0L2h0bWxcIixcbiAgICAgICAgcmVhc29uOiBcIk5vIGJsb2NrcyBkZXNlcmlhbGl6ZWRcIlxuICAgICAgfSA6IHtcbiAgICAgICAgdHlwZTogXCJkZXNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgICAgICBkYXRhOiBwYXJzZWRCbG9ja3MsXG4gICAgICAgIG1pbWVUeXBlOiBcInRleHQvaHRtbFwiXG4gICAgICB9O1xuICAgIH1cbiAgfTtcbn1cbmNvbnN0IGNvbnZlcnRlclRleHRNYXJrZG93biA9IHtcbiAgbWltZVR5cGU6IFwidGV4dC9tYXJrZG93blwiLFxuICBzZXJpYWxpemU6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICAgICAgICBtaW1lVHlwZTogXCJ0ZXh0L21hcmtkb3duXCIsXG4gICAgICAgIHJlYXNvbjogXCJObyBzZWxlY3Rpb25cIixcbiAgICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgICB9O1xuICAgIGNvbnN0IGJsb2NrcyA9IGdldFNlbGVjdGVkVmFsdWUoc25hcHNob3QpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcInNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgICAgZGF0YTogcG9ydGFibGVUZXh0VG9NYXJrZG93bihibG9ja3MpLFxuICAgICAgbWltZVR5cGU6IFwidGV4dC9tYXJrZG93blwiLFxuICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgfTtcbiAgfSxcbiAgZGVzZXJpYWxpemU6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IHBhcnNlZEJsb2NrcyA9IG1hcmtkb3duVG9Qb3J0YWJsZVRleHQoZXZlbnQuZGF0YSwge1xuICAgICAga2V5R2VuZXJhdG9yOiBzbmFwc2hvdC5jb250ZXh0LmtleUdlbmVyYXRvcixcbiAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICB9KS5mbGF0TWFwKChibG9jaykgPT4ge1xuICAgICAgY29uc3QgcGFyc2VkQmxvY2sgPSBwYXJzZUJsb2NrKHtcbiAgICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgYmxvY2ssXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBub3JtYWxpemU6ICExLFxuICAgICAgICAgIHJlbW92ZVVudXNlZE1hcmtEZWZzOiAhMCxcbiAgICAgICAgICB2YWxpZGF0ZUZpZWxkczogITFcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gcGFyc2VkQmxvY2sgPyBbcGFyc2VkQmxvY2tdIDogW107XG4gICAgfSk7XG4gICAgcmV0dXJuIHBhcnNlZEJsb2Nrcy5sZW5ndGggPT09IDAgPyB7XG4gICAgICB0eXBlOiBcImRlc2VyaWFsaXphdGlvbi5mYWlsdXJlXCIsXG4gICAgICBtaW1lVHlwZTogXCJ0ZXh0L21hcmtkb3duXCIsXG4gICAgICByZWFzb246IFwiTm8gYmxvY2tzIGRlc2VyaWFsaXplZFwiXG4gICAgfSA6IHtcbiAgICAgIHR5cGU6IFwiZGVzZXJpYWxpemF0aW9uLnN1Y2Nlc3NcIixcbiAgICAgIGRhdGE6IHBhcnNlZEJsb2NrcyxcbiAgICAgIG1pbWVUeXBlOiBcInRleHQvbWFya2Rvd25cIlxuICAgIH07XG4gIH1cbn07XG5mdW5jdGlvbiBjcmVhdGVDb252ZXJ0ZXJUZXh0UGxhaW4obGVnYWN5U2NoZW1hKSB7XG4gIHJldHVybiB7XG4gICAgbWltZVR5cGU6IFwidGV4dC9wbGFpblwiLFxuICAgIHNlcmlhbGl6ZTogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiA/IHtcbiAgICAgIHR5cGU6IFwic2VyaWFsaXphdGlvbi5zdWNjZXNzXCIsXG4gICAgICBkYXRhOiBnZXRTZWxlY3RlZFZhbHVlKHNuYXBzaG90KS5tYXAoKGJsb2NrKSA9PiBpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBibG9jaykgPyBibG9jay5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC5fdHlwZSA9PT0gc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lID8gY2hpbGQudGV4dCA6IGV2ZW50Lm9yaWdpbkV2ZW50ID09PSBcImRyYWcuZHJhZ3N0YXJ0XCIgPyBgWyR7c25hcHNob3QuY29udGV4dC5zY2hlbWEuaW5saW5lT2JqZWN0cy5maW5kKChpbmxpbmVPYmplY3RUeXBlKSA9PiBpbmxpbmVPYmplY3RUeXBlLm5hbWUgPT09IGNoaWxkLl90eXBlKT8udGl0bGUgPz8gXCJPYmplY3RcIn1dYCA6IFwiXCIpLmpvaW4oXCJcIikgOiBldmVudC5vcmlnaW5FdmVudCA9PT0gXCJkcmFnLmRyYWdzdGFydFwiID8gYFske3NuYXBzaG90LmNvbnRleHQuc2NoZW1hLmJsb2NrT2JqZWN0cy5maW5kKChibG9ja09iamVjdFR5cGUpID0+IGJsb2NrT2JqZWN0VHlwZS5uYW1lID09PSBibG9jay5fdHlwZSk/LnRpdGxlID8/IFwiT2JqZWN0XCJ9XWAgOiBcIlwiKS5maWx0ZXIoKGJsb2NrKSA9PiBibG9jayAhPT0gXCJcIikuam9pbihgXG5cbmApLFxuICAgICAgbWltZVR5cGU6IFwidGV4dC9wbGFpblwiLFxuICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgfSA6IHtcbiAgICAgIHR5cGU6IFwic2VyaWFsaXphdGlvbi5mYWlsdXJlXCIsXG4gICAgICBtaW1lVHlwZTogXCJ0ZXh0L3BsYWluXCIsXG4gICAgICBvcmlnaW5FdmVudDogZXZlbnQub3JpZ2luRXZlbnQsXG4gICAgICByZWFzb246IFwiTm8gc2VsZWN0aW9uXCJcbiAgICB9LFxuICAgIGRlc2VyaWFsaXplOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IHRleHRUb0h0bWwgPSBgPGh0bWw+PGJvZHk+JHtlc2NhcGVIdG1sKGV2ZW50LmRhdGEpLnNwbGl0KC9cXG57Mix9LykubWFwKChsaW5lKSA9PiBsaW5lID8gYDxwPiR7bGluZS5yZXBsYWNlKC8oPzpcXHJcXG58XFxyfFxcbikvZywgXCI8YnIvPlwiKX08L3A+YCA6IFwiPHA+PC9wPlwiKS5qb2luKFwiXCIpfTwvYm9keT48L2h0bWw+YCwgcGFyc2VkQmxvY2tzID0gaHRtbFRvQmxvY2tzKHRleHRUb0h0bWwsIGxlZ2FjeVNjaGVtYS5wb3J0YWJsZVRleHQsIHtcbiAgICAgICAga2V5R2VuZXJhdG9yOiBzbmFwc2hvdC5jb250ZXh0LmtleUdlbmVyYXRvclxuICAgICAgfSkuZmxhdE1hcCgoYmxvY2spID0+IHtcbiAgICAgICAgY29uc3QgcGFyc2VkQmxvY2sgPSBwYXJzZUJsb2NrKHtcbiAgICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICAgIGJsb2NrLFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIG5vcm1hbGl6ZTogITEsXG4gICAgICAgICAgICByZW1vdmVVbnVzZWRNYXJrRGVmczogITAsXG4gICAgICAgICAgICB2YWxpZGF0ZUZpZWxkczogITFcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcGFyc2VkQmxvY2sgPyBbcGFyc2VkQmxvY2tdIDogW107XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZWRCbG9ja3MubGVuZ3RoID09PSAwID8ge1xuICAgICAgICB0eXBlOiBcImRlc2VyaWFsaXphdGlvbi5mYWlsdXJlXCIsXG4gICAgICAgIG1pbWVUeXBlOiBcInRleHQvcGxhaW5cIixcbiAgICAgICAgcmVhc29uOiBcIk5vIGJsb2NrcyBkZXNlcmlhbGl6ZWRcIlxuICAgICAgfSA6IHtcbiAgICAgICAgdHlwZTogXCJkZXNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgICAgICBkYXRhOiBwYXJzZWRCbG9ja3MsXG4gICAgICAgIG1pbWVUeXBlOiBcInRleHQvcGxhaW5cIlxuICAgICAgfTtcbiAgICB9XG4gIH07XG59XG5jb25zdCBlbnRpdHlNYXAgPSB7XG4gIFwiJlwiOiBcIiZhbXA7XCIsXG4gIFwiPFwiOiBcIiZsdDtcIixcbiAgXCI+XCI6IFwiJmd0O1wiLFxuICAnXCInOiBcIiZxdW90O1wiLFxuICBcIidcIjogXCImIzM5O1wiLFxuICBcIi9cIjogXCImI3gyRjtcIixcbiAgXCJgXCI6IFwiJiN4NjA7XCIsXG4gIFwiPVwiOiBcIiYjeDNEO1wiXG59O1xuZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpIHtcbiAgcmV0dXJuIFN0cmluZyhzdHIpLnJlcGxhY2UoL1smPD5cIidgPS9dL2csIChzKSA9PiBlbnRpdHlNYXBbc10pO1xufVxuZnVuY3Rpb24gY3JlYXRlQ29yZUNvbnZlcnRlcnMobGVnYWN5U2NoZW1hKSB7XG4gIHJldHVybiBbY29udmVydGVySnNvbiwgY29udmVydGVyUG9ydGFibGVUZXh0LCBjb252ZXJ0ZXJUZXh0TWFya2Rvd24sIGNyZWF0ZUNvbnZlcnRlclRleHRIdG1sKGxlZ2FjeVNjaGVtYSksIGNyZWF0ZUNvbnZlcnRlclRleHRQbGFpbihsZWdhY3lTY2hlbWEpXTtcbn1cbmZ1bmN0aW9uIGNvbXBpbGVUeXBlKHJhd1R5cGUpIHtcbiAgcmV0dXJuIFNjaGVtYS5jb21waWxlKHtcbiAgICBuYW1lOiBcImJsb2NrVHlwZVNjaGVtYVwiLFxuICAgIHR5cGVzOiBbcmF3VHlwZV1cbiAgfSkuZ2V0KHJhd1R5cGUubmFtZSk7XG59XG5mdW5jdGlvbiBjcmVhdGVFZGl0YWJsZUFQSShlZGl0b3IsIGVkaXRvckFjdG9yKSB7XG4gIGNvbnN0IHR5cGVzID0gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYTtcbiAgcmV0dXJuIHtcbiAgICBmb2N1czogKCkgPT4ge1xuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiZm9jdXNcIixcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGJsdXI6ICgpID0+IHtcbiAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJsdXJcIixcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHRvZ2dsZU1hcms6IChtYXJrKSA9PiB7XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkZWNvcmF0b3IudG9nZ2xlXCIsXG4gICAgICAgICAgZGVjb3JhdG9yOiBtYXJrXG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvclxuICAgICAgfSk7XG4gICAgfSxcbiAgICB0b2dnbGVMaXN0OiAobGlzdEl0ZW0pID0+IHtcbiAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcImxpc3QgaXRlbS50b2dnbGVcIixcbiAgICAgICAgICBsaXN0SXRlbVxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3JcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdG9nZ2xlQmxvY2tTdHlsZTogKHN0eWxlKSA9PiB7XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJzdHlsZS50b2dnbGVcIixcbiAgICAgICAgICBzdHlsZVxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3JcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgaXNNYXJrQWN0aXZlOiAobWFyaykgPT4ge1xuICAgICAgY29uc3Qgc25hcHNob3QgPSBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICAgIGVkaXRvckFjdG9yU25hcHNob3Q6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCksXG4gICAgICAgIHNsYXRlRWRpdG9ySW5zdGFuY2U6IGVkaXRvclxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZ2V0QWN0aXZlRGVjb3JhdG9ycyhzbmFwc2hvdCkuaW5jbHVkZXMobWFyayk7XG4gICAgfSxcbiAgICBtYXJrczogKCkgPT4ge1xuICAgICAgY29uc3Qgc25hcHNob3QgPSBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICAgIGVkaXRvckFjdG9yU25hcHNob3Q6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCksXG4gICAgICAgIHNsYXRlRWRpdG9ySW5zdGFuY2U6IGVkaXRvclxuICAgICAgfSksIGFjdGl2ZUFubm90YXRpb25zID0gZ2V0QWN0aXZlQW5ub3RhdGlvbnNNYXJrcyhzbmFwc2hvdCksIGFjdGl2ZURlY29yYXRvcnMgPSBnZXRBY3RpdmVEZWNvcmF0b3JzKHNuYXBzaG90KTtcbiAgICAgIHJldHVybiBbLi4uYWN0aXZlQW5ub3RhdGlvbnMsIC4uLmFjdGl2ZURlY29yYXRvcnNdO1xuICAgIH0sXG4gICAgdW5kbzogKCkgPT4ge1xuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiaGlzdG9yeS51bmRvXCJcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZG86ICgpID0+IHtcbiAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcImhpc3RvcnkucmVkb1wiXG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvclxuICAgICAgfSk7XG4gICAgfSxcbiAgICBzZWxlY3Q6IChzZWxlY3Rpb24pID0+IHtcbiAgICAgIGNvbnN0IHNsYXRlU2VsZWN0aW9uID0gdG9TbGF0ZVJhbmdlKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICB2YWx1ZTogZWRpdG9yLnZhbHVlLFxuICAgICAgICAgIHNlbGVjdGlvblxuICAgICAgICB9LFxuICAgICAgICBibG9ja0luZGV4TWFwOiBlZGl0b3IuYmxvY2tJbmRleE1hcFxuICAgICAgfSk7XG4gICAgICBzbGF0ZVNlbGVjdGlvbiA/IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgc2xhdGVTZWxlY3Rpb24pIDogVHJhbnNmb3Jtcy5kZXNlbGVjdChlZGl0b3IpLCBlZGl0b3Iub25DaGFuZ2UoKTtcbiAgICB9LFxuICAgIGZvY3VzQmxvY2s6ICgpID0+IHtcbiAgICAgIGlmICghZWRpdG9yLnNlbGVjdGlvbilcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY29uc3QgZm9jdXNCbG9ja0luZGV4ID0gZWRpdG9yLnNlbGVjdGlvbi5mb2N1cy5wYXRoLmF0KDApO1xuICAgICAgaWYgKGZvY3VzQmxvY2tJbmRleCAhPT0gdm9pZCAwKVxuICAgICAgICByZXR1cm4gZWRpdG9yLnZhbHVlLmF0KGZvY3VzQmxvY2tJbmRleCk7XG4gICAgfSxcbiAgICBmb2N1c0NoaWxkOiAoKSA9PiB7XG4gICAgICBpZiAoIWVkaXRvci5zZWxlY3Rpb24pXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNvbnN0IGZvY3VzQmxvY2tJbmRleCA9IGVkaXRvci5zZWxlY3Rpb24uZm9jdXMucGF0aC5hdCgwKSwgZm9jdXNDaGlsZEluZGV4ID0gZWRpdG9yLnNlbGVjdGlvbi5mb2N1cy5wYXRoLmF0KDEpLCBibG9jayA9IGZvY3VzQmxvY2tJbmRleCAhPT0gdm9pZCAwID8gZWRpdG9yLnZhbHVlLmF0KGZvY3VzQmxvY2tJbmRleCkgOiB2b2lkIDA7XG4gICAgICBpZiAoYmxvY2sgJiYgaXNUZXh0QmxvY2soZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LCBibG9jaykpXG4gICAgICAgIHJldHVybiBmb2N1c0NoaWxkSW5kZXggPT09IHZvaWQgMCA/IHZvaWQgMCA6IGJsb2NrLmNoaWxkcmVuLmF0KGZvY3VzQ2hpbGRJbmRleCk7XG4gICAgfSxcbiAgICBpbnNlcnRDaGlsZDogKHR5cGUsIHZhbHVlKSA9PiAoZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgIHR5cGU6IFwiaW5zZXJ0LmNoaWxkXCIsXG4gICAgICAgIGNoaWxkOiB7XG4gICAgICAgICAgX3R5cGU6IHR5cGUubmFtZSxcbiAgICAgICAgICAuLi52YWx1ZSB8fCB7fVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZWRpdG9yXG4gICAgfSksIGVkaXRvci5zZWxlY3Rpb24gPyBzbGF0ZVJhbmdlVG9TZWxlY3Rpb24oe1xuICAgICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLFxuICAgICAgZWRpdG9yLFxuICAgICAgcmFuZ2U6IGVkaXRvci5zZWxlY3Rpb25cbiAgICB9KT8uZm9jdXMucGF0aCA/PyBbXSA6IFtdKSxcbiAgICBpbnNlcnRCbG9jazogKHR5cGUsIHZhbHVlKSA9PiAoZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICAgIGJsb2NrOiB7XG4gICAgICAgICAgX3R5cGU6IHR5cGUubmFtZSxcbiAgICAgICAgICAuLi52YWx1ZSB8fCB7fVxuICAgICAgICB9LFxuICAgICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiXG4gICAgICB9LFxuICAgICAgZWRpdG9yXG4gICAgfSksIGVkaXRvci5zZWxlY3Rpb24gPyBzbGF0ZVJhbmdlVG9TZWxlY3Rpb24oe1xuICAgICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLFxuICAgICAgZWRpdG9yLFxuICAgICAgcmFuZ2U6IGVkaXRvci5zZWxlY3Rpb25cbiAgICB9KT8uZm9jdXMucGF0aCA/PyBbXSA6IFtdKSxcbiAgICBoYXNCbG9ja1N0eWxlOiAoc3R5bGUpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBpc1N0eWxlQWN0aXZlKHtcbiAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgc3R5bGVcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgfVxuICAgIH0sXG4gICAgaGFzTGlzdFN0eWxlOiAobGlzdEl0ZW0pID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBpc0xpc3RJdGVtQWN0aXZlKHtcbiAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgbGlzdEl0ZW1cbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgfVxuICAgIH0sXG4gICAgaXNWb2lkOiAoZWxlbWVudCkgPT4gIVt0eXBlcy5ibG9jay5uYW1lLCB0eXBlcy5zcGFuLm5hbWVdLmluY2x1ZGVzKGVsZW1lbnQuX3R5cGUpLFxuICAgIGZpbmRCeVBhdGg6IChwYXRoKSA9PiB7XG4gICAgICBjb25zdCBibG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHtcbiAgICAgICAgcGF0aFxuICAgICAgfSk7XG4gICAgICBpZiAoIWJsb2NrS2V5KVxuICAgICAgICByZXR1cm4gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBlZGl0b3IuYmxvY2tJbmRleE1hcC5nZXQoYmxvY2tLZXkpO1xuICAgICAgaWYgKGJsb2NrSW5kZXggPT09IHZvaWQgMClcbiAgICAgICAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG4gICAgICBjb25zdCBibG9jayA9IGVkaXRvci52YWx1ZS5hdChibG9ja0luZGV4KTtcbiAgICAgIGlmICghYmxvY2spXG4gICAgICAgIHJldHVybiBbdm9pZCAwLCB2b2lkIDBdO1xuICAgICAgY29uc3QgY2hpbGRLZXkgPSBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludCh7XG4gICAgICAgIHBhdGhcbiAgICAgIH0pO1xuICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAxICYmICFjaGlsZEtleSlcbiAgICAgICAgcmV0dXJuIFtibG9jaywgW3tcbiAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgIH1dXTtcbiAgICAgIGlmIChpc1RleHRCbG9jayhlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQsIGJsb2NrKSAmJiBjaGlsZEtleSkge1xuICAgICAgICBjb25zdCBjaGlsZCA9IGJsb2NrLmNoaWxkcmVuLmZpbmQoKGNoaWxkMikgPT4gY2hpbGQyLl9rZXkgPT09IGNoaWxkS2V5KTtcbiAgICAgICAgaWYgKGNoaWxkKVxuICAgICAgICAgIHJldHVybiBbY2hpbGQsIFt7XG4gICAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgICAgICAgfV1dO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFt2b2lkIDAsIHZvaWQgMF07XG4gICAgfSxcbiAgICBmaW5kRE9NTm9kZTogKGVsZW1lbnQpID0+IHtcbiAgICAgIGxldCBub2RlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgW2l0ZW1dID0gQXJyYXkuZnJvbShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgYXQ6IFtdLFxuICAgICAgICAgIG1hdGNoOiAobikgPT4gbi5fa2V5ID09PSBlbGVtZW50Ll9rZXlcbiAgICAgICAgfSkgfHwgW10pWzBdIHx8IFt2b2lkIDBdO1xuICAgICAgICBub2RlID0gUmVhY3RFZGl0b3IudG9ET01Ob2RlKGVkaXRvciwgaXRlbSk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub2RlO1xuICAgIH0sXG4gICAgYWN0aXZlQW5ub3RhdGlvbnM6ICgpID0+IHtcbiAgICAgIGlmICghZWRpdG9yLnNlbGVjdGlvbiB8fCBlZGl0b3Iuc2VsZWN0aW9uLmZvY3VzLnBhdGgubGVuZ3RoIDwgMilcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWN0aXZlQW5ub3RhdGlvbnMgPSBbXSwgc3BhbnMgPSBFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgYXQ6IGVkaXRvci5zZWxlY3Rpb24sXG4gICAgICAgICAgbWF0Y2g6IChub2RlKSA9PiBUZXh0LmlzVGV4dChub2RlKSAmJiBub2RlLm1hcmtzICE9PSB2b2lkIDAgJiYgQXJyYXkuaXNBcnJheShub2RlLm1hcmtzKSAmJiBub2RlLm1hcmtzLmxlbmd0aCA+IDBcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAoY29uc3QgW3NwYW4sIHBhdGhdIG9mIHNwYW5zKSB7XG4gICAgICAgICAgY29uc3QgW2Jsb2NrXSA9IEVkaXRvci5ub2RlKGVkaXRvciwgcGF0aCwge1xuICAgICAgICAgICAgZGVwdGg6IDFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBlZGl0b3IuaXNUZXh0QmxvY2soYmxvY2spICYmIGJsb2NrLm1hcmtEZWZzPy5mb3JFYWNoKChkZWYpID0+IHtcbiAgICAgICAgICAgIFRleHQuaXNUZXh0KHNwYW4pICYmIHNwYW4ubWFya3MgJiYgQXJyYXkuaXNBcnJheShzcGFuLm1hcmtzKSAmJiBzcGFuLm1hcmtzLmluY2x1ZGVzKGRlZi5fa2V5KSAmJiBhY3RpdmVBbm5vdGF0aW9ucy5wdXNoKGRlZik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjdGl2ZUFubm90YXRpb25zO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGlzQW5ub3RhdGlvbkFjdGl2ZTogKGFubm90YXRpb25UeXBlKSA9PiB7XG4gICAgICBjb25zdCBzbmFwc2hvdCA9IGdldEVkaXRvclNuYXBzaG90KHtcbiAgICAgICAgZWRpdG9yQWN0b3JTbmFwc2hvdDogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKSxcbiAgICAgICAgc2xhdGVFZGl0b3JJbnN0YW5jZTogZWRpdG9yXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBpc0FjdGl2ZUFubm90YXRpb24oYW5ub3RhdGlvblR5cGUpKHNuYXBzaG90KTtcbiAgICB9LFxuICAgIGFkZEFubm90YXRpb246ICh0eXBlLCB2YWx1ZSkgPT4ge1xuICAgICAgY29uc3Qgc25hcHNob3RCZWZvcmUgPSBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICAgIGVkaXRvckFjdG9yU25hcHNob3Q6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCksXG4gICAgICAgIHNsYXRlRWRpdG9ySW5zdGFuY2U6IGVkaXRvclxuICAgICAgfSksIHNlbGVjdGVkVmFsdWVCZWZvcmUgPSBnZXRTZWxlY3RlZFZhbHVlKHNuYXBzaG90QmVmb3JlKSwgZm9jdXNTcGFuQmVmb3JlID0gZ2V0Rm9jdXNTcGFuJDEoc25hcHNob3RCZWZvcmUpLCBtYXJrRGVmc0JlZm9yZSA9IHNlbGVjdGVkVmFsdWVCZWZvcmUuZmxhdE1hcCgoYmxvY2spID0+IGlzVGV4dEJsb2NrKHNuYXBzaG90QmVmb3JlLmNvbnRleHQsIGJsb2NrKSA/IGJsb2NrLm1hcmtEZWZzID8/IFtdIDogW10pO1xuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiYW5ub3RhdGlvbi5hZGRcIixcbiAgICAgICAgICBhbm5vdGF0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiB0eXBlLm5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUgPz8ge31cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvclxuICAgICAgfSk7XG4gICAgICBjb25zdCBzbmFwc2hvdEFmdGVyID0gZ2V0RWRpdG9yU25hcHNob3Qoe1xuICAgICAgICBlZGl0b3JBY3RvclNuYXBzaG90OiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLFxuICAgICAgICBzbGF0ZUVkaXRvckluc3RhbmNlOiBlZGl0b3JcbiAgICAgIH0pLCBzZWxlY3RlZFZhbHVlQWZ0ZXIgPSBnZXRTZWxlY3RlZFZhbHVlKHNuYXBzaG90QWZ0ZXIpLCBmb2N1c0Jsb2NrQWZ0ZXIgPSBnZXRGb2N1c0Jsb2NrJDEoc25hcHNob3RBZnRlciksIGZvY3VzU3BhbkFmdGVyID0gZ2V0Rm9jdXNTcGFuJDEoc25hcHNob3RBZnRlciksIG5ld01hcmtEZWZLZXlzT25Gb2N1c1NwYW4gPSBmb2N1c1NwYW5BZnRlcj8ubm9kZS5tYXJrcz8uZmlsdGVyKChtYXJrKSA9PiAhZm9jdXNTcGFuQmVmb3JlPy5ub2RlLm1hcmtzPy5pbmNsdWRlcyhtYXJrKSAmJiAhc25hcHNob3RBZnRlci5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLm1hcCgoZGVjb3JhdG9yKSA9PiBkZWNvcmF0b3IubmFtZSkuaW5jbHVkZXMobWFyaykpLCBtYXJrRGVmcyA9IHNlbGVjdGVkVmFsdWVBZnRlci5mbGF0TWFwKChibG9jaykgPT4gaXNUZXh0QmxvY2soc25hcHNob3RBZnRlci5jb250ZXh0LCBibG9jaykgPyBibG9jay5tYXJrRGVmcz8ubWFwKChtYXJrRGVmMikgPT4gKHtcbiAgICAgICAgbWFya0RlZjogbWFya0RlZjIsXG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9LCBcIm1hcmtEZWZzXCIsIHtcbiAgICAgICAgICBfa2V5OiBtYXJrRGVmMi5fa2V5XG4gICAgICAgIH1dXG4gICAgICB9KSkgPz8gW10gOiBbXSkuZmlsdGVyKChtYXJrRGVmMikgPT4gIW1hcmtEZWZzQmVmb3JlLnNvbWUoKG1hcmtEZWZCZWZvcmUpID0+IG1hcmtEZWZCZWZvcmUuX2tleSA9PT0gbWFya0RlZjIubWFya0RlZi5fa2V5KSksIHNwYW5QYXRoID0gZm9jdXNTcGFuQWZ0ZXI/LnBhdGgsIG1hcmtEZWYgPSBtYXJrRGVmcy5maW5kKChtYXJrRGVmMikgPT4gbmV3TWFya0RlZktleXNPbkZvY3VzU3Bhbj8uc29tZSgobWFyaykgPT4gbWFyayA9PT0gbWFya0RlZjIubWFya0RlZi5fa2V5KSk7XG4gICAgICBpZiAoZm9jdXNCbG9ja0FmdGVyICYmIHNwYW5QYXRoICYmIG1hcmtEZWYpXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbWFya0RlZlBhdGg6IG1hcmtEZWYucGF0aCxcbiAgICAgICAgICBtYXJrRGVmUGF0aHM6IG1hcmtEZWZzLm1hcCgobWFya0RlZjIpID0+IG1hcmtEZWYyLnBhdGgpLFxuICAgICAgICAgIHNwYW5QYXRoXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBkZWxldGU6IChzZWxlY3Rpb24sIG9wdGlvbnMpID0+IHtcbiAgICAgIHNlbGVjdGlvbiAmJiBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgICAgICBhdDogc2VsZWN0aW9uLFxuICAgICAgICAgIHVuaXQ6IG9wdGlvbnM/Lm1vZGUgPT09IFwiYmxvY2tzXCIgPyBcImJsb2NrXCIgOiBvcHRpb25zPy5tb2RlID09PSBcImNoaWxkcmVuXCIgPyBcImNoaWxkXCIgOiB2b2lkIDBcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlbW92ZUFubm90YXRpb246ICh0eXBlKSA9PiB7XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJhbm5vdGF0aW9uLnJlbW92ZVwiLFxuICAgICAgICAgIGFubm90YXRpb246IHtcbiAgICAgICAgICAgIG5hbWU6IHR5cGUubmFtZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGdldFNlbGVjdGlvbjogKCkgPT4ge1xuICAgICAgaWYgKCFlZGl0b3Iuc2VsZWN0aW9uKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIGlmIChlZGl0b3Iuc2VsZWN0aW9uID09PSBlZGl0b3IubGFzdFNsYXRlU2VsZWN0aW9uKVxuICAgICAgICByZXR1cm4gZWRpdG9yLmxhc3RTZWxlY3Rpb247XG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSBzbGF0ZVJhbmdlVG9TZWxlY3Rpb24oe1xuICAgICAgICBzY2hlbWE6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsXG4gICAgICAgIGVkaXRvcixcbiAgICAgICAgcmFuZ2U6IGVkaXRvci5zZWxlY3Rpb25cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGVkaXRvci5sYXN0U2xhdGVTZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uLCBlZGl0b3IubGFzdFNlbGVjdGlvbiA9IHNlbGVjdGlvbiwgc2VsZWN0aW9uO1xuICAgIH0sXG4gICAgZ2V0VmFsdWU6ICgpID0+IGVkaXRvci52YWx1ZSxcbiAgICBpc0NvbGxhcHNlZFNlbGVjdGlvbjogKCkgPT4gISFlZGl0b3Iuc2VsZWN0aW9uICYmIFJhbmdlLmlzQ29sbGFwc2VkKGVkaXRvci5zZWxlY3Rpb24pLFxuICAgIGlzRXhwYW5kZWRTZWxlY3Rpb246ICgpID0+ICEhZWRpdG9yLnNlbGVjdGlvbiAmJiBSYW5nZS5pc0V4cGFuZGVkKGVkaXRvci5zZWxlY3Rpb24pLFxuICAgIGluc2VydEJyZWFrOiAoKSA9PiB7XG4gICAgICBlZGl0b3IuaW5zZXJ0QnJlYWsoKSwgZWRpdG9yLm9uQ2hhbmdlKCk7XG4gICAgfSxcbiAgICBnZXRGcmFnbWVudDogKCkgPT4ge1xuICAgICAgY29uc3Qgc25hcHNob3QgPSBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICAgIGVkaXRvckFjdG9yU25hcHNob3Q6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCksXG4gICAgICAgIHNsYXRlRWRpdG9ySW5zdGFuY2U6IGVkaXRvclxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZ2V0U2VsZWN0ZWRWYWx1ZShzbmFwc2hvdCk7XG4gICAgfSxcbiAgICBpc1NlbGVjdGlvbnNPdmVybGFwcGluZzogKHNlbGVjdGlvbkEsIHNlbGVjdGlvbkIpID0+IHtcbiAgICAgIGNvbnN0IHJhbmdlQSA9IHRvU2xhdGVSYW5nZSh7XG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBzY2hlbWE6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsXG4gICAgICAgICAgdmFsdWU6IGVkaXRvci52YWx1ZSxcbiAgICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGlvbkFcbiAgICAgICAgfSxcbiAgICAgICAgYmxvY2tJbmRleE1hcDogZWRpdG9yLmJsb2NrSW5kZXhNYXBcbiAgICAgIH0pLCByYW5nZUIgPSB0b1NsYXRlUmFuZ2Uoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLFxuICAgICAgICAgIHZhbHVlOiBlZGl0b3IudmFsdWUsXG4gICAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25CXG4gICAgICAgIH0sXG4gICAgICAgIGJsb2NrSW5kZXhNYXA6IGVkaXRvci5ibG9ja0luZGV4TWFwXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBSYW5nZS5pc1JhbmdlKHJhbmdlQSkgJiYgUmFuZ2UuaXNSYW5nZShyYW5nZUIpICYmIFJhbmdlLmluY2x1ZGVzKHJhbmdlQSwgcmFuZ2VCKTtcbiAgICB9XG4gIH07XG59XG5jb25zdCBsZXZlbEluZGV4TWFwcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG5mdW5jdGlvbiBidWlsZEluZGV4TWFwcyhjb250ZXh0LCB7XG4gIGJsb2NrSW5kZXhNYXAsXG4gIGxpc3RJbmRleE1hcFxufSkge1xuICBibG9ja0luZGV4TWFwLmNsZWFyKCksIGxpc3RJbmRleE1hcC5jbGVhcigpLCBsZXZlbEluZGV4TWFwcy5jbGVhcigpO1xuICBsZXQgcHJldmlvdXNMaXN0SXRlbTtcbiAgZm9yIChsZXQgYmxvY2tJbmRleCA9IDA7IGJsb2NrSW5kZXggPCBjb250ZXh0LnZhbHVlLmxlbmd0aDsgYmxvY2tJbmRleCsrKSB7XG4gICAgY29uc3QgYmxvY2sgPSBjb250ZXh0LnZhbHVlLmF0KGJsb2NrSW5kZXgpO1xuICAgIGlmIChibG9jayA9PT0gdm9pZCAwKVxuICAgICAgY29udGludWU7XG4gICAgaWYgKGJsb2NrSW5kZXhNYXAuc2V0KGJsb2NrLl9rZXksIGJsb2NrSW5kZXgpLCAhaXNUZXh0QmxvY2soY29udGV4dCwgYmxvY2spKSB7XG4gICAgICBsZXZlbEluZGV4TWFwcy5jbGVhcigpLCBwcmV2aW91c0xpc3RJdGVtID0gdm9pZCAwO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChibG9jay5saXN0SXRlbSA9PT0gdm9pZCAwIHx8IGJsb2NrLmxldmVsID09PSB2b2lkIDApIHtcbiAgICAgIGxldmVsSW5kZXhNYXBzLmNsZWFyKCksIHByZXZpb3VzTGlzdEl0ZW0gPSB2b2lkIDA7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKCFwcmV2aW91c0xpc3RJdGVtKSB7XG4gICAgICBjb25zdCBsZXZlbEluZGV4TWFwMiA9IGxldmVsSW5kZXhNYXBzLmdldChibG9jay5saXN0SXRlbSkgPz8gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgIGxldmVsSW5kZXhNYXAyLnNldChibG9jay5sZXZlbCwgMSksIGxldmVsSW5kZXhNYXBzLnNldChibG9jay5saXN0SXRlbSwgbGV2ZWxJbmRleE1hcDIpLCBsaXN0SW5kZXhNYXAuc2V0KGJsb2NrLl9rZXksIDEpLCBwcmV2aW91c0xpc3RJdGVtID0ge1xuICAgICAgICBsaXN0SXRlbTogYmxvY2subGlzdEl0ZW0sXG4gICAgICAgIGxldmVsOiBibG9jay5sZXZlbFxuICAgICAgfTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAocHJldmlvdXNMaXN0SXRlbS5saXN0SXRlbSA9PT0gYmxvY2subGlzdEl0ZW0gJiYgcHJldmlvdXNMaXN0SXRlbS5sZXZlbCA8IGJsb2NrLmxldmVsKSB7XG4gICAgICBjb25zdCBsZXZlbEluZGV4TWFwMiA9IGxldmVsSW5kZXhNYXBzLmdldChibG9jay5saXN0SXRlbSkgPz8gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICAgIGxldmVsSW5kZXhNYXAyLnNldChibG9jay5sZXZlbCwgMSksIGxldmVsSW5kZXhNYXBzLnNldChibG9jay5saXN0SXRlbSwgbGV2ZWxJbmRleE1hcDIpLCBsaXN0SW5kZXhNYXAuc2V0KGJsb2NrLl9rZXksIDEpLCBwcmV2aW91c0xpc3RJdGVtID0ge1xuICAgICAgICBsaXN0SXRlbTogYmxvY2subGlzdEl0ZW0sXG4gICAgICAgIGxldmVsOiBibG9jay5sZXZlbFxuICAgICAgfTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBsZXZlbEluZGV4TWFwcy5mb3JFYWNoKChsZXZlbEluZGV4TWFwMiwgbGlzdEl0ZW0pID0+IHtcbiAgICAgIGlmIChsaXN0SXRlbSA9PT0gYmxvY2subGlzdEl0ZW0pXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNvbnN0IGxldmVsc1RvRGVsZXRlID0gW107XG4gICAgICBsZXZlbEluZGV4TWFwMi5mb3JFYWNoKChfLCBsZXZlbCkgPT4ge1xuICAgICAgICBsZXZlbCA+PSBibG9jay5sZXZlbCAmJiBsZXZlbHNUb0RlbGV0ZS5wdXNoKGxldmVsKTtcbiAgICAgIH0pLCBsZXZlbHNUb0RlbGV0ZS5mb3JFYWNoKChsZXZlbCkgPT4ge1xuICAgICAgICBsZXZlbEluZGV4TWFwMi5kZWxldGUobGV2ZWwpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgY29uc3QgbGV2ZWxJbmRleE1hcCA9IGxldmVsSW5kZXhNYXBzLmdldChibG9jay5saXN0SXRlbSkgPz8gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgbGV2ZWxDb3VudGVyID0gbGV2ZWxJbmRleE1hcC5nZXQoYmxvY2subGV2ZWwpID8/IDA7XG4gICAgbGV2ZWxJbmRleE1hcC5zZXQoYmxvY2subGV2ZWwsIGxldmVsQ291bnRlciArIDEpLCBsZXZlbEluZGV4TWFwcy5zZXQoYmxvY2subGlzdEl0ZW0sIGxldmVsSW5kZXhNYXApLCBsaXN0SW5kZXhNYXAuc2V0KGJsb2NrLl9rZXksIGxldmVsQ291bnRlciArIDEpLCBwcmV2aW91c0xpc3RJdGVtID0ge1xuICAgICAgbGlzdEl0ZW06IGJsb2NrLmxpc3RJdGVtLFxuICAgICAgbGV2ZWw6IGJsb2NrLmxldmVsXG4gICAgfTtcbiAgfVxufVxuZnVuY3Rpb24gY3JlYXRlUGxhY2Vob2xkZXJCbG9jayhjb250ZXh0KSB7XG4gIHJldHVybiB7XG4gICAgX3R5cGU6IGNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWUsXG4gICAgX2tleTogY29udGV4dC5rZXlHZW5lcmF0b3IoKSxcbiAgICBzdHlsZTogY29udGV4dC5zY2hlbWEuc3R5bGVzWzBdLm5hbWUgPz8gXCJub3JtYWxcIixcbiAgICBtYXJrRGVmczogW10sXG4gICAgY2hpbGRyZW46IFt7XG4gICAgICBfdHlwZTogY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgX2tleTogY29udGV4dC5rZXlHZW5lcmF0b3IoKSxcbiAgICAgIHRleHQ6IFwiXCIsXG4gICAgICBtYXJrczogW11cbiAgICB9XVxuICB9O1xufVxuY29uc3QgYWRkQW5ub3RhdGlvbk9wZXJhdGlvbkltcGxlbWVudGF0aW9uID0gKHtcbiAgY29udGV4dCxcbiAgb3BlcmF0aW9uXG59KSA9PiB7XG4gIGNvbnN0IHBhcnNlZEFubm90YXRpb24gPSBwYXJzZUFubm90YXRpb24oe1xuICAgIGFubm90YXRpb246IHtcbiAgICAgIF90eXBlOiBvcGVyYXRpb24uYW5ub3RhdGlvbi5uYW1lLFxuICAgICAgX2tleTogb3BlcmF0aW9uLmFubm90YXRpb24uX2tleSxcbiAgICAgIC4uLm9wZXJhdGlvbi5hbm5vdGF0aW9uLnZhbHVlXG4gICAgfSxcbiAgICBjb250ZXh0LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHZhbGlkYXRlRmllbGRzOiAhMFxuICAgIH1cbiAgfSk7XG4gIGlmICghcGFyc2VkQW5ub3RhdGlvbilcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBwYXJzZSBhbm5vdGF0aW9uICR7SlNPTi5zdHJpbmdpZnkob3BlcmF0aW9uLmFubm90YXRpb24pfWApO1xuICBjb25zdCBlZGl0b3IgPSBvcGVyYXRpb24uZWRpdG9yO1xuICBpZiAoIWVkaXRvci5zZWxlY3Rpb24gfHwgUmFuZ2UuaXNDb2xsYXBzZWQoZWRpdG9yLnNlbGVjdGlvbikpXG4gICAgcmV0dXJuO1xuICBjb25zdCBzZWxlY3RlZEJsb2NrcyA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICBhdDogZWRpdG9yLnNlbGVjdGlvbixcbiAgICBtYXRjaDogKG5vZGUpID0+IGVkaXRvci5pc1RleHRCbG9jayhub2RlKSxcbiAgICByZXZlcnNlOiBSYW5nZS5pc0JhY2t3YXJkKGVkaXRvci5zZWxlY3Rpb24pXG4gIH0pO1xuICBsZXQgYmxvY2tJbmRleCA9IDA7XG4gIGZvciAoY29uc3QgW2Jsb2NrLCBibG9ja1BhdGhdIG9mIHNlbGVjdGVkQmxvY2tzKSB7XG4gICAgaWYgKGJsb2NrLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCB8fCBibG9jay5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgYmxvY2suY2hpbGRyZW5bMF0udGV4dCA9PT0gXCJcIilcbiAgICAgIGNvbnRpbnVlO1xuICAgIGNvbnN0IGFubm90YXRpb25LZXkgPSBibG9ja0luZGV4ID09PSAwID8gcGFyc2VkQW5ub3RhdGlvbi5fa2V5IDogY29udGV4dC5rZXlHZW5lcmF0b3IoKSwgbWFya0RlZnMgPSBibG9jay5tYXJrRGVmcyA/PyBbXTtcbiAgICBtYXJrRGVmcy5maW5kKChtYXJrRGVmKSA9PiBtYXJrRGVmLl90eXBlID09PSBwYXJzZWRBbm5vdGF0aW9uLl90eXBlICYmIG1hcmtEZWYuX2tleSA9PT0gYW5ub3RhdGlvbktleSkgPT09IHZvaWQgMCAmJiBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgbWFya0RlZnM6IFsuLi5tYXJrRGVmcywge1xuICAgICAgICAuLi5wYXJzZWRBbm5vdGF0aW9uLFxuICAgICAgICBfa2V5OiBhbm5vdGF0aW9uS2V5XG4gICAgICB9XVxuICAgIH0sIHtcbiAgICAgIGF0OiBibG9ja1BhdGhcbiAgICB9KSwgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHt9LCB7XG4gICAgICBtYXRjaDogVGV4dC5pc1RleHQsXG4gICAgICBzcGxpdDogITBcbiAgICB9KTtcbiAgICBjb25zdCBjaGlsZHJlbiA9IE5vZGUuY2hpbGRyZW4oZWRpdG9yLCBibG9ja1BhdGgpO1xuICAgIGZvciAoY29uc3QgW3NwYW4sIHBhdGhdIG9mIGNoaWxkcmVuKSB7XG4gICAgICBpZiAoIWVkaXRvci5pc1RleHRTcGFuKHNwYW4pIHx8ICFSYW5nZS5pbmNsdWRlcyhlZGl0b3Iuc2VsZWN0aW9uLCBwYXRoKSlcbiAgICAgICAgY29udGludWU7XG4gICAgICBjb25zdCBtYXJrcyA9IHNwYW4ubWFya3MgPz8gW107XG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICBtYXJrczogWy4uLm1hcmtzLCBhbm5vdGF0aW9uS2V5XVxuICAgICAgfSwge1xuICAgICAgICBhdDogcGF0aFxuICAgICAgfSk7XG4gICAgfVxuICAgIGJsb2NrSW5kZXgrKztcbiAgfVxufSwgcmVtb3ZlQW5ub3RhdGlvbk9wZXJhdGlvbkltcGxlbWVudGF0aW9uID0gKHtcbiAgb3BlcmF0aW9uXG59KSA9PiB7XG4gIGNvbnN0IGVkaXRvciA9IG9wZXJhdGlvbi5lZGl0b3I7XG4gIGlmIChlZGl0b3Iuc2VsZWN0aW9uKVxuICAgIGlmIChSYW5nZS5pc0NvbGxhcHNlZChlZGl0b3Iuc2VsZWN0aW9uKSkge1xuICAgICAgY29uc3QgW2Jsb2NrLCBibG9ja1BhdGhdID0gRWRpdG9yLm5vZGUoZWRpdG9yLCBlZGl0b3Iuc2VsZWN0aW9uLCB7XG4gICAgICAgIGRlcHRoOiAxXG4gICAgICB9KTtcbiAgICAgIGlmICghZWRpdG9yLmlzVGV4dEJsb2NrKGJsb2NrKSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY29uc3QgcG90ZW50aWFsQW5ub3RhdGlvbnMgPSAoYmxvY2subWFya0RlZnMgPz8gW10pLmZpbHRlcigobWFya0RlZikgPT4gbWFya0RlZi5fdHlwZSA9PT0gb3BlcmF0aW9uLmFubm90YXRpb24ubmFtZSksIFtzZWxlY3RlZENoaWxkLCBzZWxlY3RlZENoaWxkUGF0aF0gPSBFZGl0b3Iubm9kZShlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24sIHtcbiAgICAgICAgZGVwdGg6IDJcbiAgICAgIH0pO1xuICAgICAgaWYgKCFlZGl0b3IuaXNUZXh0U3BhbihzZWxlY3RlZENoaWxkKSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY29uc3QgYW5ub3RhdGlvblRvUmVtb3ZlID0gc2VsZWN0ZWRDaGlsZC5tYXJrcz8uZmluZCgobWFyaykgPT4gcG90ZW50aWFsQW5ub3RhdGlvbnMuc29tZSgobWFya0RlZikgPT4gbWFya0RlZi5fa2V5ID09PSBtYXJrKSk7XG4gICAgICBpZiAoIWFubm90YXRpb25Ub1JlbW92ZSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY29uc3QgcHJldmlvdXNTcGFuc1dpdGhTYW1lQW5ub3RhdGlvbiA9IFtdO1xuICAgICAgZm9yIChjb25zdCBbY2hpbGQsIGNoaWxkUGF0aF0gb2YgTm9kZS5jaGlsZHJlbihlZGl0b3IsIGJsb2NrUGF0aCwge1xuICAgICAgICByZXZlcnNlOiAhMFxuICAgICAgfSkpXG4gICAgICAgIGlmIChlZGl0b3IuaXNUZXh0U3BhbihjaGlsZCkgJiYgUGF0aC5pc0JlZm9yZShjaGlsZFBhdGgsIHNlbGVjdGVkQ2hpbGRQYXRoKSlcbiAgICAgICAgICBpZiAoY2hpbGQubWFya3M/LmluY2x1ZGVzKGFubm90YXRpb25Ub1JlbW92ZSkpXG4gICAgICAgICAgICBwcmV2aW91c1NwYW5zV2l0aFNhbWVBbm5vdGF0aW9uLnB1c2goW2NoaWxkLCBjaGlsZFBhdGhdKTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBicmVhaztcbiAgICAgIGNvbnN0IG5leHRTcGFuc1dpdGhTYW1lQW5ub3RhdGlvbiA9IFtdO1xuICAgICAgZm9yIChjb25zdCBbY2hpbGQsIGNoaWxkUGF0aF0gb2YgTm9kZS5jaGlsZHJlbihlZGl0b3IsIGJsb2NrUGF0aCkpXG4gICAgICAgIGlmIChlZGl0b3IuaXNUZXh0U3BhbihjaGlsZCkgJiYgUGF0aC5pc0FmdGVyKGNoaWxkUGF0aCwgc2VsZWN0ZWRDaGlsZFBhdGgpKVxuICAgICAgICAgIGlmIChjaGlsZC5tYXJrcz8uaW5jbHVkZXMoYW5ub3RhdGlvblRvUmVtb3ZlKSlcbiAgICAgICAgICAgIG5leHRTcGFuc1dpdGhTYW1lQW5ub3RhdGlvbi5wdXNoKFtjaGlsZCwgY2hpbGRQYXRoXSk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICBmb3IgKGNvbnN0IFtjaGlsZCwgY2hpbGRQYXRoXSBvZiBbLi4ucHJldmlvdXNTcGFuc1dpdGhTYW1lQW5ub3RhdGlvbiwgW3NlbGVjdGVkQ2hpbGQsIHNlbGVjdGVkQ2hpbGRQYXRoXSwgLi4ubmV4dFNwYW5zV2l0aFNhbWVBbm5vdGF0aW9uXSlcbiAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICBtYXJrczogY2hpbGQubWFya3M/LmZpbHRlcigobWFyaykgPT4gbWFyayAhPT0gYW5ub3RhdGlvblRvUmVtb3ZlKVxuICAgICAgICB9LCB7XG4gICAgICAgICAgYXQ6IGNoaWxkUGF0aFxuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHt9LCB7XG4gICAgICAgIG1hdGNoOiAobm9kZSkgPT4gZWRpdG9yLmlzVGV4dFNwYW4obm9kZSksXG4gICAgICAgIHNwbGl0OiAhMCxcbiAgICAgICAgaGFuZ2luZzogITBcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYmxvY2tzID0gRWRpdG9yLm5vZGVzKGVkaXRvciwge1xuICAgICAgICBhdDogZWRpdG9yLnNlbGVjdGlvbixcbiAgICAgICAgbWF0Y2g6IChub2RlKSA9PiBlZGl0b3IuaXNUZXh0QmxvY2sobm9kZSlcbiAgICAgIH0pO1xuICAgICAgZm9yIChjb25zdCBbYmxvY2ssIGJsb2NrUGF0aF0gb2YgYmxvY2tzKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gTm9kZS5jaGlsZHJlbihlZGl0b3IsIGJsb2NrUGF0aCk7XG4gICAgICAgIGZvciAoY29uc3QgW2NoaWxkLCBjaGlsZFBhdGhdIG9mIGNoaWxkcmVuKSB7XG4gICAgICAgICAgaWYgKCFlZGl0b3IuaXNUZXh0U3BhbihjaGlsZCkgfHwgIVJhbmdlLmluY2x1ZGVzKGVkaXRvci5zZWxlY3Rpb24sIGNoaWxkUGF0aCkpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICBjb25zdCBtYXJrRGVmcyA9IGJsb2NrLm1hcmtEZWZzID8/IFtdLCBtYXJrcyA9IGNoaWxkLm1hcmtzID8/IFtdLCBtYXJrc1dpdGhvdXRBbm5vdGF0aW9uID0gbWFya3MuZmlsdGVyKChtYXJrKSA9PiBtYXJrRGVmcy5maW5kKChtYXJrRGVmMikgPT4gbWFya0RlZjIuX2tleSA9PT0gbWFyayk/Ll90eXBlICE9PSBvcGVyYXRpb24uYW5ub3RhdGlvbi5uYW1lKTtcbiAgICAgICAgICBtYXJrc1dpdGhvdXRBbm5vdGF0aW9uLmxlbmd0aCAhPT0gbWFya3MubGVuZ3RoICYmIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICBtYXJrczogbWFya3NXaXRob3V0QW5ub3RhdGlvblxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiBjaGlsZFBhdGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbn0sIGJsb2NrU2V0T3BlcmF0aW9uSW1wbGVtZW50YXRpb24gPSAoe1xuICBjb250ZXh0LFxuICBvcGVyYXRpb25cbn0pID0+IHtcbiAgY29uc3QgYmxvY2tJbmRleCA9IG9wZXJhdGlvbi5lZGl0b3IuYmxvY2tJbmRleE1hcC5nZXQob3BlcmF0aW9uLmF0WzBdLl9rZXkpO1xuICBpZiAoYmxvY2tJbmRleCA9PT0gdm9pZCAwKVxuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGZpbmQgYmxvY2sgaW5kZXggZm9yIGJsb2NrIGF0ICR7SlNPTi5zdHJpbmdpZnkob3BlcmF0aW9uLmF0KX1gKTtcbiAgY29uc3Qgc2xhdGVCbG9jayA9IG9wZXJhdGlvbi5lZGl0b3IuY2hpbGRyZW4uYXQoYmxvY2tJbmRleCk7XG4gIGlmICghc2xhdGVCbG9jaylcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIGJsb2NrIGF0ICR7SlNPTi5zdHJpbmdpZnkob3BlcmF0aW9uLmF0KX1gKTtcbiAgaWYgKGlzVGV4dEJsb2NrKGNvbnRleHQsIHNsYXRlQmxvY2spKSB7XG4gICAgY29uc3QgZmlsdGVyZWRQcm9wcyA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKG9wZXJhdGlvbi5wcm9wcykpXG4gICAgICBpZiAoIShrZXkgPT09IFwiX3R5cGVcIiB8fCBrZXkgPT09IFwiY2hpbGRyZW5cIikpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gXCJzdHlsZVwiKSB7XG4gICAgICAgICAgY29udGV4dC5zY2hlbWEuc3R5bGVzLnNvbWUoKHN0eWxlKSA9PiBzdHlsZS5uYW1lID09PSBvcGVyYXRpb24ucHJvcHNba2V5XSkgJiYgKGZpbHRlcmVkUHJvcHNba2V5XSA9IG9wZXJhdGlvbi5wcm9wc1trZXldKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09PSBcImxpc3RJdGVtXCIpIHtcbiAgICAgICAgICBjb250ZXh0LnNjaGVtYS5saXN0cy5zb21lKChsaXN0KSA9PiBsaXN0Lm5hbWUgPT09IG9wZXJhdGlvbi5wcm9wc1trZXldKSAmJiAoZmlsdGVyZWRQcm9wc1trZXldID0gb3BlcmF0aW9uLnByb3BzW2tleV0pO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT09IFwibGV2ZWxcIikge1xuICAgICAgICAgIGZpbHRlcmVkUHJvcHNba2V5XSA9IG9wZXJhdGlvbi5wcm9wc1trZXldO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT09IFwibWFya0RlZnNcIikge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIG1hcmtEZWZzXG4gICAgICAgICAgfSA9IHBhcnNlTWFya0RlZnMoe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIG1hcmtEZWZzOiBvcGVyYXRpb24ucHJvcHNba2V5XSxcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgdmFsaWRhdGVGaWVsZHM6ICEwXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZmlsdGVyZWRQcm9wc1trZXldID0gbWFya0RlZnM7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29udGV4dC5zY2hlbWEuYmxvY2suZmllbGRzPy5zb21lKChmaWVsZCkgPT4gZmllbGQubmFtZSA9PT0ga2V5KSAmJiAoZmlsdGVyZWRQcm9wc1trZXldID0gb3BlcmF0aW9uLnByb3BzW2tleV0pO1xuICAgICAgfVxuICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMob3BlcmF0aW9uLmVkaXRvciwgZmlsdGVyZWRQcm9wcywge1xuICAgICAgYXQ6IFtibG9ja0luZGV4XVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHNjaGVtYURlZmluaXRpb24gPSBjb250ZXh0LnNjaGVtYS5ibG9ja09iamVjdHMuZmluZCgoZGVmaW5pdGlvbikgPT4gZGVmaW5pdGlvbi5uYW1lID09PSBzbGF0ZUJsb2NrLl90eXBlKSwgZmlsdGVyZWRQcm9wcyA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKG9wZXJhdGlvbi5wcm9wcykpXG4gICAgICBpZiAoa2V5ICE9PSBcIl90eXBlXCIpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gXCJfa2V5XCIpIHtcbiAgICAgICAgICBmaWx0ZXJlZFByb3BzW2tleV0gPSBvcGVyYXRpb24ucHJvcHNba2V5XTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBzY2hlbWFEZWZpbml0aW9uPy5maWVsZHMuc29tZSgoZmllbGQpID0+IGZpZWxkLm5hbWUgPT09IGtleSkgJiYgKGZpbHRlcmVkUHJvcHNba2V5XSA9IG9wZXJhdGlvbi5wcm9wc1trZXldKTtcbiAgICAgIH1cbiAgICBjb25zdCBwYXRjaGVzID0gT2JqZWN0LmVudHJpZXMoZmlsdGVyZWRQcm9wcykubWFwKChba2V5LCB2YWx1ZV0pID0+IGtleSA9PT0gXCJfa2V5XCIgPyBzZXQodmFsdWUsIFtcIl9rZXlcIl0pIDogc2V0KHZhbHVlLCBbXCJ2YWx1ZVwiLCBrZXldKSksIHVwZGF0ZWRTbGF0ZUJsb2NrID0gYXBwbHlBbGwoc2xhdGVCbG9jaywgcGF0Y2hlcyk7XG4gICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhvcGVyYXRpb24uZWRpdG9yLCB1cGRhdGVkU2xhdGVCbG9jaywge1xuICAgICAgYXQ6IFtibG9ja0luZGV4XVxuICAgIH0pO1xuICB9XG59LCBibG9ja1Vuc2V0T3BlcmF0aW9uSW1wbGVtZW50YXRpb24gPSAoe1xuICBjb250ZXh0LFxuICBvcGVyYXRpb25cbn0pID0+IHtcbiAgY29uc3QgYmxvY2tLZXkgPSBvcGVyYXRpb24uYXRbMF0uX2tleSwgYmxvY2tJbmRleCA9IG9wZXJhdGlvbi5lZGl0b3IuYmxvY2tJbmRleE1hcC5nZXQoYmxvY2tLZXkpO1xuICBpZiAoYmxvY2tJbmRleCA9PT0gdm9pZCAwKVxuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGZpbmQgYmxvY2sgaW5kZXggZm9yIGJsb2NrIGtleSAke2Jsb2NrS2V5fWApO1xuICBjb25zdCBzbGF0ZUJsb2NrID0gYmxvY2tJbmRleCAhPT0gdm9pZCAwID8gb3BlcmF0aW9uLmVkaXRvci5jaGlsZHJlbi5hdChibG9ja0luZGV4KSA6IHZvaWQgMDtcbiAgaWYgKCFzbGF0ZUJsb2NrKVxuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGZpbmQgYmxvY2sgYXQgJHtKU09OLnN0cmluZ2lmeShvcGVyYXRpb24uYXQpfWApO1xuICBpZiAoaXNUZXh0QmxvY2soY29udGV4dCwgc2xhdGVCbG9jaykpIHtcbiAgICBjb25zdCBwcm9wc1RvUmVtb3ZlID0gb3BlcmF0aW9uLnByb3BzLmZpbHRlcigocHJvcCkgPT4gcHJvcCAhPT0gXCJfdHlwZVwiICYmIHByb3AgIT09IFwiX2tleVwiICYmIHByb3AgIT09IFwiY2hpbGRyZW5cIik7XG4gICAgVHJhbnNmb3Jtcy51bnNldE5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHByb3BzVG9SZW1vdmUsIHtcbiAgICAgIGF0OiBbYmxvY2tJbmRleF1cbiAgICB9KSwgb3BlcmF0aW9uLnByb3BzLmluY2x1ZGVzKFwiX2tleVwiKSAmJiBUcmFuc2Zvcm1zLnNldE5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIF9rZXk6IGNvbnRleHQua2V5R2VuZXJhdG9yKClcbiAgICB9LCB7XG4gICAgICBhdDogW2Jsb2NrSW5kZXhdXG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHBhdGNoZXMgPSBvcGVyYXRpb24ucHJvcHMuZmxhdE1hcCgoa2V5KSA9PiBrZXkgPT09IFwiX3R5cGVcIiA/IFtdIDoga2V5ID09PSBcIl9rZXlcIiA/IHNldChjb250ZXh0LmtleUdlbmVyYXRvcigpLCBbXCJfa2V5XCJdKSA6IHVuc2V0KFtcInZhbHVlXCIsIGtleV0pKSwgdXBkYXRlZFNsYXRlQmxvY2sgPSBhcHBseUFsbChzbGF0ZUJsb2NrLCBwYXRjaGVzKTtcbiAgVHJhbnNmb3Jtcy5zZXROb2RlcyhvcGVyYXRpb24uZWRpdG9yLCB1cGRhdGVkU2xhdGVCbG9jaywge1xuICAgIGF0OiBbYmxvY2tJbmRleF1cbiAgfSk7XG59LCBjaGlsZFNldE9wZXJhdGlvbkltcGxlbWVudGF0aW9uID0gKHtcbiAgY29udGV4dCxcbiAgb3BlcmF0aW9uXG59KSA9PiB7XG4gIGNvbnN0IGxvY2F0aW9uID0gdG9TbGF0ZVJhbmdlKHtcbiAgICBjb250ZXh0OiB7XG4gICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hLFxuICAgICAgdmFsdWU6IG9wZXJhdGlvbi5lZGl0b3IudmFsdWUsXG4gICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgYW5jaG9yOiB7XG4gICAgICAgICAgcGF0aDogb3BlcmF0aW9uLmF0LFxuICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICB9LFxuICAgICAgICBmb2N1czoge1xuICAgICAgICAgIHBhdGg6IG9wZXJhdGlvbi5hdCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgYmxvY2tJbmRleE1hcDogb3BlcmF0aW9uLmVkaXRvci5ibG9ja0luZGV4TWFwXG4gIH0pO1xuICBpZiAoIWxvY2F0aW9uKVxuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGNvbnZlcnQgJHtKU09OLnN0cmluZ2lmeShvcGVyYXRpb24uYXQpfSBpbnRvIGEgU2xhdGUgUmFuZ2VgKTtcbiAgY29uc3QgY2hpbGRFbnRyeSA9IEVkaXRvci5ub2RlKG9wZXJhdGlvbi5lZGl0b3IsIGxvY2F0aW9uLCB7XG4gICAgZGVwdGg6IDJcbiAgfSksIGNoaWxkID0gY2hpbGRFbnRyeT8uWzBdLCBjaGlsZFBhdGggPSBjaGlsZEVudHJ5Py5bMV07XG4gIGlmICghY2hpbGQgfHwgIWNoaWxkUGF0aClcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIGNoaWxkIGF0ICR7SlNPTi5zdHJpbmdpZnkob3BlcmF0aW9uLmF0KX1gKTtcbiAgaWYgKG9wZXJhdGlvbi5lZGl0b3IuaXNUZXh0U3BhbihjaGlsZCkpIHtcbiAgICBjb25zdCB7XG4gICAgICBfdHlwZSxcbiAgICAgIHRleHQsXG4gICAgICAuLi5yZXN0XG4gICAgfSA9IG9wZXJhdGlvbi5wcm9wcztcbiAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIC4uLmNoaWxkLFxuICAgICAgLi4ucmVzdFxuICAgIH0sIHtcbiAgICAgIGF0OiBjaGlsZFBhdGhcbiAgICB9KSwgdHlwZW9mIHRleHQgPT0gXCJzdHJpbmdcIiAmJiBjaGlsZC50ZXh0ICE9PSB0ZXh0ICYmIChvcGVyYXRpb24uZWRpdG9yLmFwcGx5KHtcbiAgICAgIHR5cGU6IFwicmVtb3ZlX3RleHRcIixcbiAgICAgIHBhdGg6IGNoaWxkUGF0aCxcbiAgICAgIG9mZnNldDogMCxcbiAgICAgIHRleHQ6IGNoaWxkLnRleHRcbiAgICB9KSwgb3BlcmF0aW9uLmVkaXRvci5hcHBseSh7XG4gICAgICB0eXBlOiBcImluc2VydF90ZXh0XCIsXG4gICAgICBwYXRoOiBjaGlsZFBhdGgsXG4gICAgICBvZmZzZXQ6IDAsXG4gICAgICB0ZXh0XG4gICAgfSkpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoRWxlbWVudCQxLmlzRWxlbWVudChjaGlsZCkpIHtcbiAgICBjb25zdCBkZWZpbml0aW9uID0gY29udGV4dC5zY2hlbWEuaW5saW5lT2JqZWN0cy5maW5kKChkZWZpbml0aW9uMikgPT4gZGVmaW5pdGlvbjIubmFtZSA9PT0gY2hpbGQuX3R5cGUpO1xuICAgIGlmICghZGVmaW5pdGlvbilcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGZpbmQgc2NoZW1hIGRlZmluaXRpb24gZm9yIElubGluZSBPYmplY3QgdHlwZSAke2NoaWxkLl90eXBlfWApO1xuICAgIGNvbnN0IHZhbHVlID0gXCJ2YWx1ZVwiIGluIGNoaWxkICYmIHR5cGVvZiBjaGlsZC52YWx1ZSA9PSBcIm9iamVjdFwiID8gY2hpbGQudmFsdWUgOiB7fSwge1xuICAgICAgX3R5cGUsXG4gICAgICBfa2V5LFxuICAgICAgLi4ucmVzdFxuICAgIH0gPSBvcGVyYXRpb24ucHJvcHM7XG4gICAgZm9yIChjb25zdCBwcm9wIGluIHJlc3QpXG4gICAgICBkZWZpbml0aW9uLmZpZWxkcy5zb21lKChmaWVsZCkgPT4gZmllbGQubmFtZSA9PT0gcHJvcCkgfHwgZGVsZXRlIHJlc3RbcHJvcF07XG4gICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgICAuLi5jaGlsZCxcbiAgICAgIF9rZXk6IHR5cGVvZiBfa2V5ID09IFwic3RyaW5nXCIgPyBfa2V5IDogY2hpbGQuX2tleSxcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIC4uLnZhbHVlLFxuICAgICAgICAuLi5yZXN0XG4gICAgICB9XG4gICAgfSwge1xuICAgICAgYXQ6IGNoaWxkUGF0aFxuICAgIH0pO1xuICAgIHJldHVybjtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBkZXRlcm1pbmUgdGhlIHR5cGUgb2YgY2hpbGQgYXQgJHtKU09OLnN0cmluZ2lmeShvcGVyYXRpb24uYXQpfWApO1xufSwgY2hpbGRVbnNldE9wZXJhdGlvbkltcGxlbWVudGF0aW9uID0gKHtcbiAgY29udGV4dCxcbiAgb3BlcmF0aW9uXG59KSA9PiB7XG4gIGNvbnN0IGJsb2NrS2V5ID0gb3BlcmF0aW9uLmF0WzBdLl9rZXksIGJsb2NrSW5kZXggPSBvcGVyYXRpb24uZWRpdG9yLmJsb2NrSW5kZXhNYXAuZ2V0KGJsb2NrS2V5KTtcbiAgaWYgKGJsb2NrSW5kZXggPT09IHZvaWQgMClcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIGJsb2NrIGluZGV4IGZvciBibG9jayBrZXkgJHtibG9ja0tleX1gKTtcbiAgY29uc3QgYmxvY2sgPSBibG9ja0luZGV4ICE9PSB2b2lkIDAgPyBvcGVyYXRpb24uZWRpdG9yLnZhbHVlLmF0KGJsb2NrSW5kZXgpIDogdm9pZCAwO1xuICBpZiAoIWJsb2NrKVxuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGZpbmQgYmxvY2sgYXQgJHtKU09OLnN0cmluZ2lmeShvcGVyYXRpb24uYXQpfWApO1xuICBpZiAoIWlzVGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEJsb2NrICR7SlNPTi5zdHJpbmdpZnkoYmxvY2tLZXkpfSBpcyBub3QgYSB0ZXh0IGJsb2NrYCk7XG4gIGNvbnN0IGNoaWxkS2V5ID0gb3BlcmF0aW9uLmF0WzJdLl9rZXk7XG4gIGlmICghY2hpbGRLZXkpXG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gZmluZCBjaGlsZCBrZXkgYXQgJHtKU09OLnN0cmluZ2lmeShvcGVyYXRpb24uYXQpfWApO1xuICBjb25zdCBjaGlsZEluZGV4ID0gYmxvY2suY2hpbGRyZW4uZmluZEluZGV4KChjaGlsZDIpID0+IGNoaWxkMi5fa2V5ID09PSBjaGlsZEtleSk7XG4gIGlmIChjaGlsZEluZGV4ID09PSAtMSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIGNoaWxkIGF0ICR7SlNPTi5zdHJpbmdpZnkob3BlcmF0aW9uLmF0KX1gKTtcbiAgY29uc3QgY2hpbGRFbnRyeSA9IEVkaXRvci5ub2RlKG9wZXJhdGlvbi5lZGl0b3IsIFtibG9ja0luZGV4LCBjaGlsZEluZGV4XSwge1xuICAgIGRlcHRoOiAyXG4gIH0pLCBjaGlsZCA9IGNoaWxkRW50cnk/LlswXSwgY2hpbGRQYXRoID0gY2hpbGRFbnRyeT8uWzFdO1xuICBpZiAoIWNoaWxkIHx8ICFjaGlsZFBhdGgpXG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gZmluZCBjaGlsZCBhdCAke0pTT04uc3RyaW5naWZ5KG9wZXJhdGlvbi5hdCl9YCk7XG4gIGlmIChvcGVyYXRpb24uZWRpdG9yLmlzVGV4dFNwYW4oY2hpbGQpKSB7XG4gICAgY29uc3QgbmV3Tm9kZSA9IHt9O1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiBvcGVyYXRpb24ucHJvcHMpXG4gICAgICBpZiAocHJvcCAhPT0gXCJ0ZXh0XCIgJiYgcHJvcCAhPT0gXCJfdHlwZVwiKSB7XG4gICAgICAgIGlmIChwcm9wID09PSBcIl9rZXlcIikge1xuICAgICAgICAgIG5ld05vZGUuX2tleSA9IGNvbnRleHQua2V5R2VuZXJhdG9yKCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgbmV3Tm9kZVtwcm9wXSA9IG51bGw7XG4gICAgICB9XG4gICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhvcGVyYXRpb24uZWRpdG9yLCBuZXdOb2RlLCB7XG4gICAgICBhdDogY2hpbGRQYXRoXG4gICAgfSksIG9wZXJhdGlvbi5wcm9wcy5pbmNsdWRlcyhcInRleHRcIikgJiYgb3BlcmF0aW9uLmVkaXRvci5hcHBseSh7XG4gICAgICB0eXBlOiBcInJlbW92ZV90ZXh0XCIsXG4gICAgICBwYXRoOiBjaGlsZFBhdGgsXG4gICAgICBvZmZzZXQ6IDAsXG4gICAgICB0ZXh0OiBjaGlsZC50ZXh0XG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KGNoaWxkKSkge1xuICAgIGNvbnN0IHZhbHVlID0gXCJ2YWx1ZVwiIGluIGNoaWxkICYmIHR5cGVvZiBjaGlsZC52YWx1ZSA9PSBcIm9iamVjdFwiID8gY2hpbGQudmFsdWUgOiB7fSwgcGF0Y2hlcyA9IG9wZXJhdGlvbi5wcm9wcy5tYXAoKHByb3ApID0+ICh7XG4gICAgICB0eXBlOiBcInVuc2V0XCIsXG4gICAgICBwYXRoOiBbcHJvcF1cbiAgICB9KSksIG5ld1ZhbHVlID0gYXBwbHlBbGwodmFsdWUsIHBhdGNoZXMpO1xuICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMob3BlcmF0aW9uLmVkaXRvciwge1xuICAgICAgLi4uY2hpbGQsXG4gICAgICBfa2V5OiBvcGVyYXRpb24ucHJvcHMuaW5jbHVkZXMoXCJfa2V5XCIpID8gY29udGV4dC5rZXlHZW5lcmF0b3IoKSA6IGNoaWxkLl9rZXksXG4gICAgICB2YWx1ZTogbmV3VmFsdWVcbiAgICB9LCB7XG4gICAgICBhdDogY2hpbGRQYXRoXG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGRldGVybWluZSB0aGUgdHlwZSBvZiBjaGlsZCBhdCAke0pTT04uc3RyaW5naWZ5KG9wZXJhdGlvbi5hdCl9YCk7XG59LCBkZWNvcmF0b3JBZGRPcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIGNvbnRleHQsXG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBjb25zdCBlZGl0b3IgPSBvcGVyYXRpb24uZWRpdG9yLCBtYXJrID0gb3BlcmF0aW9uLmRlY29yYXRvcjtcbiAgbGV0IGF0ID0gb3BlcmF0aW9uLmF0ID8gdG9TbGF0ZVJhbmdlKHtcbiAgICBjb250ZXh0OiB7XG4gICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hLFxuICAgICAgdmFsdWU6IG9wZXJhdGlvbi5lZGl0b3IudmFsdWUsXG4gICAgICBzZWxlY3Rpb246IG9wZXJhdGlvbi5hdFxuICAgIH0sXG4gICAgYmxvY2tJbmRleE1hcDogb3BlcmF0aW9uLmVkaXRvci5ibG9ja0luZGV4TWFwXG4gIH0pIDogb3BlcmF0aW9uLmVkaXRvci5zZWxlY3Rpb247XG4gIGlmICghYXQpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGFkZCBkZWNvcmF0b3Igd2l0aG91dCBhIHNlbGVjdGlvblwiKTtcbiAgaWYgKFJhbmdlLmlzRXhwYW5kZWQoYXQpKSB7XG4gICAgY29uc3QgcmFuZ2VSZWYgPSBFZGl0b3IucmFuZ2VSZWYoZWRpdG9yLCBhdCwge1xuICAgICAgYWZmaW5pdHk6IFwiaW53YXJkXCJcbiAgICB9KSwgW3N0YXJ0LCBlbmRdID0gUmFuZ2UuZWRnZXMoYXQpLCBlbmRBdEVuZE9mTm9kZSA9IEVkaXRvci5pc0VuZChlZGl0b3IsIGVuZCwgZW5kLnBhdGgpO1xuICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHtcbiAgICAgIGF0OiBlbmQsXG4gICAgICBtYXRjaDogVGV4dC5pc1RleHQsXG4gICAgICBtb2RlOiBcImxvd2VzdFwiLFxuICAgICAgdm9pZHM6ICExLFxuICAgICAgYWx3YXlzOiAhZW5kQXRFbmRPZk5vZGVcbiAgICB9KTtcbiAgICBjb25zdCBzdGFydEF0U3RhcnRPZk5vZGUgPSBFZGl0b3IuaXNTdGFydChlZGl0b3IsIHN0YXJ0LCBzdGFydC5wYXRoKTtcbiAgICBpZiAoVHJhbnNmb3Jtcy5zcGxpdE5vZGVzKGVkaXRvciwge1xuICAgICAgYXQ6IHN0YXJ0LFxuICAgICAgbWF0Y2g6IFRleHQuaXNUZXh0LFxuICAgICAgbW9kZTogXCJsb3dlc3RcIixcbiAgICAgIHZvaWRzOiAhMSxcbiAgICAgIGFsd2F5czogIXN0YXJ0QXRTdGFydE9mTm9kZVxuICAgIH0pLCBhdCA9IHJhbmdlUmVmLnVucmVmKCksICFhdClcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBhZGQgZGVjb3JhdG9yIHdpdGhvdXQgYSBzZWxlY3Rpb25cIik7XG4gICAgb3BlcmF0aW9uLmF0IHx8IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgYXQpO1xuICAgIGNvbnN0IHNwbGl0VGV4dE5vZGVzID0gRWRpdG9yLm5vZGVzKGVkaXRvciwge1xuICAgICAgYXQsXG4gICAgICBtYXRjaDogVGV4dC5pc1RleHRcbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IFtub2RlLCBwYXRoXSBvZiBzcGxpdFRleHROb2Rlcykge1xuICAgICAgY29uc3QgbWFya3MgPSBbLi4uKEFycmF5LmlzQXJyYXkobm9kZS5tYXJrcykgPyBub2RlLm1hcmtzIDogW10pLmZpbHRlcigoZU1hcmspID0+IGVNYXJrICE9PSBtYXJrKSwgbWFya107XG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICBtYXJrc1xuICAgICAgfSwge1xuICAgICAgICBhdDogcGF0aCxcbiAgICAgICAgbWF0Y2g6IFRleHQuaXNUZXh0LFxuICAgICAgICBzcGxpdDogITAsXG4gICAgICAgIGhhbmdpbmc6ICEwXG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKCFBcnJheS5mcm9tKEVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICAgIGF0LFxuICAgICAgbWF0Y2g6IChub2RlKSA9PiBlZGl0b3IuaXNUZXh0U3Bhbihub2RlKVxuICAgIH0pKT8uYXQoMCkpXG4gICAgICByZXR1cm47XG4gICAgY29uc3QgW2Jsb2NrLCBibG9ja1BhdGhdID0gRWRpdG9yLm5vZGUoZWRpdG9yLCBhdCwge1xuICAgICAgZGVwdGg6IDFcbiAgICB9KSwgbG9uZWx5RW1wdHlTcGFuID0gZWRpdG9yLmlzVGV4dEJsb2NrKGJsb2NrKSAmJiBibG9jay5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgZWRpdG9yLmlzVGV4dFNwYW4oYmxvY2suY2hpbGRyZW5bMF0pICYmIGJsb2NrLmNoaWxkcmVuWzBdLnRleHQgPT09IFwiXCIgPyBibG9jay5jaGlsZHJlblswXSA6IHZvaWQgMDtcbiAgICBpZiAobG9uZWx5RW1wdHlTcGFuKSB7XG4gICAgICBjb25zdCBleGlzdGluZ01hcmtzID0gbG9uZWx5RW1wdHlTcGFuLm1hcmtzID8/IFtdLCBleGlzdGluZ01hcmtzV2l0aG91dERlY29yYXRvciA9IGV4aXN0aW5nTWFya3MuZmlsdGVyKChleGlzdGluZ01hcmspID0+IGV4aXN0aW5nTWFyayAhPT0gbWFyayk7XG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICBtYXJrczogZXhpc3RpbmdNYXJrcy5sZW5ndGggPT09IGV4aXN0aW5nTWFya3NXaXRob3V0RGVjb3JhdG9yLmxlbmd0aCA/IFsuLi5leGlzdGluZ01hcmtzLCBtYXJrXSA6IGV4aXN0aW5nTWFya3NXaXRob3V0RGVjb3JhdG9yXG4gICAgICB9LCB7XG4gICAgICAgIGF0OiBibG9ja1BhdGgsXG4gICAgICAgIG1hdGNoOiAobm9kZSkgPT4gZWRpdG9yLmlzVGV4dFNwYW4obm9kZSlcbiAgICAgIH0pO1xuICAgIH0gZWxzZVxuICAgICAgZWRpdG9yLmRlY29yYXRvclN0YXRlW21hcmtdID0gITA7XG4gIH1cbiAgaWYgKGVkaXRvci5zZWxlY3Rpb24pIHtcbiAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uO1xuICAgIGVkaXRvci5zZWxlY3Rpb24gPSB7XG4gICAgICAuLi5zZWxlY3Rpb25cbiAgICB9O1xuICB9XG59LCBkZWNvcmF0b3JSZW1vdmVPcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBjb25zdCBlZGl0b3IgPSBvcGVyYXRpb24uZWRpdG9yLCBtYXJrID0gb3BlcmF0aW9uLmRlY29yYXRvciwge1xuICAgIHNlbGVjdGlvblxuICB9ID0gZWRpdG9yO1xuICBpZiAoc2VsZWN0aW9uKSB7XG4gICAgaWYgKFJhbmdlLmlzRXhwYW5kZWQoc2VsZWN0aW9uKSlcbiAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7fSwge1xuICAgICAgICBtYXRjaDogVGV4dC5pc1RleHQsXG4gICAgICAgIHNwbGl0OiAhMCxcbiAgICAgICAgaGFuZ2luZzogITBcbiAgICAgIH0pLCBlZGl0b3Iuc2VsZWN0aW9uICYmIFsuLi5FZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgICAgIGF0OiBlZGl0b3Iuc2VsZWN0aW9uLFxuICAgICAgICBtYXRjaDogVGV4dC5pc1RleHRcbiAgICAgIH0pXS5mb3JFYWNoKChbbm9kZSwgcGF0aF0pID0+IHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBlZGl0b3IuY2hpbGRyZW5bcGF0aFswXV07XG4gICAgICAgIEVsZW1lbnQkMS5pc0VsZW1lbnQoYmxvY2spICYmIGJsb2NrLmNoaWxkcmVuLmluY2x1ZGVzKG5vZGUpICYmIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgbWFya3M6IChBcnJheS5pc0FycmF5KG5vZGUubWFya3MpID8gbm9kZS5tYXJrcyA6IFtdKS5maWx0ZXIoKGVNYXJrKSA9PiBlTWFyayAhPT0gbWFyayksXG4gICAgICAgICAgX3R5cGU6IFwic3BhblwiXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBhdDogcGF0aFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIGVsc2Uge1xuICAgICAgY29uc3QgW2Jsb2NrLCBibG9ja1BhdGhdID0gRWRpdG9yLm5vZGUoZWRpdG9yLCBzZWxlY3Rpb24sIHtcbiAgICAgICAgZGVwdGg6IDFcbiAgICAgIH0pLCBsb25lbHlFbXB0eVNwYW4gPSBlZGl0b3IuaXNUZXh0QmxvY2soYmxvY2spICYmIGJsb2NrLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJiBlZGl0b3IuaXNUZXh0U3BhbihibG9jay5jaGlsZHJlblswXSkgJiYgYmxvY2suY2hpbGRyZW5bMF0udGV4dCA9PT0gXCJcIiA/IGJsb2NrLmNoaWxkcmVuWzBdIDogdm9pZCAwO1xuICAgICAgaWYgKGxvbmVseUVtcHR5U3Bhbikge1xuICAgICAgICBjb25zdCBleGlzdGluZ01hcmtzV2l0aG91dERlY29yYXRvciA9IChsb25lbHlFbXB0eVNwYW4ubWFya3MgPz8gW10pLmZpbHRlcigoZXhpc3RpbmdNYXJrKSA9PiBleGlzdGluZ01hcmsgIT09IG1hcmspO1xuICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgIG1hcmtzOiBleGlzdGluZ01hcmtzV2l0aG91dERlY29yYXRvclxuICAgICAgICB9LCB7XG4gICAgICAgICAgYXQ6IGJsb2NrUGF0aCxcbiAgICAgICAgICBtYXRjaDogKG5vZGUpID0+IGVkaXRvci5pc1RleHRTcGFuKG5vZGUpXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlXG4gICAgICAgIGVkaXRvci5kZWNvcmF0b3JTdGF0ZVttYXJrXSA9ICExO1xuICAgIH1cbiAgICBpZiAoZWRpdG9yLnNlbGVjdGlvbikge1xuICAgICAgY29uc3Qgc2VsZWN0aW9uMiA9IGVkaXRvci5zZWxlY3Rpb247XG4gICAgICBlZGl0b3Iuc2VsZWN0aW9uID0ge1xuICAgICAgICAuLi5zZWxlY3Rpb24yXG4gICAgICB9O1xuICAgIH1cbiAgfVxufSwgZGVsZXRlT3BlcmF0aW9uSW1wbGVtZW50YXRpb24gPSAoe1xuICBjb250ZXh0LFxuICBvcGVyYXRpb25cbn0pID0+IHtcbiAgY29uc3QgYXQgPSBvcGVyYXRpb24uYXQgPyB0b1NsYXRlUmFuZ2Uoe1xuICAgIGNvbnRleHQ6IHtcbiAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICB2YWx1ZTogb3BlcmF0aW9uLmVkaXRvci52YWx1ZSxcbiAgICAgIHNlbGVjdGlvbjogb3BlcmF0aW9uLmF0XG4gICAgfSxcbiAgICBibG9ja0luZGV4TWFwOiBvcGVyYXRpb24uZWRpdG9yLmJsb2NrSW5kZXhNYXBcbiAgfSkgOiBvcGVyYXRpb24uZWRpdG9yLnNlbGVjdGlvbjtcbiAgaWYgKCFhdClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gZGVsZXRlIHdpdGhvdXQgYSBzZWxlY3Rpb25cIik7XG4gIGNvbnN0IFtzdGFydCwgZW5kXSA9IFJhbmdlLmVkZ2VzKGF0KTtcbiAgaWYgKG9wZXJhdGlvbi51bml0ID09PSBcImJsb2NrXCIpIHtcbiAgICBjb25zdCBzdGFydEJsb2NrSW5kZXggPSBzdGFydC5wYXRoLmF0KDApLCBlbmRCbG9ja0luZGV4ID0gZW5kLnBhdGguYXQoMCk7XG4gICAgaWYgKHN0YXJ0QmxvY2tJbmRleCA9PT0gdm9pZCAwIHx8IGVuZEJsb2NrSW5kZXggPT09IHZvaWQgMClcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBnZXQgc3RhcnQgb3IgZW5kIGJsb2NrIGluZGV4XCIpO1xuICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMob3BlcmF0aW9uLmVkaXRvciwge1xuICAgICAgYXQ6IHtcbiAgICAgICAgYW5jaG9yOiB7XG4gICAgICAgICAgcGF0aDogW3N0YXJ0QmxvY2tJbmRleF0sXG4gICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgcGF0aDogW2VuZEJsb2NrSW5kZXhdLFxuICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbW9kZTogXCJoaWdoZXN0XCJcbiAgICB9KTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKG9wZXJhdGlvbi51bml0ID09PSBcImNoaWxkXCIpIHtcbiAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIGF0LFxuICAgICAgbWF0Y2g6IChub2RlKSA9PiBpc1NwYW4oY29udGV4dCwgbm9kZSkgJiYgbm9kZS5fa2V5ICE9PSBWT0lEX0NISUxEX0tFWSB8fCBcIl9faW5saW5lXCIgaW4gbm9kZSAmJiBub2RlLl9faW5saW5lID09PSAhMFxuICAgIH0pO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAob3BlcmF0aW9uLmRpcmVjdGlvbiA9PT0gXCJiYWNrd2FyZFwiICYmIG9wZXJhdGlvbi51bml0ID09PSBcImxpbmVcIikge1xuICAgIGNvbnN0IHBhcmVudEJsb2NrRW50cnkgPSBFZGl0b3IuYWJvdmUob3BlcmF0aW9uLmVkaXRvciwge1xuICAgICAgbWF0Y2g6IChuKSA9PiBFbGVtZW50JDEuaXNFbGVtZW50KG4pICYmIEVkaXRvci5pc0Jsb2NrKG9wZXJhdGlvbi5lZGl0b3IsIG4pLFxuICAgICAgYXRcbiAgICB9KTtcbiAgICBpZiAocGFyZW50QmxvY2tFbnRyeSkge1xuICAgICAgY29uc3QgWywgcGFyZW50QmxvY2tQYXRoXSA9IHBhcmVudEJsb2NrRW50cnksIHBhcmVudEVsZW1lbnRSYW5nZSA9IEVkaXRvci5yYW5nZShvcGVyYXRpb24uZWRpdG9yLCBwYXJlbnRCbG9ja1BhdGgsIGF0LmFuY2hvciksIGN1cnJlbnRMaW5lUmFuZ2UgPSBmaW5kQ3VycmVudExpbmVSYW5nZShvcGVyYXRpb24uZWRpdG9yLCBwYXJlbnRFbGVtZW50UmFuZ2UpO1xuICAgICAgaWYgKCFSYW5nZS5pc0NvbGxhcHNlZChjdXJyZW50TGluZVJhbmdlKSkge1xuICAgICAgICBUcmFuc2Zvcm1zLmRlbGV0ZShvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgICAgICAgYXQ6IGN1cnJlbnRMaW5lUmFuZ2VcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKG9wZXJhdGlvbi51bml0ID09PSBcIndvcmRcIiAmJiBSYW5nZS5pc0NvbGxhcHNlZChhdCkpIHtcbiAgICBkZWxldGVUZXh0KG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIGF0LFxuICAgICAgdW5pdDogXCJ3b3JkXCIsXG4gICAgICByZXZlcnNlOiBvcGVyYXRpb24uZGlyZWN0aW9uID09PSBcImJhY2t3YXJkXCJcbiAgICB9KTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qgc3RhcnRCbG9jayA9IEVkaXRvci5hYm92ZShvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgbWF0Y2g6IChuKSA9PiBFbGVtZW50JDEuaXNFbGVtZW50KG4pICYmIEVkaXRvci5pc0Jsb2NrKG9wZXJhdGlvbi5lZGl0b3IsIG4pLFxuICAgIGF0OiBzdGFydCxcbiAgICB2b2lkczogITFcbiAgfSksIGVuZEJsb2NrID0gRWRpdG9yLmFib3ZlKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICBtYXRjaDogKG4pID0+IEVsZW1lbnQkMS5pc0VsZW1lbnQobikgJiYgRWRpdG9yLmlzQmxvY2sob3BlcmF0aW9uLmVkaXRvciwgbiksXG4gICAgYXQ6IGVuZCxcbiAgICB2b2lkczogITFcbiAgfSksIGlzQWNyb3NzQmxvY2tzID0gc3RhcnRCbG9jayAmJiBlbmRCbG9jayAmJiAhUGF0aC5lcXVhbHMoc3RhcnRCbG9ja1sxXSwgZW5kQmxvY2tbMV0pLCBzdGFydE5vbkVkaXRhYmxlID0gRWRpdG9yLnZvaWQob3BlcmF0aW9uLmVkaXRvciwge1xuICAgIGF0OiBzdGFydCxcbiAgICBtb2RlOiBcImhpZ2hlc3RcIlxuICB9KSA/PyBFZGl0b3IuZWxlbWVudFJlYWRPbmx5KG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICBhdDogc3RhcnQsXG4gICAgbW9kZTogXCJoaWdoZXN0XCJcbiAgfSksIGVuZE5vbkVkaXRhYmxlID0gRWRpdG9yLnZvaWQob3BlcmF0aW9uLmVkaXRvciwge1xuICAgIGF0OiBlbmQsXG4gICAgbW9kZTogXCJoaWdoZXN0XCJcbiAgfSkgPz8gRWRpdG9yLmVsZW1lbnRSZWFkT25seShvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgYXQ6IGVuZCxcbiAgICBtb2RlOiBcImhpZ2hlc3RcIlxuICB9KSwgbWF0Y2hlcyA9IFtdO1xuICBsZXQgbGFzdFBhdGg7XG4gIGZvciAoY29uc3QgZW50cnkgb2YgRWRpdG9yLm5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICBhdCxcbiAgICB2b2lkczogITFcbiAgfSkpIHtcbiAgICBjb25zdCBbbm9kZSwgcGF0aF0gPSBlbnRyeTtcbiAgICBsYXN0UGF0aCAmJiBQYXRoLmNvbXBhcmUocGF0aCwgbGFzdFBhdGgpID09PSAwIHx8IChFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIChFZGl0b3IuaXNWb2lkKG9wZXJhdGlvbi5lZGl0b3IsIG5vZGUpIHx8IEVkaXRvci5pc0VsZW1lbnRSZWFkT25seShvcGVyYXRpb24uZWRpdG9yLCBub2RlKSkgfHwgIVBhdGguaXNDb21tb24ocGF0aCwgc3RhcnQucGF0aCkgJiYgIVBhdGguaXNDb21tb24ocGF0aCwgZW5kLnBhdGgpKSAmJiAobWF0Y2hlcy5wdXNoKGVudHJ5KSwgbGFzdFBhdGggPSBwYXRoKTtcbiAgfVxuICBjb25zdCBwYXRoUmVmcyA9IEFycmF5LmZyb20obWF0Y2hlcywgKFssIHBhdGhdKSA9PiBFZGl0b3IucGF0aFJlZihvcGVyYXRpb24uZWRpdG9yLCBwYXRoKSksIHN0YXJ0UmVmID0gRWRpdG9yLnBvaW50UmVmKG9wZXJhdGlvbi5lZGl0b3IsIHN0YXJ0KSwgZW5kUmVmID0gRWRpdG9yLnBvaW50UmVmKG9wZXJhdGlvbi5lZGl0b3IsIGVuZCk7XG4gIGlmIChzdGFydEJsb2NrICYmIGVuZEJsb2NrICYmIFBvaW50LmVxdWFscyhzdGFydCwgRWRpdG9yLnN0YXJ0KG9wZXJhdGlvbi5lZGl0b3IsIHN0YXJ0QmxvY2tbMV0pKSAmJiBQb2ludC5lcXVhbHMoZW5kLCBFZGl0b3IuZW5kKG9wZXJhdGlvbi5lZGl0b3IsIGVuZEJsb2NrWzFdKSkgJiYgaXNBY3Jvc3NCbG9ja3MgJiYgIXN0YXJ0Tm9uRWRpdGFibGUgJiYgIWVuZE5vbkVkaXRhYmxlKSB7XG4gICAgaWYgKCFzdGFydE5vbkVkaXRhYmxlKSB7XG4gICAgICBjb25zdCBwb2ludCA9IHN0YXJ0UmVmLmN1cnJlbnQsIFtub2RlXSA9IEVkaXRvci5sZWFmKG9wZXJhdGlvbi5lZGl0b3IsIHBvaW50KTtcbiAgICAgIG5vZGUudGV4dC5sZW5ndGggPiAwICYmIG9wZXJhdGlvbi5lZGl0b3IuYXBwbHkoe1xuICAgICAgICB0eXBlOiBcInJlbW92ZV90ZXh0XCIsXG4gICAgICAgIHBhdGg6IHBvaW50LnBhdGgsXG4gICAgICAgIG9mZnNldDogMCxcbiAgICAgICAgdGV4dDogbm9kZS50ZXh0XG4gICAgICB9KTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBwYXRoUmVmIG9mIHBhdGhSZWZzLnJldmVyc2UoKSkge1xuICAgICAgY29uc3QgcGF0aCA9IHBhdGhSZWYudW5yZWYoKTtcbiAgICAgIHBhdGggJiYgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgICAgIGF0OiBwYXRoLFxuICAgICAgICB2b2lkczogITFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWVuZE5vbkVkaXRhYmxlKSB7XG4gICAgICBjb25zdCBwb2ludCA9IGVuZFJlZi5jdXJyZW50LCBbbm9kZV0gPSBFZGl0b3IubGVhZihvcGVyYXRpb24uZWRpdG9yLCBwb2ludCksIHtcbiAgICAgICAgcGF0aFxuICAgICAgfSA9IHBvaW50LCBvZmZzZXQgPSAwLCB0ZXh0ID0gbm9kZS50ZXh0LnNsaWNlKG9mZnNldCwgZW5kLm9mZnNldCk7XG4gICAgICB0ZXh0Lmxlbmd0aCA+IDAgJiYgb3BlcmF0aW9uLmVkaXRvci5hcHBseSh7XG4gICAgICAgIHR5cGU6IFwicmVtb3ZlX3RleHRcIixcbiAgICAgICAgcGF0aCxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgICB0ZXh0XG4gICAgICB9KTtcbiAgICB9XG4gICAgZW5kUmVmLmN1cnJlbnQgJiYgc3RhcnRSZWYuY3VycmVudCAmJiBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIGF0OiBlbmRSZWYuY3VycmVudCxcbiAgICAgIHZvaWRzOiAhMVxuICAgIH0pO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCByZXZlcnNlID0gb3BlcmF0aW9uLmRpcmVjdGlvbiA9PT0gXCJiYWNrd2FyZFwiLCBoYW5naW5nID0gcmV2ZXJzZSA/IGVuZCA/IGlzVGV4dEJsb2NrKGNvbnRleHQsIGVuZEJsb2NrKSA/IGVuZC5vZmZzZXQgPT09IDAgOiAhMCA6ICExIDogc3RhcnQgPyBpc1RleHRCbG9jayhjb250ZXh0LCBzdGFydEJsb2NrKSA/IHN0YXJ0Lm9mZnNldCA9PT0gMCA6ICEwIDogITE7XG4gIG9wZXJhdGlvbi5hdCA/IGRlbGV0ZVRleHQob3BlcmF0aW9uLmVkaXRvciwge1xuICAgIGF0LFxuICAgIGhhbmdpbmcsXG4gICAgcmV2ZXJzZVxuICB9KSA6IGRlbGV0ZVRleHQob3BlcmF0aW9uLmVkaXRvciwge1xuICAgIGhhbmdpbmcsXG4gICAgcmV2ZXJzZVxuICB9KTtcbn07XG5mdW5jdGlvbiBmaW5kQ3VycmVudExpbmVSYW5nZShlZGl0b3IsIHBhcmVudFJhbmdlKSB7XG4gIGNvbnN0IHBhcmVudFJhbmdlQm91bmRhcnkgPSBFZGl0b3IucmFuZ2UoZWRpdG9yLCBSYW5nZS5lbmQocGFyZW50UmFuZ2UpKSwgcG9zaXRpb25zID0gQXJyYXkuZnJvbShFZGl0b3IucG9zaXRpb25zKGVkaXRvciwge1xuICAgIGF0OiBwYXJlbnRSYW5nZVxuICB9KSk7XG4gIGxldCBsZWZ0ID0gMCwgcmlnaHQgPSBwb3NpdGlvbnMubGVuZ3RoLCBtaWRkbGUgPSBNYXRoLmZsb29yKHJpZ2h0IC8gMik7XG4gIGlmIChyYW5nZXNBcmVPblNhbWVMaW5lKGVkaXRvciwgRWRpdG9yLnJhbmdlKGVkaXRvciwgcG9zaXRpb25zW2xlZnRdKSwgcGFyZW50UmFuZ2VCb3VuZGFyeSkpXG4gICAgcmV0dXJuIEVkaXRvci5yYW5nZShlZGl0b3IsIHBvc2l0aW9uc1tsZWZ0XSwgcGFyZW50UmFuZ2VCb3VuZGFyeSk7XG4gIGlmIChwb3NpdGlvbnMubGVuZ3RoIDwgMilcbiAgICByZXR1cm4gRWRpdG9yLnJhbmdlKGVkaXRvciwgcG9zaXRpb25zW3Bvc2l0aW9ucy5sZW5ndGggLSAxXSwgcGFyZW50UmFuZ2VCb3VuZGFyeSk7XG4gIGZvciAoOyBtaWRkbGUgIT09IHBvc2l0aW9ucy5sZW5ndGggJiYgbWlkZGxlICE9PSBsZWZ0OyApXG4gICAgcmFuZ2VzQXJlT25TYW1lTGluZShlZGl0b3IsIEVkaXRvci5yYW5nZShlZGl0b3IsIHBvc2l0aW9uc1ttaWRkbGVdKSwgcGFyZW50UmFuZ2VCb3VuZGFyeSkgPyByaWdodCA9IG1pZGRsZSA6IGxlZnQgPSBtaWRkbGUsIG1pZGRsZSA9IE1hdGguZmxvb3IoKGxlZnQgKyByaWdodCkgLyAyKTtcbiAgcmV0dXJuIEVkaXRvci5yYW5nZShlZGl0b3IsIHBvc2l0aW9uc1tsZWZ0XSwgcGFyZW50UmFuZ2VCb3VuZGFyeSk7XG59XG5mdW5jdGlvbiByYW5nZXNBcmVPblNhbWVMaW5lKGVkaXRvciwgcmFuZ2UxLCByYW5nZTIpIHtcbiAgY29uc3QgcmVjdDEgPSBET01FZGl0b3IudG9ET01SYW5nZShlZGl0b3IsIHJhbmdlMSkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIHJlY3QyID0gRE9NRWRpdG9yLnRvRE9NUmFuZ2UoZWRpdG9yLCByYW5nZTIpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICByZXR1cm4gZG9tUmVjdHNJbnRlcnNlY3QocmVjdDEsIHJlY3QyKSAmJiBkb21SZWN0c0ludGVyc2VjdChyZWN0MiwgcmVjdDEpO1xufVxuZnVuY3Rpb24gZG9tUmVjdHNJbnRlcnNlY3QocmVjdCwgY29tcGFyZVJlY3QpIHtcbiAgY29uc3QgbWlkZGxlID0gKGNvbXBhcmVSZWN0LnRvcCArIGNvbXBhcmVSZWN0LmJvdHRvbSkgLyAyO1xuICByZXR1cm4gcmVjdC50b3AgPD0gbWlkZGxlICYmIHJlY3QuYm90dG9tID49IG1pZGRsZTtcbn1cbmZ1bmN0aW9uIHBsdWdpblJlZG9pbmcoZWRpdG9yLCBmbikge1xuICBjb25zdCBwcmV2ID0gZWRpdG9yLmlzUmVkb2luZztcbiAgZWRpdG9yLmlzUmVkb2luZyA9ICEwLCBmbigpLCBlZGl0b3IuaXNSZWRvaW5nID0gcHJldjtcbn1cbmZ1bmN0aW9uIHBsdWdpbldpdGhvdXRIaXN0b3J5KGVkaXRvciwgZm4pIHtcbiAgY29uc3QgcHJldiA9IGVkaXRvci53aXRoSGlzdG9yeTtcbiAgZWRpdG9yLndpdGhIaXN0b3J5ID0gITEsIGZuKCksIGVkaXRvci53aXRoSGlzdG9yeSA9IHByZXY7XG59XG5mdW5jdGlvbiBjbG9uZURpZmYoZGlmZjIpIHtcbiAgY29uc3QgW3R5cGUsIHBhdGNoXSA9IGRpZmYyO1xuICByZXR1cm4gW3R5cGUsIHBhdGNoXTtcbn1cbmZ1bmN0aW9uIGdldENvbW1vbk92ZXJsYXAodGV4dEEsIHRleHRCKSB7XG4gIGxldCB0ZXh0MSA9IHRleHRBLCB0ZXh0MiA9IHRleHRCO1xuICBjb25zdCB0ZXh0MUxlbmd0aCA9IHRleHQxLmxlbmd0aCwgdGV4dDJMZW5ndGggPSB0ZXh0Mi5sZW5ndGg7XG4gIGlmICh0ZXh0MUxlbmd0aCA9PT0gMCB8fCB0ZXh0Mkxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7XG4gIHRleHQxTGVuZ3RoID4gdGV4dDJMZW5ndGggPyB0ZXh0MSA9IHRleHQxLnN1YnN0cmluZyh0ZXh0MUxlbmd0aCAtIHRleHQyTGVuZ3RoKSA6IHRleHQxTGVuZ3RoIDwgdGV4dDJMZW5ndGggJiYgKHRleHQyID0gdGV4dDIuc3Vic3RyaW5nKDAsIHRleHQxTGVuZ3RoKSk7XG4gIGNvbnN0IHRleHRMZW5ndGggPSBNYXRoLm1pbih0ZXh0MUxlbmd0aCwgdGV4dDJMZW5ndGgpO1xuICBpZiAodGV4dDEgPT09IHRleHQyKSByZXR1cm4gdGV4dExlbmd0aDtcbiAgbGV0IGJlc3QgPSAwLCBsZW5ndGggPSAxO1xuICBmb3IgKGxldCBmb3VuZCA9IDA7IGZvdW5kICE9PSAtMTsgKSB7XG4gICAgY29uc3QgcGF0dGVybiA9IHRleHQxLnN1YnN0cmluZyh0ZXh0TGVuZ3RoIC0gbGVuZ3RoKTtcbiAgICBpZiAoZm91bmQgPSB0ZXh0Mi5pbmRleE9mKHBhdHRlcm4pLCBmb3VuZCA9PT0gLTEpIHJldHVybiBiZXN0O1xuICAgIGxlbmd0aCArPSBmb3VuZCwgKGZvdW5kID09PSAwIHx8IHRleHQxLnN1YnN0cmluZyh0ZXh0TGVuZ3RoIC0gbGVuZ3RoKSA9PT0gdGV4dDIuc3Vic3RyaW5nKDAsIGxlbmd0aCkpICYmIChiZXN0ID0gbGVuZ3RoLCBsZW5ndGgrKyk7XG4gIH1cbiAgcmV0dXJuIGJlc3Q7XG59XG5mdW5jdGlvbiBnZXRDb21tb25QcmVmaXgodGV4dDEsIHRleHQyKSB7XG4gIGlmICghdGV4dDEgfHwgIXRleHQyIHx8IHRleHQxWzBdICE9PSB0ZXh0MlswXSkgcmV0dXJuIDA7XG4gIGxldCBwb2ludGVyTWluID0gMCwgcG9pbnRlck1heCA9IE1hdGgubWluKHRleHQxLmxlbmd0aCwgdGV4dDIubGVuZ3RoKSwgcG9pbnRlck1pZCA9IHBvaW50ZXJNYXgsIHBvaW50ZXJTdGFydCA9IDA7XG4gIGZvciAoOyBwb2ludGVyTWluIDwgcG9pbnRlck1pZDsgKSB0ZXh0MS5zdWJzdHJpbmcocG9pbnRlclN0YXJ0LCBwb2ludGVyTWlkKSA9PT0gdGV4dDIuc3Vic3RyaW5nKHBvaW50ZXJTdGFydCwgcG9pbnRlck1pZCkgPyAocG9pbnRlck1pbiA9IHBvaW50ZXJNaWQsIHBvaW50ZXJTdGFydCA9IHBvaW50ZXJNaW4pIDogcG9pbnRlck1heCA9IHBvaW50ZXJNaWQsIHBvaW50ZXJNaWQgPSBNYXRoLmZsb29yKChwb2ludGVyTWF4IC0gcG9pbnRlck1pbikgLyAyICsgcG9pbnRlck1pbik7XG4gIHJldHVybiBwb2ludGVyTWlkO1xufVxuZnVuY3Rpb24gZ2V0Q29tbW9uU3VmZml4KHRleHQxLCB0ZXh0Mikge1xuICBpZiAoIXRleHQxIHx8ICF0ZXh0MiB8fCB0ZXh0MVt0ZXh0MS5sZW5ndGggLSAxXSAhPT0gdGV4dDJbdGV4dDIubGVuZ3RoIC0gMV0pIHJldHVybiAwO1xuICBsZXQgcG9pbnRlck1pbiA9IDAsIHBvaW50ZXJNYXggPSBNYXRoLm1pbih0ZXh0MS5sZW5ndGgsIHRleHQyLmxlbmd0aCksIHBvaW50ZXJNaWQgPSBwb2ludGVyTWF4LCBwb2ludGVyRW5kID0gMDtcbiAgZm9yICg7IHBvaW50ZXJNaW4gPCBwb2ludGVyTWlkOyApIHRleHQxLnN1YnN0cmluZyh0ZXh0MS5sZW5ndGggLSBwb2ludGVyTWlkLCB0ZXh0MS5sZW5ndGggLSBwb2ludGVyRW5kKSA9PT0gdGV4dDIuc3Vic3RyaW5nKHRleHQyLmxlbmd0aCAtIHBvaW50ZXJNaWQsIHRleHQyLmxlbmd0aCAtIHBvaW50ZXJFbmQpID8gKHBvaW50ZXJNaW4gPSBwb2ludGVyTWlkLCBwb2ludGVyRW5kID0gcG9pbnRlck1pbikgOiBwb2ludGVyTWF4ID0gcG9pbnRlck1pZCwgcG9pbnRlck1pZCA9IE1hdGguZmxvb3IoKHBvaW50ZXJNYXggLSBwb2ludGVyTWluKSAvIDIgKyBwb2ludGVyTWluKTtcbiAgcmV0dXJuIHBvaW50ZXJNaWQ7XG59XG5mdW5jdGlvbiBpc0hpZ2hTdXJyb2dhdGUoY2hhcikge1xuICBjb25zdCBjaGFyQ29kZSA9IGNoYXIuY2hhckNvZGVBdCgwKTtcbiAgcmV0dXJuIGNoYXJDb2RlID49IDU1Mjk2ICYmIGNoYXJDb2RlIDw9IDU2MzE5O1xufVxuZnVuY3Rpb24gaXNMb3dTdXJyb2dhdGUoY2hhcikge1xuICBjb25zdCBjaGFyQ29kZSA9IGNoYXIuY2hhckNvZGVBdCgwKTtcbiAgcmV0dXJuIGNoYXJDb2RlID49IDU2MzIwICYmIGNoYXJDb2RlIDw9IDU3MzQzO1xufVxuZnVuY3Rpb24gYmlzZWN0KHRleHQxLCB0ZXh0MiwgZGVhZGxpbmUpIHtcbiAgY29uc3QgdGV4dDFMZW5ndGggPSB0ZXh0MS5sZW5ndGgsIHRleHQyTGVuZ3RoID0gdGV4dDIubGVuZ3RoLCBtYXhEID0gTWF0aC5jZWlsKCh0ZXh0MUxlbmd0aCArIHRleHQyTGVuZ3RoKSAvIDIpLCB2T2Zmc2V0ID0gbWF4RCwgdkxlbmd0aCA9IDIgKiBtYXhELCB2MSA9IG5ldyBBcnJheSh2TGVuZ3RoKSwgdjIgPSBuZXcgQXJyYXkodkxlbmd0aCk7XG4gIGZvciAobGV0IHggPSAwOyB4IDwgdkxlbmd0aDsgeCsrKSB2MVt4XSA9IC0xLCB2Mlt4XSA9IC0xO1xuICB2MVt2T2Zmc2V0ICsgMV0gPSAwLCB2Mlt2T2Zmc2V0ICsgMV0gPSAwO1xuICBjb25zdCBkZWx0YSA9IHRleHQxTGVuZ3RoIC0gdGV4dDJMZW5ndGgsIGZyb250ID0gZGVsdGEgJSAyICE9PSAwO1xuICBsZXQgazFzdGFydCA9IDAsIGsxZW5kID0gMCwgazJzdGFydCA9IDAsIGsyZW5kID0gMDtcbiAgZm9yIChsZXQgZCA9IDA7IGQgPCBtYXhEICYmICEoRGF0ZS5ub3coKSA+IGRlYWRsaW5lKTsgZCsrKSB7XG4gICAgZm9yIChsZXQgazEgPSAtZCArIGsxc3RhcnQ7IGsxIDw9IGQgLSBrMWVuZDsgazEgKz0gMikge1xuICAgICAgY29uc3QgazFPZmZzZXQgPSB2T2Zmc2V0ICsgazE7XG4gICAgICBsZXQgeDE7XG4gICAgICBrMSA9PT0gLWQgfHwgazEgIT09IGQgJiYgdjFbazFPZmZzZXQgLSAxXSA8IHYxW2sxT2Zmc2V0ICsgMV0gPyB4MSA9IHYxW2sxT2Zmc2V0ICsgMV0gOiB4MSA9IHYxW2sxT2Zmc2V0IC0gMV0gKyAxO1xuICAgICAgbGV0IHkxID0geDEgLSBrMTtcbiAgICAgIGZvciAoOyB4MSA8IHRleHQxTGVuZ3RoICYmIHkxIDwgdGV4dDJMZW5ndGggJiYgdGV4dDEuY2hhckF0KHgxKSA9PT0gdGV4dDIuY2hhckF0KHkxKTsgKSB4MSsrLCB5MSsrO1xuICAgICAgaWYgKHYxW2sxT2Zmc2V0XSA9IHgxLCB4MSA+IHRleHQxTGVuZ3RoKSBrMWVuZCArPSAyO1xuICAgICAgZWxzZSBpZiAoeTEgPiB0ZXh0Mkxlbmd0aCkgazFzdGFydCArPSAyO1xuICAgICAgZWxzZSBpZiAoZnJvbnQpIHtcbiAgICAgICAgY29uc3QgazJPZmZzZXQgPSB2T2Zmc2V0ICsgZGVsdGEgLSBrMTtcbiAgICAgICAgaWYgKGsyT2Zmc2V0ID49IDAgJiYgazJPZmZzZXQgPCB2TGVuZ3RoICYmIHYyW2syT2Zmc2V0XSAhPT0gLTEpIHtcbiAgICAgICAgICBjb25zdCB4MiA9IHRleHQxTGVuZ3RoIC0gdjJbazJPZmZzZXRdO1xuICAgICAgICAgIGlmICh4MSA+PSB4MikgcmV0dXJuIGJpc2VjdFNwbGl0KHRleHQxLCB0ZXh0MiwgeDEsIHkxLCBkZWFkbGluZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChsZXQgazIgPSAtZCArIGsyc3RhcnQ7IGsyIDw9IGQgLSBrMmVuZDsgazIgKz0gMikge1xuICAgICAgY29uc3QgazJPZmZzZXQgPSB2T2Zmc2V0ICsgazI7XG4gICAgICBsZXQgeDI7XG4gICAgICBrMiA9PT0gLWQgfHwgazIgIT09IGQgJiYgdjJbazJPZmZzZXQgLSAxXSA8IHYyW2syT2Zmc2V0ICsgMV0gPyB4MiA9IHYyW2syT2Zmc2V0ICsgMV0gOiB4MiA9IHYyW2syT2Zmc2V0IC0gMV0gKyAxO1xuICAgICAgbGV0IHkyID0geDIgLSBrMjtcbiAgICAgIGZvciAoOyB4MiA8IHRleHQxTGVuZ3RoICYmIHkyIDwgdGV4dDJMZW5ndGggJiYgdGV4dDEuY2hhckF0KHRleHQxTGVuZ3RoIC0geDIgLSAxKSA9PT0gdGV4dDIuY2hhckF0KHRleHQyTGVuZ3RoIC0geTIgLSAxKTsgKSB4MisrLCB5MisrO1xuICAgICAgaWYgKHYyW2syT2Zmc2V0XSA9IHgyLCB4MiA+IHRleHQxTGVuZ3RoKSBrMmVuZCArPSAyO1xuICAgICAgZWxzZSBpZiAoeTIgPiB0ZXh0Mkxlbmd0aCkgazJzdGFydCArPSAyO1xuICAgICAgZWxzZSBpZiAoIWZyb250KSB7XG4gICAgICAgIGNvbnN0IGsxT2Zmc2V0ID0gdk9mZnNldCArIGRlbHRhIC0gazI7XG4gICAgICAgIGlmIChrMU9mZnNldCA+PSAwICYmIGsxT2Zmc2V0IDwgdkxlbmd0aCAmJiB2MVtrMU9mZnNldF0gIT09IC0xKSB7XG4gICAgICAgICAgY29uc3QgeDEgPSB2MVtrMU9mZnNldF0sIHkxID0gdk9mZnNldCArIHgxIC0gazFPZmZzZXQ7XG4gICAgICAgICAgaWYgKHgyID0gdGV4dDFMZW5ndGggLSB4MiwgeDEgPj0geDIpIHJldHVybiBiaXNlY3RTcGxpdCh0ZXh0MSwgdGV4dDIsIHgxLCB5MSwgZGVhZGxpbmUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBbW0RJRkZfREVMRVRFLCB0ZXh0MV0sIFtESUZGX0lOU0VSVCwgdGV4dDJdXTtcbn1cbmZ1bmN0aW9uIGJpc2VjdFNwbGl0KHRleHQxLCB0ZXh0MiwgeCwgeSwgZGVhZGxpbmUpIHtcbiAgY29uc3QgdGV4dDFhID0gdGV4dDEuc3Vic3RyaW5nKDAsIHgpLCB0ZXh0MmEgPSB0ZXh0Mi5zdWJzdHJpbmcoMCwgeSksIHRleHQxYiA9IHRleHQxLnN1YnN0cmluZyh4KSwgdGV4dDJiID0gdGV4dDIuc3Vic3RyaW5nKHkpLCBkaWZmcyA9IGRvRGlmZih0ZXh0MWEsIHRleHQyYSwge1xuICAgIGNoZWNrTGluZXM6ICExLFxuICAgIGRlYWRsaW5lXG4gIH0pLCBkaWZmc2IgPSBkb0RpZmYodGV4dDFiLCB0ZXh0MmIsIHtcbiAgICBjaGVja0xpbmVzOiAhMSxcbiAgICBkZWFkbGluZVxuICB9KTtcbiAgcmV0dXJuIGRpZmZzLmNvbmNhdChkaWZmc2IpO1xufVxuZnVuY3Rpb24gZmluZEhhbGZNYXRjaCh0ZXh0MSwgdGV4dDIsIHRpbWVvdXQgPSAxKSB7XG4gIGlmICh0aW1lb3V0IDw9IDApIHJldHVybiBudWxsO1xuICBjb25zdCBsb25nVGV4dCA9IHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCA/IHRleHQxIDogdGV4dDIsIHNob3J0VGV4dCA9IHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCA/IHRleHQyIDogdGV4dDE7XG4gIGlmIChsb25nVGV4dC5sZW5ndGggPCA0IHx8IHNob3J0VGV4dC5sZW5ndGggKiAyIDwgbG9uZ1RleHQubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgY29uc3QgaGFsZk1hdGNoMSA9IGhhbGZNYXRjaEkobG9uZ1RleHQsIHNob3J0VGV4dCwgTWF0aC5jZWlsKGxvbmdUZXh0Lmxlbmd0aCAvIDQpKSwgaGFsZk1hdGNoMiA9IGhhbGZNYXRjaEkobG9uZ1RleHQsIHNob3J0VGV4dCwgTWF0aC5jZWlsKGxvbmdUZXh0Lmxlbmd0aCAvIDIpKTtcbiAgbGV0IGhhbGZNYXRjaDtcbiAgaWYgKGhhbGZNYXRjaDEgJiYgaGFsZk1hdGNoMikgaGFsZk1hdGNoID0gaGFsZk1hdGNoMVs0XS5sZW5ndGggPiBoYWxmTWF0Y2gyWzRdLmxlbmd0aCA/IGhhbGZNYXRjaDEgOiBoYWxmTWF0Y2gyO1xuICBlbHNlIHtcbiAgICBpZiAoIWhhbGZNYXRjaDEgJiYgIWhhbGZNYXRjaDIpIHJldHVybiBudWxsO1xuICAgIGhhbGZNYXRjaDIgPyBoYWxmTWF0Y2gxIHx8IChoYWxmTWF0Y2ggPSBoYWxmTWF0Y2gyKSA6IGhhbGZNYXRjaCA9IGhhbGZNYXRjaDE7XG4gIH1cbiAgaWYgKCFoYWxmTWF0Y2gpIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBmaW5kIGEgaGFsZiBtYXRjaC5cIik7XG4gIGxldCB0ZXh0MUEsIHRleHQxQiwgdGV4dDJBLCB0ZXh0MkI7XG4gIHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCA/ICh0ZXh0MUEgPSBoYWxmTWF0Y2hbMF0sIHRleHQxQiA9IGhhbGZNYXRjaFsxXSwgdGV4dDJBID0gaGFsZk1hdGNoWzJdLCB0ZXh0MkIgPSBoYWxmTWF0Y2hbM10pIDogKHRleHQyQSA9IGhhbGZNYXRjaFswXSwgdGV4dDJCID0gaGFsZk1hdGNoWzFdLCB0ZXh0MUEgPSBoYWxmTWF0Y2hbMl0sIHRleHQxQiA9IGhhbGZNYXRjaFszXSk7XG4gIGNvbnN0IG1pZENvbW1vbiA9IGhhbGZNYXRjaFs0XTtcbiAgcmV0dXJuIFt0ZXh0MUEsIHRleHQxQiwgdGV4dDJBLCB0ZXh0MkIsIG1pZENvbW1vbl07XG59XG5mdW5jdGlvbiBoYWxmTWF0Y2hJKGxvbmdUZXh0LCBzaG9ydFRleHQsIGkpIHtcbiAgY29uc3Qgc2VlZCA9IGxvbmdUZXh0LnNsaWNlKGksIGkgKyBNYXRoLmZsb29yKGxvbmdUZXh0Lmxlbmd0aCAvIDQpKTtcbiAgbGV0IGogPSAtMSwgYmVzdENvbW1vbiA9IFwiXCIsIGJlc3RMb25nVGV4dEEsIGJlc3RMb25nVGV4dEIsIGJlc3RTaG9ydFRleHRBLCBiZXN0U2hvcnRUZXh0QjtcbiAgZm9yICg7IChqID0gc2hvcnRUZXh0LmluZGV4T2Yoc2VlZCwgaiArIDEpKSAhPT0gLTE7ICkge1xuICAgIGNvbnN0IHByZWZpeExlbmd0aCA9IGdldENvbW1vblByZWZpeChsb25nVGV4dC5zbGljZShpKSwgc2hvcnRUZXh0LnNsaWNlKGopKSwgc3VmZml4TGVuZ3RoID0gZ2V0Q29tbW9uU3VmZml4KGxvbmdUZXh0LnNsaWNlKDAsIGkpLCBzaG9ydFRleHQuc2xpY2UoMCwgaikpO1xuICAgIGJlc3RDb21tb24ubGVuZ3RoIDwgc3VmZml4TGVuZ3RoICsgcHJlZml4TGVuZ3RoICYmIChiZXN0Q29tbW9uID0gc2hvcnRUZXh0LnNsaWNlKGogLSBzdWZmaXhMZW5ndGgsIGopICsgc2hvcnRUZXh0LnNsaWNlKGosIGogKyBwcmVmaXhMZW5ndGgpLCBiZXN0TG9uZ1RleHRBID0gbG9uZ1RleHQuc2xpY2UoMCwgaSAtIHN1ZmZpeExlbmd0aCksIGJlc3RMb25nVGV4dEIgPSBsb25nVGV4dC5zbGljZShpICsgcHJlZml4TGVuZ3RoKSwgYmVzdFNob3J0VGV4dEEgPSBzaG9ydFRleHQuc2xpY2UoMCwgaiAtIHN1ZmZpeExlbmd0aCksIGJlc3RTaG9ydFRleHRCID0gc2hvcnRUZXh0LnNsaWNlKGogKyBwcmVmaXhMZW5ndGgpKTtcbiAgfVxuICByZXR1cm4gYmVzdENvbW1vbi5sZW5ndGggKiAyID49IGxvbmdUZXh0Lmxlbmd0aCA/IFtiZXN0TG9uZ1RleHRBIHx8IFwiXCIsIGJlc3RMb25nVGV4dEIgfHwgXCJcIiwgYmVzdFNob3J0VGV4dEEgfHwgXCJcIiwgYmVzdFNob3J0VGV4dEIgfHwgXCJcIiwgYmVzdENvbW1vbiB8fCBcIlwiXSA6IG51bGw7XG59XG5mdW5jdGlvbiBjaGFyc1RvTGluZXMoZGlmZnMsIGxpbmVBcnJheSkge1xuICBmb3IgKGxldCB4ID0gMDsgeCA8IGRpZmZzLmxlbmd0aDsgeCsrKSB7XG4gICAgY29uc3QgY2hhcnMgPSBkaWZmc1t4XVsxXSwgdGV4dCA9IFtdO1xuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY2hhcnMubGVuZ3RoOyB5KyspIHRleHRbeV0gPSBsaW5lQXJyYXlbY2hhcnMuY2hhckNvZGVBdCh5KV07XG4gICAgZGlmZnNbeF1bMV0gPSB0ZXh0LmpvaW4oXCJcIik7XG4gIH1cbn1cbmZ1bmN0aW9uIGxpbmVzVG9DaGFycyh0ZXh0QSwgdGV4dEIpIHtcbiAgY29uc3QgbGluZUFycmF5ID0gW10sIGxpbmVIYXNoID0ge307XG4gIGxpbmVBcnJheVswXSA9IFwiXCI7XG4gIGZ1bmN0aW9uIGRpZmZMaW5lc1RvTXVuZ2UodGV4dCkge1xuICAgIGxldCBjaGFycyA9IFwiXCIsIGxpbmVTdGFydCA9IDAsIGxpbmVFbmQgPSAtMSwgbGluZUFycmF5TGVuZ3RoID0gbGluZUFycmF5Lmxlbmd0aDtcbiAgICBmb3IgKDsgbGluZUVuZCA8IHRleHQubGVuZ3RoIC0gMTsgKSB7XG4gICAgICBsaW5lRW5kID0gdGV4dC5pbmRleE9mKGBcbmAsIGxpbmVTdGFydCksIGxpbmVFbmQgPT09IC0xICYmIChsaW5lRW5kID0gdGV4dC5sZW5ndGggLSAxKTtcbiAgICAgIGxldCBsaW5lID0gdGV4dC5zbGljZShsaW5lU3RhcnQsIGxpbmVFbmQgKyAxKTtcbiAgICAgIChsaW5lSGFzaC5oYXNPd25Qcm9wZXJ0eSA/IGxpbmVIYXNoLmhhc093blByb3BlcnR5KGxpbmUpIDogbGluZUhhc2hbbGluZV0gIT09IHZvaWQgMCkgPyBjaGFycyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxpbmVIYXNoW2xpbmVdKSA6IChsaW5lQXJyYXlMZW5ndGggPT09IG1heExpbmVzICYmIChsaW5lID0gdGV4dC5zbGljZShsaW5lU3RhcnQpLCBsaW5lRW5kID0gdGV4dC5sZW5ndGgpLCBjaGFycyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxpbmVBcnJheUxlbmd0aCksIGxpbmVIYXNoW2xpbmVdID0gbGluZUFycmF5TGVuZ3RoLCBsaW5lQXJyYXlbbGluZUFycmF5TGVuZ3RoKytdID0gbGluZSksIGxpbmVTdGFydCA9IGxpbmVFbmQgKyAxO1xuICAgIH1cbiAgICByZXR1cm4gY2hhcnM7XG4gIH1cbiAgbGV0IG1heExpbmVzID0gNGU0O1xuICBjb25zdCBjaGFyczEgPSBkaWZmTGluZXNUb011bmdlKHRleHRBKTtcbiAgbWF4TGluZXMgPSA2NTUzNTtcbiAgY29uc3QgY2hhcnMyID0gZGlmZkxpbmVzVG9NdW5nZSh0ZXh0Qik7XG4gIHJldHVybiB7XG4gICAgY2hhcnMxLFxuICAgIGNoYXJzMixcbiAgICBsaW5lQXJyYXlcbiAgfTtcbn1cbmZ1bmN0aW9uIGRvTGluZU1vZGVEaWZmKHRleHRBLCB0ZXh0Qiwgb3B0cykge1xuICBsZXQgdGV4dDEgPSB0ZXh0QSwgdGV4dDIgPSB0ZXh0QjtcbiAgY29uc3QgYSA9IGxpbmVzVG9DaGFycyh0ZXh0MSwgdGV4dDIpO1xuICB0ZXh0MSA9IGEuY2hhcnMxLCB0ZXh0MiA9IGEuY2hhcnMyO1xuICBjb25zdCBsaW5lYXJyYXkgPSBhLmxpbmVBcnJheTtcbiAgbGV0IGRpZmZzID0gZG9EaWZmKHRleHQxLCB0ZXh0Miwge1xuICAgIGNoZWNrTGluZXM6ICExLFxuICAgIGRlYWRsaW5lOiBvcHRzLmRlYWRsaW5lXG4gIH0pO1xuICBjaGFyc1RvTGluZXMoZGlmZnMsIGxpbmVhcnJheSksIGRpZmZzID0gY2xlYW51cFNlbWFudGljKGRpZmZzKSwgZGlmZnMucHVzaChbRElGRl9FUVVBTCwgXCJcIl0pO1xuICBsZXQgcG9pbnRlciA9IDAsIGNvdW50RGVsZXRlID0gMCwgY291bnRJbnNlcnQgPSAwLCB0ZXh0RGVsZXRlID0gXCJcIiwgdGV4dEluc2VydCA9IFwiXCI7XG4gIGZvciAoOyBwb2ludGVyIDwgZGlmZnMubGVuZ3RoOyApIHtcbiAgICBzd2l0Y2ggKGRpZmZzW3BvaW50ZXJdWzBdKSB7XG4gICAgICBjYXNlIERJRkZfSU5TRVJUOlxuICAgICAgICBjb3VudEluc2VydCsrLCB0ZXh0SW5zZXJ0ICs9IGRpZmZzW3BvaW50ZXJdWzFdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRElGRl9ERUxFVEU6XG4gICAgICAgIGNvdW50RGVsZXRlKyssIHRleHREZWxldGUgKz0gZGlmZnNbcG9pbnRlcl1bMV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICBpZiAoY291bnREZWxldGUgPj0gMSAmJiBjb3VudEluc2VydCA+PSAxKSB7XG4gICAgICAgICAgZGlmZnMuc3BsaWNlKHBvaW50ZXIgLSBjb3VudERlbGV0ZSAtIGNvdW50SW5zZXJ0LCBjb3VudERlbGV0ZSArIGNvdW50SW5zZXJ0KSwgcG9pbnRlciA9IHBvaW50ZXIgLSBjb3VudERlbGV0ZSAtIGNvdW50SW5zZXJ0O1xuICAgICAgICAgIGNvbnN0IGFhID0gZG9EaWZmKHRleHREZWxldGUsIHRleHRJbnNlcnQsIHtcbiAgICAgICAgICAgIGNoZWNrTGluZXM6ICExLFxuICAgICAgICAgICAgZGVhZGxpbmU6IG9wdHMuZGVhZGxpbmVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBmb3IgKGxldCBqID0gYWEubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIGRpZmZzLnNwbGljZShwb2ludGVyLCAwLCBhYVtqXSk7XG4gICAgICAgICAgcG9pbnRlciArPSBhYS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgY291bnRJbnNlcnQgPSAwLCBjb3VudERlbGV0ZSA9IDAsIHRleHREZWxldGUgPSBcIlwiLCB0ZXh0SW5zZXJ0ID0gXCJcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGRpZmYgb3BlcmF0aW9uLlwiKTtcbiAgICB9XG4gICAgcG9pbnRlcisrO1xuICB9XG4gIHJldHVybiBkaWZmcy5wb3AoKSwgZGlmZnM7XG59XG5mdW5jdGlvbiBjb21wdXRlRGlmZih0ZXh0MSwgdGV4dDIsIG9wdHMpIHtcbiAgbGV0IGRpZmZzO1xuICBpZiAoIXRleHQxKSByZXR1cm4gW1tESUZGX0lOU0VSVCwgdGV4dDJdXTtcbiAgaWYgKCF0ZXh0MikgcmV0dXJuIFtbRElGRl9ERUxFVEUsIHRleHQxXV07XG4gIGNvbnN0IGxvbmd0ZXh0ID0gdGV4dDEubGVuZ3RoID4gdGV4dDIubGVuZ3RoID8gdGV4dDEgOiB0ZXh0Miwgc2hvcnR0ZXh0ID0gdGV4dDEubGVuZ3RoID4gdGV4dDIubGVuZ3RoID8gdGV4dDIgOiB0ZXh0MSwgaSA9IGxvbmd0ZXh0LmluZGV4T2Yoc2hvcnR0ZXh0KTtcbiAgaWYgKGkgIT09IC0xKSByZXR1cm4gZGlmZnMgPSBbW0RJRkZfSU5TRVJULCBsb25ndGV4dC5zdWJzdHJpbmcoMCwgaSldLCBbRElGRl9FUVVBTCwgc2hvcnR0ZXh0XSwgW0RJRkZfSU5TRVJULCBsb25ndGV4dC5zdWJzdHJpbmcoaSArIHNob3J0dGV4dC5sZW5ndGgpXV0sIHRleHQxLmxlbmd0aCA+IHRleHQyLmxlbmd0aCAmJiAoZGlmZnNbMF1bMF0gPSBESUZGX0RFTEVURSwgZGlmZnNbMl1bMF0gPSBESUZGX0RFTEVURSksIGRpZmZzO1xuICBpZiAoc2hvcnR0ZXh0Lmxlbmd0aCA9PT0gMSkgcmV0dXJuIFtbRElGRl9ERUxFVEUsIHRleHQxXSwgW0RJRkZfSU5TRVJULCB0ZXh0Ml1dO1xuICBjb25zdCBoYWxmTWF0Y2ggPSBmaW5kSGFsZk1hdGNoKHRleHQxLCB0ZXh0Mik7XG4gIGlmIChoYWxmTWF0Y2gpIHtcbiAgICBjb25zdCB0ZXh0MUEgPSBoYWxmTWF0Y2hbMF0sIHRleHQxQiA9IGhhbGZNYXRjaFsxXSwgdGV4dDJBID0gaGFsZk1hdGNoWzJdLCB0ZXh0MkIgPSBoYWxmTWF0Y2hbM10sIG1pZENvbW1vbiA9IGhhbGZNYXRjaFs0XSwgZGlmZnNBID0gZG9EaWZmKHRleHQxQSwgdGV4dDJBLCBvcHRzKSwgZGlmZnNCID0gZG9EaWZmKHRleHQxQiwgdGV4dDJCLCBvcHRzKTtcbiAgICByZXR1cm4gZGlmZnNBLmNvbmNhdChbW0RJRkZfRVFVQUwsIG1pZENvbW1vbl1dLCBkaWZmc0IpO1xuICB9XG4gIHJldHVybiBvcHRzLmNoZWNrTGluZXMgJiYgdGV4dDEubGVuZ3RoID4gMTAwICYmIHRleHQyLmxlbmd0aCA+IDEwMCA/IGRvTGluZU1vZGVEaWZmKHRleHQxLCB0ZXh0Miwgb3B0cykgOiBiaXNlY3QodGV4dDEsIHRleHQyLCBvcHRzLmRlYWRsaW5lKTtcbn1cbnZhciBfX2RlZlByb3AkMiA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwgX19nZXRPd25Qcm9wU3ltYm9scyQyID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scywgX19oYXNPd25Qcm9wJDIgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LCBfX3Byb3BJc0VudW0kMiA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUsIF9fZGVmTm9ybWFsUHJvcCQyID0gKG9iaiwga2V5LCB2YWx1ZSkgPT4ga2V5IGluIG9iaiA/IF9fZGVmUHJvcCQyKG9iaiwga2V5LCB7XG4gIGVudW1lcmFibGU6ICEwLFxuICBjb25maWd1cmFibGU6ICEwLFxuICB3cml0YWJsZTogITAsXG4gIHZhbHVlXG59KSA6IG9ialtrZXldID0gdmFsdWUsIF9fc3ByZWFkVmFsdWVzJDIgPSAoYSwgYikgPT4ge1xuICBmb3IgKHZhciBwcm9wIGluIGIgfHwgKGIgPSB7fSkpIF9faGFzT3duUHJvcCQyLmNhbGwoYiwgcHJvcCkgJiYgX19kZWZOb3JtYWxQcm9wJDIoYSwgcHJvcCwgYltwcm9wXSk7XG4gIGlmIChfX2dldE93blByb3BTeW1ib2xzJDIpIGZvciAodmFyIHByb3Agb2YgX19nZXRPd25Qcm9wU3ltYm9scyQyKGIpKSBfX3Byb3BJc0VudW0kMi5jYWxsKGIsIHByb3ApICYmIF9fZGVmTm9ybWFsUHJvcCQyKGEsIHByb3AsIGJbcHJvcF0pO1xuICByZXR1cm4gYTtcbn07XG5jb25zdCBESUZGX0RFTEVURSA9IC0xLCBESUZGX0lOU0VSVCA9IDEsIERJRkZfRVFVQUwgPSAwO1xuZnVuY3Rpb24gZGlmZih0ZXh0QSwgdGV4dEIsIG9wdHMpIHtcbiAgaWYgKHRleHRBID09PSBudWxsIHx8IHRleHRCID09PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoXCJOdWxsIGlucHV0LiAoZGlmZilcIik7XG4gIGNvbnN0IGRpZmZzID0gZG9EaWZmKHRleHRBLCB0ZXh0QiwgY3JlYXRlSW50ZXJuYWxPcHRzKG9wdHMgfHwge30pKTtcbiAgcmV0dXJuIGFkanVzdERpZmZGb3JTdXJyb2dhdGVQYWlycyhkaWZmcyksIGRpZmZzO1xufVxuZnVuY3Rpb24gZG9EaWZmKHRleHRBLCB0ZXh0Qiwgb3B0aW9ucykge1xuICBsZXQgdGV4dDEgPSB0ZXh0QSwgdGV4dDIgPSB0ZXh0QjtcbiAgaWYgKHRleHQxID09PSB0ZXh0MikgcmV0dXJuIHRleHQxID8gW1tESUZGX0VRVUFMLCB0ZXh0MV1dIDogW107XG4gIGxldCBjb21tb25sZW5ndGggPSBnZXRDb21tb25QcmVmaXgodGV4dDEsIHRleHQyKTtcbiAgY29uc3QgY29tbW9ucHJlZml4ID0gdGV4dDEuc3Vic3RyaW5nKDAsIGNvbW1vbmxlbmd0aCk7XG4gIHRleHQxID0gdGV4dDEuc3Vic3RyaW5nKGNvbW1vbmxlbmd0aCksIHRleHQyID0gdGV4dDIuc3Vic3RyaW5nKGNvbW1vbmxlbmd0aCksIGNvbW1vbmxlbmd0aCA9IGdldENvbW1vblN1ZmZpeCh0ZXh0MSwgdGV4dDIpO1xuICBjb25zdCBjb21tb25zdWZmaXggPSB0ZXh0MS5zdWJzdHJpbmcodGV4dDEubGVuZ3RoIC0gY29tbW9ubGVuZ3RoKTtcbiAgdGV4dDEgPSB0ZXh0MS5zdWJzdHJpbmcoMCwgdGV4dDEubGVuZ3RoIC0gY29tbW9ubGVuZ3RoKSwgdGV4dDIgPSB0ZXh0Mi5zdWJzdHJpbmcoMCwgdGV4dDIubGVuZ3RoIC0gY29tbW9ubGVuZ3RoKTtcbiAgbGV0IGRpZmZzID0gY29tcHV0ZURpZmYodGV4dDEsIHRleHQyLCBvcHRpb25zKTtcbiAgcmV0dXJuIGNvbW1vbnByZWZpeCAmJiBkaWZmcy51bnNoaWZ0KFtESUZGX0VRVUFMLCBjb21tb25wcmVmaXhdKSwgY29tbW9uc3VmZml4ICYmIGRpZmZzLnB1c2goW0RJRkZfRVFVQUwsIGNvbW1vbnN1ZmZpeF0pLCBkaWZmcyA9IGNsZWFudXBNZXJnZShkaWZmcyksIGRpZmZzO1xufVxuZnVuY3Rpb24gY3JlYXRlRGVhZExpbmUodGltZW91dCkge1xuICBsZXQgdCA9IDE7XG4gIHJldHVybiB0eXBlb2YgdGltZW91dCA8IFwidVwiICYmICh0ID0gdGltZW91dCA8PSAwID8gTnVtYmVyLk1BWF9WQUxVRSA6IHRpbWVvdXQpLCBEYXRlLm5vdygpICsgdCAqIDFlMztcbn1cbmZ1bmN0aW9uIGNyZWF0ZUludGVybmFsT3B0cyhvcHRzKSB7XG4gIHJldHVybiBfX3NwcmVhZFZhbHVlcyQyKHtcbiAgICBjaGVja0xpbmVzOiAhMCxcbiAgICBkZWFkbGluZTogY3JlYXRlRGVhZExpbmUob3B0cy50aW1lb3V0IHx8IDEpXG4gIH0sIG9wdHMpO1xufVxuZnVuY3Rpb24gY29tYmluZUNoYXIoZGF0YSwgY2hhciwgZGlyKSB7XG4gIHJldHVybiBkaXIgPT09IDEgPyBkYXRhICsgY2hhciA6IGNoYXIgKyBkYXRhO1xufVxuZnVuY3Rpb24gc3BsaXRDaGFyKGRhdGEsIGRpcikge1xuICByZXR1cm4gZGlyID09PSAxID8gW2RhdGEuc3Vic3RyaW5nKDAsIGRhdGEubGVuZ3RoIC0gMSksIGRhdGFbZGF0YS5sZW5ndGggLSAxXV0gOiBbZGF0YS5zdWJzdHJpbmcoMSksIGRhdGFbMF1dO1xufVxuZnVuY3Rpb24gaGFzU2hhcmVkQ2hhcihkaWZmcywgaSwgaiwgZGlyKSB7XG4gIHJldHVybiBkaXIgPT09IDEgPyBkaWZmc1tpXVsxXVtkaWZmc1tpXVsxXS5sZW5ndGggLSAxXSA9PT0gZGlmZnNbal1bMV1bZGlmZnNbal1bMV0ubGVuZ3RoIC0gMV0gOiBkaWZmc1tpXVsxXVswXSA9PT0gZGlmZnNbal1bMV1bMF07XG59XG5mdW5jdGlvbiBkZWlzb2xhdGVDaGFyKGRpZmZzLCBpLCBkaXIpIHtcbiAgY29uc3QgaW52ID0gZGlyID09PSAxID8gLTEgOiAxO1xuICBsZXQgaW5zZXJ0SWR4ID0gbnVsbCwgZGVsZXRlSWR4ID0gbnVsbCwgaiA9IGkgKyBkaXI7XG4gIGZvciAoOyBqID49IDAgJiYgaiA8IGRpZmZzLmxlbmd0aCAmJiAoaW5zZXJ0SWR4ID09PSBudWxsIHx8IGRlbGV0ZUlkeCA9PT0gbnVsbCk7IGogKz0gZGlyKSB7XG4gICAgY29uc3QgW29wLCB0ZXh0Ml0gPSBkaWZmc1tqXTtcbiAgICBpZiAodGV4dDIubGVuZ3RoICE9PSAwKSB7XG4gICAgICBpZiAob3AgPT09IERJRkZfSU5TRVJUKSB7XG4gICAgICAgIGluc2VydElkeCA9PT0gbnVsbCAmJiAoaW5zZXJ0SWR4ID0gaik7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIGlmIChvcCA9PT0gRElGRl9ERUxFVEUpIHtcbiAgICAgICAgZGVsZXRlSWR4ID09PSBudWxsICYmIChkZWxldGVJZHggPSBqKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2UgaWYgKG9wID09PSBESUZGX0VRVUFMKSB7XG4gICAgICAgIGlmIChpbnNlcnRJZHggPT09IG51bGwgJiYgZGVsZXRlSWR4ID09PSBudWxsKSB7XG4gICAgICAgICAgY29uc3QgW3Jlc3QsIGNoYXIyXSA9IHNwbGl0Q2hhcihkaWZmc1tpXVsxXSwgZGlyKTtcbiAgICAgICAgICBkaWZmc1tpXVsxXSA9IHJlc3QsIGRpZmZzW2pdWzFdID0gY29tYmluZUNoYXIoZGlmZnNbal1bMV0sIGNoYXIyLCBpbnYpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKGluc2VydElkeCAhPT0gbnVsbCAmJiBkZWxldGVJZHggIT09IG51bGwgJiYgaGFzU2hhcmVkQ2hhcihkaWZmcywgaW5zZXJ0SWR4LCBkZWxldGVJZHgsIGRpcikpIHtcbiAgICBjb25zdCBbaW5zZXJ0VGV4dCwgaW5zZXJ0Q2hhcl0gPSBzcGxpdENoYXIoZGlmZnNbaW5zZXJ0SWR4XVsxXSwgaW52KSwgW2RlbGV0ZVRleHQyXSA9IHNwbGl0Q2hhcihkaWZmc1tkZWxldGVJZHhdWzFdLCBpbnYpO1xuICAgIGRpZmZzW2luc2VydElkeF1bMV0gPSBpbnNlcnRUZXh0LCBkaWZmc1tkZWxldGVJZHhdWzFdID0gZGVsZXRlVGV4dDIsIGRpZmZzW2ldWzFdID0gY29tYmluZUNoYXIoZGlmZnNbaV1bMV0sIGluc2VydENoYXIsIGRpcik7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IFt0ZXh0LCBjaGFyXSA9IHNwbGl0Q2hhcihkaWZmc1tpXVsxXSwgZGlyKTtcbiAgZGlmZnNbaV1bMV0gPSB0ZXh0LCBpbnNlcnRJZHggPT09IG51bGwgPyAoZGlmZnMuc3BsaWNlKGosIDAsIFtESUZGX0lOU0VSVCwgY2hhcl0pLCBkZWxldGVJZHggIT09IG51bGwgJiYgZGVsZXRlSWR4ID49IGogJiYgZGVsZXRlSWR4KyspIDogZGlmZnNbaW5zZXJ0SWR4XVsxXSA9IGNvbWJpbmVDaGFyKGRpZmZzW2luc2VydElkeF1bMV0sIGNoYXIsIGludiksIGRlbGV0ZUlkeCA9PT0gbnVsbCA/IGRpZmZzLnNwbGljZShqLCAwLCBbRElGRl9ERUxFVEUsIGNoYXJdKSA6IGRpZmZzW2RlbGV0ZUlkeF1bMV0gPSBjb21iaW5lQ2hhcihkaWZmc1tkZWxldGVJZHhdWzFdLCBjaGFyLCBpbnYpO1xufVxuZnVuY3Rpb24gYWRqdXN0RGlmZkZvclN1cnJvZ2F0ZVBhaXJzKGRpZmZzKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGlmZnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBbZGlmZlR5cGUsIGRpZmZUZXh0XSA9IGRpZmZzW2ldO1xuICAgIGlmIChkaWZmVGV4dC5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuICAgIGNvbnN0IGZpcnN0Q2hhciA9IGRpZmZUZXh0WzBdLCBsYXN0Q2hhciA9IGRpZmZUZXh0W2RpZmZUZXh0Lmxlbmd0aCAtIDFdO1xuICAgIGlzSGlnaFN1cnJvZ2F0ZShsYXN0Q2hhcikgJiYgZGlmZlR5cGUgPT09IERJRkZfRVFVQUwgJiYgZGVpc29sYXRlQ2hhcihkaWZmcywgaSwgMSksIGlzTG93U3Vycm9nYXRlKGZpcnN0Q2hhcikgJiYgZGlmZlR5cGUgPT09IERJRkZfRVFVQUwgJiYgZGVpc29sYXRlQ2hhcihkaWZmcywgaSwgLTEpO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGlmZnMubGVuZ3RoOyBpKyspIGRpZmZzW2ldWzFdLmxlbmd0aCA9PT0gMCAmJiBkaWZmcy5zcGxpY2UoaSwgMSk7XG59XG5mdW5jdGlvbiBjbGVhbnVwU2VtYW50aWMocmF3RGlmZnMpIHtcbiAgbGV0IGRpZmZzID0gcmF3RGlmZnMubWFwKChkaWZmMikgPT4gY2xvbmVEaWZmKGRpZmYyKSksIGhhc0NoYW5nZXMgPSAhMTtcbiAgY29uc3QgZXF1YWxpdGllcyA9IFtdO1xuICBsZXQgZXF1YWxpdGllc0xlbmd0aCA9IDAsIGxhc3RFcXVhbGl0eSA9IG51bGwsIHBvaW50ZXIgPSAwLCBsZW5ndGhJbnNlcnRpb25zMSA9IDAsIGxlbmd0aERlbGV0aW9uczEgPSAwLCBsZW5ndGhJbnNlcnRpb25zMiA9IDAsIGxlbmd0aERlbGV0aW9uczIgPSAwO1xuICBmb3IgKDsgcG9pbnRlciA8IGRpZmZzLmxlbmd0aDsgKSBkaWZmc1twb2ludGVyXVswXSA9PT0gRElGRl9FUVVBTCA/IChlcXVhbGl0aWVzW2VxdWFsaXRpZXNMZW5ndGgrK10gPSBwb2ludGVyLCBsZW5ndGhJbnNlcnRpb25zMSA9IGxlbmd0aEluc2VydGlvbnMyLCBsZW5ndGhEZWxldGlvbnMxID0gbGVuZ3RoRGVsZXRpb25zMiwgbGVuZ3RoSW5zZXJ0aW9uczIgPSAwLCBsZW5ndGhEZWxldGlvbnMyID0gMCwgbGFzdEVxdWFsaXR5ID0gZGlmZnNbcG9pbnRlcl1bMV0pIDogKGRpZmZzW3BvaW50ZXJdWzBdID09PSBESUZGX0lOU0VSVCA/IGxlbmd0aEluc2VydGlvbnMyICs9IGRpZmZzW3BvaW50ZXJdWzFdLmxlbmd0aCA6IGxlbmd0aERlbGV0aW9uczIgKz0gZGlmZnNbcG9pbnRlcl1bMV0ubGVuZ3RoLCBsYXN0RXF1YWxpdHkgJiYgbGFzdEVxdWFsaXR5Lmxlbmd0aCA8PSBNYXRoLm1heChsZW5ndGhJbnNlcnRpb25zMSwgbGVuZ3RoRGVsZXRpb25zMSkgJiYgbGFzdEVxdWFsaXR5Lmxlbmd0aCA8PSBNYXRoLm1heChsZW5ndGhJbnNlcnRpb25zMiwgbGVuZ3RoRGVsZXRpb25zMikgJiYgKGRpZmZzLnNwbGljZShlcXVhbGl0aWVzW2VxdWFsaXRpZXNMZW5ndGggLSAxXSwgMCwgW0RJRkZfREVMRVRFLCBsYXN0RXF1YWxpdHldKSwgZGlmZnNbZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0gKyAxXVswXSA9IERJRkZfSU5TRVJULCBlcXVhbGl0aWVzTGVuZ3RoLS0sIGVxdWFsaXRpZXNMZW5ndGgtLSwgcG9pbnRlciA9IGVxdWFsaXRpZXNMZW5ndGggPiAwID8gZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0gOiAtMSwgbGVuZ3RoSW5zZXJ0aW9uczEgPSAwLCBsZW5ndGhEZWxldGlvbnMxID0gMCwgbGVuZ3RoSW5zZXJ0aW9uczIgPSAwLCBsZW5ndGhEZWxldGlvbnMyID0gMCwgbGFzdEVxdWFsaXR5ID0gbnVsbCwgaGFzQ2hhbmdlcyA9ICEwKSksIHBvaW50ZXIrKztcbiAgZm9yIChoYXNDaGFuZ2VzICYmIChkaWZmcyA9IGNsZWFudXBNZXJnZShkaWZmcykpLCBkaWZmcyA9IGNsZWFudXBTZW1hbnRpY0xvc3NsZXNzKGRpZmZzKSwgcG9pbnRlciA9IDE7IHBvaW50ZXIgPCBkaWZmcy5sZW5ndGg7ICkge1xuICAgIGlmIChkaWZmc1twb2ludGVyIC0gMV1bMF0gPT09IERJRkZfREVMRVRFICYmIGRpZmZzW3BvaW50ZXJdWzBdID09PSBESUZGX0lOU0VSVCkge1xuICAgICAgY29uc3QgZGVsZXRpb24gPSBkaWZmc1twb2ludGVyIC0gMV1bMV0sIGluc2VydGlvbiA9IGRpZmZzW3BvaW50ZXJdWzFdLCBvdmVybGFwTGVuZ3RoMSA9IGdldENvbW1vbk92ZXJsYXAoZGVsZXRpb24sIGluc2VydGlvbiksIG92ZXJsYXBMZW5ndGgyID0gZ2V0Q29tbW9uT3ZlcmxhcChpbnNlcnRpb24sIGRlbGV0aW9uKTtcbiAgICAgIG92ZXJsYXBMZW5ndGgxID49IG92ZXJsYXBMZW5ndGgyID8gKG92ZXJsYXBMZW5ndGgxID49IGRlbGV0aW9uLmxlbmd0aCAvIDIgfHwgb3ZlcmxhcExlbmd0aDEgPj0gaW5zZXJ0aW9uLmxlbmd0aCAvIDIpICYmIChkaWZmcy5zcGxpY2UocG9pbnRlciwgMCwgW0RJRkZfRVFVQUwsIGluc2VydGlvbi5zdWJzdHJpbmcoMCwgb3ZlcmxhcExlbmd0aDEpXSksIGRpZmZzW3BvaW50ZXIgLSAxXVsxXSA9IGRlbGV0aW9uLnN1YnN0cmluZygwLCBkZWxldGlvbi5sZW5ndGggLSBvdmVybGFwTGVuZ3RoMSksIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSA9IGluc2VydGlvbi5zdWJzdHJpbmcob3ZlcmxhcExlbmd0aDEpLCBwb2ludGVyKyspIDogKG92ZXJsYXBMZW5ndGgyID49IGRlbGV0aW9uLmxlbmd0aCAvIDIgfHwgb3ZlcmxhcExlbmd0aDIgPj0gaW5zZXJ0aW9uLmxlbmd0aCAvIDIpICYmIChkaWZmcy5zcGxpY2UocG9pbnRlciwgMCwgW0RJRkZfRVFVQUwsIGRlbGV0aW9uLnN1YnN0cmluZygwLCBvdmVybGFwTGVuZ3RoMildKSwgZGlmZnNbcG9pbnRlciAtIDFdWzBdID0gRElGRl9JTlNFUlQsIGRpZmZzW3BvaW50ZXIgLSAxXVsxXSA9IGluc2VydGlvbi5zdWJzdHJpbmcoMCwgaW5zZXJ0aW9uLmxlbmd0aCAtIG92ZXJsYXBMZW5ndGgyKSwgZGlmZnNbcG9pbnRlciArIDFdWzBdID0gRElGRl9ERUxFVEUsIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSA9IGRlbGV0aW9uLnN1YnN0cmluZyhvdmVybGFwTGVuZ3RoMiksIHBvaW50ZXIrKyksIHBvaW50ZXIrKztcbiAgICB9XG4gICAgcG9pbnRlcisrO1xuICB9XG4gIHJldHVybiBkaWZmcztcbn1cbmNvbnN0IG5vbkFscGhhTnVtZXJpY1JlZ2V4ID0gL1teYS16QS1aMC05XS8sIHdoaXRlc3BhY2VSZWdleCA9IC9cXHMvLCBsaW5lYnJlYWtSZWdleCA9IC9bXFxyXFxuXS8sIGJsYW5rbGluZUVuZFJlZ2V4ID0gL1xcblxccj9cXG4kLywgYmxhbmtsaW5lU3RhcnRSZWdleCA9IC9eXFxyP1xcblxccj9cXG4vO1xuZnVuY3Rpb24gY2xlYW51cFNlbWFudGljTG9zc2xlc3MocmF3RGlmZnMpIHtcbiAgY29uc3QgZGlmZnMgPSByYXdEaWZmcy5tYXAoKGRpZmYyKSA9PiBjbG9uZURpZmYoZGlmZjIpKTtcbiAgZnVuY3Rpb24gZGlmZkNsZWFudXBTZW1hbnRpY1Njb3JlKG9uZSwgdHdvKSB7XG4gICAgaWYgKCFvbmUgfHwgIXR3bykgcmV0dXJuIDY7XG4gICAgY29uc3QgY2hhcjEgPSBvbmUuY2hhckF0KG9uZS5sZW5ndGggLSAxKSwgY2hhcjIgPSB0d28uY2hhckF0KDApLCBub25BbHBoYU51bWVyaWMxID0gY2hhcjEubWF0Y2gobm9uQWxwaGFOdW1lcmljUmVnZXgpLCBub25BbHBoYU51bWVyaWMyID0gY2hhcjIubWF0Y2gobm9uQWxwaGFOdW1lcmljUmVnZXgpLCB3aGl0ZXNwYWNlMSA9IG5vbkFscGhhTnVtZXJpYzEgJiYgY2hhcjEubWF0Y2god2hpdGVzcGFjZVJlZ2V4KSwgd2hpdGVzcGFjZTIgPSBub25BbHBoYU51bWVyaWMyICYmIGNoYXIyLm1hdGNoKHdoaXRlc3BhY2VSZWdleCksIGxpbmVCcmVhazEgPSB3aGl0ZXNwYWNlMSAmJiBjaGFyMS5tYXRjaChsaW5lYnJlYWtSZWdleCksIGxpbmVCcmVhazIgPSB3aGl0ZXNwYWNlMiAmJiBjaGFyMi5tYXRjaChsaW5lYnJlYWtSZWdleCksIGJsYW5rTGluZTEgPSBsaW5lQnJlYWsxICYmIG9uZS5tYXRjaChibGFua2xpbmVFbmRSZWdleCksIGJsYW5rTGluZTIgPSBsaW5lQnJlYWsyICYmIHR3by5tYXRjaChibGFua2xpbmVTdGFydFJlZ2V4KTtcbiAgICByZXR1cm4gYmxhbmtMaW5lMSB8fCBibGFua0xpbmUyID8gNSA6IGxpbmVCcmVhazEgfHwgbGluZUJyZWFrMiA/IDQgOiBub25BbHBoYU51bWVyaWMxICYmICF3aGl0ZXNwYWNlMSAmJiB3aGl0ZXNwYWNlMiA/IDMgOiB3aGl0ZXNwYWNlMSB8fCB3aGl0ZXNwYWNlMiA/IDIgOiBub25BbHBoYU51bWVyaWMxIHx8IG5vbkFscGhhTnVtZXJpYzIgPyAxIDogMDtcbiAgfVxuICBsZXQgcG9pbnRlciA9IDE7XG4gIGZvciAoOyBwb2ludGVyIDwgZGlmZnMubGVuZ3RoIC0gMTsgKSB7XG4gICAgaWYgKGRpZmZzW3BvaW50ZXIgLSAxXVswXSA9PT0gRElGRl9FUVVBTCAmJiBkaWZmc1twb2ludGVyICsgMV1bMF0gPT09IERJRkZfRVFVQUwpIHtcbiAgICAgIGxldCBlcXVhbGl0eTEgPSBkaWZmc1twb2ludGVyIC0gMV1bMV0sIGVkaXQgPSBkaWZmc1twb2ludGVyXVsxXSwgZXF1YWxpdHkyID0gZGlmZnNbcG9pbnRlciArIDFdWzFdO1xuICAgICAgY29uc3QgY29tbW9uT2Zmc2V0ID0gZ2V0Q29tbW9uU3VmZml4KGVxdWFsaXR5MSwgZWRpdCk7XG4gICAgICBpZiAoY29tbW9uT2Zmc2V0KSB7XG4gICAgICAgIGNvbnN0IGNvbW1vblN0cmluZyA9IGVkaXQuc3Vic3RyaW5nKGVkaXQubGVuZ3RoIC0gY29tbW9uT2Zmc2V0KTtcbiAgICAgICAgZXF1YWxpdHkxID0gZXF1YWxpdHkxLnN1YnN0cmluZygwLCBlcXVhbGl0eTEubGVuZ3RoIC0gY29tbW9uT2Zmc2V0KSwgZWRpdCA9IGNvbW1vblN0cmluZyArIGVkaXQuc3Vic3RyaW5nKDAsIGVkaXQubGVuZ3RoIC0gY29tbW9uT2Zmc2V0KSwgZXF1YWxpdHkyID0gY29tbW9uU3RyaW5nICsgZXF1YWxpdHkyO1xuICAgICAgfVxuICAgICAgbGV0IGJlc3RFcXVhbGl0eTEgPSBlcXVhbGl0eTEsIGJlc3RFZGl0ID0gZWRpdCwgYmVzdEVxdWFsaXR5MiA9IGVxdWFsaXR5MiwgYmVzdFNjb3JlID0gZGlmZkNsZWFudXBTZW1hbnRpY1Njb3JlKGVxdWFsaXR5MSwgZWRpdCkgKyBkaWZmQ2xlYW51cFNlbWFudGljU2NvcmUoZWRpdCwgZXF1YWxpdHkyKTtcbiAgICAgIGZvciAoOyBlZGl0LmNoYXJBdCgwKSA9PT0gZXF1YWxpdHkyLmNoYXJBdCgwKTsgKSB7XG4gICAgICAgIGVxdWFsaXR5MSArPSBlZGl0LmNoYXJBdCgwKSwgZWRpdCA9IGVkaXQuc3Vic3RyaW5nKDEpICsgZXF1YWxpdHkyLmNoYXJBdCgwKSwgZXF1YWxpdHkyID0gZXF1YWxpdHkyLnN1YnN0cmluZygxKTtcbiAgICAgICAgY29uc3Qgc2NvcmUgPSBkaWZmQ2xlYW51cFNlbWFudGljU2NvcmUoZXF1YWxpdHkxLCBlZGl0KSArIGRpZmZDbGVhbnVwU2VtYW50aWNTY29yZShlZGl0LCBlcXVhbGl0eTIpO1xuICAgICAgICBzY29yZSA+PSBiZXN0U2NvcmUgJiYgKGJlc3RTY29yZSA9IHNjb3JlLCBiZXN0RXF1YWxpdHkxID0gZXF1YWxpdHkxLCBiZXN0RWRpdCA9IGVkaXQsIGJlc3RFcXVhbGl0eTIgPSBlcXVhbGl0eTIpO1xuICAgICAgfVxuICAgICAgZGlmZnNbcG9pbnRlciAtIDFdWzFdICE9PSBiZXN0RXF1YWxpdHkxICYmIChiZXN0RXF1YWxpdHkxID8gZGlmZnNbcG9pbnRlciAtIDFdWzFdID0gYmVzdEVxdWFsaXR5MSA6IChkaWZmcy5zcGxpY2UocG9pbnRlciAtIDEsIDEpLCBwb2ludGVyLS0pLCBkaWZmc1twb2ludGVyXVsxXSA9IGJlc3RFZGl0LCBiZXN0RXF1YWxpdHkyID8gZGlmZnNbcG9pbnRlciArIDFdWzFdID0gYmVzdEVxdWFsaXR5MiA6IChkaWZmcy5zcGxpY2UocG9pbnRlciArIDEsIDEpLCBwb2ludGVyLS0pKTtcbiAgICB9XG4gICAgcG9pbnRlcisrO1xuICB9XG4gIHJldHVybiBkaWZmcztcbn1cbmZ1bmN0aW9uIGNsZWFudXBNZXJnZShyYXdEaWZmcykge1xuICBsZXQgZGlmZnMgPSByYXdEaWZmcy5tYXAoKGRpZmYyKSA9PiBjbG9uZURpZmYoZGlmZjIpKTtcbiAgZGlmZnMucHVzaChbRElGRl9FUVVBTCwgXCJcIl0pO1xuICBsZXQgcG9pbnRlciA9IDAsIGNvdW50RGVsZXRlID0gMCwgY291bnRJbnNlcnQgPSAwLCB0ZXh0RGVsZXRlID0gXCJcIiwgdGV4dEluc2VydCA9IFwiXCIsIGNvbW1vbmxlbmd0aDtcbiAgZm9yICg7IHBvaW50ZXIgPCBkaWZmcy5sZW5ndGg7ICkgc3dpdGNoIChkaWZmc1twb2ludGVyXVswXSkge1xuICAgIGNhc2UgRElGRl9JTlNFUlQ6XG4gICAgICBjb3VudEluc2VydCsrLCB0ZXh0SW5zZXJ0ICs9IGRpZmZzW3BvaW50ZXJdWzFdLCBwb2ludGVyKys7XG4gICAgICBicmVhaztcbiAgICBjYXNlIERJRkZfREVMRVRFOlxuICAgICAgY291bnREZWxldGUrKywgdGV4dERlbGV0ZSArPSBkaWZmc1twb2ludGVyXVsxXSwgcG9pbnRlcisrO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBESUZGX0VRVUFMOlxuICAgICAgY291bnREZWxldGUgKyBjb3VudEluc2VydCA+IDEgPyAoY291bnREZWxldGUgIT09IDAgJiYgY291bnRJbnNlcnQgIT09IDAgJiYgKGNvbW1vbmxlbmd0aCA9IGdldENvbW1vblByZWZpeCh0ZXh0SW5zZXJ0LCB0ZXh0RGVsZXRlKSwgY29tbW9ubGVuZ3RoICE9PSAwICYmIChwb2ludGVyIC0gY291bnREZWxldGUgLSBjb3VudEluc2VydCA+IDAgJiYgZGlmZnNbcG9pbnRlciAtIGNvdW50RGVsZXRlIC0gY291bnRJbnNlcnQgLSAxXVswXSA9PT0gRElGRl9FUVVBTCA/IGRpZmZzW3BvaW50ZXIgLSBjb3VudERlbGV0ZSAtIGNvdW50SW5zZXJ0IC0gMV1bMV0gKz0gdGV4dEluc2VydC5zdWJzdHJpbmcoMCwgY29tbW9ubGVuZ3RoKSA6IChkaWZmcy5zcGxpY2UoMCwgMCwgW0RJRkZfRVFVQUwsIHRleHRJbnNlcnQuc3Vic3RyaW5nKDAsIGNvbW1vbmxlbmd0aCldKSwgcG9pbnRlcisrKSwgdGV4dEluc2VydCA9IHRleHRJbnNlcnQuc3Vic3RyaW5nKGNvbW1vbmxlbmd0aCksIHRleHREZWxldGUgPSB0ZXh0RGVsZXRlLnN1YnN0cmluZyhjb21tb25sZW5ndGgpKSwgY29tbW9ubGVuZ3RoID0gZ2V0Q29tbW9uU3VmZml4KHRleHRJbnNlcnQsIHRleHREZWxldGUpLCBjb21tb25sZW5ndGggIT09IDAgJiYgKGRpZmZzW3BvaW50ZXJdWzFdID0gdGV4dEluc2VydC5zdWJzdHJpbmcodGV4dEluc2VydC5sZW5ndGggLSBjb21tb25sZW5ndGgpICsgZGlmZnNbcG9pbnRlcl1bMV0sIHRleHRJbnNlcnQgPSB0ZXh0SW5zZXJ0LnN1YnN0cmluZygwLCB0ZXh0SW5zZXJ0Lmxlbmd0aCAtIGNvbW1vbmxlbmd0aCksIHRleHREZWxldGUgPSB0ZXh0RGVsZXRlLnN1YnN0cmluZygwLCB0ZXh0RGVsZXRlLmxlbmd0aCAtIGNvbW1vbmxlbmd0aCkpKSwgcG9pbnRlciAtPSBjb3VudERlbGV0ZSArIGNvdW50SW5zZXJ0LCBkaWZmcy5zcGxpY2UocG9pbnRlciwgY291bnREZWxldGUgKyBjb3VudEluc2VydCksIHRleHREZWxldGUubGVuZ3RoICYmIChkaWZmcy5zcGxpY2UocG9pbnRlciwgMCwgW0RJRkZfREVMRVRFLCB0ZXh0RGVsZXRlXSksIHBvaW50ZXIrKyksIHRleHRJbnNlcnQubGVuZ3RoICYmIChkaWZmcy5zcGxpY2UocG9pbnRlciwgMCwgW0RJRkZfSU5TRVJULCB0ZXh0SW5zZXJ0XSksIHBvaW50ZXIrKyksIHBvaW50ZXIrKykgOiBwb2ludGVyICE9PSAwICYmIGRpZmZzW3BvaW50ZXIgLSAxXVswXSA9PT0gRElGRl9FUVVBTCA/IChkaWZmc1twb2ludGVyIC0gMV1bMV0gKz0gZGlmZnNbcG9pbnRlcl1bMV0sIGRpZmZzLnNwbGljZShwb2ludGVyLCAxKSkgOiBwb2ludGVyKyssIGNvdW50SW5zZXJ0ID0gMCwgY291bnREZWxldGUgPSAwLCB0ZXh0RGVsZXRlID0gXCJcIiwgdGV4dEluc2VydCA9IFwiXCI7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBkaWZmIG9wZXJhdGlvblwiKTtcbiAgfVxuICBkaWZmc1tkaWZmcy5sZW5ndGggLSAxXVsxXSA9PT0gXCJcIiAmJiBkaWZmcy5wb3AoKTtcbiAgbGV0IGhhc0NoYW5nZXMgPSAhMTtcbiAgZm9yIChwb2ludGVyID0gMTsgcG9pbnRlciA8IGRpZmZzLmxlbmd0aCAtIDE7ICkgZGlmZnNbcG9pbnRlciAtIDFdWzBdID09PSBESUZGX0VRVUFMICYmIGRpZmZzW3BvaW50ZXIgKyAxXVswXSA9PT0gRElGRl9FUVVBTCAmJiAoZGlmZnNbcG9pbnRlcl1bMV0uc3Vic3RyaW5nKGRpZmZzW3BvaW50ZXJdWzFdLmxlbmd0aCAtIGRpZmZzW3BvaW50ZXIgLSAxXVsxXS5sZW5ndGgpID09PSBkaWZmc1twb2ludGVyIC0gMV1bMV0gPyAoZGlmZnNbcG9pbnRlcl1bMV0gPSBkaWZmc1twb2ludGVyIC0gMV1bMV0gKyBkaWZmc1twb2ludGVyXVsxXS5zdWJzdHJpbmcoMCwgZGlmZnNbcG9pbnRlcl1bMV0ubGVuZ3RoIC0gZGlmZnNbcG9pbnRlciAtIDFdWzFdLmxlbmd0aCksIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSA9IGRpZmZzW3BvaW50ZXIgLSAxXVsxXSArIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSwgZGlmZnMuc3BsaWNlKHBvaW50ZXIgLSAxLCAxKSwgaGFzQ2hhbmdlcyA9ICEwKSA6IGRpZmZzW3BvaW50ZXJdWzFdLnN1YnN0cmluZygwLCBkaWZmc1twb2ludGVyICsgMV1bMV0ubGVuZ3RoKSA9PT0gZGlmZnNbcG9pbnRlciArIDFdWzFdICYmIChkaWZmc1twb2ludGVyIC0gMV1bMV0gKz0gZGlmZnNbcG9pbnRlciArIDFdWzFdLCBkaWZmc1twb2ludGVyXVsxXSA9IGRpZmZzW3BvaW50ZXJdWzFdLnN1YnN0cmluZyhkaWZmc1twb2ludGVyICsgMV1bMV0ubGVuZ3RoKSArIGRpZmZzW3BvaW50ZXIgKyAxXVsxXSwgZGlmZnMuc3BsaWNlKHBvaW50ZXIgKyAxLCAxKSwgaGFzQ2hhbmdlcyA9ICEwKSksIHBvaW50ZXIrKztcbiAgcmV0dXJuIGhhc0NoYW5nZXMgJiYgKGRpZmZzID0gY2xlYW51cE1lcmdlKGRpZmZzKSksIGRpZmZzO1xufVxuZnVuY3Rpb24gdHJ1ZUNvdW50KC4uLmFyZ3MpIHtcbiAgcmV0dXJuIGFyZ3MucmVkdWNlKChuLCBib29sKSA9PiBuICsgKGJvb2wgPyAxIDogMCksIDApO1xufVxuZnVuY3Rpb24gY2xlYW51cEVmZmljaWVuY3kocmF3RGlmZnMsIGVkaXRDb3N0ID0gNCkge1xuICBsZXQgZGlmZnMgPSByYXdEaWZmcy5tYXAoKGRpZmYyKSA9PiBjbG9uZURpZmYoZGlmZjIpKSwgaGFzQ2hhbmdlcyA9ICExO1xuICBjb25zdCBlcXVhbGl0aWVzID0gW107XG4gIGxldCBlcXVhbGl0aWVzTGVuZ3RoID0gMCwgbGFzdEVxdWFsaXR5ID0gbnVsbCwgcG9pbnRlciA9IDAsIHByZUlucyA9ICExLCBwcmVEZWwgPSAhMSwgcG9zdElucyA9ICExLCBwb3N0RGVsID0gITE7XG4gIGZvciAoOyBwb2ludGVyIDwgZGlmZnMubGVuZ3RoOyApIGRpZmZzW3BvaW50ZXJdWzBdID09PSBESUZGX0VRVUFMID8gKGRpZmZzW3BvaW50ZXJdWzFdLmxlbmd0aCA8IGVkaXRDb3N0ICYmIChwb3N0SW5zIHx8IHBvc3REZWwpID8gKGVxdWFsaXRpZXNbZXF1YWxpdGllc0xlbmd0aCsrXSA9IHBvaW50ZXIsIHByZUlucyA9IHBvc3RJbnMsIHByZURlbCA9IHBvc3REZWwsIGxhc3RFcXVhbGl0eSA9IGRpZmZzW3BvaW50ZXJdWzFdKSA6IChlcXVhbGl0aWVzTGVuZ3RoID0gMCwgbGFzdEVxdWFsaXR5ID0gbnVsbCksIHBvc3RJbnMgPSAhMSwgcG9zdERlbCA9ICExKSA6IChkaWZmc1twb2ludGVyXVswXSA9PT0gRElGRl9ERUxFVEUgPyBwb3N0RGVsID0gITAgOiBwb3N0SW5zID0gITAsIGxhc3RFcXVhbGl0eSAmJiAocHJlSW5zICYmIHByZURlbCAmJiBwb3N0SW5zICYmIHBvc3REZWwgfHwgbGFzdEVxdWFsaXR5Lmxlbmd0aCA8IGVkaXRDb3N0IC8gMiAmJiB0cnVlQ291bnQocHJlSW5zLCBwcmVEZWwsIHBvc3RJbnMsIHBvc3REZWwpID09PSAzKSAmJiAoZGlmZnMuc3BsaWNlKGVxdWFsaXRpZXNbZXF1YWxpdGllc0xlbmd0aCAtIDFdLCAwLCBbRElGRl9ERUxFVEUsIGxhc3RFcXVhbGl0eV0pLCBkaWZmc1tlcXVhbGl0aWVzW2VxdWFsaXRpZXNMZW5ndGggLSAxXSArIDFdWzBdID0gRElGRl9JTlNFUlQsIGVxdWFsaXRpZXNMZW5ndGgtLSwgbGFzdEVxdWFsaXR5ID0gbnVsbCwgcHJlSW5zICYmIHByZURlbCA/IChwb3N0SW5zID0gITAsIHBvc3REZWwgPSAhMCwgZXF1YWxpdGllc0xlbmd0aCA9IDApIDogKGVxdWFsaXRpZXNMZW5ndGgtLSwgcG9pbnRlciA9IGVxdWFsaXRpZXNMZW5ndGggPiAwID8gZXF1YWxpdGllc1tlcXVhbGl0aWVzTGVuZ3RoIC0gMV0gOiAtMSwgcG9zdElucyA9ICExLCBwb3N0RGVsID0gITEpLCBoYXNDaGFuZ2VzID0gITApKSwgcG9pbnRlcisrO1xuICByZXR1cm4gaGFzQ2hhbmdlcyAmJiAoZGlmZnMgPSBjbGVhbnVwTWVyZ2UoZGlmZnMpKSwgZGlmZnM7XG59XG52YXIgX19kZWZQcm9wJDEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHksIF9fZ2V0T3duUHJvcFN5bWJvbHMkMSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMsIF9faGFzT3duUHJvcCQxID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgX19wcm9wSXNFbnVtJDEgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLCBfX2RlZk5vcm1hbFByb3AkMSA9IChvYmosIGtleSwgdmFsdWUpID0+IGtleSBpbiBvYmogPyBfX2RlZlByb3AkMShvYmosIGtleSwge1xuICBlbnVtZXJhYmxlOiAhMCxcbiAgY29uZmlndXJhYmxlOiAhMCxcbiAgd3JpdGFibGU6ICEwLFxuICB2YWx1ZVxufSkgOiBvYmpba2V5XSA9IHZhbHVlLCBfX3NwcmVhZFZhbHVlcyQxID0gKGEsIGIpID0+IHtcbiAgZm9yICh2YXIgcHJvcCBpbiBiIHx8IChiID0ge30pKSBfX2hhc093blByb3AkMS5jYWxsKGIsIHByb3ApICYmIF9fZGVmTm9ybWFsUHJvcCQxKGEsIHByb3AsIGJbcHJvcF0pO1xuICBpZiAoX19nZXRPd25Qcm9wU3ltYm9scyQxKSBmb3IgKHZhciBwcm9wIG9mIF9fZ2V0T3duUHJvcFN5bWJvbHMkMShiKSkgX19wcm9wSXNFbnVtJDEuY2FsbChiLCBwcm9wKSAmJiBfX2RlZk5vcm1hbFByb3AkMShhLCBwcm9wLCBiW3Byb3BdKTtcbiAgcmV0dXJuIGE7XG59O1xuY29uc3QgREVGQVVMVF9PUFRJT05TID0ge1xuICAvKipcbiAgICogQXQgd2hhdCBwb2ludCBpcyBubyBtYXRjaCBkZWNsYXJlZCAoMC4wID0gcGVyZmVjdGlvbiwgMS4wID0gdmVyeSBsb29zZSkuXG4gICAqL1xuICB0aHJlc2hvbGQ6IDAuNSxcbiAgLyoqXG4gICAqIEhvdyBmYXIgdG8gc2VhcmNoIGZvciBhIG1hdGNoICgwID0gZXhhY3QgbG9jYXRpb24sIDEwMDArID0gYnJvYWQgbWF0Y2gpLlxuICAgKiBBIG1hdGNoIHRoaXMgbWFueSBjaGFyYWN0ZXJzIGF3YXkgZnJvbSB0aGUgZXhwZWN0ZWQgbG9jYXRpb24gd2lsbCBhZGRcbiAgICogMS4wIHRvIHRoZSBzY29yZSAoMC4wIGlzIGEgcGVyZmVjdCBtYXRjaCkuXG4gICAqL1xuICBkaXN0YW5jZTogMWUzXG59O1xuZnVuY3Rpb24gYXBwbHlEZWZhdWx0cyhvcHRpb25zKSB7XG4gIHJldHVybiBfX3NwcmVhZFZhbHVlcyQxKF9fc3ByZWFkVmFsdWVzJDEoe30sIERFRkFVTFRfT1BUSU9OUyksIG9wdGlvbnMpO1xufVxuY29uc3QgTUFYX0JJVFMkMSA9IDMyO1xuZnVuY3Rpb24gYml0YXAodGV4dCwgcGF0dGVybiwgbG9jLCBvcHRzID0ge30pIHtcbiAgaWYgKHBhdHRlcm4ubGVuZ3RoID4gTUFYX0JJVFMkMSkgdGhyb3cgbmV3IEVycm9yKFwiUGF0dGVybiB0b28gbG9uZyBmb3IgdGhpcyBicm93c2VyLlwiKTtcbiAgY29uc3Qgb3B0aW9ucyA9IGFwcGx5RGVmYXVsdHMob3B0cyksIHMgPSBnZXRBbHBoYWJldEZyb21QYXR0ZXJuKHBhdHRlcm4pO1xuICBmdW5jdGlvbiBnZXRCaXRhcFNjb3JlKGUsIHgpIHtcbiAgICBjb25zdCBhY2N1cmFjeSA9IGUgLyBwYXR0ZXJuLmxlbmd0aCwgcHJveGltaXR5ID0gTWF0aC5hYnMobG9jIC0geCk7XG4gICAgcmV0dXJuIG9wdGlvbnMuZGlzdGFuY2UgPyBhY2N1cmFjeSArIHByb3hpbWl0eSAvIG9wdGlvbnMuZGlzdGFuY2UgOiBwcm94aW1pdHkgPyAxIDogYWNjdXJhY3k7XG4gIH1cbiAgbGV0IHNjb3JlVGhyZXNob2xkID0gb3B0aW9ucy50aHJlc2hvbGQsIGJlc3RMb2MgPSB0ZXh0LmluZGV4T2YocGF0dGVybiwgbG9jKTtcbiAgYmVzdExvYyAhPT0gLTEgJiYgKHNjb3JlVGhyZXNob2xkID0gTWF0aC5taW4oZ2V0Qml0YXBTY29yZSgwLCBiZXN0TG9jKSwgc2NvcmVUaHJlc2hvbGQpLCBiZXN0TG9jID0gdGV4dC5sYXN0SW5kZXhPZihwYXR0ZXJuLCBsb2MgKyBwYXR0ZXJuLmxlbmd0aCksIGJlc3RMb2MgIT09IC0xICYmIChzY29yZVRocmVzaG9sZCA9IE1hdGgubWluKGdldEJpdGFwU2NvcmUoMCwgYmVzdExvYyksIHNjb3JlVGhyZXNob2xkKSkpO1xuICBjb25zdCBtYXRjaG1hc2sgPSAxIDw8IHBhdHRlcm4ubGVuZ3RoIC0gMTtcbiAgYmVzdExvYyA9IC0xO1xuICBsZXQgYmluTWluLCBiaW5NaWQsIGJpbk1heCA9IHBhdHRlcm4ubGVuZ3RoICsgdGV4dC5sZW5ndGgsIGxhc3RSZCA9IFtdO1xuICBmb3IgKGxldCBkID0gMDsgZCA8IHBhdHRlcm4ubGVuZ3RoOyBkKyspIHtcbiAgICBmb3IgKGJpbk1pbiA9IDAsIGJpbk1pZCA9IGJpbk1heDsgYmluTWluIDwgYmluTWlkOyApIGdldEJpdGFwU2NvcmUoZCwgbG9jICsgYmluTWlkKSA8PSBzY29yZVRocmVzaG9sZCA/IGJpbk1pbiA9IGJpbk1pZCA6IGJpbk1heCA9IGJpbk1pZCwgYmluTWlkID0gTWF0aC5mbG9vcigoYmluTWF4IC0gYmluTWluKSAvIDIgKyBiaW5NaW4pO1xuICAgIGJpbk1heCA9IGJpbk1pZDtcbiAgICBsZXQgc3RhcnQgPSBNYXRoLm1heCgxLCBsb2MgLSBiaW5NaWQgKyAxKTtcbiAgICBjb25zdCBmaW5pc2ggPSBNYXRoLm1pbihsb2MgKyBiaW5NaWQsIHRleHQubGVuZ3RoKSArIHBhdHRlcm4ubGVuZ3RoLCByZCA9IG5ldyBBcnJheShmaW5pc2ggKyAyKTtcbiAgICByZFtmaW5pc2ggKyAxXSA9ICgxIDw8IGQpIC0gMTtcbiAgICBmb3IgKGxldCBqID0gZmluaXNoOyBqID49IHN0YXJ0OyBqLS0pIHtcbiAgICAgIGNvbnN0IGNoYXJNYXRjaCA9IHNbdGV4dC5jaGFyQXQoaiAtIDEpXTtcbiAgICAgIGlmIChkID09PSAwID8gcmRbal0gPSAocmRbaiArIDFdIDw8IDEgfCAxKSAmIGNoYXJNYXRjaCA6IHJkW2pdID0gKHJkW2ogKyAxXSA8PCAxIHwgMSkgJiBjaGFyTWF0Y2ggfCAoKGxhc3RSZFtqICsgMV0gfCBsYXN0UmRbal0pIDw8IDEgfCAxKSB8IGxhc3RSZFtqICsgMV0sIHJkW2pdICYgbWF0Y2htYXNrKSB7XG4gICAgICAgIGNvbnN0IHNjb3JlID0gZ2V0Qml0YXBTY29yZShkLCBqIC0gMSk7XG4gICAgICAgIGlmIChzY29yZSA8PSBzY29yZVRocmVzaG9sZCkgaWYgKHNjb3JlVGhyZXNob2xkID0gc2NvcmUsIGJlc3RMb2MgPSBqIC0gMSwgYmVzdExvYyA+IGxvYykgc3RhcnQgPSBNYXRoLm1heCgxLCAyICogbG9jIC0gYmVzdExvYyk7XG4gICAgICAgIGVsc2UgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChnZXRCaXRhcFNjb3JlKGQgKyAxLCBsb2MpID4gc2NvcmVUaHJlc2hvbGQpIGJyZWFrO1xuICAgIGxhc3RSZCA9IHJkO1xuICB9XG4gIHJldHVybiBiZXN0TG9jO1xufVxuZnVuY3Rpb24gZ2V0QWxwaGFiZXRGcm9tUGF0dGVybihwYXR0ZXJuKSB7XG4gIGNvbnN0IHMgPSB7fTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXR0ZXJuLmxlbmd0aDsgaSsrKSBzW3BhdHRlcm4uY2hhckF0KGkpXSA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0dGVybi5sZW5ndGg7IGkrKykgc1twYXR0ZXJuLmNoYXJBdChpKV0gfD0gMSA8PCBwYXR0ZXJuLmxlbmd0aCAtIGkgLSAxO1xuICByZXR1cm4gcztcbn1cbmZ1bmN0aW9uIG1hdGNoKHRleHQsIHBhdHRlcm4sIHNlYXJjaExvY2F0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKHRleHQgPT09IG51bGwgfHwgcGF0dGVybiA9PT0gbnVsbCB8fCBzZWFyY2hMb2NhdGlvbiA9PT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKFwiTnVsbCBpbnB1dC4gKG1hdGNoKCkpXCIpO1xuICBjb25zdCBsb2MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihzZWFyY2hMb2NhdGlvbiwgdGV4dC5sZW5ndGgpKTtcbiAgaWYgKHRleHQgPT09IHBhdHRlcm4pIHJldHVybiAwO1xuICBpZiAodGV4dC5sZW5ndGgpIHtcbiAgICBpZiAodGV4dC5zdWJzdHJpbmcobG9jLCBsb2MgKyBwYXR0ZXJuLmxlbmd0aCkgPT09IHBhdHRlcm4pIHJldHVybiBsb2M7XG4gIH0gZWxzZSByZXR1cm4gLTE7XG4gIHJldHVybiBiaXRhcCh0ZXh0LCBwYXR0ZXJuLCBsb2MsIG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gZGlmZlRleHQxKGRpZmZzKSB7XG4gIGNvbnN0IHRleHQgPSBbXTtcbiAgZm9yIChsZXQgeCA9IDA7IHggPCBkaWZmcy5sZW5ndGg7IHgrKykgZGlmZnNbeF1bMF0gIT09IERJRkZfSU5TRVJUICYmICh0ZXh0W3hdID0gZGlmZnNbeF1bMV0pO1xuICByZXR1cm4gdGV4dC5qb2luKFwiXCIpO1xufVxuZnVuY3Rpb24gZGlmZlRleHQyKGRpZmZzKSB7XG4gIGNvbnN0IHRleHQgPSBbXTtcbiAgZm9yIChsZXQgeCA9IDA7IHggPCBkaWZmcy5sZW5ndGg7IHgrKykgZGlmZnNbeF1bMF0gIT09IERJRkZfREVMRVRFICYmICh0ZXh0W3hdID0gZGlmZnNbeF1bMV0pO1xuICByZXR1cm4gdGV4dC5qb2luKFwiXCIpO1xufVxuZnVuY3Rpb24gbGV2ZW5zaHRlaW4oZGlmZnMpIHtcbiAgbGV0IGxldmVuID0gMCwgaW5zZXJ0aW9ucyA9IDAsIGRlbGV0aW9ucyA9IDA7XG4gIGZvciAobGV0IHggPSAwOyB4IDwgZGlmZnMubGVuZ3RoOyB4KyspIHtcbiAgICBjb25zdCBvcCA9IGRpZmZzW3hdWzBdLCBkYXRhID0gZGlmZnNbeF1bMV07XG4gICAgc3dpdGNoIChvcCkge1xuICAgICAgY2FzZSBESUZGX0lOU0VSVDpcbiAgICAgICAgaW5zZXJ0aW9ucyArPSBkYXRhLmxlbmd0aDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJRkZfREVMRVRFOlxuICAgICAgICBkZWxldGlvbnMgKz0gZGF0YS5sZW5ndGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICBsZXZlbiArPSBNYXRoLm1heChpbnNlcnRpb25zLCBkZWxldGlvbnMpLCBpbnNlcnRpb25zID0gMCwgZGVsZXRpb25zID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGRpZmYgb3BlcmF0aW9uLlwiKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxldmVuICs9IE1hdGgubWF4KGluc2VydGlvbnMsIGRlbGV0aW9ucyksIGxldmVuO1xufVxuZnVuY3Rpb24geEluZGV4KGRpZmZzLCBsb2NhdGlvbikge1xuICBsZXQgY2hhcnMxID0gMCwgY2hhcnMyID0gMCwgbGFzdENoYXJzMSA9IDAsIGxhc3RDaGFyczIgPSAwLCB4O1xuICBmb3IgKHggPSAwOyB4IDwgZGlmZnMubGVuZ3RoICYmIChkaWZmc1t4XVswXSAhPT0gRElGRl9JTlNFUlQgJiYgKGNoYXJzMSArPSBkaWZmc1t4XVsxXS5sZW5ndGgpLCBkaWZmc1t4XVswXSAhPT0gRElGRl9ERUxFVEUgJiYgKGNoYXJzMiArPSBkaWZmc1t4XVsxXS5sZW5ndGgpLCAhKGNoYXJzMSA+IGxvY2F0aW9uKSk7IHgrKykgbGFzdENoYXJzMSA9IGNoYXJzMSwgbGFzdENoYXJzMiA9IGNoYXJzMjtcbiAgcmV0dXJuIGRpZmZzLmxlbmd0aCAhPT0geCAmJiBkaWZmc1t4XVswXSA9PT0gRElGRl9ERUxFVEUgPyBsYXN0Q2hhcnMyIDogbGFzdENoYXJzMiArIChsb2NhdGlvbiAtIGxhc3RDaGFyczEpO1xufVxuZnVuY3Rpb24gY291bnRVdGY4Qnl0ZXMoc3RyKSB7XG4gIGxldCBieXRlcyA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY29kZVBvaW50ID0gc3RyLmNvZGVQb2ludEF0KGkpO1xuICAgIGlmICh0eXBlb2YgY29kZVBvaW50ID4gXCJ1XCIpIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBnZXQgY29kZXBvaW50XCIpO1xuICAgIGJ5dGVzICs9IHV0ZjhsZW4oY29kZVBvaW50KTtcbiAgfVxuICByZXR1cm4gYnl0ZXM7XG59XG5mdW5jdGlvbiBhZGp1c3RJbmRpY2llc1RvVWNzMihwYXRjaGVzLCBiYXNlLCBvcHRpb25zID0ge30pIHtcbiAgbGV0IGJ5dGVPZmZzZXQgPSAwLCBpZHggPSAwO1xuICBmdW5jdGlvbiBhZHZhbmNlVG8odGFyZ2V0KSB7XG4gICAgZm9yICg7IGJ5dGVPZmZzZXQgPCB0YXJnZXQ7ICkge1xuICAgICAgY29uc3QgY29kZVBvaW50ID0gYmFzZS5jb2RlUG9pbnRBdChpZHgpO1xuICAgICAgaWYgKHR5cGVvZiBjb2RlUG9pbnQgPiBcInVcIikgcmV0dXJuIGlkeDtcbiAgICAgIGJ5dGVPZmZzZXQgKz0gdXRmOGxlbihjb2RlUG9pbnQpLCBjb2RlUG9pbnQgPiA2NTUzNSA/IGlkeCArPSAyIDogaWR4ICs9IDE7XG4gICAgfVxuICAgIGlmICghb3B0aW9ucy5hbGxvd0V4Y2VlZGluZ0luZGljZXMgJiYgYnl0ZU9mZnNldCAhPT0gdGFyZ2V0KSB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZGV0ZXJtaW5lIGJ5dGUgb2Zmc2V0XCIpO1xuICAgIHJldHVybiBpZHg7XG4gIH1cbiAgY29uc3QgYWRqdXN0ZWQgPSBbXTtcbiAgZm9yIChjb25zdCBwYXRjaCBvZiBwYXRjaGVzKSBhZGp1c3RlZC5wdXNoKHtcbiAgICBkaWZmczogcGF0Y2guZGlmZnMubWFwKChkaWZmMikgPT4gY2xvbmVEaWZmKGRpZmYyKSksXG4gICAgc3RhcnQxOiBhZHZhbmNlVG8ocGF0Y2guc3RhcnQxKSxcbiAgICBzdGFydDI6IGFkdmFuY2VUbyhwYXRjaC5zdGFydDIpLFxuICAgIHV0ZjhTdGFydDE6IHBhdGNoLnV0ZjhTdGFydDEsXG4gICAgdXRmOFN0YXJ0MjogcGF0Y2gudXRmOFN0YXJ0MixcbiAgICBsZW5ndGgxOiBwYXRjaC5sZW5ndGgxLFxuICAgIGxlbmd0aDI6IHBhdGNoLmxlbmd0aDIsXG4gICAgdXRmOExlbmd0aDE6IHBhdGNoLnV0ZjhMZW5ndGgxLFxuICAgIHV0ZjhMZW5ndGgyOiBwYXRjaC51dGY4TGVuZ3RoMlxuICB9KTtcbiAgcmV0dXJuIGFkanVzdGVkO1xufVxuZnVuY3Rpb24gdXRmOGxlbihjb2RlUG9pbnQpIHtcbiAgcmV0dXJuIGNvZGVQb2ludCA8PSAxMjcgPyAxIDogY29kZVBvaW50IDw9IDIwNDcgPyAyIDogY29kZVBvaW50IDw9IDY1NTM1ID8gMyA6IDQ7XG59XG5jb25zdCBNQVhfQklUUyA9IDMyLCBERUZBVUxUX01BUkdJTiA9IDQ7XG5mdW5jdGlvbiBhZGRQYWRkaW5nKHBhdGNoZXMsIG1hcmdpbiA9IERFRkFVTFRfTUFSR0lOKSB7XG4gIGNvbnN0IHBhZGRpbmdMZW5ndGggPSBtYXJnaW47XG4gIGxldCBudWxsUGFkZGluZyA9IFwiXCI7XG4gIGZvciAobGV0IHggPSAxOyB4IDw9IHBhZGRpbmdMZW5ndGg7IHgrKykgbnVsbFBhZGRpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh4KTtcbiAgZm9yIChjb25zdCBwIG9mIHBhdGNoZXMpIHAuc3RhcnQxICs9IHBhZGRpbmdMZW5ndGgsIHAuc3RhcnQyICs9IHBhZGRpbmdMZW5ndGgsIHAudXRmOFN0YXJ0MSArPSBwYWRkaW5nTGVuZ3RoLCBwLnV0ZjhTdGFydDIgKz0gcGFkZGluZ0xlbmd0aDtcbiAgbGV0IHBhdGNoID0gcGF0Y2hlc1swXSwgZGlmZnMgPSBwYXRjaC5kaWZmcztcbiAgaWYgKGRpZmZzLmxlbmd0aCA9PT0gMCB8fCBkaWZmc1swXVswXSAhPT0gRElGRl9FUVVBTCkgZGlmZnMudW5zaGlmdChbRElGRl9FUVVBTCwgbnVsbFBhZGRpbmddKSwgcGF0Y2guc3RhcnQxIC09IHBhZGRpbmdMZW5ndGgsIHBhdGNoLnN0YXJ0MiAtPSBwYWRkaW5nTGVuZ3RoLCBwYXRjaC51dGY4U3RhcnQxIC09IHBhZGRpbmdMZW5ndGgsIHBhdGNoLnV0ZjhTdGFydDIgLT0gcGFkZGluZ0xlbmd0aCwgcGF0Y2gubGVuZ3RoMSArPSBwYWRkaW5nTGVuZ3RoLCBwYXRjaC5sZW5ndGgyICs9IHBhZGRpbmdMZW5ndGgsIHBhdGNoLnV0ZjhMZW5ndGgxICs9IHBhZGRpbmdMZW5ndGgsIHBhdGNoLnV0ZjhMZW5ndGgyICs9IHBhZGRpbmdMZW5ndGg7XG4gIGVsc2UgaWYgKHBhZGRpbmdMZW5ndGggPiBkaWZmc1swXVsxXS5sZW5ndGgpIHtcbiAgICBjb25zdCBmaXJzdERpZmZMZW5ndGggPSBkaWZmc1swXVsxXS5sZW5ndGgsIGV4dHJhTGVuZ3RoID0gcGFkZGluZ0xlbmd0aCAtIGZpcnN0RGlmZkxlbmd0aDtcbiAgICBkaWZmc1swXVsxXSA9IG51bGxQYWRkaW5nLnN1YnN0cmluZyhmaXJzdERpZmZMZW5ndGgpICsgZGlmZnNbMF1bMV0sIHBhdGNoLnN0YXJ0MSAtPSBleHRyYUxlbmd0aCwgcGF0Y2guc3RhcnQyIC09IGV4dHJhTGVuZ3RoLCBwYXRjaC51dGY4U3RhcnQxIC09IGV4dHJhTGVuZ3RoLCBwYXRjaC51dGY4U3RhcnQyIC09IGV4dHJhTGVuZ3RoLCBwYXRjaC5sZW5ndGgxICs9IGV4dHJhTGVuZ3RoLCBwYXRjaC5sZW5ndGgyICs9IGV4dHJhTGVuZ3RoLCBwYXRjaC51dGY4TGVuZ3RoMSArPSBleHRyYUxlbmd0aCwgcGF0Y2gudXRmOExlbmd0aDIgKz0gZXh0cmFMZW5ndGg7XG4gIH1cbiAgaWYgKHBhdGNoID0gcGF0Y2hlc1twYXRjaGVzLmxlbmd0aCAtIDFdLCBkaWZmcyA9IHBhdGNoLmRpZmZzLCBkaWZmcy5sZW5ndGggPT09IDAgfHwgZGlmZnNbZGlmZnMubGVuZ3RoIC0gMV1bMF0gIT09IERJRkZfRVFVQUwpIGRpZmZzLnB1c2goW0RJRkZfRVFVQUwsIG51bGxQYWRkaW5nXSksIHBhdGNoLmxlbmd0aDEgKz0gcGFkZGluZ0xlbmd0aCwgcGF0Y2gubGVuZ3RoMiArPSBwYWRkaW5nTGVuZ3RoLCBwYXRjaC51dGY4TGVuZ3RoMSArPSBwYWRkaW5nTGVuZ3RoLCBwYXRjaC51dGY4TGVuZ3RoMiArPSBwYWRkaW5nTGVuZ3RoO1xuICBlbHNlIGlmIChwYWRkaW5nTGVuZ3RoID4gZGlmZnNbZGlmZnMubGVuZ3RoIC0gMV1bMV0ubGVuZ3RoKSB7XG4gICAgY29uc3QgZXh0cmFMZW5ndGggPSBwYWRkaW5nTGVuZ3RoIC0gZGlmZnNbZGlmZnMubGVuZ3RoIC0gMV1bMV0ubGVuZ3RoO1xuICAgIGRpZmZzW2RpZmZzLmxlbmd0aCAtIDFdWzFdICs9IG51bGxQYWRkaW5nLnN1YnN0cmluZygwLCBleHRyYUxlbmd0aCksIHBhdGNoLmxlbmd0aDEgKz0gZXh0cmFMZW5ndGgsIHBhdGNoLmxlbmd0aDIgKz0gZXh0cmFMZW5ndGgsIHBhdGNoLnV0ZjhMZW5ndGgxICs9IGV4dHJhTGVuZ3RoLCBwYXRjaC51dGY4TGVuZ3RoMiArPSBleHRyYUxlbmd0aDtcbiAgfVxuICByZXR1cm4gbnVsbFBhZGRpbmc7XG59XG5mdW5jdGlvbiBjcmVhdGVQYXRjaE9iamVjdChzdGFydDEsIHN0YXJ0Mikge1xuICByZXR1cm4ge1xuICAgIGRpZmZzOiBbXSxcbiAgICBzdGFydDEsXG4gICAgc3RhcnQyLFxuICAgIHV0ZjhTdGFydDE6IHN0YXJ0MSxcbiAgICB1dGY4U3RhcnQyOiBzdGFydDIsXG4gICAgbGVuZ3RoMTogMCxcbiAgICBsZW5ndGgyOiAwLFxuICAgIHV0ZjhMZW5ndGgxOiAwLFxuICAgIHV0ZjhMZW5ndGgyOiAwXG4gIH07XG59XG5mdW5jdGlvbiBzcGxpdE1heChwYXRjaGVzLCBtYXJnaW4gPSBERUZBVUxUX01BUkdJTikge1xuICBjb25zdCBwYXRjaFNpemUgPSBNQVhfQklUUztcbiAgZm9yIChsZXQgeCA9IDA7IHggPCBwYXRjaGVzLmxlbmd0aDsgeCsrKSB7XG4gICAgaWYgKHBhdGNoZXNbeF0ubGVuZ3RoMSA8PSBwYXRjaFNpemUpIGNvbnRpbnVlO1xuICAgIGNvbnN0IGJpZ3BhdGNoID0gcGF0Y2hlc1t4XTtcbiAgICBwYXRjaGVzLnNwbGljZSh4LS0sIDEpO1xuICAgIGxldCBzdGFydDEgPSBiaWdwYXRjaC5zdGFydDEsIHN0YXJ0MiA9IGJpZ3BhdGNoLnN0YXJ0MiwgcHJlQ29udGV4dCA9IFwiXCI7XG4gICAgZm9yICg7IGJpZ3BhdGNoLmRpZmZzLmxlbmd0aCAhPT0gMDsgKSB7XG4gICAgICBjb25zdCBwYXRjaCA9IGNyZWF0ZVBhdGNoT2JqZWN0KHN0YXJ0MSAtIHByZUNvbnRleHQubGVuZ3RoLCBzdGFydDIgLSBwcmVDb250ZXh0Lmxlbmd0aCk7XG4gICAgICBsZXQgZW1wdHkgPSAhMDtcbiAgICAgIGlmIChwcmVDb250ZXh0ICE9PSBcIlwiKSB7XG4gICAgICAgIGNvbnN0IHByZWNvbnRleHRCeXRlQ291bnQgPSBjb3VudFV0ZjhCeXRlcyhwcmVDb250ZXh0KTtcbiAgICAgICAgcGF0Y2gubGVuZ3RoMSA9IHByZUNvbnRleHQubGVuZ3RoLCBwYXRjaC51dGY4TGVuZ3RoMSA9IHByZWNvbnRleHRCeXRlQ291bnQsIHBhdGNoLmxlbmd0aDIgPSBwcmVDb250ZXh0Lmxlbmd0aCwgcGF0Y2gudXRmOExlbmd0aDIgPSBwcmVjb250ZXh0Qnl0ZUNvdW50LCBwYXRjaC5kaWZmcy5wdXNoKFtESUZGX0VRVUFMLCBwcmVDb250ZXh0XSk7XG4gICAgICB9XG4gICAgICBmb3IgKDsgYmlncGF0Y2guZGlmZnMubGVuZ3RoICE9PSAwICYmIHBhdGNoLmxlbmd0aDEgPCBwYXRjaFNpemUgLSBtYXJnaW47ICkge1xuICAgICAgICBjb25zdCBkaWZmVHlwZSA9IGJpZ3BhdGNoLmRpZmZzWzBdWzBdO1xuICAgICAgICBsZXQgZGlmZlRleHQgPSBiaWdwYXRjaC5kaWZmc1swXVsxXSwgZGlmZlRleHRCeXRlQ291bnQgPSBjb3VudFV0ZjhCeXRlcyhkaWZmVGV4dCk7XG4gICAgICAgIGlmIChkaWZmVHlwZSA9PT0gRElGRl9JTlNFUlQpIHtcbiAgICAgICAgICBwYXRjaC5sZW5ndGgyICs9IGRpZmZUZXh0Lmxlbmd0aCwgcGF0Y2gudXRmOExlbmd0aDIgKz0gZGlmZlRleHRCeXRlQ291bnQsIHN0YXJ0MiArPSBkaWZmVGV4dC5sZW5ndGg7XG4gICAgICAgICAgY29uc3QgZGlmZjIgPSBiaWdwYXRjaC5kaWZmcy5zaGlmdCgpO1xuICAgICAgICAgIGRpZmYyICYmIHBhdGNoLmRpZmZzLnB1c2goZGlmZjIpLCBlbXB0eSA9ICExO1xuICAgICAgICB9IGVsc2UgZGlmZlR5cGUgPT09IERJRkZfREVMRVRFICYmIHBhdGNoLmRpZmZzLmxlbmd0aCA9PT0gMSAmJiBwYXRjaC5kaWZmc1swXVswXSA9PT0gRElGRl9FUVVBTCAmJiBkaWZmVGV4dC5sZW5ndGggPiAyICogcGF0Y2hTaXplID8gKHBhdGNoLmxlbmd0aDEgKz0gZGlmZlRleHQubGVuZ3RoLCBwYXRjaC51dGY4TGVuZ3RoMSArPSBkaWZmVGV4dEJ5dGVDb3VudCwgc3RhcnQxICs9IGRpZmZUZXh0Lmxlbmd0aCwgZW1wdHkgPSAhMSwgcGF0Y2guZGlmZnMucHVzaChbZGlmZlR5cGUsIGRpZmZUZXh0XSksIGJpZ3BhdGNoLmRpZmZzLnNoaWZ0KCkpIDogKGRpZmZUZXh0ID0gZGlmZlRleHQuc3Vic3RyaW5nKDAsIHBhdGNoU2l6ZSAtIHBhdGNoLmxlbmd0aDEgLSBtYXJnaW4pLCBkaWZmVGV4dEJ5dGVDb3VudCA9IGNvdW50VXRmOEJ5dGVzKGRpZmZUZXh0KSwgcGF0Y2gubGVuZ3RoMSArPSBkaWZmVGV4dC5sZW5ndGgsIHBhdGNoLnV0ZjhMZW5ndGgxICs9IGRpZmZUZXh0Qnl0ZUNvdW50LCBzdGFydDEgKz0gZGlmZlRleHQubGVuZ3RoLCBkaWZmVHlwZSA9PT0gRElGRl9FUVVBTCA/IChwYXRjaC5sZW5ndGgyICs9IGRpZmZUZXh0Lmxlbmd0aCwgcGF0Y2gudXRmOExlbmd0aDIgKz0gZGlmZlRleHRCeXRlQ291bnQsIHN0YXJ0MiArPSBkaWZmVGV4dC5sZW5ndGgpIDogZW1wdHkgPSAhMSwgcGF0Y2guZGlmZnMucHVzaChbZGlmZlR5cGUsIGRpZmZUZXh0XSksIGRpZmZUZXh0ID09PSBiaWdwYXRjaC5kaWZmc1swXVsxXSA/IGJpZ3BhdGNoLmRpZmZzLnNoaWZ0KCkgOiBiaWdwYXRjaC5kaWZmc1swXVsxXSA9IGJpZ3BhdGNoLmRpZmZzWzBdWzFdLnN1YnN0cmluZyhkaWZmVGV4dC5sZW5ndGgpKTtcbiAgICAgIH1cbiAgICAgIHByZUNvbnRleHQgPSBkaWZmVGV4dDIocGF0Y2guZGlmZnMpLCBwcmVDb250ZXh0ID0gcHJlQ29udGV4dC5zdWJzdHJpbmcocHJlQ29udGV4dC5sZW5ndGggLSBtYXJnaW4pO1xuICAgICAgY29uc3QgcG9zdENvbnRleHQgPSBkaWZmVGV4dDEoYmlncGF0Y2guZGlmZnMpLnN1YnN0cmluZygwLCBtYXJnaW4pLCBwb3N0Q29udGV4dEJ5dGVDb3VudCA9IGNvdW50VXRmOEJ5dGVzKHBvc3RDb250ZXh0KTtcbiAgICAgIHBvc3RDb250ZXh0ICE9PSBcIlwiICYmIChwYXRjaC5sZW5ndGgxICs9IHBvc3RDb250ZXh0Lmxlbmd0aCwgcGF0Y2gubGVuZ3RoMiArPSBwb3N0Q29udGV4dC5sZW5ndGgsIHBhdGNoLnV0ZjhMZW5ndGgxICs9IHBvc3RDb250ZXh0Qnl0ZUNvdW50LCBwYXRjaC51dGY4TGVuZ3RoMiArPSBwb3N0Q29udGV4dEJ5dGVDb3VudCwgcGF0Y2guZGlmZnMubGVuZ3RoICE9PSAwICYmIHBhdGNoLmRpZmZzW3BhdGNoLmRpZmZzLmxlbmd0aCAtIDFdWzBdID09PSBESUZGX0VRVUFMID8gcGF0Y2guZGlmZnNbcGF0Y2guZGlmZnMubGVuZ3RoIC0gMV1bMV0gKz0gcG9zdENvbnRleHQgOiBwYXRjaC5kaWZmcy5wdXNoKFtESUZGX0VRVUFMLCBwb3N0Q29udGV4dF0pKSwgZW1wdHkgfHwgcGF0Y2hlcy5zcGxpY2UoKyt4LCAwLCBwYXRjaCk7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBhcHBseShwYXRjaGVzLCBvcmlnaW5hbFRleHQsIG9wdHMgPSB7fSkge1xuICBpZiAodHlwZW9mIHBhdGNoZXMgPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEVycm9yKFwiUGF0Y2hlcyBtdXN0IGJlIGFuIGFycmF5IC0gcGFzcyB0aGUgcGF0Y2ggdG8gYHBhcnNlUGF0Y2goKWAgZmlyc3RcIik7XG4gIGxldCB0ZXh0ID0gb3JpZ2luYWxUZXh0O1xuICBpZiAocGF0Y2hlcy5sZW5ndGggPT09IDApIHJldHVybiBbdGV4dCwgW11dO1xuICBjb25zdCBwYXJzZWQgPSBhZGp1c3RJbmRpY2llc1RvVWNzMihwYXRjaGVzLCB0ZXh0LCB7XG4gICAgYWxsb3dFeGNlZWRpbmdJbmRpY2VzOiBvcHRzLmFsbG93RXhjZWVkaW5nSW5kaWNlc1xuICB9KSwgbWFyZ2luID0gb3B0cy5tYXJnaW4gfHwgREVGQVVMVF9NQVJHSU4sIGRlbGV0ZVRocmVzaG9sZCA9IG9wdHMuZGVsZXRlVGhyZXNob2xkIHx8IDAuNCwgbnVsbFBhZGRpbmcgPSBhZGRQYWRkaW5nKHBhcnNlZCwgbWFyZ2luKTtcbiAgdGV4dCA9IG51bGxQYWRkaW5nICsgdGV4dCArIG51bGxQYWRkaW5nLCBzcGxpdE1heChwYXJzZWQsIG1hcmdpbik7XG4gIGxldCBkZWx0YSA9IDA7XG4gIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgZm9yIChsZXQgeCA9IDA7IHggPCBwYXJzZWQubGVuZ3RoOyB4KyspIHtcbiAgICBjb25zdCBleHBlY3RlZExvYyA9IHBhcnNlZFt4XS5zdGFydDIgKyBkZWx0YSwgdGV4dDEgPSBkaWZmVGV4dDEocGFyc2VkW3hdLmRpZmZzKTtcbiAgICBsZXQgc3RhcnRMb2MsIGVuZExvYyA9IC0xO1xuICAgIGlmICh0ZXh0MS5sZW5ndGggPiBNQVhfQklUUyA/IChzdGFydExvYyA9IG1hdGNoKHRleHQsIHRleHQxLnN1YnN0cmluZygwLCBNQVhfQklUUyksIGV4cGVjdGVkTG9jKSwgc3RhcnRMb2MgIT09IC0xICYmIChlbmRMb2MgPSBtYXRjaCh0ZXh0LCB0ZXh0MS5zdWJzdHJpbmcodGV4dDEubGVuZ3RoIC0gTUFYX0JJVFMpLCBleHBlY3RlZExvYyArIHRleHQxLmxlbmd0aCAtIE1BWF9CSVRTKSwgKGVuZExvYyA9PT0gLTEgfHwgc3RhcnRMb2MgPj0gZW5kTG9jKSAmJiAoc3RhcnRMb2MgPSAtMSkpKSA6IHN0YXJ0TG9jID0gbWF0Y2godGV4dCwgdGV4dDEsIGV4cGVjdGVkTG9jKSwgc3RhcnRMb2MgPT09IC0xKSByZXN1bHRzW3hdID0gITEsIGRlbHRhIC09IHBhcnNlZFt4XS5sZW5ndGgyIC0gcGFyc2VkW3hdLmxlbmd0aDE7XG4gICAgZWxzZSB7XG4gICAgICByZXN1bHRzW3hdID0gITAsIGRlbHRhID0gc3RhcnRMb2MgLSBleHBlY3RlZExvYztcbiAgICAgIGxldCB0ZXh0MjtcbiAgICAgIGlmIChlbmRMb2MgPT09IC0xID8gdGV4dDIgPSB0ZXh0LnN1YnN0cmluZyhzdGFydExvYywgc3RhcnRMb2MgKyB0ZXh0MS5sZW5ndGgpIDogdGV4dDIgPSB0ZXh0LnN1YnN0cmluZyhzdGFydExvYywgZW5kTG9jICsgTUFYX0JJVFMpLCB0ZXh0MSA9PT0gdGV4dDIpIHRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBzdGFydExvYykgKyBkaWZmVGV4dDIocGFyc2VkW3hdLmRpZmZzKSArIHRleHQuc3Vic3RyaW5nKHN0YXJ0TG9jICsgdGV4dDEubGVuZ3RoKTtcbiAgICAgIGVsc2Uge1xuICAgICAgICBsZXQgZGlmZnMgPSBkaWZmKHRleHQxLCB0ZXh0Miwge1xuICAgICAgICAgIGNoZWNrTGluZXM6ICExXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGV4dDEubGVuZ3RoID4gTUFYX0JJVFMgJiYgbGV2ZW5zaHRlaW4oZGlmZnMpIC8gdGV4dDEubGVuZ3RoID4gZGVsZXRlVGhyZXNob2xkKSByZXN1bHRzW3hdID0gITE7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGRpZmZzID0gY2xlYW51cFNlbWFudGljTG9zc2xlc3MoZGlmZnMpO1xuICAgICAgICAgIGxldCBpbmRleDEgPSAwLCBpbmRleDIgPSAwO1xuICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgcGFyc2VkW3hdLmRpZmZzLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICBjb25zdCBtb2QgPSBwYXJzZWRbeF0uZGlmZnNbeV07XG4gICAgICAgICAgICBtb2RbMF0gIT09IERJRkZfRVFVQUwgJiYgKGluZGV4MiA9IHhJbmRleChkaWZmcywgaW5kZXgxKSksIG1vZFswXSA9PT0gRElGRl9JTlNFUlQgPyB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoMCwgc3RhcnRMb2MgKyBpbmRleDIpICsgbW9kWzFdICsgdGV4dC5zdWJzdHJpbmcoc3RhcnRMb2MgKyBpbmRleDIpIDogbW9kWzBdID09PSBESUZGX0RFTEVURSAmJiAodGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIHN0YXJ0TG9jICsgaW5kZXgyKSArIHRleHQuc3Vic3RyaW5nKHN0YXJ0TG9jICsgeEluZGV4KGRpZmZzLCBpbmRleDEgKyBtb2RbMV0ubGVuZ3RoKSkpLCBtb2RbMF0gIT09IERJRkZfREVMRVRFICYmIChpbmRleDEgKz0gbW9kWzFdLmxlbmd0aCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcobnVsbFBhZGRpbmcubGVuZ3RoLCB0ZXh0Lmxlbmd0aCAtIG51bGxQYWRkaW5nLmxlbmd0aCksIFt0ZXh0LCByZXN1bHRzXTtcbn1cbmNvbnN0IHBhdGNoSGVhZGVyID0gL15AQCAtKFxcZCspLD8oXFxkKikgXFwrKFxcZCspLD8oXFxkKikgQEAkLztcbmZ1bmN0aW9uIHBhcnNlKHRleHRsaW5lKSB7XG4gIGlmICghdGV4dGxpbmUpIHJldHVybiBbXTtcbiAgY29uc3QgcGF0Y2hlcyA9IFtdLCBsaW5lcyA9IHRleHRsaW5lLnNwbGl0KGBcbmApO1xuICBsZXQgdGV4dFBvaW50ZXIgPSAwO1xuICBmb3IgKDsgdGV4dFBvaW50ZXIgPCBsaW5lcy5sZW5ndGg7ICkge1xuICAgIGNvbnN0IG0gPSBsaW5lc1t0ZXh0UG9pbnRlcl0ubWF0Y2gocGF0Y2hIZWFkZXIpO1xuICAgIGlmICghbSkgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhdGNoIHN0cmluZzogJHtsaW5lc1t0ZXh0UG9pbnRlcl19YCk7XG4gICAgY29uc3QgcGF0Y2ggPSBjcmVhdGVQYXRjaE9iamVjdCh0b0ludChtWzFdKSwgdG9JbnQobVszXSkpO1xuICAgIGZvciAocGF0Y2hlcy5wdXNoKHBhdGNoKSwgbVsyXSA9PT0gXCJcIiA/IChwYXRjaC5zdGFydDEtLSwgcGF0Y2gudXRmOFN0YXJ0MS0tLCBwYXRjaC5sZW5ndGgxID0gMSwgcGF0Y2gudXRmOExlbmd0aDEgPSAxKSA6IG1bMl0gPT09IFwiMFwiID8gKHBhdGNoLmxlbmd0aDEgPSAwLCBwYXRjaC51dGY4TGVuZ3RoMSA9IDApIDogKHBhdGNoLnN0YXJ0MS0tLCBwYXRjaC51dGY4U3RhcnQxLS0sIHBhdGNoLnV0ZjhMZW5ndGgxID0gdG9JbnQobVsyXSksIHBhdGNoLmxlbmd0aDEgPSBwYXRjaC51dGY4TGVuZ3RoMSksIG1bNF0gPT09IFwiXCIgPyAocGF0Y2guc3RhcnQyLS0sIHBhdGNoLnV0ZjhTdGFydDItLSwgcGF0Y2gubGVuZ3RoMiA9IDEsIHBhdGNoLnV0ZjhMZW5ndGgyID0gMSkgOiBtWzRdID09PSBcIjBcIiA/IChwYXRjaC5sZW5ndGgyID0gMCwgcGF0Y2gudXRmOExlbmd0aDIgPSAwKSA6IChwYXRjaC5zdGFydDItLSwgcGF0Y2gudXRmOFN0YXJ0Mi0tLCBwYXRjaC51dGY4TGVuZ3RoMiA9IHRvSW50KG1bNF0pLCBwYXRjaC5sZW5ndGgyID0gcGF0Y2gudXRmOExlbmd0aDIpLCB0ZXh0UG9pbnRlcisrOyB0ZXh0UG9pbnRlciA8IGxpbmVzLmxlbmd0aDsgKSB7XG4gICAgICBjb25zdCBjdXJyZW50TGluZSA9IGxpbmVzW3RleHRQb2ludGVyXSwgc2lnbiA9IGN1cnJlbnRMaW5lLmNoYXJBdCgwKTtcbiAgICAgIGlmIChzaWduID09PSBcIkBcIikgYnJlYWs7XG4gICAgICBpZiAoc2lnbiA9PT0gXCJcIikge1xuICAgICAgICB0ZXh0UG9pbnRlcisrO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGxldCBsaW5lO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbGluZSA9IGRlY29kZVVSSShjdXJyZW50TGluZS5zbGljZSgxKSk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbGxlZ2FsIGVzY2FwZSBpbiBwYXJzZTogJHtjdXJyZW50TGluZX1gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHV0ZjhEaWZmID0gY291bnRVdGY4Qnl0ZXMobGluZSkgLSBsaW5lLmxlbmd0aDtcbiAgICAgIGlmIChzaWduID09PSBcIi1cIikgcGF0Y2guZGlmZnMucHVzaChbRElGRl9ERUxFVEUsIGxpbmVdKSwgcGF0Y2gubGVuZ3RoMSAtPSB1dGY4RGlmZjtcbiAgICAgIGVsc2UgaWYgKHNpZ24gPT09IFwiK1wiKSBwYXRjaC5kaWZmcy5wdXNoKFtESUZGX0lOU0VSVCwgbGluZV0pLCBwYXRjaC5sZW5ndGgyIC09IHV0ZjhEaWZmO1xuICAgICAgZWxzZSBpZiAoc2lnbiA9PT0gXCIgXCIpIHBhdGNoLmRpZmZzLnB1c2goW0RJRkZfRVFVQUwsIGxpbmVdKSwgcGF0Y2gubGVuZ3RoMSAtPSB1dGY4RGlmZiwgcGF0Y2gubGVuZ3RoMiAtPSB1dGY4RGlmZjtcbiAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhdGNoIG1vZGUgXCIke3NpZ259XCIgaW46ICR7bGluZX1gKTtcbiAgICAgIHRleHRQb2ludGVyKys7XG4gICAgfVxuICB9XG4gIHJldHVybiBwYXRjaGVzO1xufVxuZnVuY3Rpb24gdG9JbnQobnVtKSB7XG4gIHJldHVybiBwYXJzZUludChudW0sIDEwKTtcbn1cbmNvbnN0IGRlYnVnJGQgPSBkZWJ1Z1dpdGhOYW1lKFwidHJhbnNmb3JtT3BlcmF0aW9uXCIpO1xuZnVuY3Rpb24gdHJhbnNmb3JtT3BlcmF0aW9uKGVkaXRvciwgcGF0Y2gsIG9wZXJhdGlvbiwgc25hcHNob3QsIHByZXZpb3VzU25hcHNob3QpIHtcbiAgY29uc3QgdHJhbnNmb3JtZWRPcGVyYXRpb24gPSB7XG4gICAgLi4ub3BlcmF0aW9uXG4gIH07XG4gIGlmIChwYXRjaC50eXBlID09PSBcImluc2VydFwiICYmIHBhdGNoLnBhdGgubGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3QgcGF0aFNlZ21lbnQgPSBwYXRjaC5wYXRoWzBdLCBpbnNlcnRCbG9ja0luZGV4ID0gKHNuYXBzaG90IHx8IFtdKS5maW5kSW5kZXgoKGJsaykgPT4gaXNLZXllZFNlZ21lbnQocGF0aFNlZ21lbnQpICYmIGJsay5fa2V5ID09PSBwYXRoU2VnbWVudC5fa2V5KTtcbiAgICByZXR1cm4gZGVidWckZChgQWRqdXN0aW5nIGJsb2NrIHBhdGggKCske3BhdGNoLml0ZW1zLmxlbmd0aH0pIGZvciAnJHt0cmFuc2Zvcm1lZE9wZXJhdGlvbi50eXBlfScgb3BlcmF0aW9uIGFuZCBwYXRjaCAnJHtwYXRjaC50eXBlfSdgKSwgW2FkanVzdEJsb2NrUGF0aCh0cmFuc2Zvcm1lZE9wZXJhdGlvbiwgcGF0Y2guaXRlbXMubGVuZ3RoLCBpbnNlcnRCbG9ja0luZGV4KV07XG4gIH1cbiAgaWYgKHBhdGNoLnR5cGUgPT09IFwidW5zZXRcIiAmJiBwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHBhdGhTZWdtZW50ID0gcGF0Y2gucGF0aFswXSwgdW5zZXRCbG9ja0luZGV4ID0gKHByZXZpb3VzU25hcHNob3QgfHwgW10pLmZpbmRJbmRleCgoYmxrKSA9PiBpc0tleWVkU2VnbWVudChwYXRoU2VnbWVudCkgJiYgYmxrLl9rZXkgPT09IHBhdGhTZWdtZW50Ll9rZXkpO1xuICAgIHJldHVybiBcInBhdGhcIiBpbiB0cmFuc2Zvcm1lZE9wZXJhdGlvbiAmJiBBcnJheS5pc0FycmF5KHRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGgpICYmIHRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGhbMF0gPT09IHVuc2V0QmxvY2tJbmRleCA/IChkZWJ1ZyRkKFwiU2tpcHBpbmcgdHJhbnNmb3JtYXRpb24gdGhhdCB0YXJnZXRlZCByZW1vdmVkIGJsb2NrXCIpLCBbXSkgOiBbYWRqdXN0QmxvY2tQYXRoKHRyYW5zZm9ybWVkT3BlcmF0aW9uLCAtMSwgdW5zZXRCbG9ja0luZGV4KV07XG4gIH1cbiAgaWYgKHBhdGNoLnR5cGUgPT09IFwidW5zZXRcIiAmJiBwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMClcbiAgICByZXR1cm4gZGVidWckZChgQWRqdXN0aW5nIHNlbGVjdGlvbiBmb3IgdW5zZXQgZXZlcnl0aGluZyBwYXRjaCBhbmQgJHtvcGVyYXRpb24udHlwZX0gb3BlcmF0aW9uYCksIFtdO1xuICBpZiAocGF0Y2gudHlwZSA9PT0gXCJkaWZmTWF0Y2hQYXRjaFwiKSB7XG4gICAgY29uc3Qgb3BlcmF0aW9uVGFyZ2V0QmxvY2sgPSBmaW5kT3BlcmF0aW9uVGFyZ2V0QmxvY2soZWRpdG9yLCB0cmFuc2Zvcm1lZE9wZXJhdGlvbiksIHBhdGhTZWdtZW50ID0gcGF0Y2gucGF0aFswXTtcbiAgICByZXR1cm4gIW9wZXJhdGlvblRhcmdldEJsb2NrIHx8ICFpc0tleWVkU2VnbWVudChwYXRoU2VnbWVudCkgfHwgb3BlcmF0aW9uVGFyZ2V0QmxvY2suX2tleSAhPT0gcGF0aFNlZ21lbnQuX2tleSA/IFt0cmFuc2Zvcm1lZE9wZXJhdGlvbl0gOiAocGFyc2UocGF0Y2gudmFsdWUpLmZvckVhY2goKGRpZmZQYXRjaCkgPT4ge1xuICAgICAgbGV0IGFkanVzdE9mZnNldEJ5ID0gMCwgY2hhbmdlZE9mZnNldCA9IGRpZmZQYXRjaC51dGY4U3RhcnQxO1xuICAgICAgY29uc3Qge1xuICAgICAgICBkaWZmc1xuICAgICAgfSA9IGRpZmZQYXRjaDtcbiAgICAgIGlmIChkaWZmcy5mb3JFYWNoKChkaWZmMiwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgW2RpZmZUeXBlLCB0ZXh0XSA9IGRpZmYyO1xuICAgICAgICBkaWZmVHlwZSA9PT0gRElGRl9JTlNFUlQgPyAoYWRqdXN0T2Zmc2V0QnkgKz0gdGV4dC5sZW5ndGgsIGNoYW5nZWRPZmZzZXQgKz0gdGV4dC5sZW5ndGgpIDogZGlmZlR5cGUgPT09IERJRkZfREVMRVRFID8gKGFkanVzdE9mZnNldEJ5IC09IHRleHQubGVuZ3RoLCBjaGFuZ2VkT2Zmc2V0IC09IHRleHQubGVuZ3RoKSA6IGRpZmZUeXBlID09PSBESUZGX0VRVUFMICYmIChkaWZmcy5zbGljZShpbmRleCkuZXZlcnkoKFtkVHlwZV0pID0+IGRUeXBlID09PSBESUZGX0VRVUFMKSB8fCAoY2hhbmdlZE9mZnNldCArPSB0ZXh0Lmxlbmd0aCkpO1xuICAgICAgfSksIHRyYW5zZm9ybWVkT3BlcmF0aW9uLnR5cGUgPT09IFwiaW5zZXJ0X3RleHRcIiAmJiBjaGFuZ2VkT2Zmc2V0IDwgdHJhbnNmb3JtZWRPcGVyYXRpb24ub2Zmc2V0ICYmICh0cmFuc2Zvcm1lZE9wZXJhdGlvbi5vZmZzZXQgKz0gYWRqdXN0T2Zmc2V0QnkpLCB0cmFuc2Zvcm1lZE9wZXJhdGlvbi50eXBlID09PSBcInJlbW92ZV90ZXh0XCIgJiYgY2hhbmdlZE9mZnNldCA8PSB0cmFuc2Zvcm1lZE9wZXJhdGlvbi5vZmZzZXQgLSB0cmFuc2Zvcm1lZE9wZXJhdGlvbi50ZXh0Lmxlbmd0aCAmJiAodHJhbnNmb3JtZWRPcGVyYXRpb24ub2Zmc2V0ICs9IGFkanVzdE9mZnNldEJ5KSwgdHJhbnNmb3JtZWRPcGVyYXRpb24udHlwZSA9PT0gXCJzZXRfc2VsZWN0aW9uXCIpIHtcbiAgICAgICAgY29uc3QgY3VycmVudEZvY3VzID0gdHJhbnNmb3JtZWRPcGVyYXRpb24ucHJvcGVydGllcz8uZm9jdXMgPyB7XG4gICAgICAgICAgLi4udHJhbnNmb3JtZWRPcGVyYXRpb24ucHJvcGVydGllcy5mb2N1c1xuICAgICAgICB9IDogdm9pZCAwLCBjdXJyZW50QW5jaG9yID0gdHJhbnNmb3JtZWRPcGVyYXRpb24/LnByb3BlcnRpZXM/LmFuY2hvciA/IHtcbiAgICAgICAgICAuLi50cmFuc2Zvcm1lZE9wZXJhdGlvbi5wcm9wZXJ0aWVzLmFuY2hvclxuICAgICAgICB9IDogdm9pZCAwLCBuZXdGb2N1cyA9IHRyYW5zZm9ybWVkT3BlcmF0aW9uPy5uZXdQcm9wZXJ0aWVzPy5mb2N1cyA/IHtcbiAgICAgICAgICAuLi50cmFuc2Zvcm1lZE9wZXJhdGlvbi5uZXdQcm9wZXJ0aWVzLmZvY3VzXG4gICAgICAgIH0gOiB2b2lkIDAsIG5ld0FuY2hvciA9IHRyYW5zZm9ybWVkT3BlcmF0aW9uPy5uZXdQcm9wZXJ0aWVzPy5hbmNob3IgPyB7XG4gICAgICAgICAgLi4udHJhbnNmb3JtZWRPcGVyYXRpb24ubmV3UHJvcGVydGllcy5hbmNob3JcbiAgICAgICAgfSA6IHZvaWQgMDtcbiAgICAgICAgKGN1cnJlbnRGb2N1cyAmJiBjdXJyZW50QW5jaG9yIHx8IG5ld0ZvY3VzICYmIG5ld0FuY2hvcikgJiYgKFtjdXJyZW50Rm9jdXMsIGN1cnJlbnRBbmNob3IsIG5ld0ZvY3VzLCBuZXdBbmNob3JdLmZvckVhY2goKHBvaW50KSA9PiB7XG4gICAgICAgICAgcG9pbnQgJiYgY2hhbmdlZE9mZnNldCA8IHBvaW50Lm9mZnNldCAmJiAocG9pbnQub2Zmc2V0ICs9IGFkanVzdE9mZnNldEJ5KTtcbiAgICAgICAgfSksIGN1cnJlbnRGb2N1cyAmJiBjdXJyZW50QW5jaG9yICYmICh0cmFuc2Zvcm1lZE9wZXJhdGlvbi5wcm9wZXJ0aWVzID0ge1xuICAgICAgICAgIGZvY3VzOiBjdXJyZW50Rm9jdXMsXG4gICAgICAgICAgYW5jaG9yOiBjdXJyZW50QW5jaG9yXG4gICAgICAgIH0pLCBuZXdGb2N1cyAmJiBuZXdBbmNob3IgJiYgKHRyYW5zZm9ybWVkT3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMgPSB7XG4gICAgICAgICAgZm9jdXM6IG5ld0ZvY3VzLFxuICAgICAgICAgIGFuY2hvcjogbmV3QW5jaG9yXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICB9KSwgW3RyYW5zZm9ybWVkT3BlcmF0aW9uXSk7XG4gIH1cbiAgcmV0dXJuIFt0cmFuc2Zvcm1lZE9wZXJhdGlvbl07XG59XG5mdW5jdGlvbiBhZGp1c3RCbG9ja1BhdGgob3BlcmF0aW9uLCBsZXZlbCwgYmxvY2tJbmRleCkge1xuICBjb25zdCB0cmFuc2Zvcm1lZE9wZXJhdGlvbiA9IHtcbiAgICAuLi5vcGVyYXRpb25cbiAgfTtcbiAgaWYgKGJsb2NrSW5kZXggPj0gMCAmJiB0cmFuc2Zvcm1lZE9wZXJhdGlvbi50eXBlICE9PSBcInNldF9zZWxlY3Rpb25cIiAmJiBBcnJheS5pc0FycmF5KHRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGgpICYmIHRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGhbMF0gPj0gYmxvY2tJbmRleCArIGxldmVsICYmIHRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGhbMF0gKyBsZXZlbCA+IC0xKSB7XG4gICAgY29uc3QgbmV3UGF0aCA9IFt0cmFuc2Zvcm1lZE9wZXJhdGlvbi5wYXRoWzBdICsgbGV2ZWwsIC4uLnRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGguc2xpY2UoMSldO1xuICAgIHRyYW5zZm9ybWVkT3BlcmF0aW9uLnBhdGggPSBuZXdQYXRoO1xuICB9XG4gIGlmICh0cmFuc2Zvcm1lZE9wZXJhdGlvbi50eXBlID09PSBcInNldF9zZWxlY3Rpb25cIikge1xuICAgIGNvbnN0IGN1cnJlbnRGb2N1cyA9IHRyYW5zZm9ybWVkT3BlcmF0aW9uLnByb3BlcnRpZXM/LmZvY3VzID8ge1xuICAgICAgLi4udHJhbnNmb3JtZWRPcGVyYXRpb24ucHJvcGVydGllcy5mb2N1c1xuICAgIH0gOiB2b2lkIDAsIGN1cnJlbnRBbmNob3IgPSB0cmFuc2Zvcm1lZE9wZXJhdGlvbj8ucHJvcGVydGllcz8uYW5jaG9yID8ge1xuICAgICAgLi4udHJhbnNmb3JtZWRPcGVyYXRpb24ucHJvcGVydGllcy5hbmNob3JcbiAgICB9IDogdm9pZCAwLCBuZXdGb2N1cyA9IHRyYW5zZm9ybWVkT3BlcmF0aW9uPy5uZXdQcm9wZXJ0aWVzPy5mb2N1cyA/IHtcbiAgICAgIC4uLnRyYW5zZm9ybWVkT3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMuZm9jdXNcbiAgICB9IDogdm9pZCAwLCBuZXdBbmNob3IgPSB0cmFuc2Zvcm1lZE9wZXJhdGlvbj8ubmV3UHJvcGVydGllcz8uYW5jaG9yID8ge1xuICAgICAgLi4udHJhbnNmb3JtZWRPcGVyYXRpb24ubmV3UHJvcGVydGllcy5hbmNob3JcbiAgICB9IDogdm9pZCAwO1xuICAgIChjdXJyZW50Rm9jdXMgJiYgY3VycmVudEFuY2hvciB8fCBuZXdGb2N1cyAmJiBuZXdBbmNob3IpICYmIChbY3VycmVudEZvY3VzLCBjdXJyZW50QW5jaG9yLCBuZXdGb2N1cywgbmV3QW5jaG9yXS5mb3JFYWNoKChwb2ludCkgPT4ge1xuICAgICAgcG9pbnQgJiYgcG9pbnQucGF0aFswXSA+PSBibG9ja0luZGV4ICsgbGV2ZWwgJiYgcG9pbnQucGF0aFswXSArIGxldmVsID4gLTEgJiYgKHBvaW50LnBhdGggPSBbcG9pbnQucGF0aFswXSArIGxldmVsLCAuLi5wb2ludC5wYXRoLnNsaWNlKDEpXSk7XG4gICAgfSksIGN1cnJlbnRGb2N1cyAmJiBjdXJyZW50QW5jaG9yICYmICh0cmFuc2Zvcm1lZE9wZXJhdGlvbi5wcm9wZXJ0aWVzID0ge1xuICAgICAgZm9jdXM6IGN1cnJlbnRGb2N1cyxcbiAgICAgIGFuY2hvcjogY3VycmVudEFuY2hvclxuICAgIH0pLCBuZXdGb2N1cyAmJiBuZXdBbmNob3IgJiYgKHRyYW5zZm9ybWVkT3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMgPSB7XG4gICAgICBmb2N1czogbmV3Rm9jdXMsXG4gICAgICBhbmNob3I6IG5ld0FuY2hvclxuICAgIH0pKTtcbiAgfVxuICByZXR1cm4gdHJhbnNmb3JtZWRPcGVyYXRpb247XG59XG5mdW5jdGlvbiBmaW5kT3BlcmF0aW9uVGFyZ2V0QmxvY2soZWRpdG9yLCBvcGVyYXRpb24pIHtcbiAgbGV0IGJsb2NrO1xuICByZXR1cm4gb3BlcmF0aW9uLnR5cGUgPT09IFwic2V0X3NlbGVjdGlvblwiICYmIGVkaXRvci5zZWxlY3Rpb24gPyBibG9jayA9IGVkaXRvci5jaGlsZHJlbltlZGl0b3Iuc2VsZWN0aW9uLmZvY3VzLnBhdGhbMF1dIDogXCJwYXRoXCIgaW4gb3BlcmF0aW9uICYmIChibG9jayA9IGVkaXRvci5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFswXV0pLCBibG9jaztcbn1cbmNvbnN0IGRlYnVnJGMgPSBkZWJ1Z1dpdGhOYW1lKFwiYmVoYXZpb3Iub3BlcmF0aW9uLmhpc3RvcnkucmVkb1wiKSwgaGlzdG9yeVJlZG9PcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBjb25zdCBlZGl0b3IgPSBvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgcmVkb3NcbiAgfSA9IGVkaXRvci5oaXN0b3J5O1xuICBpZiAocmVkb3MubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHN0ZXAgPSByZWRvc1tyZWRvcy5sZW5ndGggLSAxXTtcbiAgICBpZiAoZGVidWckYyhcIlJlZG9pbmdcIiwgc3RlcCksIHN0ZXAub3BlcmF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBvdGhlclBhdGNoZXMgPSBlZGl0b3IucmVtb3RlUGF0Y2hlcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0udGltZSA+PSBzdGVwLnRpbWVzdGFtcCk7XG4gICAgICBsZXQgdHJhbnNmb3JtZWRPcGVyYXRpb25zID0gc3RlcC5vcGVyYXRpb25zO1xuICAgICAgb3RoZXJQYXRjaGVzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgdHJhbnNmb3JtZWRPcGVyYXRpb25zID0gdHJhbnNmb3JtZWRPcGVyYXRpb25zLmZsYXRNYXAoKG9wKSA9PiB0cmFuc2Zvcm1PcGVyYXRpb24oZWRpdG9yLCBpdGVtLnBhdGNoLCBvcCwgaXRlbS5zbmFwc2hvdCwgaXRlbS5wcmV2aW91c1NuYXBzaG90KSk7XG4gICAgICB9KTtcbiAgICAgIHRyeSB7XG4gICAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgcGx1Z2luUmVkb2luZyhlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgIHBsdWdpbldpdGhvdXRIaXN0b3J5KGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgICB0cmFuc2Zvcm1lZE9wZXJhdGlvbnMuZm9yRWFjaCgob3ApID0+IHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuYXBwbHkob3ApO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBkZWJ1ZyRjKFwiQ291bGQgbm90IHBlcmZvcm0gcmVkbyBzdGVwXCIsIGVyciksIGVkaXRvci5yZW1vdGVQYXRjaGVzLnNwbGljZSgwLCBlZGl0b3IucmVtb3RlUGF0Y2hlcy5sZW5ndGgpLCBUcmFuc2Zvcm1zLmRlc2VsZWN0KGVkaXRvciksIGVkaXRvci5oaXN0b3J5ID0ge1xuICAgICAgICAgIHVuZG9zOiBbXSxcbiAgICAgICAgICByZWRvczogW11cbiAgICAgICAgfSwgZWRpdG9yLndpdGhIaXN0b3J5ID0gITAsIGVkaXRvci5pc1JlZG9pbmcgPSAhMSwgZWRpdG9yLm9uQ2hhbmdlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVkaXRvci5oaXN0b3J5LnVuZG9zLnB1c2goc3RlcCksIGVkaXRvci5oaXN0b3J5LnJlZG9zLnBvcCgpO1xuICAgIH1cbiAgfVxufTtcbmZ1bmN0aW9uIHBsdWdpblVuZG9pbmcoZWRpdG9yLCBmbikge1xuICBjb25zdCBwcmV2ID0gZWRpdG9yLmlzVW5kb2luZztcbiAgZWRpdG9yLmlzVW5kb2luZyA9ICEwLCBmbigpLCBlZGl0b3IuaXNVbmRvaW5nID0gcHJldjtcbn1cbmNvbnN0IGRlYnVnJGIgPSBkZWJ1Z1dpdGhOYW1lKFwiYmVoYXZpb3Iub3BlcmF0aW9uLmhpc3RvcnkudW5kb1wiKSwgaGlzdG9yeVVuZG9PcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBjb25zdCBlZGl0b3IgPSBvcGVyYXRpb24uZWRpdG9yLCB7XG4gICAgdW5kb3NcbiAgfSA9IGVkaXRvci5oaXN0b3J5O1xuICBpZiAodW5kb3MubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHN0ZXAgPSB1bmRvc1t1bmRvcy5sZW5ndGggLSAxXTtcbiAgICBpZiAoZGVidWckYihcIlVuZG9pbmdcIiwgc3RlcCksIHN0ZXAub3BlcmF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBvdGhlclBhdGNoZXMgPSBlZGl0b3IucmVtb3RlUGF0Y2hlcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0udGltZSA+PSBzdGVwLnRpbWVzdGFtcCk7XG4gICAgICBsZXQgdHJhbnNmb3JtZWRPcGVyYXRpb25zID0gc3RlcC5vcGVyYXRpb25zO1xuICAgICAgb3RoZXJQYXRjaGVzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgdHJhbnNmb3JtZWRPcGVyYXRpb25zID0gdHJhbnNmb3JtZWRPcGVyYXRpb25zLmZsYXRNYXAoKG9wKSA9PiB0cmFuc2Zvcm1PcGVyYXRpb24oZWRpdG9yLCBpdGVtLnBhdGNoLCBvcCwgaXRlbS5zbmFwc2hvdCwgaXRlbS5wcmV2aW91c1NuYXBzaG90KSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJldmVyc2VkT3BlcmF0aW9ucyA9IHRyYW5zZm9ybWVkT3BlcmF0aW9ucy5tYXAoT3BlcmF0aW9uLmludmVyc2UpLnJldmVyc2UoKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgcGx1Z2luVW5kb2luZyhlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgIHBsdWdpbldpdGhvdXRIaXN0b3J5KGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgICByZXZlcnNlZE9wZXJhdGlvbnMuZm9yRWFjaCgob3ApID0+IHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuYXBwbHkob3ApO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBkZWJ1ZyRiKFwiQ291bGQgbm90IHBlcmZvcm0gdW5kbyBzdGVwXCIsIGVyciksIGVkaXRvci5yZW1vdGVQYXRjaGVzLnNwbGljZSgwLCBlZGl0b3IucmVtb3RlUGF0Y2hlcy5sZW5ndGgpLCBUcmFuc2Zvcm1zLmRlc2VsZWN0KGVkaXRvciksIGVkaXRvci5oaXN0b3J5ID0ge1xuICAgICAgICAgIHVuZG9zOiBbXSxcbiAgICAgICAgICByZWRvczogW11cbiAgICAgICAgfSwgZWRpdG9yLndpdGhIaXN0b3J5ID0gITAsIGVkaXRvci5pc1VuZG9pbmcgPSAhMSwgZWRpdG9yLm9uQ2hhbmdlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVkaXRvci5oaXN0b3J5LnJlZG9zLnB1c2goc3RlcCksIGVkaXRvci5oaXN0b3J5LnVuZG9zLnBvcCgpO1xuICAgIH1cbiAgfVxufSwgaW5zZXJ0QmxvY2tPcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIGNvbnRleHQsXG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBjb25zdCBwYXJzZWRCbG9jayA9IHBhcnNlQmxvY2soe1xuICAgIGJsb2NrOiBvcGVyYXRpb24uYmxvY2ssXG4gICAgY29udGV4dCxcbiAgICBvcHRpb25zOiB7XG4gICAgICBub3JtYWxpemU6ICEwLFxuICAgICAgcmVtb3ZlVW51c2VkTWFya0RlZnM6ICEwLFxuICAgICAgdmFsaWRhdGVGaWVsZHM6ICEwXG4gICAgfVxuICB9KTtcbiAgaWYgKCFwYXJzZWRCbG9jaylcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBwYXJzZSBibG9jayAke0pTT04uc3RyaW5naWZ5KG9wZXJhdGlvbi5ibG9jayl9YCk7XG4gIGNvbnN0IGJsb2NrID0gdG9TbGF0ZUJsb2NrKHBhcnNlZEJsb2NrLCB7XG4gICAgc2NoZW1hVHlwZXM6IGNvbnRleHQuc2NoZW1hXG4gIH0pO1xuICBpbnNlcnRCbG9jayh7XG4gICAgY29udGV4dCxcbiAgICBibG9jayxcbiAgICBwbGFjZW1lbnQ6IG9wZXJhdGlvbi5wbGFjZW1lbnQsXG4gICAgc2VsZWN0OiBvcGVyYXRpb24uc2VsZWN0ID8/IFwic3RhcnRcIixcbiAgICBhdDogb3BlcmF0aW9uLmF0LFxuICAgIGVkaXRvcjogb3BlcmF0aW9uLmVkaXRvclxuICB9KTtcbn07XG5mdW5jdGlvbiBpbnNlcnRCbG9jayhvcHRpb25zKSB7XG4gIGNvbnN0IHtcbiAgICBjb250ZXh0LFxuICAgIGJsb2NrLFxuICAgIHBsYWNlbWVudCxcbiAgICBzZWxlY3QsXG4gICAgZWRpdG9yXG4gIH0gPSBvcHRpb25zLCBhdCA9IG9wdGlvbnMuYXQgPyB0b1NsYXRlUmFuZ2Uoe1xuICAgIGNvbnRleHQ6IHtcbiAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWEsXG4gICAgICB2YWx1ZTogZWRpdG9yLnZhbHVlLFxuICAgICAgc2VsZWN0aW9uOiBvcHRpb25zLmF0XG4gICAgfSxcbiAgICBibG9ja0luZGV4TWFwOiBlZGl0b3IuYmxvY2tJbmRleE1hcFxuICB9KSA6IGVkaXRvci5zZWxlY3Rpb247XG4gIGVkaXRvci5jaGlsZHJlbi5sZW5ndGggPT09IDAgJiYgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGNyZWF0ZVBsYWNlaG9sZGVyQmxvY2soY29udGV4dCksIHtcbiAgICBhdDogWzBdXG4gIH0pO1xuICBjb25zdCBzdGFydCA9IGF0ID8gUmFuZ2Uuc3RhcnQoYXQpIDogRWRpdG9yLnN0YXJ0KGVkaXRvciwgW10pLCBlbmQgPSBhdCA/IFJhbmdlLmVuZChhdCkgOiBFZGl0b3IuZW5kKGVkaXRvciwgW10pLCBbc3RhcnRCbG9jaywgc3RhcnRCbG9ja1BhdGhdID0gQXJyYXkuZnJvbShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgYXQ6IHN0YXJ0LFxuICAgIG1vZGU6IFwibG93ZXN0XCIsXG4gICAgbWF0Y2g6IChub2RlLCBwYXRoKSA9PiBFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIHBhdGgubGVuZ3RoIDw9IHN0YXJ0LnBhdGgubGVuZ3RoXG4gIH0pKS5hdCgwKSA/PyBbdm9pZCAwLCB2b2lkIDBdLCBbZW5kQmxvY2ssIGVuZEJsb2NrUGF0aF0gPSBBcnJheS5mcm9tKEVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICBhdDogZW5kLFxuICAgIG1vZGU6IFwibG93ZXN0XCIsXG4gICAgbWF0Y2g6IChub2RlLCBwYXRoKSA9PiBFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIHBhdGgubGVuZ3RoIDw9IGVuZC5wYXRoLmxlbmd0aFxuICB9KSkuYXQoMCkgPz8gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgaWYgKCFzdGFydEJsb2NrIHx8ICFzdGFydEJsb2NrUGF0aCB8fCAhZW5kQmxvY2sgfHwgIWVuZEJsb2NrUGF0aClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gaW5zZXJ0IGJsb2NrIHdpdGhvdXQgYSBzdGFydCBhbmQgZW5kIGJsb2NrXCIpO1xuICBpZiAoIWVkaXRvci5zZWxlY3Rpb24gJiYgc2VsZWN0ICE9PSBcIm5vbmVcIiAmJiBET01FZGl0b3IuZm9jdXMoZWRpdG9yKSwgIWF0KSB7XG4gICAgaWYgKHBsYWNlbWVudCA9PT0gXCJiZWZvcmVcIilcbiAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBbYmxvY2tdLCB7XG4gICAgICAgIGF0OiBbMF1cbiAgICAgIH0pLCBzZWxlY3QgPT09IFwic3RhcnRcIiA/IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLnN0YXJ0KGVkaXRvciwgWzBdKSkgOiBzZWxlY3QgPT09IFwiZW5kXCIgJiYgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3IuZW5kKGVkaXRvciwgWzBdKSk7XG4gICAgZWxzZSBpZiAocGxhY2VtZW50ID09PSBcImFmdGVyXCIpIHtcbiAgICAgIGNvbnN0IG5leHRQYXRoID0gUGF0aC5uZXh0KGVuZEJsb2NrUGF0aCk7XG4gICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgW2Jsb2NrXSwge1xuICAgICAgICBhdDogbmV4dFBhdGhcbiAgICAgIH0pLCBzZWxlY3QgPT09IFwic3RhcnRcIiA/IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLnN0YXJ0KGVkaXRvciwgbmV4dFBhdGgpKSA6IHNlbGVjdCA9PT0gXCJlbmRcIiAmJiBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5lbmQoZWRpdG9yLCBuZXh0UGF0aCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaXNFbXB0eVRleHRCbG9jayhjb250ZXh0LCBlbmRCbG9jaykpIHtcbiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgICBhdDogZW5kQmxvY2tQYXRoLFxuICAgICAgICAgIHNlbGVjdDogITFcbiAgICAgICAgfSksIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgYXQ6IFBhdGgubmV4dChlbmRCbG9ja1BhdGgpXG4gICAgICAgIH0pLCBUcmFuc2Zvcm1zLmRlc2VsZWN0KGVkaXRvciksIHNlbGVjdCA9PT0gXCJzdGFydFwiID8gVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpKSA6IHNlbGVjdCA9PT0gXCJlbmRcIiAmJiBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5lbmQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5pc1RleHRCbG9jayhibG9jaykgJiYgZW5kQmxvY2sgJiYgZWRpdG9yLmlzVGV4dEJsb2NrKGVuZEJsb2NrKSkge1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25CZWZvcmUgPSBFZGl0b3IuZW5kKGVkaXRvciwgZW5kQmxvY2tQYXRoKTtcbiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnRGcmFnbWVudChlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgICBhdDogRWRpdG9yLmVuZChlZGl0b3IsIGVuZEJsb2NrUGF0aClcbiAgICAgICAgfSksIHNlbGVjdCA9PT0gXCJzdGFydFwiID8gVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBzZWxlY3Rpb25CZWZvcmUpIDogc2VsZWN0ID09PSBcIm5vbmVcIiAmJiBUcmFuc2Zvcm1zLmRlc2VsZWN0KGVkaXRvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5leHRQYXRoID0gUGF0aC5uZXh0KGVuZEJsb2NrUGF0aCk7XG4gICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgW2Jsb2NrXSwge1xuICAgICAgICBhdDogbmV4dFBhdGgsXG4gICAgICAgIHNlbGVjdDogITFcbiAgICAgIH0pLCBzZWxlY3QgPT09IFwic3RhcnRcIiA/IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLnN0YXJ0KGVkaXRvciwgbmV4dFBhdGgpKSA6IHNlbGVjdCA9PT0gXCJlbmRcIiAmJiBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5lbmQoZWRpdG9yLCBuZXh0UGF0aCkpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCFhdClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gaW5zZXJ0IGJsb2NrIHdpdGhvdXQgYSBzZWxlY3Rpb25cIik7XG4gIGlmIChwbGFjZW1lbnQgPT09IFwiYmVmb3JlXCIpXG4gICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgIGF0OiBzdGFydEJsb2NrUGF0aCxcbiAgICAgIHNlbGVjdDogITFcbiAgICB9KSwgc2VsZWN0ID09PSBcInN0YXJ0XCIgPyBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5zdGFydChlZGl0b3IsIHN0YXJ0QmxvY2tQYXRoKSkgOiBzZWxlY3QgPT09IFwiZW5kXCIgJiYgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3IuZW5kKGVkaXRvciwgc3RhcnRCbG9ja1BhdGgpKTtcbiAgZWxzZSBpZiAocGxhY2VtZW50ID09PSBcImFmdGVyXCIpIHtcbiAgICBjb25zdCBuZXh0UGF0aCA9IFBhdGgubmV4dChlbmRCbG9ja1BhdGgpO1xuICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBbYmxvY2tdLCB7XG4gICAgICBhdDogbmV4dFBhdGgsXG4gICAgICBzZWxlY3Q6ICExXG4gICAgfSksIHNlbGVjdCA9PT0gXCJzdGFydFwiID8gVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBuZXh0UGF0aCkpIDogc2VsZWN0ID09PSBcImVuZFwiICYmIFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLmVuZChlZGl0b3IsIG5leHRQYXRoKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZW5kQmxvY2tFbmRQb2ludCA9IEVkaXRvci5zdGFydChlZGl0b3IsIGVuZEJsb2NrUGF0aCk7XG4gICAgaWYgKFJhbmdlLmlzRXhwYW5kZWQoYXQpICYmICFlZGl0b3IuaXNUZXh0QmxvY2soYmxvY2spKSB7XG4gICAgICBjb25zdCBhdEJlZm9yZURlbGV0ZSA9IEVkaXRvci5yYW5nZVJlZihlZGl0b3IsIGF0LCB7XG4gICAgICAgIGFmZmluaXR5OiBcImlud2FyZFwiXG4gICAgICB9KTtcbiAgICAgIFRyYW5zZm9ybXMuZGVsZXRlKGVkaXRvciwge1xuICAgICAgICBhdFxuICAgICAgfSk7XG4gICAgICBjb25zdCBbZm9jdXNCbG9jaywgZm9jdXNCbG9ja1BhdGhdID0gZ2V0Rm9jdXNCbG9jayh7XG4gICAgICAgIGVkaXRvclxuICAgICAgfSksIGF0QWZ0ZXJEZWxldGUgPSBhdEJlZm9yZURlbGV0ZS51bnJlZigpID8/IGVkaXRvci5zZWxlY3Rpb24sIGF0QmVmb3JlSW5zZXJ0ID0gYXRBZnRlckRlbGV0ZSA/IEVkaXRvci5yYW5nZVJlZihlZGl0b3IsIGF0QWZ0ZXJEZWxldGUsIHtcbiAgICAgICAgYWZmaW5pdHk6IFwiaW53YXJkXCJcbiAgICAgIH0pIDogdm9pZCAwO1xuICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgdm9pZHM6ICEwLFxuICAgICAgICBhdDogYXRBZnRlckRlbGV0ZSA/PyB2b2lkIDAsXG4gICAgICAgIHNlbGVjdDogc2VsZWN0ICE9PSBcIm5vbmVcIlxuICAgICAgfSk7XG4gICAgICBjb25zdCBhdEFmdGVySW5zZXJ0ID0gYXRCZWZvcmVJbnNlcnQ/LnVucmVmKCkgPz8gZWRpdG9yLnNlbGVjdGlvbjtcbiAgICAgIHNlbGVjdCA9PT0gXCJub25lXCIgJiYgYXRBZnRlckluc2VydCAmJiBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIGF0QWZ0ZXJJbnNlcnQpLCBpc0VtcHR5VGV4dEJsb2NrKGNvbnRleHQsIGZvY3VzQmxvY2spICYmIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7XG4gICAgICAgIGF0OiBmb2N1c0Jsb2NrUGF0aFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChlZGl0b3IuaXNUZXh0QmxvY2soZW5kQmxvY2spICYmIGVkaXRvci5pc1RleHRCbG9jayhibG9jaykpIHtcbiAgICAgIGNvbnN0IHNlbGVjdGlvblN0YXJ0UG9pbnQgPSBSYW5nZS5zdGFydChhdCk7XG4gICAgICBpZiAoaXNFbXB0eVRleHRCbG9jayhjb250ZXh0LCBlbmRCbG9jaykpIHtcbiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgICBhdDogZW5kQmxvY2tQYXRoLFxuICAgICAgICAgIHNlbGVjdDogITFcbiAgICAgICAgfSksIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgYXQ6IFBhdGgubmV4dChlbmRCbG9ja1BhdGgpXG4gICAgICAgIH0pLCBzZWxlY3QgPT09IFwic3RhcnRcIiA/IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgc2VsZWN0aW9uU3RhcnRQb2ludCkgOiBzZWxlY3QgPT09IFwiZW5kXCIgPyBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5lbmQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpKSA6IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgYXQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBlbmRCbG9ja0NoaWxkS2V5cyA9IGVuZEJsb2NrLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGNoaWxkLl9rZXkpLCBlbmRCbG9ja01hcmtEZWZzS2V5cyA9IGVuZEJsb2NrLm1hcmtEZWZzPy5tYXAoKG1hcmtEZWYpID0+IG1hcmtEZWYuX2tleSkgPz8gW10sIG1hcmtEZWZLZXlNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCBhZGp1c3RlZE1hcmtEZWZzID0gYmxvY2subWFya0RlZnM/Lm1hcCgobWFya0RlZikgPT4ge1xuICAgICAgICBpZiAoZW5kQmxvY2tNYXJrRGVmc0tleXMuaW5jbHVkZXMobWFya0RlZi5fa2V5KSkge1xuICAgICAgICAgIGNvbnN0IG5ld0tleSA9IGNvbnRleHQua2V5R2VuZXJhdG9yKCk7XG4gICAgICAgICAgcmV0dXJuIG1hcmtEZWZLZXlNYXAuc2V0KG1hcmtEZWYuX2tleSwgbmV3S2V5KSwge1xuICAgICAgICAgICAgLi4ubWFya0RlZixcbiAgICAgICAgICAgIF9rZXk6IG5ld0tleVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1hcmtEZWY7XG4gICAgICB9KSwgYWRqdXN0ZWRDaGlsZHJlbiA9IGJsb2NrLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IHtcbiAgICAgICAgaWYgKGlzU3Bhbihjb250ZXh0LCBjaGlsZCkpIHtcbiAgICAgICAgICBjb25zdCBtYXJrcyA9IGNoaWxkLm1hcmtzPy5tYXAoKG1hcmspID0+IG1hcmtEZWZLZXlNYXAuZ2V0KG1hcmspIHx8IG1hcmspID8/IFtdO1xuICAgICAgICAgIGlmICghaXNFcXVhbE1hcmtzKGNoaWxkLm1hcmtzLCBtYXJrcykpXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5jaGlsZCxcbiAgICAgICAgICAgICAgX2tleTogZW5kQmxvY2tDaGlsZEtleXMuaW5jbHVkZXMoY2hpbGQuX2tleSkgPyBjb250ZXh0LmtleUdlbmVyYXRvcigpIDogY2hpbGQuX2tleSxcbiAgICAgICAgICAgICAgbWFya3NcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVuZEJsb2NrQ2hpbGRLZXlzLmluY2x1ZGVzKGNoaWxkLl9rZXkpID8ge1xuICAgICAgICAgIC4uLmNoaWxkLFxuICAgICAgICAgIF9rZXk6IGNvbnRleHQua2V5R2VuZXJhdG9yKClcbiAgICAgICAgfSA6IGNoaWxkO1xuICAgICAgfSk7XG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICBtYXJrRGVmczogWy4uLmVuZEJsb2NrLm1hcmtEZWZzID8/IFtdLCAuLi5hZGp1c3RlZE1hcmtEZWZzID8/IFtdXVxuICAgICAgfSwge1xuICAgICAgICBhdDogZW5kQmxvY2tQYXRoXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGFkanVzdGVkQmxvY2sgPSBpc0VxdWFsQ2hpbGRyZW4oYmxvY2suY2hpbGRyZW4sIGFkanVzdGVkQ2hpbGRyZW4pID8gYmxvY2sgOiB7XG4gICAgICAgIC4uLmJsb2NrLFxuICAgICAgICBjaGlsZHJlbjogYWRqdXN0ZWRDaGlsZHJlblxuICAgICAgfTtcbiAgICAgIGlmIChzZWxlY3QgPT09IFwiZW5kXCIpIHtcbiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnRGcmFnbWVudChlZGl0b3IsIFthZGp1c3RlZEJsb2NrXSwge1xuICAgICAgICAgIHZvaWRzOiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgVHJhbnNmb3Jtcy5pbnNlcnRGcmFnbWVudChlZGl0b3IsIFthZGp1c3RlZEJsb2NrXSwge1xuICAgICAgICBhdCxcbiAgICAgICAgdm9pZHM6ICEwXG4gICAgICB9KSwgc2VsZWN0ID09PSBcInN0YXJ0XCIgPyBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIHNlbGVjdGlvblN0YXJ0UG9pbnQpIDogUG9pbnQuZXF1YWxzKHNlbGVjdGlvblN0YXJ0UG9pbnQsIGVuZEJsb2NrRW5kUG9pbnQpIHx8IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgc2VsZWN0aW9uU3RhcnRQb2ludCk7XG4gICAgfSBlbHNlIGlmIChlZGl0b3IuaXNUZXh0QmxvY2soZW5kQmxvY2spKSB7XG4gICAgICBjb25zdCBlbmRCbG9ja1N0YXJ0UG9pbnQgPSBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpLCBlbmRCbG9ja0VuZFBvaW50MiA9IEVkaXRvci5lbmQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpLCBzZWxlY3Rpb25TdGFydFBvaW50ID0gUmFuZ2Uuc3RhcnQoYXQpLCBzZWxlY3Rpb25FbmRQb2ludCA9IFJhbmdlLmVuZChhdCk7XG4gICAgICBpZiAoUmFuZ2UuaXNDb2xsYXBzZWQoYXQpICYmIFBvaW50LmVxdWFscyhzZWxlY3Rpb25TdGFydFBvaW50LCBlbmRCbG9ja1N0YXJ0UG9pbnQpKVxuICAgICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgW2Jsb2NrXSwge1xuICAgICAgICAgIGF0OiBlbmRCbG9ja1BhdGgsXG4gICAgICAgICAgc2VsZWN0OiAhMVxuICAgICAgICB9KSwgKHNlbGVjdCA9PT0gXCJzdGFydFwiIHx8IHNlbGVjdCA9PT0gXCJlbmRcIikgJiYgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpKSwgaXNFbXB0eVRleHRCbG9jayhjb250ZXh0LCBlbmRCbG9jaykgJiYgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICBhdDogUGF0aC5uZXh0KGVuZEJsb2NrUGF0aClcbiAgICAgICAgfSk7XG4gICAgICBlbHNlIGlmIChSYW5nZS5pc0NvbGxhcHNlZChhdCkgJiYgUG9pbnQuZXF1YWxzKHNlbGVjdGlvbkVuZFBvaW50LCBlbmRCbG9ja0VuZFBvaW50MikpIHtcbiAgICAgICAgY29uc3QgbmV4dFBhdGggPSBbZW5kQmxvY2tQYXRoWzBdICsgMV07XG4gICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBbYmxvY2tdLCB7XG4gICAgICAgICAgYXQ6IG5leHRQYXRoLFxuICAgICAgICAgIHNlbGVjdDogITFcbiAgICAgICAgfSksIChzZWxlY3QgPT09IFwic3RhcnRcIiB8fCBzZWxlY3QgPT09IFwiZW5kXCIpICYmIFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLnN0YXJ0KGVkaXRvciwgbmV4dFBhdGgpKTtcbiAgICAgIH0gZWxzZSBpZiAoUmFuZ2UuaXNFeHBhbmRlZChhdCkgJiYgUG9pbnQuZXF1YWxzKHNlbGVjdGlvblN0YXJ0UG9pbnQsIGVuZEJsb2NrU3RhcnRQb2ludCkgJiYgUG9pbnQuZXF1YWxzKHNlbGVjdGlvbkVuZFBvaW50LCBlbmRCbG9ja0VuZFBvaW50MikpXG4gICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0RnJhZ21lbnQoZWRpdG9yLCBbYmxvY2tdLCB7XG4gICAgICAgICAgYXRcbiAgICAgICAgfSksIHNlbGVjdCA9PT0gXCJzdGFydFwiID8gVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpKSA6IHNlbGVjdCA9PT0gXCJlbmRcIiAmJiBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5lbmQoZWRpdG9yLCBlbmRCbG9ja1BhdGgpKTtcbiAgICAgIGVsc2UgaWYgKFJhbmdlLmlzRXhwYW5kZWQoYXQpICYmIFBvaW50LmVxdWFscyhzZWxlY3Rpb25TdGFydFBvaW50LCBlbmRCbG9ja1N0YXJ0UG9pbnQpKVxuICAgICAgICBUcmFuc2Zvcm1zLmluc2VydEZyYWdtZW50KGVkaXRvciwgW2Jsb2NrXSwge1xuICAgICAgICAgIGF0XG4gICAgICAgIH0pLCBzZWxlY3QgPT09IFwic3RhcnRcIiA/IFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLnN0YXJ0KGVkaXRvciwgZW5kQmxvY2tQYXRoKSkgOiBzZWxlY3QgPT09IFwiZW5kXCIgJiYgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3IuZW5kKGVkaXRvciwgZW5kQmxvY2tQYXRoKSk7XG4gICAgICBlbHNlIGlmIChSYW5nZS5pc0V4cGFuZGVkKGF0KSAmJiBQb2ludC5lcXVhbHMoc2VsZWN0aW9uRW5kUG9pbnQsIGVuZEJsb2NrRW5kUG9pbnQyKSlcbiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnRGcmFnbWVudChlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgICBhdFxuICAgICAgICB9KSwgc2VsZWN0ID09PSBcInN0YXJ0XCIgPyBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIEVkaXRvci5zdGFydChlZGl0b3IsIFBhdGgubmV4dChlbmRCbG9ja1BhdGgpKSkgOiBzZWxlY3QgPT09IFwiZW5kXCIgJiYgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3IuZW5kKGVkaXRvciwgUGF0aC5uZXh0KGVuZEJsb2NrUGF0aCkpKTtcbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBbZm9jdXNDaGlsZF0gPSBnZXRGb2N1c0NoaWxkKHtcbiAgICAgICAgICBlZGl0b3JcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChmb2N1c0NoaWxkICYmIGVkaXRvci5pc1RleHRTcGFuKGZvY3VzQ2hpbGQpKVxuICAgICAgICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgIGF0XG4gICAgICAgICAgfSksIFRyYW5zZm9ybXMuaW5zZXJ0RnJhZ21lbnQoZWRpdG9yLCBbYmxvY2tdLCB7XG4gICAgICAgICAgICBhdFxuICAgICAgICAgIH0pLCBzZWxlY3QgPT09IFwic3RhcnRcIiB8fCBzZWxlY3QgPT09IFwiZW5kXCIgPyBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIFtlbmRCbG9ja1BhdGhbMF0gKyAxXSkgOiBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIGF0KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgY29uc3QgbmV4dFBhdGggPSBbZW5kQmxvY2tQYXRoWzBdICsgMV07XG4gICAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgICAgIGF0OiBuZXh0UGF0aCxcbiAgICAgICAgICAgIHNlbGVjdDogITFcbiAgICAgICAgICB9KSwgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBhdCksIHNlbGVjdCA9PT0gXCJzdGFydFwiID8gVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBuZXh0UGF0aCkpIDogc2VsZWN0ID09PSBcImVuZFwiICYmIFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLmVuZChlZGl0b3IsIG5leHRQYXRoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIFtibG9ja10sIHtcbiAgICAgICAgc2VsZWN0OiAhMVxuICAgICAgfSk7XG4gICAgICBjb25zdCBuZXh0UGF0aCA9IFtlbmRCbG9ja1BhdGhbMF0gKyAxXTtcbiAgICAgIHNlbGVjdCA9PT0gXCJzdGFydFwiID8gVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBuZXh0UGF0aCkpIDogc2VsZWN0ID09PSBcImVuZFwiICYmIFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgRWRpdG9yLmVuZChlZGl0b3IsIG5leHRQYXRoKSk7XG4gICAgfVxuICB9XG59XG5jb25zdCBpbnNlcnRDaGlsZE9wZXJhdGlvbkltcGxlbWVudGF0aW9uID0gKHtcbiAgY29udGV4dCxcbiAgb3BlcmF0aW9uXG59KSA9PiB7XG4gIGNvbnN0IGZvY3VzID0gb3BlcmF0aW9uLmVkaXRvci5zZWxlY3Rpb24/LmZvY3VzLCBmb2N1c0Jsb2NrSW5kZXggPSBmb2N1cz8ucGF0aC5hdCgwKSwgZm9jdXNDaGlsZEluZGV4ID0gZm9jdXM/LnBhdGguYXQoMSk7XG4gIGlmIChmb2N1c0Jsb2NrSW5kZXggPT09IHZvaWQgMCB8fCBmb2N1c0NoaWxkSW5kZXggPT09IHZvaWQgMClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gaW5zZXJ0IGNoaWxkIHdpdGhvdXQgYSBmb2N1c1wiKTtcbiAgY29uc3QgW2ZvY3VzQmxvY2ssIGZvY3VzQmxvY2tQYXRoXSA9IGdldEZvY3VzQmxvY2soe1xuICAgIGVkaXRvcjogb3BlcmF0aW9uLmVkaXRvclxuICB9KTtcbiAgaWYgKCFmb2N1cyB8fCAhZm9jdXNCbG9jayB8fCAhZm9jdXNCbG9ja1BhdGgpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGluc2VydCBjaGlsZCB3aXRob3V0IGEgZm9jdXMgYmxvY2tcIik7XG4gIGlmICghaXNUZXh0QmxvY2soY29udGV4dCwgZm9jdXNCbG9jaykpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGluc2VydCBjaGlsZCBpbnRvIGEgbm9uLXRleHQgYmxvY2tcIik7XG4gIGNvbnN0IG1hcmtEZWZzID0gZm9jdXNCbG9jay5tYXJrRGVmcyA/PyBbXSwgbWFya0RlZktleU1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGZvciAoY29uc3QgbWFya0RlZiBvZiBtYXJrRGVmcylcbiAgICBtYXJrRGVmS2V5TWFwLnNldChtYXJrRGVmLl9rZXksIG1hcmtEZWYuX2tleSk7XG4gIGNvbnN0IHNwYW4gPSBwYXJzZVNwYW4oe1xuICAgIHNwYW46IG9wZXJhdGlvbi5jaGlsZCxcbiAgICBjb250ZXh0LFxuICAgIG1hcmtEZWZLZXlNYXAsXG4gICAgb3B0aW9uczoge1xuICAgICAgdmFsaWRhdGVGaWVsZHM6ICEwXG4gICAgfVxuICB9KTtcbiAgaWYgKHNwYW4pIHtcbiAgICBjb25zdCBbZm9jdXNTcGFuXSA9IGdldEZvY3VzU3Bhbih7XG4gICAgICBlZGl0b3I6IG9wZXJhdGlvbi5lZGl0b3JcbiAgICB9KTtcbiAgICBmb2N1c1NwYW4gPyBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHNwYW4sIHtcbiAgICAgIGF0OiBmb2N1cyxcbiAgICAgIHNlbGVjdDogITBcbiAgICB9KSA6IFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMob3BlcmF0aW9uLmVkaXRvciwgc3Bhbiwge1xuICAgICAgYXQ6IFtmb2N1c0Jsb2NrSW5kZXgsIGZvY3VzQ2hpbGRJbmRleCArIDFdLFxuICAgICAgc2VsZWN0OiAhMFxuICAgIH0pLCBFRElUT1JfVE9fUEVORElOR19TRUxFQ1RJT04uc2V0KG9wZXJhdGlvbi5lZGl0b3IsIG9wZXJhdGlvbi5lZGl0b3Iuc2VsZWN0aW9uKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaW5saW5lT2JqZWN0ID0gcGFyc2VJbmxpbmVPYmplY3Qoe1xuICAgIGlubGluZU9iamVjdDogb3BlcmF0aW9uLmNoaWxkLFxuICAgIGNvbnRleHQsXG4gICAgb3B0aW9uczoge1xuICAgICAgdmFsaWRhdGVGaWVsZHM6ICEwXG4gICAgfVxuICB9KTtcbiAgaWYgKGlubGluZU9iamVjdCkge1xuICAgIGNvbnN0IHtcbiAgICAgIF9rZXksXG4gICAgICBfdHlwZSxcbiAgICAgIC4uLnJlc3RcbiAgICB9ID0gaW5saW5lT2JqZWN0LCBbZm9jdXNTcGFuXSA9IGdldEZvY3VzU3Bhbih7XG4gICAgICBlZGl0b3I6IG9wZXJhdGlvbi5lZGl0b3JcbiAgICB9KTtcbiAgICBmb2N1c1NwYW4gPyBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIF9rZXksXG4gICAgICBfdHlwZSxcbiAgICAgIGNoaWxkcmVuOiBbe1xuICAgICAgICBfa2V5OiBWT0lEX0NISUxEX0tFWSxcbiAgICAgICAgX3R5cGU6IFwic3BhblwiLFxuICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICBtYXJrczogW11cbiAgICAgIH1dLFxuICAgICAgdmFsdWU6IHJlc3QsXG4gICAgICBfX2lubGluZTogITBcbiAgICB9LCB7XG4gICAgICBhdDogZm9jdXMsXG4gICAgICBzZWxlY3Q6ICEwXG4gICAgfSkgOiBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICAgIF9rZXksXG4gICAgICBfdHlwZSxcbiAgICAgIGNoaWxkcmVuOiBbe1xuICAgICAgICBfa2V5OiBWT0lEX0NISUxEX0tFWSxcbiAgICAgICAgX3R5cGU6IFwic3BhblwiLFxuICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICBtYXJrczogW11cbiAgICAgIH1dLFxuICAgICAgdmFsdWU6IHJlc3QsXG4gICAgICBfX2lubGluZTogITBcbiAgICB9LCB7XG4gICAgICBhdDogW2ZvY3VzQmxvY2tJbmRleCwgZm9jdXNDaGlsZEluZGV4ICsgMV0sXG4gICAgICBzZWxlY3Q6ICEwXG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBwYXJzZSBjaGlsZFwiKTtcbn0sIGluc2VydFRleHRPcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBUcmFuc2Zvcm1zLmluc2VydFRleHQob3BlcmF0aW9uLmVkaXRvciwgb3BlcmF0aW9uLnRleHQpO1xufSwgbW92ZUJhY2t3YXJkT3BlcmF0aW9uSW1wbGVtZW50YXRpb24gPSAoe1xuICBvcGVyYXRpb25cbn0pID0+IHtcbiAgVHJhbnNmb3Jtcy5tb3ZlKG9wZXJhdGlvbi5lZGl0b3IsIHtcbiAgICB1bml0OiBcImNoYXJhY3RlclwiLFxuICAgIGRpc3RhbmNlOiBvcGVyYXRpb24uZGlzdGFuY2UsXG4gICAgcmV2ZXJzZTogITBcbiAgfSk7XG59LCBtb3ZlQmxvY2tPcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBjb25zdCBvcmlnaW5LZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludCh7XG4gICAgcGF0aDogb3BlcmF0aW9uLmF0XG4gIH0pO1xuICBpZiAoIW9yaWdpbktleSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IGJsb2NrIGtleSBmcm9tIHNlbGVjdGlvbiBwb2ludFwiKTtcbiAgY29uc3Qgb3JpZ2luQmxvY2tJbmRleCA9IG9wZXJhdGlvbi5lZGl0b3IuYmxvY2tJbmRleE1hcC5nZXQob3JpZ2luS2V5KTtcbiAgaWYgKG9yaWdpbkJsb2NrSW5kZXggPT09IHZvaWQgMClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IGJsb2NrIGluZGV4IGZyb20gYmxvY2sga2V5XCIpO1xuICBjb25zdCBkZXN0aW5hdGlvbktleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHtcbiAgICBwYXRoOiBvcGVyYXRpb24udG9cbiAgfSk7XG4gIGlmICghZGVzdGluYXRpb25LZXkpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCBibG9jayBrZXkgZnJvbSBzZWxlY3Rpb24gcG9pbnRcIik7XG4gIGNvbnN0IGRlc3RpbmF0aW9uQmxvY2tJbmRleCA9IG9wZXJhdGlvbi5lZGl0b3IuYmxvY2tJbmRleE1hcC5nZXQoZGVzdGluYXRpb25LZXkpO1xuICBpZiAoZGVzdGluYXRpb25CbG9ja0luZGV4ID09PSB2b2lkIDApXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCBibG9jayBpbmRleCBmcm9tIGJsb2NrIGtleVwiKTtcbiAgVHJhbnNmb3Jtcy5tb3ZlTm9kZXMob3BlcmF0aW9uLmVkaXRvciwge1xuICAgIGF0OiBbb3JpZ2luQmxvY2tJbmRleF0sXG4gICAgdG86IFtkZXN0aW5hdGlvbkJsb2NrSW5kZXhdLFxuICAgIG1vZGU6IFwiaGlnaGVzdFwiXG4gIH0pO1xufSwgbW92ZUZvcndhcmRPcGVyYXRpb25JbXBsZW1lbnRhdGlvbiA9ICh7XG4gIG9wZXJhdGlvblxufSkgPT4ge1xuICBUcmFuc2Zvcm1zLm1vdmUob3BlcmF0aW9uLmVkaXRvciwge1xuICAgIHVuaXQ6IFwiY2hhcmFjdGVyXCIsXG4gICAgZGlzdGFuY2U6IG9wZXJhdGlvbi5kaXN0YW5jZVxuICB9KTtcbn0sIHNlbGVjdE9wZXJhdGlvbkltcGxlbWVudGF0aW9uID0gKHtcbiAgY29udGV4dCxcbiAgb3BlcmF0aW9uXG59KSA9PiB7XG4gIGNvbnN0IG5ld1NlbGVjdGlvbiA9IHRvU2xhdGVSYW5nZSh7XG4gICAgY29udGV4dDoge1xuICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYSxcbiAgICAgIHZhbHVlOiBvcGVyYXRpb24uZWRpdG9yLnZhbHVlLFxuICAgICAgc2VsZWN0aW9uOiBvcGVyYXRpb24uYXRcbiAgICB9LFxuICAgIGJsb2NrSW5kZXhNYXA6IG9wZXJhdGlvbi5lZGl0b3IuYmxvY2tJbmRleE1hcFxuICB9KTtcbiAgbmV3U2VsZWN0aW9uID8gVHJhbnNmb3Jtcy5zZWxlY3Qob3BlcmF0aW9uLmVkaXRvciwgbmV3U2VsZWN0aW9uKSA6IFRyYW5zZm9ybXMuZGVzZWxlY3Qob3BlcmF0aW9uLmVkaXRvciksIElTX0ZPQ1VTRUQuZ2V0KG9wZXJhdGlvbi5lZGl0b3IpICYmIElTX1JFQURfT05MWS5nZXQob3BlcmF0aW9uLmVkaXRvcikgJiYgSVNfRk9DVVNFRC5zZXQob3BlcmF0aW9uLmVkaXRvciwgITEpO1xufSwgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnMgPSB7XG4gIFwiYW5ub3RhdGlvbi5hZGRcIjogYWRkQW5ub3RhdGlvbk9wZXJhdGlvbkltcGxlbWVudGF0aW9uLFxuICBcImFubm90YXRpb24ucmVtb3ZlXCI6IHJlbW92ZUFubm90YXRpb25PcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJibG9jay5zZXRcIjogYmxvY2tTZXRPcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJibG9jay51bnNldFwiOiBibG9ja1Vuc2V0T3BlcmF0aW9uSW1wbGVtZW50YXRpb24sXG4gIFwiY2hpbGQuc2V0XCI6IGNoaWxkU2V0T3BlcmF0aW9uSW1wbGVtZW50YXRpb24sXG4gIFwiY2hpbGQudW5zZXRcIjogY2hpbGRVbnNldE9wZXJhdGlvbkltcGxlbWVudGF0aW9uLFxuICBcImRlY29yYXRvci5hZGRcIjogZGVjb3JhdG9yQWRkT3BlcmF0aW9uSW1wbGVtZW50YXRpb24sXG4gIFwiZGVjb3JhdG9yLnJlbW92ZVwiOiBkZWNvcmF0b3JSZW1vdmVPcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgZGVsZXRlOiBkZWxldGVPcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJoaXN0b3J5LnJlZG9cIjogaGlzdG9yeVJlZG9PcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJoaXN0b3J5LnVuZG9cIjogaGlzdG9yeVVuZG9PcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJpbnNlcnQuYmxvY2tcIjogaW5zZXJ0QmxvY2tPcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJpbnNlcnQuY2hpbGRcIjogaW5zZXJ0Q2hpbGRPcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJpbnNlcnQudGV4dFwiOiBpbnNlcnRUZXh0T3BlcmF0aW9uSW1wbGVtZW50YXRpb24sXG4gIFwibW92ZS5iYWNrd2FyZFwiOiBtb3ZlQmFja3dhcmRPcGVyYXRpb25JbXBsZW1lbnRhdGlvbixcbiAgXCJtb3ZlLmJsb2NrXCI6IG1vdmVCbG9ja09wZXJhdGlvbkltcGxlbWVudGF0aW9uLFxuICBcIm1vdmUuZm9yd2FyZFwiOiBtb3ZlRm9yd2FyZE9wZXJhdGlvbkltcGxlbWVudGF0aW9uLFxuICBzZWxlY3Q6IHNlbGVjdE9wZXJhdGlvbkltcGxlbWVudGF0aW9uXG59O1xuZnVuY3Rpb24gcGVyZm9ybU9wZXJhdGlvbih7XG4gIGNvbnRleHQsXG4gIG9wZXJhdGlvblxufSkge1xuICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKG9wZXJhdGlvbi5lZGl0b3IsICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgc3dpdGNoIChvcGVyYXRpb24udHlwZSkge1xuICAgICAgICBjYXNlIFwiYW5ub3RhdGlvbi5hZGRcIjoge1xuICAgICAgICAgIGJlaGF2aW9yT3BlcmF0aW9uSW1wbGVtZW50YXRpb25zW1wiYW5ub3RhdGlvbi5hZGRcIl0oe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIG9wZXJhdGlvblxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJhbm5vdGF0aW9uLnJlbW92ZVwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJhbm5vdGF0aW9uLnJlbW92ZVwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImJsb2NrLnNldFwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJibG9jay5zZXRcIl0oe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIG9wZXJhdGlvblxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJibG9jay51bnNldFwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJibG9jay51bnNldFwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNoaWxkLnNldFwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJjaGlsZC5zZXRcIl0oe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIG9wZXJhdGlvblxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJjaGlsZC51bnNldFwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJjaGlsZC51bnNldFwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImRlY29yYXRvci5hZGRcIjoge1xuICAgICAgICAgIGJlaGF2aW9yT3BlcmF0aW9uSW1wbGVtZW50YXRpb25zW1wiZGVjb3JhdG9yLmFkZFwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImRlY29yYXRvci5yZW1vdmVcIjoge1xuICAgICAgICAgIGJlaGF2aW9yT3BlcmF0aW9uSW1wbGVtZW50YXRpb25zW1wiZGVjb3JhdG9yLnJlbW92ZVwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImRlbGV0ZVwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnMuZGVsZXRlKHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICBvcGVyYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlzdG9yeS5yZWRvXCI6IHtcbiAgICAgICAgICBiZWhhdmlvck9wZXJhdGlvbkltcGxlbWVudGF0aW9uc1tcImhpc3RvcnkucmVkb1wiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImhpc3RvcnkudW5kb1wiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJoaXN0b3J5LnVuZG9cIl0oe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIG9wZXJhdGlvblxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJpbnNlcnQuYmxvY2tcIjoge1xuICAgICAgICAgIGJlaGF2aW9yT3BlcmF0aW9uSW1wbGVtZW50YXRpb25zW1wiaW5zZXJ0LmJsb2NrXCJdKHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICBvcGVyYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaW5zZXJ0LmNoaWxkXCI6IHtcbiAgICAgICAgICBiZWhhdmlvck9wZXJhdGlvbkltcGxlbWVudGF0aW9uc1tcImluc2VydC5jaGlsZFwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImluc2VydC50ZXh0XCI6IHtcbiAgICAgICAgICBiZWhhdmlvck9wZXJhdGlvbkltcGxlbWVudGF0aW9uc1tcImluc2VydC50ZXh0XCJdKHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICBvcGVyYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwibW92ZS5iYWNrd2FyZFwiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJtb3ZlLmJhY2t3YXJkXCJdKHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICBvcGVyYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwibW92ZS5ibG9ja1wiOiB7XG4gICAgICAgICAgYmVoYXZpb3JPcGVyYXRpb25JbXBsZW1lbnRhdGlvbnNbXCJtb3ZlLmJsb2NrXCJdKHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICBvcGVyYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwibW92ZS5mb3J3YXJkXCI6IHtcbiAgICAgICAgICBiZWhhdmlvck9wZXJhdGlvbkltcGxlbWVudGF0aW9uc1tcIm1vdmUuZm9yd2FyZFwiXSh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGJlaGF2aW9yT3BlcmF0aW9uSW1wbGVtZW50YXRpb25zLnNlbGVjdCh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihuZXcgRXJyb3IoYEV4ZWN1dGluZyBcIiR7b3BlcmF0aW9uLnR5cGV9XCIgZmFpbGVkIGR1ZSB0bzogJHtlcnJvci5tZXNzYWdlfWApKTtcbiAgICB9XG4gIH0pO1xufVxuZnVuY3Rpb24gY3JlYXRlV2l0aEV2ZW50TGlzdGVuZXJzKGVkaXRvckFjdG9yKSB7XG4gIHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICBjb25zdCB7XG4gICAgICBkZWxldGU6IGVkaXRvckRlbGV0ZSxcbiAgICAgIGluc2VydE5vZGVzLFxuICAgICAgc2VsZWN0LFxuICAgICAgc2V0U2VsZWN0aW9uXG4gICAgfSA9IGVkaXRvcjtcbiAgICByZXR1cm4gZWRpdG9yLmRlbGV0ZSA9IChvcHRpb25zKSA9PiB7XG4gICAgICBpZiAoZWRpdG9yLmlzUGVyZm9ybWluZ0JlaGF2aW9yT3BlcmF0aW9uKSB7XG4gICAgICAgIGVkaXRvckRlbGV0ZShvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgcmFuZ2UgPSBvcHRpb25zPy5hdCA/IEVkaXRvci5yYW5nZShlZGl0b3IsIG9wdGlvbnMuYXQpIDogdm9pZCAwLCBzZWxlY3Rpb24gPSByYW5nZSA/IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgZWRpdG9yLFxuICAgICAgICByYW5nZVxuICAgICAgfSkgOiB2b2lkIDA7XG4gICAgICBzZWxlY3Rpb24gPyBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgICAgICBhdDogc2VsZWN0aW9uLFxuICAgICAgICAgIGRpcmVjdGlvbjogb3B0aW9ucz8ucmV2ZXJzZSA/IFwiYmFja3dhcmRcIiA6IFwiZm9yd2FyZFwiLFxuICAgICAgICAgIHVuaXQ6IG9wdGlvbnM/LnVuaXRcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KSA6IGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRlbGV0ZVwiLFxuICAgICAgICAgIGRpcmVjdGlvbjogb3B0aW9ucz8ucmV2ZXJzZSA/IFwiYmFja3dhcmRcIiA6IFwiZm9yd2FyZFwiLFxuICAgICAgICAgIHVuaXQ6IG9wdGlvbnM/LnVuaXRcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LCBlZGl0b3IuZGVsZXRlQmFja3dhcmQgPSAodW5pdCkgPT4ge1xuICAgICAgaWYgKGVkaXRvci5pc1BlcmZvcm1pbmdCZWhhdmlvck9wZXJhdGlvbikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVW5leHBlY3RlZCBjYWxsIHRvIC5kZWxldGVCYWNrd2FyZCguLi4pXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkZWxldGUuYmFja3dhcmRcIixcbiAgICAgICAgICB1bml0XG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvclxuICAgICAgfSk7XG4gICAgfSwgZWRpdG9yLmRlbGV0ZUZvcndhcmQgPSAodW5pdCkgPT4ge1xuICAgICAgaWYgKGVkaXRvci5pc1BlcmZvcm1pbmdCZWhhdmlvck9wZXJhdGlvbikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVW5leHBlY3RlZCBjYWxsIHRvIC5kZWxldGVGb3J3YXJkKC4uLilcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRlbGV0ZS5mb3J3YXJkXCIsXG4gICAgICAgICAgdW5pdFxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3JcbiAgICAgIH0pO1xuICAgIH0sIGVkaXRvci5pbnNlcnRCcmVhayA9ICgpID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuZXhwZWN0ZWQgY2FsbCB0byAuaW5zZXJ0QnJlYWsoLi4uKVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiaW5zZXJ0LmJyZWFrXCJcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LCBlZGl0b3IuaW5zZXJ0RGF0YSA9IChkYXRhVHJhbnNmZXIpID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuZXhwZWN0ZWQgY2FsbCB0byAuaW5zZXJ0RGF0YSguLi4pXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJpbnB1dC4qXCIsXG4gICAgICAgICAgb3JpZ2luRXZlbnQ6IHtcbiAgICAgICAgICAgIGRhdGFUcmFuc2ZlclxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LCBlZGl0b3IuaW5zZXJ0Tm9kZXMgPSAobm9kZXMsIG9wdGlvbnMpID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNOb3JtYWxpemluZ05vZGUpIHtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZE5vZGVzID0gKE5vZGUuaXNOb2RlKG5vZGVzKSA/IFtub2Rlc10gOiBub2RlcykubWFwKChub2RlKSA9PiBUZXh0LmlzVGV4dChub2RlKSAmJiB0eXBlb2Ygbm9kZS5fdHlwZSAhPSBcInN0cmluZ1wiID8ge1xuICAgICAgICAgIC4uLm5vZGUsXG4gICAgICAgICAgX3R5cGU6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lXG4gICAgICAgIH0gOiBub2RlKTtcbiAgICAgICAgaW5zZXJ0Tm9kZXMobm9ybWFsaXplZE5vZGVzLCBvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW5zZXJ0Tm9kZXMobm9kZXMsIG9wdGlvbnMpO1xuICAgIH0sIGVkaXRvci5pbnNlcnRTb2Z0QnJlYWsgPSAoKSA9PiB7XG4gICAgICBpZiAoZWRpdG9yLmlzUGVyZm9ybWluZ0JlaGF2aW9yT3BlcmF0aW9uKSB7XG4gICAgICAgIHBlcmZvcm1PcGVyYXRpb24oe1xuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIGtleUdlbmVyYXRvcjogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmtleUdlbmVyYXRvcixcbiAgICAgICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYVxuICAgICAgICAgIH0sXG4gICAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgICB0eXBlOiBcImluc2VydC50ZXh0XCIsXG4gICAgICAgICAgICB0ZXh0OiBgXG5gLFxuICAgICAgICAgICAgZWRpdG9yXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiaW5zZXJ0LnNvZnQgYnJlYWtcIlxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3JcbiAgICAgIH0pO1xuICAgIH0sIGVkaXRvci5pbnNlcnRUZXh0ID0gKHRleHQpID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24pIHtcbiAgICAgICAgcGVyZm9ybU9wZXJhdGlvbih7XG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQua2V5R2VuZXJhdG9yLFxuICAgICAgICAgICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcGVyYXRpb246IHtcbiAgICAgICAgICAgIHR5cGU6IFwiaW5zZXJ0LnRleHRcIixcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICBlZGl0b3JcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJpbnNlcnQudGV4dFwiLFxuICAgICAgICAgIHRleHRcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LCBlZGl0b3IucmVkbyA9ICgpID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24pIHtcbiAgICAgICAgcGVyZm9ybU9wZXJhdGlvbih7XG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQua2V5R2VuZXJhdG9yLFxuICAgICAgICAgICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcGVyYXRpb246IHtcbiAgICAgICAgICAgIHR5cGU6IFwiaGlzdG9yeS5yZWRvXCIsXG4gICAgICAgICAgICBlZGl0b3JcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJoaXN0b3J5LnJlZG9cIlxuICAgICAgICB9LFxuICAgICAgICBlZGl0b3JcbiAgICAgIH0pO1xuICAgIH0sIGVkaXRvci5zZWxlY3QgPSAobG9jYXRpb24pID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24pIHtcbiAgICAgICAgc2VsZWN0KGxvY2F0aW9uKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5zZWxlY3Rpb24pIHtcbiAgICAgICAgc2VsZWN0KGxvY2F0aW9uKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgcmFuZ2UgPSBFZGl0b3IucmFuZ2UoZWRpdG9yLCBsb2NhdGlvbik7XG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJiZWhhdmlvciBldmVudFwiLFxuICAgICAgICBiZWhhdmlvckV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgICBhdDogc2xhdGVSYW5nZVRvU2VsZWN0aW9uKHtcbiAgICAgICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICAgIHJhbmdlXG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9KTtcbiAgICB9LCBlZGl0b3Iuc2V0U2VsZWN0aW9uID0gKHBhcnRpYWxSYW5nZSkgPT4ge1xuICAgICAgaWYgKGVkaXRvci5pc1BlcmZvcm1pbmdCZWhhdmlvck9wZXJhdGlvbikge1xuICAgICAgICBzZXRTZWxlY3Rpb24ocGFydGlhbFJhbmdlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgYW5jaG9yID0gcGFydGlhbFJhbmdlLmFuY2hvciA/IHNsYXRlUG9pbnRUb1NlbGVjdGlvblBvaW50KHtcbiAgICAgICAgc2NoZW1hOiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLFxuICAgICAgICBlZGl0b3IsXG4gICAgICAgIHBvaW50OiBwYXJ0aWFsUmFuZ2UuYW5jaG9yXG4gICAgICB9KSA6IHZvaWQgMCwgZm9jdXMgPSBwYXJ0aWFsUmFuZ2UuZm9jdXMgPyBzbGF0ZVBvaW50VG9TZWxlY3Rpb25Qb2ludCh7XG4gICAgICAgIHNjaGVtYTogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgZWRpdG9yLFxuICAgICAgICBwb2ludDogcGFydGlhbFJhbmdlLmZvY3VzXG4gICAgICB9KSA6IHZvaWQgMCwgYmFja3dhcmQgPSBlZGl0b3Iuc2VsZWN0aW9uID8gUmFuZ2UuaXNCYWNrd2FyZCh7XG4gICAgICAgIGFuY2hvcjogcGFydGlhbFJhbmdlLmFuY2hvciA/PyBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvcixcbiAgICAgICAgZm9jdXM6IHBhcnRpYWxSYW5nZS5mb2N1cyA/PyBlZGl0b3Iuc2VsZWN0aW9uLmZvY3VzXG4gICAgICB9KSA6IHBhcnRpYWxSYW5nZS5hbmNob3IgJiYgcGFydGlhbFJhbmdlLmZvY3VzID8gUmFuZ2UuaXNCYWNrd2FyZCh7XG4gICAgICAgIGFuY2hvcjogcGFydGlhbFJhbmdlLmFuY2hvcixcbiAgICAgICAgZm9jdXM6IHBhcnRpYWxSYW5nZS5mb2N1c1xuICAgICAgfSkgOiB2b2lkIDA7XG4gICAgICBpZiAoZWRpdG9yLnNlbGVjdGlvbikge1xuICAgICAgICBjb25zdCBuZXdBbmNob3IgPSBwYXJ0aWFsUmFuZ2UuYW5jaG9yID8/IGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLCBuZXdGb2N1cyA9IHBhcnRpYWxSYW5nZS5mb2N1cyA/PyBlZGl0b3Iuc2VsZWN0aW9uLmZvY3VzO1xuICAgICAgICBpZiAoUG9pbnQuZXF1YWxzKG5ld0FuY2hvciwgZWRpdG9yLnNlbGVjdGlvbi5hbmNob3IpICYmIFBvaW50LmVxdWFscyhuZXdGb2N1cywgZWRpdG9yLnNlbGVjdGlvbi5mb2N1cykpIHtcbiAgICAgICAgICBzZXRTZWxlY3Rpb24ocGFydGlhbFJhbmdlKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghYW5jaG9yIHx8ICFmb2N1cykge1xuICAgICAgICBzZXRTZWxlY3Rpb24ocGFydGlhbFJhbmdlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICAgICAgYXQ6IHtcbiAgICAgICAgICAgIGFuY2hvcixcbiAgICAgICAgICAgIGZvY3VzLFxuICAgICAgICAgICAgYmFja3dhcmRcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvclxuICAgICAgfSk7XG4gICAgfSwgZWRpdG9yLnNldEZyYWdtZW50RGF0YSA9ICgpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmV4cGVjdGVkIGNhbGwgdG8gLnNldEZyYWdtZW50RGF0YSguLi4pXCIpO1xuICAgIH0sIGVkaXRvci51bmRvID0gKCkgPT4ge1xuICAgICAgaWYgKGVkaXRvci5pc1BlcmZvcm1pbmdCZWhhdmlvck9wZXJhdGlvbikge1xuICAgICAgICBwZXJmb3JtT3BlcmF0aW9uKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5rZXlHZW5lcmF0b3IsXG4gICAgICAgICAgICBzY2hlbWE6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWFcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wZXJhdGlvbjoge1xuICAgICAgICAgICAgdHlwZTogXCJoaXN0b3J5LnVuZG9cIixcbiAgICAgICAgICAgIGVkaXRvclxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcImJlaGF2aW9yIGV2ZW50XCIsXG4gICAgICAgIGJlaGF2aW9yRXZlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcImhpc3RvcnkudW5kb1wiXG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvclxuICAgICAgfSk7XG4gICAgfSwgZWRpdG9yO1xuICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlVW5kb1N0ZXBzKHtcbiAgc3RlcHMsXG4gIG9wLFxuICBlZGl0b3IsXG4gIGN1cnJlbnRVbmRvU3RlcElkLFxuICBwcmV2aW91c1VuZG9TdGVwSWRcbn0pIHtcbiAgY29uc3QgbGFzdFN0ZXAgPSBzdGVwcy5hdCgtMSk7XG4gIGlmICghbGFzdFN0ZXApXG4gICAgcmV0dXJuIGNyZWF0ZU5ld1N0ZXAoc3RlcHMsIG9wLCBlZGl0b3IpO1xuICBpZiAoZWRpdG9yLm9wZXJhdGlvbnMubGVuZ3RoID4gMClcbiAgICByZXR1cm4gY3VycmVudFVuZG9TdGVwSWQgPT09IHByZXZpb3VzVW5kb1N0ZXBJZCB8fCBlZGl0b3IuaXNOb3JtYWxpemluZ05vZGUgPyBtZXJnZUludG9MYXN0U3RlcChzdGVwcywgbGFzdFN0ZXAsIG9wKSA6IGNyZWF0ZU5ld1N0ZXAoc3RlcHMsIG9wLCBlZGl0b3IpO1xuICBpZiAob3AudHlwZSA9PT0gXCJzZXRfc2VsZWN0aW9uXCIgJiYgY3VycmVudFVuZG9TdGVwSWQgPT09IHZvaWQgMCAmJiBwcmV2aW91c1VuZG9TdGVwSWQgIT09IHZvaWQgMCB8fCBvcC50eXBlID09PSBcInNldF9zZWxlY3Rpb25cIiAmJiBjdXJyZW50VW5kb1N0ZXBJZCAhPT0gdm9pZCAwICYmIHByZXZpb3VzVW5kb1N0ZXBJZCAhPT0gdm9pZCAwICYmIHByZXZpb3VzVW5kb1N0ZXBJZCAhPT0gY3VycmVudFVuZG9TdGVwSWQpXG4gICAgcmV0dXJuIG1lcmdlSW50b0xhc3RTdGVwKHN0ZXBzLCBsYXN0U3RlcCwgb3ApO1xuICBpZiAoY3VycmVudFVuZG9TdGVwSWQgPT09IHZvaWQgMCAmJiBwcmV2aW91c1VuZG9TdGVwSWQgPT09IHZvaWQgMCkge1xuICAgIGlmIChvcC50eXBlID09PSBcInNldF9zZWxlY3Rpb25cIilcbiAgICAgIHJldHVybiBtZXJnZUludG9MYXN0U3RlcChzdGVwcywgbGFzdFN0ZXAsIG9wKTtcbiAgICBjb25zdCBsYXN0T3AgPSBsYXN0U3RlcC5vcGVyYXRpb25zLmF0KC0xKTtcbiAgICByZXR1cm4gbGFzdE9wICYmIG9wLnR5cGUgPT09IFwiaW5zZXJ0X3RleHRcIiAmJiBsYXN0T3AudHlwZSA9PT0gXCJpbnNlcnRfdGV4dFwiICYmIG9wLm9mZnNldCA9PT0gbGFzdE9wLm9mZnNldCArIGxhc3RPcC50ZXh0Lmxlbmd0aCAmJiBQYXRoLmVxdWFscyhvcC5wYXRoLCBsYXN0T3AucGF0aCkgJiYgb3AudGV4dCAhPT0gXCIgXCIgfHwgbGFzdE9wICYmIG9wLnR5cGUgPT09IFwicmVtb3ZlX3RleHRcIiAmJiBsYXN0T3AudHlwZSA9PT0gXCJyZW1vdmVfdGV4dFwiICYmIG9wLm9mZnNldCArIG9wLnRleHQubGVuZ3RoID09PSBsYXN0T3Aub2Zmc2V0ICYmIFBhdGguZXF1YWxzKG9wLnBhdGgsIGxhc3RPcC5wYXRoKSA/IG1lcmdlSW50b0xhc3RTdGVwKHN0ZXBzLCBsYXN0U3RlcCwgb3ApIDogY3JlYXRlTmV3U3RlcChzdGVwcywgb3AsIGVkaXRvcik7XG4gIH1cbiAgcmV0dXJuIGNyZWF0ZU5ld1N0ZXAoc3RlcHMsIG9wLCBlZGl0b3IpO1xufVxuZnVuY3Rpb24gY3JlYXRlTmV3U3RlcChzdGVwcywgb3AsIGVkaXRvcikge1xuICBjb25zdCBvcGVyYXRpb25zID0gZWRpdG9yLnNlbGVjdGlvbiA9PT0gbnVsbCA/IFtvcF0gOiBbe1xuICAgIHR5cGU6IFwic2V0X3NlbGVjdGlvblwiLFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgIC4uLmVkaXRvci5zZWxlY3Rpb25cbiAgICB9LFxuICAgIG5ld1Byb3BlcnRpZXM6IHtcbiAgICAgIC4uLmVkaXRvci5zZWxlY3Rpb25cbiAgICB9XG4gIH0sIG9wXTtcbiAgcmV0dXJuIFsuLi5zdGVwcywge1xuICAgIG9wZXJhdGlvbnMsXG4gICAgdGltZXN0YW1wOiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKVxuICB9XTtcbn1cbmZ1bmN0aW9uIG1lcmdlSW50b0xhc3RTdGVwKHN0ZXBzLCBsYXN0U3RlcCwgb3ApIHtcbiAgcmV0dXJuIFsuLi5zdGVwcy5zbGljZSgwLCAtMSksIHtcbiAgICB0aW1lc3RhbXA6IGxhc3RTdGVwLnRpbWVzdGFtcCxcbiAgICBvcGVyYXRpb25zOiBbLi4ubGFzdFN0ZXAub3BlcmF0aW9ucywgb3BdXG4gIH1dO1xufVxuY29uc3QgZGVidWckYSA9IGRlYnVnV2l0aE5hbWUoXCJwbHVnaW46aGlzdG9yeVwiKSwgVU5ET19TVEVQX0xJTUlUID0gMWUzO1xuZnVuY3Rpb24gcGx1Z2luSGlzdG9yeSh7XG4gIGVkaXRvckFjdG9yLFxuICBzdWJzY3JpcHRpb25zXG59KSB7XG4gIHJldHVybiAoZWRpdG9yKSA9PiB7XG4gICAgbGV0IHByZXZpb3VzU25hcHNob3QgPSBlZGl0b3IudmFsdWUsIHByZXZpb3VzVW5kb1N0ZXBJZCA9IGVkaXRvci51bmRvU3RlcElkO1xuICAgIHN1YnNjcmlwdGlvbnMucHVzaCgoKSA9PiB7XG4gICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBlZGl0b3JBY3Rvci5vbihcInBhdGNoZXNcIiwgKHtcbiAgICAgICAgcGF0Y2hlcyxcbiAgICAgICAgc25hcHNob3RcbiAgICAgIH0pID0+IHtcbiAgICAgICAgbGV0IHJlc2V0ID0gITE7XG4gICAgICAgIGZvciAoY29uc3QgcGF0Y2ggb2YgcGF0Y2hlcylcbiAgICAgICAgICBpZiAoIXJlc2V0ICYmIHBhdGNoLm9yaWdpbiAhPT0gXCJsb2NhbFwiKSB7XG4gICAgICAgICAgICBpZiAocGF0Y2gudHlwZSA9PT0gXCJ1bnNldFwiICYmIHBhdGNoLnBhdGgubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgIGRlYnVnJGEoXCJTb21lb25lIGVsc2UgY2xlYXJlZCB0aGUgY29udGVudCwgcmVzZXR0aW5nIHVuZG8vcmVkbyBoaXN0b3J5XCIpLCBlZGl0b3IuaGlzdG9yeSA9IHtcbiAgICAgICAgICAgICAgICB1bmRvczogW10sXG4gICAgICAgICAgICAgICAgcmVkb3M6IFtdXG4gICAgICAgICAgICAgIH0sIGVkaXRvci5yZW1vdGVQYXRjaGVzLnNwbGljZSgwLCBlZGl0b3IucmVtb3RlUGF0Y2hlcy5sZW5ndGgpLCBlZGl0b3Iud2l0aEhpc3RvcnkgPSAhMCwgcmVzZXQgPSAhMDtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWRpdG9yLnJlbW90ZVBhdGNoZXMucHVzaCh7XG4gICAgICAgICAgICAgIHBhdGNoLFxuICAgICAgICAgICAgICB0aW1lOiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgc25hcHNob3QsXG4gICAgICAgICAgICAgIHByZXZpb3VzU25hcHNob3RcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgcHJldmlvdXNTbmFwc2hvdCA9IHNuYXBzaG90O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgY29uc3Qge1xuICAgICAgYXBwbHk6IGFwcGx5MlxuICAgIH0gPSBlZGl0b3I7XG4gICAgcmV0dXJuIGVkaXRvci5hcHBseSA9IChvcCkgPT4ge1xuICAgICAgaWYgKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkubWF0Y2hlcyh7XG4gICAgICAgIFwiZWRpdCBtb2RlXCI6IFwicmVhZCBvbmx5XCJcbiAgICAgIH0pKSB7XG4gICAgICAgIGFwcGx5MihvcCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChlZGl0b3IuaXNQcm9jZXNzaW5nUmVtb3RlQ2hhbmdlcykge1xuICAgICAgICBhcHBseTIob3ApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZWRpdG9yLmlzVW5kb2luZyB8fCBlZGl0b3IuaXNSZWRvaW5nKSB7XG4gICAgICAgIGFwcGx5MihvcCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHdpdGhIaXN0b3J5ID0gZWRpdG9yLndpdGhIaXN0b3J5LCBjdXJyZW50VW5kb1N0ZXBJZCA9IGVkaXRvci51bmRvU3RlcElkO1xuICAgICAgaWYgKCF3aXRoSGlzdG9yeSkge1xuICAgICAgICBwcmV2aW91c1VuZG9TdGVwSWQgPSBjdXJyZW50VW5kb1N0ZXBJZCwgYXBwbHkyKG9wKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm9yIChvcC50eXBlICE9PSBcInNldF9zZWxlY3Rpb25cIiAmJiAoZWRpdG9yLmhpc3RvcnkucmVkb3MgPSBbXSksIGVkaXRvci5oaXN0b3J5LnVuZG9zID0gY3JlYXRlVW5kb1N0ZXBzKHtcbiAgICAgICAgc3RlcHM6IGVkaXRvci5oaXN0b3J5LnVuZG9zLFxuICAgICAgICBvcCxcbiAgICAgICAgZWRpdG9yLFxuICAgICAgICBjdXJyZW50VW5kb1N0ZXBJZCxcbiAgICAgICAgcHJldmlvdXNVbmRvU3RlcElkXG4gICAgICB9KTsgZWRpdG9yLmhpc3RvcnkudW5kb3MubGVuZ3RoID4gVU5ET19TVEVQX0xJTUlUOyApXG4gICAgICAgIGVkaXRvci5oaXN0b3J5LnVuZG9zLnNoaWZ0KCk7XG4gICAgICBwcmV2aW91c1VuZG9TdGVwSWQgPSBjdXJyZW50VW5kb1N0ZXBJZCwgYXBwbHkyKG9wKTtcbiAgICB9LCBlZGl0b3I7XG4gIH07XG59XG5mdW5jdGlvbiB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsIGZuKSB7XG4gIGNvbnN0IHByZXYgPSBlZGl0b3IuaXNOb3JtYWxpemluZ05vZGU7XG4gIGVkaXRvci5pc05vcm1hbGl6aW5nTm9kZSA9ICEwLCBmbigpLCBlZGl0b3IuaXNOb3JtYWxpemluZ05vZGUgPSBwcmV2O1xufVxuZnVuY3Rpb24gd2l0aG91dFBhdGNoaW5nKGVkaXRvciwgZm4pIHtcbiAgY29uc3QgcHJldiA9IGVkaXRvci5pc1BhdGNoaW5nO1xuICBlZGl0b3IuaXNQYXRjaGluZyA9ICExLCBmbigpLCBlZGl0b3IuaXNQYXRjaGluZyA9IHByZXY7XG59XG5jb25zdCBkZWJ1ZyQ5ID0gZGVidWdXaXRoTmFtZShcInBsdWdpbjp3aXRoUG9ydGFibGVUZXh0TWFya01vZGVsXCIpO1xuZnVuY3Rpb24gY3JlYXRlV2l0aE5vcm1hbGl6ZShlZGl0b3JBY3Rvcikge1xuICByZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG4gICAgY29uc3Qge1xuICAgICAgYXBwbHk6IGFwcGx5MixcbiAgICAgIG5vcm1hbGl6ZU5vZGVcbiAgICB9ID0gZWRpdG9yLCBkZWZhdWx0U3R5bGUgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLnN0eWxlcy5hdCgwKT8ubmFtZTtcbiAgICByZXR1cm4gZWRpdG9yLm5vcm1hbGl6ZU5vZGUgPSAobm9kZUVudHJ5KSA9PiB7XG4gICAgICBjb25zdCBbbm9kZSwgcGF0aF0gPSBub2RlRW50cnk7XG4gICAgICBpZiAoRWRpdG9yLmlzRWRpdG9yKG5vZGUpICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwICYmIHdpdGhvdXRQYXRjaGluZyhlZGl0b3IsICgpID0+IHtcbiAgICAgICAgd2l0aE5vcm1hbGl6ZU5vZGUoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGNyZWF0ZVBsYWNlaG9sZGVyQmxvY2soZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0KSwge1xuICAgICAgICAgICAgYXQ6IFswXSxcbiAgICAgICAgICAgIHNlbGVjdDogITBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KSwgZWRpdG9yLmlzVGV4dEJsb2NrKG5vZGUpKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gTm9kZS5jaGlsZHJlbihlZGl0b3IsIHBhdGgpO1xuICAgICAgICBmb3IgKGNvbnN0IFtjaGlsZCwgY2hpbGRQYXRoXSBvZiBjaGlsZHJlbikge1xuICAgICAgICAgIGNvbnN0IG5leHROb2RlID0gbm9kZS5jaGlsZHJlbltjaGlsZFBhdGhbMV0gKyAxXTtcbiAgICAgICAgICBpZiAoZWRpdG9yLmlzVGV4dFNwYW4oY2hpbGQpICYmIGVkaXRvci5pc1RleHRTcGFuKG5leHROb2RlKSAmJiBjaGlsZC5tYXJrcz8uZXZlcnkoKG1hcmspID0+IG5leHROb2RlLm1hcmtzPy5pbmNsdWRlcyhtYXJrKSkgJiYgbmV4dE5vZGUubWFya3M/LmV2ZXJ5KChtYXJrKSA9PiBjaGlsZC5tYXJrcz8uaW5jbHVkZXMobWFyaykpKSB7XG4gICAgICAgICAgICBkZWJ1ZyQ5KFwiTWVyZ2luZyBzcGFuc1wiLCBKU09OLnN0cmluZ2lmeShjaGlsZCwgbnVsbCwgMiksIEpTT04uc3RyaW5naWZ5KG5leHROb2RlLCBudWxsLCAyKSksIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgICBUcmFuc2Zvcm1zLm1lcmdlTm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAgICAgYXQ6IFtjaGlsZFBhdGhbMF0sIGNoaWxkUGF0aFsxXSArIDFdLFxuICAgICAgICAgICAgICAgIHZvaWRzOiAhMFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5pc1RleHRCbG9jayhub2RlKSAmJiAhQXJyYXkuaXNBcnJheShub2RlLm1hcmtEZWZzKSkge1xuICAgICAgICBkZWJ1ZyQ5KFwiQWRkaW5nIC5tYXJrRGVmcyB0byBibG9jayBub2RlXCIpLCB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgbWFya0RlZnM6IFtdXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkZWZhdWx0U3R5bGUgJiYgZWRpdG9yLmlzVGV4dEJsb2NrKG5vZGUpICYmIHR5cGVvZiBub2RlLnN0eWxlID4gXCJ1XCIpIHtcbiAgICAgICAgZGVidWckOShcIkFkZGluZyAuc3R5bGUgdG8gYmxvY2sgbm9kZVwiKSwgd2l0aE5vcm1hbGl6ZU5vZGUoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgIHN0eWxlOiBkZWZhdWx0U3R5bGVcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBhdDogcGF0aFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5pc1RleHRTcGFuKG5vZGUpICYmICFBcnJheS5pc0FycmF5KG5vZGUubWFya3MpKSB7XG4gICAgICAgIGRlYnVnJDkoXCJBZGRpbmcgLm1hcmtzIHRvIHNwYW4gbm9kZVwiKSwgd2l0aE5vcm1hbGl6ZU5vZGUoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgIG1hcmtzOiBbXVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiBwYXRoXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZWRpdG9yLmlzVGV4dFNwYW4obm9kZSkpIHtcbiAgICAgICAgY29uc3QgYmxvY2tQYXRoID0gUGF0aC5wYXJlbnQocGF0aCksIFtibG9ja10gPSBFZGl0b3Iubm9kZShlZGl0b3IsIGJsb2NrUGF0aCksIGRlY29yYXRvcnMgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLmRlY29yYXRvcnMubWFwKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lKSwgYW5ub3RhdGlvbnMgPSBub2RlLm1hcmtzPy5maWx0ZXIoKG1hcmspID0+ICFkZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspKTtcbiAgICAgICAgaWYgKGVkaXRvci5pc1RleHRCbG9jayhibG9jaykgJiYgbm9kZS50ZXh0ID09PSBcIlwiICYmIGFubm90YXRpb25zICYmIGFubm90YXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBkZWJ1ZyQ5KFwiUmVtb3ZpbmcgYW5ub3RhdGlvbnMgZnJvbSBlbXB0eSBzcGFuIG5vZGVcIiksIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgICAgbWFya3M6IG5vZGUubWFya3M/LmZpbHRlcigobWFyaykgPT4gZGVjb3JhdG9ycy5pbmNsdWRlcyhtYXJrKSlcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5pc1RleHRCbG9jayhub2RlKSkge1xuICAgICAgICBjb25zdCBkZWNvcmF0b3JzID0gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLm1hcCgoZGVjb3JhdG9yKSA9PiBkZWNvcmF0b3IubmFtZSk7XG4gICAgICAgIGZvciAoY29uc3QgW2NoaWxkLCBjaGlsZFBhdGhdIG9mIE5vZGUuY2hpbGRyZW4oZWRpdG9yLCBwYXRoKSlcbiAgICAgICAgICBpZiAoZWRpdG9yLmlzVGV4dFNwYW4oY2hpbGQpKSB7XG4gICAgICAgICAgICBjb25zdCBtYXJrcyA9IGNoaWxkLm1hcmtzID8/IFtdLCBvcnBoYW5lZEFubm90YXRpb25zID0gbWFya3MuZmlsdGVyKChtYXJrKSA9PiAhZGVjb3JhdG9ycy5pbmNsdWRlcyhtYXJrKSAmJiAhbm9kZS5tYXJrRGVmcz8uZmluZCgoZGVmKSA9PiBkZWYuX2tleSA9PT0gbWFyaykpO1xuICAgICAgICAgICAgaWYgKG9ycGhhbmVkQW5ub3RhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBkZWJ1ZyQ5KFwiUmVtb3Zpbmcgb3JwaGFuZWQgYW5ub3RhdGlvbnMgZnJvbSBzcGFuIG5vZGVcIiksIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAgICAgICBtYXJrczogbWFya3MuZmlsdGVyKChtYXJrKSA9PiAhb3JwaGFuZWRBbm5vdGF0aW9ucy5pbmNsdWRlcyhtYXJrKSlcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICBhdDogY2hpbGRQYXRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5pc1RleHRTcGFuKG5vZGUpKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrUGF0aCA9IFBhdGgucGFyZW50KHBhdGgpLCBbYmxvY2tdID0gRWRpdG9yLm5vZGUoZWRpdG9yLCBibG9ja1BhdGgpO1xuICAgICAgICBpZiAoZWRpdG9yLmlzVGV4dEJsb2NrKGJsb2NrKSkge1xuICAgICAgICAgIGNvbnN0IGRlY29yYXRvcnMgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLmRlY29yYXRvcnMubWFwKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lKSwgbWFya3MgPSBub2RlLm1hcmtzID8/IFtdLCBvcnBoYW5lZEFubm90YXRpb25zID0gbWFya3MuZmlsdGVyKChtYXJrKSA9PiAhZGVjb3JhdG9ycy5pbmNsdWRlcyhtYXJrKSAmJiAhYmxvY2subWFya0RlZnM/LmZpbmQoKGRlZikgPT4gZGVmLl9rZXkgPT09IG1hcmspKTtcbiAgICAgICAgICBpZiAob3JwaGFuZWRBbm5vdGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBkZWJ1ZyQ5KFwiUmVtb3Zpbmcgb3JwaGFuZWQgYW5ub3RhdGlvbnMgZnJvbSBzcGFuIG5vZGVcIiksIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgICAgIG1hcmtzOiBtYXJrcy5maWx0ZXIoKG1hcmspID0+ICFvcnBoYW5lZEFubm90YXRpb25zLmluY2x1ZGVzKG1hcmspKVxuICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChlZGl0b3IuaXNUZXh0QmxvY2sobm9kZSkpIHtcbiAgICAgICAgY29uc3QgbWFya0RlZnMgPSBub2RlLm1hcmtEZWZzID8/IFtdLCBtYXJrRGVmS2V5cyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIG5ld01hcmtEZWZzID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbWFya0RlZiBvZiBtYXJrRGVmcylcbiAgICAgICAgICBtYXJrRGVmS2V5cy5oYXMobWFya0RlZi5fa2V5KSB8fCAobWFya0RlZktleXMuYWRkKG1hcmtEZWYuX2tleSksIG5ld01hcmtEZWZzLnB1c2gobWFya0RlZikpO1xuICAgICAgICBpZiAobWFya0RlZnMubGVuZ3RoICE9PSBuZXdNYXJrRGVmcy5sZW5ndGgpIHtcbiAgICAgICAgICBkZWJ1ZyQ5KFwiUmVtb3ZpbmcgZHVwbGljYXRlIG1hcmtEZWZzXCIpLCB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAgIG1hcmtEZWZzOiBuZXdNYXJrRGVmc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBhdDogcGF0aFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZWRpdG9yLmlzVGV4dEJsb2NrKG5vZGUpICYmICFlZGl0b3Iub3BlcmF0aW9ucy5zb21lKChvcCkgPT4gb3AudHlwZSA9PT0gXCJtZXJnZV9ub2RlXCIgJiYgXCJtYXJrRGVmc1wiIGluIG9wLnByb3BlcnRpZXMgJiYgb3AucGF0aC5sZW5ndGggPT09IDEpKSB7XG4gICAgICAgIGNvbnN0IG5ld01hcmtEZWZzID0gKG5vZGUubWFya0RlZnMgfHwgW10pLmZpbHRlcigoZGVmKSA9PiBub2RlLmNoaWxkcmVuLmZpbmQoKGNoaWxkKSA9PiBUZXh0LmlzVGV4dChjaGlsZCkgJiYgQXJyYXkuaXNBcnJheShjaGlsZC5tYXJrcykgJiYgY2hpbGQubWFya3MuaW5jbHVkZXMoZGVmLl9rZXkpKSk7XG4gICAgICAgIGlmIChub2RlLm1hcmtEZWZzICYmICFpc0VxdWFsTWFya0RlZnMobmV3TWFya0RlZnMsIG5vZGUubWFya0RlZnMpKSB7XG4gICAgICAgICAgZGVidWckOShcIlJlbW92aW5nIG1hcmtEZWYgbm90IGluIHVzZVwiKSwgd2l0aE5vcm1hbGl6ZU5vZGUoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgICBtYXJrRGVmczogbmV3TWFya0RlZnNcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgd2l0aE5vcm1hbGl6ZU5vZGUoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgIG5vcm1hbGl6ZU5vZGUobm9kZUVudHJ5KTtcbiAgICAgIH0pO1xuICAgIH0sIGVkaXRvci5hcHBseSA9IChvcCkgPT4ge1xuICAgICAgaWYgKGVkaXRvci5pc1Byb2Nlc3NpbmdSZW1vdGVDaGFuZ2VzKSB7XG4gICAgICAgIGFwcGx5MihvcCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChlZGl0b3IuaXNVbmRvaW5nIHx8IGVkaXRvci5pc1JlZG9pbmcpIHtcbiAgICAgICAgYXBwbHkyKG9wKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG9wLnR5cGUgPT09IFwic2V0X3NlbGVjdGlvblwiKVxuICAgICAgICBpZiAob3AucHJvcGVydGllcyAmJiBvcC5uZXdQcm9wZXJ0aWVzICYmIG9wLnByb3BlcnRpZXMuYW5jaG9yICYmIG9wLnByb3BlcnRpZXMuZm9jdXMgJiYgb3AubmV3UHJvcGVydGllcy5hbmNob3IgJiYgb3AubmV3UHJvcGVydGllcy5mb2N1cykge1xuICAgICAgICAgIGNvbnN0IHByZXZpb3VzU2VsZWN0aW9uSXNDb2xsYXBzZWQgPSBSYW5nZS5pc0NvbGxhcHNlZCh7XG4gICAgICAgICAgICBhbmNob3I6IG9wLnByb3BlcnRpZXMuYW5jaG9yLFxuICAgICAgICAgICAgZm9jdXM6IG9wLnByb3BlcnRpZXMuZm9jdXNcbiAgICAgICAgICB9KSwgbmV3U2VsZWN0aW9uSXNDb2xsYXBzZWQgPSBSYW5nZS5pc0NvbGxhcHNlZCh7XG4gICAgICAgICAgICBhbmNob3I6IG9wLm5ld1Byb3BlcnRpZXMuYW5jaG9yLFxuICAgICAgICAgICAgZm9jdXM6IG9wLm5ld1Byb3BlcnRpZXMuZm9jdXNcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAocHJldmlvdXNTZWxlY3Rpb25Jc0NvbGxhcHNlZCAmJiBuZXdTZWxlY3Rpb25Jc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgY29uc3QgZm9jdXNTcGFuID0gQXJyYXkuZnJvbShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAgIG1vZGU6IFwibG93ZXN0XCIsXG4gICAgICAgICAgICAgIGF0OiBvcC5wcm9wZXJ0aWVzLmZvY3VzLFxuICAgICAgICAgICAgICBtYXRjaDogKG4pID0+IGVkaXRvci5pc1RleHRTcGFuKG4pLFxuICAgICAgICAgICAgICB2b2lkczogITFcbiAgICAgICAgICAgIH0pKVswXT8uWzBdLCBuZXdGb2N1c1NwYW4gPSBBcnJheS5mcm9tKEVkaXRvci5ub2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgICAgbW9kZTogXCJsb3dlc3RcIixcbiAgICAgICAgICAgICAgYXQ6IG9wLm5ld1Byb3BlcnRpZXMuZm9jdXMsXG4gICAgICAgICAgICAgIG1hdGNoOiAobikgPT4gZWRpdG9yLmlzVGV4dFNwYW4obiksXG4gICAgICAgICAgICAgIHZvaWRzOiAhMVxuICAgICAgICAgICAgfSkpWzBdPy5bMF0sIG1vdmVkVG9OZXh0U3BhbiA9IGZvY3VzU3BhbiAmJiBuZXdGb2N1c1NwYW4gJiYgb3AubmV3UHJvcGVydGllcy5mb2N1cy5wYXRoWzBdID09PSBvcC5wcm9wZXJ0aWVzLmZvY3VzLnBhdGhbMF0gJiYgb3AubmV3UHJvcGVydGllcy5mb2N1cy5wYXRoWzFdID09PSBvcC5wcm9wZXJ0aWVzLmZvY3VzLnBhdGhbMV0gKyAxICYmIGZvY3VzU3Bhbi50ZXh0Lmxlbmd0aCA9PT0gb3AucHJvcGVydGllcy5mb2N1cy5vZmZzZXQgJiYgb3AubmV3UHJvcGVydGllcy5mb2N1cy5vZmZzZXQgPT09IDAsIG1vdmVkVG9QcmV2aW91c1NwYW4gPSBmb2N1c1NwYW4gJiYgbmV3Rm9jdXNTcGFuICYmIG9wLm5ld1Byb3BlcnRpZXMuZm9jdXMucGF0aFswXSA9PT0gb3AucHJvcGVydGllcy5mb2N1cy5wYXRoWzBdICYmIG9wLm5ld1Byb3BlcnRpZXMuZm9jdXMucGF0aFsxXSA9PT0gb3AucHJvcGVydGllcy5mb2N1cy5wYXRoWzFdIC0gMSAmJiBvcC5wcm9wZXJ0aWVzLmZvY3VzLm9mZnNldCA9PT0gMCAmJiBuZXdGb2N1c1NwYW4udGV4dC5sZW5ndGggPT09IG9wLm5ld1Byb3BlcnRpZXMuZm9jdXMub2Zmc2V0O1xuICAgICAgICAgICAgIW1vdmVkVG9OZXh0U3BhbiAmJiAhbW92ZWRUb1ByZXZpb3VzU3BhbiAmJiAoZWRpdG9yLmRlY29yYXRvclN0YXRlID0ge30pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlXG4gICAgICAgICAgZWRpdG9yLmRlY29yYXRvclN0YXRlID0ge307XG4gICAgICBpZiAob3AudHlwZSA9PT0gXCJtZXJnZV9ub2RlXCIgJiYgb3AucGF0aC5sZW5ndGggPT09IDEgJiYgXCJtYXJrRGVmc1wiIGluIG9wLnByb3BlcnRpZXMgJiYgb3AucHJvcGVydGllcy5fdHlwZSA9PT0gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lICYmIEFycmF5LmlzQXJyYXkob3AucHJvcGVydGllcy5tYXJrRGVmcykgJiYgb3AucHJvcGVydGllcy5tYXJrRGVmcy5sZW5ndGggPiAwICYmIG9wLnBhdGhbMF0gLSAxID49IDApIHtcbiAgICAgICAgY29uc3QgW3RhcmdldEJsb2NrLCB0YXJnZXRQYXRoXSA9IEVkaXRvci5ub2RlKGVkaXRvciwgW29wLnBhdGhbMF0gLSAxXSk7XG4gICAgICAgIGlmIChlZGl0b3IuaXNUZXh0QmxvY2sodGFyZ2V0QmxvY2spKSB7XG4gICAgICAgICAgY29uc3Qgb2xkRGVmcyA9IEFycmF5LmlzQXJyYXkodGFyZ2V0QmxvY2subWFya0RlZnMpICYmIHRhcmdldEJsb2NrLm1hcmtEZWZzIHx8IFtdLCBuZXdNYXJrRGVmcyA9IFsuLi5uZXcgTWFwKFsuLi5vbGREZWZzLCAuLi5vcC5wcm9wZXJ0aWVzLm1hcmtEZWZzXS5tYXAoKGRlZikgPT4gW2RlZi5fa2V5LCBkZWZdKSkudmFsdWVzKCldO1xuICAgICAgICAgIGRlYnVnJDkoXCJDb3B5aW5nIG1hcmtEZWZzIG92ZXIgdG8gbWVyZ2VkIGJsb2NrXCIsIG9wKSwgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgIG1hcmtEZWZzOiBuZXdNYXJrRGVmc1xuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiB0YXJnZXRQYXRoLFxuICAgICAgICAgICAgdm9pZHM6ICExXG4gICAgICAgICAgfSksIGFwcGx5MihvcCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhcHBseTIob3ApO1xuICAgIH0sIGVkaXRvcjtcbiAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVdpdGhPYmplY3RLZXlzKGVkaXRvckFjdG9yKSB7XG4gIHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICBjb25zdCB7XG4gICAgICBhcHBseTogYXBwbHkyLFxuICAgICAgbm9ybWFsaXplTm9kZVxuICAgIH0gPSBlZGl0b3I7XG4gICAgcmV0dXJuIGVkaXRvci5hcHBseSA9IChvcGVyYXRpb24pID0+IHtcbiAgICAgIGlmIChlZGl0b3IuaXNQcm9jZXNzaW5nUmVtb3RlQ2hhbmdlcykge1xuICAgICAgICBhcHBseTIob3BlcmF0aW9uKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRvci5pc1VuZG9pbmcgfHwgZWRpdG9yLmlzUmVkb2luZykge1xuICAgICAgICBhcHBseTIob3BlcmF0aW9uKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG9wZXJhdGlvbi50eXBlID09PSBcInNwbGl0X25vZGVcIikge1xuICAgICAgICBjb25zdCBleGlzdGluZ0tleXMgPSBbLi4uTm9kZS5kZXNjZW5kYW50cyhlZGl0b3IpXS5tYXAoKFtub2RlXSkgPT4gbm9kZS5fa2V5KTtcbiAgICAgICAgYXBwbHkyKHtcbiAgICAgICAgICAuLi5vcGVyYXRpb24sXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgLi4ub3BlcmF0aW9uLnByb3BlcnRpZXMsXG4gICAgICAgICAgICBfa2V5OiBvcGVyYXRpb24ucHJvcGVydGllcy5fa2V5ID09PSB2b2lkIDAgfHwgZXhpc3RpbmdLZXlzLmluY2x1ZGVzKG9wZXJhdGlvbi5wcm9wZXJ0aWVzLl9rZXkpID8gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmtleUdlbmVyYXRvcigpIDogb3BlcmF0aW9uLnByb3BlcnRpZXMuX2tleVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChvcGVyYXRpb24udHlwZSA9PT0gXCJpbnNlcnRfbm9kZVwiICYmICFFZGl0b3IuaXNFZGl0b3Iob3BlcmF0aW9uLm5vZGUpKSB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nS2V5cyA9IFsuLi5Ob2RlLmRlc2NlbmRhbnRzKGVkaXRvcildLm1hcCgoW25vZGVdKSA9PiBub2RlLl9rZXkpO1xuICAgICAgICBhcHBseTIoe1xuICAgICAgICAgIC4uLm9wZXJhdGlvbixcbiAgICAgICAgICBub2RlOiB7XG4gICAgICAgICAgICAuLi5vcGVyYXRpb24ubm9kZSxcbiAgICAgICAgICAgIF9rZXk6IG9wZXJhdGlvbi5ub2RlLl9rZXkgPT09IHZvaWQgMCB8fCBleGlzdGluZ0tleXMuaW5jbHVkZXMob3BlcmF0aW9uLm5vZGUuX2tleSkgPyBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQua2V5R2VuZXJhdG9yKCkgOiBvcGVyYXRpb24ubm9kZS5fa2V5XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG9wZXJhdGlvbi50eXBlID09PSBcIm1lcmdlX25vZGVcIikge1xuICAgICAgICBjb25zdCBpbmRleCA9IG9wZXJhdGlvbi5wYXRoW29wZXJhdGlvbi5wYXRoLmxlbmd0aCAtIDFdLCBwcmV2UGF0aCA9IFBhdGgucHJldmlvdXMob3BlcmF0aW9uLnBhdGgpLCBwcmV2SW5kZXggPSBwcmV2UGF0aFtwcmV2UGF0aC5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKG9wZXJhdGlvbi5wYXRoLmxlbmd0aCAhPT0gMSB8fCBwcmV2UGF0aC5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgICBhcHBseTIob3BlcmF0aW9uKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYmxvY2sgPSBlZGl0b3IudmFsdWUuYXQoaW5kZXgpLCBwcmV2aW91c0Jsb2NrID0gZWRpdG9yLnZhbHVlLmF0KHByZXZJbmRleCk7XG4gICAgICAgIGlmICghYmxvY2sgfHwgIXByZXZpb3VzQmxvY2spIHtcbiAgICAgICAgICBhcHBseTIob3BlcmF0aW9uKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1RleHRCbG9jayhlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQsIGJsb2NrKSB8fCAhaXNUZXh0QmxvY2soZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LCBwcmV2aW91c0Jsb2NrKSkge1xuICAgICAgICAgIGFwcGx5MihvcGVyYXRpb24pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcmV2aW91c0Jsb2NrQ2hpbGRLZXlzID0gcHJldmlvdXNCbG9jay5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC5fa2V5KSwgcHJldmlvdXNCbG9ja01hcmtEZWZLZXlzID0gcHJldmlvdXNCbG9jay5tYXJrRGVmcz8ubWFwKChtYXJrRGVmKSA9PiBtYXJrRGVmLl9rZXkpID8/IFtdLCBtYXJrRGVmS2V5TWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgYWRqdXN0ZWRNYXJrRGVmcyA9IGJsb2NrLm1hcmtEZWZzPy5tYXAoKG1hcmtEZWYpID0+IHtcbiAgICAgICAgICBpZiAocHJldmlvdXNCbG9ja01hcmtEZWZLZXlzLmluY2x1ZGVzKG1hcmtEZWYuX2tleSkpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0tleSA9IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5rZXlHZW5lcmF0b3IoKTtcbiAgICAgICAgICAgIHJldHVybiBtYXJrRGVmS2V5TWFwLnNldChtYXJrRGVmLl9rZXksIG5ld0tleSksIHtcbiAgICAgICAgICAgICAgLi4ubWFya0RlZixcbiAgICAgICAgICAgICAgX2tleTogbmV3S2V5XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbWFya0RlZjtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCBjaGlsZEluZGV4ID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbikge1xuICAgICAgICAgIGlmIChpc1NwYW4oZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LCBjaGlsZCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hcmtzID0gY2hpbGQubWFya3M/Lm1hcCgobWFyaykgPT4gbWFya0RlZktleU1hcC5nZXQobWFyaykgfHwgbWFyaykgPz8gW107XG4gICAgICAgICAgICBpc0VxdWFsTWFya3MoY2hpbGQubWFya3MsIG1hcmtzKSB8fCBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgICBtYXJrc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBhdDogW2luZGV4LCBjaGlsZEluZGV4XVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHByZXZpb3VzQmxvY2tDaGlsZEtleXMuaW5jbHVkZXMoY2hpbGQuX2tleSkgJiYgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgIF9rZXk6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5rZXlHZW5lcmF0b3IoKVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiBbaW5kZXgsIGNoaWxkSW5kZXhdXG4gICAgICAgICAgfSksIGNoaWxkSW5kZXgrKztcbiAgICAgICAgfVxuICAgICAgICBhcHBseTIoe1xuICAgICAgICAgIC4uLm9wZXJhdGlvbixcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAuLi5vcGVyYXRpb24ucHJvcGVydGllcyxcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgYWRqdXN0ZWQgbWFya0RlZnMgYXJlIGNhcnJpZWQgYWxvbmcgZm9yIHRoZSBtZXJnZVxuICAgICAgICAgICAgLy8gb3BlcmF0aW9uXG4gICAgICAgICAgICBtYXJrRGVmczogYWRqdXN0ZWRNYXJrRGVmc1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGFwcGx5MihvcGVyYXRpb24pO1xuICAgIH0sIGVkaXRvci5ub3JtYWxpemVOb2RlID0gKGVudHJ5KSA9PiB7XG4gICAgICBjb25zdCBbbm9kZSwgcGF0aF0gPSBlbnRyeTtcbiAgICAgIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpKSB7XG4gICAgICAgIGNvbnN0IFtwYXJlbnRdID0gRWRpdG9yLnBhcmVudChlZGl0b3IsIHBhdGgpO1xuICAgICAgICBpZiAocGFyZW50ICYmIEVkaXRvci5pc0VkaXRvcihwYXJlbnQpKSB7XG4gICAgICAgICAgY29uc3QgYmxvY2tLZXlzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHNpYmxpbmcgb2YgcGFyZW50LmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAoc2libGluZy5fa2V5ICYmIGJsb2NrS2V5cy5oYXMoc2libGluZy5fa2V5KSkge1xuICAgICAgICAgICAgICBjb25zdCBfa2V5ID0gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmtleUdlbmVyYXRvcigpO1xuICAgICAgICAgICAgICBibG9ja0tleXMuYWRkKF9rZXkpLCB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgICAgICAgX2tleVxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgIGF0OiBwYXRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXNpYmxpbmcuX2tleSkge1xuICAgICAgICAgICAgICBjb25zdCBfa2V5ID0gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmtleUdlbmVyYXRvcigpO1xuICAgICAgICAgICAgICBibG9ja0tleXMuYWRkKF9rZXkpLCB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgICAgICAgX2tleVxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgIGF0OiBwYXRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibG9ja0tleXMuYWRkKHNpYmxpbmcuX2tleSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoRWxlbWVudCQxLmlzRWxlbWVudChub2RlKSAmJiBub2RlLl90eXBlID09PSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWUpIHtcbiAgICAgICAgaWYgKCFub2RlLl9rZXkpIHtcbiAgICAgICAgICB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAgIF9rZXk6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5rZXlHZW5lcmF0b3IoKVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBhdDogcGF0aFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkS2V5cyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7XG4gICAgICAgIGZvciAoY29uc3QgW2NoaWxkLCBjaGlsZFBhdGhdIG9mIE5vZGUuY2hpbGRyZW4oZWRpdG9yLCBwYXRoKSkge1xuICAgICAgICAgIGlmIChjaGlsZC5fa2V5ICYmIGNoaWxkS2V5cy5oYXMoY2hpbGQuX2tleSkpIHtcbiAgICAgICAgICAgIGNvbnN0IF9rZXkgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQua2V5R2VuZXJhdG9yKCk7XG4gICAgICAgICAgICBjaGlsZEtleXMuYWRkKF9rZXkpLCB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgICAgICAgICBfa2V5XG4gICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBhdDogY2hpbGRQYXRoXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghY2hpbGQuX2tleSkge1xuICAgICAgICAgICAgY29uc3QgX2tleSA9IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5rZXlHZW5lcmF0b3IoKTtcbiAgICAgICAgICAgIGNoaWxkS2V5cy5hZGQoX2tleSksIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgICAgIF9rZXlcbiAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGF0OiBjaGlsZFBhdGhcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2hpbGRLZXlzLmFkZChjaGlsZC5fa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgd2l0aE5vcm1hbGl6ZU5vZGUoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgIG5vcm1hbGl6ZU5vZGUoZW50cnkpO1xuICAgICAgfSk7XG4gICAgfSwgZWRpdG9yO1xuICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlQXBwbHlQYXRjaChjb250ZXh0KSB7XG4gIHJldHVybiAoZWRpdG9yLCBwYXRjaCkgPT4ge1xuICAgIGxldCBjaGFuZ2VkID0gITE7XG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAocGF0Y2gudHlwZSkge1xuICAgICAgICBjYXNlIFwiaW5zZXJ0XCI6XG4gICAgICAgICAgY2hhbmdlZCA9IGluc2VydFBhdGNoKGNvbnRleHQsIGVkaXRvciwgcGF0Y2gpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidW5zZXRcIjpcbiAgICAgICAgICBjaGFuZ2VkID0gdW5zZXRQYXRjaChlZGl0b3IsIHBhdGNoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNldFwiOlxuICAgICAgICAgIGNoYW5nZWQgPSBzZXRQYXRjaChlZGl0b3IsIHBhdGNoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRpZmZNYXRjaFBhdGNoXCI6XG4gICAgICAgICAgY2hhbmdlZCA9IGRpZmZNYXRjaFBhdGNoKGVkaXRvciwgcGF0Y2gpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH1cbiAgICByZXR1cm4gY2hhbmdlZDtcbiAgfTtcbn1cbmZ1bmN0aW9uIGRpZmZNYXRjaFBhdGNoKGVkaXRvciwgcGF0Y2gpIHtcbiAgY29uc3QgYmxvY2sgPSBmaW5kQmxvY2soZWRpdG9yLmNoaWxkcmVuLCBwYXRjaC5wYXRoKTtcbiAgaWYgKCFibG9jaylcbiAgICByZXR1cm4gITE7XG4gIGNvbnN0IGNoaWxkID0gZmluZEJsb2NrQ2hpbGQoYmxvY2ssIHBhdGNoLnBhdGgpO1xuICBpZiAoIWNoaWxkIHx8ICEoYmxvY2sgJiYgZWRpdG9yLmlzVGV4dEJsb2NrKGJsb2NrLm5vZGUpICYmIHBhdGNoLnBhdGgubGVuZ3RoID09PSA0ICYmIHBhdGNoLnBhdGhbMV0gPT09IFwiY2hpbGRyZW5cIiAmJiBwYXRjaC5wYXRoWzNdID09PSBcInRleHRcIikgfHwgIVRleHQuaXNUZXh0KGNoaWxkLm5vZGUpKVxuICAgIHJldHVybiAhMTtcbiAgY29uc3QgcGF0Y2hlcyA9IHBhcnNlKHBhdGNoLnZhbHVlKSwgW25ld1ZhbHVlXSA9IGFwcGx5KHBhdGNoZXMsIGNoaWxkLm5vZGUudGV4dCwge1xuICAgIGFsbG93RXhjZWVkaW5nSW5kaWNlczogITBcbiAgfSksIGRpZmYkMSA9IGNsZWFudXBFZmZpY2llbmN5KGRpZmYoY2hpbGQubm9kZS50ZXh0LCBuZXdWYWx1ZSksIDUpO1xuICBsZXQgb2Zmc2V0ID0gMDtcbiAgZm9yIChjb25zdCBbb3AsIHRleHRdIG9mIGRpZmYkMSlcbiAgICBvcCA9PT0gRElGRl9JTlNFUlQgPyAoZWRpdG9yLmFwcGx5KHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0X3RleHRcIixcbiAgICAgIHBhdGg6IFtibG9jay5pbmRleCwgY2hpbGQuaW5kZXhdLFxuICAgICAgb2Zmc2V0LFxuICAgICAgdGV4dFxuICAgIH0pLCBvZmZzZXQgKz0gdGV4dC5sZW5ndGgpIDogb3AgPT09IERJRkZfREVMRVRFID8gZWRpdG9yLmFwcGx5KHtcbiAgICAgIHR5cGU6IFwicmVtb3ZlX3RleHRcIixcbiAgICAgIHBhdGg6IFtibG9jay5pbmRleCwgY2hpbGQuaW5kZXhdLFxuICAgICAgb2Zmc2V0LFxuICAgICAgdGV4dFxuICAgIH0pIDogb3AgPT09IERJRkZfRVFVQUwgJiYgKG9mZnNldCArPSB0ZXh0Lmxlbmd0aCk7XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIGluc2VydFBhdGNoKGNvbnRleHQsIGVkaXRvciwgcGF0Y2gpIHtcbiAgY29uc3QgYmxvY2sgPSBmaW5kQmxvY2soZWRpdG9yLmNoaWxkcmVuLCBwYXRjaC5wYXRoKTtcbiAgaWYgKCFibG9jaykge1xuICAgIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMSAmJiBwYXRjaC5wYXRoWzBdID09PSAwKSB7XG4gICAgICBjb25zdCBibG9ja3NUb0luc2VydCA9IHBhdGNoLml0ZW1zLm1hcCgoaXRlbSkgPT4gdG9TbGF0ZUJsb2NrKGl0ZW0sIHtcbiAgICAgICAgc2NoZW1hVHlwZXM6IGNvbnRleHQuc2NoZW1hXG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGJsb2Nrc1RvSW5zZXJ0LCB7XG4gICAgICAgIGF0OiBbMF1cbiAgICAgIH0pLCAhMDtcbiAgICB9XG4gICAgcmV0dXJuICExO1xuICB9XG4gIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA+IDEgJiYgcGF0Y2gucGF0aFsxXSAhPT0gXCJjaGlsZHJlblwiKVxuICAgIHJldHVybiAhMTtcbiAgaWYgKHBhdGNoLnBhdGgubGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3Qge1xuICAgICAgaXRlbXM6IGl0ZW1zMixcbiAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbjJcbiAgICB9ID0gcGF0Y2gsIGJsb2Nrc1RvSW5zZXJ0ID0gaXRlbXMyLm1hcCgoaXRlbSkgPT4gdG9TbGF0ZUJsb2NrKGl0ZW0sIHtcbiAgICAgIHNjaGVtYVR5cGVzOiBjb250ZXh0LnNjaGVtYVxuICAgIH0pKSwgdGFyZ2V0QmxvY2tJbmRleCA9IGJsb2NrLmluZGV4LCBub3JtYWxpemVkSWR4MiA9IHBvc2l0aW9uMiA9PT0gXCJhZnRlclwiID8gdGFyZ2V0QmxvY2tJbmRleCArIDEgOiB0YXJnZXRCbG9ja0luZGV4LCBlZGl0b3JXYXNFbXB0eUJlZm9yZSA9IGlzRXF1YWxUb0VtcHR5RWRpdG9yKGNvbnRleHQuaW5pdGlhbFZhbHVlLCBlZGl0b3IudmFsdWUsIGNvbnRleHQuc2NoZW1hKTtcbiAgICByZXR1cm4gVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGJsb2Nrc1RvSW5zZXJ0LCB7XG4gICAgICBhdDogW25vcm1hbGl6ZWRJZHgyXVxuICAgIH0pLCBlZGl0b3JXYXNFbXB0eUJlZm9yZSAmJiB0eXBlb2YgcGF0Y2gucGF0aFswXSA9PSBcIm51bWJlclwiICYmIHBhdGNoLnBhdGhbMF0gPT09IDAgJiYgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IsIHtcbiAgICAgIGF0OiBbcG9zaXRpb24yID09PSBcImJlZm9yZVwiID8gdGFyZ2V0QmxvY2tJbmRleCArIGJsb2Nrc1RvSW5zZXJ0Lmxlbmd0aCA6IHRhcmdldEJsb2NrSW5kZXhdXG4gICAgfSksICEwO1xuICB9XG4gIGNvbnN0IHtcbiAgICBpdGVtcyxcbiAgICBwb3NpdGlvblxuICB9ID0gcGF0Y2gsIHRhcmdldENoaWxkID0gZmluZEJsb2NrQ2hpbGQoYmxvY2ssIHBhdGNoLnBhdGgpO1xuICBpZiAoIXRhcmdldENoaWxkKVxuICAgIHJldHVybiAhMTtcbiAgY29uc3QgY2hpbGRyZW5Ub0luc2VydCA9IHRvU2xhdGVCbG9jayh7XG4gICAgLi4uYmxvY2subm9kZSxcbiAgICBjaGlsZHJlbjogaXRlbXNcbiAgfSwge1xuICAgIHNjaGVtYVR5cGVzOiBjb250ZXh0LnNjaGVtYVxuICB9KSwgbm9ybWFsaXplZElkeCA9IHBvc2l0aW9uID09PSBcImFmdGVyXCIgPyB0YXJnZXRDaGlsZC5pbmRleCArIDEgOiB0YXJnZXRDaGlsZC5pbmRleCwgY2hpbGRJbnNlcnRQYXRoID0gW2Jsb2NrLmluZGV4LCBub3JtYWxpemVkSWR4XTtcbiAgcmV0dXJuIGNoaWxkcmVuVG9JbnNlcnQgJiYgRWxlbWVudCQxLmlzRWxlbWVudChjaGlsZHJlblRvSW5zZXJ0KSAmJiBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgY2hpbGRyZW5Ub0luc2VydC5jaGlsZHJlbiwge1xuICAgIGF0OiBjaGlsZEluc2VydFBhdGhcbiAgfSksICEwO1xufVxuZnVuY3Rpb24gc2V0UGF0Y2goZWRpdG9yLCBwYXRjaCkge1xuICBsZXQgdmFsdWUgPSBwYXRjaC52YWx1ZTtcbiAgdHlwZW9mIHBhdGNoLnBhdGhbM10gPT0gXCJzdHJpbmdcIiAmJiAodmFsdWUgPSB7fSwgdmFsdWVbcGF0Y2gucGF0aFszXV0gPSBwYXRjaC52YWx1ZSk7XG4gIGNvbnN0IGJsb2NrID0gZmluZEJsb2NrKGVkaXRvci5jaGlsZHJlbiwgcGF0Y2gucGF0aCk7XG4gIGlmICghYmxvY2spXG4gICAgcmV0dXJuICExO1xuICBjb25zdCBpc1RleHRCbG9jazIgPSBlZGl0b3IuaXNUZXh0QmxvY2soYmxvY2subm9kZSk7XG4gIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHVwZGF0ZWRCbG9jayA9IGFwcGx5QWxsKGJsb2NrLm5vZGUsIFt7XG4gICAgICAuLi5wYXRjaCxcbiAgICAgIHBhdGg6IHBhdGNoLnBhdGguc2xpY2UoMSlcbiAgICB9XSk7XG4gICAgaWYgKGVkaXRvci5pc1RleHRCbG9jayhibG9jay5ub2RlKSAmJiBFbGVtZW50JDEuaXNFbGVtZW50KHVwZGF0ZWRCbG9jaykpIHtcbiAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB1cGRhdGVkQmxvY2ssIHtcbiAgICAgICAgYXQ6IFtibG9jay5pbmRleF1cbiAgICAgIH0pO1xuICAgICAgY29uc3QgcHJldmlvdXNTZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uO1xuICAgICAgZm9yIChjb25zdCBbXywgY2hpbGRQYXRoXSBvZiBFZGl0b3Iubm9kZXMoZWRpdG9yLCB7XG4gICAgICAgIGF0OiBbYmxvY2suaW5kZXhdLFxuICAgICAgICByZXZlcnNlOiAhMCxcbiAgICAgICAgbW9kZTogXCJsb3dlc3RcIlxuICAgICAgfSkpXG4gICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgYXQ6IGNoaWxkUGF0aFxuICAgICAgICB9KTtcbiAgICAgIHJldHVybiBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgdXBkYXRlZEJsb2NrLmNoaWxkcmVuLCB7XG4gICAgICAgIGF0OiBbYmxvY2suaW5kZXgsIDBdXG4gICAgICB9KSwgcHJldmlvdXNTZWxlY3Rpb24gJiYgKFRyYW5zZm9ybXMuc2V0U2VsZWN0aW9uKGVkaXRvciwgcHJldmlvdXNTZWxlY3Rpb24pLCBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIHByZXZpb3VzU2VsZWN0aW9uKSksICEwO1xuICAgIH0gZWxzZVxuICAgICAgcmV0dXJuIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB1cGRhdGVkQmxvY2ssIHtcbiAgICAgICAgYXQ6IFtibG9jay5pbmRleF1cbiAgICAgIH0pLCAhMDtcbiAgfVxuICBpZiAoaXNUZXh0QmxvY2syICYmIHBhdGNoLnBhdGhbMV0gIT09IFwiY2hpbGRyZW5cIikge1xuICAgIGNvbnN0IHVwZGF0ZWRCbG9jayA9IGFwcGx5QWxsKGJsb2NrLm5vZGUsIFt7XG4gICAgICAuLi5wYXRjaCxcbiAgICAgIHBhdGg6IHBhdGNoLnBhdGguc2xpY2UoMSlcbiAgICB9XSk7XG4gICAgcmV0dXJuIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB1cGRhdGVkQmxvY2ssIHtcbiAgICAgIGF0OiBbYmxvY2suaW5kZXhdXG4gICAgfSksICEwO1xuICB9XG4gIGNvbnN0IGNoaWxkID0gZmluZEJsb2NrQ2hpbGQoYmxvY2ssIHBhdGNoLnBhdGgpO1xuICBpZiAoaXNUZXh0QmxvY2syICYmIGNoaWxkKSB7XG4gICAgaWYgKFRleHQuaXNUZXh0KGNoaWxkLm5vZGUpKVxuICAgICAgaWYgKFRleHQuaXNUZXh0KHZhbHVlKSkge1xuICAgICAgICBjb25zdCBvbGRUZXh0ID0gY2hpbGQubm9kZS50ZXh0LCBuZXdUZXh0ID0gdmFsdWUudGV4dDtcbiAgICAgICAgb2xkVGV4dCAhPT0gbmV3VGV4dCAmJiAoZWRpdG9yLmFwcGx5KHtcbiAgICAgICAgICB0eXBlOiBcInJlbW92ZV90ZXh0XCIsXG4gICAgICAgICAgcGF0aDogW2Jsb2NrLmluZGV4LCBjaGlsZC5pbmRleF0sXG4gICAgICAgICAgb2Zmc2V0OiAwLFxuICAgICAgICAgIHRleHQ6IG9sZFRleHRcbiAgICAgICAgfSksIGVkaXRvci5hcHBseSh7XG4gICAgICAgICAgdHlwZTogXCJpbnNlcnRfdGV4dFwiLFxuICAgICAgICAgIHBhdGg6IFtibG9jay5pbmRleCwgY2hpbGQuaW5kZXhdLFxuICAgICAgICAgIG9mZnNldDogMCxcbiAgICAgICAgICB0ZXh0OiBuZXdUZXh0XG4gICAgICAgIH0pLCBlZGl0b3Iub25DaGFuZ2UoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBwcm9wUGF0aCA9IHBhdGNoLnBhdGguc2xpY2UoMyksIHByb3BFbnRyeSA9IHByb3BQYXRoLmF0KDApO1xuICAgICAgICBpZiAocHJvcEVudHJ5ID09PSB2b2lkIDAgfHwgdHlwZW9mIHByb3BFbnRyeSA9PSBcInN0cmluZ1wiICYmIFtcIl9rZXlcIiwgXCJfdHlwZVwiLCBcInRleHRcIl0uaW5jbHVkZXMocHJvcEVudHJ5KSlcbiAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG5ld05vZGUgPSBhcHBseUFsbChjaGlsZC5ub2RlLCBbe1xuICAgICAgICAgIC4uLnBhdGNoLFxuICAgICAgICAgIHBhdGg6IHByb3BQYXRoXG4gICAgICAgIH1dKTtcbiAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIG5ld05vZGUsIHtcbiAgICAgICAgICBhdDogW2Jsb2NrLmluZGV4LCBjaGlsZC5pbmRleF1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjb25zdCBwcm9wUGF0aCA9IHBhdGNoLnBhdGguc2xpY2UoMyksIHJlc2VydmVkUHJvcHMgPSBbXCJfa2V5XCIsIFwiX3R5cGVcIiwgXCJjaGlsZHJlblwiLCBcIl9faW5saW5lXCJdLCBwcm9wRW50cnkgPSBwcm9wUGF0aC5hdCgwKTtcbiAgICAgIGlmIChwcm9wRW50cnkgPT09IHZvaWQgMCB8fCB0eXBlb2YgcHJvcEVudHJ5ID09IFwic3RyaW5nXCIgJiYgcmVzZXJ2ZWRQcm9wcy5pbmNsdWRlcyhwcm9wRW50cnkpKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCB2YWx1ZTIgPSBcInZhbHVlXCIgaW4gY2hpbGQubm9kZSAmJiB0eXBlb2YgY2hpbGQubm9kZS52YWx1ZSA9PSBcIm9iamVjdFwiID8gY2hpbGQubm9kZS52YWx1ZSA6IHt9LCBuZXdWYWx1ZSA9IGFwcGx5QWxsKHZhbHVlMiwgW3tcbiAgICAgICAgLi4ucGF0Y2gsXG4gICAgICAgIHBhdGg6IHBhdGNoLnBhdGguc2xpY2UoMylcbiAgICAgIH1dKTtcbiAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgIC4uLmNoaWxkLm5vZGUsXG4gICAgICAgIHZhbHVlOiBuZXdWYWx1ZVxuICAgICAgfSwge1xuICAgICAgICBhdDogW2Jsb2NrLmluZGV4LCBjaGlsZC5pbmRleF1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gITA7XG4gIH0gZWxzZSBpZiAoRWxlbWVudCQxLmlzRWxlbWVudChibG9jay5ub2RlKSAmJiBwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgLi4ubmV4dFJlc3RcbiAgICB9ID0gdmFsdWUsIHtcbiAgICAgIGNoaWxkcmVuOiBfcHJldkNoaWxkcmVuLFxuICAgICAgLi4ucHJldlJlc3RcbiAgICB9ID0gYmxvY2subm9kZSB8fCB7XG4gICAgICBjaGlsZHJlbjogdm9pZCAwXG4gICAgfTtcbiAgICBlZGl0b3IuYXBwbHkoe1xuICAgICAgdHlwZTogXCJzZXRfbm9kZVwiLFxuICAgICAgcGF0aDogW2Jsb2NrLmluZGV4XSxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLi4ucHJldlJlc3RcbiAgICAgIH0sXG4gICAgICBuZXdQcm9wZXJ0aWVzOiBuZXh0UmVzdFxuICAgIH0pO1xuICAgIGNvbnN0IGJsb2NrTm9kZSA9IGJsb2NrLm5vZGU7XG4gICAgYmxvY2tOb2RlLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkMiwgY2hpbGRJbmRleCkgPT4ge1xuICAgICAgZWRpdG9yLmFwcGx5KHtcbiAgICAgICAgdHlwZTogXCJyZW1vdmVfbm9kZVwiLFxuICAgICAgICBwYXRoOiBbYmxvY2suaW5kZXgsIGJsb2NrTm9kZS5jaGlsZHJlbi5sZW5ndGggLSAxIC0gY2hpbGRJbmRleF0sXG4gICAgICAgIG5vZGU6IGNoaWxkMlxuICAgICAgfSk7XG4gICAgfSksIEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pICYmIGNoaWxkcmVuLmZvckVhY2goKGNoaWxkMiwgY2hpbGRJbmRleCkgPT4ge1xuICAgICAgZWRpdG9yLmFwcGx5KHtcbiAgICAgICAgdHlwZTogXCJpbnNlcnRfbm9kZVwiLFxuICAgICAgICBwYXRoOiBbYmxvY2suaW5kZXgsIGNoaWxkSW5kZXhdLFxuICAgICAgICBub2RlOiBjaGlsZDJcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKGJsb2NrICYmIFwidmFsdWVcIiBpbiBibG9jay5ub2RlKVxuICAgIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA+IDEgJiYgcGF0Y2gucGF0aFsxXSAhPT0gXCJjaGlsZHJlblwiKSB7XG4gICAgICBjb25zdCBuZXdWYWwgPSBhcHBseUFsbChibG9jay5ub2RlLnZhbHVlLCBbe1xuICAgICAgICAuLi5wYXRjaCxcbiAgICAgICAgcGF0aDogcGF0Y2gucGF0aC5zbGljZSgxKVxuICAgICAgfV0pO1xuICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgLi4uYmxvY2subm9kZSxcbiAgICAgICAgdmFsdWU6IG5ld1ZhbFxuICAgICAgfSwge1xuICAgICAgICBhdDogW2Jsb2NrLmluZGV4XVxuICAgICAgfSk7XG4gICAgfSBlbHNlXG4gICAgICByZXR1cm4gITE7XG4gIHJldHVybiAhMDtcbn1cbmZ1bmN0aW9uIHVuc2V0UGF0Y2goZWRpdG9yLCBwYXRjaCkge1xuICBpZiAocGF0Y2gucGF0aC5sZW5ndGggPT09IDApIHtcbiAgICBUcmFuc2Zvcm1zLmRlc2VsZWN0KGVkaXRvcik7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBOb2RlLmNoaWxkcmVuKGVkaXRvciwgW10sIHtcbiAgICAgIHJldmVyc2U6ICEwXG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBbXywgcGF0aF0gb2YgY2hpbGRyZW4pXG4gICAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwge1xuICAgICAgICBhdDogcGF0aFxuICAgICAgfSk7XG4gICAgcmV0dXJuICEwO1xuICB9XG4gIGNvbnN0IGJsb2NrID0gZmluZEJsb2NrKGVkaXRvci5jaGlsZHJlbiwgcGF0Y2gucGF0aCk7XG4gIGlmICghYmxvY2spXG4gICAgcmV0dXJuICExO1xuICBpZiAocGF0Y2gucGF0aC5sZW5ndGggPT09IDEpXG4gICAgcmV0dXJuIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7XG4gICAgICBhdDogW2Jsb2NrLmluZGV4XVxuICAgIH0pLCAhMDtcbiAgY29uc3QgY2hpbGQgPSBmaW5kQmxvY2tDaGlsZChibG9jaywgcGF0Y2gucGF0aCk7XG4gIGlmIChlZGl0b3IuaXNUZXh0QmxvY2soYmxvY2subm9kZSkgJiYgY2hpbGQgJiYgcGF0Y2gucGF0aFsxXSA9PT0gXCJjaGlsZHJlblwiICYmIHBhdGNoLnBhdGgubGVuZ3RoID09PSAzKVxuICAgIHJldHVybiBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwge1xuICAgICAgYXQ6IFtibG9jay5pbmRleCwgY2hpbGQuaW5kZXhdXG4gICAgfSksICEwO1xuICBpZiAoY2hpbGQgJiYgIVRleHQuaXNUZXh0KGNoaWxkLm5vZGUpKSB7XG4gICAgY29uc3QgcHJvcEVudHJ5ID0gcGF0Y2gucGF0aC5zbGljZSgzKS5hdCgwKTtcbiAgICBpZiAocHJvcEVudHJ5ID09PSB2b2lkIDAgfHwgdHlwZW9mIHByb3BFbnRyeSA9PSBcInN0cmluZ1wiICYmIFtcIl9rZXlcIiwgXCJfdHlwZVwiLCBcImNoaWxkcmVuXCIsIFwiX19pbmxpbmVcIl0uaW5jbHVkZXMocHJvcEVudHJ5KSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCB2YWx1ZSA9IFwidmFsdWVcIiBpbiBjaGlsZC5ub2RlICYmIHR5cGVvZiBjaGlsZC5ub2RlLnZhbHVlID09IFwib2JqZWN0XCIgPyBjaGlsZC5ub2RlLnZhbHVlIDoge30sIG5ld1ZhbHVlID0gYXBwbHlBbGwodmFsdWUsIFt7XG4gICAgICAuLi5wYXRjaCxcbiAgICAgIHBhdGg6IHBhdGNoLnBhdGguc2xpY2UoMylcbiAgICB9XSk7XG4gICAgcmV0dXJuIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAuLi5jaGlsZC5ub2RlLFxuICAgICAgdmFsdWU6IG5ld1ZhbHVlXG4gICAgfSwge1xuICAgICAgYXQ6IFtibG9jay5pbmRleCwgY2hpbGQuaW5kZXhdXG4gICAgfSksICEwO1xuICB9XG4gIGlmIChjaGlsZCAmJiBUZXh0LmlzVGV4dChjaGlsZC5ub2RlKSkge1xuICAgIGNvbnN0IHByb3BQYXRoID0gcGF0Y2gucGF0aC5zbGljZSgzKSwgcHJvcEVudHJ5ID0gcHJvcFBhdGguYXQoMCk7XG4gICAgaWYgKHByb3BFbnRyeSA9PT0gdm9pZCAwIHx8IHR5cGVvZiBwcm9wRW50cnkgPT0gXCJzdHJpbmdcIiAmJiBbXCJfa2V5XCIsIFwiX3R5cGVcIl0uaW5jbHVkZXMocHJvcEVudHJ5KSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBpZiAodHlwZW9mIHByb3BFbnRyeSA9PSBcInN0cmluZ1wiICYmIHByb3BFbnRyeSA9PT0gXCJ0ZXh0XCIpXG4gICAgICByZXR1cm4gZWRpdG9yLmFwcGx5KHtcbiAgICAgICAgdHlwZTogXCJyZW1vdmVfdGV4dFwiLFxuICAgICAgICBwYXRoOiBbYmxvY2suaW5kZXgsIGNoaWxkLmluZGV4XSxcbiAgICAgICAgb2Zmc2V0OiAwLFxuICAgICAgICB0ZXh0OiBjaGlsZC5ub2RlLnRleHRcbiAgICAgIH0pLCAhMDtcbiAgICBjb25zdCBuZXdOb2RlID0gYXBwbHlBbGwoY2hpbGQubm9kZSwgW3tcbiAgICAgIC4uLnBhdGNoLFxuICAgICAgcGF0aDogcHJvcFBhdGhcbiAgICB9XSksIG5ld0tleXMgPSBPYmplY3Qua2V5cyhuZXdOb2RlKSwgcmVtb3ZlZFByb3BlcnRpZXMgPSBPYmplY3Qua2V5cyhjaGlsZC5ub2RlKS5maWx0ZXIoKHByb3BlcnR5KSA9PiAhbmV3S2V5cy5pbmNsdWRlcyhwcm9wZXJ0eSkpO1xuICAgIHJldHVybiBUcmFuc2Zvcm1zLnVuc2V0Tm9kZXMoZWRpdG9yLCByZW1vdmVkUHJvcGVydGllcywge1xuICAgICAgYXQ6IFtibG9jay5pbmRleCwgY2hpbGQuaW5kZXhdXG4gICAgfSksICEwO1xuICB9XG4gIGlmICghY2hpbGQpIHtcbiAgICBpZiAoXCJ2YWx1ZVwiIGluIGJsb2NrLm5vZGUpIHtcbiAgICAgIGNvbnN0IG5ld1ZhbCA9IGFwcGx5QWxsKGJsb2NrLm5vZGUudmFsdWUsIFt7XG4gICAgICAgIC4uLnBhdGNoLFxuICAgICAgICBwYXRoOiBwYXRjaC5wYXRoLnNsaWNlKDEpXG4gICAgICB9XSk7XG4gICAgICByZXR1cm4gVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHtcbiAgICAgICAgLi4uYmxvY2subm9kZSxcbiAgICAgICAgdmFsdWU6IG5ld1ZhbFxuICAgICAgfSwge1xuICAgICAgICBhdDogW2Jsb2NrLmluZGV4XVxuICAgICAgfSksICEwO1xuICAgIH1cbiAgICByZXR1cm4gITE7XG4gIH1cbiAgcmV0dXJuICExO1xufVxuZnVuY3Rpb24gZmluZEJsb2NrKGNoaWxkcmVuLCBwYXRoKSB7XG4gIGxldCBibG9ja0luZGV4ID0gLTE7XG4gIGNvbnN0IGJsb2NrID0gY2hpbGRyZW4uZmluZCgobm9kZSwgaW5kZXgpID0+IHtcbiAgICBjb25zdCBpc01hdGNoID0gaXNLZXllZFNlZ21lbnQocGF0aFswXSkgPyBub2RlLl9rZXkgPT09IHBhdGhbMF0uX2tleSA6IGluZGV4ID09PSBwYXRoWzBdO1xuICAgIHJldHVybiBpc01hdGNoICYmIChibG9ja0luZGV4ID0gaW5kZXgpLCBpc01hdGNoO1xuICB9KTtcbiAgaWYgKGJsb2NrKVxuICAgIHJldHVybiB7XG4gICAgICBub2RlOiBibG9jayxcbiAgICAgIGluZGV4OiBibG9ja0luZGV4XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGZpbmRCbG9ja0NoaWxkKGJsb2NrLCBwYXRoKSB7XG4gIGNvbnN0IGJsb2NrTm9kZSA9IGJsb2NrLm5vZGU7XG4gIGlmICghRWxlbWVudCQxLmlzRWxlbWVudChibG9ja05vZGUpIHx8IHBhdGhbMV0gIT09IFwiY2hpbGRyZW5cIilcbiAgICByZXR1cm47XG4gIGxldCBjaGlsZEluZGV4ID0gLTE7XG4gIGNvbnN0IGNoaWxkID0gYmxvY2tOb2RlLmNoaWxkcmVuLmZpbmQoKG5vZGUsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgaXNNYXRjaCA9IGlzS2V5ZWRTZWdtZW50KHBhdGhbMl0pID8gbm9kZS5fa2V5ID09PSBwYXRoWzJdLl9rZXkgOiBpbmRleCA9PT0gcGF0aFsyXTtcbiAgICByZXR1cm4gaXNNYXRjaCAmJiAoY2hpbGRJbmRleCA9IGluZGV4KSwgaXNNYXRjaDtcbiAgfSk7XG4gIGlmIChjaGlsZClcbiAgICByZXR1cm4ge1xuICAgICAgbm9kZTogY2hpbGQsXG4gICAgICBpbmRleDogY2hpbGRJbmRleFxuICAgIH07XG59XG5mdW5jdGlvbiBpbnNlcnRUZXh0UGF0Y2goc2NoZW1hLCBjaGlsZHJlbiwgb3BlcmF0aW9uLCBiZWZvcmVWYWx1ZSkge1xuICBjb25zdCBibG9jayA9IGlzVGV4dEJsb2NrKHtcbiAgICBzY2hlbWFcbiAgfSwgY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMF1dKSAmJiBjaGlsZHJlbltvcGVyYXRpb24ucGF0aFswXV07XG4gIGlmICghYmxvY2spXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgYmxvY2tcIik7XG4gIGNvbnN0IHRleHRDaGlsZCA9IGlzVGV4dEJsb2NrKHtcbiAgICBzY2hlbWFcbiAgfSwgYmxvY2spICYmIGlzU3Bhbih7XG4gICAgc2NoZW1hXG4gIH0sIGJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdXSkgJiYgYmxvY2suY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMV1dO1xuICBpZiAoIXRleHRDaGlsZClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCBjaGlsZFwiKTtcbiAgY29uc3QgcGF0aCA9IFt7XG4gICAgX2tleTogYmxvY2suX2tleVxuICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICBfa2V5OiB0ZXh0Q2hpbGQuX2tleVxuICB9LCBcInRleHRcIl0sIHByZXZCbG9jayA9IGJlZm9yZVZhbHVlW29wZXJhdGlvbi5wYXRoWzBdXSwgcHJldkNoaWxkID0gaXNUZXh0QmxvY2soe1xuICAgIHNjaGVtYVxuICB9LCBwcmV2QmxvY2spICYmIHByZXZCbG9jay5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFsxXV0sIHByZXZUZXh0ID0gaXNTcGFuKHtcbiAgICBzY2hlbWFcbiAgfSwgcHJldkNoaWxkKSA/IHByZXZDaGlsZC50ZXh0IDogXCJcIiwgcGF0Y2ggPSBkaWZmTWF0Y2hQYXRjaCQxKHByZXZUZXh0LCB0ZXh0Q2hpbGQudGV4dCwgcGF0aCk7XG4gIHJldHVybiBwYXRjaC52YWx1ZS5sZW5ndGggPyBbcGF0Y2hdIDogW107XG59XG5mdW5jdGlvbiByZW1vdmVUZXh0UGF0Y2goc2NoZW1hLCBjaGlsZHJlbiwgb3BlcmF0aW9uLCBiZWZvcmVWYWx1ZSkge1xuICBjb25zdCBibG9jayA9IGNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzBdXTtcbiAgaWYgKCFibG9jaylcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCBibG9ja1wiKTtcbiAgY29uc3QgY2hpbGQgPSBpc1RleHRCbG9jayh7XG4gICAgc2NoZW1hXG4gIH0sIGJsb2NrKSAmJiBibG9jay5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFsxXV0gfHwgdm9pZCAwLCB0ZXh0Q2hpbGQgPSBpc1NwYW4oe1xuICAgIHNjaGVtYVxuICB9LCBjaGlsZCkgPyBjaGlsZCA6IHZvaWQgMDtcbiAgaWYgKGNoaWxkICYmICF0ZXh0Q2hpbGQpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRXhwZWN0ZWQgc3BhblwiKTtcbiAgaWYgKCF0ZXh0Q2hpbGQpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgY2hpbGRcIik7XG4gIGNvbnN0IHBhdGggPSBbe1xuICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgX2tleTogdGV4dENoaWxkLl9rZXlcbiAgfSwgXCJ0ZXh0XCJdLCBiZWZvcmVCbG9jayA9IGJlZm9yZVZhbHVlW29wZXJhdGlvbi5wYXRoWzBdXSwgcHJldlRleHRDaGlsZCA9IGlzVGV4dEJsb2NrKHtcbiAgICBzY2hlbWFcbiAgfSwgYmVmb3JlQmxvY2spICYmIGJlZm9yZUJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdXSwgcHJldlRleHQgPSBpc1NwYW4oe1xuICAgIHNjaGVtYVxuICB9LCBwcmV2VGV4dENoaWxkKSAmJiBwcmV2VGV4dENoaWxkLnRleHQsIHBhdGNoID0gZGlmZk1hdGNoUGF0Y2gkMShwcmV2VGV4dCB8fCBcIlwiLCB0ZXh0Q2hpbGQudGV4dCwgcGF0aCk7XG4gIHJldHVybiBwYXRjaC52YWx1ZSA/IFtwYXRjaF0gOiBbXTtcbn1cbmZ1bmN0aW9uIHNldE5vZGVQYXRjaChzY2hlbWEsIGNoaWxkcmVuLCBvcGVyYXRpb24pIHtcbiAgY29uc3QgYmxvY2tJbmRleCA9IG9wZXJhdGlvbi5wYXRoLmF0KDApO1xuICBpZiAoYmxvY2tJbmRleCAhPT0gdm9pZCAwICYmIG9wZXJhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IGJsb2NrID0gY2hpbGRyZW4uYXQoYmxvY2tJbmRleCk7XG4gICAgaWYgKCFibG9jaylcbiAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IGZpbmQgYmxvY2sgYXQgaW5kZXhcIiwgYmxvY2tJbmRleCksIFtdO1xuICAgIGlmIChpc1RleHRCbG9jayh7XG4gICAgICBzY2hlbWFcbiAgICB9LCBibG9jaykpIHtcbiAgICAgIGNvbnN0IHBhdGNoZXMgPSBbXTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKG9wZXJhdGlvbi5uZXdQcm9wZXJ0aWVzKSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IG9wZXJhdGlvbi5uZXdQcm9wZXJ0aWVzW2tleV07XG4gICAgICAgIGtleSA9PT0gXCJfa2V5XCIgPyBwYXRjaGVzLnB1c2goc2V0KHZhbHVlLCBbYmxvY2tJbmRleCwgXCJfa2V5XCJdKSkgOiBwYXRjaGVzLnB1c2goc2V0KHZhbHVlLCBbe1xuICAgICAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICAgICAgfSwga2V5XSkpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMob3BlcmF0aW9uLnByb3BlcnRpZXMpKVxuICAgICAgICBrZXkgaW4gb3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMgfHwgcGF0Y2hlcy5wdXNoKHVuc2V0KFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9LCBrZXldKSk7XG4gICAgICByZXR1cm4gcGF0Y2hlcztcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcGF0Y2hlcyA9IFtdLCBfa2V5ID0gb3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMuX2tleTtcbiAgICAgIF9rZXkgIT09IHZvaWQgMCAmJiBwYXRjaGVzLnB1c2goc2V0KF9rZXksIFtibG9ja0luZGV4LCBcIl9rZXlcIl0pKTtcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gXCJ2YWx1ZVwiIGluIG9wZXJhdGlvbi5uZXdQcm9wZXJ0aWVzICYmIHR5cGVvZiBvcGVyYXRpb24ubmV3UHJvcGVydGllcy52YWx1ZSA9PSBcIm9iamVjdFwiID8gb3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMudmFsdWUgOiB7fSwga2V5cyA9IE9iamVjdC5rZXlzKG5ld1ZhbHVlKTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgICAgY29uc3QgdmFsdWUyID0gbmV3VmFsdWVba2V5XTtcbiAgICAgICAgcGF0Y2hlcy5wdXNoKHNldCh2YWx1ZTIsIFt7XG4gICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICB9LCBrZXldKSk7XG4gICAgICB9XG4gICAgICBjb25zdCB2YWx1ZSA9IFwidmFsdWVcIiBpbiBvcGVyYXRpb24ucHJvcGVydGllcyAmJiB0eXBlb2Ygb3BlcmF0aW9uLnByb3BlcnRpZXMudmFsdWUgPT0gXCJvYmplY3RcIiA/IG9wZXJhdGlvbi5wcm9wZXJ0aWVzLnZhbHVlIDoge307XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyh2YWx1ZSkpXG4gICAgICAgIGtleSBpbiBuZXdWYWx1ZSB8fCBwYXRjaGVzLnB1c2godW5zZXQoW3tcbiAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgIH0sIGtleV0pKTtcbiAgICAgIHJldHVybiBwYXRjaGVzO1xuICAgIH1cbiAgfSBlbHNlIGlmIChvcGVyYXRpb24ucGF0aC5sZW5ndGggPT09IDIpIHtcbiAgICBjb25zdCBibG9jayA9IGNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzBdXTtcbiAgICBpZiAoaXNUZXh0QmxvY2soe1xuICAgICAgc2NoZW1hXG4gICAgfSwgYmxvY2spKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdXTtcbiAgICAgIGlmIChjaGlsZCkge1xuICAgICAgICBjb25zdCBibG9ja0tleSA9IGJsb2NrLl9rZXksIGNoaWxkS2V5ID0gY2hpbGQuX2tleSwgcGF0Y2hlcyA9IFtdO1xuICAgICAgICBpZiAoRWxlbWVudCQxLmlzRWxlbWVudChjaGlsZCkpIHtcbiAgICAgICAgICBjb25zdCBfa2V5ID0gb3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMuX2tleTtcbiAgICAgICAgICBfa2V5ICE9PSB2b2lkIDAgJiYgcGF0Y2hlcy5wdXNoKHNldChfa2V5LCBbe1xuICAgICAgICAgICAgX2tleTogYmxvY2tLZXlcbiAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIGJsb2NrLmNoaWxkcmVuLmluZGV4T2YoY2hpbGQpLCBcIl9rZXlcIl0pKTtcbiAgICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gXCJ2YWx1ZVwiIGluIG9wZXJhdGlvbi5uZXdQcm9wZXJ0aWVzICYmIHR5cGVvZiBvcGVyYXRpb24ubmV3UHJvcGVydGllcy52YWx1ZSA9PSBcIm9iamVjdFwiID8gb3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMudmFsdWUgOiB7fSwga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpO1xuICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcHJvcGVydGllc1trZXldO1xuICAgICAgICAgICAgcGF0Y2hlcy5wdXNoKHNldCh2YWx1ZSwgW3tcbiAgICAgICAgICAgICAgX2tleTogYmxvY2tLZXlcbiAgICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgICBfa2V5OiBjaGlsZEtleVxuICAgICAgICAgICAgfSwga2V5XSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcGF0Y2hlcztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdQcm9wTmFtZXMgPSBPYmplY3Qua2V5cyhvcGVyYXRpb24ubmV3UHJvcGVydGllcyk7XG4gICAgICAgIGZvciAoY29uc3Qga2V5TmFtZSBvZiBuZXdQcm9wTmFtZXMpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9wZXJhdGlvbi5uZXdQcm9wZXJ0aWVzW2tleU5hbWVdO1xuICAgICAgICAgIGlmIChrZXlOYW1lID09PSBcIl9rZXlcIikge1xuICAgICAgICAgICAgcGF0Y2hlcy5wdXNoKHNldCh2YWx1ZSwgW3tcbiAgICAgICAgICAgICAgX2tleTogYmxvY2tLZXlcbiAgICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwgYmxvY2suY2hpbGRyZW4uaW5kZXhPZihjaGlsZCksIGtleU5hbWVdKSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGF0Y2hlcy5wdXNoKHNldCh2YWx1ZSwgW3tcbiAgICAgICAgICAgIF9rZXk6IGJsb2NrS2V5XG4gICAgICAgICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgICBfa2V5OiBjaGlsZEtleVxuICAgICAgICAgIH0sIGtleU5hbWVdKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJvcE5hbWVzID0gT2JqZWN0LmtleXMob3BlcmF0aW9uLnByb3BlcnRpZXMpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleU5hbWUgb2YgcHJvcE5hbWVzKVxuICAgICAgICAgIGtleU5hbWUgaW4gb3BlcmF0aW9uLm5ld1Byb3BlcnRpZXMgfHwgcGF0Y2hlcy5wdXNoKHVuc2V0KFt7XG4gICAgICAgICAgICBfa2V5OiBibG9ja0tleVxuICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgX2tleTogY2hpbGRLZXlcbiAgICAgICAgICB9LCBrZXlOYW1lXSkpO1xuICAgICAgICByZXR1cm4gcGF0Y2hlcztcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIGEgdmFsaWQgY2hpbGRcIik7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIGEgdmFsaWQgYmxvY2tcIik7XG4gIH0gZWxzZVxuICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBwYXRoIGVuY291bnRlcmVkOiAke0pTT04uc3RyaW5naWZ5KG9wZXJhdGlvbi5wYXRoKX1gKTtcbn1cbmZ1bmN0aW9uIGluc2VydE5vZGVQYXRjaChzY2hlbWEsIGNoaWxkcmVuLCBvcGVyYXRpb24sIGJlZm9yZVZhbHVlKSB7XG4gIGNvbnN0IGJsb2NrID0gYmVmb3JlVmFsdWVbb3BlcmF0aW9uLnBhdGhbMF1dO1xuICBpZiAob3BlcmF0aW9uLnBhdGgubGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSBvcGVyYXRpb24ucGF0aFswXSA9PT0gMCA/IFwiYmVmb3JlXCIgOiBcImFmdGVyXCIsIGJlZm9yZUJsb2NrID0gYmVmb3JlVmFsdWVbb3BlcmF0aW9uLnBhdGhbMF0gLSAxXSwgdGFyZ2V0S2V5ID0gb3BlcmF0aW9uLnBhdGhbMF0gPT09IDAgPyBibG9jaz8uX2tleSA6IGJlZm9yZUJsb2NrPy5fa2V5O1xuICAgIHJldHVybiB0YXJnZXRLZXkgPyBbaW5zZXJ0KFtmcm9tU2xhdGVCbG9jayhvcGVyYXRpb24ubm9kZSwgc2NoZW1hLmJsb2NrLm5hbWUpXSwgcG9zaXRpb24sIFt7XG4gICAgICBfa2V5OiB0YXJnZXRLZXlcbiAgICB9XSldIDogW3NldElmTWlzc2luZyhiZWZvcmVWYWx1ZSwgW10pLCBpbnNlcnQoW2Zyb21TbGF0ZUJsb2NrKG9wZXJhdGlvbi5ub2RlLCBzY2hlbWEuYmxvY2submFtZSldLCBcImJlZm9yZVwiLCBbb3BlcmF0aW9uLnBhdGhbMF1dKV07XG4gIH0gZWxzZSBpZiAoaXNUZXh0QmxvY2soe1xuICAgIHNjaGVtYVxuICB9LCBibG9jaykgJiYgb3BlcmF0aW9uLnBhdGgubGVuZ3RoID09PSAyICYmIGNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzBdXSkge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gYmxvY2suY2hpbGRyZW4ubGVuZ3RoID09PSAwIHx8ICFibG9jay5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFsxXSAtIDFdID8gXCJiZWZvcmVcIiA6IFwiYWZ0ZXJcIiwgcGF0aCA9IGJsb2NrLmNoaWxkcmVuLmxlbmd0aCA8PSAxIHx8ICFibG9jay5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFsxXSAtIDFdID8gW3tcbiAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICB9LCBcImNoaWxkcmVuXCIsIDBdIDogW3tcbiAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgIF9rZXk6IGJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdIC0gMV0uX2tleVxuICAgIH1dO1xuICAgIGlmIChUZXh0LmlzVGV4dChvcGVyYXRpb24ubm9kZSkpXG4gICAgICByZXR1cm4gW2luc2VydChbb3BlcmF0aW9uLm5vZGVdLCBwb3NpdGlvbiwgcGF0aCldO1xuICAgIGNvbnN0IF90eXBlID0gb3BlcmF0aW9uLm5vZGUuX3R5cGUsIF9rZXkgPSBvcGVyYXRpb24ubm9kZS5fa2V5LCB2YWx1ZSA9IFwidmFsdWVcIiBpbiBvcGVyYXRpb24ubm9kZSAmJiB0eXBlb2Ygb3BlcmF0aW9uLm5vZGUudmFsdWUgPT0gXCJvYmplY3RcIiA/IG9wZXJhdGlvbi5ub2RlLnZhbHVlIDoge307XG4gICAgcmV0dXJuIFtpbnNlcnQoW3tcbiAgICAgIF90eXBlLFxuICAgICAgX2tleSxcbiAgICAgIC4uLnZhbHVlXG4gICAgfV0sIHBvc2l0aW9uLCBwYXRoKV07XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuZnVuY3Rpb24gc3BsaXROb2RlUGF0Y2goc2NoZW1hLCBjaGlsZHJlbiwgb3BlcmF0aW9uLCBiZWZvcmVWYWx1ZSkge1xuICBjb25zdCBwYXRjaGVzID0gW10sIHNwbGl0QmxvY2sgPSBjaGlsZHJlbltvcGVyYXRpb24ucGF0aFswXV07XG4gIGlmICghaXNUZXh0QmxvY2soe1xuICAgIHNjaGVtYVxuICB9LCBzcGxpdEJsb2NrKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEJsb2NrIHdpdGggcGF0aCAke0pTT04uc3RyaW5naWZ5KG9wZXJhdGlvbi5wYXRoWzBdKX0gaXMgbm90IGEgdGV4dCBibG9jayBhbmQgY2FuJ3QgYmUgc3BsaXRgKTtcbiAgaWYgKG9wZXJhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IG9sZEJsb2NrID0gYmVmb3JlVmFsdWVbb3BlcmF0aW9uLnBhdGhbMF1dO1xuICAgIGlmIChpc1RleHRCbG9jayh7XG4gICAgICBzY2hlbWFcbiAgICB9LCBvbGRCbG9jaykpIHtcbiAgICAgIGNvbnN0IHRhcmdldFZhbHVlID0gZnJvbVNsYXRlQmxvY2soY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMF0gKyAxXSwgc2NoZW1hLmJsb2NrLm5hbWUpO1xuICAgICAgdGFyZ2V0VmFsdWUgJiYgKHBhdGNoZXMucHVzaChpbnNlcnQoW3RhcmdldFZhbHVlXSwgXCJhZnRlclwiLCBbe1xuICAgICAgICBfa2V5OiBzcGxpdEJsb2NrLl9rZXlcbiAgICAgIH1dKSksIG9sZEJsb2NrLmNoaWxkcmVuLnNsaWNlKG9wZXJhdGlvbi5wb3NpdGlvbikuZm9yRWFjaCgoc3BhbikgPT4ge1xuICAgICAgICBjb25zdCBwYXRoID0gW3tcbiAgICAgICAgICBfa2V5OiBvbGRCbG9jay5fa2V5XG4gICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgIF9rZXk6IHNwYW4uX2tleVxuICAgICAgICB9XTtcbiAgICAgICAgcGF0Y2hlcy5wdXNoKHVuc2V0KHBhdGgpKTtcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhdGNoZXM7XG4gIH1cbiAgaWYgKG9wZXJhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMikge1xuICAgIGNvbnN0IHNwbGl0U3BhbiA9IHNwbGl0QmxvY2suY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMV1dO1xuICAgIGlmIChpc1NwYW4oe1xuICAgICAgc2NoZW1hXG4gICAgfSwgc3BsaXRTcGFuKSkge1xuICAgICAgY29uc3QgdGFyZ2V0U3BhbnMgPSBmcm9tU2xhdGVCbG9jayh7XG4gICAgICAgIC4uLnNwbGl0QmxvY2ssXG4gICAgICAgIGNoaWxkcmVuOiBzcGxpdEJsb2NrLmNoaWxkcmVuLnNsaWNlKG9wZXJhdGlvbi5wYXRoWzFdICsgMSwgb3BlcmF0aW9uLnBhdGhbMV0gKyAyKVxuICAgICAgfSwgc2NoZW1hLmJsb2NrLm5hbWUpLmNoaWxkcmVuO1xuICAgICAgcGF0Y2hlcy5wdXNoKGluc2VydCh0YXJnZXRTcGFucywgXCJhZnRlclwiLCBbe1xuICAgICAgICBfa2V5OiBzcGxpdEJsb2NrLl9rZXlcbiAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICBfa2V5OiBzcGxpdFNwYW4uX2tleVxuICAgICAgfV0pKSwgcGF0Y2hlcy5wdXNoKHNldChzcGxpdFNwYW4udGV4dCwgW3tcbiAgICAgICAgX2tleTogc3BsaXRCbG9jay5fa2V5XG4gICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgX2tleTogc3BsaXRTcGFuLl9rZXlcbiAgICAgIH0sIFwidGV4dFwiXSkpO1xuICAgIH1cbiAgICByZXR1cm4gcGF0Y2hlcztcbiAgfVxuICByZXR1cm4gcGF0Y2hlcztcbn1cbmZ1bmN0aW9uIHJlbW92ZU5vZGVQYXRjaChzY2hlbWEsIGJlZm9yZVZhbHVlLCBvcGVyYXRpb24pIHtcbiAgY29uc3QgYmxvY2sgPSBiZWZvcmVWYWx1ZVtvcGVyYXRpb24ucGF0aFswXV07XG4gIGlmIChvcGVyYXRpb24ucGF0aC5sZW5ndGggPT09IDEpIHtcbiAgICBpZiAoYmxvY2sgJiYgYmxvY2suX2tleSlcbiAgICAgIHJldHVybiBbdW5zZXQoW3tcbiAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgfV0pXTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCbG9jayBub3QgZm91bmRcIik7XG4gIH0gZWxzZSBpZiAoaXNUZXh0QmxvY2soe1xuICAgIHNjaGVtYVxuICB9LCBibG9jaykgJiYgb3BlcmF0aW9uLnBhdGgubGVuZ3RoID09PSAyKSB7XG4gICAgY29uc3Qgc3BhblRvUmVtb3ZlID0gYmxvY2suY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMV1dO1xuICAgIHJldHVybiBzcGFuVG9SZW1vdmUgPyBibG9jay5jaGlsZHJlbi5maWx0ZXIoKHNwYW4pID0+IHNwYW4uX2tleSA9PT0gb3BlcmF0aW9uLm5vZGUuX2tleSkubGVuZ3RoID4gMSA/IChjb25zb2xlLndhcm4oYE11bHRpcGxlIHNwYW5zIGhhdmUgXFxgX2tleVxcYCAke29wZXJhdGlvbi5ub2RlLl9rZXl9LiBJdCdzIGFtYmlndW91cyB3aGljaCBvbmUgdG8gcmVtb3ZlLmAsIEpTT04uc3RyaW5naWZ5KGJsb2NrLCBudWxsLCAyKSksIFtdKSA6IFt1bnNldChbe1xuICAgICAgX2tleTogYmxvY2suX2tleVxuICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgX2tleTogc3BhblRvUmVtb3ZlLl9rZXlcbiAgICB9XSldIDogW107XG4gIH0gZWxzZVxuICAgIHJldHVybiBbXTtcbn1cbmZ1bmN0aW9uIG1lcmdlTm9kZVBhdGNoKHNjaGVtYSwgY2hpbGRyZW4sIG9wZXJhdGlvbiwgYmVmb3JlVmFsdWUpIHtcbiAgY29uc3QgcGF0Y2hlcyA9IFtdLCBibG9jayA9IGJlZm9yZVZhbHVlW29wZXJhdGlvbi5wYXRoWzBdXSwgdXBkYXRlZEJsb2NrID0gY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMF1dO1xuICBpZiAob3BlcmF0aW9uLnBhdGgubGVuZ3RoID09PSAxKVxuICAgIGlmIChibG9jaz8uX2tleSkge1xuICAgICAgY29uc3QgbmV3QmxvY2sgPSBmcm9tU2xhdGVCbG9jayhjaGlsZHJlbltvcGVyYXRpb24ucGF0aFswXSAtIDFdLCBzY2hlbWEuYmxvY2submFtZSk7XG4gICAgICBwYXRjaGVzLnB1c2goc2V0KG5ld0Jsb2NrLCBbe1xuICAgICAgICBfa2V5OiBuZXdCbG9jay5fa2V5XG4gICAgICB9XSkpLCBwYXRjaGVzLnB1c2godW5zZXQoW3tcbiAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgfV0pKTtcbiAgICB9IGVsc2VcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRhcmdldCBrZXkgbm90IGZvdW5kIVwiKTtcbiAgZWxzZSBpZiAoaXNUZXh0QmxvY2soe1xuICAgIHNjaGVtYVxuICB9LCBibG9jaykgJiYgaXNUZXh0QmxvY2soe1xuICAgIHNjaGVtYVxuICB9LCB1cGRhdGVkQmxvY2spICYmIG9wZXJhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMikge1xuICAgIGNvbnN0IHVwZGF0ZWRTcGFuID0gdXBkYXRlZEJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdIC0gMV0gJiYgaXNTcGFuKHtcbiAgICAgIHNjaGVtYVxuICAgIH0sIHVwZGF0ZWRCbG9jay5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFsxXSAtIDFdKSA/IHVwZGF0ZWRCbG9jay5jaGlsZHJlbltvcGVyYXRpb24ucGF0aFsxXSAtIDFdIDogdm9pZCAwLCByZW1vdmVkU3BhbiA9IGJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdXSAmJiBpc1NwYW4oe1xuICAgICAgc2NoZW1hXG4gICAgfSwgYmxvY2suY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMV1dKSA/IGJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdXSA6IHZvaWQgMDtcbiAgICB1cGRhdGVkU3BhbiAmJiAoYmxvY2suY2hpbGRyZW4uZmlsdGVyKChzcGFuKSA9PiBzcGFuLl9rZXkgPT09IHVwZGF0ZWRTcGFuLl9rZXkpLmxlbmd0aCA9PT0gMSA/IHBhdGNoZXMucHVzaChzZXQodXBkYXRlZFNwYW4udGV4dCwgW3tcbiAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgIF9rZXk6IHVwZGF0ZWRTcGFuLl9rZXlcbiAgICB9LCBcInRleHRcIl0pKSA6IGNvbnNvbGUud2FybihgTXVsdGlwbGUgc3BhbnMgaGF2ZSBcXGBfa2V5XFxgICR7dXBkYXRlZFNwYW4uX2tleX0uIEl0J3MgYW1iaWd1b3VzIHdoaWNoIG9uZSB0byB1cGRhdGUuYCwgSlNPTi5zdHJpbmdpZnkoYmxvY2ssIG51bGwsIDIpKSksIHJlbW92ZWRTcGFuICYmIChibG9jay5jaGlsZHJlbi5maWx0ZXIoKHNwYW4pID0+IHNwYW4uX2tleSA9PT0gcmVtb3ZlZFNwYW4uX2tleSkubGVuZ3RoID09PSAxID8gcGF0Y2hlcy5wdXNoKHVuc2V0KFt7XG4gICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICBfa2V5OiByZW1vdmVkU3Bhbi5fa2V5XG4gICAgfV0pKSA6IGNvbnNvbGUud2FybihgTXVsdGlwbGUgc3BhbnMgaGF2ZSBcXGBfa2V5XFxgICR7cmVtb3ZlZFNwYW4uX2tleX0uIEl0J3MgYW1iaWd1b3VzIHdoaWNoIG9uZSB0byByZW1vdmUuYCwgSlNPTi5zdHJpbmdpZnkoYmxvY2ssIG51bGwsIDIpKSk7XG4gIH1cbiAgcmV0dXJuIHBhdGNoZXM7XG59XG5mdW5jdGlvbiBtb3ZlTm9kZVBhdGNoKHNjaGVtYSwgYmVmb3JlVmFsdWUsIG9wZXJhdGlvbikge1xuICBjb25zdCBwYXRjaGVzID0gW10sIGJsb2NrID0gYmVmb3JlVmFsdWVbb3BlcmF0aW9uLnBhdGhbMF1dLCB0YXJnZXRCbG9jayA9IGJlZm9yZVZhbHVlW29wZXJhdGlvbi5uZXdQYXRoWzBdXTtcbiAgaWYgKCF0YXJnZXRCbG9jaylcbiAgICByZXR1cm4gcGF0Y2hlcztcbiAgaWYgKG9wZXJhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gb3BlcmF0aW9uLnBhdGhbMF0gPiBvcGVyYXRpb24ubmV3UGF0aFswXSA/IFwiYmVmb3JlXCIgOiBcImFmdGVyXCI7XG4gICAgcGF0Y2hlcy5wdXNoKHVuc2V0KFt7XG4gICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgfV0pKSwgcGF0Y2hlcy5wdXNoKGluc2VydChbYmxvY2tdLCBwb3NpdGlvbiwgW3tcbiAgICAgIF9rZXk6IHRhcmdldEJsb2NrLl9rZXlcbiAgICB9XSkpO1xuICB9IGVsc2UgaWYgKG9wZXJhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMiAmJiBpc1RleHRCbG9jayh7XG4gICAgc2NoZW1hXG4gIH0sIGJsb2NrKSAmJiBpc1RleHRCbG9jayh7XG4gICAgc2NoZW1hXG4gIH0sIHRhcmdldEJsb2NrKSkge1xuICAgIGNvbnN0IGNoaWxkID0gYmxvY2suY2hpbGRyZW5bb3BlcmF0aW9uLnBhdGhbMV1dLCB0YXJnZXRDaGlsZCA9IHRhcmdldEJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5uZXdQYXRoWzFdXSwgcG9zaXRpb24gPSBvcGVyYXRpb24ubmV3UGF0aFsxXSA9PT0gdGFyZ2V0QmxvY2suY2hpbGRyZW4ubGVuZ3RoID8gXCJhZnRlclwiIDogXCJiZWZvcmVcIiwgY2hpbGRUb0luc2VydCA9IGJsb2NrLmNoaWxkcmVuW29wZXJhdGlvbi5wYXRoWzFdXTtcbiAgICBwYXRjaGVzLnB1c2godW5zZXQoW3tcbiAgICAgIF9rZXk6IGJsb2NrLl9rZXlcbiAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgIF9rZXk6IGNoaWxkLl9rZXlcbiAgICB9XSkpLCBwYXRjaGVzLnB1c2goaW5zZXJ0KFtjaGlsZFRvSW5zZXJ0XSwgcG9zaXRpb24sIFt7XG4gICAgICBfa2V5OiB0YXJnZXRCbG9jay5fa2V5XG4gICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICBfa2V5OiB0YXJnZXRDaGlsZC5fa2V5XG4gICAgfV0pKTtcbiAgfVxuICByZXR1cm4gcGF0Y2hlcztcbn1cbmZ1bmN0aW9uIHdpdGhSZW1vdGVDaGFuZ2VzKGVkaXRvciwgZm4pIHtcbiAgY29uc3QgcHJldiA9IGVkaXRvci5pc1Byb2Nlc3NpbmdSZW1vdGVDaGFuZ2VzO1xuICBlZGl0b3IuaXNQcm9jZXNzaW5nUmVtb3RlQ2hhbmdlcyA9ICEwLCBmbigpLCBlZGl0b3IuaXNQcm9jZXNzaW5nUmVtb3RlQ2hhbmdlcyA9IHByZXY7XG59XG5jb25zdCBkZWJ1ZyQ4ID0gZGVidWdXaXRoTmFtZShcInBsdWdpbjp3aXRoUGF0Y2hlc1wiKTtcbmZ1bmN0aW9uIGNyZWF0ZVdpdGhQYXRjaGVzKHtcbiAgZWRpdG9yQWN0b3IsXG4gIHJlbGF5QWN0b3IsXG4gIHN1YnNjcmlwdGlvbnNcbn0pIHtcbiAgbGV0IHByZXZpb3VzVmFsdWU7XG4gIGNvbnN0IGFwcGx5UGF0Y2ggPSBjcmVhdGVBcHBseVBhdGNoKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dCk7XG4gIHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICBwcmV2aW91c1ZhbHVlID0gWy4uLmVkaXRvci52YWx1ZV07XG4gICAgY29uc3Qge1xuICAgICAgYXBwbHk6IGFwcGx5MlxuICAgIH0gPSBlZGl0b3I7XG4gICAgbGV0IGJ1ZmZlcmVkUGF0Y2hlcyA9IFtdO1xuICAgIGNvbnN0IGhhbmRsZUJ1ZmZlcmVkUmVtb3RlUGF0Y2hlcyA9ICgpID0+IHtcbiAgICAgIGlmIChidWZmZXJlZFBhdGNoZXMubGVuZ3RoID09PSAwKVxuICAgICAgICByZXR1cm47XG4gICAgICBjb25zdCBwYXRjaGVzID0gYnVmZmVyZWRQYXRjaGVzO1xuICAgICAgYnVmZmVyZWRQYXRjaGVzID0gW107XG4gICAgICBsZXQgY2hhbmdlZCA9ICExO1xuICAgICAgd2l0aFJlbW90ZUNoYW5nZXMoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgd2l0aG91dFBhdGNoaW5nKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgICAgcGx1Z2luV2l0aG91dEhpc3RvcnkoZWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgcGF0Y2ggb2YgcGF0Y2hlcykge1xuICAgICAgICAgICAgICAgIGRlYnVnJDguZW5hYmxlZCAmJiBkZWJ1ZyQ4KGBIYW5kbGluZyByZW1vdGUgcGF0Y2ggJHtKU09OLnN0cmluZ2lmeShwYXRjaCl9YCk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIGNoYW5nZWQgPSBhcHBseVBhdGNoKGVkaXRvciwgcGF0Y2gpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBBcHBseWluZyBwYXRjaCAke0pTT04uc3RyaW5naWZ5KHBhdGNoKX0gZmFpbGVkIGR1ZSB0bzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLCBjaGFuZ2VkICYmIChlZGl0b3Iubm9ybWFsaXplKCksIGVkaXRvci5vbkNoYW5nZSgpKTtcbiAgICAgIH0pO1xuICAgIH0sIGhhbmRsZVBhdGNoZXMgPSAoe1xuICAgICAgcGF0Y2hlc1xuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IHJlbW90ZVBhdGNoZXMgPSBwYXRjaGVzLmZpbHRlcigocCkgPT4gcC5vcmlnaW4gIT09IFwibG9jYWxcIik7XG4gICAgICByZW1vdGVQYXRjaGVzLmxlbmd0aCAhPT0gMCAmJiAoYnVmZmVyZWRQYXRjaGVzID0gYnVmZmVyZWRQYXRjaGVzLmNvbmNhdChyZW1vdGVQYXRjaGVzKSwgaGFuZGxlQnVmZmVyZWRSZW1vdGVQYXRjaGVzKCkpO1xuICAgIH07XG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbnMucHVzaCgoKSA9PiB7XG4gICAgICBkZWJ1ZyQ4KFwiU3Vic2NyaWJpbmcgdG8gcmVtb3RlIHBhdGNoZXNcIik7XG4gICAgICBjb25zdCBzdWIgPSBlZGl0b3JBY3Rvci5vbihcInBhdGNoZXNcIiwgaGFuZGxlUGF0Y2hlcyk7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBkZWJ1ZyQ4KFwiVW5zdWJzY3JpYmluZyB0byByZW1vdGUgcGF0Y2hlc1wiKSwgc3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICB9O1xuICAgIH0pLCBlZGl0b3IuYXBwbHkgPSAob3BlcmF0aW9uKSA9PiB7XG4gICAgICBsZXQgcGF0Y2hlcyA9IFtdO1xuICAgICAgcHJldmlvdXNWYWx1ZSA9IGVkaXRvci52YWx1ZTtcbiAgICAgIGNvbnN0IGVkaXRvcldhc0VtcHR5ID0gaXNFcXVhbFRvRW1wdHlFZGl0b3IoZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmluaXRpYWxWYWx1ZSwgcHJldmlvdXNWYWx1ZSwgZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSk7XG4gICAgICBhcHBseTIob3BlcmF0aW9uKTtcbiAgICAgIGNvbnN0IGVkaXRvcklzRW1wdHkgPSBpc0VxdWFsVG9FbXB0eUVkaXRvcihlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuaW5pdGlhbFZhbHVlLCBlZGl0b3IudmFsdWUsIGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEpO1xuICAgICAgaWYgKCFlZGl0b3IuaXNQYXRjaGluZylcbiAgICAgICAgcmV0dXJuIGVkaXRvcjtcbiAgICAgIHN3aXRjaCAoZWRpdG9yV2FzRW1wdHkgJiYgIWVkaXRvcklzRW1wdHkgJiYgb3BlcmF0aW9uLnR5cGUgIT09IFwic2V0X3NlbGVjdGlvblwiICYmIHBhdGNoZXMucHVzaChpbnNlcnQocHJldmlvdXNWYWx1ZSwgXCJiZWZvcmVcIiwgWzBdKSksIG9wZXJhdGlvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJpbnNlcnRfdGV4dFwiOlxuICAgICAgICAgIHBhdGNoZXMgPSBbLi4ucGF0Y2hlcywgLi4uaW5zZXJ0VGV4dFBhdGNoKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsIGVkaXRvci5jaGlsZHJlbiwgb3BlcmF0aW9uLCBwcmV2aW91c1ZhbHVlKV07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZW1vdmVfdGV4dFwiOlxuICAgICAgICAgIHBhdGNoZXMgPSBbLi4ucGF0Y2hlcywgLi4ucmVtb3ZlVGV4dFBhdGNoKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsIGVkaXRvci5jaGlsZHJlbiwgb3BlcmF0aW9uLCBwcmV2aW91c1ZhbHVlKV07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZW1vdmVfbm9kZVwiOlxuICAgICAgICAgIHBhdGNoZXMgPSBbLi4ucGF0Y2hlcywgLi4ucmVtb3ZlTm9kZVBhdGNoKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsIHByZXZpb3VzVmFsdWUsIG9wZXJhdGlvbildO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3BsaXRfbm9kZVwiOlxuICAgICAgICAgIHBhdGNoZXMgPSBbLi4ucGF0Y2hlcywgLi4uc3BsaXROb2RlUGF0Y2goZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSwgZWRpdG9yLmNoaWxkcmVuLCBvcGVyYXRpb24sIHByZXZpb3VzVmFsdWUpXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImluc2VydF9ub2RlXCI6XG4gICAgICAgICAgcGF0Y2hlcyA9IFsuLi5wYXRjaGVzLCAuLi5pbnNlcnROb2RlUGF0Y2goZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSwgZWRpdG9yLmNoaWxkcmVuLCBvcGVyYXRpb24sIHByZXZpb3VzVmFsdWUpXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNldF9ub2RlXCI6XG4gICAgICAgICAgcGF0Y2hlcyA9IFsuLi5wYXRjaGVzLCAuLi5zZXROb2RlUGF0Y2goZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSwgZWRpdG9yLmNoaWxkcmVuLCBvcGVyYXRpb24pXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm1lcmdlX25vZGVcIjpcbiAgICAgICAgICBwYXRjaGVzID0gWy4uLnBhdGNoZXMsIC4uLm1lcmdlTm9kZVBhdGNoKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsIGVkaXRvci5jaGlsZHJlbiwgb3BlcmF0aW9uLCBwcmV2aW91c1ZhbHVlKV07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJtb3ZlX25vZGVcIjpcbiAgICAgICAgICBwYXRjaGVzID0gWy4uLnBhdGNoZXMsIC4uLm1vdmVOb2RlUGF0Y2goZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSwgcHJldmlvdXNWYWx1ZSwgb3BlcmF0aW9uKV07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoIWVkaXRvcldhc0VtcHR5ICYmIGVkaXRvcklzRW1wdHkgJiYgW1wibWVyZ2Vfbm9kZVwiLCBcInNldF9ub2RlXCIsIFwicmVtb3ZlX3RleHRcIiwgXCJyZW1vdmVfbm9kZVwiXS5pbmNsdWRlcyhvcGVyYXRpb24udHlwZSkgJiYgKHBhdGNoZXMgPSBbLi4ucGF0Y2hlcywgdW5zZXQoW10pXSwgcmVsYXlBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJ1bnNldFwiLFxuICAgICAgICBwcmV2aW91c1ZhbHVlXG4gICAgICB9KSksIGVkaXRvcldhc0VtcHR5ICYmIHBhdGNoZXMubGVuZ3RoID4gMCAmJiAocGF0Y2hlcyA9IFtzZXRJZk1pc3NpbmcoW10sIFtdKSwgLi4ucGF0Y2hlc10pLCBwYXRjaGVzLmxlbmd0aCA+IDApXG4gICAgICAgIGZvciAoY29uc3QgcGF0Y2ggb2YgcGF0Y2hlcylcbiAgICAgICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgICAgIHR5cGU6IFwiaW50ZXJuYWwucGF0Y2hcIixcbiAgICAgICAgICAgIHBhdGNoOiB7XG4gICAgICAgICAgICAgIC4uLnBhdGNoLFxuICAgICAgICAgICAgICBvcmlnaW46IFwibG9jYWxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wZXJhdGlvbklkOiBlZGl0b3IudW5kb1N0ZXBJZCxcbiAgICAgICAgICAgIHZhbHVlOiBlZGl0b3IudmFsdWVcbiAgICAgICAgICB9KTtcbiAgICAgIHJldHVybiBlZGl0b3I7XG4gICAgfSwgZWRpdG9yO1xuICB9O1xufVxuY29uc3QgZGVidWckNyA9IGRlYnVnV2l0aE5hbWUoXCJwbHVnaW46d2l0aFNjaGVtYVR5cGVzXCIpO1xuZnVuY3Rpb24gY3JlYXRlV2l0aFNjaGVtYSh7XG4gIGVkaXRvckFjdG9yXG59KSB7XG4gIHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICBlZGl0b3IuaXNUZXh0QmxvY2sgPSAodmFsdWUpID0+IEVkaXRvci5pc0VkaXRvcih2YWx1ZSkgPyAhMSA6IGlzVGV4dEJsb2NrKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dCwgdmFsdWUpLCBlZGl0b3IuaXNUZXh0U3BhbiA9ICh2YWx1ZSkgPT4gRWRpdG9yLmlzRWRpdG9yKHZhbHVlKSA/ICExIDogaXNTcGFuKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dCwgdmFsdWUpLCBlZGl0b3IuaXNMaXN0QmxvY2sgPSAodmFsdWUpID0+IEVkaXRvci5pc0VkaXRvcih2YWx1ZSkgPyAhMSA6IGlzTGlzdEJsb2NrKGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dCwgdmFsdWUpLCBlZGl0b3IuaXNWb2lkID0gKGVsZW1lbnQpID0+IEVkaXRvci5pc0VkaXRvcihlbGVtZW50KSA/ICExIDogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lICE9PSBlbGVtZW50Ll90eXBlICYmIChlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQuc2NoZW1hLmJsb2NrT2JqZWN0cy5tYXAoKG9iaikgPT4gb2JqLm5hbWUpLmluY2x1ZGVzKGVsZW1lbnQuX3R5cGUpIHx8IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEuaW5saW5lT2JqZWN0cy5tYXAoKG9iaikgPT4gb2JqLm5hbWUpLmluY2x1ZGVzKGVsZW1lbnQuX3R5cGUpKSwgZWRpdG9yLmlzSW5saW5lID0gKGVsZW1lbnQpID0+IEVkaXRvci5pc0VkaXRvcihlbGVtZW50KSA/ICExIDogZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYS5pbmxpbmVPYmplY3RzLm1hcCgob2JqKSA9PiBvYmoubmFtZSkuaW5jbHVkZXMoZWxlbWVudC5fdHlwZSkgJiYgXCJfX2lubGluZVwiIGluIGVsZW1lbnQgJiYgZWxlbWVudC5fX2lubGluZSA9PT0gITA7XG4gICAgY29uc3Qge1xuICAgICAgbm9ybWFsaXplTm9kZVxuICAgIH0gPSBlZGl0b3I7XG4gICAgcmV0dXJuIGVkaXRvci5ub3JtYWxpemVOb2RlID0gKGVudHJ5KSA9PiB7XG4gICAgICBjb25zdCBbbm9kZSwgcGF0aF0gPSBlbnRyeTtcbiAgICAgIGlmIChub2RlLl90eXBlID09PSB2b2lkIDAgJiYgcGF0aC5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgZGVidWckNyhcIlNldHRpbmcgc3BhbiB0eXBlIG9uIHRleHQgbm9kZSB3aXRob3V0IGEgdHlwZVwiKTtcbiAgICAgICAgY29uc3Qgc3BhbiA9IG5vZGUsIGtleSA9IHNwYW4uX2tleSB8fCBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQua2V5R2VuZXJhdG9yKCk7XG4gICAgICAgIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAuLi5zcGFuLFxuICAgICAgICAgICAgX3R5cGU6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgICAgICAgX2tleToga2V5XG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChub2RlLl9rZXkgPT09IHZvaWQgMCAmJiAocGF0aC5sZW5ndGggPT09IDEgfHwgcGF0aC5sZW5ndGggPT09IDIpKSB7XG4gICAgICAgIGRlYnVnJDcoXCJTZXR0aW5nIG1pc3Npbmcga2V5IG9uIGNoaWxkIG5vZGUgd2l0aG91dCBhIGtleVwiKTtcbiAgICAgICAgY29uc3Qga2V5ID0gZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmtleUdlbmVyYXRvcigpO1xuICAgICAgICB3aXRoTm9ybWFsaXplTm9kZShlZGl0b3IsICgpID0+IHtcbiAgICAgICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwge1xuICAgICAgICAgICAgX2tleToga2V5XG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHdpdGhOb3JtYWxpemVOb2RlKGVkaXRvciwgKCkgPT4ge1xuICAgICAgICBub3JtYWxpemVOb2RlKGVudHJ5KTtcbiAgICAgIH0pO1xuICAgIH0sIGVkaXRvcjtcbiAgfTtcbn1cbmZ1bmN0aW9uIHBsdWdpblVwZGF0ZVNlbGVjdGlvbih7XG4gIGVkaXRvcixcbiAgZWRpdG9yQWN0b3Jcbn0pIHtcbiAgY29uc3QgdXBkYXRlU2VsZWN0aW9uID0gKCkgPT4ge1xuICAgIGlmIChlZGl0b3Iuc2VsZWN0aW9uKVxuICAgICAgaWYgKGVkaXRvci5zZWxlY3Rpb24gPT09IGVkaXRvci5sYXN0U2xhdGVTZWxlY3Rpb24pXG4gICAgICAgIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICAgIHR5cGU6IFwidXBkYXRlIHNlbGVjdGlvblwiLFxuICAgICAgICAgIHNlbGVjdGlvbjogZWRpdG9yLmxhc3RTZWxlY3Rpb25cbiAgICAgICAgfSk7XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gc2xhdGVSYW5nZVRvU2VsZWN0aW9uKHtcbiAgICAgICAgICBzY2hlbWE6IGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgIHJhbmdlOiBlZGl0b3Iuc2VsZWN0aW9uXG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3IubGFzdFNsYXRlU2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbiwgZWRpdG9yLmxhc3RTZWxlY3Rpb24gPSBzZWxlY3Rpb24sIGVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICAgIHR5cGU6IFwidXBkYXRlIHNlbGVjdGlvblwiLFxuICAgICAgICAgIHNlbGVjdGlvblxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICBlbHNlXG4gICAgICBlZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJ1cGRhdGUgc2VsZWN0aW9uXCIsXG4gICAgICAgIHNlbGVjdGlvbjogbnVsbFxuICAgICAgfSk7XG4gIH0sIHtcbiAgICBvbkNoYW5nZVxuICB9ID0gZWRpdG9yO1xuICByZXR1cm4gZWRpdG9yLm9uQ2hhbmdlID0gKCkgPT4ge1xuICAgIG9uQ2hhbmdlKCksIGVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkubWF0Y2hlcyh7XG4gICAgICBzZXR1cDogXCJzZXR0aW5nIHVwXCJcbiAgICB9KSB8fCB1cGRhdGVTZWxlY3Rpb24oKTtcbiAgfSwgZWRpdG9yO1xufVxuZnVuY3Rpb24gaXNFZGl0b3JOb2RlKG5vZGUpIHtcbiAgcmV0dXJuIHR5cGVvZiBub2RlID09IFwib2JqZWN0XCIgJiYgbm9kZSAhPT0gbnVsbCA/ICEoXCJfdHlwZVwiIGluIG5vZGUpICYmIFwiY2hpbGRyZW5cIiBpbiBub2RlICYmIEFycmF5LmlzQXJyYXkobm9kZS5jaGlsZHJlbikgOiAhMTtcbn1cbmZ1bmN0aW9uIGlzVGV4dEJsb2NrTm9kZShjb250ZXh0LCBub2RlKSB7XG4gIHJldHVybiBpc1R5cGVkT2JqZWN0KG5vZGUpICYmIG5vZGUuX3R5cGUgPT09IGNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWU7XG59XG5mdW5jdGlvbiBpc1NwYW5Ob2RlKGNvbnRleHQsIG5vZGUpIHtcbiAgcmV0dXJuIHR5cGVvZiBub2RlICE9IFwib2JqZWN0XCIgfHwgbm9kZSA9PT0gbnVsbCB8fCBcImNoaWxkcmVuXCIgaW4gbm9kZSA/ICExIDogXCJfdHlwZVwiIGluIG5vZGUgPyBub2RlLl90eXBlID09PSBjb250ZXh0LnNjaGVtYS5zcGFuLm5hbWUgOiBcInRleHRcIiBpbiBub2RlO1xufVxuZnVuY3Rpb24gaXNQYXJ0aWFsU3Bhbk5vZGUobm9kZSkge1xuICByZXR1cm4gdHlwZW9mIG5vZGUgPT0gXCJvYmplY3RcIiAmJiBub2RlICE9PSBudWxsICYmIFwidGV4dFwiIGluIG5vZGUgJiYgdHlwZW9mIG5vZGUudGV4dCA9PSBcInN0cmluZ1wiO1xufVxuZnVuY3Rpb24gaXNPYmplY3ROb2RlKGNvbnRleHQsIG5vZGUpIHtcbiAgcmV0dXJuICFpc0VkaXRvck5vZGUobm9kZSkgJiYgIWlzVGV4dEJsb2NrTm9kZShjb250ZXh0LCBub2RlKSAmJiAhaXNTcGFuTm9kZShjb250ZXh0LCBub2RlKSAmJiAhaXNQYXJ0aWFsU3Bhbk5vZGUobm9kZSk7XG59XG5mdW5jdGlvbiBnZXRCbG9jayhyb290LCBwYXRoKSB7XG4gIGNvbnN0IGluZGV4ID0gcGF0aC5hdCgwKTtcbiAgaWYgKCEoaW5kZXggPT09IHZvaWQgMCB8fCBwYXRoLmxlbmd0aCAhPT0gMSkpXG4gICAgcmV0dXJuIHJvb3QuY2hpbGRyZW4uYXQoaW5kZXgpO1xufVxuZnVuY3Rpb24gZ2V0Tm9kZShjb250ZXh0LCByb290LCBwYXRoKSB7XG4gIGlmIChwYXRoLmxlbmd0aCA9PT0gMClcbiAgICByZXR1cm4gcm9vdDtcbiAgaWYgKHBhdGgubGVuZ3RoID09PSAxKVxuICAgIHJldHVybiBnZXRCbG9jayhyb290LCBwYXRoKTtcbiAgaWYgKHBhdGgubGVuZ3RoID09PSAyKSB7XG4gICAgY29uc3QgYmxvY2sgPSBnZXRCbG9jayhyb290LCBwYXRoLnNsaWNlKDAsIDEpKTtcbiAgICByZXR1cm4gIWJsb2NrIHx8ICFpc1RleHRCbG9ja05vZGUoY29udGV4dCwgYmxvY2spID8gdm9pZCAwIDogYmxvY2suY2hpbGRyZW4uYXQocGF0aFsxXSkgfHwgdm9pZCAwO1xuICB9XG59XG5mdW5jdGlvbiBnZXRTcGFuKGNvbnRleHQsIHJvb3QsIHBhdGgpIHtcbiAgY29uc3Qgbm9kZSA9IGdldE5vZGUoY29udGV4dCwgcm9vdCwgcGF0aCk7XG4gIGlmIChub2RlICYmIGlzU3Bhbk5vZGUoY29udGV4dCwgbm9kZSkpXG4gICAgcmV0dXJuIG5vZGU7XG59XG5mdW5jdGlvbiBnZXRQYXJlbnQoY29udGV4dCwgcm9vdCwgcGF0aCkge1xuICBpZiAocGF0aC5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuO1xuICBjb25zdCBwYXJlbnRQYXRoID0gcGF0aC5zbGljZSgwLCAtMSk7XG4gIGlmIChwYXJlbnRQYXRoLmxlbmd0aCA9PT0gMClcbiAgICByZXR1cm4gcm9vdDtcbiAgY29uc3QgYmxvY2tJbmRleCA9IHBhcmVudFBhdGguYXQoMCk7XG4gIGlmIChibG9ja0luZGV4ID09PSB2b2lkIDAgfHwgcGFyZW50UGF0aC5sZW5ndGggIT09IDEpXG4gICAgcmV0dXJuO1xuICBjb25zdCBibG9jayA9IHJvb3QuY2hpbGRyZW4uYXQoYmxvY2tJbmRleCk7XG4gIGlmIChibG9jayAmJiBpc1RleHRCbG9ja05vZGUoY29udGV4dCwgYmxvY2spKVxuICAgIHJldHVybiBibG9jaztcbn1cbmZ1bmN0aW9uIGFwcGx5T3BlcmF0aW9uVG9Qb3J0YWJsZVRleHQoY29udGV4dCwgdmFsdWUsIG9wZXJhdGlvbikge1xuICBjb25zdCByb290ID0ge1xuICAgIGNoaWxkcmVuOiB2YWx1ZVxuICB9O1xuICB0cnkge1xuICAgIHJldHVybiBhcHBseU9wZXJhdGlvblRvUG9ydGFibGVUZXh0SW1tdXRhYmxlKGNvbnRleHQsIHJvb3QsIG9wZXJhdGlvbikuY2hpbGRyZW47XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gY29uc29sZS5lcnJvcihlKSwgdmFsdWU7XG4gIH1cbn1cbmZ1bmN0aW9uIGFwcGx5T3BlcmF0aW9uVG9Qb3J0YWJsZVRleHRJbW11dGFibGUoY29udGV4dCwgcm9vdCwgb3BlcmF0aW9uKSB7XG4gIHN3aXRjaCAob3BlcmF0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFwiaW5zZXJ0X25vZGVcIjoge1xuICAgICAgY29uc3Qge1xuICAgICAgICBwYXRoLFxuICAgICAgICBub2RlOiBpbnNlcnRlZE5vZGVcbiAgICAgIH0gPSBvcGVyYXRpb24sIHBhcmVudCA9IGdldFBhcmVudChjb250ZXh0LCByb290LCBwYXRoKSwgaW5kZXggPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07XG4gICAgICBpZiAoIXBhcmVudCB8fCBpbmRleCA+IHBhcmVudC5jaGlsZHJlbi5sZW5ndGgpXG4gICAgICAgIHJldHVybiByb290O1xuICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGlmIChpc1RleHRCbG9ja05vZGUoY29udGV4dCwgaW5zZXJ0ZWROb2RlKSkge1xuICAgICAgICAgIGNvbnN0IG5ld0Jsb2NrID0ge1xuICAgICAgICAgICAgLi4uaW5zZXJ0ZWROb2RlLFxuICAgICAgICAgICAgY2hpbGRyZW46IGluc2VydGVkTm9kZS5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBcIl9faW5saW5lXCIgaW4gY2hpbGQgPyB7XG4gICAgICAgICAgICAgIF9rZXk6IGNoaWxkLl9rZXksXG4gICAgICAgICAgICAgIF90eXBlOiBjaGlsZC5fdHlwZSxcbiAgICAgICAgICAgICAgLi4uXCJ2YWx1ZVwiIGluIGNoaWxkICYmIHR5cGVvZiBjaGlsZC52YWx1ZSA9PSBcIm9iamVjdFwiID8gY2hpbGQudmFsdWUgOiB7fVxuICAgICAgICAgICAgfSA6IGNoaWxkKVxuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnJvb3QsXG4gICAgICAgICAgICBjaGlsZHJlbjogaW5zZXJ0Q2hpbGRyZW4ocm9vdC5jaGlsZHJlbiwgaW5kZXgsIG5ld0Jsb2NrKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEVsZW1lbnQkMS5pc0VsZW1lbnQoaW5zZXJ0ZWROb2RlKSAmJiAhKFwiX19pbmxpbmVcIiBpbiBpbnNlcnRlZE5vZGUpKSB7XG4gICAgICAgICAgY29uc3QgbmV3QmxvY2sgPSB7XG4gICAgICAgICAgICBfa2V5OiBpbnNlcnRlZE5vZGUuX2tleSxcbiAgICAgICAgICAgIF90eXBlOiBpbnNlcnRlZE5vZGUuX3R5cGUsXG4gICAgICAgICAgICAuLi5cInZhbHVlXCIgaW4gaW5zZXJ0ZWROb2RlICYmIHR5cGVvZiBpbnNlcnRlZE5vZGUudmFsdWUgPT0gXCJvYmplY3RcIiA/IGluc2VydGVkTm9kZS52YWx1ZSA6IHt9XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4ucm9vdCxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBpbnNlcnRDaGlsZHJlbihyb290LmNoaWxkcmVuLCBpbmRleCwgbmV3QmxvY2spXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBwYXRoWzBdO1xuICAgICAgICBpZiAoIWlzVGV4dEJsb2NrTm9kZShjb250ZXh0LCBwYXJlbnQpKVxuICAgICAgICAgIHJldHVybiByb290O1xuICAgICAgICBsZXQgbmV3Q2hpbGQ7XG4gICAgICAgIGlmIChpc1BhcnRpYWxTcGFuTm9kZShpbnNlcnRlZE5vZGUpKVxuICAgICAgICAgIG5ld0NoaWxkID0gaW5zZXJ0ZWROb2RlO1xuICAgICAgICBlbHNlIGlmIChcIl9faW5saW5lXCIgaW4gaW5zZXJ0ZWROb2RlKVxuICAgICAgICAgIG5ld0NoaWxkID0ge1xuICAgICAgICAgICAgX2tleTogaW5zZXJ0ZWROb2RlLl9rZXksXG4gICAgICAgICAgICBfdHlwZTogaW5zZXJ0ZWROb2RlLl90eXBlLFxuICAgICAgICAgICAgLi4uXCJ2YWx1ZVwiIGluIGluc2VydGVkTm9kZSAmJiB0eXBlb2YgaW5zZXJ0ZWROb2RlLnZhbHVlID09IFwib2JqZWN0XCIgPyBpbnNlcnRlZE5vZGUudmFsdWUgOiB7fVxuICAgICAgICAgIH07XG4gICAgICAgIGVsc2VcbiAgICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgICAgcmV0dXJuIHVwZGF0ZVRleHRCbG9ja0F0SW5kZXgoY29udGV4dCwgcm9vdCwgYmxvY2tJbmRleCwgKGJsb2NrKSA9PiAoe1xuICAgICAgICAgIC4uLmJsb2NrLFxuICAgICAgICAgIGNoaWxkcmVuOiBpbnNlcnRDaGlsZHJlbihibG9jay5jaGlsZHJlbiwgaW5kZXgsIG5ld0NoaWxkKVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcm9vdDtcbiAgICB9XG4gICAgY2FzZSBcImluc2VydF90ZXh0XCI6IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGF0aCxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgICB0ZXh0XG4gICAgICB9ID0gb3BlcmF0aW9uO1xuICAgICAgaWYgKHRleHQubGVuZ3RoID09PSAwKVxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgIGNvbnN0IHNwYW4gPSBnZXRTcGFuKGNvbnRleHQsIHJvb3QsIHBhdGgpO1xuICAgICAgaWYgKCFzcGFuKVxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBwYXRoWzBdLCBjaGlsZEluZGV4ID0gcGF0aFsxXSwgYmVmb3JlID0gc3Bhbi50ZXh0LnNsaWNlKDAsIG9mZnNldCksIGFmdGVyID0gc3Bhbi50ZXh0LnNsaWNlKG9mZnNldCksIG5ld1NwYW4gPSB7XG4gICAgICAgIC4uLnNwYW4sXG4gICAgICAgIHRleHQ6IGJlZm9yZSArIHRleHQgKyBhZnRlclxuICAgICAgfTtcbiAgICAgIHJldHVybiB1cGRhdGVUZXh0QmxvY2tBdEluZGV4KGNvbnRleHQsIHJvb3QsIGJsb2NrSW5kZXgsIChibG9jaykgPT4gKHtcbiAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgIGNoaWxkcmVuOiByZXBsYWNlQ2hpbGQoYmxvY2suY2hpbGRyZW4sIGNoaWxkSW5kZXgsIG5ld1NwYW4pXG4gICAgICB9KSk7XG4gICAgfVxuICAgIGNhc2UgXCJtZXJnZV9ub2RlXCI6IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGF0aFxuICAgICAgfSA9IG9wZXJhdGlvbjtcbiAgICAgIGlmIChwYXRoLmF0KC0xKSA9PT0gMClcbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICBjb25zdCBub2RlID0gZ2V0Tm9kZShjb250ZXh0LCByb290LCBwYXRoKSwgcHJldlBhdGggPSBQYXRoLnByZXZpb3VzKHBhdGgpLCBwcmV2ID0gZ2V0Tm9kZShjb250ZXh0LCByb290LCBwcmV2UGF0aCksIHBhcmVudCA9IGdldFBhcmVudChjb250ZXh0LCByb290LCBwYXRoKTtcbiAgICAgIGlmICghbm9kZSB8fCAhcHJldiB8fCAhcGFyZW50KVxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgIGNvbnN0IGluZGV4ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKGlzUGFydGlhbFNwYW5Ob2RlKG5vZGUpICYmIGlzUGFydGlhbFNwYW5Ob2RlKHByZXYpKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBwYXRoWzBdLCBuZXdQcmV2ID0ge1xuICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgdGV4dDogcHJldi50ZXh0ICsgbm9kZS50ZXh0XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB1cGRhdGVUZXh0QmxvY2tBdEluZGV4KGNvbnRleHQsIHJvb3QsIGJsb2NrSW5kZXgsIChibG9jaykgPT4ge1xuICAgICAgICAgIGNvbnN0IG5ld0NoaWxkcmVuID0gcmVwbGFjZUNoaWxkKGJsb2NrLmNoaWxkcmVuLCBpbmRleCAtIDEsIG5ld1ByZXYpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5ibG9jayxcbiAgICAgICAgICAgIGNoaWxkcmVuOiByZW1vdmVDaGlsZHJlbihuZXdDaGlsZHJlbiwgaW5kZXgpXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoaXNUZXh0QmxvY2tOb2RlKGNvbnRleHQsIG5vZGUpICYmIGlzVGV4dEJsb2NrTm9kZShjb250ZXh0LCBwcmV2KSkge1xuICAgICAgICBjb25zdCBuZXdQcmV2ID0ge1xuICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgY2hpbGRyZW46IFsuLi5wcmV2LmNoaWxkcmVuLCAuLi5ub2RlLmNoaWxkcmVuXVxuICAgICAgICB9LCBuZXdDaGlsZHJlbiA9IHJlcGxhY2VDaGlsZChyb290LmNoaWxkcmVuLCBpbmRleCAtIDEsIG5ld1ByZXYpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnJvb3QsXG4gICAgICAgICAgY2hpbGRyZW46IHJlbW92ZUNoaWxkcmVuKG5ld0NoaWxkcmVuLCBpbmRleClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByb290O1xuICAgIH1cbiAgICBjYXNlIFwibW92ZV9ub2RlXCI6IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGF0aCxcbiAgICAgICAgbmV3UGF0aFxuICAgICAgfSA9IG9wZXJhdGlvbjtcbiAgICAgIGlmIChQYXRoLmlzQW5jZXN0b3IocGF0aCwgbmV3UGF0aCkpXG4gICAgICAgIHJldHVybiByb290O1xuICAgICAgY29uc3Qgbm9kZSA9IGdldE5vZGUoY29udGV4dCwgcm9vdCwgcGF0aCksIHBhcmVudCA9IGdldFBhcmVudChjb250ZXh0LCByb290LCBwYXRoKSwgaW5kZXggPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07XG4gICAgICBpZiAoIW5vZGUgfHwgIXBhcmVudClcbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICBsZXQgbmV3Um9vdDtcbiAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMSlcbiAgICAgICAgbmV3Um9vdCA9IHtcbiAgICAgICAgICAuLi5yb290LFxuICAgICAgICAgIGNoaWxkcmVuOiByZW1vdmVDaGlsZHJlbihyb290LmNoaWxkcmVuLCBpbmRleClcbiAgICAgICAgfTtcbiAgICAgIGVsc2UgaWYgKHBhdGgubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBwYXRoWzBdO1xuICAgICAgICBuZXdSb290ID0gdXBkYXRlVGV4dEJsb2NrQXRJbmRleChjb250ZXh0LCByb290LCBibG9ja0luZGV4LCAoYmxvY2spID0+ICh7XG4gICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgY2hpbGRyZW46IHJlbW92ZUNoaWxkcmVuKGJsb2NrLmNoaWxkcmVuLCBpbmRleClcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlXG4gICAgICAgIHJldHVybiByb290O1xuICAgICAgY29uc3QgdHJ1ZVBhdGggPSBQYXRoLnRyYW5zZm9ybShwYXRoLCBvcGVyYXRpb24pLCBuZXdJbmRleCA9IHRydWVQYXRoW3RydWVQYXRoLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKHRydWVQYXRoLmxlbmd0aCA9PT0gMSlcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5uZXdSb290LFxuICAgICAgICAgIGNoaWxkcmVuOiBpbnNlcnRDaGlsZHJlbihuZXdSb290LmNoaWxkcmVuLCBuZXdJbmRleCwgbm9kZSlcbiAgICAgICAgfTtcbiAgICAgIGlmICh0cnVlUGF0aC5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgY29uc3QgbmV3QmxvY2tJbmRleCA9IHRydWVQYXRoWzBdLCBuZXdQYXJlbnQgPSBuZXdSb290LmNoaWxkcmVuW25ld0Jsb2NrSW5kZXhdO1xuICAgICAgICByZXR1cm4gIW5ld1BhcmVudCB8fCAhaXNUZXh0QmxvY2tOb2RlKGNvbnRleHQsIG5ld1BhcmVudCkgPyByb290IDogdXBkYXRlVGV4dEJsb2NrQXRJbmRleChjb250ZXh0LCBuZXdSb290LCBuZXdCbG9ja0luZGV4LCAoYmxvY2spID0+ICh7XG4gICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgY2hpbGRyZW46IGluc2VydENoaWxkcmVuKGJsb2NrLmNoaWxkcmVuLCBuZXdJbmRleCwgbm9kZSlcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIGNhc2UgXCJyZW1vdmVfbm9kZVwiOiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHBhdGhcbiAgICAgIH0gPSBvcGVyYXRpb24sIGluZGV4ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKCFnZXRQYXJlbnQoY29udGV4dCwgcm9vdCwgcGF0aCkpXG4gICAgICAgIHJldHVybiByb290O1xuICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAxKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnJvb3QsXG4gICAgICAgICAgY2hpbGRyZW46IHJlbW92ZUNoaWxkcmVuKHJvb3QuY2hpbGRyZW4sIGluZGV4KVxuICAgICAgICB9O1xuICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBwYXRoWzBdO1xuICAgICAgICByZXR1cm4gdXBkYXRlVGV4dEJsb2NrQXRJbmRleChjb250ZXh0LCByb290LCBibG9ja0luZGV4LCAoYmxvY2spID0+ICh7XG4gICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgY2hpbGRyZW46IHJlbW92ZUNoaWxkcmVuKGJsb2NrLmNoaWxkcmVuLCBpbmRleClcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIGNhc2UgXCJyZW1vdmVfdGV4dFwiOiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHBhdGgsXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgdGV4dFxuICAgICAgfSA9IG9wZXJhdGlvbjtcbiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICBjb25zdCBzcGFuID0gZ2V0U3Bhbihjb250ZXh0LCByb290LCBwYXRoKTtcbiAgICAgIGlmICghc3BhbilcbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICBjb25zdCBibG9ja0luZGV4ID0gcGF0aFswXSwgY2hpbGRJbmRleCA9IHBhdGhbMV0sIGJlZm9yZSA9IHNwYW4udGV4dC5zbGljZSgwLCBvZmZzZXQpLCBhZnRlciA9IHNwYW4udGV4dC5zbGljZShvZmZzZXQgKyB0ZXh0Lmxlbmd0aCksIG5ld1NwYW4gPSB7XG4gICAgICAgIC4uLnNwYW4sXG4gICAgICAgIHRleHQ6IGJlZm9yZSArIGFmdGVyXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHVwZGF0ZVRleHRCbG9ja0F0SW5kZXgoY29udGV4dCwgcm9vdCwgYmxvY2tJbmRleCwgKGJsb2NrKSA9PiAoe1xuICAgICAgICAuLi5ibG9jayxcbiAgICAgICAgY2hpbGRyZW46IHJlcGxhY2VDaGlsZChibG9jay5jaGlsZHJlbiwgY2hpbGRJbmRleCwgbmV3U3BhbilcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgY2FzZSBcInNldF9ub2RlXCI6IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGF0aCxcbiAgICAgICAgcHJvcGVydGllcyxcbiAgICAgICAgbmV3UHJvcGVydGllc1xuICAgICAgfSA9IG9wZXJhdGlvbiwgbm9kZSA9IGdldE5vZGUoY29udGV4dCwgcm9vdCwgcGF0aCk7XG4gICAgICBpZiAoIW5vZGUgfHwgaXNFZGl0b3JOb2RlKG5vZGUpKVxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgIGlmIChpc09iamVjdE5vZGUoY29udGV4dCwgbm9kZSkpIHtcbiAgICAgICAgY29uc3QgdmFsdWVCZWZvcmUgPSBcInZhbHVlXCIgaW4gcHJvcGVydGllcyAmJiB0eXBlb2YgcHJvcGVydGllcy52YWx1ZSA9PSBcIm9iamVjdFwiID8gcHJvcGVydGllcy52YWx1ZSA6IHt9LCB2YWx1ZUFmdGVyID0gXCJ2YWx1ZVwiIGluIG5ld1Byb3BlcnRpZXMgJiYgdHlwZW9mIG5ld1Byb3BlcnRpZXMudmFsdWUgPT0gXCJvYmplY3RcIiA/IG5ld1Byb3BlcnRpZXMudmFsdWUgOiB7fSwgbmV3Tm9kZSA9IHtcbiAgICAgICAgICAuLi5ub2RlXG4gICAgICAgIH07XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIG5ld1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICBpZiAoa2V5ID09PSBcInZhbHVlXCIpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IG5ld1Byb3BlcnRpZXNba2V5XTtcbiAgICAgICAgICB2YWx1ZSA9PSBudWxsID8gZGVsZXRlIG5ld05vZGVba2V5XSA6IG5ld05vZGVba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHByb3BlcnRpZXMpXG4gICAgICAgICAga2V5ICE9PSBcInZhbHVlXCIgJiYgKG5ld1Byb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoa2V5KSB8fCBkZWxldGUgbmV3Tm9kZVtrZXldKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdmFsdWVBZnRlcikge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVBZnRlcltrZXldO1xuICAgICAgICAgIHZhbHVlID09IG51bGwgPyBkZWxldGUgbmV3Tm9kZVtrZXldIDogbmV3Tm9kZVtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdmFsdWVCZWZvcmUpXG4gICAgICAgICAgdmFsdWVBZnRlci5oYXNPd25Qcm9wZXJ0eShrZXkpIHx8IGRlbGV0ZSBuZXdOb2RlW2tleV07XG4gICAgICAgIHJldHVybiBwYXRoLmxlbmd0aCA9PT0gMSA/IHtcbiAgICAgICAgICAuLi5yb290LFxuICAgICAgICAgIGNoaWxkcmVuOiByZXBsYWNlQ2hpbGQocm9vdC5jaGlsZHJlbiwgcGF0aFswXSwgbmV3Tm9kZSlcbiAgICAgICAgfSA6IHBhdGgubGVuZ3RoID09PSAyID8gdXBkYXRlVGV4dEJsb2NrQXRJbmRleChjb250ZXh0LCByb290LCBwYXRoWzBdLCAoYmxvY2spID0+ICh7XG4gICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgY2hpbGRyZW46IHJlcGxhY2VDaGlsZChibG9jay5jaGlsZHJlbiwgcGF0aFsxXSwgbmV3Tm9kZSlcbiAgICAgICAgfSkpIDogcm9vdDtcbiAgICAgIH1cbiAgICAgIGlmIChpc1RleHRCbG9ja05vZGUoY29udGV4dCwgbm9kZSkpIHtcbiAgICAgICAgY29uc3QgbmV3Tm9kZSA9IHtcbiAgICAgICAgICAuLi5ub2RlXG4gICAgICAgIH07XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIG5ld1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICBpZiAoa2V5ID09PSBcImNoaWxkcmVuXCIgfHwga2V5ID09PSBcInRleHRcIilcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3UHJvcGVydGllc1trZXldO1xuICAgICAgICAgIHZhbHVlID09IG51bGwgPyBkZWxldGUgbmV3Tm9kZVtrZXldIDogbmV3Tm9kZVtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcHJvcGVydGllcylcbiAgICAgICAgICBuZXdQcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KGtleSkgfHwgZGVsZXRlIG5ld05vZGVba2V5XTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5yb290LFxuICAgICAgICAgIGNoaWxkcmVuOiByZXBsYWNlQ2hpbGQocm9vdC5jaGlsZHJlbiwgcGF0aFswXSwgbmV3Tm9kZSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1BhcnRpYWxTcGFuTm9kZShub2RlKSkge1xuICAgICAgICBjb25zdCBuZXdOb2RlID0ge1xuICAgICAgICAgIC4uLm5vZGVcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbmV3UHJvcGVydGllcykge1xuICAgICAgICAgIGlmIChrZXkgPT09IFwidGV4dFwiKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBuZXdQcm9wZXJ0aWVzW2tleV07XG4gICAgICAgICAgdmFsdWUgPT0gbnVsbCA/IGRlbGV0ZSBuZXdOb2RlW2tleV0gOiBuZXdOb2RlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wZXJ0aWVzKVxuICAgICAgICAgIG5ld1Byb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoa2V5KSB8fCBkZWxldGUgbmV3Tm9kZVtrZXldO1xuICAgICAgICByZXR1cm4gdXBkYXRlVGV4dEJsb2NrQXRJbmRleChjb250ZXh0LCByb290LCBwYXRoWzBdLCAoYmxvY2spID0+ICh7XG4gICAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgICAgY2hpbGRyZW46IHJlcGxhY2VDaGlsZChibG9jay5jaGlsZHJlbiwgcGF0aFsxXSwgbmV3Tm9kZSlcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIGNhc2UgXCJzcGxpdF9ub2RlXCI6IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGF0aCxcbiAgICAgICAgcG9zaXRpb24sXG4gICAgICAgIHByb3BlcnRpZXNcbiAgICAgIH0gPSBvcGVyYXRpb247XG4gICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiByb290O1xuICAgICAgY29uc3QgcGFyZW50ID0gZ2V0UGFyZW50KGNvbnRleHQsIHJvb3QsIHBhdGgpLCBpbmRleCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcbiAgICAgIGlmICghcGFyZW50KVxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgIGlmIChpc0VkaXRvck5vZGUocGFyZW50KSkge1xuICAgICAgICBjb25zdCBibG9jayA9IGdldEJsb2NrKHJvb3QsIHBhdGgpO1xuICAgICAgICBpZiAoIWJsb2NrIHx8ICFpc1RleHRCbG9ja05vZGUoY29udGV4dCwgYmxvY2spKVxuICAgICAgICAgIHJldHVybiByb290O1xuICAgICAgICBjb25zdCBiZWZvcmUgPSBibG9jay5jaGlsZHJlbi5zbGljZSgwLCBwb3NpdGlvbiksIGFmdGVyID0gYmxvY2suY2hpbGRyZW4uc2xpY2UocG9zaXRpb24pLCB1cGRhdGVkVGV4dEJsb2NrTm9kZSA9IHtcbiAgICAgICAgICAuLi5ibG9jayxcbiAgICAgICAgICBjaGlsZHJlbjogYmVmb3JlXG4gICAgICAgIH0sIG5ld1RleHRCbG9ja05vZGUgPSB7XG4gICAgICAgICAgLi4ucHJvcGVydGllcyxcbiAgICAgICAgICBjaGlsZHJlbjogYWZ0ZXIsXG4gICAgICAgICAgX3R5cGU6IGNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWVcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5yb290LFxuICAgICAgICAgIGNoaWxkcmVuOiBpbnNlcnRDaGlsZHJlbihyZXBsYWNlQ2hpbGQocm9vdC5jaGlsZHJlbiwgaW5kZXgsIHVwZGF0ZWRUZXh0QmxvY2tOb2RlKSwgaW5kZXggKyAxLCBuZXdUZXh0QmxvY2tOb2RlKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKGlzVGV4dEJsb2NrTm9kZShjb250ZXh0LCBwYXJlbnQpKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBnZXROb2RlKGNvbnRleHQsIHJvb3QsIHBhdGgpO1xuICAgICAgICBpZiAoIW5vZGUgfHwgIWlzU3Bhbk5vZGUoY29udGV4dCwgbm9kZSkpXG4gICAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICAgIGNvbnN0IGJsb2NrSW5kZXggPSBwYXRoWzBdLCBiZWZvcmUgPSBub2RlLnRleHQuc2xpY2UoMCwgcG9zaXRpb24pLCBhZnRlciA9IG5vZGUudGV4dC5zbGljZShwb3NpdGlvbiksIHVwZGF0ZWRTcGFuTm9kZSA9IHtcbiAgICAgICAgICAuLi5ub2RlLFxuICAgICAgICAgIHRleHQ6IGJlZm9yZVxuICAgICAgICB9LCBuZXdTcGFuTm9kZSA9IHtcbiAgICAgICAgICAuLi5wcm9wZXJ0aWVzLFxuICAgICAgICAgIHRleHQ6IGFmdGVyXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB1cGRhdGVUZXh0QmxvY2tBdEluZGV4KGNvbnRleHQsIHJvb3QsIGJsb2NrSW5kZXgsIChibG9jaykgPT4gKHtcbiAgICAgICAgICAuLi5ibG9jayxcbiAgICAgICAgICBjaGlsZHJlbjogaW5zZXJ0Q2hpbGRyZW4ocmVwbGFjZUNoaWxkKGJsb2NrLmNoaWxkcmVuLCBpbmRleCwgdXBkYXRlZFNwYW5Ob2RlKSwgaW5kZXggKyAxLCBuZXdTcGFuTm9kZSlcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBpbnNlcnRDaGlsZHJlbihjaGlsZHJlbiwgaW5kZXgsIC4uLm5vZGVzKSB7XG4gIHJldHVybiBbLi4uY2hpbGRyZW4uc2xpY2UoMCwgaW5kZXgpLCAuLi5ub2RlcywgLi4uY2hpbGRyZW4uc2xpY2UoaW5kZXgpXTtcbn1cbmZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuKGNoaWxkcmVuLCBpbmRleCwgY291bnQgPSAxKSB7XG4gIHJldHVybiBbLi4uY2hpbGRyZW4uc2xpY2UoMCwgaW5kZXgpLCAuLi5jaGlsZHJlbi5zbGljZShpbmRleCArIGNvdW50KV07XG59XG5mdW5jdGlvbiByZXBsYWNlQ2hpbGQoY2hpbGRyZW4sIGluZGV4LCBuZXdDaGlsZCkge1xuICByZXR1cm4gWy4uLmNoaWxkcmVuLnNsaWNlKDAsIGluZGV4KSwgbmV3Q2hpbGQsIC4uLmNoaWxkcmVuLnNsaWNlKGluZGV4ICsgMSldO1xufVxuZnVuY3Rpb24gdXBkYXRlVGV4dEJsb2NrQXRJbmRleChjb250ZXh0LCByb290LCBibG9ja0luZGV4LCB1cGRhdGVyKSB7XG4gIGNvbnN0IGJsb2NrID0gcm9vdC5jaGlsZHJlbi5hdChibG9ja0luZGV4KTtcbiAgaWYgKCFibG9jayB8fCAhaXNUZXh0QmxvY2tOb2RlKGNvbnRleHQsIGJsb2NrKSlcbiAgICByZXR1cm4gcm9vdDtcbiAgY29uc3QgbmV3QmxvY2sgPSB1cGRhdGVyKGJsb2NrKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5yb290LFxuICAgIGNoaWxkcmVuOiByZXBsYWNlQ2hpbGQocm9vdC5jaGlsZHJlbiwgYmxvY2tJbmRleCwgbmV3QmxvY2spXG4gIH07XG59XG5mdW5jdGlvbiBwbHVnaW5VcGRhdGVWYWx1ZShjb250ZXh0LCBlZGl0b3IpIHtcbiAgY29uc3Qge1xuICAgIGFwcGx5OiBhcHBseTJcbiAgfSA9IGVkaXRvcjtcbiAgcmV0dXJuIGVkaXRvci5hcHBseSA9IChvcGVyYXRpb24pID0+IHtcbiAgICBpZiAob3BlcmF0aW9uLnR5cGUgPT09IFwic2V0X3NlbGVjdGlvblwiKSB7XG4gICAgICBhcHBseTIob3BlcmF0aW9uKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGVkaXRvci52YWx1ZSA9IGFwcGx5T3BlcmF0aW9uVG9Qb3J0YWJsZVRleHQoY29udGV4dCwgZWRpdG9yLnZhbHVlLCBvcGVyYXRpb24pLCBvcGVyYXRpb24udHlwZSA9PT0gXCJpbnNlcnRfdGV4dFwiIHx8IG9wZXJhdGlvbi50eXBlID09PSBcInJlbW92ZV90ZXh0XCIpIHtcbiAgICAgIGFwcGx5MihvcGVyYXRpb24pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBidWlsZEluZGV4TWFwcyh7XG4gICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hLFxuICAgICAgdmFsdWU6IGVkaXRvci52YWx1ZVxuICAgIH0sIHtcbiAgICAgIGJsb2NrSW5kZXhNYXA6IGVkaXRvci5ibG9ja0luZGV4TWFwLFxuICAgICAgbGlzdEluZGV4TWFwOiBlZGl0b3IubGlzdEluZGV4TWFwXG4gICAgfSksIGFwcGx5MihvcGVyYXRpb24pO1xuICB9LCBlZGl0b3I7XG59XG5jb25zdCB3aXRoUGx1Z2lucyA9IChlZGl0b3IsIG9wdGlvbnMpID0+IHtcbiAgY29uc3QgZSA9IGVkaXRvciwge1xuICAgIGVkaXRvckFjdG9yLFxuICAgIHJlbGF5QWN0b3JcbiAgfSA9IG9wdGlvbnMsIHdpdGhPYmplY3RLZXlzID0gY3JlYXRlV2l0aE9iamVjdEtleXMoZWRpdG9yQWN0b3IpLCB3aXRoU2NoZW1hID0gY3JlYXRlV2l0aFNjaGVtYSh7XG4gICAgZWRpdG9yQWN0b3JcbiAgfSksIHdpdGhQYXRjaGVzID0gY3JlYXRlV2l0aFBhdGNoZXMoe1xuICAgIGVkaXRvckFjdG9yLFxuICAgIHJlbGF5QWN0b3IsXG4gICAgc3Vic2NyaXB0aW9uczogb3B0aW9ucy5zdWJzY3JpcHRpb25zXG4gIH0pLCB3aXRoVW5kb1JlZG8gPSBwbHVnaW5IaXN0b3J5KHtcbiAgICBlZGl0b3JBY3RvcixcbiAgICBzdWJzY3JpcHRpb25zOiBvcHRpb25zLnN1YnNjcmlwdGlvbnNcbiAgfSksIHdpdGhOb3JtYWxpemUgPSBjcmVhdGVXaXRoTm9ybWFsaXplKGVkaXRvckFjdG9yKTtcbiAgcmV0dXJuIGNyZWF0ZVdpdGhFdmVudExpc3RlbmVycyhlZGl0b3JBY3Rvcikod2l0aFNjaGVtYSh3aXRoT2JqZWN0S2V5cyh3aXRoTm9ybWFsaXplKHdpdGhVbmRvUmVkbyh3aXRoUGF0Y2hlcyhwbHVnaW5VcGRhdGVWYWx1ZShlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQsIHBsdWdpblVwZGF0ZVNlbGVjdGlvbih7XG4gICAgZWRpdG9yQWN0b3IsXG4gICAgZWRpdG9yOiBlXG4gIH0pKSkpKSkpKTtcbn0sIGRlYnVnJDYgPSBkZWJ1Z1dpdGhOYW1lKFwic2V0dXBcIik7XG5mdW5jdGlvbiBjcmVhdGVTbGF0ZUVkaXRvcihjb25maWcpIHtcbiAgZGVidWckNihcIkNyZWF0aW5nIG5ldyBTbGF0ZSBlZGl0b3IgaW5zdGFuY2VcIik7XG4gIGNvbnN0IHBsYWNlaG9sZGVyQmxvY2sgPSBjcmVhdGVQbGFjZWhvbGRlckJsb2NrKGNvbmZpZy5lZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLmNvbnRleHQpLCBlZGl0b3IgPSBjcmVhdGVFZGl0b3IoKTtcbiAgZWRpdG9yLmRlY29yYXRlZFJhbmdlcyA9IFtdLCBlZGl0b3IuZGVjb3JhdG9yU3RhdGUgPSB7fSwgZWRpdG9yLmJsb2NrSW5kZXhNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCBlZGl0b3IuaGlzdG9yeSA9IHtcbiAgICB1bmRvczogW10sXG4gICAgcmVkb3M6IFtdXG4gIH0sIGVkaXRvci5sYXN0U2VsZWN0aW9uID0gbnVsbCwgZWRpdG9yLmxhc3RTbGF0ZVNlbGVjdGlvbiA9IG51bGwsIGVkaXRvci5saXN0SW5kZXhNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCBlZGl0b3IucmVtb3RlUGF0Y2hlcyA9IFtdLCBlZGl0b3IudW5kb1N0ZXBJZCA9IHZvaWQgMCwgZWRpdG9yLnZhbHVlID0gW3BsYWNlaG9sZGVyQmxvY2tdLCBlZGl0b3IuaXNOb3JtYWxpemluZ05vZGUgPSAhMSwgZWRpdG9yLmlzUGF0Y2hpbmcgPSAhMCwgZWRpdG9yLmlzUGVyZm9ybWluZ0JlaGF2aW9yT3BlcmF0aW9uID0gITEsIGVkaXRvci5pc1Byb2Nlc3NpbmdSZW1vdGVDaGFuZ2VzID0gITEsIGVkaXRvci5pc1JlZG9pbmcgPSAhMSwgZWRpdG9yLmlzVW5kb2luZyA9ICExLCBlZGl0b3Iud2l0aEhpc3RvcnkgPSAhMDtcbiAgY29uc3QgaW5zdGFuY2UgPSB3aXRoUGx1Z2lucyh3aXRoUmVhY3QoZWRpdG9yKSwge1xuICAgIGVkaXRvckFjdG9yOiBjb25maWcuZWRpdG9yQWN0b3IsXG4gICAgcmVsYXlBY3RvcjogY29uZmlnLnJlbGF5QWN0b3IsXG4gICAgc3Vic2NyaXB0aW9uczogY29uZmlnLnN1YnNjcmlwdGlvbnNcbiAgfSk7XG4gIHJldHVybiBidWlsZEluZGV4TWFwcyh7XG4gICAgc2NoZW1hOiBjb25maWcuZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICB2YWx1ZTogaW5zdGFuY2UudmFsdWVcbiAgfSwge1xuICAgIGJsb2NrSW5kZXhNYXA6IGluc3RhbmNlLmJsb2NrSW5kZXhNYXAsXG4gICAgbGlzdEluZGV4TWFwOiBpbnN0YW5jZS5saXN0SW5kZXhNYXBcbiAgfSksIHtcbiAgICBpbnN0YW5jZSxcbiAgICBpbml0aWFsVmFsdWU6IFtwbGFjZWhvbGRlckJsb2NrXVxuICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlRWRpdG9yRG9tKHNlbmRCYWNrLCBzbGF0ZUVkaXRvcikge1xuICByZXR1cm4ge1xuICAgIGdldEJsb2NrTm9kZXM6IChzbmFwc2hvdCkgPT4gZ2V0QmxvY2tOb2RlcyhzbGF0ZUVkaXRvciwgc25hcHNob3QpLFxuICAgIGdldENoaWxkTm9kZXM6IChzbmFwc2hvdCkgPT4gZ2V0Q2hpbGROb2RlcyhzbGF0ZUVkaXRvciwgc25hcHNob3QpLFxuICAgIGdldEVkaXRvckVsZW1lbnQ6ICgpID0+IGdldEVkaXRvckVsZW1lbnQoc2xhdGVFZGl0b3IpLFxuICAgIGdldFNlbGVjdGlvblJlY3Q6IChzbmFwc2hvdCkgPT4gZ2V0U2VsZWN0aW9uUmVjdChzbmFwc2hvdCksXG4gICAgZ2V0U3RhcnRCbG9ja0VsZW1lbnQ6IChzbmFwc2hvdCkgPT4gZ2V0U3RhcnRCbG9ja0VsZW1lbnQoc2xhdGVFZGl0b3IsIHNuYXBzaG90KSxcbiAgICBnZXRFbmRCbG9ja0VsZW1lbnQ6IChzbmFwc2hvdCkgPT4gZ2V0RW5kQmxvY2tFbGVtZW50KHNsYXRlRWRpdG9yLCBzbmFwc2hvdCksXG4gICAgc2V0RHJhZ0dob3N0OiAoe1xuICAgICAgZXZlbnQsXG4gICAgICBnaG9zdFxuICAgIH0pID0+IHNldERyYWdHaG9zdCh7XG4gICAgICBzZW5kQmFjayxcbiAgICAgIGV2ZW50LFxuICAgICAgZ2hvc3RcbiAgICB9KVxuICB9O1xufVxuZnVuY3Rpb24gZ2V0QmxvY2tOb2RlcyhzbGF0ZUVkaXRvciwgc25hcHNob3QpIHtcbiAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICByZXR1cm4gW107XG4gIGNvbnN0IHJhbmdlID0gdG9TbGF0ZVJhbmdlKHNuYXBzaG90KTtcbiAgaWYgKCFyYW5nZSlcbiAgICByZXR1cm4gW107XG4gIHRyeSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oRWRpdG9yLm5vZGVzKHNsYXRlRWRpdG9yLCB7XG4gICAgICBhdDogcmFuZ2UsXG4gICAgICBtb2RlOiBcImhpZ2hlc3RcIixcbiAgICAgIG1hdGNoOiAobikgPT4gIUVkaXRvci5pc0VkaXRvcihuKVxuICAgIH0pKS5tYXAoKFtibG9ja05vZGVdKSA9PiBET01FZGl0b3IudG9ET01Ob2RlKHNsYXRlRWRpdG9yLCBibG9ja05vZGUpKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5mdW5jdGlvbiBnZXRDaGlsZE5vZGVzKHNsYXRlRWRpdG9yLCBzbmFwc2hvdCkge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybiBbXTtcbiAgY29uc3QgcmFuZ2UgPSB0b1NsYXRlUmFuZ2Uoc25hcHNob3QpO1xuICBpZiAoIXJhbmdlKVxuICAgIHJldHVybiBbXTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShFZGl0b3Iubm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAgIGF0OiByYW5nZSxcbiAgICAgIG1vZGU6IFwibG93ZXN0XCIsXG4gICAgICBtYXRjaDogKG4pID0+ICFFZGl0b3IuaXNFZGl0b3IobilcbiAgICB9KSkubWFwKChbY2hpbGROb2RlXSkgPT4gRE9NRWRpdG9yLnRvRE9NTm9kZShzbGF0ZUVkaXRvciwgY2hpbGROb2RlKSk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0RWRpdG9yRWxlbWVudChzbGF0ZUVkaXRvcikge1xuICB0cnkge1xuICAgIHJldHVybiBET01FZGl0b3IudG9ET01Ob2RlKHNsYXRlRWRpdG9yLCBzbGF0ZUVkaXRvcik7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybjtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0U2VsZWN0aW9uUmVjdChzbmFwc2hvdCkge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybiBudWxsO1xuICB0cnkge1xuICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICByZXR1cm4gc2VsZWN0aW9uID8gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBudWxsO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0U3RhcnRCbG9ja0VsZW1lbnQoc2xhdGVFZGl0b3IsIHNuYXBzaG90KSB7XG4gIGNvbnN0IHN0YXJ0QmxvY2sgPSBnZXRTZWxlY3Rpb25TdGFydEJsb2NrKHNuYXBzaG90KTtcbiAgaWYgKCFzdGFydEJsb2NrKVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBzdGFydEJsb2NrTm9kZSA9IGdldEJsb2NrTm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAuLi5zbmFwc2hvdCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgIHBhdGg6IHN0YXJ0QmxvY2sucGF0aCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfSxcbiAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICBwYXRoOiBzdGFydEJsb2NrLnBhdGgsXG4gICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pPy5hdCgwKTtcbiAgcmV0dXJuIHN0YXJ0QmxvY2tOb2RlICYmIHN0YXJ0QmxvY2tOb2RlIGluc3RhbmNlb2YgRWxlbWVudCA/IHN0YXJ0QmxvY2tOb2RlIDogbnVsbDtcbn1cbmZ1bmN0aW9uIGdldEVuZEJsb2NrRWxlbWVudChzbGF0ZUVkaXRvciwgc25hcHNob3QpIHtcbiAgY29uc3QgZW5kQmxvY2sgPSBnZXRTZWxlY3Rpb25FbmRCbG9jayhzbmFwc2hvdCk7XG4gIGlmICghZW5kQmxvY2spXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGVuZEJsb2NrTm9kZSA9IGdldEJsb2NrTm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAuLi5zbmFwc2hvdCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgIHBhdGg6IGVuZEJsb2NrLnBhdGgsXG4gICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgcGF0aDogZW5kQmxvY2sucGF0aCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk/LmF0KDApO1xuICByZXR1cm4gZW5kQmxvY2tOb2RlICYmIGVuZEJsb2NrTm9kZSBpbnN0YW5jZW9mIEVsZW1lbnQgPyBlbmRCbG9ja05vZGUgOiBudWxsO1xufVxuZnVuY3Rpb24gc2V0RHJhZ0dob3N0KHtcbiAgc2VuZEJhY2ssXG4gIGV2ZW50LFxuICBnaG9zdFxufSkge1xuICBldmVudC5vcmlnaW5FdmVudC5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGdob3N0LmVsZW1lbnQsIGdob3N0LngsIGdob3N0LnkpLCBzZW5kQmFjayh7XG4gICAgdHlwZTogXCJzZXQgZHJhZyBnaG9zdFwiLFxuICAgIGdob3N0OiBnaG9zdC5lbGVtZW50XG4gIH0pO1xufVxuY29uc3QgYWRkQW5ub3RhdGlvbk9uQ29sbGFwc2VkU2VsZWN0aW9uID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJhbm5vdGF0aW9uLmFkZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgaWYgKCFpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBjYXJldFdvcmRTZWxlY3Rpb24gPSBnZXRDYXJldFdvcmRTZWxlY3Rpb24oc25hcHNob3QpO1xuICAgIHJldHVybiAhY2FyZXRXb3JkU2VsZWN0aW9uIHx8ICFpc1NlbGVjdGlvbkV4cGFuZGVkKHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiBjYXJldFdvcmRTZWxlY3Rpb25cbiAgICAgIH1cbiAgICB9KSA/ICExIDoge1xuICAgICAgY2FyZXRXb3JkU2VsZWN0aW9uXG4gICAgfTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwge1xuICAgIGNhcmV0V29yZFNlbGVjdGlvblxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgYXQ6IGNhcmV0V29yZFNlbGVjdGlvblxuICB9KSwgcmFpc2Uoe1xuICAgIHR5cGU6IFwiYW5ub3RhdGlvbi5hZGRcIixcbiAgICBhbm5vdGF0aW9uOiBldmVudC5hbm5vdGF0aW9uXG4gIH0pXV1cbn0pLCBwcmV2ZW50T3ZlcmxhcHBpbmdBbm5vdGF0aW9ucyA9IGRlZmluZUJlaGF2aW9yKHtcbiAgLy8gR2l2ZW4gYW4gYGFubm90YXRpb24uYWRkYCBldmVudFxuICBvbjogXCJhbm5vdGF0aW9uLmFkZFwiLFxuICAvLyBXaGVuIHRoZSBhbm5vdGF0aW9uIGlzIGFjdGl2ZSBpbiB0aGUgc2VsZWN0aW9uXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IGlzQWN0aXZlQW5ub3RhdGlvbihldmVudC5hbm5vdGF0aW9uLm5hbWUsIHtcbiAgICBtb2RlOiBcInBhcnRpYWxcIlxuICB9KShzbmFwc2hvdCksXG4gIC8vIFRoZW4gdGhlIGV4aXN0aW5nIGFubm90YXRpb24gaXMgcmVtb3ZlZFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiYW5ub3RhdGlvbi5yZW1vdmVcIixcbiAgICBhbm5vdGF0aW9uOiBldmVudC5hbm5vdGF0aW9uXG4gIH0pLCByYWlzZShldmVudCldXVxufSksIHN0cmlwQW5ub3RhdGlvbnNPbkZ1bGxTcGFuRGVsZXRpb24gPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgY29uc3QgZWZmZWN0aXZlU25hcHNob3QgPSB7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiBldmVudC5hdCA/PyBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvblxuICAgICAgfVxuICAgIH07XG4gICAgaWYgKCFpc1NlbGVjdGlvbkV4cGFuZGVkKGVmZmVjdGl2ZVNuYXBzaG90KSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBzdGFydENoaWxkID0gZ2V0U2VsZWN0aW9uU3RhcnRDaGlsZChlZmZlY3RpdmVTbmFwc2hvdCksIHN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50KGVmZmVjdGl2ZVNuYXBzaG90KSwgZW5kQ2hpbGQgPSBnZXRTZWxlY3Rpb25FbmRDaGlsZChlZmZlY3RpdmVTbmFwc2hvdCksIGVuZFBvaW50ID0gZ2V0U2VsZWN0aW9uRW5kUG9pbnQoZWZmZWN0aXZlU25hcHNob3QpO1xuICAgIGlmICghc3RhcnRDaGlsZCB8fCAhZW5kQ2hpbGQgfHwgIXN0YXJ0UG9pbnQgfHwgIWVuZFBvaW50IHx8IHN0YXJ0Q2hpbGQucGF0aFsyXS5fa2V5ICE9PSBlbmRDaGlsZC5wYXRoWzJdLl9rZXkgfHwgIWlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBzdGFydENoaWxkLm5vZGUpIHx8ICEoc3RhcnRQb2ludC5vZmZzZXQgPT09IDAgJiYgZW5kUG9pbnQub2Zmc2V0ID09PSBzdGFydENoaWxkLm5vZGUudGV4dC5sZW5ndGgpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGRlY29yYXRvcnMgPSBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLm1hcCgoZGVjb3JhdG9yKSA9PiBkZWNvcmF0b3IubmFtZSksIG1hcmtzID0gc3RhcnRDaGlsZC5ub2RlLm1hcmtzID8/IFtdO1xuICAgIGlmICghbWFya3Muc29tZSgobWFyaykgPT4gIWRlY29yYXRvcnMuaW5jbHVkZXMobWFyaykpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IHByZXZpb3VzU3BhbiA9IGdldFByZXZpb3VzU3BhbihlZmZlY3RpdmVTbmFwc2hvdCksIG5leHRTcGFuID0gZ2V0TmV4dFNwYW4oZWZmZWN0aXZlU25hcHNob3QpLCBwcmV2aW91c1NwYW5IYXNTYW1lQW5ub3RhdGlvbiA9IHByZXZpb3VzU3BhbiA/IHByZXZpb3VzU3Bhbi5ub2RlLm1hcmtzPy5zb21lKChtYXJrKSA9PiAhZGVjb3JhdG9ycy5pbmNsdWRlcyhtYXJrKSAmJiBtYXJrcy5pbmNsdWRlcyhtYXJrKSkgOiAhMSwgbmV4dFNwYW5IYXNTYW1lQW5ub3RhdGlvbiA9IG5leHRTcGFuID8gbmV4dFNwYW4ubm9kZS5tYXJrcz8uc29tZSgobWFyaykgPT4gIWRlY29yYXRvcnMuaW5jbHVkZXMobWFyaykgJiYgbWFya3MuaW5jbHVkZXMobWFyaykpIDogITE7XG4gICAgaWYgKHByZXZpb3VzU3Bhbkhhc1NhbWVBbm5vdGF0aW9uIHx8IG5leHRTcGFuSGFzU2FtZUFubm90YXRpb24pXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgYWN0aXZlRGVjb3JhdG9ycyA9IGdldEFjdGl2ZURlY29yYXRvcnMoZWZmZWN0aXZlU25hcHNob3QpO1xuICAgIHJldHVybiB7XG4gICAgICBzcGFuUGF0aDogc3RhcnRDaGlsZC5wYXRoLFxuICAgICAgYWN0aXZlRGVjb3JhdG9yc1xuICAgIH07XG4gIH0sXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0sIHtcbiAgICBzcGFuUGF0aCxcbiAgICBhY3RpdmVEZWNvcmF0b3JzXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJjaGlsZC5zZXRcIixcbiAgICBhdDogc3BhblBhdGgsXG4gICAgcHJvcHM6IHtcbiAgICAgIG1hcmtzOiBhY3RpdmVEZWNvcmF0b3JzXG4gICAgfVxuICB9KSwgZm9yd2FyZChldmVudCldXVxufSksIGNvcmVBbm5vdGF0aW9uQmVoYXZpb3JzID0gW2FkZEFubm90YXRpb25PbkNvbGxhcHNlZFNlbGVjdGlvbiwgcHJldmVudE92ZXJsYXBwaW5nQW5ub3RhdGlvbnMsIHN0cmlwQW5ub3RhdGlvbnNPbkZ1bGxTcGFuRGVsZXRpb25dLCBkZWZhdWx0S2V5Ym9hcmRTaG9ydGN1dHMgPSB7XG4gIGFycm93RG93bjogY3JlYXRlS2V5Ym9hcmRTaG9ydGN1dCh7XG4gICAgZGVmYXVsdDogW3tcbiAgICAgIGtleTogXCJBcnJvd0Rvd25cIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfV1cbiAgfSksXG4gIGFycm93VXA6IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICAgIGRlZmF1bHQ6IFt7XG4gICAgICBrZXk6IFwiQXJyb3dVcFwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9XVxuICB9KSxcbiAgYmFja3NwYWNlOiBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgICBkZWZhdWx0OiBbe1xuICAgICAga2V5OiBcIkJhY2tzcGFjZVwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9XVxuICB9KSxcbiAgYnJlYWs6IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICAgIGRlZmF1bHQ6IFt7XG4gICAgICBrZXk6IFwiRW50ZXJcIixcbiAgICAgIHNoaWZ0OiAhMVxuICAgIH1dXG4gIH0pLFxuICBsaW5lQnJlYWs6IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICAgIGRlZmF1bHQ6IFt7XG4gICAgICBrZXk6IFwiRW50ZXJcIixcbiAgICAgIHNoaWZ0OiAhMFxuICAgIH1dXG4gIH0pLFxuICBkZWNvcmF0b3JzOiB7XG4gICAgc3Ryb25nOiBib2xkLFxuICAgIGVtOiBpdGFsaWMsXG4gICAgdW5kZXJsaW5lLFxuICAgIGNvZGVcbiAgfSxcbiAgZGVsZXRlOiBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgICBkZWZhdWx0OiBbe1xuICAgICAga2V5OiBcIkRlbGV0ZVwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9XVxuICB9KSxcbiAgZGVsZXRlV29yZDoge1xuICAgIGJhY2t3YXJkOiBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgICAgIGRlZmF1bHQ6IFt7XG4gICAgICAgIGtleTogXCJCYWNrc3BhY2VcIixcbiAgICAgICAgYWx0OiAhMSxcbiAgICAgICAgY3RybDogITAsXG4gICAgICAgIG1ldGE6ICExXG4gICAgICAgIC8vIHNoaWZ0IGlzIG9wdGlvbmFsXG4gICAgICB9XSxcbiAgICAgIGFwcGxlOiBbe1xuICAgICAgICBrZXk6IFwiQmFja3NwYWNlXCIsXG4gICAgICAgIGFsdDogITAsXG4gICAgICAgIGN0cmw6ICExLFxuICAgICAgICBtZXRhOiAhMVxuICAgICAgICAvLyBzaGlmdCBpcyBvcHRpb25hbFxuICAgICAgfV1cbiAgICB9KSxcbiAgICBmb3J3YXJkOiBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgICAgIGRlZmF1bHQ6IFt7XG4gICAgICAgIGtleTogXCJEZWxldGVcIixcbiAgICAgICAgYWx0OiAhMSxcbiAgICAgICAgY3RybDogITAsXG4gICAgICAgIG1ldGE6ICExXG4gICAgICAgIC8vIHNoaWZ0IGlzIG9wdGlvbmFsXG4gICAgICB9XSxcbiAgICAgIGFwcGxlOiBbe1xuICAgICAgICBrZXk6IFwiRGVsZXRlXCIsXG4gICAgICAgIGFsdDogITAsXG4gICAgICAgIGN0cmw6ICExLFxuICAgICAgICBtZXRhOiAhMVxuICAgICAgICAvLyBzaGlmdCBpcyBvcHRpb25hbFxuICAgICAgfV1cbiAgICB9KVxuICB9LFxuICBoaXN0b3J5OiB7XG4gICAgdW5kbyxcbiAgICByZWRvXG4gIH0sXG4gIHRhYjogY3JlYXRlS2V5Ym9hcmRTaG9ydGN1dCh7XG4gICAgZGVmYXVsdDogW3tcbiAgICAgIGtleTogXCJUYWJcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfV1cbiAgfSksXG4gIHNoaWZ0VGFiOiBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgICBkZWZhdWx0OiBbe1xuICAgICAga2V5OiBcIlRhYlwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITBcbiAgICB9XVxuICB9KVxufSwgYXJyb3dEb3duT25Mb25lbHlCbG9ja09iamVjdCA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgaWYgKCFkZWZhdWx0S2V5Ym9hcmRTaG9ydGN1dHMuYXJyb3dEb3duLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSB8fCAhaXNTZWxlY3Rpb25Db2xsYXBzZWQkMShzbmFwc2hvdCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgZm9jdXNCbG9ja09iamVjdCA9IGdldEZvY3VzQmxvY2tPYmplY3Qoc25hcHNob3QpLCBuZXh0QmxvY2sgPSBnZXROZXh0QmxvY2soc25hcHNob3QpO1xuICAgIHJldHVybiBmb2N1c0Jsb2NrT2JqZWN0ICYmICFuZXh0QmxvY2s7XG4gIH0sXG4gIGFjdGlvbnM6IFsoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazoge1xuICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWVcbiAgICB9LFxuICAgIHBsYWNlbWVudDogXCJhZnRlclwiXG4gIH0pXV1cbn0pLCBhcnJvd1VwT25Mb25lbHlCbG9ja09iamVjdCA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgaWYgKCFkZWZhdWx0S2V5Ym9hcmRTaG9ydGN1dHMuYXJyb3dVcC5ndWFyZChldmVudC5vcmlnaW5FdmVudCkgfHwgIWlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGZvY3VzQmxvY2tPYmplY3QgPSBnZXRGb2N1c0Jsb2NrT2JqZWN0KHNuYXBzaG90KSwgcHJldmlvdXNCbG9jayA9IGdldFByZXZpb3VzQmxvY2soc25hcHNob3QpO1xuICAgIHJldHVybiBmb2N1c0Jsb2NrT2JqZWN0ICYmICFwcmV2aW91c0Jsb2NrO1xuICB9LFxuICBhY3Rpb25zOiBbKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgYmxvY2s6IHtcbiAgICAgIF90eXBlOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lXG4gICAgfSxcbiAgICBwbGFjZW1lbnQ6IFwiYmVmb3JlXCJcbiAgfSldXVxufSksIGJyZWFraW5nQmxvY2tPYmplY3QgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImluc2VydC5icmVha1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgY29uc3QgZm9jdXNCbG9ja09iamVjdCA9IGdldEZvY3VzQmxvY2tPYmplY3Qoc25hcHNob3QpO1xuICAgIHJldHVybiBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSAmJiBmb2N1c0Jsb2NrT2JqZWN0ICE9PSB2b2lkIDA7XG4gIH0sXG4gIGFjdGlvbnM6IFsoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazoge1xuICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWVcbiAgICB9LFxuICAgIHBsYWNlbWVudDogXCJhZnRlclwiXG4gIH0pXV1cbn0pLCBjbGlja2luZ0Fib3ZlTG9uZWx5QmxvY2tPYmplY3QgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcIm1vdXNlLmNsaWNrXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBpZiAoc25hcHNob3QuY29udGV4dC5yZWFkT25seSB8fCBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiAmJiAhaXNTZWxlY3Rpb25Db2xsYXBzZWQkMShzbmFwc2hvdCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgZm9jdXNCbG9ja09iamVjdCA9IGdldEZvY3VzQmxvY2tPYmplY3Qoe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjogZXZlbnQucG9zaXRpb24uc2VsZWN0aW9uXG4gICAgICB9XG4gICAgfSksIHByZXZpb3VzQmxvY2sgPSBnZXRQcmV2aW91c0Jsb2NrKHtcbiAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgY29udGV4dDoge1xuICAgICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICBzZWxlY3Rpb246IGV2ZW50LnBvc2l0aW9uLnNlbGVjdGlvblxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBldmVudC5wb3NpdGlvbi5pc0VkaXRvciAmJiBldmVudC5wb3NpdGlvbi5ibG9jayA9PT0gXCJzdGFydFwiICYmIGZvY3VzQmxvY2tPYmplY3QgJiYgIXByZXZpb3VzQmxvY2s7XG4gIH0sXG4gIGFjdGlvbnM6IFsoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICBhdDogZXZlbnQucG9zaXRpb24uc2VsZWN0aW9uXG4gIH0pLCByYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazoge1xuICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWVcbiAgICB9LFxuICAgIHBsYWNlbWVudDogXCJiZWZvcmVcIixcbiAgICBzZWxlY3Q6IFwic3RhcnRcIlxuICB9KV1dXG59KSwgY2xpY2tpbmdCZWxvd0xvbmVseUJsb2NrT2JqZWN0ID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJtb3VzZS5jbGlja1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgaWYgKHNuYXBzaG90LmNvbnRleHQucmVhZE9ubHkgfHwgc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24gJiYgIWlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGZvY3VzQmxvY2tPYmplY3QgPSBnZXRGb2N1c0Jsb2NrT2JqZWN0KHtcbiAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgY29udGV4dDoge1xuICAgICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICBzZWxlY3Rpb246IGV2ZW50LnBvc2l0aW9uLnNlbGVjdGlvblxuICAgICAgfVxuICAgIH0pLCBuZXh0QmxvY2sgPSBnZXROZXh0QmxvY2soe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjogZXZlbnQucG9zaXRpb24uc2VsZWN0aW9uXG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGV2ZW50LnBvc2l0aW9uLmlzRWRpdG9yICYmIGV2ZW50LnBvc2l0aW9uLmJsb2NrID09PSBcImVuZFwiICYmIGZvY3VzQmxvY2tPYmplY3QgJiYgIW5leHRCbG9jaztcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgIGF0OiBldmVudC5wb3NpdGlvbi5zZWxlY3Rpb25cbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgIGJsb2NrOiB7XG4gICAgICBfdHlwZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuYmxvY2submFtZVxuICAgIH0sXG4gICAgcGxhY2VtZW50OiBcImFmdGVyXCIsXG4gICAgc2VsZWN0OiBcInN0YXJ0XCJcbiAgfSldXVxufSksIGRlbGV0aW5nRW1wdHlUZXh0QmxvY2tBZnRlckJsb2NrT2JqZWN0ID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJkZWxldGUuYmFja3dhcmRcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3RcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGZvY3VzVGV4dEJsb2NrID0gZ2V0Rm9jdXNUZXh0QmxvY2soc25hcHNob3QpLCBzZWxlY3Rpb25Db2xsYXBzZWQgPSBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSwgcHJldmlvdXNCbG9jayA9IGdldFByZXZpb3VzQmxvY2soc25hcHNob3QpO1xuICAgIHJldHVybiAhZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvbkNvbGxhcHNlZCB8fCAhcHJldmlvdXNCbG9jayA/ICExIDogaXNFbXB0eVRleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBmb2N1c1RleHRCbG9jay5ub2RlKSAmJiAhaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgcHJldmlvdXNCbG9jay5ub2RlKSA/IHtcbiAgICAgIGZvY3VzVGV4dEJsb2NrLFxuICAgICAgcHJldmlvdXNCbG9ja1xuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyhfLCB7XG4gICAgZm9jdXNUZXh0QmxvY2ssXG4gICAgcHJldmlvdXNCbG9ja1xuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiZGVsZXRlLmJsb2NrXCIsXG4gICAgYXQ6IGZvY3VzVGV4dEJsb2NrLnBhdGhcbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgIGF0OiB7XG4gICAgICBhbmNob3I6IHtcbiAgICAgICAgcGF0aDogcHJldmlvdXNCbG9jay5wYXRoLFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH0sXG4gICAgICBmb2N1czoge1xuICAgICAgICBwYXRoOiBwcmV2aW91c0Jsb2NrLnBhdGgsXG4gICAgICAgIG9mZnNldDogMFxuICAgICAgfVxuICAgIH1cbiAgfSldXVxufSksIGRlbGV0aW5nRW1wdHlUZXh0QmxvY2tCZWZvcmVCbG9ja09iamVjdCA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiZGVsZXRlLmZvcndhcmRcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3RcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGZvY3VzVGV4dEJsb2NrID0gZ2V0Rm9jdXNUZXh0QmxvY2soc25hcHNob3QpLCBzZWxlY3Rpb25Db2xsYXBzZWQgPSBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSwgbmV4dEJsb2NrID0gZ2V0TmV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICByZXR1cm4gIWZvY3VzVGV4dEJsb2NrIHx8ICFzZWxlY3Rpb25Db2xsYXBzZWQgfHwgIW5leHRCbG9jayA/ICExIDogaXNFbXB0eVRleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBmb2N1c1RleHRCbG9jay5ub2RlKSAmJiAhaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgbmV4dEJsb2NrLm5vZGUpID8ge1xuICAgICAgZm9jdXNUZXh0QmxvY2ssXG4gICAgICBuZXh0QmxvY2tcbiAgICB9IDogITE7XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIGZvY3VzVGV4dEJsb2NrLFxuICAgIG5leHRCbG9ja1xuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiZGVsZXRlLmJsb2NrXCIsXG4gICAgYXQ6IGZvY3VzVGV4dEJsb2NrLnBhdGhcbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgIGF0OiB7XG4gICAgICBhbmNob3I6IHtcbiAgICAgICAgcGF0aDogbmV4dEJsb2NrLnBhdGgsXG4gICAgICAgIG9mZnNldDogMFxuICAgICAgfSxcbiAgICAgIGZvY3VzOiB7XG4gICAgICAgIHBhdGg6IG5leHRCbG9jay5wYXRoLFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH1cbiAgICB9XG4gIH0pXV1cbn0pLCBjb3JlQmxvY2tPYmplY3RCZWhhdmlvcnMgPSB7XG4gIGFycm93RG93bk9uTG9uZWx5QmxvY2tPYmplY3QsXG4gIGFycm93VXBPbkxvbmVseUJsb2NrT2JqZWN0LFxuICBicmVha2luZ0Jsb2NrT2JqZWN0LFxuICBjbGlja2luZ0Fib3ZlTG9uZWx5QmxvY2tPYmplY3QsXG4gIGNsaWNraW5nQmVsb3dMb25lbHlCbG9ja09iamVjdCxcbiAgZGVsZXRpbmdFbXB0eVRleHRCbG9ja0FmdGVyQmxvY2tPYmplY3QsXG4gIGRlbGV0aW5nRW1wdHlUZXh0QmxvY2tCZWZvcmVCbG9ja09iamVjdFxufSwgY29yZURlY29yYXRvckJlaGF2aW9ycyA9IHtcbiAgc3Ryb25nU2hvcnRjdXQ6IGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJrZXlib2FyZC5rZXlkb3duXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmRlY29yYXRvcnMuc3Ryb25nLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSAmJiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLnNvbWUoKGRlY29yYXRvcikgPT4gZGVjb3JhdG9yLm5hbWUgPT09IFwic3Ryb25nXCIpLFxuICAgIGFjdGlvbnM6IFsoKSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWNvcmF0b3IudG9nZ2xlXCIsXG4gICAgICBkZWNvcmF0b3I6IFwic3Ryb25nXCJcbiAgICB9KV1dXG4gIH0pLFxuICBlbVNob3J0Y3V0OiBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IGRlZmF1bHRLZXlib2FyZFNob3J0Y3V0cy5kZWNvcmF0b3JzLmVtLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSAmJiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLnNvbWUoKGRlY29yYXRvcikgPT4gZGVjb3JhdG9yLm5hbWUgPT09IFwiZW1cIiksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlY29yYXRvci50b2dnbGVcIixcbiAgICAgIGRlY29yYXRvcjogXCJlbVwiXG4gICAgfSldXVxuICB9KSxcbiAgdW5kZXJsaW5lU2hvcnRjdXQ6IGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJrZXlib2FyZC5rZXlkb3duXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmRlY29yYXRvcnMudW5kZXJsaW5lLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSAmJiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLnNvbWUoKGRlY29yYXRvcikgPT4gZGVjb3JhdG9yLm5hbWUgPT09IFwidW5kZXJsaW5lXCIpLFxuICAgIGFjdGlvbnM6IFsoKSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWNvcmF0b3IudG9nZ2xlXCIsXG4gICAgICBkZWNvcmF0b3I6IFwidW5kZXJsaW5lXCJcbiAgICB9KV1dXG4gIH0pLFxuICBjb2RlU2hvcnRjdXQ6IGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJrZXlib2FyZC5rZXlkb3duXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmRlY29yYXRvcnMuY29kZS5ndWFyZChldmVudC5vcmlnaW5FdmVudCkgJiYgc25hcHNob3QuY29udGV4dC5zY2hlbWEuZGVjb3JhdG9ycy5zb21lKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lID09PSBcImNvZGVcIiksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlY29yYXRvci50b2dnbGVcIixcbiAgICAgIGRlY29yYXRvcjogXCJjb2RlXCJcbiAgICB9KV1dXG4gIH0pXG59O1xuZnVuY3Rpb24gZ2V0Q29tcG91bmRDbGllbnRSZWN0KG5vZGVzKSB7XG4gIGlmIChub2Rlcy5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIG5ldyBET01SZWN0KDAsIDAsIDAsIDApO1xuICBjb25zdCBlbGVtZW50cyA9IG5vZGVzLmZpbHRlcigobm9kZSkgPT4gbm9kZSBpbnN0YW5jZW9mIEVsZW1lbnQpLCBmaXJzdFJlY3QgPSBlbGVtZW50cy5hdCgwKT8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIGlmICghZmlyc3RSZWN0KVxuICAgIHJldHVybiBuZXcgRE9NUmVjdCgwLCAwLCAwLCAwKTtcbiAgbGV0IGxlZnQgPSBmaXJzdFJlY3QubGVmdCwgdG9wID0gZmlyc3RSZWN0LnRvcCwgcmlnaHQgPSBmaXJzdFJlY3QucmlnaHQsIGJvdHRvbSA9IGZpcnN0UmVjdC5ib3R0b207XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCByZWN0ID0gZWxlbWVudHNbaV0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbGVmdCA9IE1hdGgubWluKGxlZnQsIHJlY3QubGVmdCksIHRvcCA9IE1hdGgubWluKHRvcCwgcmVjdC50b3ApLCByaWdodCA9IE1hdGgubWF4KHJpZ2h0LCByZWN0LnJpZ2h0KSwgYm90dG9tID0gTWF0aC5tYXgoYm90dG9tLCByZWN0LmJvdHRvbSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBET01SZWN0KGxlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0LCBib3R0b20gLSB0b3ApO1xufVxuY29uc3QgY29yZURuZEJlaGF2aW9ycyA9IFtcbiAgLyoqXG4gICAqIENvcmUgQmVoYXZpb3IgdGhhdDpcbiAgICogMS4gQ2FsY3VsYXRlcyBhbmQgc2VsZWN0cyBhIFwiZHJhZyBzZWxlY3Rpb25cIlxuICAgKiAyLiBDb25zdHJ1Y3RzIGFuZCBzZXRzIGEgZHJhZyBnaG9zdCBlbGVtZW50XG4gICAqIDMuIEZvcndhcmRzIHRoZSBkcmFnc3RhcnQgZXZlbnRcbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJkcmFnLmRyYWdzdGFydFwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBkb20sXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IGRyYWdTZWxlY3Rpb24gPSBnZXREcmFnU2VsZWN0aW9uKHtcbiAgICAgICAgc25hcHNob3QsXG4gICAgICAgIGV2ZW50U2VsZWN0aW9uOiBldmVudC5wb3NpdGlvbi5zZWxlY3Rpb25cbiAgICAgIH0pLCBzZWxlY3RpbmdFbnRpcmVCbG9ja3MgPSBpc1NlbGVjdGluZ0VudGlyZUJsb2Nrcyh7XG4gICAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICBzZWxlY3Rpb246IGRyYWdTZWxlY3Rpb25cbiAgICAgICAgfVxuICAgICAgfSksIGRyYWdnZWREb21Ob2RlcyA9IHtcbiAgICAgICAgYmxvY2tOb2RlczogZG9tLmdldEJsb2NrTm9kZXMoe1xuICAgICAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgICBzZWxlY3Rpb246IGRyYWdTZWxlY3Rpb25cbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBjaGlsZE5vZGVzOiBkb20uZ2V0Q2hpbGROb2Rlcyh7XG4gICAgICAgICAgLi4uc25hcHNob3QsXG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICAgIHNlbGVjdGlvbjogZHJhZ1NlbGVjdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkcmFnU2VsZWN0aW9uLFxuICAgICAgICBkcmFnZ2VkRG9tTm9kZXMsXG4gICAgICAgIHNlbGVjdGluZ0VudGlyZUJsb2Nrc1xuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZG9tLFxuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBkcmFnU2VsZWN0aW9uLFxuICAgICAgZHJhZ2dlZERvbU5vZGVzLFxuICAgICAgc2VsZWN0aW5nRW50aXJlQmxvY2tzXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgZHJhZ0dob3N0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGlmIChzZWxlY3RpbmdFbnRpcmVCbG9ja3MpIHtcbiAgICAgICAgY29uc3QgY2xvbmVkQmxvY2tOb2RlcyA9IGRyYWdnZWREb21Ob2Rlcy5ibG9ja05vZGVzLm1hcCgobm9kZSkgPT4gbm9kZS5jbG9uZU5vZGUoITApKTtcbiAgICAgICAgZm9yIChjb25zdCBibG9jayBvZiBjbG9uZWRCbG9ja05vZGVzKVxuICAgICAgICAgIGJsb2NrIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgJiYgKGJsb2NrLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiKSwgZHJhZ0dob3N0LmFwcGVuZENoaWxkKGJsb2NrKTtcbiAgICAgICAgY29uc3QgY3VzdG9tR2hvc3QgPSBkcmFnR2hvc3QucXVlcnlTZWxlY3RvcihcIltkYXRhLXB0LWRyYWctZ2hvc3QtZWxlbWVudF1cIik7XG4gICAgICAgIGlmIChjdXN0b21HaG9zdCAmJiBkcmFnR2hvc3QucmVwbGFjZUNoaWxkcmVuKGN1c3RvbUdob3N0KSwgZHJhZ0dob3N0LnNldEF0dHJpYnV0ZShcImRhdGEtZHJhZ2dlZFwiLCBcIlwiKSwgZHJhZ0dob3N0LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiLCBkcmFnR2hvc3Quc3R5bGUubGVmdCA9IFwiLTk5OTk5cHhcIiwgZHJhZ0dob3N0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRyYWdHaG9zdCksIGN1c3RvbUdob3N0KSB7XG4gICAgICAgICAgY29uc3QgY3VzdG9tR2hvc3RSZWN0ID0gY3VzdG9tR2hvc3QuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIHggPSBldmVudC5vcmlnaW5FdmVudC5jbGllbnRYIC0gY3VzdG9tR2hvc3RSZWN0LmxlZnQsIHkgPSBldmVudC5vcmlnaW5FdmVudC5jbGllbnRZIC0gY3VzdG9tR2hvc3RSZWN0LnRvcDtcbiAgICAgICAgICByZXR1cm4gZHJhZ0dob3N0LnN0eWxlLndpZHRoID0gYCR7Y3VzdG9tR2hvc3RSZWN0LndpZHRofXB4YCwgZHJhZ0dob3N0LnN0eWxlLmhlaWdodCA9IGAke2N1c3RvbUdob3N0UmVjdC5oZWlnaHR9cHhgLCBbcmFpc2Uoe1xuICAgICAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgICAgIGF0OiBkcmFnU2VsZWN0aW9uXG4gICAgICAgICAgfSksIGVmZmVjdCgoKSA9PiB7XG4gICAgICAgICAgICBkb20uc2V0RHJhZ0dob3N0KHtcbiAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgIGdob3N0OiB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZHJhZ0dob3N0LFxuICAgICAgICAgICAgICAgIHgsXG4gICAgICAgICAgICAgICAgeVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KSwgZm9yd2FyZChldmVudCldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGJsb2Nrc0RvbVJlY3QgPSBnZXRDb21wb3VuZENsaWVudFJlY3QoZHJhZ2dlZERvbU5vZGVzLmJsb2NrTm9kZXMpLCB4ID0gZXZlbnQub3JpZ2luRXZlbnQuY2xpZW50WCAtIGJsb2Nrc0RvbVJlY3QubGVmdCwgeSA9IGV2ZW50Lm9yaWdpbkV2ZW50LmNsaWVudFkgLSBibG9ja3NEb21SZWN0LnRvcDtcbiAgICAgICAgICByZXR1cm4gZHJhZ0dob3N0LnN0eWxlLndpZHRoID0gYCR7YmxvY2tzRG9tUmVjdC53aWR0aH1weGAsIGRyYWdHaG9zdC5zdHlsZS5oZWlnaHQgPSBgJHtibG9ja3NEb21SZWN0LmhlaWdodH1weGAsIFtyYWlzZSh7XG4gICAgICAgICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgICAgICAgYXQ6IGRyYWdTZWxlY3Rpb25cbiAgICAgICAgICB9KSwgZWZmZWN0KCgpID0+IHtcbiAgICAgICAgICAgIGRvbS5zZXREcmFnR2hvc3Qoe1xuICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgZ2hvc3Q6IHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBkcmFnR2hvc3QsXG4gICAgICAgICAgICAgICAgeCxcbiAgICAgICAgICAgICAgICB5XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLCBmb3J3YXJkKGV2ZW50KV07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNsb25lZENoaWxkTm9kZXMgPSBkcmFnZ2VkRG9tTm9kZXMuY2hpbGROb2Rlcy5tYXAoKG5vZGUpID0+IG5vZGUuY2xvbmVOb2RlKCEwKSk7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2xvbmVkQ2hpbGROb2RlcylcbiAgICAgICAgICBkcmFnR2hvc3QuYXBwZW5kQ2hpbGQoY2hpbGQpO1xuICAgICAgICBkcmFnR2hvc3Quc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCIsIGRyYWdHaG9zdC5zdHlsZS5sZWZ0ID0gXCItOTk5OTlweFwiLCBkcmFnR2hvc3Quc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCIsIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZHJhZ0dob3N0KTtcbiAgICAgICAgY29uc3QgY2hpbGRyZW5Eb21SZWN0ID0gZ2V0Q29tcG91bmRDbGllbnRSZWN0KGRyYWdnZWREb21Ob2Rlcy5jaGlsZE5vZGVzKSwgeCA9IGV2ZW50Lm9yaWdpbkV2ZW50LmNsaWVudFggLSBjaGlsZHJlbkRvbVJlY3QubGVmdCwgeSA9IGV2ZW50Lm9yaWdpbkV2ZW50LmNsaWVudFkgLSBjaGlsZHJlbkRvbVJlY3QudG9wO1xuICAgICAgICByZXR1cm4gZHJhZ0dob3N0LnN0eWxlLndpZHRoID0gYCR7Y2hpbGRyZW5Eb21SZWN0LndpZHRofXB4YCwgZHJhZ0dob3N0LnN0eWxlLmhlaWdodCA9IGAke2NoaWxkcmVuRG9tUmVjdC5oZWlnaHR9cHhgLCBbcmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICAgICAgYXQ6IGRyYWdTZWxlY3Rpb25cbiAgICAgICAgfSksIGVmZmVjdCgoKSA9PiB7XG4gICAgICAgICAgZG9tLnNldERyYWdHaG9zdCh7XG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGdob3N0OiB7XG4gICAgICAgICAgICAgIGVsZW1lbnQ6IGRyYWdHaG9zdCxcbiAgICAgICAgICAgICAgeCxcbiAgICAgICAgICAgICAgeVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KSwgZm9yd2FyZChldmVudCldO1xuICAgICAgfVxuICAgIH1dXG4gIH0pLFxuICAvKipcbiAgICogV2hlbiBkcmFnZ2luZyBvdmVyIHRoZSBkcmFnIG9yaWdpbiwgd2UgZG9uJ3Qgd2FudCB0byBzaG93IHRoZSBjYXJldCBpbiB0aGVcbiAgICogdGV4dC5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJkcmFnLmRyYWdvdmVyXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgZHJhZ09yaWdpbiA9IGV2ZW50LmRyYWdPcmlnaW47XG4gICAgICByZXR1cm4gZHJhZ09yaWdpbiA/IGlzT3ZlcmxhcHBpbmdTZWxlY3Rpb24oZXZlbnQucG9zaXRpb24uc2VsZWN0aW9uKSh7XG4gICAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICBzZWxlY3Rpb246IGRyYWdPcmlnaW4uc2VsZWN0aW9uXG4gICAgICAgIH1cbiAgICAgIH0pIDogITE7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbXVxuICB9KSxcbiAgLyoqXG4gICAqIElmIHRoZSBkcm9wIHBvc2l0aW9uIG92ZXJsYXBzIHRoZSBkcmFnIG9yaWdpbiwgdGhlbiB0aGUgZXZlbnQgc2hvdWxkIGJlXG4gICAqIGNhbmNlbGxlZC5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJkcmFnLmRyb3BcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBkcmFnT3JpZ2luID0gZXZlbnQuZHJhZ09yaWdpbiwgZHJvcFBvc2l0aW9uID0gZXZlbnQucG9zaXRpb24uc2VsZWN0aW9uO1xuICAgICAgcmV0dXJuIGRyYWdPcmlnaW4gPyBpc092ZXJsYXBwaW5nU2VsZWN0aW9uKGRyb3BQb3NpdGlvbikoe1xuICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uOiBkcmFnT3JpZ2luLnNlbGVjdGlvblxuICAgICAgICB9XG4gICAgICB9KSA6ICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogW11cbiAgfSksXG4gIC8qKlxuICAgKiBJZiB3ZSBkcm9wIGFuZCBoYXZlIGFjY2VzcyB0byBhIGRyYWcgb3JpZ2luLCB0aGVuIHdlIGNhbiBkZXNlcmlhbGl6ZVxuICAgKiB3aXRob3V0IGNyZWF0aW5nIGEgbmV3IHNlbGVjdGlvbi5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJkcmFnLmRyb3BcIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZXZlbnQuZHJhZ09yaWdpbiAhPT0gdm9pZCAwLFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZXNlcmlhbGl6ZVwiLFxuICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50XG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIE90aGVyd2lzZSwgd2Ugc2hvdWxkIHRvIGNyZWF0ZSBhIG5ldyBzZWxlY3Rpb24uXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiZHJhZy5kcm9wXCIsXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgYXQ6IGV2ZW50LnBvc2l0aW9uLnNlbGVjdGlvblxuICAgIH0pLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImRlc2VyaWFsaXplXCIsXG4gICAgICBvcmlnaW5FdmVudDogZXZlbnRcbiAgICB9KV1dXG4gIH0pLFxuICAvKipcbiAgICogQ29yZSBCZWhhdmlvciB0aGF0IHVzZXMgdGhlIGRyYWcgb3JpZ2luIHRvIG1pbWljIGEgbW92ZSBvcGVyYXRpb24gZHVyaW5nXG4gICAqIGludGVybmFsIGRyYWdnaW5nLlxuICAgKi9cbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImRlc2VyaWFsaXphdGlvbi5zdWNjZXNzXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50Lm9yaWdpbkV2ZW50LnR5cGUgIT09IFwiZHJhZy5kcm9wXCIgfHwgZXZlbnQub3JpZ2luRXZlbnQuZHJhZ09yaWdpbiA9PT0gdm9pZCAwKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBkcmFnT3JpZ2luID0gZXZlbnQub3JpZ2luRXZlbnQuZHJhZ09yaWdpbiwgZHJhZ1NlbGVjdGlvbiA9IGdldERyYWdTZWxlY3Rpb24oe1xuICAgICAgICBldmVudFNlbGVjdGlvbjogZHJhZ09yaWdpbi5zZWxlY3Rpb24sXG4gICAgICAgIHNuYXBzaG90XG4gICAgICB9KSwgZHJvcFBvc2l0aW9uID0gZXZlbnQub3JpZ2luRXZlbnQucG9zaXRpb24uc2VsZWN0aW9uLCBkcm9wcGluZ09uRHJhZ09yaWdpbiA9IGRyYWdPcmlnaW4gPyBpc092ZXJsYXBwaW5nU2VsZWN0aW9uKGRyb3BQb3NpdGlvbikoe1xuICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uOiBkcmFnU2VsZWN0aW9uXG4gICAgICAgIH1cbiAgICAgIH0pIDogITEsIGRyYWdnaW5nRW50aXJlQmxvY2tzID0gaXNTZWxlY3RpbmdFbnRpcmVCbG9ja3Moe1xuICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uOiBkcmFnU2VsZWN0aW9uXG4gICAgICAgIH1cbiAgICAgIH0pLCBkcmFnZ2VkQmxvY2tzID0gZ2V0U2VsZWN0ZWRCbG9ja3Moe1xuICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uOiBkcmFnU2VsZWN0aW9uXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRyb3BwaW5nT25EcmFnT3JpZ2luID8gITEgOiB7XG4gICAgICAgIGRyb3BQb3NpdGlvbixcbiAgICAgICAgZHJhZ2dpbmdFbnRpcmVCbG9ja3MsXG4gICAgICAgIGRyYWdnZWRCbG9ja3MsXG4gICAgICAgIGRyYWdPcmlnaW4sXG4gICAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBkcmFnZ2luZ0VudGlyZUJsb2NrcyxcbiAgICAgIGRyYWdnZWRCbG9ja3MsXG4gICAgICBkcmFnT3JpZ2luLFxuICAgICAgZHJvcFBvc2l0aW9uLFxuICAgICAgb3JpZ2luRXZlbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGF0OiBkcm9wUG9zaXRpb25cbiAgICB9KSwgLi4uZHJhZ2dpbmdFbnRpcmVCbG9ja3MgPyBkcmFnZ2VkQmxvY2tzLm1hcCgoYmxvY2spID0+IHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVsZXRlLmJsb2NrXCIsXG4gICAgICBhdDogYmxvY2sucGF0aFxuICAgIH0pKSA6IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZVwiLFxuICAgICAgYXQ6IGRyYWdPcmlnaW4uc2VsZWN0aW9uXG4gICAgfSldLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja3NcIixcbiAgICAgIGJsb2NrczogZXZlbnQuZGF0YSxcbiAgICAgIHBsYWNlbWVudDogZHJhZ2dpbmdFbnRpcmVCbG9ja3MgPyBvcmlnaW5FdmVudC5wb3NpdGlvbi5ibG9jayA9PT0gXCJzdGFydFwiID8gXCJiZWZvcmVcIiA6IG9yaWdpbkV2ZW50LnBvc2l0aW9uLmJsb2NrID09PSBcImVuZFwiID8gXCJhZnRlclwiIDogXCJhdXRvXCIgOiBcImF1dG9cIlxuICAgIH0pXV1cbiAgfSlcbl0sIGNvcmVJbnNlcnRCZWhhdmlvcnMgPSBbZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJpbnNlcnQudGV4dFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgaWYgKCFnZXRGb2N1c1NwYW4kMShzbmFwc2hvdCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgbWFya1N0YXRlID0gZ2V0TWFya1N0YXRlKHNuYXBzaG90KSwgYWN0aXZlRGVjb3JhdG9ycyA9IGdldEFjdGl2ZURlY29yYXRvcnMoc25hcHNob3QpLCBhY3RpdmVBbm5vdGF0aW9ucyA9IGdldEFjdGl2ZUFubm90YXRpb25zTWFya3Moc25hcHNob3QpO1xuICAgIGlmIChtYXJrU3RhdGUgJiYgbWFya1N0YXRlLnN0YXRlID09PSBcInVuY2hhbmdlZFwiKSB7XG4gICAgICBjb25zdCBtYXJrU3RhdGVEZWNvcmF0b3JzID0gKG1hcmtTdGF0ZS5tYXJrcyA/PyBbXSkuZmlsdGVyKChtYXJrKSA9PiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLm1hcCgoZGVjb3JhdG9yKSA9PiBkZWNvcmF0b3IubmFtZSkuaW5jbHVkZXMobWFyaykpO1xuICAgICAgaWYgKG1hcmtTdGF0ZURlY29yYXRvcnMubGVuZ3RoID09PSBhY3RpdmVEZWNvcmF0b3JzLmxlbmd0aCAmJiBtYXJrU3RhdGVEZWNvcmF0b3JzLmV2ZXJ5KChtYXJrKSA9PiBhY3RpdmVEZWNvcmF0b3JzLmluY2x1ZGVzKG1hcmspKSlcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgYWN0aXZlRGVjb3JhdG9ycyxcbiAgICAgIGFjdGl2ZUFubm90YXRpb25zXG4gICAgfTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSwge1xuICAgIGFjdGl2ZURlY29yYXRvcnMsXG4gICAgYWN0aXZlQW5ub3RhdGlvbnNcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcImluc2VydC5jaGlsZFwiLFxuICAgIGNoaWxkOiB7XG4gICAgICBfdHlwZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgdGV4dDogZXZlbnQudGV4dCxcbiAgICAgIG1hcmtzOiBbLi4uYWN0aXZlRGVjb3JhdG9ycywgLi4uYWN0aXZlQW5ub3RhdGlvbnNdXG4gICAgfVxuICB9KV1dXG59KV0sIGJyZWFraW5nQXRUaGVFbmRPZlRleHRCbG9jayA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiaW5zZXJ0LmJyZWFrXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IHtcbiAgICBjb25zdCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KSwgc2VsZWN0aW9uQ29sbGFwc2VkID0gaXNTZWxlY3Rpb25Db2xsYXBzZWQkMShzbmFwc2hvdCk7XG4gICAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiB8fCAhZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvbkNvbGxhcHNlZClcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBhdFRoZUVuZE9mQmxvY2sgPSBpc0F0VGhlRW5kT2ZCbG9jayhmb2N1c1RleHRCbG9jaykoc25hcHNob3QpLCBmb2N1c0xpc3RJdGVtID0gZm9jdXNUZXh0QmxvY2subm9kZS5saXN0SXRlbSwgZm9jdXNMZXZlbCA9IGZvY3VzVGV4dEJsb2NrLm5vZGUubGV2ZWw7XG4gICAgcmV0dXJuIGF0VGhlRW5kT2ZCbG9jayA/IHtcbiAgICAgIGZvY3VzTGlzdEl0ZW0sXG4gICAgICBmb2N1c0xldmVsXG4gICAgfSA6ICExO1xuICB9LFxuICBhY3Rpb25zOiBbKHtcbiAgICBzbmFwc2hvdFxuICB9LCB7XG4gICAgZm9jdXNMaXN0SXRlbSxcbiAgICBmb2N1c0xldmVsXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazoge1xuICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWUsXG4gICAgICBjaGlsZHJlbjogW3tcbiAgICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLnNwYW4ubmFtZSxcbiAgICAgICAgdGV4dDogXCJcIixcbiAgICAgICAgbWFya3M6IFtdXG4gICAgICB9XSxcbiAgICAgIG1hcmtEZWZzOiBbXSxcbiAgICAgIGxpc3RJdGVtOiBmb2N1c0xpc3RJdGVtLFxuICAgICAgbGV2ZWw6IGZvY3VzTGV2ZWwsXG4gICAgICBzdHlsZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3R5bGVzWzBdPy5uYW1lXG4gICAgfSxcbiAgICBwbGFjZW1lbnQ6IFwiYWZ0ZXJcIlxuICB9KV1dXG59KSwgYnJlYWtpbmdBdFRoZVN0YXJ0T2ZUZXh0QmxvY2sgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImluc2VydC5icmVha1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgY29uc3QgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCksIHNlbGVjdGlvbkNvbGxhcHNlZCA9IGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpO1xuICAgIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24gfHwgIWZvY3VzVGV4dEJsb2NrIHx8ICFzZWxlY3Rpb25Db2xsYXBzZWQpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgZm9jdXNTcGFuID0gZ2V0Rm9jdXNTcGFuJDEoc25hcHNob3QpLCBmb2N1c0RlY29yYXRvcnMgPSBmb2N1c1NwYW4/Lm5vZGUubWFya3M/LmZpbHRlcigobWFyaykgPT4gc25hcHNob3QuY29udGV4dC5zY2hlbWEuZGVjb3JhdG9ycy5zb21lKChkZWNvcmF0b3IpID0+IGRlY29yYXRvci5uYW1lID09PSBtYXJrKSA/PyBbXSksIGZvY3VzQW5ub3RhdGlvbnMgPSBmb2N1c1NwYW4/Lm5vZGUubWFya3M/LmZpbHRlcigobWFyaykgPT4gIXNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmRlY29yYXRvcnMuc29tZSgoZGVjb3JhdG9yKSA9PiBkZWNvcmF0b3IubmFtZSA9PT0gbWFyaykpID8/IFtdLCBmb2N1c0xpc3RJdGVtID0gZm9jdXNUZXh0QmxvY2subm9kZS5saXN0SXRlbSwgZm9jdXNMZXZlbCA9IGZvY3VzVGV4dEJsb2NrLm5vZGUubGV2ZWw7XG4gICAgcmV0dXJuIGlzQXRUaGVTdGFydE9mQmxvY2soZm9jdXNUZXh0QmxvY2spKHNuYXBzaG90KSA/IHtcbiAgICAgIGZvY3VzQW5ub3RhdGlvbnMsXG4gICAgICBmb2N1c0RlY29yYXRvcnMsXG4gICAgICBmb2N1c0xpc3RJdGVtLFxuICAgICAgZm9jdXNMZXZlbFxuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgc25hcHNob3RcbiAgfSwge1xuICAgIGZvY3VzQW5ub3RhdGlvbnMsXG4gICAgZm9jdXNEZWNvcmF0b3JzLFxuICAgIGZvY3VzTGlzdEl0ZW0sXG4gICAgZm9jdXNMZXZlbFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgYmxvY2s6IHtcbiAgICAgIF90eXBlOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lLFxuICAgICAgY2hpbGRyZW46IFt7XG4gICAgICAgIF90eXBlOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5zcGFuLm5hbWUsXG4gICAgICAgIG1hcmtzOiBmb2N1c0Fubm90YXRpb25zLmxlbmd0aCA9PT0gMCA/IGZvY3VzRGVjb3JhdG9ycyA6IFtdLFxuICAgICAgICB0ZXh0OiBcIlwiXG4gICAgICB9XSxcbiAgICAgIGxpc3RJdGVtOiBmb2N1c0xpc3RJdGVtLFxuICAgICAgbGV2ZWw6IGZvY3VzTGV2ZWwsXG4gICAgICBzdHlsZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3R5bGVzWzBdPy5uYW1lXG4gICAgfSxcbiAgICBwbGFjZW1lbnQ6IFwiYmVmb3JlXCIsXG4gICAgc2VsZWN0OiBcIm5vbmVcIlxuICB9KV1dXG59KSwgYnJlYWtpbmdFbnRpcmVCbG9ja3MgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImluc2VydC5icmVha1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiB8fCAhaXNTZWxlY3Rpb25FeHBhbmRlZChzbmFwc2hvdCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3Qgc2VsZWN0ZWRCbG9ja3MgPSBnZXRTZWxlY3RlZEJsb2NrcyhzbmFwc2hvdCksIHNlbGVjdGlvblN0YXJ0QmxvY2sgPSBnZXRTZWxlY3Rpb25TdGFydEJsb2NrKHNuYXBzaG90KSwgc2VsZWN0aW9uRW5kQmxvY2sgPSBnZXRTZWxlY3Rpb25FbmRCbG9jayhzbmFwc2hvdCk7XG4gICAgaWYgKCFzZWxlY3Rpb25TdGFydEJsb2NrIHx8ICFzZWxlY3Rpb25FbmRCbG9jaylcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBzdGFydEJsb2NrU3RhcnRQb2ludCA9IGdldEJsb2NrU3RhcnRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2s6IHNlbGVjdGlvblN0YXJ0QmxvY2tcbiAgICB9KSwgc2VsZWN0aW9uU3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQkMShzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiksIGVuZEJsb2NrRW5kUG9pbnQgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICBibG9jazogc2VsZWN0aW9uRW5kQmxvY2tcbiAgICB9KSwgc2VsZWN0aW9uRW5kUG9pbnQgPSBnZXRTZWxlY3Rpb25FbmRQb2ludCQxKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKTtcbiAgICByZXR1cm4gaXNFcXVhbFNlbGVjdGlvblBvaW50cyhzZWxlY3Rpb25TdGFydFBvaW50LCBzdGFydEJsb2NrU3RhcnRQb2ludCkgJiYgaXNFcXVhbFNlbGVjdGlvblBvaW50cyhzZWxlY3Rpb25FbmRQb2ludCwgZW5kQmxvY2tFbmRQb2ludCkgPyB7XG4gICAgICBzZWxlY3RlZEJsb2Nrc1xuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgc25hcHNob3RcbiAgfSwge1xuICAgIHNlbGVjdGVkQmxvY2tzXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazoge1xuICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLmJsb2NrLm5hbWUsXG4gICAgICBjaGlsZHJlbjogW3tcbiAgICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLnNwYW4ubmFtZSxcbiAgICAgICAgdGV4dDogXCJcIixcbiAgICAgICAgbWFya3M6IFtdXG4gICAgICB9XVxuICAgIH0sXG4gICAgcGxhY2VtZW50OiBcImJlZm9yZVwiLFxuICAgIHNlbGVjdDogXCJzdGFydFwiXG4gIH0pLCAuLi5zZWxlY3RlZEJsb2Nrcy5tYXAoKGJsb2NrKSA9PiByYWlzZSh7XG4gICAgdHlwZTogXCJkZWxldGUuYmxvY2tcIixcbiAgICBhdDogYmxvY2sucGF0aFxuICB9KSldXVxufSksIGJyZWFraW5nSW5saW5lT2JqZWN0ID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJpbnNlcnQuYnJlYWtcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3RcbiAgfSkgPT4ge1xuICAgIGNvbnN0IHNlbGVjdGlvbkNvbGxhcHNlZCA9IGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpLCBmb2N1c0lubGluZU9iamVjdCA9IGdldEZvY3VzSW5saW5lT2JqZWN0KHNuYXBzaG90KTtcbiAgICByZXR1cm4gc2VsZWN0aW9uQ29sbGFwc2VkICYmIGZvY3VzSW5saW5lT2JqZWN0O1xuICB9LFxuICBhY3Rpb25zOiBbKCkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcIm1vdmUuZm9yd2FyZFwiLFxuICAgIGRpc3RhbmNlOiAxXG4gIH0pLCByYWlzZSh7XG4gICAgdHlwZTogXCJzcGxpdFwiXG4gIH0pXV1cbn0pLCBjb3JlSW5zZXJ0QnJlYWtCZWhhdmlvcnMgPSB7XG4gIGJyZWFraW5nQXRUaGVFbmRPZlRleHRCbG9jayxcbiAgYnJlYWtpbmdBdFRoZVN0YXJ0T2ZUZXh0QmxvY2ssXG4gIGJyZWFraW5nRW50aXJlQmxvY2tzLFxuICBicmVha2luZ0lubGluZU9iamVjdFxufTtcbmZ1bmN0aW9uIGlzQXRUaGVCZWdpbm5pbmdPZkJsb2NrKHtcbiAgY29udGV4dCxcbiAgYmxvY2tcbn0pIHtcbiAgcmV0dXJuICFpc1RleHRCbG9jayhjb250ZXh0LCBibG9jaykgfHwgIWNvbnRleHQuc2VsZWN0aW9uIHx8ICFpc1NlbGVjdGlvbkNvbGxhcHNlZChjb250ZXh0LnNlbGVjdGlvbikgPyAhMSA6IGdldENoaWxkS2V5RnJvbVNlbGVjdGlvblBvaW50KGNvbnRleHQuc2VsZWN0aW9uLmZvY3VzKSA9PT0gYmxvY2suY2hpbGRyZW5bMF0uX2tleSAmJiBjb250ZXh0LnNlbGVjdGlvbi5mb2N1cy5vZmZzZXQgPT09IDA7XG59XG5jb25zdCBNQVhfTElTVF9MRVZFTCA9IDEwLCBjbGVhckxpc3RPbkJhY2tzcGFjZSA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiZGVsZXRlLmJhY2t3YXJkXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IHtcbiAgICBjb25zdCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICByZXR1cm4gIWZvY3VzVGV4dEJsb2NrIHx8IGZvY3VzVGV4dEJsb2NrLm5vZGUubGV2ZWwgIT09IDEgfHwgIWlzQXRUaGVCZWdpbm5pbmdPZkJsb2NrKHtcbiAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICBibG9jazogZm9jdXNUZXh0QmxvY2subm9kZVxuICAgIH0pID8gITEgOiB7XG4gICAgICBmb2N1c1RleHRCbG9ja1xuICAgIH07XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIGZvY3VzVGV4dEJsb2NrXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJibG9jay51bnNldFwiLFxuICAgIHByb3BzOiBbXCJsaXN0SXRlbVwiLCBcImxldmVsXCJdLFxuICAgIGF0OiBmb2N1c1RleHRCbG9jay5wYXRoXG4gIH0pXV1cbn0pLCB1bmluZGVudExpc3RPbkJhY2tzcGFjZSA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiZGVsZXRlLmJhY2t3YXJkXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IHtcbiAgICBjb25zdCBzZWxlY3Rpb25Db2xsYXBzZWQgPSBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSwgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCksIGZvY3VzU3BhbiA9IGdldEZvY3VzU3BhbiQxKHNuYXBzaG90KTtcbiAgICByZXR1cm4gIXNlbGVjdGlvbkNvbGxhcHNlZCB8fCAhZm9jdXNUZXh0QmxvY2sgfHwgIWZvY3VzU3BhbiA/ICExIDogZm9jdXNUZXh0QmxvY2subm9kZS5jaGlsZHJlblswXS5fa2V5ID09PSBmb2N1c1NwYW4ubm9kZS5fa2V5ICYmIHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uPy5mb2N1cy5vZmZzZXQgPT09IDAgJiYgZm9jdXNUZXh0QmxvY2subm9kZS5sZXZlbCAhPT0gdm9pZCAwICYmIGZvY3VzVGV4dEJsb2NrLm5vZGUubGV2ZWwgPiAxID8ge1xuICAgICAgZm9jdXNUZXh0QmxvY2ssXG4gICAgICBsZXZlbDogZm9jdXNUZXh0QmxvY2subm9kZS5sZXZlbCAtIDFcbiAgICB9IDogITE7XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIGZvY3VzVGV4dEJsb2NrLFxuICAgIGxldmVsXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJibG9jay5zZXRcIixcbiAgICBwcm9wczoge1xuICAgICAgbGV2ZWxcbiAgICB9LFxuICAgIGF0OiBmb2N1c1RleHRCbG9jay5wYXRoXG4gIH0pXV1cbn0pLCBtZXJnZVRleHRJbnRvTGlzdE9uRGVsZXRlID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJkZWxldGUuZm9yd2FyZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgY29uc3QgZm9jdXNMaXN0QmxvY2sgPSBnZXRGb2N1c0xpc3RCbG9jayhzbmFwc2hvdCksIG5leHRCbG9jayA9IGdldE5leHRCbG9jayhzbmFwc2hvdCk7XG4gICAgcmV0dXJuICFmb2N1c0xpc3RCbG9jayB8fCAhbmV4dEJsb2NrIHx8ICFpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBuZXh0QmxvY2subm9kZSkgfHwgIWlzRW1wdHlUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgZm9jdXNMaXN0QmxvY2subm9kZSkgPyAhMSA6IHtcbiAgICAgIGZvY3VzTGlzdEJsb2NrLFxuICAgICAgbmV4dEJsb2NrXG4gICAgfTtcbiAgfSxcbiAgYWN0aW9uczogWyhfLCB7XG4gICAgbmV4dEJsb2NrXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazogbmV4dEJsb2NrLm5vZGUsXG4gICAgcGxhY2VtZW50OiBcImF1dG9cIixcbiAgICBzZWxlY3Q6IFwic3RhcnRcIlxuICB9KSwgcmFpc2Uoe1xuICAgIHR5cGU6IFwiZGVsZXRlLmJsb2NrXCIsXG4gICAgYXQ6IG5leHRCbG9jay5wYXRoXG4gIH0pXV1cbn0pLCBtZXJnZVRleHRJbnRvTGlzdE9uQmFja3NwYWNlID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJkZWxldGUuYmFja3dhcmRcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3RcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGZvY3VzVGV4dEJsb2NrID0gZ2V0Rm9jdXNUZXh0QmxvY2soc25hcHNob3QpLCBwcmV2aW91c0Jsb2NrID0gZ2V0UHJldmlvdXNCbG9jayhzbmFwc2hvdCk7XG4gICAgaWYgKCFmb2N1c1RleHRCbG9jayB8fCAhcHJldmlvdXNCbG9jayB8fCAhaXNBdFRoZUJlZ2lubmluZ09mQmxvY2soe1xuICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgIGJsb2NrOiBmb2N1c1RleHRCbG9jay5ub2RlXG4gICAgfSkgfHwgIWlzTGlzdEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIHByZXZpb3VzQmxvY2subm9kZSkgfHwgIWlzRW1wdHlUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgcHJldmlvdXNCbG9jay5ub2RlKSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBwcmV2aW91c0Jsb2NrRW5kUG9pbnQgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICBibG9jazogcHJldmlvdXNCbG9ja1xuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICBmb2N1c1RleHRCbG9jayxcbiAgICAgIHByZXZpb3VzQmxvY2tFbmRQb2ludFxuICAgIH07XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIGZvY3VzVGV4dEJsb2NrLFxuICAgIHByZXZpb3VzQmxvY2tFbmRQb2ludFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgYXQ6IHtcbiAgICAgIGFuY2hvcjogcHJldmlvdXNCbG9ja0VuZFBvaW50LFxuICAgICAgZm9jdXM6IHByZXZpb3VzQmxvY2tFbmRQb2ludFxuICAgIH1cbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgIGJsb2NrOiBmb2N1c1RleHRCbG9jay5ub2RlLFxuICAgIHBsYWNlbWVudDogXCJhdXRvXCIsXG4gICAgc2VsZWN0OiBcInN0YXJ0XCJcbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcImRlbGV0ZS5ibG9ja1wiLFxuICAgIGF0OiBmb2N1c1RleHRCbG9jay5wYXRoXG4gIH0pXV1cbn0pLCBkZWxldGluZ0xpc3RGcm9tU3RhcnQgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgY29uc3QgYXQgPSBldmVudC5hdCA/PyBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbjtcbiAgICBpZiAoIWF0KVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGJsb2Nrc1RvRGVsZXRlID0gZ2V0U2VsZWN0ZWRCbG9ja3Moe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjogYXRcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoYmxvY2tzVG9EZWxldGUubGVuZ3RoIDwgMilcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBzdGFydEJsb2NrID0gYmxvY2tzVG9EZWxldGUuYXQoMCk/Lm5vZGUsIG1pZGRsZUJsb2NrcyA9IGJsb2Nrc1RvRGVsZXRlLnNsaWNlKDEsIC0xKSwgZW5kQmxvY2sgPSBibG9ja3NUb0RlbGV0ZS5hdCgtMSk/Lm5vZGU7XG4gICAgaWYgKCFpc0xpc3RCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBzdGFydEJsb2NrKSB8fCAhaXNMaXN0QmxvY2soc25hcHNob3QuY29udGV4dCwgZW5kQmxvY2spKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGRlbGV0ZVN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiBhdFxuICAgICAgfVxuICAgIH0pLCBkZWxldGVFbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiBhdFxuICAgICAgfVxuICAgIH0pO1xuICAgIGlmICghZGVsZXRlU3RhcnRQb2ludCB8fCAhZGVsZXRlRW5kUG9pbnQpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3Qgc3RhcnRCbG9ja1N0YXJ0UG9pbnQgPSBnZXRCbG9ja1N0YXJ0UG9pbnQoe1xuICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgIGJsb2NrOiB7XG4gICAgICAgIG5vZGU6IHN0YXJ0QmxvY2ssXG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogc3RhcnRCbG9jay5fa2V5XG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFpc0VxdWFsU2VsZWN0aW9uUG9pbnRzKGRlbGV0ZVN0YXJ0UG9pbnQsIHN0YXJ0QmxvY2tTdGFydFBvaW50KSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBzdGFydEJsb2NrRW5kUG9pbnQgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICBibG9jazoge1xuICAgICAgICBub2RlOiBzdGFydEJsb2NrLFxuICAgICAgICBwYXRoOiBbe1xuICAgICAgICAgIF9rZXk6IHN0YXJ0QmxvY2suX2tleVxuICAgICAgICB9XVxuICAgICAgfVxuICAgIH0pLCBlbmRCbG9ja0VuZFBvaW50ID0gZ2V0QmxvY2tFbmRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2s6IHtcbiAgICAgICAgbm9kZTogZW5kQmxvY2ssXG4gICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgX2tleTogZW5kQmxvY2suX2tleVxuICAgICAgICB9XVxuICAgICAgfVxuICAgIH0pLCBzbGljZWRFbmRCbG9jayA9IHNsaWNlVGV4dEJsb2NrKHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiBkZWxldGVFbmRQb2ludCxcbiAgICAgICAgICBmb2N1czogZW5kQmxvY2tFbmRQb2ludFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYmxvY2s6IGVuZEJsb2NrXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXJ0QmxvY2tTdGFydFBvaW50LFxuICAgICAgc3RhcnRCbG9ja0VuZFBvaW50LFxuICAgICAgbWlkZGxlQmxvY2tzLFxuICAgICAgZW5kQmxvY2ssXG4gICAgICBzbGljZWRFbmRCbG9ja1xuICAgIH07XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIHN0YXJ0QmxvY2tTdGFydFBvaW50LFxuICAgIHN0YXJ0QmxvY2tFbmRQb2ludCxcbiAgICBtaWRkbGVCbG9ja3MsXG4gICAgZW5kQmxvY2ssXG4gICAgc2xpY2VkRW5kQmxvY2tcbiAgfSkgPT4gW1xuICAgIC8vIEFsbCBibG9jayBpbiBiZXR3ZWVuIGNhbiBzYWZlbHkgYmUgZGVsZXRlZC5cbiAgICAuLi5taWRkbGVCbG9ja3MubWFwKChibG9jaykgPT4gcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGUuYmxvY2tcIixcbiAgICAgIGF0OiBibG9jay5wYXRoXG4gICAgfSkpLFxuICAgIC8vIFRoZSBsYXN0IGJsb2NrIGlzIGRlbGV0ZWQgYXMgd2VsbC5cbiAgICByYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZS5ibG9ja1wiLFxuICAgICAgYXQ6IFt7XG4gICAgICAgIF9rZXk6IGVuZEJsb2NrLl9rZXlcbiAgICAgIH1dXG4gICAgfSksXG4gICAgLy8gQnV0IGluIGNhc2UgdGhlIGRlbGV0ZSBvcGVyYXRpb24gZGlkbid0IHJlYWNoIGFsbCB0aGUgd2F5IHRvIHRoZSBlbmRcbiAgICAvLyBvZiBpdCwgd2UgZmlyc3QgcGxhY2UgdGhlIGNhcmV0IGF0IHRoZSBlbmQgb2YgdGhlIHN0YXJ0IGJsb2NrLi4uXG4gICAgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGF0OiB7XG4gICAgICAgIGFuY2hvcjogc3RhcnRCbG9ja0VuZFBvaW50LFxuICAgICAgICBmb2N1czogc3RhcnRCbG9ja0VuZFBvaW50XG4gICAgICB9XG4gICAgfSksXG4gICAgLy8gLi4uYW5kIGluc2VydCB0aGUgcmVzdCBvZiB0aGUgZW5kIGJsb2NrIGF0IHRoZSBlbmQgb2YgaXQuXG4gICAgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrOiBzbGljZWRFbmRCbG9jayxcbiAgICAgIHBsYWNlbWVudDogXCJhdXRvXCIsXG4gICAgICBzZWxlY3Q6IFwibm9uZVwiXG4gICAgfSksXG4gICAgLy8gQW5kIGZpbmFsbHksIHdlIGRlbGV0ZSB0aGUgb3JpZ2luYWwgdGV4dCBvZiB0aGUgc3RhcnQgYmxvY2suXG4gICAgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgIGF0OiB7XG4gICAgICAgIGFuY2hvcjogc3RhcnRCbG9ja1N0YXJ0UG9pbnQsXG4gICAgICAgIGZvY3VzOiBzdGFydEJsb2NrRW5kUG9pbnRcbiAgICAgIH1cbiAgICB9KVxuICBdXVxufSksIGNsZWFyTGlzdE9uRW50ZXIgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImluc2VydC5icmVha1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0aW9uQ29sbGFwc2VkID0gaXNTZWxlY3Rpb25Db2xsYXBzZWQkMShzbmFwc2hvdCksIGZvY3VzTGlzdEJsb2NrID0gZ2V0Rm9jdXNMaXN0QmxvY2soc25hcHNob3QpO1xuICAgIHJldHVybiAhc2VsZWN0aW9uQ29sbGFwc2VkIHx8ICFmb2N1c0xpc3RCbG9jayB8fCAhaXNFbXB0eVRleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBmb2N1c0xpc3RCbG9jay5ub2RlKSA/ICExIDoge1xuICAgICAgZm9jdXNMaXN0QmxvY2tcbiAgICB9O1xuICB9LFxuICBhY3Rpb25zOiBbKF8sIHtcbiAgICBmb2N1c0xpc3RCbG9ja1xuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiYmxvY2sudW5zZXRcIixcbiAgICBwcm9wczogW1wibGlzdEl0ZW1cIiwgXCJsZXZlbFwiXSxcbiAgICBhdDogZm9jdXNMaXN0QmxvY2sucGF0aFxuICB9KV1dXG59KSwgaW5kZW50TGlzdE9uVGFiID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJrZXlib2FyZC5rZXlkb3duXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBpZiAoIWRlZmF1bHRLZXlib2FyZFNob3J0Y3V0cy50YWIuZ3VhcmQoZXZlbnQub3JpZ2luRXZlbnQpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IHNlbGVjdGVkQmxvY2tzID0gZ2V0U2VsZWN0ZWRCbG9ja3Moc25hcHNob3QpLCBzZWxlY3RlZExpc3RCbG9ja3MgPSBzZWxlY3RlZEJsb2Nrcy5mbGF0TWFwKChibG9jaykgPT4gaXNMaXN0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2subm9kZSkgPyBbe1xuICAgICAgbm9kZTogYmxvY2subm9kZSxcbiAgICAgIHBhdGg6IGJsb2NrLnBhdGhcbiAgICB9XSA6IFtdKTtcbiAgICByZXR1cm4gc2VsZWN0ZWRMaXN0QmxvY2tzLmxlbmd0aCA9PT0gc2VsZWN0ZWRCbG9ja3MubGVuZ3RoID8ge1xuICAgICAgc2VsZWN0ZWRMaXN0QmxvY2tzXG4gICAgfSA6ICExO1xuICB9LFxuICBhY3Rpb25zOiBbKF8sIHtcbiAgICBzZWxlY3RlZExpc3RCbG9ja3NcbiAgfSkgPT4gc2VsZWN0ZWRMaXN0QmxvY2tzLm1hcCgoc2VsZWN0ZWRMaXN0QmxvY2spID0+IHJhaXNlKHtcbiAgICB0eXBlOiBcImJsb2NrLnNldFwiLFxuICAgIHByb3BzOiB7XG4gICAgICBsZXZlbDogTWF0aC5taW4oTUFYX0xJU1RfTEVWRUwsIE1hdGgubWF4KDEsIHNlbGVjdGVkTGlzdEJsb2NrLm5vZGUubGV2ZWwgKyAxKSlcbiAgICB9LFxuICAgIGF0OiBzZWxlY3RlZExpc3RCbG9jay5wYXRoXG4gIH0pKV1cbn0pLCB1bmluZGVudExpc3RPblNoaWZ0VGFiID0gZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJrZXlib2FyZC5rZXlkb3duXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBpZiAoIWRlZmF1bHRLZXlib2FyZFNob3J0Y3V0cy5zaGlmdFRhYi5ndWFyZChldmVudC5vcmlnaW5FdmVudCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3Qgc2VsZWN0ZWRCbG9ja3MgPSBnZXRTZWxlY3RlZEJsb2NrcyhzbmFwc2hvdCksIHNlbGVjdGVkTGlzdEJsb2NrcyA9IHNlbGVjdGVkQmxvY2tzLmZsYXRNYXAoKGJsb2NrKSA9PiBpc0xpc3RCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBibG9jay5ub2RlKSA/IFt7XG4gICAgICBub2RlOiBibG9jay5ub2RlLFxuICAgICAgcGF0aDogYmxvY2sucGF0aFxuICAgIH1dIDogW10pO1xuICAgIHJldHVybiBzZWxlY3RlZExpc3RCbG9ja3MubGVuZ3RoID09PSBzZWxlY3RlZEJsb2Nrcy5sZW5ndGggPyB7XG4gICAgICBzZWxlY3RlZExpc3RCbG9ja3NcbiAgICB9IDogITE7XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIHNlbGVjdGVkTGlzdEJsb2Nrc1xuICB9KSA9PiBzZWxlY3RlZExpc3RCbG9ja3MubWFwKChzZWxlY3RlZExpc3RCbG9jaykgPT4gcmFpc2Uoe1xuICAgIHR5cGU6IFwiYmxvY2suc2V0XCIsXG4gICAgcHJvcHM6IHtcbiAgICAgIGxldmVsOiBNYXRoLm1pbihNQVhfTElTVF9MRVZFTCwgTWF0aC5tYXgoMSwgc2VsZWN0ZWRMaXN0QmxvY2subm9kZS5sZXZlbCAtIDEpKVxuICAgIH0sXG4gICAgYXQ6IHNlbGVjdGVkTGlzdEJsb2NrLnBhdGhcbiAgfSkpXVxufSksIGluaGVyaXRMaXN0TGV2ZWwgPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImluc2VydC5ibG9ja3NcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGZvY3VzTGlzdEJsb2NrID0gZ2V0Rm9jdXNMaXN0QmxvY2soc25hcHNob3QpO1xuICAgIGlmICghZm9jdXNMaXN0QmxvY2spXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgZmlyc3RJbnNlcnRlZEJsb2NrID0gZXZlbnQuYmxvY2tzLmF0KDApLCBzZWNvbmRJbnNlcnRlZEJsb2NrID0gZXZlbnQuYmxvY2tzLmF0KDEpLCBpbnNlcnRlZExpc3RCbG9jayA9IGlzTGlzdEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGZpcnN0SW5zZXJ0ZWRCbG9jaykgPyBmaXJzdEluc2VydGVkQmxvY2sgOiBpc0xpc3RCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBzZWNvbmRJbnNlcnRlZEJsb2NrKSA/IHNlY29uZEluc2VydGVkQmxvY2sgOiB2b2lkIDA7XG4gICAgaWYgKCFpbnNlcnRlZExpc3RCbG9jaylcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBsZXZlbERpZmZlcmVuY2UgPSBmb2N1c0xpc3RCbG9jay5ub2RlLmxldmVsIC0gaW5zZXJ0ZWRMaXN0QmxvY2subGV2ZWw7XG4gICAgcmV0dXJuIGxldmVsRGlmZmVyZW5jZSA9PT0gMCA/ICExIDoge1xuICAgICAgbGV2ZWxEaWZmZXJlbmNlLFxuICAgICAgaW5zZXJ0ZWRMaXN0QmxvY2tcbiAgICB9O1xuICB9LFxuICBhY3Rpb25zOiBbKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9LCB7XG4gICAgbGV2ZWxEaWZmZXJlbmNlLFxuICAgIGluc2VydGVkTGlzdEJsb2NrXG4gIH0pID0+IHtcbiAgICBsZXQgYWRqdXN0TGV2ZWwgPSAhMCwgbGlzdFN0YXJ0QmxvY2tGb3VuZCA9ICExO1xuICAgIHJldHVybiBbcmFpc2Uoe1xuICAgICAgLi4uZXZlbnQsXG4gICAgICBibG9ja3M6IGV2ZW50LmJsb2Nrcy5tYXAoKGJsb2NrKSA9PiAoYmxvY2suX2tleSA9PT0gaW5zZXJ0ZWRMaXN0QmxvY2suX2tleSAmJiAobGlzdFN0YXJ0QmxvY2tGb3VuZCA9ICEwKSwgYWRqdXN0TGV2ZWwgPyBsaXN0U3RhcnRCbG9ja0ZvdW5kICYmIGFkanVzdExldmVsICYmIGlzTGlzdEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSA/IHtcbiAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgIGxldmVsOiBNYXRoLm1pbihNQVhfTElTVF9MRVZFTCwgTWF0aC5tYXgoMSwgYmxvY2subGV2ZWwgKyBsZXZlbERpZmZlcmVuY2UpKVxuICAgICAgfSA6IChsaXN0U3RhcnRCbG9ja0ZvdW5kICYmIChhZGp1c3RMZXZlbCA9ICExKSwgYmxvY2spIDogYmxvY2spKVxuICAgIH0pXTtcbiAgfV1cbn0pLCBpbmhlcml0TGlzdEl0ZW0gPSBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImluc2VydC5ibG9ja3NcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGZvY3VzTGlzdEJsb2NrID0gZ2V0Rm9jdXNMaXN0QmxvY2soc25hcHNob3QpO1xuICAgIGlmICghZm9jdXNMaXN0QmxvY2sgfHwgaXNFbXB0eVRleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBmb2N1c0xpc3RCbG9jay5ub2RlKSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBmaXJzdEluc2VydGVkQmxvY2sgPSBldmVudC5ibG9ja3MuYXQoMCksIHNlY29uZEluc2VydGVkQmxvY2sgPSBldmVudC5ibG9ja3MuYXQoMSksIGluc2VydGVkTGlzdEJsb2NrID0gaXNMaXN0QmxvY2soc25hcHNob3QuY29udGV4dCwgZmlyc3RJbnNlcnRlZEJsb2NrKSA/IGZpcnN0SW5zZXJ0ZWRCbG9jayA6IGlzTGlzdEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIHNlY29uZEluc2VydGVkQmxvY2spID8gc2Vjb25kSW5zZXJ0ZWRCbG9jayA6IHZvaWQgMDtcbiAgICByZXR1cm4gIWluc2VydGVkTGlzdEJsb2NrIHx8IGZvY3VzTGlzdEJsb2NrLm5vZGUubGV2ZWwgIT09IGluc2VydGVkTGlzdEJsb2NrLmxldmVsIHx8IGZvY3VzTGlzdEJsb2NrLm5vZGUubGlzdEl0ZW0gPT09IGluc2VydGVkTGlzdEJsb2NrLmxpc3RJdGVtID8gITEgOiB7XG4gICAgICBsaXN0SXRlbTogZm9jdXNMaXN0QmxvY2subm9kZS5saXN0SXRlbSxcbiAgICAgIGluc2VydGVkTGlzdEJsb2NrXG4gICAgfTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSwge1xuICAgIGxpc3RJdGVtLFxuICAgIGluc2VydGVkTGlzdEJsb2NrXG4gIH0pID0+IHtcbiAgICBsZXQgYWRqdXN0TGlzdEl0ZW0gPSAhMCwgbGlzdFN0YXJ0QmxvY2tGb3VuZCA9ICExO1xuICAgIHJldHVybiBbcmFpc2Uoe1xuICAgICAgLi4uZXZlbnQsXG4gICAgICBibG9ja3M6IGV2ZW50LmJsb2Nrcy5tYXAoKGJsb2NrKSA9PiAoYmxvY2suX2tleSA9PT0gaW5zZXJ0ZWRMaXN0QmxvY2suX2tleSAmJiAobGlzdFN0YXJ0QmxvY2tGb3VuZCA9ICEwKSwgYWRqdXN0TGlzdEl0ZW0gPyBsaXN0U3RhcnRCbG9ja0ZvdW5kICYmIGFkanVzdExpc3RJdGVtICYmIGlzTGlzdEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGJsb2NrKSA/IHtcbiAgICAgICAgLi4uYmxvY2ssXG4gICAgICAgIGxpc3RJdGVtOiBibG9jay5sZXZlbCA9PT0gaW5zZXJ0ZWRMaXN0QmxvY2subGV2ZWwgPyBsaXN0SXRlbSA6IGJsb2NrLmxpc3RJdGVtXG4gICAgICB9IDogKGxpc3RTdGFydEJsb2NrRm91bmQgJiYgKGFkanVzdExpc3RJdGVtID0gITEpLCBibG9jaykgOiBibG9jaykpXG4gICAgfSldO1xuICB9XVxufSksIGluaGVyaXRMaXN0UHJvcGVydGllcyA9IGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiaW5zZXJ0LmJsb2NrXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBpZiAoZXZlbnQucGxhY2VtZW50ICE9PSBcImF1dG9cIiB8fCBldmVudC5ibG9jay5fdHlwZSAhPT0gc25hcHNob3QuY29udGV4dC5zY2hlbWEuYmxvY2submFtZSB8fCBldmVudC5ibG9jay5saXN0SXRlbSAhPT0gdm9pZCAwKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGZvY3VzTGlzdEJsb2NrID0gZ2V0Rm9jdXNMaXN0QmxvY2soc25hcHNob3QpO1xuICAgIHJldHVybiAhZm9jdXNMaXN0QmxvY2sgfHwgIWlzRW1wdHlUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgZm9jdXNMaXN0QmxvY2subm9kZSkgPyAhMSA6IHtcbiAgICAgIGxldmVsOiBmb2N1c0xpc3RCbG9jay5ub2RlLmxldmVsLFxuICAgICAgbGlzdEl0ZW06IGZvY3VzTGlzdEJsb2NrLm5vZGUubGlzdEl0ZW1cbiAgICB9O1xuICB9LFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9LCB7XG4gICAgbGV2ZWwsXG4gICAgbGlzdEl0ZW1cbiAgfSkgPT4gW3JhaXNlKHtcbiAgICAuLi5ldmVudCxcbiAgICBibG9jazoge1xuICAgICAgLi4uZXZlbnQuYmxvY2ssXG4gICAgICBsZXZlbCxcbiAgICAgIGxpc3RJdGVtXG4gICAgfVxuICB9KV1dXG59KSwgY29yZUxpc3RCZWhhdmlvcnMgPSB7XG4gIGNsZWFyTGlzdE9uQmFja3NwYWNlLFxuICB1bmluZGVudExpc3RPbkJhY2tzcGFjZSxcbiAgbWVyZ2VUZXh0SW50b0xpc3RPbkRlbGV0ZSxcbiAgbWVyZ2VUZXh0SW50b0xpc3RPbkJhY2tzcGFjZSxcbiAgZGVsZXRpbmdMaXN0RnJvbVN0YXJ0LFxuICBjbGVhckxpc3RPbkVudGVyLFxuICBpbmRlbnRMaXN0T25UYWIsXG4gIHVuaW5kZW50TGlzdE9uU2hpZnRUYWIsXG4gIGluaGVyaXRMaXN0TGV2ZWwsXG4gIGluaGVyaXRMaXN0SXRlbSxcbiAgaW5oZXJpdExpc3RQcm9wZXJ0aWVzXG59LCBjb3JlQmVoYXZpb3JzQ29uZmlnID0gWy4uLmNvcmVBbm5vdGF0aW9uQmVoYXZpb3JzLCBjb3JlRGVjb3JhdG9yQmVoYXZpb3JzLnN0cm9uZ1Nob3J0Y3V0LCBjb3JlRGVjb3JhdG9yQmVoYXZpb3JzLmVtU2hvcnRjdXQsIGNvcmVEZWNvcmF0b3JCZWhhdmlvcnMudW5kZXJsaW5lU2hvcnRjdXQsIGNvcmVEZWNvcmF0b3JCZWhhdmlvcnMuY29kZVNob3J0Y3V0LCAuLi5jb3JlRG5kQmVoYXZpb3JzLCBjb3JlQmxvY2tPYmplY3RCZWhhdmlvcnMuY2xpY2tpbmdBYm92ZUxvbmVseUJsb2NrT2JqZWN0LCBjb3JlQmxvY2tPYmplY3RCZWhhdmlvcnMuY2xpY2tpbmdCZWxvd0xvbmVseUJsb2NrT2JqZWN0LCBjb3JlQmxvY2tPYmplY3RCZWhhdmlvcnMuYXJyb3dEb3duT25Mb25lbHlCbG9ja09iamVjdCwgY29yZUJsb2NrT2JqZWN0QmVoYXZpb3JzLmFycm93VXBPbkxvbmVseUJsb2NrT2JqZWN0LCBjb3JlQmxvY2tPYmplY3RCZWhhdmlvcnMuYnJlYWtpbmdCbG9ja09iamVjdCwgY29yZUJsb2NrT2JqZWN0QmVoYXZpb3JzLmRlbGV0aW5nRW1wdHlUZXh0QmxvY2tBZnRlckJsb2NrT2JqZWN0LCBjb3JlQmxvY2tPYmplY3RCZWhhdmlvcnMuZGVsZXRpbmdFbXB0eVRleHRCbG9ja0JlZm9yZUJsb2NrT2JqZWN0LCAuLi5jb3JlSW5zZXJ0QmVoYXZpb3JzLCBjb3JlTGlzdEJlaGF2aW9ycy5jbGVhckxpc3RPbkJhY2tzcGFjZSwgY29yZUxpc3RCZWhhdmlvcnMudW5pbmRlbnRMaXN0T25CYWNrc3BhY2UsIGNvcmVMaXN0QmVoYXZpb3JzLm1lcmdlVGV4dEludG9MaXN0T25EZWxldGUsIGNvcmVMaXN0QmVoYXZpb3JzLm1lcmdlVGV4dEludG9MaXN0T25CYWNrc3BhY2UsIGNvcmVMaXN0QmVoYXZpb3JzLmRlbGV0aW5nTGlzdEZyb21TdGFydCwgY29yZUxpc3RCZWhhdmlvcnMuY2xlYXJMaXN0T25FbnRlciwgY29yZUxpc3RCZWhhdmlvcnMuaW5kZW50TGlzdE9uVGFiLCBjb3JlTGlzdEJlaGF2aW9ycy51bmluZGVudExpc3RPblNoaWZ0VGFiLCBjb3JlTGlzdEJlaGF2aW9ycy5pbmhlcml0TGlzdExldmVsLCBjb3JlTGlzdEJlaGF2aW9ycy5pbmhlcml0TGlzdEl0ZW0sIGNvcmVMaXN0QmVoYXZpb3JzLmluaGVyaXRMaXN0UHJvcGVydGllcywgY29yZUluc2VydEJyZWFrQmVoYXZpb3JzLmJyZWFraW5nQXRUaGVFbmRPZlRleHRCbG9jaywgY29yZUluc2VydEJyZWFrQmVoYXZpb3JzLmJyZWFraW5nQXRUaGVTdGFydE9mVGV4dEJsb2NrLCBjb3JlSW5zZXJ0QnJlYWtCZWhhdmlvcnMuYnJlYWtpbmdFbnRpcmVCbG9ja3MsIGNvcmVJbnNlcnRCcmVha0JlaGF2aW9ycy5icmVha2luZ0lubGluZU9iamVjdF0ubWFwKChiZWhhdmlvcikgPT4gKHtcbiAgYmVoYXZpb3IsXG4gIHByaW9yaXR5OiBjb3JlUHJpb3JpdHlcbn0pKTtcbmZ1bmN0aW9uIHdpdGhQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24oZWRpdG9yLCBmbikge1xuICBjb25zdCBwcmV2ID0gZWRpdG9yLmlzUGVyZm9ybWluZ0JlaGF2aW9yT3BlcmF0aW9uO1xuICBlZGl0b3IuaXNQZXJmb3JtaW5nQmVoYXZpb3JPcGVyYXRpb24gPSAhMCwgZm4oKSwgZWRpdG9yLmlzUGVyZm9ybWluZ0JlaGF2aW9yT3BlcmF0aW9uID0gcHJldjtcbn1cbmZ1bmN0aW9uIHdpdGhvdXROb3JtYWxpemluZ0NvbmRpdGlvbmFsKGVkaXRvciwgcHJlZGljYXRlLCBmbikge1xuICBwcmVkaWNhdGUoKSA/IEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCBmbikgOiBmbigpO1xufVxuY29uc3QgYWJzdHJhY3RBbm5vdGF0aW9uQmVoYXZpb3JzID0gW2RlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiYW5ub3RhdGlvbi5zZXRcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGJsb2NrS2V5ID0gZXZlbnQuYXRbMF0uX2tleSwgbWFya0RlZktleSA9IGV2ZW50LmF0WzJdLl9rZXksIGJsb2NrID0gZ2V0Rm9jdXNUZXh0QmxvY2soe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgX2tleTogYmxvY2tLZXlcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb2N1czoge1xuICAgICAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICAgICAgX2tleTogYmxvY2tLZXlcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFibG9jaylcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCB1cGRhdGVkTWFya0RlZnMgPSBibG9jay5ub2RlLm1hcmtEZWZzPy5tYXAoKG1hcmtEZWYpID0+IG1hcmtEZWYuX2tleSA9PT0gbWFya0RlZktleSA/IHtcbiAgICAgIC4uLm1hcmtEZWYsXG4gICAgICAuLi5ldmVudC5wcm9wc1xuICAgIH0gOiBtYXJrRGVmKTtcbiAgICByZXR1cm4ge1xuICAgICAgYmxvY2tLZXksXG4gICAgICB1cGRhdGVkTWFya0RlZnNcbiAgICB9O1xuICB9LFxuICBhY3Rpb25zOiBbKF8sIHtcbiAgICBibG9ja0tleSxcbiAgICB1cGRhdGVkTWFya0RlZnNcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcImJsb2NrLnNldFwiLFxuICAgIGF0OiBbe1xuICAgICAgX2tleTogYmxvY2tLZXlcbiAgICB9XSxcbiAgICBwcm9wczoge1xuICAgICAgbWFya0RlZnM6IHVwZGF0ZWRNYXJrRGVmc1xuICAgIH1cbiAgfSldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiYW5ub3RhdGlvbi50b2dnbGVcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4gaXNBY3RpdmVBbm5vdGF0aW9uKGV2ZW50LmFubm90YXRpb24ubmFtZSkoc25hcHNob3QpLFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiYW5ub3RhdGlvbi5yZW1vdmVcIixcbiAgICBhbm5vdGF0aW9uOiBldmVudC5hbm5vdGF0aW9uXG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImFubm90YXRpb24udG9nZ2xlXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+ICFpc0FjdGl2ZUFubm90YXRpb24oZXZlbnQuYW5ub3RhdGlvbi5uYW1lKShzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJhbm5vdGF0aW9uLmFkZFwiLFxuICAgIGFubm90YXRpb246IGV2ZW50LmFubm90YXRpb25cbiAgfSldXVxufSldLCBhYnN0cmFjdERlY29yYXRvckJlaGF2aW9ycyA9IFtkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlY29yYXRvci50b2dnbGVcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4gaXNBY3RpdmVEZWNvcmF0b3IoZXZlbnQuZGVjb3JhdG9yKShzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJkZWNvcmF0b3IucmVtb3ZlXCIsXG4gICAgZGVjb3JhdG9yOiBldmVudC5kZWNvcmF0b3JcbiAgfSldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiZGVjb3JhdG9yLnRvZ2dsZVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiBldmVudC5hdCA/ICFpc0FjdGl2ZURlY29yYXRvcihldmVudC5kZWNvcmF0b3IpKHtcbiAgICAuLi5zbmFwc2hvdCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uOiBldmVudC5hdFxuICAgIH1cbiAgfSkgOiAhaXNBY3RpdmVEZWNvcmF0b3IoZXZlbnQuZGVjb3JhdG9yKShzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgLi4uZXZlbnQsXG4gICAgdHlwZTogXCJkZWNvcmF0b3IuYWRkXCJcbiAgfSldXVxufSldLCBhYnN0cmFjdERlbGV0ZUJlaGF2aW9ycyA9IFtkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZS5iYWNrd2FyZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcImRlbGV0ZVwiLFxuICAgIGRpcmVjdGlvbjogXCJiYWNrd2FyZFwiLFxuICAgIHVuaXQ6IGV2ZW50LnVuaXRcbiAgfSldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiZGVsZXRlXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+IHtcbiAgICBpZiAoZXZlbnQuZGlyZWN0aW9uICE9PSBcImJhY2t3YXJkXCIpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgcHJldmlvdXNCbG9jayA9IGdldFByZXZpb3VzQmxvY2soc25hcHNob3QpLCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICBpZiAoIXByZXZpb3VzQmxvY2sgfHwgIWZvY3VzVGV4dEJsb2NrIHx8ICFpc0F0VGhlU3RhcnRPZkJsb2NrKGZvY3VzVGV4dEJsb2NrKShzbmFwc2hvdCkpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgcHJldmlvdXNCbG9ja0VuZFBvaW50ID0gZ2V0QmxvY2tFbmRQb2ludCh7XG4gICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgYmxvY2s6IHByZXZpb3VzQmxvY2tcbiAgICB9KTtcbiAgICByZXR1cm4gaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgcHJldmlvdXNCbG9jay5ub2RlKSA/IHtcbiAgICAgIHByZXZpb3VzQmxvY2tFbmRQb2ludCxcbiAgICAgIGZvY3VzVGV4dEJsb2NrXG4gICAgfSA6ICExO1xuICB9LFxuICBhY3Rpb25zOiBbKF8sIHtcbiAgICBwcmV2aW91c0Jsb2NrRW5kUG9pbnQsXG4gICAgZm9jdXNUZXh0QmxvY2tcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcImRlbGV0ZS5ibG9ja1wiLFxuICAgIGF0OiBmb2N1c1RleHRCbG9jay5wYXRoXG4gIH0pLCByYWlzZSh7XG4gICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICBhdDoge1xuICAgICAgYW5jaG9yOiBwcmV2aW91c0Jsb2NrRW5kUG9pbnQsXG4gICAgICBmb2N1czogcHJldmlvdXNCbG9ja0VuZFBvaW50XG4gICAgfVxuICB9KSwgcmFpc2Uoe1xuICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgYmxvY2s6IGZvY3VzVGV4dEJsb2NrLm5vZGUsXG4gICAgcGxhY2VtZW50OiBcImF1dG9cIixcbiAgICBzZWxlY3Q6IFwic3RhcnRcIlxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJkZWxldGUuZm9yd2FyZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcImRlbGV0ZVwiLFxuICAgIGRpcmVjdGlvbjogXCJmb3J3YXJkXCIsXG4gICAgdW5pdDogZXZlbnQudW5pdFxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJkZWxldGVcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGlmIChldmVudC5kaXJlY3Rpb24gIT09IFwiZm9yd2FyZFwiKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGF0ID0gZXZlbnQuYXQgPz8gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb247XG4gICAgaWYgKCFhdClcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBuZXh0QmxvY2sgPSBnZXROZXh0QmxvY2soe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjogYXRcbiAgICAgIH1cbiAgICB9KSwgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiBhdFxuICAgICAgfVxuICAgIH0pO1xuICAgIGlmICghbmV4dEJsb2NrIHx8ICFmb2N1c1RleHRCbG9jayB8fCAhaXNFbXB0eVRleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBmb2N1c1RleHRCbG9jay5ub2RlKSlcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBuZXh0QmxvY2tTdGFydFBvaW50ID0gZ2V0QmxvY2tTdGFydFBvaW50KHtcbiAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICBibG9jazogbmV4dEJsb2NrXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZvY3VzVGV4dEJsb2NrLFxuICAgICAgbmV4dEJsb2NrU3RhcnRQb2ludFxuICAgIH07XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIGZvY3VzVGV4dEJsb2NrLFxuICAgIG5leHRCbG9ja1N0YXJ0UG9pbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcImRlbGV0ZS5ibG9ja1wiLFxuICAgIGF0OiBmb2N1c1RleHRCbG9jay5wYXRoXG4gIH0pLCByYWlzZSh7XG4gICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICBhdDoge1xuICAgICAgYW5jaG9yOiBuZXh0QmxvY2tTdGFydFBvaW50LFxuICAgICAgZm9jdXM6IG5leHRCbG9ja1N0YXJ0UG9pbnRcbiAgICB9XG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgaWYgKGV2ZW50LmRpcmVjdGlvbiAhPT0gXCJmb3J3YXJkXCIpXG4gICAgICByZXR1cm4gITE7XG4gICAgY29uc3QgbmV4dEJsb2NrID0gZ2V0TmV4dEJsb2NrKHNuYXBzaG90KSwgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCk7XG4gICAgcmV0dXJuICFuZXh0QmxvY2sgfHwgIWZvY3VzVGV4dEJsb2NrIHx8ICFpc0F0VGhlRW5kT2ZCbG9jayhmb2N1c1RleHRCbG9jaykoc25hcHNob3QpIHx8ICFpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBuZXh0QmxvY2subm9kZSkgPyAhMSA6IHtcbiAgICAgIG5leHRCbG9ja1xuICAgIH07XG4gIH0sXG4gIGFjdGlvbnM6IFsoXywge1xuICAgIG5leHRCbG9ja1xuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiZGVsZXRlLmJsb2NrXCIsXG4gICAgYXQ6IG5leHRCbG9jay5wYXRoXG4gIH0pLCByYWlzZSh7XG4gICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBibG9jazogbmV4dEJsb2NrLm5vZGUsXG4gICAgcGxhY2VtZW50OiBcImF1dG9cIixcbiAgICBzZWxlY3Q6IFwibm9uZVwiXG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZS5ibG9ja1wiLFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgYXQ6IHtcbiAgICAgIGFuY2hvcjoge1xuICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgb2Zmc2V0OiAwXG4gICAgICB9LFxuICAgICAgZm9jdXM6IHtcbiAgICAgICAgcGF0aDogZXZlbnQuYXQsXG4gICAgICAgIG9mZnNldDogMFxuICAgICAgfVxuICAgIH0sXG4gICAgdW5pdDogXCJibG9ja1wiXG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZS5jaGlsZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgY29uc3QgZm9jdXNDaGlsZCA9IGdldEZvY3VzQ2hpbGQkMSh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiB7XG4gICAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgIHBhdGg6IGV2ZW50LmF0LFxuICAgICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvY3VzQ2hpbGQgPyBpc1NwYW4oc25hcHNob3QuY29udGV4dCwgZm9jdXNDaGlsZC5ub2RlKSA/IHtcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHtcbiAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfSxcbiAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICBvZmZzZXQ6IGZvY3VzQ2hpbGQubm9kZS50ZXh0Lmxlbmd0aFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSA6IHtcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHtcbiAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfSxcbiAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyhfLCB7XG4gICAgc2VsZWN0aW9uXG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJkZWxldGVcIixcbiAgICBhdDogc2VsZWN0aW9uXG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImRlbGV0ZS50ZXh0XCIsXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgLi4uZXZlbnQsXG4gICAgdHlwZTogXCJkZWxldGVcIlxuICB9KV1dXG59KV0sIG1pbWVUeXBlUHJpb3JpdHkgPSBbXCJhcHBsaWNhdGlvbi94LXBvcnRhYmxlLXRleHRcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIsIFwidGV4dC9tYXJrZG93blwiLCBcInRleHQvaHRtbFwiLCBcInRleHQvcGxhaW5cIl07XG5mdW5jdGlvbiBnZXRGaXJzdEF2YWlsYWJsZURhdGEoe1xuICBkYXRhVHJhbnNmZXIsXG4gIHN0YXJ0QWZ0ZXJcbn0pIHtcbiAgY29uc3Qgc3RhcnRJbmRleCA9IHN0YXJ0QWZ0ZXIgPyBtaW1lVHlwZVByaW9yaXR5LmluZGV4T2Yoc3RhcnRBZnRlcikgKyAxIDogMDtcbiAgZm9yIChsZXQgaW5kZXggPSBzdGFydEluZGV4OyBpbmRleCA8IG1pbWVUeXBlUHJpb3JpdHkubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3QgbWltZVR5cGUgPSBtaW1lVHlwZVByaW9yaXR5LmF0KGluZGV4KTtcbiAgICBpZiAoIW1pbWVUeXBlKVxuICAgICAgY29udGludWU7XG4gICAgY29uc3QgZGF0YSA9IGRhdGFUcmFuc2Zlci5nZXREYXRhKG1pbWVUeXBlKTtcbiAgICBpZiAoZGF0YSlcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1pbWVUeXBlLFxuICAgICAgICBkYXRhXG4gICAgICB9O1xuICB9XG59XG5jb25zdCBhYnN0cmFjdERlc2VyaWFsaXplQmVoYXZpb3JzID0gW1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiZGVzZXJpYWxpemVcIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgYXZhaWxhYmxlRGF0YSA9IGdldEZpcnN0QXZhaWxhYmxlRGF0YSh7XG4gICAgICAgIGRhdGFUcmFuc2ZlcjogZXZlbnQub3JpZ2luRXZlbnQub3JpZ2luRXZlbnQuZGF0YVRyYW5zZmVyXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhdmFpbGFibGVEYXRhID8ge1xuICAgICAgICB0eXBlOiBcImRlc2VyaWFsaXplLmRhdGFcIixcbiAgICAgICAgbWltZVR5cGU6IGF2YWlsYWJsZURhdGEubWltZVR5cGUsXG4gICAgICAgIGRhdGE6IGF2YWlsYWJsZURhdGEuZGF0YSxcbiAgICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgICB9IDogITE7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKF8sIGRlc2VyaWFsaXplRXZlbnQpID0+IFtyYWlzZShkZXNlcmlhbGl6ZUV2ZW50KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiZGVzZXJpYWxpemVcIixcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVzZXJpYWxpemF0aW9uLmZhaWx1cmVcIixcbiAgICAgIG1pbWVUeXBlOiBcIiovKlwiLFxuICAgICAgcmVhc29uOiBcIk5vIEJlaGF2aW9yIHdhcyBhYmxlIHRvIGhhbmRsZSB0aGUgaW5jb21pbmcgZGF0YVwiLFxuICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgfSldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImRlc2VyaWFsaXplLmRhdGFcIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50Lm1pbWVUeXBlICE9PSBcInRleHQvaHRtbFwiKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBwbGFpblRleHQgPSBldmVudC5vcmlnaW5FdmVudC5vcmlnaW5FdmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcInRleHQvcGxhaW5cIik7XG4gICAgICByZXR1cm4gZXZlbnQuZGF0YSAhPT0gcGxhaW5UZXh0ID8gITEgOiB7XG4gICAgICAgIHR5cGU6IFwiZGVzZXJpYWxpemUuZGF0YVwiLFxuICAgICAgICBtaW1lVHlwZTogXCJ0ZXh0L3BsYWluXCIsXG4gICAgICAgIGRhdGE6IHBsYWluVGV4dCxcbiAgICAgICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gICAgICB9O1xuICAgIH0sXG4gICAgYWN0aW9uczogWyhfLCBkZXNlcmlhbGl6ZURhdGFFdmVudCkgPT4gW3JhaXNlKGRlc2VyaWFsaXplRGF0YUV2ZW50KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiZGVzZXJpYWxpemUuZGF0YVwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IGNvbnZlcnRlciA9IHNuYXBzaG90LmNvbnRleHQuY29udmVydGVycy5maW5kKChjb252ZXJ0ZXIyKSA9PiBjb252ZXJ0ZXIyLm1pbWVUeXBlID09PSBldmVudC5taW1lVHlwZSk7XG4gICAgICByZXR1cm4gY29udmVydGVyID8gY29udmVydGVyLmRlc2VyaWFsaXplKHtcbiAgICAgICAgc25hcHNob3QsXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJkZXNlcmlhbGl6ZVwiLFxuICAgICAgICAgIGRhdGE6IGV2ZW50LmRhdGFcbiAgICAgICAgfVxuICAgICAgfSkgOiAhMTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCBkZXNlcmlhbGl6ZUV2ZW50KSA9PiBbcmFpc2Uoe1xuICAgICAgLi4uZGVzZXJpYWxpemVFdmVudCxcbiAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICAgIH0pXV1cbiAgfSksXG4gIC8qKlxuICAgKiBJZiB3ZSBhcmUgcGFzdGluZyB0ZXh0L3BsYWluIGludG8gYSB0ZXh0IGJsb2NrIHRoZW4gd2UgY2FuIHByb2JhYmx5XG4gICAqIGFzc3VtZSB0aGF0IHRoZSBpbnRlbmRlZCBiZWhhdmlvciBpcyB0aGF0IHRoZSBwYXN0ZWQgdGV4dCBpbmhlcml0c1xuICAgKiBmb3JtYXR0aW5nIGZyb20gdGhlIHRleHQgaXQncyBwYXN0ZWQgaW50by5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJkZXNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCkgJiYgZXZlbnQubWltZVR5cGUgPT09IFwidGV4dC9wbGFpblwiICYmIGV2ZW50Lm9yaWdpbkV2ZW50LnR5cGUgIT09IFwiZHJhZy5kcm9wXCIpIHtcbiAgICAgICAgY29uc3QgYWN0aXZlRGVjb3JhdG9ycyA9IGdldEFjdGl2ZURlY29yYXRvcnMoc25hcHNob3QpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFjdGl2ZUFubm90YXRpb25zOiBnZXRBY3RpdmVBbm5vdGF0aW9ucyhzbmFwc2hvdCksXG4gICAgICAgICAgYWN0aXZlRGVjb3JhdG9ycyxcbiAgICAgICAgICB0ZXh0UnVuczogZXZlbnQuZGF0YS5mbGF0TWFwKChibG9jaykgPT4gaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2spID8gW2dldFRleHRCbG9ja1RleHQoYmxvY2spXSA6IFtdKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogWyhfLCB7XG4gICAgICBhY3RpdmVBbm5vdGF0aW9ucyxcbiAgICAgIGFjdGl2ZURlY29yYXRvcnMsXG4gICAgICB0ZXh0UnVuc1xuICAgIH0pID0+IHRleHRSdW5zLmZsYXRNYXAoKHRleHRSdW4sIGluZGV4KSA9PiBpbmRleCAhPT0gdGV4dFJ1bnMubGVuZ3RoIC0gMSA/IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5zcGFuXCIsXG4gICAgICB0ZXh0OiB0ZXh0UnVuLFxuICAgICAgZGVjb3JhdG9yczogYWN0aXZlRGVjb3JhdG9ycyxcbiAgICAgIGFubm90YXRpb25zOiBhY3RpdmVBbm5vdGF0aW9ucy5tYXAoKHtcbiAgICAgICAgX2tleSxcbiAgICAgICAgX3R5cGUsXG4gICAgICAgIC4uLnZhbHVlXG4gICAgICB9KSA9PiAoe1xuICAgICAgICBuYW1lOiBfdHlwZSxcbiAgICAgICAgdmFsdWVcbiAgICAgIH0pKVxuICAgIH0pLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5icmVha1wiXG4gICAgfSldIDogW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LnNwYW5cIixcbiAgICAgIHRleHQ6IHRleHRSdW4sXG4gICAgICBkZWNvcmF0b3JzOiBhY3RpdmVEZWNvcmF0b3JzLFxuICAgICAgYW5ub3RhdGlvbnM6IGFjdGl2ZUFubm90YXRpb25zLm1hcCgoe1xuICAgICAgICBfa2V5LFxuICAgICAgICBfdHlwZSxcbiAgICAgICAgLi4udmFsdWVcbiAgICAgIH0pID0+ICh7XG4gICAgICAgIG5hbWU6IF90eXBlLFxuICAgICAgICB2YWx1ZVxuICAgICAgfSkpXG4gICAgfSldKV1cbiAgfSksXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJkZXNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tzXCIsXG4gICAgICBibG9ja3M6IGV2ZW50LmRhdGEsXG4gICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiXG4gICAgfSldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImRlc2VyaWFsaXphdGlvbi5mYWlsdXJlXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChldmVudC5taW1lVHlwZSA9PT0gXCIqLypcIilcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgYXZhaWxhYmxlRGF0YSA9IGdldEZpcnN0QXZhaWxhYmxlRGF0YSh7XG4gICAgICAgIGRhdGFUcmFuc2ZlcjogZXZlbnQub3JpZ2luRXZlbnQub3JpZ2luRXZlbnQuZGF0YVRyYW5zZmVyLFxuICAgICAgICBzdGFydEFmdGVyOiBldmVudC5taW1lVHlwZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYXZhaWxhYmxlRGF0YSA/IHtcbiAgICAgICAgdHlwZTogXCJkZXNlcmlhbGl6ZS5kYXRhXCIsXG4gICAgICAgIG1pbWVUeXBlOiBhdmFpbGFibGVEYXRhLm1pbWVUeXBlLFxuICAgICAgICBkYXRhOiBhdmFpbGFibGVEYXRhLmRhdGEsXG4gICAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICAgICAgfSA6ICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogWyhfLCBkZXNlcmlhbGl6ZURhdGFFdmVudCkgPT4gW3JhaXNlKGRlc2VyaWFsaXplRGF0YUV2ZW50KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiZGVzZXJpYWxpemF0aW9uLmZhaWx1cmVcIixcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gW3tcbiAgICAgIHR5cGU6IFwiZWZmZWN0XCIsXG4gICAgICBlZmZlY3Q6ICgpID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKGBEZXNlcmlhbGl6YXRpb24gb2YgJHtldmVudC5taW1lVHlwZX0gZmFpbGVkIHdpdGggcmVhc29uIFwiJHtldmVudC5yZWFzb259XCJgKTtcbiAgICAgIH1cbiAgICB9XV1cbiAgfSlcbl0sIGFic3RyYWN0SW5wdXRCZWhhdmlvcnMgPSBbXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnB1dC4qXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0pID0+IGlzU2VsZWN0aW9uRXhwYW5kZWQoc25hcHNob3QpLFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGVcIlxuICAgIH0pLCBmb3J3YXJkKGV2ZW50KV1dXG4gIH0pLFxuICAvKipcbiAgICogSGFuZGxlIGlucHV0IGV2ZW50cyB3aGVyZSBIVE1MIGVxdWFscyBwbGFpbiB0ZXh0IChlLmcuLCBTYWZhcmkgYXV0b2NvcnJlY3QpLlxuICAgKiBJbiB0aGlzIGNhc2UsIHdlIHVzZSBpbnNlcnQudGV4dCB0byBwcmVzZXJ2ZSBleGlzdGluZyBtYXJrcy5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnB1dC4qXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSBldmVudC5vcmlnaW5FdmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcInRleHQvcGxhaW5cIiksIGh0bWwgPSBldmVudC5vcmlnaW5FdmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcInRleHQvaHRtbFwiKSwgdHlwZXMgPSBldmVudC5vcmlnaW5FdmVudC5kYXRhVHJhbnNmZXIudHlwZXM7XG4gICAgICByZXR1cm4gIXRleHQgfHwgdGV4dC5pbmNsdWRlcyhgXG5gKSA/ICExIDogdHlwZXMubGVuZ3RoID09PSAxID8ge1xuICAgICAgICB0ZXh0XG4gICAgICB9IDogdHlwZXMubGVuZ3RoID4gMiA/ICExIDogaHRtbCAmJiB0ZXh0ID09PSBodG1sID8ge1xuICAgICAgICB0ZXh0XG4gICAgICB9IDogITE7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKF8sIHtcbiAgICAgIHRleHRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQudGV4dFwiLFxuICAgICAgdGV4dFxuICAgIH0pXV1cbiAgfSksXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnB1dC4qXCIsXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlc2VyaWFsaXplXCIsXG4gICAgICBvcmlnaW5FdmVudDogZXZlbnRcbiAgICB9KV1dXG4gIH0pXG5dLCBhYnN0cmFjdEluc2VydEJlaGF2aW9ycyA9IFtcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC5ibG9ja3NcIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3Qgb25seUJsb2NrID0gZXZlbnQuYmxvY2tzLmxlbmd0aCA9PT0gMSA/IGV2ZW50LmJsb2Nrcy5hdCgwKSA6IHZvaWQgMDtcbiAgICAgIHJldHVybiBvbmx5QmxvY2sgPyB7XG4gICAgICAgIG9ubHlCbG9ja1xuICAgICAgfSA6ICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0sIHtcbiAgICAgIG9ubHlCbG9ja1xuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgICAgYmxvY2s6IG9ubHlCbG9jayxcbiAgICAgIHBsYWNlbWVudDogZXZlbnQucGxhY2VtZW50LFxuICAgICAgc2VsZWN0OiBldmVudC5zZWxlY3QgPz8gXCJlbmRcIlxuICAgIH0pXV1cbiAgfSksXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnNlcnQuYmxvY2tzXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnBsYWNlbWVudCAhPT0gXCJiZWZvcmVcIilcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgZmlyc3RCbG9ja0tleSA9IGV2ZW50LmJsb2Nrcy5hdCgwKT8uX2tleSA/PyBzbmFwc2hvdC5jb250ZXh0LmtleUdlbmVyYXRvcigpLCBsYXN0QmxvY2tLZXkgPSBldmVudC5ibG9ja3MuYXQoLTEpPy5fa2V5ID8/IHNuYXBzaG90LmNvbnRleHQua2V5R2VuZXJhdG9yKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmaXJzdEJsb2NrS2V5LFxuICAgICAgICBsYXN0QmxvY2tLZXlcbiAgICAgIH07XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBmaXJzdEJsb2NrS2V5LFxuICAgICAgbGFzdEJsb2NrS2V5XG4gICAgfSkgPT4gWy4uLmV2ZW50LmJsb2Nrcy5tYXAoKGJsb2NrLCBpbmRleCkgPT4gcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrLFxuICAgICAgcGxhY2VtZW50OiBpbmRleCA9PT0gMCA/IFwiYmVmb3JlXCIgOiBcImFmdGVyXCIsXG4gICAgICBzZWxlY3Q6IGluZGV4ICE9PSBldmVudC5ibG9ja3MubGVuZ3RoIC0gMSA/IFwiZW5kXCIgOiBcIm5vbmVcIlxuICAgIH0pKSwgLi4uZXZlbnQuc2VsZWN0ID09PSBcIm5vbmVcIiA/IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgYXQ6IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uXG4gICAgfSldIDogZXZlbnQuc2VsZWN0ID09PSBcInN0YXJ0XCIgPyBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3QuYmxvY2tcIixcbiAgICAgIGF0OiBbe1xuICAgICAgICBfa2V5OiBmaXJzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJzdGFydFwiXG4gICAgfSldIDogW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwic2VsZWN0LmJsb2NrXCIsXG4gICAgICBhdDogW3tcbiAgICAgICAgX2tleTogbGFzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJlbmRcIlxuICAgIH0pXV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJsb2Nrc1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChldmVudC5wbGFjZW1lbnQgIT09IFwiYWZ0ZXJcIilcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgZmlyc3RCbG9ja0tleSA9IGV2ZW50LmJsb2Nrcy5hdCgwKT8uX2tleSA/PyBzbmFwc2hvdC5jb250ZXh0LmtleUdlbmVyYXRvcigpLCBsYXN0QmxvY2tLZXkgPSBldmVudC5ibG9ja3MuYXQoLTEpPy5fa2V5ID8/IHNuYXBzaG90LmNvbnRleHQua2V5R2VuZXJhdG9yKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmaXJzdEJsb2NrS2V5LFxuICAgICAgICBsYXN0QmxvY2tLZXlcbiAgICAgIH07XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBmaXJzdEJsb2NrS2V5LFxuICAgICAgbGFzdEJsb2NrS2V5XG4gICAgfSkgPT4gWy4uLmV2ZW50LmJsb2Nrcy5tYXAoKGJsb2NrLCBpbmRleCkgPT4gcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrLFxuICAgICAgcGxhY2VtZW50OiBcImFmdGVyXCIsXG4gICAgICBzZWxlY3Q6IGluZGV4ICE9PSBldmVudC5ibG9ja3MubGVuZ3RoIC0gMSA/IFwiZW5kXCIgOiBcIm5vbmVcIlxuICAgIH0pKSwgLi4uZXZlbnQuc2VsZWN0ID09PSBcIm5vbmVcIiA/IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgYXQ6IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uXG4gICAgfSldIDogZXZlbnQuc2VsZWN0ID09PSBcInN0YXJ0XCIgPyBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3QuYmxvY2tcIixcbiAgICAgIGF0OiBbe1xuICAgICAgICBfa2V5OiBmaXJzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJzdGFydFwiXG4gICAgfSldIDogW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwic2VsZWN0LmJsb2NrXCIsXG4gICAgICBhdDogW3tcbiAgICAgICAgX2tleTogbGFzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJlbmRcIlxuICAgIH0pXV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJsb2Nrc1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChldmVudC5wbGFjZW1lbnQgIT09IFwiYXV0b1wiKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICAgIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIWlzRW1wdHlUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgZm9jdXNUZXh0QmxvY2subm9kZSkpXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IGZpcnN0QmxvY2tLZXkgPSBldmVudC5ibG9ja3MuYXQoMCk/Ll9rZXkgPz8gc25hcHNob3QuY29udGV4dC5rZXlHZW5lcmF0b3IoKSwgbGFzdEJsb2NrS2V5ID0gZXZlbnQuYmxvY2tzLmF0KC0xKT8uX2tleSA/PyBzbmFwc2hvdC5jb250ZXh0LmtleUdlbmVyYXRvcigpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9jdXNUZXh0QmxvY2ssXG4gICAgICAgIGZpcnN0QmxvY2tLZXksXG4gICAgICAgIGxhc3RCbG9ja0tleVxuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBmaXJzdEJsb2NrS2V5LFxuICAgICAgbGFzdEJsb2NrS2V5XG4gICAgfSkgPT4gWy4uLmV2ZW50LmJsb2Nrcy5tYXAoKGJsb2NrLCBpbmRleCkgPT4gcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrLFxuICAgICAgcGxhY2VtZW50OiBpbmRleCA9PT0gMCA/IFwiYXV0b1wiIDogXCJhZnRlclwiLFxuICAgICAgc2VsZWN0OiBpbmRleCAhPT0gZXZlbnQuYmxvY2tzLmxlbmd0aCAtIDEgPyBcImVuZFwiIDogXCJub25lXCJcbiAgICB9KSksIC4uLmV2ZW50LnNlbGVjdCA9PT0gXCJub25lXCIgfHwgZXZlbnQuc2VsZWN0ID09PSBcInN0YXJ0XCIgPyBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3QuYmxvY2tcIixcbiAgICAgIGF0OiBbe1xuICAgICAgICBfa2V5OiBmaXJzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJzdGFydFwiXG4gICAgfSldIDogW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwic2VsZWN0LmJsb2NrXCIsXG4gICAgICBhdDogW3tcbiAgICAgICAgX2tleTogbGFzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJlbmRcIlxuICAgIH0pXV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJsb2Nrc1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChldmVudC5wbGFjZW1lbnQgIT09IFwiYXV0b1wiKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICAgIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBmb2N1c0Jsb2NrU3RhcnRQb2ludCA9IGdldEJsb2NrU3RhcnRQb2ludCh7XG4gICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIGJsb2NrOiBmb2N1c1RleHRCbG9ja1xuICAgICAgfSksIGZvY3VzQmxvY2tFbmRQb2ludCA9IGdldEJsb2NrRW5kUG9pbnQoe1xuICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICBibG9jazogZm9jdXNUZXh0QmxvY2tcbiAgICAgIH0pLCBmb2N1c1RleHRCbG9ja0FmdGVyID0gc2xpY2VUZXh0QmxvY2soe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgICAgIGFuY2hvcjogc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMsXG4gICAgICAgICAgICBmb2N1czogZm9jdXNCbG9ja0VuZFBvaW50XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBibG9jazogZm9jdXNUZXh0QmxvY2subm9kZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmaXJzdEJsb2NrS2V5OiBldmVudC5ibG9ja3MuYXQoMCk/Ll9rZXkgPz8gc25hcHNob3QuY29udGV4dC5rZXlHZW5lcmF0b3IoKSxcbiAgICAgICAgZm9jdXNCbG9ja1N0YXJ0UG9pbnQsXG4gICAgICAgIGZvY3VzQmxvY2tFbmRQb2ludCxcbiAgICAgICAgZm9jdXNUZXh0QmxvY2tBZnRlcixcbiAgICAgICAgc2VsZWN0aW9uOiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvblxuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBmb2N1c0Jsb2NrRW5kUG9pbnQsXG4gICAgICBmb2N1c1RleHRCbG9ja0FmdGVyLFxuICAgICAgc2VsZWN0aW9uLFxuICAgICAgZmlyc3RCbG9ja0tleSxcbiAgICAgIGZvY3VzQmxvY2tTdGFydFBvaW50XG4gICAgfSkgPT4gWy4uLmV2ZW50LmJsb2Nrcy5mbGF0TWFwKChibG9jaywgaW5kZXgpID0+IGluZGV4ID09PSAwID8gWy4uLmlzRXF1YWxTZWxlY3Rpb25Qb2ludHMoc2VsZWN0aW9uLmZvY3VzLCBmb2N1c0Jsb2NrRW5kUG9pbnQpID8gW10gOiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgIGF0OiB7XG4gICAgICAgIGFuY2hvcjogc2VsZWN0aW9uLmZvY3VzLFxuICAgICAgICBmb2N1czogZm9jdXNCbG9ja0VuZFBvaW50XG4gICAgICB9XG4gICAgfSldLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgICAgYmxvY2ssXG4gICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiLFxuICAgICAgc2VsZWN0OiBcImVuZFwiXG4gICAgfSldIDogaW5kZXggPT09IGV2ZW50LmJsb2Nrcy5sZW5ndGggLSAxID8gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICBibG9jayxcbiAgICAgIHBsYWNlbWVudDogXCJhZnRlclwiLFxuICAgICAgc2VsZWN0OiBcImVuZFwiXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICBibG9jazogZm9jdXNUZXh0QmxvY2tBZnRlcixcbiAgICAgIHBsYWNlbWVudDogXCJhdXRvXCIsXG4gICAgICBzZWxlY3Q6IGV2ZW50LnNlbGVjdCA9PT0gXCJlbmRcIiA/IFwibm9uZVwiIDogXCJlbmRcIlxuICAgIH0pXSA6IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgICAgYmxvY2ssXG4gICAgICBwbGFjZW1lbnQ6IFwiYWZ0ZXJcIixcbiAgICAgIHNlbGVjdDogXCJlbmRcIlxuICAgIH0pXSksIC4uLmV2ZW50LnNlbGVjdCA9PT0gXCJub25lXCIgPyBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGF0OiBzZWxlY3Rpb25cbiAgICB9KV0gOiBldmVudC5zZWxlY3QgPT09IFwic3RhcnRcIiA/IFtpc0VxdWFsU2VsZWN0aW9uUG9pbnRzKHNlbGVjdGlvbi5mb2N1cywgZm9jdXNCbG9ja1N0YXJ0UG9pbnQpID8gcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3QuYmxvY2tcIixcbiAgICAgIGF0OiBbe1xuICAgICAgICBfa2V5OiBmaXJzdEJsb2NrS2V5XG4gICAgICB9XSxcbiAgICAgIHNlbGVjdDogXCJzdGFydFwiXG4gICAgfSkgOiByYWlzZSh7XG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgYXQ6IHtcbiAgICAgICAgYW5jaG9yOiBzZWxlY3Rpb24uZm9jdXMsXG4gICAgICAgIGZvY3VzOiBzZWxlY3Rpb24uZm9jdXNcbiAgICAgIH1cbiAgICB9KV0gOiBbXV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJsb2Nrc1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBldmVudC5wbGFjZW1lbnQgPT09IFwiYXV0b1wiLFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBldmVudC5ibG9ja3MubWFwKChibG9jaywgaW5kZXgpID0+IHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICBibG9jayxcbiAgICAgIHBsYWNlbWVudDogaW5kZXggPT09IDAgPyBcImF1dG9cIiA6IFwiYWZ0ZXJcIixcbiAgICAgIHNlbGVjdDogZXZlbnQuc2VsZWN0ID8/IFwiZW5kXCJcbiAgICB9KSldXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJyZWFrXCIsXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcInNwbGl0XCJcbiAgICB9KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmNoaWxkXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IGxhc3RCbG9jayA9IGdldExhc3RCbG9jayQxKHNuYXBzaG90KTtcbiAgICAgIHJldHVybiAhbGFzdEJsb2NrIHx8IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uID8gITEgOiB7XG4gICAgICAgIGxhc3RCbG9ja0VuZFBvaW50OiBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICAgIGJsb2NrOiBsYXN0QmxvY2tcbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIGV2ZW50XG4gICAgfSwge1xuICAgICAgbGFzdEJsb2NrRW5kUG9pbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGF0OiB7XG4gICAgICAgIGFuY2hvcjogbGFzdEJsb2NrRW5kUG9pbnQsXG4gICAgICAgIGZvY3VzOiBsYXN0QmxvY2tFbmRQb2ludFxuICAgICAgfVxuICAgIH0pLCByYWlzZShldmVudCldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC5jaGlsZFwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3RcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICAgIHJldHVybiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiAmJiAhZm9jdXNUZXh0QmxvY2s7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrOiB7XG4gICAgICAgIF90eXBlOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lLFxuICAgICAgICBjaGlsZHJlbjogW3tcbiAgICAgICAgICBfdHlwZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgICAgIHRleHQ6IFwiXCIsXG4gICAgICAgICAgbWFya3M6IFtdXG4gICAgICAgIH1dXG4gICAgICB9LFxuICAgICAgcGxhY2VtZW50OiBcImF1dG9cIixcbiAgICAgIHNlbGVjdDogXCJlbmRcIlxuICAgIH0pLCByYWlzZShldmVudCldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC5pbmxpbmUgb2JqZWN0XCIsXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5jaGlsZFwiLFxuICAgICAgY2hpbGQ6IHtcbiAgICAgICAgX3R5cGU6IGV2ZW50LmlubGluZU9iamVjdC5uYW1lLFxuICAgICAgICAuLi5ldmVudC5pbmxpbmVPYmplY3QudmFsdWVcbiAgICAgIH1cbiAgICB9KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LnNvZnQgYnJlYWtcIixcbiAgICBhY3Rpb25zOiBbKCkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LnRleHRcIixcbiAgICAgIHRleHQ6IGBcbmBcbiAgICB9KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LnNwYW5cIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90XG4gICAgfSkgPT4gIWdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrOiB7XG4gICAgICAgIF90eXBlOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lLFxuICAgICAgICBjaGlsZHJlbjogW3tcbiAgICAgICAgICBfdHlwZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgICAgIHRleHQ6IFwiXCIsXG4gICAgICAgICAgbWFya3M6IFtdXG4gICAgICAgIH1dXG4gICAgICB9LFxuICAgICAgcGxhY2VtZW50OiBcImF1dG9cIixcbiAgICAgIHNlbGVjdDogXCJlbmRcIlxuICAgIH0pLCByYWlzZShldmVudCldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC5zcGFuXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXJrRGVmczogZXZlbnQuYW5ub3RhdGlvbnM/Lm1hcCgoYW5ub3RhdGlvbikgPT4gKHtcbiAgICAgICAgICBfdHlwZTogYW5ub3RhdGlvbi5uYW1lLFxuICAgICAgICAgIF9rZXk6IHNuYXBzaG90LmNvbnRleHQua2V5R2VuZXJhdG9yKCksXG4gICAgICAgICAgLi4uYW5ub3RhdGlvbi52YWx1ZVxuICAgICAgICB9KSkgPz8gW10sXG4gICAgICAgIGZvY3VzVGV4dEJsb2NrXG4gICAgICB9O1xuICAgIH0sXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSwge1xuICAgICAgbWFya0RlZnMsXG4gICAgICBmb2N1c1RleHRCbG9ja1xuICAgIH0pID0+IFsuLi5mb2N1c1RleHRCbG9jayA/IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImJsb2NrLnNldFwiLFxuICAgICAgYXQ6IGZvY3VzVGV4dEJsb2NrLnBhdGgsXG4gICAgICBwcm9wczoge1xuICAgICAgICBtYXJrRGVmczogWy4uLmZvY3VzVGV4dEJsb2NrLm5vZGUubWFya0RlZnMgPz8gW10sIC4uLm1hcmtEZWZzXVxuICAgICAgfVxuICAgIH0pXSA6IFtdLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5jaGlsZFwiLFxuICAgICAgY2hpbGQ6IHtcbiAgICAgICAgX3R5cGU6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLnNwYW4ubmFtZSxcbiAgICAgICAgdGV4dDogZXZlbnQudGV4dCxcbiAgICAgICAgbWFya3M6IFsuLi5ldmVudC5kZWNvcmF0b3JzID8/IFtdLCAuLi5tYXJrRGVmcy5tYXAoKG1hcmtEZWYpID0+IG1hcmtEZWYuX2tleSldXG4gICAgICB9XG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIElmIHRoZXJlJ3MgYW4gZXhwYW5kZWQgc2VsZWN0aW9uLCB0aGVuIHdlIGRlbGV0ZSB0aGUgc2VsZWN0aW9uIGJlZm9yZSB3ZVxuICAgKiBpbnNlcnQgdGhlIHRleHQuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LnRleHRcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90XG4gICAgfSkgPT4gaXNTZWxlY3Rpb25FeHBhbmRlZChzbmFwc2hvdCksXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZVwiXG4gICAgfSksIHJhaXNlKGV2ZW50KV1dXG4gIH0pLFxuICAvKipcbiAgICogSWYgdGhlcmUncyBubyBzZWxlY3Rpb24sIHRoZW4gd2Ugc2VsZWN0IHRoZSBlbmQgb2YgdGhlIGVkaXRvciBiZWZvcmUgd2VcbiAgICogd2UgaW5zZXJ0IHRoZSB0ZXh0LlxuICAgKi9cbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC50ZXh0XCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgbGFzdEJsb2sgPSBnZXRMYXN0QmxvY2skMShzbmFwc2hvdCk7XG4gICAgICByZXR1cm4gbGFzdEJsb2sgPyB7XG4gICAgICAgIGVuZFBvaW50OiBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICAgIGJsb2NrOiBsYXN0Qmxva1xuICAgICAgICB9KVxuICAgICAgfSA6ICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0sIHtcbiAgICAgIGVuZFBvaW50XG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBhdDoge1xuICAgICAgICBhbmNob3I6IGVuZFBvaW50LFxuICAgICAgICBmb2N1czogZW5kUG9pbnRcbiAgICAgIH1cbiAgICB9KSwgcmFpc2UoZXZlbnQpXV1cbiAgfSlcbl0sIHNoaWZ0TGVmdCA9IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICBkZWZhdWx0OiBbe1xuICAgIGtleTogXCJBcnJvd0xlZnRcIixcbiAgICBzaGlmdDogITAsXG4gICAgbWV0YTogITEsXG4gICAgY3RybDogITEsXG4gICAgYWx0OiAhMVxuICB9XVxufSksIGFic3RyYWN0S2V5Ym9hcmRCZWhhdmlvcnMgPSBbXG4gIC8qKlxuICAgKiBXaGVuIEJhY2tzcGFjZSBpcyBwcmVzc2VkIG9uIGFuIGlubGluZSBvYmplY3QsIFNsYXRlIHdpbGwgcmFpc2UgYVxuICAgKiBgZGVsZXRlLmJhY2t3YXJkYCBldmVudCB3aXRoIGB1bml0OiAnYmxvY2snYC4gVGhpcyBpcyB3cm9uZyBhbmQgdGhpc1xuICAgKiBCZWhhdmlvciBhZGp1c3RzIHRoYXQuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IGRlZmF1bHRLZXlib2FyZFNob3J0Y3V0cy5iYWNrc3BhY2UuZ3VhcmQoZXZlbnQub3JpZ2luRXZlbnQpICYmIGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpICYmIGdldEZvY3VzSW5saW5lT2JqZWN0KHNuYXBzaG90KSxcbiAgICBhY3Rpb25zOiBbKCkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVsZXRlLmJhY2t3YXJkXCIsXG4gICAgICB1bml0OiBcImNoYXJhY3RlclwiXG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIFdoZW4gRGVsZXRlIGlzIHByZXNzZWQgb24gYW4gaW5saW5lIG9iamVjdCwgU2xhdGUgd2lsbCByYWlzZSBhXG4gICAqIGBkZWxldGUuZm9yd2FyZGAgZXZlbnQgd2l0aCBgdW5pdDogJ2Jsb2NrJ2AuIFRoaXMgaXMgd3JvbmcgYW5kIHRoaXNcbiAgICogQmVoYXZpb3IgYWRqdXN0cyB0aGF0LlxuICAgKi9cbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImtleWJvYXJkLmtleWRvd25cIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiBkZWZhdWx0S2V5Ym9hcmRTaG9ydGN1dHMuZGVsZXRlLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSAmJiBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSAmJiBnZXRGb2N1c0lubGluZU9iamVjdChzbmFwc2hvdCksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZS5mb3J3YXJkXCIsXG4gICAgICB1bml0OiBcImNoYXJhY3RlclwiXG4gICAgfSldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImtleWJvYXJkLmtleWRvd25cIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmRlbGV0ZVdvcmQuYmFja3dhcmQuZ3VhcmQoZXZlbnQub3JpZ2luRXZlbnQpLFxuICAgIGFjdGlvbnM6IFsoKSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGUuYmFja3dhcmRcIixcbiAgICAgIHVuaXQ6IFwid29yZFwiXG4gICAgfSldXVxuICB9KSxcbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImtleWJvYXJkLmtleWRvd25cIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmRlbGV0ZVdvcmQuZm9yd2FyZC5ndWFyZChldmVudC5vcmlnaW5FdmVudCksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZS5mb3J3YXJkXCIsXG4gICAgICB1bml0OiBcIndvcmRcIlxuICAgIH0pXV1cbiAgfSksXG4gIC8qKlxuICAgKiBBbGxvdyByYWlzaW5nIGFuIGBpbnNlcnQuYnJlYWtgIGV2ZW50IHdoZW4gcHJlc3NpbmcgRW50ZXIgb24gYW4gaW5saW5lXG4gICAqIG9iamVjdC5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJrZXlib2FyZC5rZXlkb3duXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmJyZWFrLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSAmJiBpc1NlbGVjdGlvbkNvbGxhcHNlZCQxKHNuYXBzaG90KSAmJiBnZXRGb2N1c0lubGluZU9iamVjdChzbmFwc2hvdCksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5icmVha1wiXG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIE9uIEZpcmVmb3gsIEVudGVyIG1pZ2h0IGNvbGxhcHNlIHRoZSBzZWxlY3Rpb24uIFRvIG1pdGlnYXRlIHRoaXMsIHdlXG4gICAqIGByYWlzZWAgYW4gYGluc2VydC5icmVha2AgZXZlbnQgbWFudWFsbHkuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IGRlZmF1bHRLZXlib2FyZFNob3J0Y3V0cy5icmVhay5ndWFyZChldmVudC5vcmlnaW5FdmVudCkgJiYgaXNTZWxlY3Rpb25FeHBhbmRlZChzbmFwc2hvdCksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5icmVha1wiXG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIE9uIFdlYktpdCwgU2hpZnQrRW50ZXIgcmVzdWx0cyBpbiBhbiBgaW5zZXJ0UGFyYWdyYXBoYCBpbnB1dCBldmVudCByYXRoZXJcbiAgICogdGhhbiBhbiBgaW5zZXJ0TGluZUJyZWFrYCBpbnB1dCBldmVudC4gVGhpcyBCZWhhdmlvciBtYWtlcyBzdXJlIHdlIGNhdGNoXG4gICAqIHRoYXQgYGtleWJvYXJkLmtleWRvd25gIGV2ZW50IGJlZm9yZWhhbmQgYW5kIHJhaXNlIGFuIGBpbnNlcnQuc29mdCBicmVha2AgbWFudWFsbHkuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBkZWZhdWx0S2V5Ym9hcmRTaG9ydGN1dHMubGluZUJyZWFrLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSxcbiAgICBhY3Rpb25zOiBbKCkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LnNvZnQgYnJlYWtcIlxuICAgIH0pXV1cbiAgfSksXG4gIC8qKlxuICAgKiBNYW51YWwgaGFuZGxpbmcgb2YgdW5kbyBzaG9ydGN1dHMuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBkZWZhdWx0S2V5Ym9hcmRTaG9ydGN1dHMuaGlzdG9yeS51bmRvLmd1YXJkKGV2ZW50Lm9yaWdpbkV2ZW50KSxcbiAgICBhY3Rpb25zOiBbKCkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiaGlzdG9yeS51bmRvXCJcbiAgICB9KV1dXG4gIH0pLFxuICAvKipcbiAgICogTWFudWFsIGhhbmRsaW5nIG9mIHJlZG8gc2hvcnRjdXRzLlxuICAgKi9cbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImtleWJvYXJkLmtleWRvd25cIixcbiAgICBndWFyZDogKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZGVmYXVsdEtleWJvYXJkU2hvcnRjdXRzLmhpc3RvcnkucmVkby5ndWFyZChldmVudC5vcmlnaW5FdmVudCksXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImhpc3RvcnkucmVkb1wiXG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIEZpeCBlZGdlIGNhc2Ugd2hlcmUgU2hpZnQrQXJyb3dMZWZ0IGRpZG4ndCByZWR1Y2UgYSBzZWxlY3Rpb24gaGFuZ2luZ1xuICAgKiBvbnRvIGFuIGVtcHR5IHRleHQgYmxvY2suXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwia2V5Ym9hcmQua2V5ZG93blwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24gfHwgIXNoaWZ0TGVmdC5ndWFyZChldmVudC5vcmlnaW5FdmVudCkpXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IGZvY3VzQmxvY2sgPSBnZXRGb2N1c0Jsb2NrJDEoc25hcHNob3QpO1xuICAgICAgaWYgKCFmb2N1c0Jsb2NrKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBwcmV2aW91c0Jsb2NrID0gZ2V0UHJldmlvdXNCbG9jayh7XG4gICAgICAgIC4uLnNuYXBzaG90LFxuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgICAgICBwYXRoOiBmb2N1c0Jsb2NrLnBhdGgsXG4gICAgICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgICAgIHBhdGg6IGZvY3VzQmxvY2sucGF0aCxcbiAgICAgICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwcmV2aW91c0Jsb2NrICYmIGlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGZvY3VzQmxvY2subm9kZSkgJiYgc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uZm9jdXMub2Zmc2V0ID09PSAwICYmIGlzRW1wdHlUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgZm9jdXNCbG9jay5ub2RlKSA/IHtcbiAgICAgICAgcHJldmlvdXNCbG9jayxcbiAgICAgICAgc2VsZWN0aW9uOiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvblxuICAgICAgfSA6ICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0sIHtcbiAgICAgIHByZXZpb3VzQmxvY2ssXG4gICAgICBzZWxlY3Rpb25cbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGF0OiB7XG4gICAgICAgIGFuY2hvcjogc2VsZWN0aW9uLmFuY2hvcixcbiAgICAgICAgZm9jdXM6IGdldEJsb2NrRW5kUG9pbnQoe1xuICAgICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgYmxvY2s6IHByZXZpb3VzQmxvY2tcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KV1dXG4gIH0pXG5dLCBhYnN0cmFjdExpc3RJdGVtQmVoYXZpb3JzID0gW2RlZmluZUJlaGF2aW9yKHtcbiAgb246IFwibGlzdCBpdGVtLmFkZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5saXN0cy5zb21lKChsaXN0KSA9PiBsaXN0Lm5hbWUgPT09IGV2ZW50Lmxpc3RJdGVtKSA/IHtcbiAgICBzZWxlY3RlZFRleHRCbG9ja3M6IGdldFNlbGVjdGVkVGV4dEJsb2NrcyhzbmFwc2hvdClcbiAgfSA6ICExLFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9LCB7XG4gICAgc2VsZWN0ZWRUZXh0QmxvY2tzXG4gIH0pID0+IHNlbGVjdGVkVGV4dEJsb2Nrcy5tYXAoKGJsb2NrKSA9PiByYWlzZSh7XG4gICAgdHlwZTogXCJibG9jay5zZXRcIixcbiAgICBhdDogYmxvY2sucGF0aCxcbiAgICBwcm9wczoge1xuICAgICAgbGV2ZWw6IGJsb2NrLm5vZGUubGV2ZWwgPz8gMSxcbiAgICAgIGxpc3RJdGVtOiBldmVudC5saXN0SXRlbVxuICAgIH1cbiAgfSkpXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwibGlzdCBpdGVtLnJlbW92ZVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiAoe1xuICAgIHNlbGVjdGVkVGV4dEJsb2NrczogZ2V0U2VsZWN0ZWRUZXh0QmxvY2tzKHNuYXBzaG90KVxuICB9KSxcbiAgYWN0aW9uczogWyhfLCB7XG4gICAgc2VsZWN0ZWRUZXh0QmxvY2tzXG4gIH0pID0+IHNlbGVjdGVkVGV4dEJsb2Nrcy5tYXAoKGJsb2NrKSA9PiByYWlzZSh7XG4gICAgdHlwZTogXCJibG9jay51bnNldFwiLFxuICAgIGF0OiBibG9jay5wYXRoLFxuICAgIHByb3BzOiBbXCJsZXZlbFwiLCBcImxpc3RJdGVtXCJdXG4gIH0pKV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImxpc3QgaXRlbS50b2dnbGVcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4gaXNBY3RpdmVMaXN0SXRlbShldmVudC5saXN0SXRlbSkoc25hcHNob3QpLFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwibGlzdCBpdGVtLnJlbW92ZVwiLFxuICAgIGxpc3RJdGVtOiBldmVudC5saXN0SXRlbVxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJsaXN0IGl0ZW0udG9nZ2xlXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+ICFpc0FjdGl2ZUxpc3RJdGVtKGV2ZW50Lmxpc3RJdGVtKShzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJsaXN0IGl0ZW0uYWRkXCIsXG4gICAgbGlzdEl0ZW06IGV2ZW50Lmxpc3RJdGVtXG4gIH0pXV1cbn0pXSwgYWJzdHJhY3RNb3ZlQmVoYXZpb3JzID0gW2RlZmluZUJlaGF2aW9yKHtcbiAgb246IFwibW92ZS5ibG9jayB1cFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgY29uc3QgcHJldmlvdXNCbG9jayA9IGdldFByZXZpb3VzQmxvY2soe1xuICAgICAgLi4uc25hcHNob3QsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgICAgcGF0aDogZXZlbnQuYXQsXG4gICAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBwcmV2aW91c0Jsb2NrID8ge1xuICAgICAgcHJldmlvdXNCbG9ja1xuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwge1xuICAgIHByZXZpb3VzQmxvY2tcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcIm1vdmUuYmxvY2tcIixcbiAgICBhdDogZXZlbnQuYXQsXG4gICAgdG86IHByZXZpb3VzQmxvY2sucGF0aFxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJtb3ZlLmJsb2NrIGRvd25cIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IG5leHRCbG9jayA9IGdldE5leHRCbG9jayh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiB7XG4gICAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgIHBhdGg6IGV2ZW50LmF0LFxuICAgICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG5leHRCbG9jayA/IHtcbiAgICAgIG5leHRCbG9ja1xuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwge1xuICAgIG5leHRCbG9ja1xuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwibW92ZS5ibG9ja1wiLFxuICAgIGF0OiBldmVudC5hdCxcbiAgICB0bzogbmV4dEJsb2NrLnBhdGhcbiAgfSldXVxufSldLCBhYnN0cmFjdFNlbGVjdEJlaGF2aW9ycyA9IFtkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcInNlbGVjdC5ibG9ja1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgaWYgKGV2ZW50LnNlbGVjdCAhPT0gXCJlbmRcIilcbiAgICAgIHJldHVybiAhMTtcbiAgICBjb25zdCBibG9jayA9IGdldEZvY3VzQmxvY2skMSh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgYW5jaG9yOiB7XG4gICAgICAgICAgICBwYXRoOiBldmVudC5hdCxcbiAgICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgIHBhdGg6IGV2ZW50LmF0LFxuICAgICAgICAgICAgb2Zmc2V0OiAwXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGJsb2NrID8ge1xuICAgICAgYmxvY2tFbmRQb2ludDogZ2V0QmxvY2tFbmRQb2ludCh7XG4gICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIGJsb2NrXG4gICAgICB9KVxuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyhfLCB7XG4gICAgYmxvY2tFbmRQb2ludFxuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgYXQ6IHtcbiAgICAgIGFuY2hvcjogYmxvY2tFbmRQb2ludCxcbiAgICAgIGZvY3VzOiBibG9ja0VuZFBvaW50XG4gICAgfVxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJzZWxlY3QuYmxvY2tcIixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgIGF0OiB7XG4gICAgICBhbmNob3I6IHtcbiAgICAgICAgcGF0aDogZXZlbnQuYXQsXG4gICAgICAgIG9mZnNldDogMFxuICAgICAgfSxcbiAgICAgIGZvY3VzOiB7XG4gICAgICAgIHBhdGg6IGV2ZW50LmF0LFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH1cbiAgICB9XG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcInNlbGVjdC5wcmV2aW91cyBibG9ja1wiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiB7XG4gICAgY29uc3QgcHJldmlvdXNCbG9jayA9IGdldFByZXZpb3VzQmxvY2soc25hcHNob3QpO1xuICAgIHJldHVybiBwcmV2aW91c0Jsb2NrID8ge1xuICAgICAgcHJldmlvdXNCbG9ja1xuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwge1xuICAgIHByZXZpb3VzQmxvY2tcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlbGVjdC5ibG9ja1wiLFxuICAgIGF0OiBwcmV2aW91c0Jsb2NrLnBhdGgsXG4gICAgc2VsZWN0OiBldmVudC5zZWxlY3RcbiAgfSldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwic2VsZWN0Lm5leHQgYmxvY2tcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3RcbiAgfSkgPT4ge1xuICAgIGNvbnN0IG5leHRCbG9jayA9IGdldE5leHRCbG9jayhzbmFwc2hvdCk7XG4gICAgcmV0dXJuIG5leHRCbG9jayA/IHtcbiAgICAgIG5leHRCbG9ja1xuICAgIH0gOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwge1xuICAgIG5leHRCbG9ja1xuICB9KSA9PiBbcmFpc2Uoe1xuICAgIHR5cGU6IFwic2VsZWN0LmJsb2NrXCIsXG4gICAgYXQ6IG5leHRCbG9jay5wYXRoLFxuICAgIHNlbGVjdDogZXZlbnQuc2VsZWN0XG4gIH0pXV1cbn0pXSwgYWJzdHJhY3RTZXJpYWxpemVCZWhhdmlvcnMgPSBbZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJzZXJpYWxpemVcIixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlcmlhbGl6ZS5kYXRhXCIsXG4gICAgbWltZVR5cGU6IFwiYXBwbGljYXRpb24veC1wb3J0YWJsZS10ZXh0XCIsXG4gICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gIH0pLCByYWlzZSh7XG4gICAgdHlwZTogXCJzZXJpYWxpemUuZGF0YVwiLFxuICAgIG1pbWVUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICBvcmlnaW5FdmVudDogZXZlbnQub3JpZ2luRXZlbnRcbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcInNlcmlhbGl6ZS5kYXRhXCIsXG4gICAgbWltZVR5cGU6IFwidGV4dC9tYXJrZG93blwiLFxuICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICB9KSwgcmFpc2Uoe1xuICAgIHR5cGU6IFwic2VyaWFsaXplLmRhdGFcIixcbiAgICBtaW1lVHlwZTogXCJ0ZXh0L2h0bWxcIixcbiAgICBvcmlnaW5FdmVudDogZXZlbnQub3JpZ2luRXZlbnRcbiAgfSksIHJhaXNlKHtcbiAgICB0eXBlOiBcInNlcmlhbGl6ZS5kYXRhXCIsXG4gICAgbWltZVR5cGU6IFwidGV4dC9wbGFpblwiLFxuICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudFxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJzZXJpYWxpemUuZGF0YVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiB7XG4gICAgY29uc3QgY29udmVydGVyID0gc25hcHNob3QuY29udGV4dC5jb252ZXJ0ZXJzLmZpbmQoKGNvbnZlcnRlcjIpID0+IGNvbnZlcnRlcjIubWltZVR5cGUgPT09IGV2ZW50Lm1pbWVUeXBlKTtcbiAgICByZXR1cm4gY29udmVydGVyID8gY29udmVydGVyLnNlcmlhbGl6ZSh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50OiB7XG4gICAgICAgIHR5cGU6IFwic2VyaWFsaXplXCIsXG4gICAgICAgIG9yaWdpbkV2ZW50OiBldmVudC5vcmlnaW5FdmVudC50eXBlXG4gICAgICB9XG4gICAgfSkgOiAhMTtcbiAgfSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwgc2VyaWFsaXplRXZlbnQpID0+IFtyYWlzZSh7XG4gICAgLi4uc2VyaWFsaXplRXZlbnQsXG4gICAgb3JpZ2luRXZlbnQ6IGV2ZW50Lm9yaWdpbkV2ZW50XG4gIH0pXV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcInNlcmlhbGl6YXRpb24uc3VjY2Vzc1wiLFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9KSA9PiBbe1xuICAgIHR5cGU6IFwiZWZmZWN0XCIsXG4gICAgZWZmZWN0OiAoKSA9PiB7XG4gICAgICBldmVudC5vcmlnaW5FdmVudC5vcmlnaW5FdmVudC5kYXRhVHJhbnNmZXIuc2V0RGF0YShldmVudC5taW1lVHlwZSwgZXZlbnQuZGF0YSk7XG4gICAgfVxuICB9XV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcInNlcmlhbGl6YXRpb24uZmFpbHVyZVwiLFxuICBhY3Rpb25zOiBbKHtcbiAgICBldmVudFxuICB9KSA9PiBbe1xuICAgIHR5cGU6IFwiZWZmZWN0XCIsXG4gICAgZWZmZWN0OiAoKSA9PiB7XG4gICAgICBjb25zb2xlLndhcm4oYFNlcmlhbGl6YXRpb24gb2YgJHtldmVudC5taW1lVHlwZX0gZmFpbGVkIHdpdGggcmVhc29uIFwiJHtldmVudC5yZWFzb259XCJgKTtcbiAgICB9XG4gIH1dXVxufSldLCBhYnN0cmFjdFNwbGl0QmVoYXZpb3JzID0gW1xuICAvKipcbiAgICogWW91IGNhbid0IHNwbGl0IGFuIGlubGluZSBvYmplY3QuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwic3BsaXRcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90XG4gICAgfSkgPT4gaXNTZWxlY3Rpb25Db2xsYXBzZWQoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pICYmIGdldEZvY3VzSW5saW5lT2JqZWN0KHNuYXBzaG90KSxcbiAgICBhY3Rpb25zOiBbXVxuICB9KSxcbiAgLyoqXG4gICAqIFlvdSBjYW4ndCBzcGxpdCBhIGJsb2NrIG9iamVjdC5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJzcGxpdFwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3RcbiAgICB9KSA9PiBpc1NlbGVjdGlvbkNvbGxhcHNlZChzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbikgJiYgZ2V0Rm9jdXNCbG9ja09iamVjdChzbmFwc2hvdCksXG4gICAgYWN0aW9uczogW11cbiAgfSksXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJzcGxpdFwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3RcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbjtcbiAgICAgIGlmICghc2VsZWN0aW9uIHx8IGlzU2VsZWN0aW9uQ29sbGFwc2VkKHNlbGVjdGlvbikpXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IHN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50JDEoc2VsZWN0aW9uKSwgZW5kUG9pbnQgPSBnZXRTZWxlY3Rpb25FbmRQb2ludCQxKHNlbGVjdGlvbik7XG4gICAgICBpZiAoIXN0YXJ0UG9pbnQgfHwgIWVuZFBvaW50KVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBzdGFydEJsb2NrID0gZ2V0U2VsZWN0aW9uU3RhcnRCbG9jayhzbmFwc2hvdCksIGVuZEJsb2NrID0gZ2V0U2VsZWN0aW9uRW5kQmxvY2soc25hcHNob3QpO1xuICAgICAgaWYgKCFzdGFydEJsb2NrIHx8ICFlbmRCbG9jaylcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3Qgc3RhcnRCbG9ja1N0YXJ0UG9pbnQgPSBnZXRCbG9ja1N0YXJ0UG9pbnQoe1xuICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICBibG9jazogc3RhcnRCbG9ja1xuICAgICAgfSksIGVuZEJsb2NrRW5kUG9pbnQgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgYmxvY2s6IGVuZEJsb2NrXG4gICAgICB9KTtcbiAgICAgIHJldHVybiAhIShpc1RleHRCbG9jayhzbmFwc2hvdC5jb250ZXh0LCBzdGFydEJsb2NrLm5vZGUpICYmIGlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGVuZEJsb2NrLm5vZGUpICYmICFpc0VxdWFsU2VsZWN0aW9uUG9pbnRzKHN0YXJ0UG9pbnQsIHN0YXJ0QmxvY2tTdGFydFBvaW50KSAmJiAhaXNFcXVhbFNlbGVjdGlvblBvaW50cyhlbmRQb2ludCwgZW5kQmxvY2tFbmRQb2ludCkpO1xuICAgIH0sXG4gICAgYWN0aW9uczogWygpID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZVwiXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwic3BsaXRcIlxuICAgIH0pXV1cbiAgfSksXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJzcGxpdFwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3RcbiAgICB9KSA9PiBpc1NlbGVjdGlvbkV4cGFuZGVkKHNuYXBzaG90KSxcbiAgICBhY3Rpb25zOiBbKCkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVsZXRlXCJcbiAgICB9KV1dXG4gIH0pLFxuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwic3BsaXRcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3Qgc2VsZWN0aW9uID0gc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb247XG4gICAgICBpZiAoIXNlbGVjdGlvbiB8fCAhaXNTZWxlY3Rpb25Db2xsYXBzZWQoc2VsZWN0aW9uKSlcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3Qgc2VsZWN0aW9uU3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQkMShzZWxlY3Rpb24pLCBmb2N1c1RleHRCbG9jayA9IGdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KTtcbiAgICAgIGlmICghZm9jdXNUZXh0QmxvY2spXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IGJsb2NrRW5kUG9pbnQgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgYmxvY2s6IGZvY3VzVGV4dEJsb2NrXG4gICAgICB9KSwgbmV3VGV4dEJsb2NrU2VsZWN0aW9uID0ge1xuICAgICAgICBhbmNob3I6IHNlbGVjdGlvblN0YXJ0UG9pbnQsXG4gICAgICAgIGZvY3VzOiBibG9ja0VuZFBvaW50XG4gICAgICB9LCBuZXdUZXh0QmxvY2sgPSBwYXJzZUJsb2NrKHtcbiAgICAgICAgYmxvY2s6IHNsaWNlVGV4dEJsb2NrKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICAgICAgc2VsZWN0aW9uOiBuZXdUZXh0QmxvY2tTZWxlY3Rpb25cbiAgICAgICAgICB9LFxuICAgICAgICAgIGJsb2NrOiBmb2N1c1RleHRCbG9jay5ub2RlXG4gICAgICAgIH0pLFxuICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgbm9ybWFsaXplOiAhMSxcbiAgICAgICAgICByZW1vdmVVbnVzZWRNYXJrRGVmczogITAsXG4gICAgICAgICAgdmFsaWRhdGVGaWVsZHM6ICExXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ld1RleHRCbG9jayA/IHtcbiAgICAgICAgbmV3VGV4dEJsb2NrLFxuICAgICAgICBuZXdUZXh0QmxvY2tTZWxlY3Rpb25cbiAgICAgIH0gOiAhMTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoXywge1xuICAgICAgbmV3VGV4dEJsb2NrLFxuICAgICAgbmV3VGV4dEJsb2NrU2VsZWN0aW9uXG4gICAgfSkgPT4gaXNTZWxlY3Rpb25Db2xsYXBzZWQobmV3VGV4dEJsb2NrU2VsZWN0aW9uKSA/IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgICAgYmxvY2s6IG5ld1RleHRCbG9jayxcbiAgICAgIHBsYWNlbWVudDogXCJhZnRlclwiLFxuICAgICAgc2VsZWN0OiBcInN0YXJ0XCJcbiAgICB9KV0gOiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgIGF0OiBuZXdUZXh0QmxvY2tTZWxlY3Rpb25cbiAgICB9KSwgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrOiBuZXdUZXh0QmxvY2ssXG4gICAgICBwbGFjZW1lbnQ6IFwiYWZ0ZXJcIixcbiAgICAgIHNlbGVjdDogXCJzdGFydFwiXG4gICAgfSldXVxuICB9KVxuXSwgYWJzdHJhY3RTdHlsZUJlaGF2aW9ycyA9IFtkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcInN0eWxlLmFkZFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiAoe1xuICAgIHNlbGVjdGVkVGV4dEJsb2NrczogZ2V0U2VsZWN0ZWRUZXh0QmxvY2tzKHNuYXBzaG90KVxuICB9KSxcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSwge1xuICAgIHNlbGVjdGVkVGV4dEJsb2Nrc1xuICB9KSA9PiBzZWxlY3RlZFRleHRCbG9ja3MubWFwKChibG9jaykgPT4gcmFpc2Uoe1xuICAgIHR5cGU6IFwiYmxvY2suc2V0XCIsXG4gICAgYXQ6IGJsb2NrLnBhdGgsXG4gICAgcHJvcHM6IHtcbiAgICAgIHN0eWxlOiBldmVudC5zdHlsZVxuICAgIH1cbiAgfSkpXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwic3R5bGUucmVtb3ZlXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+ICh7XG4gICAgc2VsZWN0ZWRUZXh0QmxvY2tzOiBnZXRTZWxlY3RlZFRleHRCbG9ja3Moc25hcHNob3QpXG4gIH0pLFxuICBhY3Rpb25zOiBbKF8sIHtcbiAgICBzZWxlY3RlZFRleHRCbG9ja3NcbiAgfSkgPT4gc2VsZWN0ZWRUZXh0QmxvY2tzLm1hcCgoYmxvY2spID0+IHJhaXNlKHtcbiAgICB0eXBlOiBcImJsb2NrLnVuc2V0XCIsXG4gICAgYXQ6IGJsb2NrLnBhdGgsXG4gICAgcHJvcHM6IFtcInN0eWxlXCJdXG4gIH0pKV1cbn0pLCBkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcInN0eWxlLnRvZ2dsZVwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdCxcbiAgICBldmVudFxuICB9KSA9PiBpc0FjdGl2ZVN0eWxlKGV2ZW50LnN0eWxlKShzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJzdHlsZS5yZW1vdmVcIixcbiAgICBzdHlsZTogZXZlbnQuc3R5bGVcbiAgfSldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwic3R5bGUudG9nZ2xlXCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90LFxuICAgIGV2ZW50XG4gIH0pID0+ICFpc0FjdGl2ZVN0eWxlKGV2ZW50LnN0eWxlKShzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJzdHlsZS5hZGRcIixcbiAgICBzdHlsZTogZXZlbnQuc3R5bGVcbiAgfSldXVxufSldLCBhYnN0cmFjdEJlaGF2aW9ycyA9IFtkZWZpbmVCZWhhdmlvcih7XG4gIG9uOiBcImNsaXBib2FyZC5jb3B5XCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IHtcbiAgICBjb25zdCBmb2N1c1NwYW4gPSBnZXRGb2N1c1NwYW4kMShzbmFwc2hvdCksIHNlbGVjdGlvbkNvbGxhcHNlZCA9IGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpO1xuICAgIHJldHVybiBmb2N1c1NwYW4gJiYgc2VsZWN0aW9uQ29sbGFwc2VkO1xuICB9LFxuICBhY3Rpb25zOiBbXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiY2xpcGJvYXJkLmNvcHlcIixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlcmlhbGl6ZVwiLFxuICAgIG9yaWdpbkV2ZW50OiBldmVudFxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJjbGlwYm9hcmQuY3V0XCIsXG4gIGd1YXJkOiAoe1xuICAgIHNuYXBzaG90XG4gIH0pID0+IHtcbiAgICBjb25zdCBmb2N1c1NwYW4gPSBnZXRGb2N1c1NwYW4kMShzbmFwc2hvdCksIHNlbGVjdGlvbkNvbGxhcHNlZCA9IGlzU2VsZWN0aW9uQ29sbGFwc2VkJDEoc25hcHNob3QpO1xuICAgIHJldHVybiBmb2N1c1NwYW4gJiYgc2VsZWN0aW9uQ29sbGFwc2VkO1xuICB9LFxuICBhY3Rpb25zOiBbXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiY2xpcGJvYXJkLmN1dFwiLFxuICBndWFyZDogKHtcbiAgICBzbmFwc2hvdFxuICB9KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlcmlhbGl6ZVwiLFxuICAgIG9yaWdpbkV2ZW50OiBldmVudFxuICB9KSwgcmFpc2Uoe1xuICAgIHR5cGU6IFwiZGVsZXRlXCJcbiAgfSldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiZHJhZy5kcmFnc3RhcnRcIixcbiAgYWN0aW9uczogWyh7XG4gICAgZXZlbnRcbiAgfSkgPT4gW3JhaXNlKHtcbiAgICB0eXBlOiBcInNlcmlhbGl6ZVwiLFxuICAgIG9yaWdpbkV2ZW50OiBldmVudFxuICB9KV1dXG59KSwgZGVmaW5lQmVoYXZpb3Ioe1xuICBvbjogXCJjbGlwYm9hcmQucGFzdGVcIixcbiAgZ3VhcmQ6ICh7XG4gICAgc25hcHNob3RcbiAgfSkgPT4gaXNTZWxlY3Rpb25FeHBhbmRlZChzbmFwc2hvdCksXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJkZWxldGVcIlxuICB9KSwgZm9yd2FyZChldmVudCldXVxufSksIGRlZmluZUJlaGF2aW9yKHtcbiAgb246IFwiY2xpcGJvYXJkLnBhc3RlXCIsXG4gIGFjdGlvbnM6IFsoe1xuICAgIGV2ZW50XG4gIH0pID0+IFtyYWlzZSh7XG4gICAgdHlwZTogXCJkZXNlcmlhbGl6ZVwiLFxuICAgIG9yaWdpbkV2ZW50OiBldmVudFxuICB9KV1dXG59KSwgLi4uYWJzdHJhY3RBbm5vdGF0aW9uQmVoYXZpb3JzLCAuLi5hYnN0cmFjdERlY29yYXRvckJlaGF2aW9ycywgLi4uYWJzdHJhY3REZWxldGVCZWhhdmlvcnMsIC4uLmFic3RyYWN0RGVzZXJpYWxpemVCZWhhdmlvcnMsIC4uLmFic3RyYWN0SW5wdXRCZWhhdmlvcnMsIC4uLmFic3RyYWN0SW5zZXJ0QmVoYXZpb3JzLCAuLi5hYnN0cmFjdEtleWJvYXJkQmVoYXZpb3JzLCAuLi5hYnN0cmFjdExpc3RJdGVtQmVoYXZpb3JzLCAuLi5hYnN0cmFjdE1vdmVCZWhhdmlvcnMsIC4uLmFic3RyYWN0U3R5bGVCZWhhdmlvcnMsIC4uLmFic3RyYWN0U2VsZWN0QmVoYXZpb3JzLCAuLi5hYnN0cmFjdFNlcmlhbGl6ZUJlaGF2aW9ycywgLi4uYWJzdHJhY3RTcGxpdEJlaGF2aW9yc107XG5mdW5jdGlvbiBpc1N5bnRoZXRpY0JlaGF2aW9yRXZlbnQoZXZlbnQpIHtcbiAgcmV0dXJuICFpc0N1c3RvbUJlaGF2aW9yRXZlbnQoZXZlbnQpICYmICFpc05hdGl2ZUJlaGF2aW9yRXZlbnQoZXZlbnQpICYmICFpc0Fic3RyYWN0QmVoYXZpb3JFdmVudChldmVudCk7XG59XG5jb25zdCBhYnN0cmFjdEJlaGF2aW9yRXZlbnRUeXBlcyA9IFtcImFubm90YXRpb24uc2V0XCIsIFwiYW5ub3RhdGlvbi50b2dnbGVcIiwgXCJkZWNvcmF0b3IudG9nZ2xlXCIsIFwiZGVsZXRlLmJhY2t3YXJkXCIsIFwiZGVsZXRlLmJsb2NrXCIsIFwiZGVsZXRlLmNoaWxkXCIsIFwiZGVsZXRlLmZvcndhcmRcIiwgXCJkZWxldGUudGV4dFwiLCBcImRlc2VyaWFsaXplXCIsIFwiZGVzZXJpYWxpemUuZGF0YVwiLCBcImRlc2VyaWFsaXphdGlvbi5zdWNjZXNzXCIsIFwiZGVzZXJpYWxpemF0aW9uLmZhaWx1cmVcIiwgXCJpbnNlcnQuYmxvY2tzXCIsIFwiaW5zZXJ0LmJyZWFrXCIsIFwiaW5zZXJ0LmlubGluZSBvYmplY3RcIiwgXCJpbnNlcnQuc29mdCBicmVha1wiLCBcImluc2VydC5zcGFuXCIsIFwibGlzdCBpdGVtLmFkZFwiLCBcImxpc3QgaXRlbS5yZW1vdmVcIiwgXCJsaXN0IGl0ZW0udG9nZ2xlXCIsIFwibW92ZS5ibG9jayBkb3duXCIsIFwibW92ZS5ibG9jayB1cFwiLCBcInNlbGVjdC5ibG9ja1wiLCBcInNlbGVjdC5wcmV2aW91cyBibG9ja1wiLCBcInNlbGVjdC5uZXh0IGJsb2NrXCIsIFwic2VyaWFsaXplXCIsIFwic2VyaWFsaXplLmRhdGFcIiwgXCJzZXJpYWxpemF0aW9uLnN1Y2Nlc3NcIiwgXCJzZXJpYWxpemF0aW9uLmZhaWx1cmVcIiwgXCJzcGxpdFwiLCBcInN0eWxlLmFkZFwiLCBcInN0eWxlLnJlbW92ZVwiLCBcInN0eWxlLnRvZ2dsZVwiXTtcbmZ1bmN0aW9uIGlzQWJzdHJhY3RCZWhhdmlvckV2ZW50KGV2ZW50KSB7XG4gIHJldHVybiBhYnN0cmFjdEJlaGF2aW9yRXZlbnRUeXBlcy5pbmNsdWRlcyhldmVudC50eXBlKTtcbn1cbmNvbnN0IG5hdGl2ZUJlaGF2aW9yRXZlbnRUeXBlcyA9IFtcImNsaXBib2FyZC5jb3B5XCIsIFwiY2xpcGJvYXJkLmN1dFwiLCBcImNsaXBib2FyZC5wYXN0ZVwiLCBcImRyYWcuZHJhZ3N0YXJ0XCIsIFwiZHJhZy5kcmFnXCIsIFwiZHJhZy5kcmFnZW5kXCIsIFwiZHJhZy5kcmFnZW50ZXJcIiwgXCJkcmFnLmRyYWdvdmVyXCIsIFwiZHJhZy5kcmFnbGVhdmVcIiwgXCJkcmFnLmRyb3BcIiwgXCJpbnB1dC4qXCIsIFwia2V5Ym9hcmQua2V5ZG93blwiLCBcImtleWJvYXJkLmtleXVwXCIsIFwibW91c2UuY2xpY2tcIl07XG5mdW5jdGlvbiBpc05hdGl2ZUJlaGF2aW9yRXZlbnQoZXZlbnQpIHtcbiAgcmV0dXJuIG5hdGl2ZUJlaGF2aW9yRXZlbnRUeXBlcy5pbmNsdWRlcyhldmVudC50eXBlKTtcbn1cbmZ1bmN0aW9uIGlzQ3VzdG9tQmVoYXZpb3JFdmVudChldmVudCkge1xuICByZXR1cm4gZXZlbnQudHlwZS5zdGFydHNXaXRoKFwiY3VzdG9tLlwiKTtcbn1cbmNvbnN0IGRlYnVnJDUgPSBkZWJ1Z1dpdGhOYW1lKFwiYmVoYXZpb3JzOmV2ZW50XCIpO1xuZnVuY3Rpb24gZXZlbnRDYXRlZ29yeShldmVudCkge1xuICByZXR1cm4gaXNOYXRpdmVCZWhhdmlvckV2ZW50KGV2ZW50KSA/IFwibmF0aXZlXCIgOiBpc0Fic3RyYWN0QmVoYXZpb3JFdmVudChldmVudCkgPyBcInN5bnRoZXRpY1wiIDogaXNDdXN0b21CZWhhdmlvckV2ZW50KGV2ZW50KSA/IFwiY3VzdG9tXCIgOiBcInN5bnRoZXRpY1wiO1xufVxuZnVuY3Rpb24gcGVyZm9ybUV2ZW50KHtcbiAgbW9kZSxcbiAgYmVoYXZpb3JzLFxuICByZW1haW5pbmdFdmVudEJlaGF2aW9ycyxcbiAgZXZlbnQsXG4gIGVkaXRvcixcbiAga2V5R2VuZXJhdG9yLFxuICBzY2hlbWEsXG4gIGdldFNuYXBzaG90LFxuICBuYXRpdmVFdmVudCxcbiAgc2VuZEJhY2tcbn0pIHtcbiAgbW9kZSA9PT0gXCJzZW5kXCIgJiYgIWlzTmF0aXZlQmVoYXZpb3JFdmVudChldmVudCkgJiYgKGVkaXRvci51bmRvU3RlcElkID0gZGVmYXVsdEtleUdlbmVyYXRvcigpKSwgZGVidWckNShgKCR7bW9kZX06JHtldmVudENhdGVnb3J5KGV2ZW50KX0pYCwgSlNPTi5zdHJpbmdpZnkoZXZlbnQsIG51bGwsIDIpKTtcbiAgY29uc3QgZXZlbnRCZWhhdmlvcnMgPSBbLi4ucmVtYWluaW5nRXZlbnRCZWhhdmlvcnMsIC4uLmFic3RyYWN0QmVoYXZpb3JzXS5maWx0ZXIoKGJlaGF2aW9yKSA9PiB7XG4gICAgaWYgKGJlaGF2aW9yLm9uID09PSBcIipcIilcbiAgICAgIHJldHVybiAhMDtcbiAgICBjb25zdCBbbGlzdGVuZWROYW1lc3BhY2VdID0gYmVoYXZpb3Iub24uaW5jbHVkZXMoXCIqXCIpICYmIGJlaGF2aW9yLm9uLmluY2x1ZGVzKFwiLlwiKSA/IGJlaGF2aW9yLm9uLnNwbGl0KFwiLlwiKSA6IFt2b2lkIDBdLCBbZXZlbnROYW1lc3BhY2VdID0gZXZlbnQudHlwZS5pbmNsdWRlcyhcIi5cIikgPyBldmVudC50eXBlLnNwbGl0KFwiLlwiKSA6IFt2b2lkIDBdO1xuICAgIHJldHVybiBsaXN0ZW5lZE5hbWVzcGFjZSAhPT0gdm9pZCAwICYmIGV2ZW50TmFtZXNwYWNlICE9PSB2b2lkIDAgJiYgbGlzdGVuZWROYW1lc3BhY2UgPT09IGV2ZW50TmFtZXNwYWNlIHx8IGxpc3RlbmVkTmFtZXNwYWNlICE9PSB2b2lkIDAgJiYgZXZlbnROYW1lc3BhY2UgPT09IHZvaWQgMCAmJiBsaXN0ZW5lZE5hbWVzcGFjZSA9PT0gZXZlbnQudHlwZSA/ICEwIDogYmVoYXZpb3Iub24gPT09IGV2ZW50LnR5cGU7XG4gIH0pO1xuICBpZiAoZXZlbnRCZWhhdmlvcnMubGVuZ3RoID09PSAwICYmIGlzU3ludGhldGljQmVoYXZpb3JFdmVudChldmVudCkpIHtcbiAgICBuYXRpdmVFdmVudD8ucHJldmVudERlZmF1bHQoKSwgbW9kZSA9PT0gXCJzZW5kXCIgJiYgKGVkaXRvci51bmRvU3RlcElkID0gdm9pZCAwKSwgd2l0aFBlcmZvcm1pbmdCZWhhdmlvck9wZXJhdGlvbihlZGl0b3IsICgpID0+IHtcbiAgICAgIGRlYnVnJDUoYChleGVjdXRlOiR7ZXZlbnRDYXRlZ29yeShldmVudCl9KWAsIEpTT04uc3RyaW5naWZ5KGV2ZW50LCBudWxsLCAyKSksIHBlcmZvcm1PcGVyYXRpb24oe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAga2V5R2VuZXJhdG9yLFxuICAgICAgICAgIHNjaGVtYVxuICAgICAgICB9LFxuICAgICAgICBvcGVyYXRpb246IHtcbiAgICAgICAgICAuLi5ldmVudCxcbiAgICAgICAgICBlZGl0b3JcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSksIGVkaXRvci5vbkNoYW5nZSgpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBndWFyZFNuYXBzaG90ID0gZ2V0U25hcHNob3QoKTtcbiAgbGV0IG5hdGl2ZUV2ZW50UHJldmVudGVkID0gITEsIGRlZmF1bHRCZWhhdmlvck92ZXJ3cml0dGVuID0gITEsIGV2ZW50QmVoYXZpb3JJbmRleCA9IC0xO1xuICBmb3IgKGNvbnN0IGV2ZW50QmVoYXZpb3Igb2YgZXZlbnRCZWhhdmlvcnMpIHtcbiAgICBldmVudEJlaGF2aW9ySW5kZXgrKztcbiAgICBsZXQgc2hvdWxkUnVuID0gITE7XG4gICAgdHJ5IHtcbiAgICAgIHNob3VsZFJ1biA9IGV2ZW50QmVoYXZpb3IuZ3VhcmQgPT09IHZvaWQgMCB8fCBldmVudEJlaGF2aW9yLmd1YXJkKHtcbiAgICAgICAgc25hcHNob3Q6IGd1YXJkU25hcHNob3QsXG4gICAgICAgIGV2ZW50LFxuICAgICAgICBkb206IGNyZWF0ZUVkaXRvckRvbShzZW5kQmFjaywgZWRpdG9yKVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IobmV3IEVycm9yKGBFdmFsdWF0aW5nIGd1YXJkIGZvciBcIiR7ZXZlbnQudHlwZX1cIiBmYWlsZWQgZHVlIHRvOiAke2Vycm9yLm1lc3NhZ2V9YCkpO1xuICAgIH1cbiAgICBpZiAoIXNob3VsZFJ1bilcbiAgICAgIGNvbnRpbnVlO1xuICAgIGRlZmF1bHRCZWhhdmlvck92ZXJ3cml0dGVuID0gITAsIGV2ZW50QmVoYXZpb3IuYWN0aW9ucy5sZW5ndGggPT09IDAgJiYgKG5hdGl2ZUV2ZW50UHJldmVudGVkID0gITApO1xuICAgIGxldCBhY3Rpb25TZXRJbmRleCA9IC0xO1xuICAgIGZvciAoY29uc3QgYWN0aW9uU2V0IG9mIGV2ZW50QmVoYXZpb3IuYWN0aW9ucykge1xuICAgICAgYWN0aW9uU2V0SW5kZXgrKztcbiAgICAgIGNvbnN0IGFjdGlvbnNTbmFwc2hvdCA9IGdldFNuYXBzaG90KCk7XG4gICAgICBsZXQgYWN0aW9ucyA9IFtdO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYWN0aW9ucyA9IGFjdGlvblNldCh7XG4gICAgICAgICAgc25hcHNob3Q6IGFjdGlvbnNTbmFwc2hvdCxcbiAgICAgICAgICBldmVudCxcbiAgICAgICAgICBkb206IGNyZWF0ZUVkaXRvckRvbShzZW5kQmFjaywgZWRpdG9yKVxuICAgICAgICB9LCBzaG91bGRSdW4pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihuZXcgRXJyb3IoYEV2YWx1YXRpbmcgYWN0aW9ucyBmb3IgXCIke2V2ZW50LnR5cGV9XCIgZmFpbGVkIGR1ZSB0bzogJHtlcnJvci5tZXNzYWdlfWApKTtcbiAgICAgIH1cbiAgICAgIGlmIChhY3Rpb25zLmxlbmd0aCA9PT0gMClcbiAgICAgICAgY29udGludWU7XG4gICAgICBuYXRpdmVFdmVudFByZXZlbnRlZCA9IGFjdGlvbnMuc29tZSgoYWN0aW9uKSA9PiBhY3Rpb24udHlwZSA9PT0gXCJyYWlzZVwiIHx8IGFjdGlvbi50eXBlID09PSBcImV4ZWN1dGVcIikgfHwgIWFjdGlvbnMuc29tZSgoYWN0aW9uKSA9PiBhY3Rpb24udHlwZSA9PT0gXCJmb3J3YXJkXCIpO1xuICAgICAgbGV0IHVuZG9TdGVwQ3JlYXRlZCA9ICExO1xuICAgICAgYWN0aW9uU2V0SW5kZXggPiAwICYmIChlZGl0b3IudW5kb1N0ZXBJZCA9IGRlZmF1bHRLZXlHZW5lcmF0b3IoKSwgdW5kb1N0ZXBDcmVhdGVkID0gITApLCAhdW5kb1N0ZXBDcmVhdGVkICYmIGFjdGlvbnMuc29tZSgoYWN0aW9uKSA9PiBhY3Rpb24udHlwZSA9PT0gXCJleGVjdXRlXCIpICYmIChlZGl0b3IudW5kb1N0ZXBJZCA9IGRlZmF1bHRLZXlHZW5lcmF0b3IoKSwgdW5kb1N0ZXBDcmVhdGVkID0gITApO1xuICAgICAgY29uc3QgYWN0aW9uVHlwZXMgPSBhY3Rpb25zLm1hcCgoYWN0aW9uKSA9PiBhY3Rpb24udHlwZSksIHVuaXF1ZUFjdGlvblR5cGVzID0gbmV3IFNldChhY3Rpb25UeXBlcyksIHJhaXNlR3JvdXAgPSBhY3Rpb25UeXBlcy5sZW5ndGggPiAxICYmIHVuaXF1ZUFjdGlvblR5cGVzLnNpemUgPT09IDEgJiYgdW5pcXVlQWN0aW9uVHlwZXMuaGFzKFwicmFpc2VcIiksIGV4ZWN1dGVHcm91cCA9IGFjdGlvblR5cGVzLmxlbmd0aCA+IDEgJiYgdW5pcXVlQWN0aW9uVHlwZXMuc2l6ZSA9PT0gMSAmJiB1bmlxdWVBY3Rpb25UeXBlcy5oYXMoXCJleGVjdXRlXCIpO1xuICAgICAgd2l0aG91dE5vcm1hbGl6aW5nQ29uZGl0aW9uYWwoZWRpdG9yLCAoKSA9PiByYWlzZUdyb3VwIHx8IGV4ZWN1dGVHcm91cCwgKCkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25zKSB7XG4gICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSBcImVmZmVjdFwiKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBhY3Rpb24uZWZmZWN0KHtcbiAgICAgICAgICAgICAgICBzZW5kOiBzZW5kQmFja1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IobmV3IEVycm9yKGBFeGVjdXRpbmcgZWZmZWN0IGFzIGEgcmVzdWx0IG9mIFwiJHtldmVudC50eXBlfVwiIGZhaWxlZCBkdWUgdG86ICR7ZXJyb3IubWVzc2FnZX1gKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSBcImZvcndhcmRcIikge1xuICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nRXZlbnRCZWhhdmlvcnMyID0gZXZlbnRCZWhhdmlvcnMuc2xpY2UoZXZlbnRCZWhhdmlvckluZGV4ICsgMSk7XG4gICAgICAgICAgICBwZXJmb3JtRXZlbnQoe1xuICAgICAgICAgICAgICBtb2RlOiBtb2RlID09PSBcImV4ZWN1dGVcIiA/IFwiZXhlY3V0ZVwiIDogXCJmb3J3YXJkXCIsXG4gICAgICAgICAgICAgIGJlaGF2aW9ycyxcbiAgICAgICAgICAgICAgcmVtYWluaW5nRXZlbnRCZWhhdmlvcnM6IHJlbWFpbmluZ0V2ZW50QmVoYXZpb3JzMixcbiAgICAgICAgICAgICAgZXZlbnQ6IGFjdGlvbi5ldmVudCxcbiAgICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgICBrZXlHZW5lcmF0b3IsXG4gICAgICAgICAgICAgIHNjaGVtYSxcbiAgICAgICAgICAgICAgZ2V0U25hcHNob3QsXG4gICAgICAgICAgICAgIG5hdGl2ZUV2ZW50LFxuICAgICAgICAgICAgICBzZW5kQmFja1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSBcInJhaXNlXCIpIHtcbiAgICAgICAgICAgIHBlcmZvcm1FdmVudCh7XG4gICAgICAgICAgICAgIG1vZGU6IG1vZGUgPT09IFwiZXhlY3V0ZVwiID8gXCJleGVjdXRlXCIgOiBcInJhaXNlXCIsXG4gICAgICAgICAgICAgIGJlaGF2aW9ycyxcbiAgICAgICAgICAgICAgcmVtYWluaW5nRXZlbnRCZWhhdmlvcnM6IG1vZGUgPT09IFwiZXhlY3V0ZVwiID8gcmVtYWluaW5nRXZlbnRCZWhhdmlvcnMgOiBiZWhhdmlvcnMsXG4gICAgICAgICAgICAgIGV2ZW50OiBhY3Rpb24uZXZlbnQsXG4gICAgICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICAgICAga2V5R2VuZXJhdG9yLFxuICAgICAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgICAgIGdldFNuYXBzaG90LFxuICAgICAgICAgICAgICBuYXRpdmVFdmVudCxcbiAgICAgICAgICAgICAgc2VuZEJhY2tcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBlcmZvcm1FdmVudCh7XG4gICAgICAgICAgICBtb2RlOiBcImV4ZWN1dGVcIixcbiAgICAgICAgICAgIGJlaGF2aW9ycyxcbiAgICAgICAgICAgIHJlbWFpbmluZ0V2ZW50QmVoYXZpb3JzOiBbXSxcbiAgICAgICAgICAgIGV2ZW50OiBhY3Rpb24uZXZlbnQsXG4gICAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgICBrZXlHZW5lcmF0b3IsXG4gICAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgICBnZXRTbmFwc2hvdCxcbiAgICAgICAgICAgIG5hdGl2ZUV2ZW50OiB2b2lkIDAsXG4gICAgICAgICAgICBzZW5kQmFja1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KSwgdW5kb1N0ZXBDcmVhdGVkICYmIChlZGl0b3IudW5kb1N0ZXBJZCA9IHZvaWQgMCk7XG4gICAgfVxuICAgIGJyZWFrO1xuICB9XG4gICFkZWZhdWx0QmVoYXZpb3JPdmVyd3JpdHRlbiAmJiBpc1N5bnRoZXRpY0JlaGF2aW9yRXZlbnQoZXZlbnQpID8gKG5hdGl2ZUV2ZW50Py5wcmV2ZW50RGVmYXVsdCgpLCBtb2RlID09PSBcInNlbmRcIiAmJiAoZWRpdG9yLnVuZG9TdGVwSWQgPSB2b2lkIDApLCB3aXRoUGVyZm9ybWluZ0JlaGF2aW9yT3BlcmF0aW9uKGVkaXRvciwgKCkgPT4ge1xuICAgIGRlYnVnJDUoYChleGVjdXRlOiR7ZXZlbnRDYXRlZ29yeShldmVudCl9KWAsIEpTT04uc3RyaW5naWZ5KGV2ZW50LCBudWxsLCAyKSksIHBlcmZvcm1PcGVyYXRpb24oe1xuICAgICAgY29udGV4dDoge1xuICAgICAgICBrZXlHZW5lcmF0b3IsXG4gICAgICAgIHNjaGVtYVxuICAgICAgfSxcbiAgICAgIG9wZXJhdGlvbjoge1xuICAgICAgICAuLi5ldmVudCxcbiAgICAgICAgZWRpdG9yXG4gICAgICB9XG4gICAgfSk7XG4gIH0pLCBlZGl0b3Iub25DaGFuZ2UoKSkgOiBuYXRpdmVFdmVudFByZXZlbnRlZCAmJiBuYXRpdmVFdmVudD8ucHJldmVudERlZmF1bHQoKTtcbn1cbmZ1bmN0aW9uIHNvcnRCeVByaW9yaXR5KGl0ZW1zKSB7XG4gIGlmIChpdGVtcy5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIFtdO1xuICBjb25zdCBpdGVtc1dpdGhQcmlvcml0eSA9IGl0ZW1zLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5wcmlvcml0eSAhPT0gdm9pZCAwKSwgaXRlbXNXaXRob3V0UHJpb3JpdHkgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ucHJpb3JpdHkgPT09IHZvaWQgMCk7XG4gIGlmIChpdGVtc1dpdGhQcmlvcml0eS5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIGl0ZW1zO1xuICBjb25zdCBpdGVtc0J5UHJpb3JpdHlJZCA9IG5ldyBNYXAoaXRlbXNXaXRoUHJpb3JpdHkubWFwKChpdGVtKSA9PiBbaXRlbS5wcmlvcml0eS5pZCwgaXRlbV0pKSwgZ3JhcGggPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCBpbkRlZ3JlZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gIGZ1bmN0aW9uIGVuc3VyZU5vZGUoaWQpIHtcbiAgICBncmFwaC5oYXMoaWQpIHx8IChncmFwaC5zZXQoaWQsIC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCkpLCBpbkRlZ3JlZS5zZXQoaWQsIDApKTtcbiAgfVxuICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXNXaXRoUHJpb3JpdHkpIHtcbiAgICBjb25zdCBpZCA9IGl0ZW0ucHJpb3JpdHkuaWQ7XG4gICAgZW5zdXJlTm9kZShpZCk7XG4gIH1cbiAgZnVuY3Rpb24gYWRkRWRnZShmcm9tSWQsIHRvSWQpIHtcbiAgICAhZ3JhcGguaGFzKGZyb21JZCkgfHwgIWdyYXBoLmhhcyh0b0lkKSB8fCAoZ3JhcGguZ2V0KGZyb21JZCk/LmFkZCh0b0lkKSwgaW5EZWdyZWUuc2V0KHRvSWQsIChpbkRlZ3JlZS5nZXQodG9JZCkgPz8gMCkgKyAxKSk7XG4gIH1cbiAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zV2l0aFByaW9yaXR5KSB7XG4gICAgY29uc3QgaWQgPSBpdGVtLnByaW9yaXR5LmlkLCB2aXNpdGVkID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTtcbiAgICBsZXQgcmVmID0gaXRlbS5wcmlvcml0eS5yZWZlcmVuY2U7XG4gICAgZm9yICg7IHJlZjsgKSB7XG4gICAgICBjb25zdCByZWZJZCA9IHJlZi5wcmlvcml0eS5pZDtcbiAgICAgIGlmIChlbnN1cmVOb2RlKHJlZklkKSwgdmlzaXRlZC5oYXMocmVmSWQpKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDaXJjdWxhciBkZXBlbmRlbmN5IGRldGVjdGVkIGluIHByaW9yaXRpZXNcIik7XG4gICAgICB2aXNpdGVkLmFkZChyZWZJZCksIHJlZi5pbXBvcnRhbmNlID09PSBcImhpZ2hlclwiID8gYWRkRWRnZShpZCwgcmVmSWQpIDogYWRkRWRnZShyZWZJZCwgaWQpLCByZWYgPSByZWYucHJpb3JpdHkucmVmZXJlbmNlO1xuICAgIH1cbiAgfVxuICBjb25zdCBxdWV1ZSA9IFtdO1xuICBmb3IgKGNvbnN0IFtpZCwgZGVncmVlXSBvZiBpbkRlZ3JlZSlcbiAgICBkZWdyZWUgPT09IDAgJiYgcXVldWUucHVzaChpZCk7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKDsgcXVldWUubGVuZ3RoID4gMDsgKSB7XG4gICAgY29uc3QgY3VycmVudElkID0gcXVldWUuc2hpZnQoKSwgY3VycmVudEl0ZW0gPSBpdGVtc0J5UHJpb3JpdHlJZC5nZXQoY3VycmVudElkKTtcbiAgICBjdXJyZW50SXRlbSAmJiByZXN1bHQucHVzaChjdXJyZW50SXRlbSk7XG4gICAgZm9yIChjb25zdCBuZWlnaGJvcklkIG9mIGdyYXBoLmdldChjdXJyZW50SWQpID8/IFtdKSB7XG4gICAgICBjb25zdCBuZXdEZWdyZWUgPSAoaW5EZWdyZWUuZ2V0KG5laWdoYm9ySWQpID8/IDApIC0gMTtcbiAgICAgIGluRGVncmVlLnNldChuZWlnaGJvcklkLCBuZXdEZWdyZWUpLCBuZXdEZWdyZWUgPT09IDAgJiYgcXVldWUucHVzaChuZWlnaGJvcklkKTtcbiAgICB9XG4gIH1cbiAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zV2l0aFByaW9yaXR5KVxuICAgIHJlc3VsdC5pbmNsdWRlcyhpdGVtKSB8fCByZXN1bHQucHVzaChpdGVtKTtcbiAgcmV0dXJuIFsuLi5yZXN1bHQsIC4uLml0ZW1zV2l0aG91dFByaW9yaXR5XTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUVkaXRvclNuYXBzaG90KHtcbiAgY29udmVydGVycyxcbiAgZWRpdG9yLFxuICBrZXlHZW5lcmF0b3IsXG4gIHJlYWRPbmx5LFxuICBzY2hlbWFcbn0pIHtcbiAgY29uc3Qgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbiA/IHNsYXRlUmFuZ2VUb1NlbGVjdGlvbih7XG4gICAgc2NoZW1hLFxuICAgIGVkaXRvcixcbiAgICByYW5nZTogZWRpdG9yLnNlbGVjdGlvblxuICB9KSA6IG51bGwsIGNvbnRleHQgPSB7XG4gICAgY29udmVydGVycyxcbiAgICBrZXlHZW5lcmF0b3IsXG4gICAgcmVhZE9ubHksXG4gICAgc2NoZW1hLFxuICAgIHNlbGVjdGlvbixcbiAgICB2YWx1ZTogZWRpdG9yLnZhbHVlXG4gIH07XG4gIHJldHVybiB7XG4gICAgYmxvY2tJbmRleE1hcDogZWRpdG9yLmJsb2NrSW5kZXhNYXAsXG4gICAgY29udGV4dCxcbiAgICBkZWNvcmF0b3JTdGF0ZTogZWRpdG9yLmRlY29yYXRvclN0YXRlXG4gIH07XG59XG5jb25zdCBkZWJ1ZyQ0ID0gZGVidWdXaXRoTmFtZShcImVkaXRvciBtYWNoaW5lXCIpO1xuZnVuY3Rpb24gcmVyb3V0ZUV4dGVybmFsQmVoYXZpb3JFdmVudCh7XG4gIGV2ZW50LFxuICBzbGF0ZUVkaXRvclxufSkge1xuICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcbiAgICBjYXNlIFwiYmx1clwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJibHVyXCIsXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgICAgIH07XG4gICAgY2FzZSBcImZvY3VzXCI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcImZvY3VzXCIsXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgICAgIH07XG4gICAgY2FzZSBcImluc2VydC5ibG9jayBvYmplY3RcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDoge1xuICAgICAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICAgICAgYmxvY2s6IHtcbiAgICAgICAgICAgIF90eXBlOiBldmVudC5ibG9ja09iamVjdC5uYW1lLFxuICAgICAgICAgICAgLi4uZXZlbnQuYmxvY2tPYmplY3QudmFsdWUgPz8ge31cbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsYWNlbWVudDogZXZlbnQucGxhY2VtZW50XG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgICAgIH07XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwiYmVoYXZpb3IgZXZlbnRcIixcbiAgICAgICAgYmVoYXZpb3JFdmVudDogZXZlbnQsXG4gICAgICAgIGVkaXRvcjogc2xhdGVFZGl0b3JcbiAgICAgIH07XG4gIH1cbn1cbmNvbnN0IGVkaXRvck1hY2hpbmUgPSBzZXR1cCh7XG4gIHR5cGVzOiB7XG4gICAgY29udGV4dDoge30sXG4gICAgZXZlbnRzOiB7fSxcbiAgICBlbWl0dGVkOiB7fSxcbiAgICBpbnB1dDoge30sXG4gICAgdGFnczoge31cbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIFwiYWRkIGJlaGF2aW9yIHRvIGNvbnRleHRcIjogYXNzaWduKHtcbiAgICAgIGJlaGF2aW9yczogKHtcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IChhc3NlcnRFdmVudChldmVudCwgXCJhZGQgYmVoYXZpb3JcIiksIC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsuLi5jb250ZXh0LmJlaGF2aW9ycywgZXZlbnQuYmVoYXZpb3JDb25maWddKSksXG4gICAgICBiZWhhdmlvcnNTb3J0ZWQ6ICExXG4gICAgfSksXG4gICAgXCJyZW1vdmUgYmVoYXZpb3IgZnJvbSBjb250ZXh0XCI6IGFzc2lnbih7XG4gICAgICBiZWhhdmlvcnM6ICh7XG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGV2ZW50XG4gICAgICB9KSA9PiAoYXNzZXJ0RXZlbnQoZXZlbnQsIFwicmVtb3ZlIGJlaGF2aW9yXCIpLCBjb250ZXh0LmJlaGF2aW9ycy5kZWxldGUoZXZlbnQuYmVoYXZpb3JDb25maWcpLCAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbLi4uY29udGV4dC5iZWhhdmlvcnNdKSlcbiAgICB9KSxcbiAgICBcImFkZCBzbGF0ZSBlZGl0b3IgdG8gY29udGV4dFwiOiBhc3NpZ24oe1xuICAgICAgc2xhdGVFZGl0b3I6ICh7XG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGV2ZW50XG4gICAgICB9KSA9PiBldmVudC50eXBlID09PSBcImFkZCBzbGF0ZSBlZGl0b3JcIiA/IGV2ZW50LmVkaXRvciA6IGNvbnRleHQuc2xhdGVFZGl0b3JcbiAgICB9KSxcbiAgICBcImVtaXQgcGF0Y2ggZXZlbnRcIjogZW1pdCgoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiAoYXNzZXJ0RXZlbnQoZXZlbnQsIFwiaW50ZXJuYWwucGF0Y2hcIiksIGV2ZW50KSksXG4gICAgXCJlbWl0IG11dGF0aW9uIGV2ZW50XCI6IGVtaXQoKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gKGFzc2VydEV2ZW50KGV2ZW50LCBcIm11dGF0aW9uXCIpLCBldmVudCkpLFxuICAgIFwiZW1pdCByZWFkIG9ubHlcIjogZW1pdCh7XG4gICAgICB0eXBlOiBcInJlYWQgb25seVwiXG4gICAgfSksXG4gICAgXCJlbWl0IGVkaXRhYmxlXCI6IGVtaXQoe1xuICAgICAgdHlwZTogXCJlZGl0YWJsZVwiXG4gICAgfSksXG4gICAgXCJkZWZlciBldmVudFwiOiBhc3NpZ24oe1xuICAgICAgcGVuZGluZ0V2ZW50czogKHtcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IChhc3NlcnRFdmVudChldmVudCwgW1wiaW50ZXJuYWwucGF0Y2hcIiwgXCJtdXRhdGlvblwiXSksIFsuLi5jb250ZXh0LnBlbmRpbmdFdmVudHMsIGV2ZW50XSlcbiAgICB9KSxcbiAgICBcImVtaXQgcGVuZGluZyBldmVudHNcIjogZW5xdWV1ZUFjdGlvbnMoKHtcbiAgICAgIGNvbnRleHQsXG4gICAgICBlbnF1ZXVlXG4gICAgfSkgPT4ge1xuICAgICAgZm9yIChjb25zdCBldmVudCBvZiBjb250ZXh0LnBlbmRpbmdFdmVudHMpXG4gICAgICAgIGVucXVldWUuZW1pdChldmVudCk7XG4gICAgfSksXG4gICAgXCJlbWl0IHJlYWR5XCI6IGVtaXQoe1xuICAgICAgdHlwZTogXCJyZWFkeVwiXG4gICAgfSksXG4gICAgXCJjbGVhciBwZW5kaW5nIGV2ZW50c1wiOiBhc3NpZ24oe1xuICAgICAgcGVuZGluZ0V2ZW50czogW11cbiAgICB9KSxcbiAgICBcImRlZmVyIGluY29taW5nIHBhdGNoZXNcIjogYXNzaWduKHtcbiAgICAgIHBlbmRpbmdJbmNvbWluZ1BhdGNoZXNFdmVudHM6ICh7XG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGV2ZW50XG4gICAgICB9KSA9PiBldmVudC50eXBlID09PSBcInBhdGNoZXNcIiA/IFsuLi5jb250ZXh0LnBlbmRpbmdJbmNvbWluZ1BhdGNoZXNFdmVudHMsIGV2ZW50XSA6IGNvbnRleHQucGVuZGluZ0luY29taW5nUGF0Y2hlc0V2ZW50c1xuICAgIH0pLFxuICAgIFwiZW1pdCBwZW5kaW5nIGluY29taW5nIHBhdGNoZXNcIjogZW5xdWV1ZUFjdGlvbnMoKHtcbiAgICAgIGNvbnRleHQsXG4gICAgICBlbnF1ZXVlXG4gICAgfSkgPT4ge1xuICAgICAgZm9yIChjb25zdCBldmVudCBvZiBjb250ZXh0LnBlbmRpbmdJbmNvbWluZ1BhdGNoZXNFdmVudHMpXG4gICAgICAgIGVucXVldWUuZW1pdChldmVudCk7XG4gICAgfSksXG4gICAgXCJjbGVhciBwZW5kaW5nIGluY29taW5nIHBhdGNoZXNcIjogYXNzaWduKHtcbiAgICAgIHBlbmRpbmdJbmNvbWluZ1BhdGNoZXNFdmVudHM6IFtdXG4gICAgfSksXG4gICAgXCJoYW5kbGUgYmx1clwiOiAoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBhc3NlcnRFdmVudChldmVudCwgXCJibHVyXCIpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgUmVhY3RFZGl0b3IuYmx1cihldmVudC5lZGl0b3IpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihuZXcgRXJyb3IoYEZhaWxlZCB0byBibHVyIGVkaXRvcjogJHtlcnJvci5tZXNzYWdlfWApKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiaGFuZGxlIGZvY3VzXCI6ICh7XG4gICAgICBjb250ZXh0XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3Qgc2xhdGVFZGl0b3IgPSBjb250ZXh0LnNsYXRlRWRpdG9yO1xuICAgICAgaWYgKCFzbGF0ZUVkaXRvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTm8gU2xhdGUgZWRpdG9yIGZvdW5kIHRvIGZvY3VzXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjdXJyZW50U2VsZWN0aW9uID0gc2xhdGVFZGl0b3Iuc2VsZWN0aW9uO1xuICAgICAgICBSZWFjdEVkaXRvci5mb2N1cyhzbGF0ZUVkaXRvciksIGN1cnJlbnRTZWxlY3Rpb24gJiYgKFRyYW5zZm9ybXMuc2VsZWN0KHNsYXRlRWRpdG9yLCBjdXJyZW50U2VsZWN0aW9uKSwgRURJVE9SX1RPX1BFTkRJTkdfU0VMRUNUSU9OLnNldChzbGF0ZUVkaXRvciwgc2xhdGVFZGl0b3Iuc2VsZWN0aW9uKSwgc2xhdGVFZGl0b3Iub25DaGFuZ2UoKSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKG5ldyBFcnJvcihgRmFpbGVkIHRvIGZvY3VzIGVkaXRvcjogJHtlcnJvci5tZXNzYWdlfWApKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiaGFuZGxlIGJlaGF2aW9yIGV2ZW50XCI6ICh7XG4gICAgICBjb250ZXh0LFxuICAgICAgZXZlbnQsXG4gICAgICBzZWxmXG4gICAgfSkgPT4ge1xuICAgICAgYXNzZXJ0RXZlbnQoZXZlbnQsIFtcImJlaGF2aW9yIGV2ZW50XCJdKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGJlaGF2aW9ycyA9IFsuLi5jb250ZXh0LmJlaGF2aW9ycy52YWx1ZXMoKV0ubWFwKChjb25maWcpID0+IGNvbmZpZy5iZWhhdmlvcik7XG4gICAgICAgIHBlcmZvcm1FdmVudCh7XG4gICAgICAgICAgbW9kZTogXCJzZW5kXCIsXG4gICAgICAgICAgYmVoYXZpb3JzLFxuICAgICAgICAgIHJlbWFpbmluZ0V2ZW50QmVoYXZpb3JzOiBiZWhhdmlvcnMsXG4gICAgICAgICAgZXZlbnQ6IGV2ZW50LmJlaGF2aW9yRXZlbnQsXG4gICAgICAgICAgZWRpdG9yOiBldmVudC5lZGl0b3IsXG4gICAgICAgICAga2V5R2VuZXJhdG9yOiBjb250ZXh0LmtleUdlbmVyYXRvcixcbiAgICAgICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hLFxuICAgICAgICAgIGdldFNuYXBzaG90OiAoKSA9PiBjcmVhdGVFZGl0b3JTbmFwc2hvdCh7XG4gICAgICAgICAgICBjb252ZXJ0ZXJzOiBbLi4uY29udGV4dC5jb252ZXJ0ZXJzXSxcbiAgICAgICAgICAgIGVkaXRvcjogZXZlbnQuZWRpdG9yLFxuICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBjb250ZXh0LmtleUdlbmVyYXRvcixcbiAgICAgICAgICAgIHJlYWRPbmx5OiBzZWxmLmdldFNuYXBzaG90KCkubWF0Y2hlcyh7XG4gICAgICAgICAgICAgIFwiZWRpdCBtb2RlXCI6IFwicmVhZCBvbmx5XCJcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG5hdGl2ZUV2ZW50OiBldmVudC5uYXRpdmVFdmVudCxcbiAgICAgICAgICBzZW5kQmFjazogKGV2ZW50U2VudEJhY2spID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudFNlbnRCYWNrLnR5cGUgPT09IFwic2V0IGRyYWcgZ2hvc3RcIikge1xuICAgICAgICAgICAgICBzZWxmLnNlbmQoZXZlbnRTZW50QmFjayk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuc2VuZChyZXJvdXRlRXh0ZXJuYWxCZWhhdmlvckV2ZW50KHtcbiAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50U2VudEJhY2ssXG4gICAgICAgICAgICAgIHNsYXRlRWRpdG9yOiBldmVudC5lZGl0b3JcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihuZXcgRXJyb3IoYFJhaXNpbmcgXCIke2V2ZW50LmJlaGF2aW9yRXZlbnQudHlwZX1cIiBmYWlsZWQgZHVlIHRvOiAke2Vycm9yLm1lc3NhZ2V9YCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJzb3J0IGJlaGF2aW9yc1wiOiBhc3NpZ24oe1xuICAgICAgYmVoYXZpb3JzOiAoe1xuICAgICAgICBjb250ZXh0XG4gICAgICB9KSA9PiBjb250ZXh0LmJlaGF2aW9yc1NvcnRlZCA/IGNvbnRleHQuYmVoYXZpb3JzIDogbmV3IFNldChzb3J0QnlQcmlvcml0eShbLi4uY29udGV4dC5iZWhhdmlvcnMudmFsdWVzKCldKSksXG4gICAgICBiZWhhdmlvcnNTb3J0ZWQ6ICEwXG4gICAgfSlcbiAgfSxcbiAgZ3VhcmRzOiB7XG4gICAgXCJzbGF0ZSBpcyBidXN5XCI6ICh7XG4gICAgICBjb250ZXh0XG4gICAgfSkgPT4gY29udGV4dC5zbGF0ZUVkaXRvciA/IGNvbnRleHQuc2xhdGVFZGl0b3Iub3BlcmF0aW9ucy5sZW5ndGggPiAwIDogITEsXG4gICAgXCJzbGF0ZSBpcyBub3JtYWxpemluZyBub2RlXCI6ICh7XG4gICAgICBjb250ZXh0XG4gICAgfSkgPT4gY29udGV4dC5zbGF0ZUVkaXRvciA/IGNvbnRleHQuc2xhdGVFZGl0b3IuaXNOb3JtYWxpemluZ05vZGUgOiAhMVxuICB9XG59KS5jcmVhdGVNYWNoaW5lKHtcbiAgaWQ6IFwiZWRpdG9yXCIsXG4gIGNvbnRleHQ6ICh7XG4gICAgaW5wdXRcbiAgfSkgPT4gKHtcbiAgICBiZWhhdmlvcnM6IG5ldyBTZXQoY29yZUJlaGF2aW9yc0NvbmZpZyksXG4gICAgYmVoYXZpb3JzU29ydGVkOiAhMSxcbiAgICBjb252ZXJ0ZXJzOiBuZXcgU2V0KGlucHV0LmNvbnZlcnRlcnMgPz8gW10pLFxuICAgIGdldExlZ2FjeVNjaGVtYTogaW5wdXQuZ2V0TGVnYWN5U2NoZW1hLFxuICAgIGtleUdlbmVyYXRvcjogaW5wdXQua2V5R2VuZXJhdG9yLFxuICAgIHBlbmRpbmdFdmVudHM6IFtdLFxuICAgIHBlbmRpbmdJbmNvbWluZ1BhdGNoZXNFdmVudHM6IFtdLFxuICAgIHNjaGVtYTogaW5wdXQuc2NoZW1hLFxuICAgIHNlbGVjdGlvbjogbnVsbCxcbiAgICBpbml0aWFsUmVhZE9ubHk6IGlucHV0LnJlYWRPbmx5ID8/ICExLFxuICAgIGluaXRpYWxWYWx1ZTogaW5wdXQuaW5pdGlhbFZhbHVlXG4gIH0pLFxuICBvbjoge1xuICAgIFwiYWRkIGJlaGF2aW9yXCI6IHtcbiAgICAgIGFjdGlvbnM6IFwiYWRkIGJlaGF2aW9yIHRvIGNvbnRleHRcIlxuICAgIH0sXG4gICAgXCJyZW1vdmUgYmVoYXZpb3JcIjoge1xuICAgICAgYWN0aW9uczogXCJyZW1vdmUgYmVoYXZpb3IgZnJvbSBjb250ZXh0XCJcbiAgICB9LFxuICAgIFwiYWRkIHNsYXRlIGVkaXRvclwiOiB7XG4gICAgICBhY3Rpb25zOiBcImFkZCBzbGF0ZSBlZGl0b3IgdG8gY29udGV4dFwiXG4gICAgfSxcbiAgICBcInVwZGF0ZSBzZWxlY3Rpb25cIjoge1xuICAgICAgYWN0aW9uczogW2Fzc2lnbih7XG4gICAgICAgIHNlbGVjdGlvbjogKHtcbiAgICAgICAgICBldmVudFxuICAgICAgICB9KSA9PiBldmVudC5zZWxlY3Rpb25cbiAgICAgIH0pLCBlbWl0KCh7XG4gICAgICAgIGV2ZW50XG4gICAgICB9KSA9PiAoe1xuICAgICAgICAuLi5ldmVudCxcbiAgICAgICAgdHlwZTogXCJzZWxlY3Rpb25cIlxuICAgICAgfSkpXVxuICAgIH0sXG4gICAgXCJzZXQgZHJhZyBnaG9zdFwiOiB7XG4gICAgICBhY3Rpb25zOiBhc3NpZ24oe1xuICAgICAgICBkcmFnR2hvc3Q6ICh7XG4gICAgICAgICAgZXZlbnRcbiAgICAgICAgfSkgPT4gZXZlbnQuZ2hvc3RcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuICB0eXBlOiBcInBhcmFsbGVsXCIsXG4gIHN0YXRlczoge1xuICAgIFwiZWRpdCBtb2RlXCI6IHtcbiAgICAgIGluaXRpYWw6IFwicmVhZCBvbmx5XCIsXG4gICAgICBzdGF0ZXM6IHtcbiAgICAgICAgXCJyZWFkIG9ubHlcIjoge1xuICAgICAgICAgIGluaXRpYWw6IFwiZGV0ZXJtaW5lIGluaXRpYWwgZWRpdCBtb2RlXCIsXG4gICAgICAgICAgb246IHtcbiAgICAgICAgICAgIFwiYmVoYXZpb3IgZXZlbnRcIjoge1xuICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJzb3J0IGJlaGF2aW9yc1wiLCBcImhhbmRsZSBiZWhhdmlvciBldmVudFwiXSxcbiAgICAgICAgICAgICAgZ3VhcmQ6ICh7XG4gICAgICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICAgICAgfSkgPT4gZXZlbnQuYmVoYXZpb3JFdmVudC50eXBlID09PSBcImNsaXBib2FyZC5jb3B5XCIgfHwgZXZlbnQuYmVoYXZpb3JFdmVudC50eXBlID09PSBcIm1vdXNlLmNsaWNrXCIgfHwgZXZlbnQuYmVoYXZpb3JFdmVudC50eXBlID09PSBcInNlcmlhbGl6ZVwiIHx8IGV2ZW50LmJlaGF2aW9yRXZlbnQudHlwZSA9PT0gXCJzZXJpYWxpemF0aW9uLmZhaWx1cmVcIiB8fCBldmVudC5iZWhhdmlvckV2ZW50LnR5cGUgPT09IFwic2VyaWFsaXphdGlvbi5zdWNjZXNzXCIgfHwgZXZlbnQuYmVoYXZpb3JFdmVudC50eXBlID09PSBcInNlbGVjdFwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdGF0ZXM6IHtcbiAgICAgICAgICAgIFwiZGV0ZXJtaW5lIGluaXRpYWwgZWRpdCBtb2RlXCI6IHtcbiAgICAgICAgICAgICAgZW50cnk6IFsoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVidWckNChcImVudHJ5OiBlZGl0IG1vZGUtPnJlYWQgb25seS0+ZGV0ZXJtaW5lIGluaXRpYWwgZWRpdCBtb2RlXCIpO1xuICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgZXhpdDogWygpID0+IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZXhpdDogZWRpdCBtb2RlLT5yZWFkIG9ubHktPmRldGVybWluZSBpbml0aWFsIGVkaXQgbW9kZVwiKTtcbiAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgXCJkb25lIHN5bmNpbmcgdmFsdWVcIjogW3tcbiAgICAgICAgICAgICAgICAgIHRhcmdldDogXCIjZWRpdG9yLmVkaXQgbW9kZS5yZWFkIG9ubHkucmVhZCBvbmx5XCIsXG4gICAgICAgICAgICAgICAgICBndWFyZDogKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dFxuICAgICAgICAgICAgICAgICAgfSkgPT4gY29udGV4dC5pbml0aWFsUmVhZE9ubHlcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiI2VkaXRvci5lZGl0IG1vZGUuZWRpdGFibGVcIlxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInJlYWQgb25seVwiOiB7XG4gICAgICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJlbnRyeTogZWRpdCBtb2RlLT5yZWFkIG9ubHktPnJlYWQgb25seVwiKTtcbiAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVidWckNChcImV4aXQ6IGVkaXQgbW9kZS0+cmVhZCBvbmx5LT5yZWFkIG9ubHlcIik7XG4gICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgICAgIFwidXBkYXRlIHJlYWRPbmx5XCI6IHtcbiAgICAgICAgICAgICAgICAgIGd1YXJkOiAoe1xuICAgICAgICAgICAgICAgICAgICBldmVudFxuICAgICAgICAgICAgICAgICAgfSkgPT4gIWV2ZW50LnJlYWRPbmx5LFxuICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBcIiNlZGl0b3IuZWRpdCBtb2RlLmVkaXRhYmxlXCIsXG4gICAgICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJlbWl0IGVkaXRhYmxlXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlZGl0YWJsZToge1xuICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICBcInVwZGF0ZSByZWFkT25seVwiOiB7XG4gICAgICAgICAgICAgIGd1YXJkOiAoe1xuICAgICAgICAgICAgICAgIGV2ZW50XG4gICAgICAgICAgICAgIH0pID0+IGV2ZW50LnJlYWRPbmx5LFxuICAgICAgICAgICAgICB0YXJnZXQ6IFwiI2VkaXRvci5lZGl0IG1vZGUucmVhZCBvbmx5LnJlYWQgb25seVwiLFxuICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJlbWl0IHJlYWQgb25seVwiXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiYmVoYXZpb3IgZXZlbnRcIjoge1xuICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJzb3J0IGJlaGF2aW9yc1wiLCBcImhhbmRsZSBiZWhhdmlvciBldmVudFwiXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJsdXI6IHtcbiAgICAgICAgICAgICAgYWN0aW9uczogXCJoYW5kbGUgYmx1clwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcIi5mb2N1c2luZ1wiLFxuICAgICAgICAgICAgICBhY3Rpb25zOiBbYXNzaWduKHtcbiAgICAgICAgICAgICAgICBzbGF0ZUVkaXRvcjogKHtcbiAgICAgICAgICAgICAgICAgIGV2ZW50XG4gICAgICAgICAgICAgICAgfSkgPT4gZXZlbnQuZWRpdG9yXG4gICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5pdGlhbDogXCJpZGxlXCIsXG4gICAgICAgICAgc3RhdGVzOiB7XG4gICAgICAgICAgICBpZGxlOiB7XG4gICAgICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJlbnRyeTogZWRpdCBtb2RlLT5lZGl0YWJsZS0+aWRsZVwiKTtcbiAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVidWckNChcImV4aXQ6IGVkaXQgbW9kZS0+ZWRpdGFibGUtaWRsZVwiKTtcbiAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgZHJhZ3N0YXJ0OiB7XG4gICAgICAgICAgICAgICAgICBhY3Rpb25zOiBbYXNzaWduKHtcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWxEcmFnOiAoe1xuICAgICAgICAgICAgICAgICAgICAgIGV2ZW50XG4gICAgICAgICAgICAgICAgICAgIH0pID0+ICh7XG4gICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBldmVudC5vcmlnaW5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH0pXSxcbiAgICAgICAgICAgICAgICAgIHRhcmdldDogXCJkcmFnZ2luZyBpbnRlcm5hbGx5XCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb2N1c2luZzoge1xuICAgICAgICAgICAgICBpbml0aWFsOiBcImNoZWNraW5nIGlmIGJ1c3lcIixcbiAgICAgICAgICAgICAgc3RhdGVzOiB7XG4gICAgICAgICAgICAgICAgXCJjaGVja2luZyBpZiBidXN5XCI6IHtcbiAgICAgICAgICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZW50cnk6IGVkaXQgbW9kZS0+ZWRpdGFibGUtPmZvY3VzaW5nLT5jaGVja2luZyBpZiBidXN5XCIpO1xuICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICBleGl0OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZXhpdDogZWRpdCBtb2RlLT5lZGl0YWJsZS0+Zm9jdXNpbmctPmNoZWNraW5nIGlmIGJ1c3lcIik7XG4gICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgIGFsd2F5czogW3tcbiAgICAgICAgICAgICAgICAgICAgZ3VhcmQ6IFwic2xhdGUgaXMgYnVzeVwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiYnVzeVwiXG4gICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldDogXCIjZWRpdG9yLmVkaXQgbW9kZS5lZGl0YWJsZS5pZGxlXCIsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFtcImhhbmRsZSBmb2N1c1wiXVxuICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJ1c3k6IHtcbiAgICAgICAgICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZW50cnk6IGVkaXQgbW9kZS0+ZWRpdGFibGUtPmZvY3VzaW5nLWJ1c3lcIik7XG4gICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJleGl0OiBlZGl0IG1vZGUtPmVkaXRhYmxlLT5mb2N1c2luZy0+YnVzeVwiKTtcbiAgICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgICAgYWZ0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgMTA6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiY2hlY2tpbmcgaWYgYnVzeVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImRyYWdnaW5nIGludGVybmFsbHlcIjoge1xuICAgICAgICAgICAgICBlbnRyeTogWygpID0+IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZW50cnk6IGVkaXQgbW9kZS0+ZWRpdGFibGUtPmRyYWdnaW5nIGludGVybmFsbHlcIik7XG4gICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICBleGl0OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJleGl0OiBlZGl0IG1vZGUtPmVkaXRhYmxlLT5kcmFnZ2luZyBpbnRlcm5hbGx5XCIpO1xuICAgICAgICAgICAgICB9LCAoe1xuICAgICAgICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgICAgICAgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LmRyYWdHaG9zdClcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuZHJhZ0dob3N0LnBhcmVudE5vZGU/LnJlbW92ZUNoaWxkKGNvbnRleHQuZHJhZ0dob3N0KTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IobmV3IEVycm9yKGBSZW1vdmluZyB0aGUgZHJhZyBnaG9zdCBmYWlsZWQgZHVlIHRvOiAke2Vycm9yLm1lc3NhZ2V9YCkpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LCBhc3NpZ24oe1xuICAgICAgICAgICAgICAgIGRyYWdHaG9zdDogdm9pZCAwXG4gICAgICAgICAgICAgIH0pLCBhc3NpZ24oe1xuICAgICAgICAgICAgICAgIGludGVybmFsRHJhZzogdm9pZCAwXG4gICAgICAgICAgICAgIH0pXSxcbiAgICAgICAgICAgICAgdGFnczogW1wiZHJhZ2dpbmcgaW50ZXJuYWxseVwiXSxcbiAgICAgICAgICAgICAgb246IHtcbiAgICAgICAgICAgICAgICBkcmFnZW5kOiB7XG4gICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiaWRsZVwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkcm9wOiB7XG4gICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiaWRsZVwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBzZXR1cDoge1xuICAgICAgaW5pdGlhbDogXCJzZXR0aW5nIHVwXCIsXG4gICAgICBzdGF0ZXM6IHtcbiAgICAgICAgXCJzZXR0aW5nIHVwXCI6IHtcbiAgICAgICAgICBlbnRyeTogWygpID0+IHtcbiAgICAgICAgICAgIGRlYnVnJDQoXCJlbnRyeTogc2V0dXAtPnNldHRpbmcgdXBcIik7XG4gICAgICAgICAgfV0sXG4gICAgICAgICAgZXhpdDogWygpID0+IHtcbiAgICAgICAgICAgIGRlYnVnJDQoXCJleGl0OiBzZXR1cC0+c2V0dGluZyB1cFwiKTtcbiAgICAgICAgICB9LCBcImVtaXQgcmVhZHlcIiwgXCJlbWl0IHBlbmRpbmcgaW5jb21pbmcgcGF0Y2hlc1wiLCBcImNsZWFyIHBlbmRpbmcgaW5jb21pbmcgcGF0Y2hlc1wiXSxcbiAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgXCJpbnRlcm5hbC5wYXRjaFwiOiB7XG4gICAgICAgICAgICAgIGFjdGlvbnM6IFwiZGVmZXIgZXZlbnRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG11dGF0aW9uOiB7XG4gICAgICAgICAgICAgIGFjdGlvbnM6IFwiZGVmZXIgZXZlbnRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZG9uZSBzeW5jaW5nIHZhbHVlXCI6IHtcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcInNldCB1cFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF0Y2hlczoge1xuICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJkZWZlciBpbmNvbWluZyBwYXRjaGVzXCJdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcInNldCB1cFwiOiB7XG4gICAgICAgICAgdHlwZTogXCJwYXJhbGxlbFwiLFxuICAgICAgICAgIHN0YXRlczoge1xuICAgICAgICAgICAgXCJ2YWx1ZSBzeW5jXCI6IHtcbiAgICAgICAgICAgICAgaW5pdGlhbDogXCJpZGxlXCIsXG4gICAgICAgICAgICAgIHN0YXRlczoge1xuICAgICAgICAgICAgICAgIGlkbGU6IHtcbiAgICAgICAgICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZW50cnk6IHNldHVwLT5zZXQgdXAtPnZhbHVlIHN5bmMtPmlkbGVcIik7XG4gICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJleGl0OiBzZXR1cC0+c2V0IHVwLT52YWx1ZSBzeW5jLT5pZGxlXCIpO1xuICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgICAgICAgICBwYXRjaGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgYWN0aW9uczogW2VtaXQoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50XG4gICAgICAgICAgICAgICAgICAgICAgfSkgPT4gZXZlbnQpXVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcInN5bmNpbmcgdmFsdWVcIjoge1xuICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogXCJzeW5jaW5nIHZhbHVlXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJzeW5jaW5nIHZhbHVlXCI6IHtcbiAgICAgICAgICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1ZyQ0KFwiZW50cnk6IHNldHVwLT5zZXQgdXAtPnZhbHVlIHN5bmMtPnN5bmNpbmcgdmFsdWVcIik7XG4gICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJleGl0OiBzZXR1cC0+c2V0IHVwLT52YWx1ZSBzeW5jLT5zeW5jaW5nIHZhbHVlXCIpO1xuICAgICAgICAgICAgICAgICAgfSwgXCJlbWl0IHBlbmRpbmcgaW5jb21pbmcgcGF0Y2hlc1wiLCBcImNsZWFyIHBlbmRpbmcgaW5jb21pbmcgcGF0Y2hlc1wiXSxcbiAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhdGNoZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJkZWZlciBpbmNvbWluZyBwYXRjaGVzXCJdXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwiZG9uZSBzeW5jaW5nIHZhbHVlXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiaWRsZVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3cml0aW5nOiB7XG4gICAgICAgICAgICAgIGluaXRpYWw6IFwicHJpc3RpbmVcIixcbiAgICAgICAgICAgICAgc3RhdGVzOiB7XG4gICAgICAgICAgICAgICAgcHJpc3RpbmU6IHtcbiAgICAgICAgICAgICAgICAgIGluaXRpYWw6IFwiaWRsZVwiLFxuICAgICAgICAgICAgICAgICAgc3RhdGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICBlbnRyeTogWygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJlbnRyeTogc2V0dXAtPnNldCB1cC0+d3JpdGluZy0+cHJpc3RpbmUtPmlkbGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgICAgZXhpdDogWygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnJDQoXCJleGl0OiBzZXR1cC0+c2V0IHVwLT53cml0aW5nLT5wcmlzdGluZS0+aWRsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnRlcm5hbC5wYXRjaFwiOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICBndWFyZDogXCJzbGF0ZSBpcyBub3JtYWxpemluZyBub2RlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFwiZGVmZXIgZXZlbnRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zOiBcImRlZmVyIGV2ZW50XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogXCIjZWRpdG9yLnNldHVwLnNldCB1cC53cml0aW5nLmRpcnR5XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRpb246IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGd1YXJkOiBcInNsYXRlIGlzIG5vcm1hbGl6aW5nIG5vZGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uczogXCJkZWZlciBldmVudFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFwiZGVmZXIgZXZlbnRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBcIiNlZGl0b3Iuc2V0dXAuc2V0IHVwLndyaXRpbmcuZGlydHlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpcnR5OiB7XG4gICAgICAgICAgICAgICAgICBlbnRyeTogWygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWckNChcImVudHJ5OiBzZXR1cC0+c2V0IHVwLT53cml0aW5nLT5kaXJ0eVwiKTtcbiAgICAgICAgICAgICAgICAgIH0sIFwiZW1pdCBwZW5kaW5nIGV2ZW50c1wiLCBcImNsZWFyIHBlbmRpbmcgZXZlbnRzXCJdLFxuICAgICAgICAgICAgICAgICAgZXhpdDogWygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWckNChcImV4aXQ6IHNldHVwLT5zZXQgdXAtPndyaXRpbmctPmRpcnR5XCIpO1xuICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgICAgICAgICBcImludGVybmFsLnBhdGNoXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zOiBcImVtaXQgcGF0Y2ggZXZlbnRcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFwiZW1pdCBtdXRhdGlvbiBldmVudFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pLCBkZWJ1ZyQzID0gZGVidWdXaXRoTmFtZShcIm11dGF0aW9uLW1hY2hpbmVcIiksIG11dGF0aW9uTWFjaGluZSA9IHNldHVwKHtcbiAgdHlwZXM6IHtcbiAgICBjb250ZXh0OiB7fSxcbiAgICBldmVudHM6IHt9LFxuICAgIGlucHV0OiB7fSxcbiAgICBlbWl0dGVkOiB7fVxuICB9LFxuICBhY3Rpb25zOiB7XG4gICAgXCJhc3NpZ24gcmVhZE9ubHlcIjogYXNzaWduKHtcbiAgICAgIHJlYWRPbmx5OiAoe1xuICAgICAgICBjb250ZXh0LFxuICAgICAgICBldmVudFxuICAgICAgfSkgPT4gZXZlbnQudHlwZSA9PT0gXCJ1cGRhdGUgcmVhZE9ubHlcIiA/IGV2ZW50LnJlYWRPbmx5IDogY29udGV4dC5yZWFkT25seVxuICAgIH0pLFxuICAgIFwiZW1pdCBwYXRjaFwiOiBlbWl0KCh7XG4gICAgICBldmVudFxuICAgIH0pID0+IChhc3NlcnRFdmVudChldmVudCwgXCJwYXRjaFwiKSwge1xuICAgICAgdHlwZTogXCJwYXRjaFwiLFxuICAgICAgcGF0Y2g6IGV2ZW50LnBhdGNoXG4gICAgfSkpLFxuICAgIFwiZW1pdCBoYXMgcGVuZGluZyBtdXRhdGlvbnNcIjogZW1pdCh7XG4gICAgICB0eXBlOiBcImhhcyBwZW5kaW5nIG11dGF0aW9uc1wiXG4gICAgfSksXG4gICAgXCJlbWl0IG11dGF0aW9uc1wiOiBlbnF1ZXVlQWN0aW9ucygoe1xuICAgICAgY29udGV4dCxcbiAgICAgIGVucXVldWVcbiAgICB9KSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IGJ1bGsgb2YgY29udGV4dC5wZW5kaW5nTXV0YXRpb25zKVxuICAgICAgICBlbnF1ZXVlLmVtaXQoe1xuICAgICAgICAgIHR5cGU6IFwibXV0YXRpb25cIixcbiAgICAgICAgICBwYXRjaGVzOiBidWxrLnBhdGNoZXMsXG4gICAgICAgICAgc25hcHNob3Q6IGJ1bGsudmFsdWVcbiAgICAgICAgfSk7XG4gICAgfSksXG4gICAgXCJjbGVhciBwZW5kaW5nIG11dGF0aW9uc1wiOiBhc3NpZ24oe1xuICAgICAgcGVuZGluZ011dGF0aW9uczogW11cbiAgICB9KSxcbiAgICBcImRlZmVyIG11dGF0aW9uXCI6IGFzc2lnbih7XG4gICAgICBwZW5kaW5nTXV0YXRpb25zOiAoe1xuICAgICAgICBjb250ZXh0LFxuICAgICAgICBldmVudFxuICAgICAgfSkgPT4ge1xuICAgICAgICBpZiAoYXNzZXJ0RXZlbnQoZXZlbnQsIFwicGF0Y2hcIiksIGNvbnRleHQucGVuZGluZ011dGF0aW9ucy5sZW5ndGggPT09IDApXG4gICAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICBvcGVyYXRpb25JZDogZXZlbnQub3BlcmF0aW9uSWQsXG4gICAgICAgICAgICB2YWx1ZTogZXZlbnQudmFsdWUsXG4gICAgICAgICAgICBwYXRjaGVzOiBbZXZlbnQucGF0Y2hdXG4gICAgICAgICAgfV07XG4gICAgICAgIGNvbnN0IGxhc3RCdWxrID0gY29udGV4dC5wZW5kaW5nTXV0YXRpb25zLmF0KC0xKTtcbiAgICAgICAgcmV0dXJuIGxhc3RCdWxrICYmIGxhc3RCdWxrLm9wZXJhdGlvbklkID09PSBldmVudC5vcGVyYXRpb25JZCA/IGNvbnRleHQucGVuZGluZ011dGF0aW9ucy5zbGljZSgwLCAtMSkuY29uY2F0KHtcbiAgICAgICAgICB2YWx1ZTogZXZlbnQudmFsdWUsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGxhc3RCdWxrLm9wZXJhdGlvbklkLFxuICAgICAgICAgIHBhdGNoZXM6IFsuLi5sYXN0QnVsay5wYXRjaGVzLCBldmVudC5wYXRjaF1cbiAgICAgICAgfSkgOiBjb250ZXh0LnBlbmRpbmdNdXRhdGlvbnMuY29uY2F0KHtcbiAgICAgICAgICB2YWx1ZTogZXZlbnQudmFsdWUsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGV2ZW50Lm9wZXJhdGlvbklkLFxuICAgICAgICAgIHBhdGNoZXM6IFtldmVudC5wYXRjaF1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSksXG4gICAgXCJjbGVhciBwZW5kaW5nIHBhdGNoIGV2ZW50c1wiOiBhc3NpZ24oe1xuICAgICAgcGVuZGluZ1BhdGNoRXZlbnRzOiBbXVxuICAgIH0pLFxuICAgIFwiZGVmZXIgcGF0Y2hcIjogYXNzaWduKHtcbiAgICAgIHBlbmRpbmdQYXRjaEV2ZW50czogKHtcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IGV2ZW50LnR5cGUgPT09IFwicGF0Y2hcIiA/IFsuLi5jb250ZXh0LnBlbmRpbmdQYXRjaEV2ZW50cywgZXZlbnRdIDogY29udGV4dC5wZW5kaW5nUGF0Y2hFdmVudHNcbiAgICB9KSxcbiAgICBcImVtaXQgcGVuZGluZyBwYXRjaCBldmVudHNcIjogZW5xdWV1ZUFjdGlvbnMoKHtcbiAgICAgIGNvbnRleHQsXG4gICAgICBlbnF1ZXVlXG4gICAgfSkgPT4ge1xuICAgICAgZm9yIChjb25zdCBldmVudCBvZiBjb250ZXh0LnBlbmRpbmdQYXRjaEV2ZW50cylcbiAgICAgICAgZW5xdWV1ZS5lbWl0KGV2ZW50KTtcbiAgICB9KVxuICB9LFxuICBhY3RvcnM6IHtcbiAgICBcInR5cGUgbGlzdGVuZXJcIjogZnJvbUNhbGxiYWNrKCh7XG4gICAgICBpbnB1dCxcbiAgICAgIHNlbmRCYWNrXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxBcHBseSA9IGlucHV0LnNsYXRlRWRpdG9yLmFwcGx5O1xuICAgICAgcmV0dXJuIGlucHV0LnNsYXRlRWRpdG9yLmFwcGx5ID0gKG9wKSA9PiB7XG4gICAgICAgIG9wLnR5cGUgPT09IFwiaW5zZXJ0X3RleHRcIiB8fCBvcC50eXBlID09PSBcInJlbW92ZV90ZXh0XCIgPyBzZW5kQmFjayh7XG4gICAgICAgICAgdHlwZTogXCJ0eXBpbmdcIlxuICAgICAgICB9KSA6IHNlbmRCYWNrKHtcbiAgICAgICAgICB0eXBlOiBcIm5vdCB0eXBpbmdcIlxuICAgICAgICB9KSwgb3JpZ2luYWxBcHBseShvcCk7XG4gICAgICB9LCAoKSA9PiB7XG4gICAgICAgIGlucHV0LnNsYXRlRWRpdG9yLmFwcGx5ID0gb3JpZ2luYWxBcHBseTtcbiAgICAgIH07XG4gICAgfSksXG4gICAgXCJtdXRhdGlvbiBpbnRlcnZhbFwiOiBmcm9tQ2FsbGJhY2soKHtcbiAgICAgIHNlbmRCYWNrXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIHNlbmRCYWNrKHtcbiAgICAgICAgICB0eXBlOiBcImVtaXQgY2hhbmdlc1wiXG4gICAgICAgIH0pO1xuICAgICAgfSwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiID8gMjUwIDogMWUzKTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgfTtcbiAgICB9KVxuICB9LFxuICBndWFyZHM6IHtcbiAgICBcImlzIHJlYWQtb25seVwiOiAoe1xuICAgICAgY29udGV4dFxuICAgIH0pID0+IGNvbnRleHQucmVhZE9ubHksXG4gICAgXCJzbGF0ZSBpcyBub3JtYWxpemluZ1wiOiAoe1xuICAgICAgY29udGV4dFxuICAgIH0pID0+IEVkaXRvci5pc05vcm1hbGl6aW5nKGNvbnRleHQuc2xhdGVFZGl0b3IpXG4gIH0sXG4gIGRlbGF5czoge1xuICAgIFwidHlwZSBkZWJvdW5jZVwiOiAyNTBcbiAgfVxufSkuY3JlYXRlTWFjaGluZSh7XG4gIGlkOiBcIm11dGF0aW9uXCIsXG4gIGNvbnRleHQ6ICh7XG4gICAgaW5wdXRcbiAgfSkgPT4gKHtcbiAgICBwZW5kaW5nTXV0YXRpb25zOiBbXSxcbiAgICBwZW5kaW5nUGF0Y2hFdmVudHM6IFtdLFxuICAgIHJlYWRPbmx5OiBpbnB1dC5yZWFkT25seSxcbiAgICBzY2hlbWE6IGlucHV0LnNjaGVtYSxcbiAgICBzbGF0ZUVkaXRvcjogaW5wdXQuc2xhdGVFZGl0b3JcbiAgfSksXG4gIG9uOiB7XG4gICAgXCJ1cGRhdGUgcmVhZE9ubHlcIjoge1xuICAgICAgYWN0aW9uczogW1wiYXNzaWduIHJlYWRPbmx5XCJdXG4gICAgfVxuICB9LFxuICB0eXBlOiBcInBhcmFsbGVsXCIsXG4gIHN0YXRlczoge1xuICAgIHR5cGluZzoge1xuICAgICAgaW5pdGlhbDogXCJpZGxlXCIsXG4gICAgICBpbnZva2U6IHtcbiAgICAgICAgc3JjOiBcInR5cGUgbGlzdGVuZXJcIixcbiAgICAgICAgaW5wdXQ6ICh7XG4gICAgICAgICAgY29udGV4dFxuICAgICAgICB9KSA9PiAoe1xuICAgICAgICAgIHNsYXRlRWRpdG9yOiBjb250ZXh0LnNsYXRlRWRpdG9yXG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgc3RhdGVzOiB7XG4gICAgICAgIGlkbGU6IHtcbiAgICAgICAgICBlbnRyeTogWygpID0+IHtcbiAgICAgICAgICAgIGRlYnVnJDMoXCJlbnRyeTogdHlwaW5nLT5pZGxlXCIpO1xuICAgICAgICAgIH1dLFxuICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICBkZWJ1ZyQzKFwiZXhpdDogdHlwaW5nLT5pZGxlXCIpLCBkZWJ1ZyQzKFwiZW50cnk6IHR5cGluZy0+dHlwaW5nXCIpO1xuICAgICAgICAgIH1dLFxuICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICB0eXBpbmc6IHtcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcInR5cGluZ1wiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB0eXBpbmc6IHtcbiAgICAgICAgICBhZnRlcjoge1xuICAgICAgICAgICAgXCJ0eXBlIGRlYm91bmNlXCI6IHtcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcImlkbGVcIixcbiAgICAgICAgICAgICAgYWN0aW9uczogW3JhaXNlJDEoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiZW1pdCBjaGFuZ2VzXCJcbiAgICAgICAgICAgICAgfSksICgpID0+IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZyQzKFwiZXhpdDogdHlwaW5nLT50eXBpbmdcIik7XG4gICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgXCJub3QgdHlwaW5nXCI6IHtcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcImlkbGVcIixcbiAgICAgICAgICAgICAgYWN0aW9uczogW3JhaXNlJDEoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiZW1pdCBjaGFuZ2VzXCJcbiAgICAgICAgICAgICAgfSldXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHlwaW5nOiB7XG4gICAgICAgICAgICAgIHRhcmdldDogXCJ0eXBpbmdcIixcbiAgICAgICAgICAgICAgcmVlbnRlcjogITBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIG11dGF0aW9uczoge1xuICAgICAgaW5pdGlhbDogXCJpZGxlXCIsXG4gICAgICBzdGF0ZXM6IHtcbiAgICAgICAgaWRsZToge1xuICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgZGVidWckMyhcImVudHJ5OiBtdXRhdGlvbnMtPmlkbGVcIik7XG4gICAgICAgICAgfV0sXG4gICAgICAgICAgZXhpdDogWygpID0+IHtcbiAgICAgICAgICAgIGRlYnVnJDMoXCJleGl0OiBtdXRhdGlvbnMtPmlkbGVcIik7XG4gICAgICAgICAgfV0sXG4gICAgICAgICAgb246IHtcbiAgICAgICAgICAgIHBhdGNoOiBbe1xuICAgICAgICAgICAgICBndWFyZDogXCJpcyByZWFkLW9ubHlcIixcbiAgICAgICAgICAgICAgYWN0aW9uczogW1wiZGVmZXIgcGF0Y2hcIiwgXCJkZWZlciBtdXRhdGlvblwiXSxcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcImhhcyBwZW5kaW5nIG11dGF0aW9uc1wiXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgIGFjdGlvbnM6IFtcImVtaXQgcGF0Y2hcIiwgXCJkZWZlciBtdXRhdGlvblwiXSxcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcImhhcyBwZW5kaW5nIG11dGF0aW9uc1wiXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJoYXMgcGVuZGluZyBtdXRhdGlvbnNcIjoge1xuICAgICAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICAgICAgZGVidWckMyhcImVudHJ5OiBtdXRhdGlvbnMtPmhhcyBwZW5kaW5nIG11dGF0aW9uc1wiKTtcbiAgICAgICAgICB9LCBcImVtaXQgaGFzIHBlbmRpbmcgbXV0YXRpb25zXCJdLFxuICAgICAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgICAgICBkZWJ1ZyQzKFwiZXhpdDogbXV0YXRpb25zLT5oYXMgcGVuZGluZyBtdXRhdGlvbnNcIik7XG4gICAgICAgICAgfV0sXG4gICAgICAgICAgaW52b2tlOiB7XG4gICAgICAgICAgICBzcmM6IFwibXV0YXRpb24gaW50ZXJ2YWxcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgb246IHtcbiAgICAgICAgICAgIFwiZW1pdCBjaGFuZ2VzXCI6IHtcbiAgICAgICAgICAgICAgZ3VhcmQ6IGFuZChbbm90KFwiaXMgcmVhZC1vbmx5XCIpLCBcInNsYXRlIGlzIG5vcm1hbGl6aW5nXCJdKSxcbiAgICAgICAgICAgICAgdGFyZ2V0OiBcImlkbGVcIixcbiAgICAgICAgICAgICAgYWN0aW9uczogW1wiZW1pdCBwZW5kaW5nIHBhdGNoIGV2ZW50c1wiLCBcImNsZWFyIHBlbmRpbmcgcGF0Y2ggZXZlbnRzXCIsIFwiZW1pdCBtdXRhdGlvbnNcIiwgXCJjbGVhciBwZW5kaW5nIG11dGF0aW9uc1wiXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdGNoOiBbe1xuICAgICAgICAgICAgICBndWFyZDogXCJpcyByZWFkLW9ubHlcIixcbiAgICAgICAgICAgICAgYWN0aW9uczogW1wiZGVmZXIgcGF0Y2hcIiwgXCJkZWZlciBtdXRhdGlvblwiXVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJlbWl0IHBhdGNoXCIsIFwiZGVmZXIgbXV0YXRpb25cIl1cbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59KSwgcmVsYXlNYWNoaW5lID0gc2V0dXAoe1xuICB0eXBlczoge1xuICAgIGNvbnRleHQ6IHt9LFxuICAgIGV2ZW50czoge30sXG4gICAgZW1pdHRlZDoge31cbiAgfVxufSkuY3JlYXRlTWFjaGluZSh7XG4gIGlkOiBcInJlbGF5XCIsXG4gIGNvbnRleHQ6IHtcbiAgICBwcmV2U2VsZWN0aW9uOiBudWxsLFxuICAgIGxhc3RFdmVudFdhc0ZvY3VzZWQ6ICExXG4gIH0sXG4gIG9uOiB7XG4gICAgZm9jdXNlZDoge1xuICAgICAgYWN0aW9uczogW2Fzc2lnbih7XG4gICAgICAgIGxhc3RFdmVudFdhc0ZvY3VzZWQ6ICEwXG4gICAgICB9KSwgZW1pdCgoe1xuICAgICAgICBldmVudFxuICAgICAgfSkgPT4gZXZlbnQpXVxuICAgIH0sXG4gICAgc2VsZWN0aW9uOiBbe1xuICAgICAgZ3VhcmQ6ICh7XG4gICAgICAgIGNvbnRleHRcbiAgICAgIH0pID0+IGNvbnRleHQubGFzdEV2ZW50V2FzRm9jdXNlZCxcbiAgICAgIGFjdGlvbnM6IFthc3NpZ24oe1xuICAgICAgICBwcmV2U2VsZWN0aW9uOiAoe1xuICAgICAgICAgIGV2ZW50XG4gICAgICAgIH0pID0+IGV2ZW50LnNlbGVjdGlvblxuICAgICAgfSksIGVtaXQoKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IGV2ZW50KSwgYXNzaWduKHtcbiAgICAgICAgbGFzdEV2ZW50V2FzRm9jdXNlZDogITFcbiAgICAgIH0pXVxuICAgIH0sIHtcbiAgICAgIGd1YXJkOiAoe1xuICAgICAgICBjb250ZXh0LFxuICAgICAgICBldmVudFxuICAgICAgfSkgPT4gY29udGV4dC5wcmV2U2VsZWN0aW9uICE9PSBldmVudC5zZWxlY3Rpb24sXG4gICAgICBhY3Rpb25zOiBbYXNzaWduKHtcbiAgICAgICAgcHJldlNlbGVjdGlvbjogKHtcbiAgICAgICAgICBldmVudFxuICAgICAgICB9KSA9PiBldmVudC5zZWxlY3Rpb25cbiAgICAgIH0pLCBlbWl0KCh7XG4gICAgICAgIGV2ZW50XG4gICAgICB9KSA9PiBldmVudCksIGFzc2lnbih7XG4gICAgICAgIGxhc3RFdmVudFdhc0ZvY3VzZWQ6ICExXG4gICAgICB9KV1cbiAgICB9XSxcbiAgICBcIipcIjoge1xuICAgICAgYWN0aW9uczogW2VtaXQoKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IGV2ZW50KSwgYXNzaWduKHtcbiAgICAgICAgbGFzdEV2ZW50V2FzRm9jdXNlZDogITFcbiAgICAgIH0pXVxuICAgIH1cbiAgfVxufSk7XG5mdW5jdGlvbiB2YWxpZGF0ZVZhbHVlKHZhbHVlLCB0eXBlcywga2V5R2VuZXJhdG9yKSB7XG4gIGxldCByZXNvbHV0aW9uID0gbnVsbCwgdmFsaWQgPSAhMDtcbiAgY29uc3QgdmFsaWRDaGlsZFR5cGVzID0gW3R5cGVzLnNwYW4ubmFtZSwgLi4udHlwZXMuaW5saW5lT2JqZWN0cy5tYXAoKHQpID0+IHQubmFtZSldLCB2YWxpZEJsb2NrVHlwZXMgPSBbdHlwZXMuYmxvY2submFtZSwgLi4udHlwZXMuYmxvY2tPYmplY3RzLm1hcCgodCkgPT4gdC5uYW1lKV07XG4gIHJldHVybiB2YWx1ZSA9PT0gdm9pZCAwID8ge1xuICAgIHZhbGlkOiAhMCxcbiAgICByZXNvbHV0aW9uOiBudWxsLFxuICAgIHZhbHVlXG4gIH0gOiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgdmFsdWUubGVuZ3RoID09PSAwID8ge1xuICAgIHZhbGlkOiAhMSxcbiAgICByZXNvbHV0aW9uOiB7XG4gICAgICBwYXRjaGVzOiBbdW5zZXQoW10pXSxcbiAgICAgIGRlc2NyaXB0aW9uOiBcIkVkaXRvciB2YWx1ZSBtdXN0IGJlIGFuIGFycmF5IG9mIFBvcnRhYmxlIFRleHQgYmxvY2tzLCBvciB1bmRlZmluZWQuXCIsXG4gICAgICBhY3Rpb246IFwiVW5zZXQgdGhlIHZhbHVlXCIsXG4gICAgICBpdGVtOiB2YWx1ZSxcbiAgICAgIGkxOG46IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5ub3QtYW4tYXJyYXkuZGVzY3JpcHRpb25cIixcbiAgICAgICAgYWN0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUubm90LWFuLWFycmF5LmFjdGlvblwiXG4gICAgICB9XG4gICAgfSxcbiAgICB2YWx1ZVxuICB9IDogKHZhbHVlLnNvbWUoKGJsaywgaW5kZXgpID0+IHtcbiAgICBpZiAodHlwZW9mIGJsayAhPSBcIm9iamVjdFwiIHx8IGJsayA9PT0gbnVsbClcbiAgICAgIHJldHVybiByZXNvbHV0aW9uID0ge1xuICAgICAgICBwYXRjaGVzOiBbdW5zZXQoW2luZGV4XSldLFxuICAgICAgICBkZXNjcmlwdGlvbjogYEJsb2NrIG11c3QgYmUgYW4gb2JqZWN0LCBnb3QgJHtTdHJpbmcoYmxrKX1gLFxuICAgICAgICBhY3Rpb246IFwiVW5zZXQgaW52YWxpZCBpdGVtXCIsXG4gICAgICAgIGl0ZW06IGJsayxcbiAgICAgICAgaTE4bjoge1xuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUubm90LWFuLW9iamVjdC5kZXNjcmlwdGlvblwiLFxuICAgICAgICAgIGFjdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLm5vdC1hbi1vYmplY3QuYWN0aW9uXCIsXG4gICAgICAgICAgdmFsdWVzOiB7XG4gICAgICAgICAgICBpbmRleFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgITA7XG4gICAgaWYgKCFibGsuX2tleSB8fCB0eXBlb2YgYmxrLl9rZXkgIT0gXCJzdHJpbmdcIilcbiAgICAgIHJldHVybiByZXNvbHV0aW9uID0ge1xuICAgICAgICBwYXRjaGVzOiBbc2V0KHtcbiAgICAgICAgICAuLi5ibGssXG4gICAgICAgICAgX2tleToga2V5R2VuZXJhdG9yKClcbiAgICAgICAgfSwgW2luZGV4XSldLFxuICAgICAgICBkZXNjcmlwdGlvbjogYEJsb2NrIGF0IGluZGV4ICR7aW5kZXh9IGlzIG1pc3NpbmcgcmVxdWlyZWQgX2tleS5gLFxuICAgICAgICBhY3Rpb246IFwiU2V0IHRoZSBibG9jayB3aXRoIGEgcmFuZG9tIF9rZXkgdmFsdWVcIixcbiAgICAgICAgaXRlbTogYmxrLFxuICAgICAgICBpMThuOiB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLWtleS5kZXNjcmlwdGlvblwiLFxuICAgICAgICAgIGFjdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLm1pc3Npbmcta2V5LmFjdGlvblwiLFxuICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sICEwO1xuICAgIGlmICghYmxrLl90eXBlIHx8ICF2YWxpZEJsb2NrVHlwZXMuaW5jbHVkZXMoYmxrLl90eXBlKSkge1xuICAgICAgaWYgKGJsay5fdHlwZSA9PT0gXCJibG9ja1wiKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRCbG9ja1R5cGVOYW1lID0gdHlwZXMuYmxvY2submFtZTtcbiAgICAgICAgcmV0dXJuIHJlc29sdXRpb24gPSB7XG4gICAgICAgICAgcGF0Y2hlczogW3NldCh7XG4gICAgICAgICAgICAuLi5ibGssXG4gICAgICAgICAgICBfdHlwZTogY3VycmVudEJsb2NrVHlwZU5hbWVcbiAgICAgICAgICB9LCBbe1xuICAgICAgICAgICAgX2tleTogYmxrLl9rZXlcbiAgICAgICAgICB9XSldLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBgQmxvY2sgd2l0aCBfa2V5ICcke2Jsay5fa2V5fScgaGFzIGludmFsaWQgdHlwZSBuYW1lICcke2Jsay5fdHlwZX0nLiBBY2NvcmRpbmcgdG8gdGhlIHNjaGVtYSwgdGhlIGJsb2NrIHR5cGUgbmFtZSBpcyAnJHtjdXJyZW50QmxvY2tUeXBlTmFtZX0nYCxcbiAgICAgICAgICBhY3Rpb246IGBVc2UgdHlwZSAnJHtjdXJyZW50QmxvY2tUeXBlTmFtZX0nYCxcbiAgICAgICAgICBpdGVtOiBibGssXG4gICAgICAgICAgaTE4bjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5pbmNvcnJlY3QtYmxvY2stdHlwZS5kZXNjcmlwdGlvblwiLFxuICAgICAgICAgICAgYWN0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUuaW5jb3JyZWN0LWJsb2NrLXR5cGUuYWN0aW9uXCIsXG4gICAgICAgICAgICB2YWx1ZXM6IHtcbiAgICAgICAgICAgICAga2V5OiBibGsuX2tleSxcbiAgICAgICAgICAgICAgZXhwZWN0ZWRUeXBlTmFtZTogY3VycmVudEJsb2NrVHlwZU5hbWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sICEwO1xuICAgICAgfVxuICAgICAgcmV0dXJuICFibGsuX3R5cGUgJiYgaXNUZXh0QmxvY2soe1xuICAgICAgICBzY2hlbWE6IHR5cGVzXG4gICAgICB9LCB7XG4gICAgICAgIC4uLmJsayxcbiAgICAgICAgX3R5cGU6IHR5cGVzLmJsb2NrLm5hbWVcbiAgICAgIH0pID8gKHJlc29sdXRpb24gPSB7XG4gICAgICAgIHBhdGNoZXM6IFtzZXQoe1xuICAgICAgICAgIC4uLmJsayxcbiAgICAgICAgICBfdHlwZTogdHlwZXMuYmxvY2submFtZVxuICAgICAgICB9LCBbe1xuICAgICAgICAgIF9rZXk6IGJsay5fa2V5XG4gICAgICAgIH1dKV0sXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgQmxvY2sgd2l0aCBfa2V5ICcke2Jsay5fa2V5fScgaXMgbWlzc2luZyBhIHR5cGUgbmFtZS4gQWNjb3JkaW5nIHRvIHRoZSBzY2hlbWEsIHRoZSBibG9jayB0eXBlIG5hbWUgaXMgJyR7dHlwZXMuYmxvY2submFtZX0nYCxcbiAgICAgICAgYWN0aW9uOiBgVXNlIHR5cGUgJyR7dHlwZXMuYmxvY2submFtZX0nYCxcbiAgICAgICAgaXRlbTogYmxrLFxuICAgICAgICBpMThuOiB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLWJsb2NrLXR5cGUuZGVzY3JpcHRpb25cIixcbiAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLWJsb2NrLXR5cGUuYWN0aW9uXCIsXG4gICAgICAgICAgdmFsdWVzOiB7XG4gICAgICAgICAgICBrZXk6IGJsay5fa2V5LFxuICAgICAgICAgICAgZXhwZWN0ZWRUeXBlTmFtZTogdHlwZXMuYmxvY2submFtZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgITApIDogYmxrLl90eXBlID8gKHJlc29sdXRpb24gPSB7XG4gICAgICAgIHBhdGNoZXM6IFt1bnNldChbe1xuICAgICAgICAgIF9rZXk6IGJsay5fa2V5XG4gICAgICAgIH1dKV0sXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgQmxvY2sgd2l0aCBfa2V5ICcke2Jsay5fa2V5fScgaGFzIGludmFsaWQgX3R5cGUgJyR7YmxrLl90eXBlfSdgLFxuICAgICAgICBhY3Rpb246IFwiUmVtb3ZlIHRoZSBibG9ja1wiLFxuICAgICAgICBpdGVtOiBibGssXG4gICAgICAgIGkxOG46IHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLmRpc2FsbG93ZWQtdHlwZS5kZXNjcmlwdGlvblwiLFxuICAgICAgICAgIGFjdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLmRpc2FsbG93ZWQtdHlwZS5hY3Rpb25cIixcbiAgICAgICAgICB2YWx1ZXM6IHtcbiAgICAgICAgICAgIGtleTogYmxrLl9rZXksXG4gICAgICAgICAgICB0eXBlTmFtZTogYmxrLl90eXBlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCAhMCkgOiAocmVzb2x1dGlvbiA9IHtcbiAgICAgICAgcGF0Y2hlczogW3Vuc2V0KFt7XG4gICAgICAgICAgX2tleTogYmxrLl9rZXlcbiAgICAgICAgfV0pXSxcbiAgICAgICAgZGVzY3JpcHRpb246IGBCbG9jayB3aXRoIF9rZXkgJyR7YmxrLl9rZXl9JyBpcyBtaXNzaW5nIGFuIF90eXBlIHByb3BlcnR5YCxcbiAgICAgICAgYWN0aW9uOiBcIlJlbW92ZSB0aGUgYmxvY2tcIixcbiAgICAgICAgaXRlbTogYmxrLFxuICAgICAgICBpMThuOiB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLXR5cGUuZGVzY3JpcHRpb25cIixcbiAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLXR5cGUuYWN0aW9uXCIsXG4gICAgICAgICAgdmFsdWVzOiB7XG4gICAgICAgICAgICBrZXk6IGJsay5fa2V5XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCAhMCk7XG4gICAgfVxuICAgIGlmIChibGsuX3R5cGUgPT09IHR5cGVzLmJsb2NrLm5hbWUpIHtcbiAgICAgIGNvbnN0IHRleHRCbG9jayA9IGJsaztcbiAgICAgIGlmICh0ZXh0QmxvY2suY2hpbGRyZW4gJiYgIUFycmF5LmlzQXJyYXkodGV4dEJsb2NrLmNoaWxkcmVuKSlcbiAgICAgICAgcmV0dXJuIHJlc29sdXRpb24gPSB7XG4gICAgICAgICAgcGF0Y2hlczogW3NldCh7XG4gICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgICB9LCBbe1xuICAgICAgICAgICAgX2tleTogdGV4dEJsb2NrLl9rZXlcbiAgICAgICAgICB9XSldLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBgVGV4dCBibG9jayB3aXRoIF9rZXkgJyR7dGV4dEJsb2NrLl9rZXl9JyBoYXMgYSBpbnZhbGlkIHJlcXVpcmVkIHByb3BlcnR5ICdjaGlsZHJlbicuYCxcbiAgICAgICAgICBhY3Rpb246IFwiUmVzZXQgdGhlIGNoaWxkcmVuIHByb3BlcnR5XCIsXG4gICAgICAgICAgaXRlbTogdGV4dEJsb2NrLFxuICAgICAgICAgIGkxOG46IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUubWlzc2luZy1vci1pbnZhbGlkLWNoaWxkcmVuLmRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLW9yLWludmFsaWQtY2hpbGRyZW4uYWN0aW9uXCIsXG4gICAgICAgICAgICB2YWx1ZXM6IHtcbiAgICAgICAgICAgICAga2V5OiB0ZXh0QmxvY2suX2tleVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSwgITA7XG4gICAgICBpZiAodGV4dEJsb2NrLmNoaWxkcmVuID09PSB2b2lkIDAgfHwgQXJyYXkuaXNBcnJheSh0ZXh0QmxvY2suY2hpbGRyZW4pICYmIHRleHRCbG9jay5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc3QgbmV3U3BhbiA9IHtcbiAgICAgICAgICBfdHlwZTogdHlwZXMuc3Bhbi5uYW1lLFxuICAgICAgICAgIF9rZXk6IGtleUdlbmVyYXRvcigpLFxuICAgICAgICAgIHRleHQ6IFwiXCIsXG4gICAgICAgICAgbWFya3M6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiByZXNvbHV0aW9uID0ge1xuICAgICAgICAgIGF1dG9SZXNvbHZlOiAhMCxcbiAgICAgICAgICBwYXRjaGVzOiBbc2V0SWZNaXNzaW5nKFtdLCBbe1xuICAgICAgICAgICAgX2tleTogYmxrLl9rZXlcbiAgICAgICAgICB9LCBcImNoaWxkcmVuXCJdKSwgaW5zZXJ0KFtuZXdTcGFuXSwgXCJhZnRlclwiLCBbe1xuICAgICAgICAgICAgX2tleTogYmxrLl9rZXlcbiAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIDBdKV0sXG4gICAgICAgICAgZGVzY3JpcHRpb246IGBDaGlsZHJlbiBmb3IgdGV4dCBibG9jayB3aXRoIF9rZXkgJyR7YmxrLl9rZXl9JyBpcyBlbXB0eS5gLFxuICAgICAgICAgIGFjdGlvbjogXCJJbnNlcnQgYW4gZW1wdHkgdGV4dFwiLFxuICAgICAgICAgIGl0ZW06IGJsayxcbiAgICAgICAgICBpMThuOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLmVtcHR5LWNoaWxkcmVuLmRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5lbXB0eS1jaGlsZHJlbi5hY3Rpb25cIixcbiAgICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgICBrZXk6IGJsay5fa2V5XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LCAhMDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGFsbFVzZWRNYXJrcyA9IFsuLi5uZXcgU2V0KHRleHRCbG9jay5jaGlsZHJlbi5maWx0ZXIoKGNoaWxkKSA9PiBpc1NwYW4oe1xuICAgICAgICBzY2hlbWE6IHR5cGVzXG4gICAgICB9LCBjaGlsZCkpLmZsYXRNYXAoKGNsZCkgPT4gY2xkLm1hcmtzIHx8IFtdKSldO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYmxrLm1hcmtEZWZzKSAmJiBibGsubWFya0RlZnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCB1bnVzZWRNYXJrRGVmcyA9IFsuLi5uZXcgU2V0KGJsay5tYXJrRGVmcy5tYXAoKGRlZikgPT4gZGVmLl9rZXkpLmZpbHRlcigoa2V5KSA9PiAhYWxsVXNlZE1hcmtzLmluY2x1ZGVzKGtleSkpKV07XG4gICAgICAgIGlmICh1bnVzZWRNYXJrRGVmcy5sZW5ndGggPiAwKVxuICAgICAgICAgIHJldHVybiByZXNvbHV0aW9uID0ge1xuICAgICAgICAgICAgYXV0b1Jlc29sdmU6ICEwLFxuICAgICAgICAgICAgcGF0Y2hlczogdW51c2VkTWFya0RlZnMubWFwKChtYXJrRGVmS2V5KSA9PiB1bnNldChbe1xuICAgICAgICAgICAgICBfa2V5OiBibGsuX2tleVxuICAgICAgICAgICAgfSwgXCJtYXJrRGVmc1wiLCB7XG4gICAgICAgICAgICAgIF9rZXk6IG1hcmtEZWZLZXlcbiAgICAgICAgICAgIH1dKSksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYEJsb2NrIGNvbnRhaW5zIG9ycGhhbmVkIGRhdGEgKHVudXNlZCBtYXJrIGRlZmluaXRpb25zKTogJHt1bnVzZWRNYXJrRGVmcy5qb2luKFwiLCBcIil9LmAsXG4gICAgICAgICAgICBhY3Rpb246IFwiUmVtb3ZlIHVudXNlZCBtYXJrIGRlZmluaXRpb24gaXRlbVwiLFxuICAgICAgICAgICAgaXRlbTogYmxrLFxuICAgICAgICAgICAgaTE4bjoge1xuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLm9ycGhhbmVkLW1hcmstZGVmcy5kZXNjcmlwdGlvblwiLFxuICAgICAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5vcnBoYW5lZC1tYXJrLWRlZnMuYWN0aW9uXCIsXG4gICAgICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgICAgIGtleTogYmxrLl9rZXksXG4gICAgICAgICAgICAgICAgdW51c2VkTWFya0RlZnM6IHVudXNlZE1hcmtEZWZzLm1hcCgobSkgPT4gbS50b1N0cmluZygpKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgITA7XG4gICAgICB9XG4gICAgICBjb25zdCBvcnBoYW5lZE1hcmtzID0gYWxsVXNlZE1hcmtzLmZpbHRlcigobWFyaykgPT4gIXR5cGVzLmRlY29yYXRvcnMubWFwKChkZWMpID0+IGRlYy5uYW1lKS5pbmNsdWRlcyhtYXJrKSkuZmlsdGVyKChtYXJrKSA9PiB0ZXh0QmxvY2subWFya0RlZnMgPT09IHZvaWQgMCB8fCAhdGV4dEJsb2NrLm1hcmtEZWZzLmZpbmQoKGRlZikgPT4gZGVmLl9rZXkgPT09IG1hcmspKTtcbiAgICAgIGlmIChvcnBoYW5lZE1hcmtzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgc3BhbkNoaWxkcmVuID0gdGV4dEJsb2NrLmNoaWxkcmVuLmZpbHRlcigoY2xkKSA9PiBjbGQuX3R5cGUgPT09IHR5cGVzLnNwYW4ubmFtZSAmJiBBcnJheS5pc0FycmF5KGNsZC5tYXJrcykgJiYgY2xkLm1hcmtzLnNvbWUoKG1hcmspID0+IG9ycGhhbmVkTWFya3MuaW5jbHVkZXMobWFyaykpKTtcbiAgICAgICAgaWYgKHNwYW5DaGlsZHJlbikge1xuICAgICAgICAgIGNvbnN0IG9ycGhhbmVkID0gb3JwaGFuZWRNYXJrcy5qb2luKFwiLCBcIik7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdXRpb24gPSB7XG4gICAgICAgICAgICBhdXRvUmVzb2x2ZTogITAsXG4gICAgICAgICAgICBwYXRjaGVzOiBzcGFuQ2hpbGRyZW4ubWFwKChjaGlsZCkgPT4gc2V0KChjaGlsZC5tYXJrcyB8fCBbXSkuZmlsdGVyKChjTXJrKSA9PiAhb3JwaGFuZWRNYXJrcy5pbmNsdWRlcyhjTXJrKSksIFt7XG4gICAgICAgICAgICAgIF9rZXk6IGJsay5fa2V5XG4gICAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIHtcbiAgICAgICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICAgICAgfSwgXCJtYXJrc1wiXSkpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBCbG9jayB3aXRoIF9rZXkgJyR7YmxrLl9rZXl9JyBjb250YWlucyBtYXJrcyAoJHtvcnBoYW5lZH0pIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGN1cnJlbnQgY29udGVudCBtb2RlbC5gLFxuICAgICAgICAgICAgYWN0aW9uOiBcIlJlbW92ZSBpbnZhbGlkIG1hcmtzXCIsXG4gICAgICAgICAgICBpdGVtOiBibGssXG4gICAgICAgICAgICBpMThuOiB7XG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUub3JwaGFuZWQtbWFya3MuZGVzY3JpcHRpb25cIixcbiAgICAgICAgICAgICAgYWN0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUub3JwaGFuZWQtbWFya3MuYWN0aW9uXCIsXG4gICAgICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgICAgIGtleTogYmxrLl9rZXksXG4gICAgICAgICAgICAgICAgb3JwaGFuZWRNYXJrczogb3JwaGFuZWRNYXJrcy5tYXAoKG0pID0+IG0udG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sICEwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0ZXh0QmxvY2suY2hpbGRyZW4uc29tZSgoY2hpbGQsIGNJbmRleCkgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIGNoaWxkICE9IFwib2JqZWN0XCIgfHwgY2hpbGQgPT09IG51bGwpXG4gICAgICAgICAgcmV0dXJuIHJlc29sdXRpb24gPSB7XG4gICAgICAgICAgICBwYXRjaGVzOiBbdW5zZXQoW3tcbiAgICAgICAgICAgICAgX2tleTogYmxrLl9rZXlcbiAgICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwgY0luZGV4XSldLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBDaGlsZCBhdCBpbmRleCAnJHtjSW5kZXh9JyBpbiBibG9jayB3aXRoIGtleSAnJHtibGsuX2tleX0nIGlzIG5vdCBhbiBvYmplY3QuYCxcbiAgICAgICAgICAgIGFjdGlvbjogXCJSZW1vdmUgdGhlIGl0ZW1cIixcbiAgICAgICAgICAgIGl0ZW06IGJsayxcbiAgICAgICAgICAgIGkxOG46IHtcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5ub24tb2JqZWN0LWNoaWxkLmRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICAgIGFjdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLm5vbi1vYmplY3QtY2hpbGQuYWN0aW9uXCIsXG4gICAgICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgICAgIGtleTogYmxrLl9rZXksXG4gICAgICAgICAgICAgICAgaW5kZXg6IGNJbmRleFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgITA7XG4gICAgICAgIGlmICghY2hpbGQuX2tleSB8fCB0eXBlb2YgY2hpbGQuX2tleSAhPSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgY29uc3QgbmV3Q2hpbGQgPSB7XG4gICAgICAgICAgICAuLi5jaGlsZCxcbiAgICAgICAgICAgIF9rZXk6IGtleUdlbmVyYXRvcigpXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gcmVzb2x1dGlvbiA9IHtcbiAgICAgICAgICAgIGF1dG9SZXNvbHZlOiAhMCxcbiAgICAgICAgICAgIHBhdGNoZXM6IFtzZXQobmV3Q2hpbGQsIFt7XG4gICAgICAgICAgICAgIF9rZXk6IGJsay5fa2V5XG4gICAgICAgICAgICB9LCBcImNoaWxkcmVuXCIsIGNJbmRleF0pXSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgQ2hpbGQgYXQgaW5kZXggJHtjSW5kZXh9IGlzIG1pc3NpbmcgcmVxdWlyZWQgX2tleSBpbiBibG9jayB3aXRoIF9rZXkgJHtibGsuX2tleX0uYCxcbiAgICAgICAgICAgIGFjdGlvbjogXCJTZXQgYSBuZXcgcmFuZG9tIF9rZXkgb24gdGhlIG9iamVjdFwiLFxuICAgICAgICAgICAgaXRlbTogYmxrLFxuICAgICAgICAgICAgaTE4bjoge1xuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLm1pc3NpbmctY2hpbGQta2V5LmRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICAgIGFjdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLm1pc3NpbmctY2hpbGQta2V5LmFjdGlvblwiLFxuICAgICAgICAgICAgICB2YWx1ZXM6IHtcbiAgICAgICAgICAgICAgICBrZXk6IGJsay5fa2V5LFxuICAgICAgICAgICAgICAgIGluZGV4OiBjSW5kZXhcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sICEwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGlsZC5fdHlwZSA/IHZhbGlkQ2hpbGRUeXBlcy5pbmNsdWRlcyhjaGlsZC5fdHlwZSkgPyBjaGlsZC5fdHlwZSA9PT0gdHlwZXMuc3Bhbi5uYW1lICYmIHR5cGVvZiBjaGlsZC50ZXh0ICE9IFwic3RyaW5nXCIgPyAocmVzb2x1dGlvbiA9IHtcbiAgICAgICAgICBwYXRjaGVzOiBbc2V0KHtcbiAgICAgICAgICAgIC4uLmNoaWxkLFxuICAgICAgICAgICAgdGV4dDogXCJcIlxuICAgICAgICAgIH0sIFt7XG4gICAgICAgICAgICBfa2V5OiBibGsuX2tleVxuICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICAgIH1dKV0sXG4gICAgICAgICAgZGVzY3JpcHRpb246IGBDaGlsZCB3aXRoIF9rZXkgJyR7Y2hpbGQuX2tleX0nIGluIGJsb2NrIHdpdGgga2V5ICcke2Jsay5fa2V5fScgaGFzIG1pc3Npbmcgb3IgaW52YWxpZCB0ZXh0IHByb3BlcnR5IWAsXG4gICAgICAgICAgYWN0aW9uOiBcIldyaXRlIGFuIGVtcHR5IHRleHQgcHJvcGVydHkgdG8gdGhlIG9iamVjdFwiLFxuICAgICAgICAgIGl0ZW06IGJsayxcbiAgICAgICAgICBpMThuOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLmludmFsaWQtc3Bhbi10ZXh0LmRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5pbnZhbGlkLXNwYW4tdGV4dC5hY3Rpb25cIixcbiAgICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgICBrZXk6IGJsay5fa2V5LFxuICAgICAgICAgICAgICBjaGlsZEtleTogY2hpbGQuX2tleVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSwgITApIDogITEgOiAocmVzb2x1dGlvbiA9IHtcbiAgICAgICAgICBwYXRjaGVzOiBbdW5zZXQoW3tcbiAgICAgICAgICAgIF9rZXk6IGJsay5fa2V5XG4gICAgICAgICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgICAgICAgfV0pXSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYENoaWxkIHdpdGggX2tleSAnJHtjaGlsZC5fa2V5fScgaW4gYmxvY2sgd2l0aCBrZXkgJyR7YmxrLl9rZXl9JyBoYXMgaW52YWxpZCAnX3R5cGUnIHByb3BlcnR5ICgke2NoaWxkLl90eXBlfSkuYCxcbiAgICAgICAgICBhY3Rpb246IFwiUmVtb3ZlIHRoZSBvYmplY3RcIixcbiAgICAgICAgICBpdGVtOiBibGssXG4gICAgICAgICAgaTE4bjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5kaXNhbGxvd2VkLWNoaWxkLXR5cGUuZGVzY3JpcHRpb25cIixcbiAgICAgICAgICAgIGFjdGlvbjogXCJpbnB1dHMucG9ydGFibGUtdGV4dC5pbnZhbGlkLXZhbHVlLmRpc2FsbG93ZWQtY2hpbGQtdHlwZS5hY3Rpb25cIixcbiAgICAgICAgICAgIHZhbHVlczoge1xuICAgICAgICAgICAgICBrZXk6IGJsay5fa2V5LFxuICAgICAgICAgICAgICBjaGlsZEtleTogY2hpbGQuX2tleSxcbiAgICAgICAgICAgICAgY2hpbGRUeXBlOiBjaGlsZC5fdHlwZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSwgITApIDogKHJlc29sdXRpb24gPSB7XG4gICAgICAgICAgcGF0Y2hlczogW3Vuc2V0KFt7XG4gICAgICAgICAgICBfa2V5OiBibGsuX2tleVxuICAgICAgICAgIH0sIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICAgIH1dKV0sXG4gICAgICAgICAgZGVzY3JpcHRpb246IGBDaGlsZCB3aXRoIF9rZXkgJyR7Y2hpbGQuX2tleX0nIGluIGJsb2NrIHdpdGgga2V5ICcke2Jsay5fa2V5fScgaXMgbWlzc2luZyAnX3R5cGUnIHByb3BlcnR5LmAsXG4gICAgICAgICAgYWN0aW9uOiBcIlJlbW92ZSB0aGUgb2JqZWN0XCIsXG4gICAgICAgICAgaXRlbTogYmxrLFxuICAgICAgICAgIGkxOG46IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcImlucHV0cy5wb3J0YWJsZS10ZXh0LmludmFsaWQtdmFsdWUubWlzc2luZy1jaGlsZC10eXBlLmRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICBhY3Rpb246IFwiaW5wdXRzLnBvcnRhYmxlLXRleHQuaW52YWxpZC12YWx1ZS5taXNzaW5nLWNoaWxkLXR5cGUuYWN0aW9uXCIsXG4gICAgICAgICAgICB2YWx1ZXM6IHtcbiAgICAgICAgICAgICAga2V5OiBibGsuX2tleSxcbiAgICAgICAgICAgICAgY2hpbGRLZXk6IGNoaWxkLl9rZXlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sICEwKTtcbiAgICAgIH0pICYmICh2YWxpZCA9ICExKTtcbiAgICB9XG4gICAgcmV0dXJuICExO1xuICB9KSAmJiAodmFsaWQgPSAhMSksIHtcbiAgICB2YWxpZCxcbiAgICByZXNvbHV0aW9uLFxuICAgIHZhbHVlXG4gIH0pO1xufVxuY29uc3QgZGVidWckMiA9IGRlYnVnV2l0aE5hbWUoXCJzeW5jIG1hY2hpbmVcIiksIHN5bmNWYWx1ZUNhbGxiYWNrID0gKHtcbiAgc2VuZEJhY2ssXG4gIGlucHV0XG59KSA9PiB7XG4gIHVwZGF0ZVZhbHVlKHtcbiAgICBjb250ZXh0OiBpbnB1dC5jb250ZXh0LFxuICAgIHNlbmRCYWNrLFxuICAgIHNsYXRlRWRpdG9yOiBpbnB1dC5zbGF0ZUVkaXRvcixcbiAgICB2YWx1ZTogaW5wdXQudmFsdWUsXG4gICAgc3RyZWFtQmxvY2tzOiBpbnB1dC5zdHJlYW1CbG9ja3NcbiAgfSk7XG59LCBzeW5jVmFsdWVMb2dpYyA9IGZyb21DYWxsYmFjayhzeW5jVmFsdWVDYWxsYmFjayksIHN5bmNNYWNoaW5lID0gc2V0dXAoe1xuICB0eXBlczoge1xuICAgIGNvbnRleHQ6IHt9LFxuICAgIGlucHV0OiB7fSxcbiAgICBldmVudHM6IHt9LFxuICAgIGVtaXR0ZWQ6IHt9XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBcImFzc2lnbiBpbml0aWFsIHZhbHVlIHN5bmNlZFwiOiBhc3NpZ24oe1xuICAgICAgaW5pdGlhbFZhbHVlU3luY2VkOiAhMFxuICAgIH0pLFxuICAgIFwiYXNzaWduIHJlYWRPbmx5XCI6IGFzc2lnbih7XG4gICAgICByZWFkT25seTogKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IChhc3NlcnRFdmVudChldmVudCwgXCJ1cGRhdGUgcmVhZE9ubHlcIiksIGV2ZW50LnJlYWRPbmx5KVxuICAgIH0pLFxuICAgIFwiYXNzaWduIHBlbmRpbmcgdmFsdWVcIjogYXNzaWduKHtcbiAgICAgIHBlbmRpbmdWYWx1ZTogKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IChhc3NlcnRFdmVudChldmVudCwgXCJ1cGRhdGUgdmFsdWVcIiksIGV2ZW50LnZhbHVlKVxuICAgIH0pLFxuICAgIFwiY2xlYXIgcGVuZGluZyB2YWx1ZVwiOiBhc3NpZ24oe1xuICAgICAgcGVuZGluZ1ZhbHVlOiB2b2lkIDBcbiAgICB9KSxcbiAgICBcImFzc2lnbiBwcmV2aW91cyB2YWx1ZVwiOiBhc3NpZ24oe1xuICAgICAgcHJldmlvdXNWYWx1ZTogKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IChhc3NlcnRFdmVudChldmVudCwgXCJkb25lIHN5bmNpbmdcIiksIGV2ZW50LnZhbHVlKVxuICAgIH0pLFxuICAgIFwiZW1pdCBkb25lIHN5bmNpbmcgdmFsdWVcIjogZW1pdCh7XG4gICAgICB0eXBlOiBcImRvbmUgc3luY2luZyB2YWx1ZVwiXG4gICAgfSksXG4gICAgXCJlbWl0IHN5bmNpbmcgdmFsdWVcIjogZW1pdCh7XG4gICAgICB0eXBlOiBcInN5bmNpbmcgdmFsdWVcIlxuICAgIH0pXG4gIH0sXG4gIGd1YXJkczoge1xuICAgIFwiaW5pdGlhbCB2YWx1ZSBzeW5jZWRcIjogKHtcbiAgICAgIGNvbnRleHRcbiAgICB9KSA9PiBjb250ZXh0LmluaXRpYWxWYWx1ZVN5bmNlZCxcbiAgICBcImlzIGJ1c3lcIjogKHtcbiAgICAgIGNvbnRleHRcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBpc1Byb2Nlc3NpbmdMb2NhbENoYW5nZXMgPSBjb250ZXh0LmlzUHJvY2Vzc2luZ0xvY2FsQ2hhbmdlcywgaXNDaGFuZ2luZyA9IGNvbnRleHQuc2xhdGVFZGl0b3IuaXNQcm9jZXNzaW5nUmVtb3RlQ2hhbmdlcyA/PyAhMSwgaXNCdXN5ID0gaXNQcm9jZXNzaW5nTG9jYWxDaGFuZ2VzIHx8IGlzQ2hhbmdpbmc7XG4gICAgICByZXR1cm4gZGVidWckMihcImlzQnVzeVwiLCB7XG4gICAgICAgIGlzQnVzeSxcbiAgICAgICAgaXNQcm9jZXNzaW5nTG9jYWxDaGFuZ2VzLFxuICAgICAgICBpc0NoYW5naW5nXG4gICAgICB9KSwgaXNCdXN5O1xuICAgIH0sXG4gICAgXCJpcyBlbXB0eSB2YWx1ZVwiOiAoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBldmVudC50eXBlID09PSBcInVwZGF0ZSB2YWx1ZVwiICYmIGV2ZW50LnZhbHVlID09PSB2b2lkIDAsXG4gICAgXCJpcyBlbXB0eSBhcnJheVwiOiAoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBldmVudC50eXBlID09PSBcInVwZGF0ZSB2YWx1ZVwiICYmIEFycmF5LmlzQXJyYXkoZXZlbnQudmFsdWUpICYmIGV2ZW50LnZhbHVlLmxlbmd0aCA9PT0gMCxcbiAgICBcImlzIG5ldyB2YWx1ZVwiOiAoe1xuICAgICAgY29udGV4dCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gZXZlbnQudHlwZSA9PT0gXCJ1cGRhdGUgdmFsdWVcIiAmJiBjb250ZXh0LnByZXZpb3VzVmFsdWUgIT09IGV2ZW50LnZhbHVlLFxuICAgIFwidmFsdWUgY2hhbmdlZCB3aGlsZSBzeW5jaW5nXCI6ICh7XG4gICAgICBjb250ZXh0LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiAoYXNzZXJ0RXZlbnQoZXZlbnQsIFwiZG9uZSBzeW5jaW5nXCIpLCBjb250ZXh0LnBlbmRpbmdWYWx1ZSAhPT0gZXZlbnQudmFsdWUpLFxuICAgIFwicGVuZGluZyB2YWx1ZSBlcXVhbHMgcHJldmlvdXMgdmFsdWVcIjogKHtcbiAgICAgIGNvbnRleHRcbiAgICB9KSA9PiBpc0VxdWFsVmFsdWVzKHtcbiAgICAgIHNjaGVtYTogY29udGV4dC5zY2hlbWFcbiAgICB9LCBjb250ZXh0LnBlbmRpbmdWYWx1ZSwgY29udGV4dC5wcmV2aW91c1ZhbHVlKVxuICB9LFxuICBhY3RvcnM6IHtcbiAgICBcInN5bmMgdmFsdWVcIjogc3luY1ZhbHVlTG9naWNcbiAgfVxufSkuY3JlYXRlTWFjaGluZSh7XG4gIGlkOiBcInN5bmNcIixcbiAgY29udGV4dDogKHtcbiAgICBpbnB1dFxuICB9KSA9PiAoe1xuICAgIGluaXRpYWxWYWx1ZTogaW5wdXQuaW5pdGlhbFZhbHVlLFxuICAgIGluaXRpYWxWYWx1ZVN5bmNlZDogITEsXG4gICAgaXNQcm9jZXNzaW5nTG9jYWxDaGFuZ2VzOiAhMSxcbiAgICBrZXlHZW5lcmF0b3I6IGlucHV0LmtleUdlbmVyYXRvcixcbiAgICBzY2hlbWE6IGlucHV0LnNjaGVtYSxcbiAgICByZWFkT25seTogaW5wdXQucmVhZE9ubHksXG4gICAgc2xhdGVFZGl0b3I6IGlucHV0LnNsYXRlRWRpdG9yLFxuICAgIHBlbmRpbmdWYWx1ZTogdm9pZCAwLFxuICAgIHByZXZpb3VzVmFsdWU6IHZvaWQgMFxuICB9KSxcbiAgZW50cnk6IFtyYWlzZSQxKCh7XG4gICAgY29udGV4dFxuICB9KSA9PiAoe1xuICAgIHR5cGU6IFwidXBkYXRlIHZhbHVlXCIsXG4gICAgdmFsdWU6IGNvbnRleHQuaW5pdGlhbFZhbHVlXG4gIH0pKV0sXG4gIG9uOiB7XG4gICAgXCJoYXMgcGVuZGluZyBtdXRhdGlvbnNcIjoge1xuICAgICAgYWN0aW9uczogYXNzaWduKHtcbiAgICAgICAgaXNQcm9jZXNzaW5nTG9jYWxDaGFuZ2VzOiAhMFxuICAgICAgfSlcbiAgICB9LFxuICAgIG11dGF0aW9uOiB7XG4gICAgICBhY3Rpb25zOiBhc3NpZ24oe1xuICAgICAgICBpc1Byb2Nlc3NpbmdMb2NhbENoYW5nZXM6ICExXG4gICAgICB9KVxuICAgIH0sXG4gICAgXCJ1cGRhdGUgcmVhZE9ubHlcIjoge1xuICAgICAgYWN0aW9uczogW1wiYXNzaWduIHJlYWRPbmx5XCJdXG4gICAgfVxuICB9LFxuICBpbml0aWFsOiBcImlkbGVcIixcbiAgc3RhdGVzOiB7XG4gICAgaWRsZToge1xuICAgICAgZW50cnk6IFsoKSA9PiB7XG4gICAgICAgIGRlYnVnJDIoXCJlbnRyeTogc3luY2luZy0+aWRsZVwiKTtcbiAgICAgIH1dLFxuICAgICAgZXhpdDogWygpID0+IHtcbiAgICAgICAgZGVidWckMihcImV4aXQ6IHN5bmNpbmctPmlkbGVcIik7XG4gICAgICB9XSxcbiAgICAgIG9uOiB7XG4gICAgICAgIFwidXBkYXRlIHZhbHVlXCI6IFt7XG4gICAgICAgICAgZ3VhcmQ6IGFuZChbXCJpcyBlbXB0eSB2YWx1ZVwiLCBub3QoXCJpbml0aWFsIHZhbHVlIHN5bmNlZFwiKV0pLFxuICAgICAgICAgIGFjdGlvbnM6IFtcImFzc2lnbiBpbml0aWFsIHZhbHVlIHN5bmNlZFwiLCBcImVtaXQgZG9uZSBzeW5jaW5nIHZhbHVlXCJdXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBndWFyZDogYW5kKFtcImlzIGVtcHR5IGFycmF5XCIsIG5vdChcImluaXRpYWwgdmFsdWUgc3luY2VkXCIpXSksXG4gICAgICAgICAgYWN0aW9uczogW1wiYXNzaWduIGluaXRpYWwgdmFsdWUgc3luY2VkXCIsIGVtaXQoe1xuICAgICAgICAgICAgdHlwZTogXCJ2YWx1ZSBjaGFuZ2VkXCIsXG4gICAgICAgICAgICB2YWx1ZTogW11cbiAgICAgICAgICB9KSwgXCJlbWl0IGRvbmUgc3luY2luZyB2YWx1ZVwiXVxuICAgICAgICB9LCB7XG4gICAgICAgICAgZ3VhcmQ6IGFuZChbXCJpcyBidXN5XCIsIFwiaXMgbmV3IHZhbHVlXCJdKSxcbiAgICAgICAgICB0YXJnZXQ6IFwiYnVzeVwiLFxuICAgICAgICAgIGFjdGlvbnM6IFtcImFzc2lnbiBwZW5kaW5nIHZhbHVlXCJdXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBndWFyZDogXCJpcyBuZXcgdmFsdWVcIixcbiAgICAgICAgICB0YXJnZXQ6IFwic3luY2luZ1wiLFxuICAgICAgICAgIGFjdGlvbnM6IFtcImFzc2lnbiBwZW5kaW5nIHZhbHVlXCJdXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBndWFyZDogbm90KFwiaW5pdGlhbCB2YWx1ZSBzeW5jZWRcIiksXG4gICAgICAgICAgYWN0aW9uczogWygpID0+IHtcbiAgICAgICAgICAgIGRlYnVnJDIoXCJubyBuZXcgdmFsdWUgXFx1MjAxMyBzZXR0aW5nIGluaXRpYWwgdmFsdWUgYXMgc3luY2VkXCIpO1xuICAgICAgICAgIH0sIFwiYXNzaWduIGluaXRpYWwgdmFsdWUgc3luY2VkXCIsIFwiZW1pdCBkb25lIHN5bmNpbmcgdmFsdWVcIl1cbiAgICAgICAgfSwge1xuICAgICAgICAgIGFjdGlvbnM6IFsoKSA9PiB7XG4gICAgICAgICAgICBkZWJ1ZyQyKFwibm8gbmV3IHZhbHVlIGFuZCBpbml0aWFsIHZhbHVlIGFscmVhZHkgc3luY2VkXCIpO1xuICAgICAgICAgIH1dXG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfSxcbiAgICBidXN5OiB7XG4gICAgICBlbnRyeTogWygpID0+IHtcbiAgICAgICAgZGVidWckMihcImVudHJ5OiBzeW5jaW5nLT5idXN5XCIpO1xuICAgICAgfV0sXG4gICAgICBleGl0OiBbKCkgPT4ge1xuICAgICAgICBkZWJ1ZyQyKFwiZXhpdDogc3luY2luZy0+YnVzeVwiKTtcbiAgICAgIH1dLFxuICAgICAgYWZ0ZXI6IHtcbiAgICAgICAgMWUzOiBbe1xuICAgICAgICAgIGd1YXJkOiBcImlzIGJ1c3lcIixcbiAgICAgICAgICB0YXJnZXQ6IFwiLlwiLFxuICAgICAgICAgIHJlZW50ZXI6ICEwLFxuICAgICAgICAgIGFjdGlvbnM6IFsoKSA9PiB7XG4gICAgICAgICAgICBkZWJ1ZyQyKFwicmVlbnRlcjogc3luY2luZy0+YnVzeVwiKTtcbiAgICAgICAgICB9XVxuICAgICAgICB9LCB7XG4gICAgICAgICAgdGFyZ2V0OiBcInN5bmNpbmdcIlxuICAgICAgICB9XVxuICAgICAgfSxcbiAgICAgIG9uOiB7XG4gICAgICAgIFwidXBkYXRlIHZhbHVlXCI6IFt7XG4gICAgICAgICAgZ3VhcmQ6IFwiaXMgbmV3IHZhbHVlXCIsXG4gICAgICAgICAgYWN0aW9uczogW1wiYXNzaWduIHBlbmRpbmcgdmFsdWVcIl1cbiAgICAgICAgfV1cbiAgICAgIH1cbiAgICB9LFxuICAgIHN5bmNpbmc6IHtcbiAgICAgIGVudHJ5OiBbKCkgPT4ge1xuICAgICAgICBkZWJ1ZyQyKFwiZW50cnk6IHN5bmNpbmctPnN5bmNpbmdcIik7XG4gICAgICB9LCBcImVtaXQgc3luY2luZyB2YWx1ZVwiXSxcbiAgICAgIGV4aXQ6IFsoKSA9PiB7XG4gICAgICAgIGRlYnVnJDIoXCJleGl0OiBzeW5jaW5nLT5zeW5jaW5nXCIpO1xuICAgICAgfSwgXCJlbWl0IGRvbmUgc3luY2luZyB2YWx1ZVwiXSxcbiAgICAgIGludm9rZToge1xuICAgICAgICBzcmM6IFwic3luYyB2YWx1ZVwiLFxuICAgICAgICBpZDogXCJzeW5jIHZhbHVlXCIsXG4gICAgICAgIGlucHV0OiAoe1xuICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgfSkgPT4gKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnRleHQua2V5R2VuZXJhdG9yLFxuICAgICAgICAgICAgcHJldmlvdXNWYWx1ZTogY29udGV4dC5wcmV2aW91c1ZhbHVlLFxuICAgICAgICAgICAgcmVhZE9ubHk6IGNvbnRleHQucmVhZE9ubHksXG4gICAgICAgICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzbGF0ZUVkaXRvcjogY29udGV4dC5zbGF0ZUVkaXRvcixcbiAgICAgICAgICBzdHJlYW1CbG9ja3M6ICFjb250ZXh0LmluaXRpYWxWYWx1ZVN5bmNlZCxcbiAgICAgICAgICB2YWx1ZTogY29udGV4dC5wZW5kaW5nVmFsdWVcbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBvbjoge1xuICAgICAgICBcInVwZGF0ZSB2YWx1ZVwiOiB7XG4gICAgICAgICAgZ3VhcmQ6IFwiaXMgbmV3IHZhbHVlXCIsXG4gICAgICAgICAgYWN0aW9uczogW1wiYXNzaWduIHBlbmRpbmcgdmFsdWVcIl1cbiAgICAgICAgfSxcbiAgICAgICAgcGF0Y2g6IHtcbiAgICAgICAgICBhY3Rpb25zOiBbZW1pdCgoe1xuICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICB9KSA9PiBldmVudCldXG4gICAgICAgIH0sXG4gICAgICAgIFwiaW52YWxpZCB2YWx1ZVwiOiB7XG4gICAgICAgICAgYWN0aW9uczogW2VtaXQoKHtcbiAgICAgICAgICAgIGV2ZW50XG4gICAgICAgICAgfSkgPT4gZXZlbnQpXVxuICAgICAgICB9LFxuICAgICAgICBcInZhbHVlIGNoYW5nZWRcIjoge1xuICAgICAgICAgIGFjdGlvbnM6IFtlbWl0KCh7XG4gICAgICAgICAgICBldmVudFxuICAgICAgICAgIH0pID0+IGV2ZW50KV1cbiAgICAgICAgfSxcbiAgICAgICAgXCJkb25lIHN5bmNpbmdcIjogW3tcbiAgICAgICAgICBndWFyZDogXCJ2YWx1ZSBjaGFuZ2VkIHdoaWxlIHN5bmNpbmdcIixcbiAgICAgICAgICBhY3Rpb25zOiBbXCJhc3NpZ24gcHJldmlvdXMgdmFsdWVcIiwgXCJhc3NpZ24gaW5pdGlhbCB2YWx1ZSBzeW5jZWRcIl0sXG4gICAgICAgICAgdGFyZ2V0OiBcInN5bmNpbmdcIixcbiAgICAgICAgICByZWVudGVyOiAhMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgdGFyZ2V0OiBcImlkbGVcIixcbiAgICAgICAgICBhY3Rpb25zOiBbXCJjbGVhciBwZW5kaW5nIHZhbHVlXCIsIFwiYXNzaWduIHByZXZpb3VzIHZhbHVlXCIsIFwiYXNzaWduIGluaXRpYWwgdmFsdWUgc3luY2VkXCJdXG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlKHtcbiAgY29udGV4dCxcbiAgc2VuZEJhY2ssXG4gIHNsYXRlRWRpdG9yLFxuICBzdHJlYW1CbG9ja3MsXG4gIHZhbHVlXG59KSB7XG4gIGxldCBkb25lU3luY2luZyA9ICExLCBpc0NoYW5nZWQgPSAhMSwgaXNWYWxpZCA9ICEwO1xuICBjb25zdCBoYWRTZWxlY3Rpb24gPSAhIXNsYXRlRWRpdG9yLnNlbGVjdGlvbjtcbiAgaWYgKCghdmFsdWUgfHwgdmFsdWUubGVuZ3RoID09PSAwKSAmJiAoZGVidWckMihcIlZhbHVlIGlzIGVtcHR5XCIpLCBjbGVhckVkaXRvcih7XG4gICAgc2xhdGVFZGl0b3IsXG4gICAgZG9uZVN5bmNpbmdcbiAgfSksIGlzQ2hhbmdlZCA9ICEwKSwgdmFsdWUgJiYgdmFsdWUubGVuZ3RoID4gMClcbiAgICBpZiAoc3RyZWFtQmxvY2tzKVxuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgaWYgKGRvbmVTeW5jaW5nKSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpc0NoYW5nZWQgPSByZW1vdmVFeHRyYUJsb2Nrcyh7XG4gICAgICAgICAgc2xhdGVFZGl0b3IsXG4gICAgICAgICAgdmFsdWVcbiAgICAgICAgfSksIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBbY3VycmVudEJsb2NrLCBjdXJyZW50QmxvY2tJbmRleF0gb2YgZ2V0U3RyZWFtZWRCbG9ja3Moe1xuICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICBibG9ja0NoYW5nZWQsXG4gICAgICAgICAgICAgIGJsb2NrVmFsaWRcbiAgICAgICAgICAgIH0gPSBzeW5jQmxvY2soe1xuICAgICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgICBzZW5kQmFjayxcbiAgICAgICAgICAgICAgYmxvY2s6IGN1cnJlbnRCbG9jayxcbiAgICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRCbG9ja0luZGV4LFxuICAgICAgICAgICAgICBzbGF0ZUVkaXRvcixcbiAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGlzQ2hhbmdlZCA9IGJsb2NrQ2hhbmdlZCB8fCBpc0NoYW5nZWQsIGlzVmFsaWQgPSBpc1ZhbGlkICYmIGJsb2NrVmFsaWQsICFpc1ZhbGlkKVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KSgpO1xuICAgICAgfSk7XG4gICAgZWxzZSB7XG4gICAgICBpZiAoZG9uZVN5bmNpbmcpXG4gICAgICAgIHJldHVybjtcbiAgICAgIGlzQ2hhbmdlZCA9IHJlbW92ZUV4dHJhQmxvY2tzKHtcbiAgICAgICAgc2xhdGVFZGl0b3IsXG4gICAgICAgIHZhbHVlXG4gICAgICB9KTtcbiAgICAgIGxldCBpbmRleCA9IDA7XG4gICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBibG9ja0NoYW5nZWQsXG4gICAgICAgICAgYmxvY2tWYWxpZFxuICAgICAgICB9ID0gc3luY0Jsb2NrKHtcbiAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgIHNlbmRCYWNrLFxuICAgICAgICAgIGJsb2NrLFxuICAgICAgICAgIGluZGV4LFxuICAgICAgICAgIHNsYXRlRWRpdG9yLFxuICAgICAgICAgIHZhbHVlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoaXNDaGFuZ2VkID0gYmxvY2tDaGFuZ2VkIHx8IGlzQ2hhbmdlZCwgaXNWYWxpZCA9IGlzVmFsaWQgJiYgYmxvY2tWYWxpZCwgIWJsb2NrVmFsaWQpXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGluZGV4Kys7XG4gICAgICB9XG4gICAgfVxuICBpZiAoIWlzVmFsaWQpIHtcbiAgICBkZWJ1ZyQyKFwiSW52YWxpZCB2YWx1ZSwgcmV0dXJuaW5nXCIpLCBkb25lU3luY2luZyA9ICEwLCBzZW5kQmFjayh7XG4gICAgICB0eXBlOiBcImRvbmUgc3luY2luZ1wiLFxuICAgICAgdmFsdWVcbiAgICB9KTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGlzQ2hhbmdlZCkge1xuICAgIGRlYnVnJDIoXCJTZXJ2ZXIgdmFsdWUgY2hhbmdlZCwgc3luY2luZyBlZGl0b3JcIik7XG4gICAgdHJ5IHtcbiAgICAgIHNsYXRlRWRpdG9yLm9uQ2hhbmdlKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVyciksIHNlbmRCYWNrKHtcbiAgICAgICAgdHlwZTogXCJpbnZhbGlkIHZhbHVlXCIsXG4gICAgICAgIHJlc29sdXRpb246IG51bGwsXG4gICAgICAgIHZhbHVlXG4gICAgICB9KSwgZG9uZVN5bmNpbmcgPSAhMCwgc2VuZEJhY2soe1xuICAgICAgICB0eXBlOiBcImRvbmUgc3luY2luZ1wiLFxuICAgICAgICB2YWx1ZVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGhhZFNlbGVjdGlvbiAmJiAhc2xhdGVFZGl0b3Iuc2VsZWN0aW9uICYmIChUcmFuc2Zvcm1zLnNlbGVjdChzbGF0ZUVkaXRvciwge1xuICAgICAgYW5jaG9yOiB7XG4gICAgICAgIHBhdGg6IFswLCAwXSxcbiAgICAgICAgb2Zmc2V0OiAwXG4gICAgICB9LFxuICAgICAgZm9jdXM6IHtcbiAgICAgICAgcGF0aDogWzAsIDBdLFxuICAgICAgICBvZmZzZXQ6IDBcbiAgICAgIH1cbiAgICB9KSwgc2xhdGVFZGl0b3Iub25DaGFuZ2UoKSksIHNlbmRCYWNrKHtcbiAgICAgIHR5cGU6IFwidmFsdWUgY2hhbmdlZFwiLFxuICAgICAgdmFsdWVcbiAgICB9KTtcbiAgfSBlbHNlXG4gICAgZGVidWckMihcIlNlcnZlciB2YWx1ZSBhbmQgZWRpdG9yIHZhbHVlIGlzIGVxdWFsLCBubyBuZWVkIHRvIHN5bmMuXCIpO1xuICBkb25lU3luY2luZyA9ICEwLCBzZW5kQmFjayh7XG4gICAgdHlwZTogXCJkb25lIHN5bmNpbmdcIixcbiAgICB2YWx1ZVxuICB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uKiBnZXRTdHJlYW1lZEJsb2Nrcyh7XG4gIHZhbHVlXG59KSB7XG4gIGxldCBpbmRleCA9IDA7XG4gIGZvciBhd2FpdCAoY29uc3QgYmxvY2sgb2YgdmFsdWUpXG4gICAgaW5kZXggJSAxMCA9PT0gMCAmJiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAwKSksIHlpZWxkIFtibG9jaywgaW5kZXhdLCBpbmRleCsrO1xufVxuZnVuY3Rpb24gY2xlYXJFZGl0b3Ioe1xuICBzbGF0ZUVkaXRvcixcbiAgZG9uZVN5bmNpbmdcbn0pIHtcbiAgRWRpdG9yLndpdGhvdXROb3JtYWxpemluZyhzbGF0ZUVkaXRvciwgKCkgPT4ge1xuICAgIHBsdWdpbldpdGhvdXRIaXN0b3J5KHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgICB3aXRoUmVtb3RlQ2hhbmdlcyhzbGF0ZUVkaXRvciwgKCkgPT4ge1xuICAgICAgICB3aXRob3V0UGF0Y2hpbmcoc2xhdGVFZGl0b3IsICgpID0+IHtcbiAgICAgICAgICBpZiAoZG9uZVN5bmNpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgY29uc3QgY2hpbGRyZW5MZW5ndGggPSBzbGF0ZUVkaXRvci5jaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgICAgc2xhdGVFZGl0b3IuY2hpbGRyZW4uZm9yRWFjaCgoXywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAgICAgICAgICAgYXQ6IFtjaGlsZHJlbkxlbmd0aCAtIDEgLSBpbmRleF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cbmZ1bmN0aW9uIHJlbW92ZUV4dHJhQmxvY2tzKHtcbiAgc2xhdGVFZGl0b3IsXG4gIHZhbHVlXG59KSB7XG4gIGxldCBpc0NoYW5nZWQgPSAhMTtcbiAgcmV0dXJuIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoc2xhdGVFZGl0b3IsICgpID0+IHtcbiAgICB3aXRoUmVtb3RlQ2hhbmdlcyhzbGF0ZUVkaXRvciwgKCkgPT4ge1xuICAgICAgd2l0aG91dFBhdGNoaW5nKHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuTGVuZ3RoID0gc2xhdGVFZGl0b3IuY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoIDwgY2hpbGRyZW5MZW5ndGgpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gY2hpbGRyZW5MZW5ndGggLSAxOyBpID4gdmFsdWUubGVuZ3RoIC0gMTsgaS0tKVxuICAgICAgICAgICAgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhzbGF0ZUVkaXRvciwge1xuICAgICAgICAgICAgICBhdDogW2ldXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBpc0NoYW5nZWQgPSAhMDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pLCBpc0NoYW5nZWQ7XG59XG5mdW5jdGlvbiBzeW5jQmxvY2soe1xuICBjb250ZXh0LFxuICBzZW5kQmFjayxcbiAgYmxvY2ssXG4gIGluZGV4LFxuICBzbGF0ZUVkaXRvcixcbiAgdmFsdWVcbn0pIHtcbiAgY29uc3Qgb2xkQmxvY2sgPSBzbGF0ZUVkaXRvci5jaGlsZHJlbi5hdChpbmRleCk7XG4gIGlmICghb2xkQmxvY2spIHtcbiAgICBjb25zdCB2YWxpZGF0aW9uMiA9IHZhbGlkYXRlVmFsdWUoW2Jsb2NrXSwgY29udGV4dC5zY2hlbWEsIGNvbnRleHQua2V5R2VuZXJhdG9yKTtcbiAgICBpZiAoZGVidWckMi5lbmFibGVkICYmIGRlYnVnJDIoXCJWYWxpZGF0aW5nIGFuZCBpbnNlcnRpbmcgbmV3IGJsb2NrIGluIHRoZSBlbmQgb2YgdGhlIHZhbHVlXCIsIGJsb2NrKSwgdmFsaWRhdGlvbjIudmFsaWQgfHwgdmFsaWRhdGlvbjIucmVzb2x1dGlvbj8uYXV0b1Jlc29sdmUpIHtcbiAgICAgIGNvbnN0IHNsYXRlQmxvY2sgPSB0b1NsYXRlQmxvY2soYmxvY2ssIHtcbiAgICAgICAgc2NoZW1hVHlwZXM6IGNvbnRleHQuc2NoZW1hXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgICAgIHdpdGhSZW1vdGVDaGFuZ2VzKHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgd2l0aG91dFBhdGNoaW5nKHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgICAgICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKHNsYXRlRWRpdG9yLCBzbGF0ZUJsb2NrLCB7XG4gICAgICAgICAgICAgIGF0OiBbaW5kZXhdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KSwge1xuICAgICAgICBibG9ja0NoYW5nZWQ6ICEwLFxuICAgICAgICBibG9ja1ZhbGlkOiAhMFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGRlYnVnJDIoXCJJbnZhbGlkXCIsIHZhbGlkYXRpb24yKSwgc2VuZEJhY2soe1xuICAgICAgdHlwZTogXCJpbnZhbGlkIHZhbHVlXCIsXG4gICAgICByZXNvbHV0aW9uOiB2YWxpZGF0aW9uMi5yZXNvbHV0aW9uLFxuICAgICAgdmFsdWVcbiAgICB9KSwge1xuICAgICAgYmxvY2tDaGFuZ2VkOiAhMSxcbiAgICAgIGJsb2NrVmFsaWQ6ICExXG4gICAgfTtcbiAgfVxuICBpZiAoaXNFcXVhbEJsb2Nrcyhjb250ZXh0LCBibG9jaywgb2xkQmxvY2spKVxuICAgIHJldHVybiB7XG4gICAgICBibG9ja0NoYW5nZWQ6ICExLFxuICAgICAgYmxvY2tWYWxpZDogITBcbiAgICB9O1xuICBjb25zdCB2YWxpZGF0aW9uVmFsdWUgPSBbdmFsdWVbaW5kZXhdXSwgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVmFsdWUodmFsaWRhdGlvblZhbHVlLCBjb250ZXh0LnNjaGVtYSwgY29udGV4dC5rZXlHZW5lcmF0b3IpO1xuICByZXR1cm4gIXZhbGlkYXRpb24udmFsaWQgJiYgdmFsaWRhdGlvbi5yZXNvbHV0aW9uPy5hdXRvUmVzb2x2ZSAmJiB2YWxpZGF0aW9uLnJlc29sdXRpb24/LnBhdGNoZXMubGVuZ3RoID4gMCAmJiAhY29udGV4dC5yZWFkT25seSAmJiBjb250ZXh0LnByZXZpb3VzVmFsdWUgJiYgY29udGV4dC5wcmV2aW91c1ZhbHVlICE9PSB2YWx1ZSAmJiAoY29uc29sZS53YXJuKGAke3ZhbGlkYXRpb24ucmVzb2x1dGlvbi5hY3Rpb259IGZvciBibG9jayB3aXRoIF9rZXkgJyR7dmFsaWRhdGlvblZhbHVlWzBdLl9rZXl9Jy4gJHt2YWxpZGF0aW9uLnJlc29sdXRpb24/LmRlc2NyaXB0aW9ufWApLCB2YWxpZGF0aW9uLnJlc29sdXRpb24ucGF0Y2hlcy5mb3JFYWNoKChwYXRjaCkgPT4ge1xuICAgIHNlbmRCYWNrKHtcbiAgICAgIHR5cGU6IFwicGF0Y2hcIixcbiAgICAgIHBhdGNoXG4gICAgfSk7XG4gIH0pKSwgdmFsaWRhdGlvbi52YWxpZCB8fCB2YWxpZGF0aW9uLnJlc29sdXRpb24/LmF1dG9SZXNvbHZlID8gKG9sZEJsb2NrLl9rZXkgPT09IGJsb2NrLl9rZXkgPyAoZGVidWckMi5lbmFibGVkICYmIGRlYnVnJDIoXCJVcGRhdGluZyBibG9ja1wiLCBvbGRCbG9jaywgYmxvY2spLCBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgd2l0aFJlbW90ZUNoYW5nZXMoc2xhdGVFZGl0b3IsICgpID0+IHtcbiAgICAgIHdpdGhvdXRQYXRjaGluZyhzbGF0ZUVkaXRvciwgKCkgPT4ge1xuICAgICAgICB1cGRhdGVCbG9jayh7XG4gICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICBzbGF0ZUVkaXRvcixcbiAgICAgICAgICBvbGRCbG9jayxcbiAgICAgICAgICBibG9jayxcbiAgICAgICAgICBpbmRleFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KSkgOiAoZGVidWckMi5lbmFibGVkICYmIGRlYnVnJDIoXCJSZXBsYWNpbmcgYmxvY2tcIiwgb2xkQmxvY2ssIGJsb2NrKSwgRWRpdG9yLndpdGhvdXROb3JtYWxpemluZyhzbGF0ZUVkaXRvciwgKCkgPT4ge1xuICAgIHdpdGhSZW1vdGVDaGFuZ2VzKHNsYXRlRWRpdG9yLCAoKSA9PiB7XG4gICAgICB3aXRob3V0UGF0Y2hpbmcoc2xhdGVFZGl0b3IsICgpID0+IHtcbiAgICAgICAgcmVwbGFjZUJsb2NrKHtcbiAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgIHNsYXRlRWRpdG9yLFxuICAgICAgICAgIGJsb2NrLFxuICAgICAgICAgIGluZGV4XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pKSwge1xuICAgIGJsb2NrQ2hhbmdlZDogITAsXG4gICAgYmxvY2tWYWxpZDogITBcbiAgfSkgOiAoc2VuZEJhY2soe1xuICAgIHR5cGU6IFwiaW52YWxpZCB2YWx1ZVwiLFxuICAgIHJlc29sdXRpb246IHZhbGlkYXRpb24ucmVzb2x1dGlvbixcbiAgICB2YWx1ZVxuICB9KSwge1xuICAgIGJsb2NrQ2hhbmdlZDogITEsXG4gICAgYmxvY2tWYWxpZDogITFcbiAgfSk7XG59XG5mdW5jdGlvbiByZXBsYWNlQmxvY2soe1xuICBjb250ZXh0LFxuICBzbGF0ZUVkaXRvcixcbiAgYmxvY2ssXG4gIGluZGV4XG59KSB7XG4gIGNvbnN0IHNsYXRlQmxvY2sgPSB0b1NsYXRlQmxvY2soYmxvY2ssIHtcbiAgICBzY2hlbWFUeXBlczogY29udGV4dC5zY2hlbWFcbiAgfSksIGN1cnJlbnRTZWxlY3Rpb24gPSBzbGF0ZUVkaXRvci5zZWxlY3Rpb24sIHNlbGVjdGlvbkZvY3VzT25CbG9jayA9IGN1cnJlbnRTZWxlY3Rpb24gJiYgY3VycmVudFNlbGVjdGlvbi5mb2N1cy5wYXRoWzBdID09PSBpbmRleDtcbiAgc2VsZWN0aW9uRm9jdXNPbkJsb2NrICYmIFRyYW5zZm9ybXMuZGVzZWxlY3Qoc2xhdGVFZGl0b3IpLCBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKHNsYXRlRWRpdG9yLCB7XG4gICAgYXQ6IFtpbmRleF1cbiAgfSksIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoc2xhdGVFZGl0b3IsIHNsYXRlQmxvY2ssIHtcbiAgICBhdDogW2luZGV4XVxuICB9KSwgc2xhdGVFZGl0b3Iub25DaGFuZ2UoKSwgc2VsZWN0aW9uRm9jdXNPbkJsb2NrICYmIFRyYW5zZm9ybXMuc2VsZWN0KHNsYXRlRWRpdG9yLCBjdXJyZW50U2VsZWN0aW9uKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZUJsb2NrKHtcbiAgY29udGV4dCxcbiAgc2xhdGVFZGl0b3IsXG4gIG9sZEJsb2NrLFxuICBibG9jayxcbiAgaW5kZXhcbn0pIHtcbiAgY29uc3Qgc2xhdGVCbG9jayA9IHRvU2xhdGVCbG9jayhibG9jaywge1xuICAgIHNjaGVtYVR5cGVzOiBjb250ZXh0LnNjaGVtYVxuICB9KTtcbiAgaWYgKFRyYW5zZm9ybXMuc2V0Tm9kZXMoc2xhdGVFZGl0b3IsIHNsYXRlQmxvY2ssIHtcbiAgICBhdDogW2luZGV4XVxuICB9KSwgc2xhdGVFZGl0b3IuaXNUZXh0QmxvY2soc2xhdGVCbG9jaykgJiYgc2xhdGVFZGl0b3IuaXNUZXh0QmxvY2sob2xkQmxvY2spKSB7XG4gICAgY29uc3Qgb2xkQmxvY2tDaGlsZHJlbkxlbmd0aCA9IG9sZEJsb2NrLmNoaWxkcmVuLmxlbmd0aDtcbiAgICBzbGF0ZUJsb2NrLmNoaWxkcmVuLmxlbmd0aCA8IG9sZEJsb2NrQ2hpbGRyZW5MZW5ndGggJiYgQXJyYXkuZnJvbShBcnJheShvbGRCbG9ja0NoaWxkcmVuTGVuZ3RoIC0gc2xhdGVCbG9jay5jaGlsZHJlbi5sZW5ndGgpKS5mb3JFYWNoKChfLCBpbmRleDIpID0+IHtcbiAgICAgIGNvbnN0IGNoaWxkSW5kZXggPSBvbGRCbG9ja0NoaWxkcmVuTGVuZ3RoIC0gMSAtIGluZGV4MjtcbiAgICAgIGNoaWxkSW5kZXggPiAwICYmIChkZWJ1ZyQyKFwiUmVtb3ZpbmcgY2hpbGRcIiksIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAgICAgYXQ6IFtpbmRleDIsIGNoaWxkSW5kZXhdXG4gICAgICB9KSk7XG4gICAgfSksIHNsYXRlQmxvY2suY2hpbGRyZW4uZm9yRWFjaCgoY3VycmVudEJsb2NrQ2hpbGQsIGN1cnJlbnRCbG9ja0NoaWxkSW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IG9sZEJsb2NrQ2hpbGQgPSBvbGRCbG9jay5jaGlsZHJlbi5hdChjdXJyZW50QmxvY2tDaGlsZEluZGV4KSwgaXNDaGlsZENoYW5nZWQgPSBvbGRCbG9ja0NoaWxkICYmICFpc0VxdWFsQ2hpbGQoY3VycmVudEJsb2NrQ2hpbGQsIG9sZEJsb2NrQ2hpbGQpLCBpc1RleHRDaGFuZ2VkID0gb2xkQmxvY2tDaGlsZCAmJiBUZXh0LmlzVGV4dChvbGRCbG9ja0NoaWxkKSAmJiBjdXJyZW50QmxvY2tDaGlsZC50ZXh0ICE9PSBvbGRCbG9ja0NoaWxkLnRleHQsIHBhdGggPSBbaW5kZXgsIGN1cnJlbnRCbG9ja0NoaWxkSW5kZXhdO1xuICAgICAgaWYgKGlzQ2hpbGRDaGFuZ2VkKVxuICAgICAgICBpZiAoY3VycmVudEJsb2NrQ2hpbGQuX2tleSA9PT0gb2xkQmxvY2tDaGlsZD8uX2tleSkge1xuICAgICAgICAgIGRlYnVnJDIoXCJVcGRhdGluZyBjaGFuZ2VkIGNoaWxkXCIsIGN1cnJlbnRCbG9ja0NoaWxkLCBvbGRCbG9ja0NoaWxkKSwgVHJhbnNmb3Jtcy5zZXROb2RlcyhzbGF0ZUVkaXRvciwgY3VycmVudEJsb2NrQ2hpbGQsIHtcbiAgICAgICAgICAgIGF0OiBwYXRoXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgaXNTcGFuTm9kZTIgPSBpc1NwYW4oe1xuICAgICAgICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYVxuICAgICAgICAgIH0sIGN1cnJlbnRCbG9ja0NoaWxkKSAmJiBpc1NwYW4oe1xuICAgICAgICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYVxuICAgICAgICAgIH0sIG9sZEJsb2NrQ2hpbGQpO1xuICAgICAgICAgIGlzU3Bhbk5vZGUyICYmIGlzVGV4dENoYW5nZWQgPyAob2xkQmxvY2tDaGlsZC50ZXh0Lmxlbmd0aCA+IDAgJiYgZGVsZXRlVGV4dChzbGF0ZUVkaXRvciwge1xuICAgICAgICAgICAgYXQ6IHtcbiAgICAgICAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgICAgIG9mZnNldDogMFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhbmNob3I6IHtcbiAgICAgICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgICAgIG9mZnNldDogb2xkQmxvY2tDaGlsZC50ZXh0Lmxlbmd0aFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksIFRyYW5zZm9ybXMuaW5zZXJ0VGV4dChzbGF0ZUVkaXRvciwgY3VycmVudEJsb2NrQ2hpbGQudGV4dCwge1xuICAgICAgICAgICAgYXQ6IHBhdGhcbiAgICAgICAgICB9KSwgc2xhdGVFZGl0b3Iub25DaGFuZ2UoKSkgOiBpc1NwYW5Ob2RlMiB8fCAoZGVidWckMihcIlVwZGF0aW5nIGNoYW5nZWQgaW5saW5lIG9iamVjdCBjaGlsZFwiLCBjdXJyZW50QmxvY2tDaGlsZCksIFRyYW5zZm9ybXMuc2V0Tm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAgICAgICAgIF9rZXk6IFZPSURfQ0hJTERfS0VZXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6IFsuLi5wYXRoLCAwXSxcbiAgICAgICAgICAgIHZvaWRzOiAhMFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBlbHNlIG9sZEJsb2NrQ2hpbGQgPyAoZGVidWckMihcIlJlcGxhY2luZyBjaGlsZFwiLCBjdXJyZW50QmxvY2tDaGlsZCksIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoc2xhdGVFZGl0b3IsIHtcbiAgICAgICAgICBhdDogW2luZGV4LCBjdXJyZW50QmxvY2tDaGlsZEluZGV4XVxuICAgICAgICB9KSwgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhzbGF0ZUVkaXRvciwgY3VycmVudEJsb2NrQ2hpbGQsIHtcbiAgICAgICAgICBhdDogW2luZGV4LCBjdXJyZW50QmxvY2tDaGlsZEluZGV4XVxuICAgICAgICB9KSwgc2xhdGVFZGl0b3Iub25DaGFuZ2UoKSkgOiBvbGRCbG9ja0NoaWxkIHx8IChkZWJ1ZyQyKFwiSW5zZXJ0aW5nIG5ldyBjaGlsZFwiLCBjdXJyZW50QmxvY2tDaGlsZCksIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoc2xhdGVFZGl0b3IsIGN1cnJlbnRCbG9ja0NoaWxkLCB7XG4gICAgICAgICAgYXQ6IFtpbmRleCwgY3VycmVudEJsb2NrQ2hpbGRJbmRleF1cbiAgICAgICAgfSksIHNsYXRlRWRpdG9yLm9uQ2hhbmdlKCkpO1xuICAgIH0pO1xuICB9XG59XG5jb25zdCBkZWJ1ZyQxID0gZGVidWdXaXRoTmFtZShcInNldHVwXCIpO1xuZnVuY3Rpb24gY3JlYXRlSW50ZXJuYWxFZGl0b3IoY29uZmlnKSB7XG4gIGRlYnVnJDEoXCJDcmVhdGluZyBuZXcgRWRpdG9yIGluc3RhbmNlXCIpO1xuICBjb25zdCBzdWJzY3JpcHRpb25zID0gW10sIGVkaXRvckFjdG9yID0gY3JlYXRlQWN0b3IoZWRpdG9yTWFjaGluZSwge1xuICAgIGlucHV0OiBlZGl0b3JDb25maWdUb01hY2hpbmVJbnB1dChjb25maWcpXG4gIH0pLCByZWxheUFjdG9yID0gY3JlYXRlQWN0b3IocmVsYXlNYWNoaW5lKSwgc2xhdGVFZGl0b3IgPSBjcmVhdGVTbGF0ZUVkaXRvcih7XG4gICAgZWRpdG9yQWN0b3IsXG4gICAgcmVsYXlBY3RvcixcbiAgICBzdWJzY3JpcHRpb25zXG4gIH0pLCBlZGl0YWJsZSA9IGNyZWF0ZUVkaXRhYmxlQVBJKHNsYXRlRWRpdG9yLmluc3RhbmNlLCBlZGl0b3JBY3RvciksIHtcbiAgICBtdXRhdGlvbkFjdG9yLFxuICAgIHN5bmNBY3RvclxuICB9ID0gY3JlYXRlQWN0b3JzKHtcbiAgICBlZGl0b3JBY3RvcixcbiAgICByZWxheUFjdG9yLFxuICAgIHNsYXRlRWRpdG9yOiBzbGF0ZUVkaXRvci5pbnN0YW5jZSxcbiAgICBzdWJzY3JpcHRpb25zXG4gIH0pLCBlZGl0b3IgPSB7XG4gICAgZG9tOiBjcmVhdGVFZGl0b3JEb20oKGV2ZW50KSA9PiBlZGl0b3JBY3Rvci5zZW5kKGV2ZW50KSwgc2xhdGVFZGl0b3IuaW5zdGFuY2UpLFxuICAgIGdldFNuYXBzaG90OiAoKSA9PiBnZXRFZGl0b3JTbmFwc2hvdCh7XG4gICAgICBlZGl0b3JBY3RvclNuYXBzaG90OiBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLFxuICAgICAgc2xhdGVFZGl0b3JJbnN0YW5jZTogc2xhdGVFZGl0b3IuaW5zdGFuY2VcbiAgICB9KSxcbiAgICByZWdpc3RlckJlaGF2aW9yOiAoYmVoYXZpb3JDb25maWcpID0+IHtcbiAgICAgIGNvbnN0IHByaW9yaXR5ID0gY3JlYXRlRWRpdG9yUHJpb3JpdHkoe1xuICAgICAgICBuYW1lOiBcImN1c3RvbVwiLFxuICAgICAgICByZWZlcmVuY2U6IHtcbiAgICAgICAgICBwcmlvcml0eTogY29yZVByaW9yaXR5LFxuICAgICAgICAgIGltcG9ydGFuY2U6IFwiaGlnaGVyXCJcbiAgICAgICAgfVxuICAgICAgfSksIGJlaGF2aW9yQ29uZmlnV2l0aFByaW9yaXR5ID0ge1xuICAgICAgICAuLi5iZWhhdmlvckNvbmZpZyxcbiAgICAgICAgcHJpb3JpdHlcbiAgICAgIH07XG4gICAgICByZXR1cm4gZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwiYWRkIGJlaGF2aW9yXCIsXG4gICAgICAgIGJlaGF2aW9yQ29uZmlnOiBiZWhhdmlvckNvbmZpZ1dpdGhQcmlvcml0eVxuICAgICAgfSksICgpID0+IHtcbiAgICAgICAgZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgICAgdHlwZTogXCJyZW1vdmUgYmVoYXZpb3JcIixcbiAgICAgICAgICBiZWhhdmlvckNvbmZpZzogYmVoYXZpb3JDb25maWdXaXRoUHJpb3JpdHlcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0sXG4gICAgc2VuZDogKGV2ZW50KSA9PiB7XG4gICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcbiAgICAgICAgY2FzZSBcInVwZGF0ZSB2YWx1ZVwiOlxuICAgICAgICAgIHN5bmNBY3Rvci5zZW5kKGV2ZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInVwZGF0ZSByZWFkT25seVwiOlxuICAgICAgICBjYXNlIFwicGF0Y2hlc1wiOlxuICAgICAgICAgIGVkaXRvckFjdG9yLnNlbmQoZXZlbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGVkaXRvckFjdG9yLnNlbmQocmVyb3V0ZUV4dGVybmFsQmVoYXZpb3JFdmVudCh7XG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIHNsYXRlRWRpdG9yOiBzbGF0ZUVkaXRvci5pbnN0YW5jZVxuICAgICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG9uOiAoZXZlbnQsIGxpc3RlbmVyKSA9PiByZWxheUFjdG9yLm9uKGV2ZW50LCAoZXZlbnQyKSA9PiB7XG4gICAgICBzd2l0Y2ggKGV2ZW50Mi50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJibHVycmVkXCI6XG4gICAgICAgIGNhc2UgXCJkb25lIGxvYWRpbmdcIjpcbiAgICAgICAgY2FzZSBcImVkaXRhYmxlXCI6XG4gICAgICAgIGNhc2UgXCJmb2N1c2VkXCI6XG4gICAgICAgIGNhc2UgXCJpbnZhbGlkIHZhbHVlXCI6XG4gICAgICAgIGNhc2UgXCJsb2FkaW5nXCI6XG4gICAgICAgIGNhc2UgXCJtdXRhdGlvblwiOlxuICAgICAgICBjYXNlIFwicGF0Y2hcIjpcbiAgICAgICAgY2FzZSBcInJlYWQgb25seVwiOlxuICAgICAgICBjYXNlIFwicmVhZHlcIjpcbiAgICAgICAgY2FzZSBcInNlbGVjdGlvblwiOlxuICAgICAgICBjYXNlIFwidmFsdWUgY2hhbmdlZFwiOlxuICAgICAgICAgIGxpc3RlbmVyKGV2ZW50Mik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSksXG4gICAgX2ludGVybmFsOiB7XG4gICAgICBlZGl0YWJsZSxcbiAgICAgIGVkaXRvckFjdG9yLFxuICAgICAgc2xhdGVFZGl0b3JcbiAgICB9XG4gIH07XG4gIHJldHVybiB7XG4gICAgYWN0b3JzOiB7XG4gICAgICBlZGl0b3JBY3RvcixcbiAgICAgIG11dGF0aW9uQWN0b3IsXG4gICAgICByZWxheUFjdG9yLFxuICAgICAgc3luY0FjdG9yXG4gICAgfSxcbiAgICBlZGl0b3IsXG4gICAgc3Vic2NyaXB0aW9uc1xuICB9O1xufVxuZnVuY3Rpb24gZWRpdG9yQ29uZmlnVG9NYWNoaW5lSW5wdXQoY29uZmlnKSB7XG4gIGNvbnN0IHtcbiAgICBsZWdhY3lTY2hlbWEsXG4gICAgc2NoZW1hXG4gIH0gPSBjb21waWxlU2NoZW1hc0Zyb21FZGl0b3JDb25maWcoY29uZmlnKTtcbiAgcmV0dXJuIHtcbiAgICBjb252ZXJ0ZXJzOiBjcmVhdGVDb3JlQ29udmVydGVycyhsZWdhY3lTY2hlbWEpLFxuICAgIGdldExlZ2FjeVNjaGVtYTogKCkgPT4gbGVnYWN5U2NoZW1hLFxuICAgIGtleUdlbmVyYXRvcjogY29uZmlnLmtleUdlbmVyYXRvciA/PyBkZWZhdWx0S2V5R2VuZXJhdG9yLFxuICAgIHJlYWRPbmx5OiBjb25maWcucmVhZE9ubHksXG4gICAgc2NoZW1hLFxuICAgIGluaXRpYWxWYWx1ZTogY29uZmlnLmluaXRpYWxWYWx1ZVxuICB9O1xufVxuZnVuY3Rpb24gY29tcGlsZVNjaGVtYXNGcm9tRWRpdG9yQ29uZmlnKGNvbmZpZykge1xuICBjb25zdCBsZWdhY3lTY2hlbWEgPSBjb25maWcuc2NoZW1hRGVmaW5pdGlvbiA/IGNvbXBpbGVTY2hlbWFEZWZpbml0aW9uVG9Qb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlcyhjb25maWcuc2NoZW1hRGVmaW5pdGlvbikgOiBjcmVhdGVQb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlcyhjb25maWcuc2NoZW1hLmhhc093blByb3BlcnR5KFwianNvblR5cGVcIikgPyBjb25maWcuc2NoZW1hIDogY29tcGlsZVR5cGUoY29uZmlnLnNjaGVtYSkpLCBzY2hlbWEgPSBjb25maWcuc2NoZW1hRGVmaW5pdGlvbiA/IGNvbXBpbGVTY2hlbWEoY29uZmlnLnNjaGVtYURlZmluaXRpb24pIDogcG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXNUb1NjaGVtYShsZWdhY3lTY2hlbWEpO1xuICByZXR1cm4ge1xuICAgIGxlZ2FjeVNjaGVtYSxcbiAgICBzY2hlbWFcbiAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUFjdG9ycyhjb25maWcpIHtcbiAgZGVidWckMShcIkNyZWF0aW5nIG5ldyBBY3RvcnNcIik7XG4gIGNvbnN0IG11dGF0aW9uQWN0b3IgPSBjcmVhdGVBY3RvcihtdXRhdGlvbk1hY2hpbmUsIHtcbiAgICBpbnB1dDoge1xuICAgICAgcmVhZE9ubHk6IGNvbmZpZy5lZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLm1hdGNoZXMoe1xuICAgICAgICBcImVkaXQgbW9kZVwiOiBcInJlYWQgb25seVwiXG4gICAgICB9KSxcbiAgICAgIHNjaGVtYTogY29uZmlnLmVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5zY2hlbWEsXG4gICAgICBzbGF0ZUVkaXRvcjogY29uZmlnLnNsYXRlRWRpdG9yXG4gICAgfVxuICB9KSwgc3luY0FjdG9yID0gY3JlYXRlQWN0b3Ioc3luY01hY2hpbmUsIHtcbiAgICBpbnB1dDoge1xuICAgICAgaW5pdGlhbFZhbHVlOiBjb25maWcuZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmluaXRpYWxWYWx1ZSxcbiAgICAgIGtleUdlbmVyYXRvcjogY29uZmlnLmVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5rZXlHZW5lcmF0b3IsXG4gICAgICByZWFkT25seTogY29uZmlnLmVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkubWF0Y2hlcyh7XG4gICAgICAgIFwiZWRpdCBtb2RlXCI6IFwicmVhZCBvbmx5XCJcbiAgICAgIH0pLFxuICAgICAgc2NoZW1hOiBjb25maWcuZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LnNjaGVtYSxcbiAgICAgIHNsYXRlRWRpdG9yOiBjb25maWcuc2xhdGVFZGl0b3JcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gY29uZmlnLnN1YnNjcmlwdGlvbnMucHVzaCgoKSA9PiB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gbXV0YXRpb25BY3Rvci5vbihcIipcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC50eXBlID09PSBcImhhcyBwZW5kaW5nIG11dGF0aW9uc1wiICYmIHN5bmNBY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJoYXMgcGVuZGluZyBtdXRhdGlvbnNcIlxuICAgICAgfSksIGV2ZW50LnR5cGUgPT09IFwibXV0YXRpb25cIiAmJiAoc3luY0FjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcIm11dGF0aW9uXCJcbiAgICAgIH0pLCBjb25maWcuZWRpdG9yQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwibXV0YXRpb25cIixcbiAgICAgICAgcGF0Y2hlczogZXZlbnQucGF0Y2hlcyxcbiAgICAgICAgdmFsdWU6IGV2ZW50LnNuYXBzaG90XG4gICAgICB9KSksIGV2ZW50LnR5cGUgPT09IFwicGF0Y2hcIiAmJiBjb25maWcucmVsYXlBY3Rvci5zZW5kKGV2ZW50KTtcbiAgICB9KTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgbXV0YXRpb25BY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJlbWl0IGNoYW5nZXNcIlxuICAgICAgfSksIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gIH0pLCBjb25maWcuc3Vic2NyaXB0aW9ucy5wdXNoKCgpID0+IHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBzeW5jQWN0b3Iub24oXCIqXCIsIChldmVudCkgPT4ge1xuICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJpbnZhbGlkIHZhbHVlXCI6XG4gICAgICAgICAgY29uZmlnLnJlbGF5QWN0b3Iuc2VuZChldmVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ2YWx1ZSBjaGFuZ2VkXCI6XG4gICAgICAgICAgY29uZmlnLnJlbGF5QWN0b3Iuc2VuZChldmVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwYXRjaFwiOlxuICAgICAgICAgIGNvbmZpZy5lZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgICAgICAgIC4uLmV2ZW50LFxuICAgICAgICAgICAgdHlwZTogXCJpbnRlcm5hbC5wYXRjaFwiLFxuICAgICAgICAgICAgdmFsdWU6IGNvbmZpZy5zbGF0ZUVkaXRvci52YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbmZpZy5lZGl0b3JBY3Rvci5zZW5kKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgfSksIGNvbmZpZy5zdWJzY3JpcHRpb25zLnB1c2goKCkgPT4ge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGNvbmZpZy5lZGl0b3JBY3Rvci5zdWJzY3JpYmUoKHNuYXBzaG90KSA9PiB7XG4gICAgICBzbmFwc2hvdC5tYXRjaGVzKHtcbiAgICAgICAgXCJlZGl0IG1vZGVcIjogXCJyZWFkIG9ubHlcIlxuICAgICAgfSkgPyAobXV0YXRpb25BY3Rvci5zZW5kKHtcbiAgICAgICAgdHlwZTogXCJ1cGRhdGUgcmVhZE9ubHlcIixcbiAgICAgICAgcmVhZE9ubHk6ICEwXG4gICAgICB9KSwgc3luY0FjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcInVwZGF0ZSByZWFkT25seVwiLFxuICAgICAgICByZWFkT25seTogITBcbiAgICAgIH0pKSA6IChtdXRhdGlvbkFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcInVwZGF0ZSByZWFkT25seVwiLFxuICAgICAgICByZWFkT25seTogITFcbiAgICAgIH0pLCBzeW5jQWN0b3Iuc2VuZCh7XG4gICAgICAgIHR5cGU6IFwidXBkYXRlIHJlYWRPbmx5XCIsXG4gICAgICAgIHJlYWRPbmx5OiAhMVxuICAgICAgfSkpO1xuICAgIH0pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICB9KSwgY29uZmlnLnN1YnNjcmlwdGlvbnMucHVzaCgoKSA9PiB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gY29uZmlnLmVkaXRvckFjdG9yLm9uKFwiKlwiLCAoZXZlbnQpID0+IHtcbiAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgICBjYXNlIFwiZWRpdGFibGVcIjpcbiAgICAgICAgY2FzZSBcIm11dGF0aW9uXCI6XG4gICAgICAgIGNhc2UgXCJyZWFkeVwiOlxuICAgICAgICBjYXNlIFwicmVhZCBvbmx5XCI6XG4gICAgICAgIGNhc2UgXCJzZWxlY3Rpb25cIjpcbiAgICAgICAgICBjb25maWcucmVsYXlBY3Rvci5zZW5kKGV2ZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImludGVybmFsLnBhdGNoXCI6XG4gICAgICAgICAgbXV0YXRpb25BY3Rvci5zZW5kKHtcbiAgICAgICAgICAgIC4uLmV2ZW50LFxuICAgICAgICAgICAgdHlwZTogXCJwYXRjaFwiXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gIH0pLCB7XG4gICAgbXV0YXRpb25BY3RvcixcbiAgICBzeW5jQWN0b3JcbiAgfTtcbn1cbmZ1bmN0aW9uIGV2ZW50VG9DaGFuZ2UoZXZlbnQpIHtcbiAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgY2FzZSBcImJsdXJyZWRcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwiYmx1clwiLFxuICAgICAgICBldmVudDogZXZlbnQuZXZlbnRcbiAgICAgIH07XG4gICAgY2FzZSBcInBhdGNoXCI6XG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgY2FzZSBcImxvYWRpbmdcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwibG9hZGluZ1wiLFxuICAgICAgICBpc0xvYWRpbmc6ICEwXG4gICAgICB9O1xuICAgIGNhc2UgXCJkb25lIGxvYWRpbmdcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwibG9hZGluZ1wiLFxuICAgICAgICBpc0xvYWRpbmc6ICExXG4gICAgICB9O1xuICAgIGNhc2UgXCJmb2N1c2VkXCI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcImZvY3VzXCIsXG4gICAgICAgIGV2ZW50OiBldmVudC5ldmVudFxuICAgICAgfTtcbiAgICBjYXNlIFwidmFsdWUgY2hhbmdlZFwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJ2YWx1ZVwiLFxuICAgICAgICB2YWx1ZTogZXZlbnQudmFsdWVcbiAgICAgIH07XG4gICAgY2FzZSBcImludmFsaWQgdmFsdWVcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwiaW52YWxpZFZhbHVlXCIsXG4gICAgICAgIHJlc29sdXRpb246IGV2ZW50LnJlc29sdXRpb24sXG4gICAgICAgIHZhbHVlOiBldmVudC52YWx1ZVxuICAgICAgfTtcbiAgICBjYXNlIFwibXV0YXRpb25cIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwibXV0YXRpb25cIixcbiAgICAgICAgcGF0Y2hlczogZXZlbnQucGF0Y2hlcyxcbiAgICAgICAgc25hcHNob3Q6IGV2ZW50LnZhbHVlXG4gICAgICB9O1xuICAgIGNhc2UgXCJyZWFkeVwiOlxuICAgICAgcmV0dXJuIGV2ZW50O1xuICAgIGNhc2UgXCJzZWxlY3Rpb25cIjpcbiAgICAgIHJldHVybiBldmVudDtcbiAgICBjYXNlIFwidW5zZXRcIjpcbiAgICAgIHJldHVybiBldmVudDtcbiAgfVxufVxuY29uc3QgZGVidWcgPSBkZWJ1Z1dpdGhOYW1lKFwiY29tcG9uZW50OlBvcnRhYmxlVGV4dEVkaXRvclwiKTtcbmNsYXNzIFBvcnRhYmxlVGV4dEVkaXRvciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9IFwiUG9ydGFibGVUZXh0RWRpdG9yXCI7XG4gIC8qKlxuICAgKiBBbiBvYnNlcnZhYmxlIG9mIGFsbCB0aGUgZWRpdG9yIGNoYW5nZXMuXG4gICAqL1xuICBjaGFuZ2UkID0gbmV3IFN1YmplY3QoKTtcbiAgLyoqXG4gICAqIEEgbG9va3VwIHRhYmxlIGZvciBhbGwgdGhlIHJlbGV2YW50IHNjaGVtYSB0eXBlcyBmb3IgdGhpcyBwb3J0YWJsZSB0ZXh0IHR5cGUuXG4gICAqL1xuICAvKipcbiAgICogVGhlIGVkaXRvciBpbnN0YW5jZVxuICAgKi9cbiAgLypcbiAgICogVGhlIGVkaXRvciBBUEkgKGN1cnJlbnRseSBpbXBsZW1lbnRlZCB3aXRoIFNsYXRlKS5cbiAgICovXG4gIHN1YnNjcmlwdGlvbnMgPSBbXTtcbiAgdW5zdWJzY3JpYmVycyA9IFtdO1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIGlmIChzdXBlcihwcm9wcyksIHByb3BzLmVkaXRvcilcbiAgICAgIHRoaXMuZWRpdG9yID0gcHJvcHMuZWRpdG9yLCB0aGlzLnNjaGVtYVR5cGVzID0gdGhpcy5lZGl0b3IuX2ludGVybmFsLmVkaXRvckFjdG9yLmdldFNuYXBzaG90KCkuY29udGV4dC5nZXRMZWdhY3lTY2hlbWEoKTtcbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgYWN0b3JzLFxuICAgICAgICBlZGl0b3IsXG4gICAgICAgIHN1YnNjcmlwdGlvbnNcbiAgICAgIH0gPSBjcmVhdGVJbnRlcm5hbEVkaXRvcih7XG4gICAgICAgIGluaXRpYWxWYWx1ZTogcHJvcHMudmFsdWUsXG4gICAgICAgIGtleUdlbmVyYXRvcjogcHJvcHMua2V5R2VuZXJhdG9yLFxuICAgICAgICByZWFkT25seTogcHJvcHMucmVhZE9ubHksXG4gICAgICAgIHNjaGVtYTogcHJvcHMuc2NoZW1hVHlwZVxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBzdWJzY3JpcHRpb25zLCB0aGlzLmFjdG9ycyA9IGFjdG9ycywgdGhpcy5lZGl0b3IgPSBlZGl0b3IsIHRoaXMuc2NoZW1hVHlwZXMgPSBhY3RvcnMuZWRpdG9yQWN0b3IuZ2V0U25hcHNob3QoKS5jb250ZXh0LmdldExlZ2FjeVNjaGVtYSgpO1xuICAgIH1cbiAgICB0aGlzLmVkaXRhYmxlID0gdGhpcy5lZGl0b3IuX2ludGVybmFsLmVkaXRhYmxlO1xuICB9XG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIGlmICghdGhpcy5hY3RvcnMpXG4gICAgICByZXR1cm47XG4gICAgZm9yIChjb25zdCBzdWJzY3JpcHRpb24gb2YgdGhpcy5zdWJzY3JpcHRpb25zKVxuICAgICAgdGhpcy51bnN1YnNjcmliZXJzLnB1c2goc3Vic2NyaXB0aW9uKCkpO1xuICAgIGNvbnN0IHJlbGF5QWN0b3JTdWJzY3JpcHRpb24gPSB0aGlzLmFjdG9ycy5yZWxheUFjdG9yLm9uKFwiKlwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IGNoYW5nZSA9IGV2ZW50VG9DaGFuZ2UoZXZlbnQpO1xuICAgICAgY2hhbmdlICYmICh0aGlzLnByb3BzLmVkaXRvciB8fCB0aGlzLnByb3BzLm9uQ2hhbmdlKGNoYW5nZSksIHRoaXMuY2hhbmdlJC5uZXh0KGNoYW5nZSkpO1xuICAgIH0pO1xuICAgIHRoaXMudW5zdWJzY3JpYmVycy5wdXNoKHJlbGF5QWN0b3JTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUpLCB0aGlzLmFjdG9ycy5lZGl0b3JBY3Rvci5zdGFydCgpLCB0aGlzLmFjdG9ycy5tdXRhdGlvbkFjdG9yLnN0YXJ0KCksIHRoaXMuYWN0b3JzLnJlbGF5QWN0b3Iuc3RhcnQoKSwgdGhpcy5hY3RvcnMuc3luY0FjdG9yLnN0YXJ0KCk7XG4gIH1cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgICF0aGlzLnByb3BzLmVkaXRvciAmJiAhcHJldlByb3BzLmVkaXRvciAmJiB0aGlzLnByb3BzLnNjaGVtYVR5cGUgIT09IHByZXZQcm9wcy5zY2hlbWFUeXBlICYmIGNvbnNvbGUud2FybihcIlVwZGF0aW5nIHNjaGVtYSB0eXBlIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWRcIiksICF0aGlzLnByb3BzLmVkaXRvciAmJiAhcHJldlByb3BzLmVkaXRvciAmJiAodGhpcy5wcm9wcy5yZWFkT25seSAhPT0gcHJldlByb3BzLnJlYWRPbmx5ICYmIHRoaXMuZWRpdG9yLl9pbnRlcm5hbC5lZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgIHR5cGU6IFwidXBkYXRlIHJlYWRPbmx5XCIsXG4gICAgICByZWFkT25seTogdGhpcy5wcm9wcy5yZWFkT25seSA/PyAhMVxuICAgIH0pLCB0aGlzLnByb3BzLnZhbHVlICE9PSBwcmV2UHJvcHMudmFsdWUgJiYgdGhpcy5lZGl0b3Iuc2VuZCh7XG4gICAgICB0eXBlOiBcInVwZGF0ZSB2YWx1ZVwiLFxuICAgICAgdmFsdWU6IHRoaXMucHJvcHMudmFsdWVcbiAgICB9KSwgdGhpcy5wcm9wcy5lZGl0b3JSZWYgIT09IHByZXZQcm9wcy5lZGl0b3JSZWYgJiYgdGhpcy5wcm9wcy5lZGl0b3JSZWYgJiYgKHRoaXMucHJvcHMuZWRpdG9yUmVmLmN1cnJlbnQgPSB0aGlzKSk7XG4gIH1cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgZm9yIChjb25zdCB1bnN1YnNjcmliZSBvZiB0aGlzLnVuc3Vic2NyaWJlcnMpXG4gICAgICB1bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuYWN0b3JzICYmIChzdG9wQWN0b3IodGhpcy5hY3RvcnMuZWRpdG9yQWN0b3IpLCBzdG9wQWN0b3IodGhpcy5hY3RvcnMubXV0YXRpb25BY3RvciksIHN0b3BBY3Rvcih0aGlzLmFjdG9ycy5yZWxheUFjdG9yKSwgc3RvcEFjdG9yKHRoaXMuYWN0b3JzLnN5bmNBY3RvcikpO1xuICB9XG4gIHNldEVkaXRhYmxlID0gKGVkaXRhYmxlKSA9PiB7XG4gICAgdGhpcy5lZGl0b3IuX2ludGVybmFsLmVkaXRhYmxlID0ge1xuICAgICAgLi4udGhpcy5lZGl0b3IuX2ludGVybmFsLmVkaXRhYmxlLFxuICAgICAgLi4uZWRpdGFibGVcbiAgICB9O1xuICB9O1xuICByZW5kZXIoKSB7XG4gICAgY29uc3QgbGVnYWN5UGF0Y2hlcyA9IHRoaXMucHJvcHMuZWRpdG9yID8gdm9pZCAwIDogdGhpcy5wcm9wcy5pbmNvbWluZ1BhdGNoZXMkID8/IHRoaXMucHJvcHMucGF0Y2hlcyQ7XG4gICAgcmV0dXJuIC8qIEBfX1BVUkVfXyAqLyBqc3hzKEZyYWdtZW50LCB7IGNoaWxkcmVuOiBbXG4gICAgICBsZWdhY3lQYXRjaGVzID8gLyogQF9fUFVSRV9fICovIGpzeChSb3V0ZVBhdGNoZXNPYnNlcnZhYmxlVG9FZGl0b3JBY3RvciwgeyBlZGl0b3JBY3RvcjogdGhpcy5lZGl0b3IuX2ludGVybmFsLmVkaXRvckFjdG9yLCBwYXRjaGVzJDogbGVnYWN5UGF0Y2hlcyB9KSA6IG51bGwsXG4gICAgICAvKiBAX19QVVJFX18gKi8ganN4KEVkaXRvckFjdG9yQ29udGV4dC5Qcm92aWRlciwgeyB2YWx1ZTogdGhpcy5lZGl0b3IuX2ludGVybmFsLmVkaXRvckFjdG9yLCBjaGlsZHJlbjogLyogQF9fUFVSRV9fICovIGpzeChSZWxheUFjdG9yQ29udGV4dC5Qcm92aWRlciwgeyB2YWx1ZTogdGhpcy5hY3RvcnMucmVsYXlBY3RvciwgY2hpbGRyZW46IC8qIEBfX1BVUkVfXyAqLyBqc3goU2xhdGUsIHsgZWRpdG9yOiB0aGlzLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5zdGFuY2UsIGluaXRpYWxWYWx1ZTogdGhpcy5lZGl0b3IuX2ludGVybmFsLnNsYXRlRWRpdG9yLmluaXRpYWxWYWx1ZSwgY2hpbGRyZW46IC8qIEBfX1BVUkVfXyAqLyBqc3goUG9ydGFibGVUZXh0RWRpdG9yQ29udGV4dC5Qcm92aWRlciwgeyB2YWx1ZTogdGhpcywgY2hpbGRyZW46IHRoaXMucHJvcHMuY2hpbGRyZW4gfSkgfSkgfSkgfSlcbiAgICBdIH0pO1xuICB9XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYnVpbHQtaW4gc2VsZWN0b3JzIG9yIHdyaXRlIHlvdXIgb3duOiBodHRwczovL3d3dy5wb3J0YWJsZXRleHQub3JnL3JlZmVyZW5jZS9zZWxlY3RvcnMvXG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgKiBhcyBzZWxlY3RvcnMgZnJvbSAnQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzJ1xuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBjb25zdCBpc0FjdGl2ZSA9IHVzZUVkaXRvclNlbGVjdG9yKGVkaXRvciwgc2VsZWN0b3JzLmdldEFjdGl2ZUFubm90YXRpb25zKVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBhY3RpdmVBbm5vdGF0aW9ucyA9IChlZGl0b3IpID0+IGVkaXRvciAmJiBlZGl0b3IuZWRpdGFibGUgPyBlZGl0b3IuZWRpdGFibGUuYWN0aXZlQW5ub3RhdGlvbnMoKSA6IFtdO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGJ1aWx0LWluIHNlbGVjdG9ycyBvciB3cml0ZSB5b3VyIG93bjogaHR0cHM6Ly93d3cucG9ydGFibGV0ZXh0Lm9yZy9yZWZlcmVuY2Uvc2VsZWN0b3JzL1xuICAgKlxuICAgKiBgYGBcbiAgICogaW1wb3J0ICogYXMgc2VsZWN0b3JzIGZyb20gJ0Bwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9ycydcbiAgICogY29uc3QgZWRpdG9yID0gdXNlRWRpdG9yKClcbiAgICogY29uc3QgaXNBY3RpdmUgPSB1c2VFZGl0b3JTZWxlY3RvcihlZGl0b3IsIHNlbGVjdG9ycy5pc0FjdGl2ZUFubm90YXRpb24oLi4uKSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgaXNBbm5vdGF0aW9uQWN0aXZlID0gKGVkaXRvciwgYW5ub3RhdGlvblR5cGUpID0+IGVkaXRvciAmJiBlZGl0b3IuZWRpdGFibGUgPyBlZGl0b3IuZWRpdGFibGUuaXNBbm5vdGF0aW9uQWN0aXZlKGFubm90YXRpb25UeXBlKSA6ICExO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGBlZGl0b3Iuc2VuZCguLi4pYCBpbnN0ZWFkXG4gICAqXG4gICAqIGBgYFxuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBlZGl0b3Iuc2VuZCh7XG4gICAqICB0eXBlOiAnYW5ub3RhdGlvbi5hZGQnLFxuICAgKiAgYW5ub3RhdGlvbjoge1xuICAgKiAgICBuYW1lOiAnLi4uJyxcbiAgICogICAgdmFsdWU6IHsuLi59LFxuICAgKiAgfVxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBhZGRBbm5vdGF0aW9uID0gKGVkaXRvciwgdHlwZSwgdmFsdWUpID0+IGVkaXRvci5lZGl0YWJsZT8uYWRkQW5ub3RhdGlvbih0eXBlLCB2YWx1ZSk7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdibHVyJyxcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgYmx1ciA9IChlZGl0b3IpID0+IHtcbiAgICBkZWJ1ZyhcIkhvc3QgYmx1cnJlZFwiKSwgZWRpdG9yLmVkaXRhYmxlPy5ibHVyKCk7XG4gIH07XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdkZWxldGUnLFxuICAgKiAgYXQ6IHsuLi59LFxuICAgKiAgZGlyZWN0aW9uOiAnLi4uJyxcbiAgICogIHVuaXQ6ICcuLi4nLFxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBkZWxldGUgPSAoZWRpdG9yLCBzZWxlY3Rpb24sIG9wdGlvbnMpID0+IGVkaXRvci5lZGl0YWJsZT8uZGVsZXRlKHNlbGVjdGlvbiwgb3B0aW9ucyk7XG4gIHN0YXRpYyBmaW5kRE9NTm9kZSA9IChlZGl0b3IsIGVsZW1lbnQpID0+IGVkaXRvci5lZGl0YWJsZT8uZmluZERPTU5vZGUoZWxlbWVudCk7XG4gIHN0YXRpYyBmaW5kQnlQYXRoID0gKGVkaXRvciwgcGF0aCkgPT4gZWRpdG9yLmVkaXRhYmxlPy5maW5kQnlQYXRoKHBhdGgpIHx8IFtdO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGBlZGl0b3Iuc2VuZCguLi4pYCBpbnN0ZWFkXG4gICAqXG4gICAqIGBgYFxuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBlZGl0b3Iuc2VuZCh7XG4gICAqICB0eXBlOiAnZm9jdXMnLFxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBmb2N1cyA9IChlZGl0b3IpID0+IHtcbiAgICBkZWJ1ZyhcIkhvc3QgcmVxdWVzdGluZyBmb2N1c1wiKSwgZWRpdG9yLmVkaXRhYmxlPy5mb2N1cygpO1xuICB9O1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGJ1aWx0LWluIHNlbGVjdG9ycyBvciB3cml0ZSB5b3VyIG93bjogaHR0cHM6Ly93d3cucG9ydGFibGV0ZXh0Lm9yZy9yZWZlcmVuY2Uvc2VsZWN0b3JzL1xuICAgKlxuICAgKiBgYGBcbiAgICogaW1wb3J0ICogYXMgc2VsZWN0b3JzIGZyb20gJ0Bwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9ycydcbiAgICogY29uc3QgZWRpdG9yID0gdXNlRWRpdG9yKClcbiAgICogY29uc3QgZm9jdXNCbG9jayA9IHVzZUVkaXRvclNlbGVjdG9yKGVkaXRvciwgc2VsZWN0b3JzLmdldEZvY3VzQmxvY2spXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGZvY3VzQmxvY2sgPSAoZWRpdG9yKSA9PiBlZGl0b3IuZWRpdGFibGU/LmZvY3VzQmxvY2soKTtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIFVzZSBidWlsdC1pbiBzZWxlY3RvcnMgb3Igd3JpdGUgeW91ciBvd246IGh0dHBzOi8vd3d3LnBvcnRhYmxldGV4dC5vcmcvcmVmZXJlbmNlL3NlbGVjdG9ycy9cbiAgICpcbiAgICogYGBgXG4gICAqIGltcG9ydCAqIGFzIHNlbGVjdG9ycyBmcm9tICdAcG9ydGFibGV0ZXh0L2VkaXRvci9zZWxlY3RvcnMnXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGNvbnN0IGZvY3VzQ2hpbGQgPSB1c2VFZGl0b3JTZWxlY3RvcihlZGl0b3IsIHNlbGVjdG9ycy5nZXRGb2N1c0NoaWxkKVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBmb2N1c0NoaWxkID0gKGVkaXRvcikgPT4gZWRpdG9yLmVkaXRhYmxlPy5mb2N1c0NoaWxkKCk7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYnVpbHQtaW4gc2VsZWN0b3JzIG9yIHdyaXRlIHlvdXIgb3duOiBodHRwczovL3d3dy5wb3J0YWJsZXRleHQub3JnL3JlZmVyZW5jZS9zZWxlY3RvcnMvXG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgKiBhcyBzZWxlY3RvcnMgZnJvbSAnQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzJ1xuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBjb25zdCBzZWxlY3Rpb24gPSB1c2VFZGl0b3JTZWxlY3RvcihlZGl0b3IsIHNlbGVjdG9ycy5nZXRTZWxlY3Rpb24pXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGdldFNlbGVjdGlvbiA9IChlZGl0b3IpID0+IGVkaXRvci5lZGl0YWJsZSA/IGVkaXRvci5lZGl0YWJsZS5nZXRTZWxlY3Rpb24oKSA6IG51bGw7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYnVpbHQtaW4gc2VsZWN0b3JzIG9yIHdyaXRlIHlvdXIgb3duOiBodHRwczovL3d3dy5wb3J0YWJsZXRleHQub3JnL3JlZmVyZW5jZS9zZWxlY3RvcnMvXG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgKiBhcyBzZWxlY3RvcnMgZnJvbSAnQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzJ1xuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBjb25zdCB2YWx1ZSA9IHVzZUVkaXRvclNlbGVjdG9yKGVkaXRvciwgc2VsZWN0b3JzLmdldFZhbHVlKVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBnZXRWYWx1ZSA9IChlZGl0b3IpID0+IGVkaXRvci5lZGl0YWJsZT8uZ2V0VmFsdWUoKTtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIFVzZSBidWlsdC1pbiBzZWxlY3RvcnMgb3Igd3JpdGUgeW91ciBvd246IGh0dHBzOi8vd3d3LnBvcnRhYmxldGV4dC5vcmcvcmVmZXJlbmNlL3NlbGVjdG9ycy9cbiAgICpcbiAgICogYGBgXG4gICAqIGltcG9ydCAqIGFzIHNlbGVjdG9ycyBmcm9tICdAcG9ydGFibGV0ZXh0L2VkaXRvci9zZWxlY3RvcnMnXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGNvbnN0IGlzQWN0aXZlID0gdXNlRWRpdG9yU2VsZWN0b3IoZWRpdG9yLCBzZWxlY3RvcnMuaXNBY3RpdmVTdHlsZSguLi4pKVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyBoYXNCbG9ja1N0eWxlID0gKGVkaXRvciwgYmxvY2tTdHlsZSkgPT4gZWRpdG9yLmVkaXRhYmxlPy5oYXNCbG9ja1N0eWxlKGJsb2NrU3R5bGUpO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGJ1aWx0LWluIHNlbGVjdG9ycyBvciB3cml0ZSB5b3VyIG93bjogaHR0cHM6Ly93d3cucG9ydGFibGV0ZXh0Lm9yZy9yZWZlcmVuY2Uvc2VsZWN0b3JzL1xuICAgKlxuICAgKiBgYGBcbiAgICogaW1wb3J0ICogYXMgc2VsZWN0b3JzIGZyb20gJ0Bwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9ycydcbiAgICogY29uc3QgZWRpdG9yID0gdXNlRWRpdG9yKClcbiAgICogY29uc3QgaXNBY3RpdmUgPSB1c2VFZGl0b3JTZWxlY3RvcihlZGl0b3IsIHNlbGVjdG9ycy5pc0FjdGl2ZUxpc3RJdGVtKC4uLikpXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGhhc0xpc3RTdHlsZSA9IChlZGl0b3IsIGxpc3RTdHlsZSkgPT4gZWRpdG9yLmVkaXRhYmxlPy5oYXNMaXN0U3R5bGUobGlzdFN0eWxlKTtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIFVzZSBidWlsdC1pbiBzZWxlY3RvcnMgb3Igd3JpdGUgeW91ciBvd246IGh0dHBzOi8vd3d3LnBvcnRhYmxldGV4dC5vcmcvcmVmZXJlbmNlL3NlbGVjdG9ycy9cbiAgICpcbiAgICogYGBgXG4gICAqIGltcG9ydCAqIGFzIHNlbGVjdG9ycyBmcm9tICdAcG9ydGFibGV0ZXh0L2VkaXRvci9zZWxlY3RvcnMnXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGNvbnN0IGlzU2VsZWN0aW9uQ29sbGFwc2VkID0gdXNlRWRpdG9yU2VsZWN0b3IoZWRpdG9yLCBzZWxlY3RvcnMuaXNTZWxlY3Rpb25Db2xsYXBzZWQpXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGlzQ29sbGFwc2VkU2VsZWN0aW9uID0gKGVkaXRvcikgPT4gZWRpdG9yLmVkaXRhYmxlPy5pc0NvbGxhcHNlZFNlbGVjdGlvbigpO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGJ1aWx0LWluIHNlbGVjdG9ycyBvciB3cml0ZSB5b3VyIG93bjogaHR0cHM6Ly93d3cucG9ydGFibGV0ZXh0Lm9yZy9yZWZlcmVuY2Uvc2VsZWN0b3JzL1xuICAgKlxuICAgKiBgYGBcbiAgICogaW1wb3J0ICogYXMgc2VsZWN0b3JzIGZyb20gJ0Bwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9ycydcbiAgICogY29uc3QgZWRpdG9yID0gdXNlRWRpdG9yKClcbiAgICogY29uc3QgaXNTZWxlY3Rpb25FeHBhbmRlZCA9IHVzZUVkaXRvclNlbGVjdG9yKGVkaXRvciwgc2VsZWN0b3JzLmlzU2VsZWN0aW9uRXhwYW5kZWQpXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGlzRXhwYW5kZWRTZWxlY3Rpb24gPSAoZWRpdG9yKSA9PiBlZGl0b3IuZWRpdGFibGU/LmlzRXhwYW5kZWRTZWxlY3Rpb24oKTtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIFVzZSBidWlsdC1pbiBzZWxlY3RvcnMgb3Igd3JpdGUgeW91ciBvd246IGh0dHBzOi8vd3d3LnBvcnRhYmxldGV4dC5vcmcvcmVmZXJlbmNlL3NlbGVjdG9ycy9cbiAgICpcbiAgICogYGBgXG4gICAqIGltcG9ydCAqIGFzIHNlbGVjdG9ycyBmcm9tICdAcG9ydGFibGV0ZXh0L2VkaXRvci9zZWxlY3RvcnMnXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGNvbnN0IGlzQWN0aXZlID0gdXNlRWRpdG9yU2VsZWN0b3IoZWRpdG9yLCBzZWxlY3RvcnMuaXNBY3RpdmVEZWNvcmF0b3IoLi4uKSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgaXNNYXJrQWN0aXZlID0gKGVkaXRvciwgbWFyaykgPT4gZWRpdG9yLmVkaXRhYmxlPy5pc01hcmtBY3RpdmUobWFyayk7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdpbnNlcnQuc3BhbicsXG4gICAqICB0ZXh0OiAnLi4uJyxcbiAgICogIGFubm90YXRpb25zOiBbe25hbWU6ICcuLi4nLCB2YWx1ZTogey4uLn19XSxcbiAgICogIGRlY29yYXRvcnM6IFsnLi4uJ10sXG4gICAqIH0pXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdpbnNlcnQuaW5saW5lIG9iamVjdCcsXG4gICAqICBpbmxpbmVPYmplY3Q6IHtcbiAgICogICAgbmFtZTogJy4uLicsXG4gICAqICAgIHZhbHVlOiB7Li4ufSxcbiAgICogIH0sXG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGluc2VydENoaWxkID0gKGVkaXRvciwgdHlwZSwgdmFsdWUpID0+IChkZWJ1ZyhcIkhvc3QgaW5zZXJ0aW5nIGNoaWxkXCIpLCBlZGl0b3IuZWRpdGFibGU/Lmluc2VydENoaWxkKHR5cGUsIHZhbHVlKSk7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdpbnNlcnQuYmxvY2sgb2JqZWN0JyxcbiAgICogIGJsb2NrT2JqZWN0OiB7XG4gICAqICAgIG5hbWU6ICcuLi4nLFxuICAgKiAgICB2YWx1ZTogey4uLn0sXG4gICAqICB9LFxuICAgKiAgcGxhY2VtZW50OiAnYXV0bycgfCAnYWZ0ZXInIHwgJ2JlZm9yZScsXG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGluc2VydEJsb2NrID0gKGVkaXRvciwgdHlwZSwgdmFsdWUpID0+IGVkaXRvci5lZGl0YWJsZT8uaW5zZXJ0QmxvY2sodHlwZSwgdmFsdWUpO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGBlZGl0b3Iuc2VuZCguLi4pYCBpbnN0ZWFkXG4gICAqXG4gICAqIGBgYFxuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBlZGl0b3Iuc2VuZCh7XG4gICAqICB0eXBlOiAnaW5zZXJ0LmJyZWFrJyxcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgaW5zZXJ0QnJlYWsgPSAoZWRpdG9yKSA9PiBlZGl0b3IuZWRpdGFibGU/Lmluc2VydEJyZWFrKCk7XG4gIHN0YXRpYyBpc1ZvaWQgPSAoZWRpdG9yLCBlbGVtZW50KSA9PiBlZGl0b3IuZWRpdGFibGU/LmlzVm9pZChlbGVtZW50KTtcbiAgc3RhdGljIGlzT2JqZWN0UGF0aCA9IChfZWRpdG9yLCBwYXRoKSA9PiB7XG4gICAgaWYgKCFwYXRoIHx8ICFBcnJheS5pc0FycmF5KHBhdGgpKVxuICAgICAgcmV0dXJuICExO1xuICAgIGNvbnN0IGlzQ2hpbGRPYmplY3RFZGl0UGF0aCA9IHBhdGgubGVuZ3RoID4gMyAmJiBwYXRoWzFdID09PSBcImNoaWxkcmVuXCI7XG4gICAgcmV0dXJuIHBhdGgubGVuZ3RoID4gMSAmJiBwYXRoWzFdICE9PSBcImNoaWxkcmVuXCIgfHwgaXNDaGlsZE9iamVjdEVkaXRQYXRoO1xuICB9O1xuICBzdGF0aWMgbWFya3MgPSAoZWRpdG9yKSA9PiBlZGl0b3IuZWRpdGFibGU/Lm1hcmtzKCk7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdzZWxlY3QnLFxuICAgKiAgc2VsZWN0aW9uOiB7Li4ufSxcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgc2VsZWN0ID0gKGVkaXRvciwgc2VsZWN0aW9uKSA9PiB7XG4gICAgZGVidWcoXCJIb3N0IHNldHRpbmcgc2VsZWN0aW9uXCIsIHNlbGVjdGlvbiksIGVkaXRvci5lZGl0YWJsZT8uc2VsZWN0KHNlbGVjdGlvbik7XG4gIH07XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogIHR5cGU6ICdhbm5vdGF0aW9uLnJlbW92ZScsXG4gICAqICBhbm5vdGF0aW9uOiB7XG4gICAqICAgIG5hbWU6ICcuLi4nLFxuICAgKiAgfSxcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgcmVtb3ZlQW5ub3RhdGlvbiA9IChlZGl0b3IsIHR5cGUpID0+IGVkaXRvci5lZGl0YWJsZT8ucmVtb3ZlQW5ub3RhdGlvbih0eXBlKTtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIFVzZSBgZWRpdG9yLnNlbmQoLi4uKWAgaW5zdGVhZFxuICAgKlxuICAgKiBgYGBcbiAgICogY29uc3QgZWRpdG9yID0gdXNlRWRpdG9yKClcbiAgICogZWRpdG9yLnNlbmQoe1xuICAgKiAgdHlwZTogJ3N0eWxlLnRvZ2dsZScsXG4gICAqICBzdHlsZTogJy4uLicsXG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIHRvZ2dsZUJsb2NrU3R5bGUgPSAoZWRpdG9yLCBibG9ja1N0eWxlKSA9PiAoZGVidWcoXCJIb3N0IGlzIHRvZ2dsaW5nIGJsb2NrIHN0eWxlXCIpLCBlZGl0b3IuZWRpdGFibGU/LnRvZ2dsZUJsb2NrU3R5bGUoYmxvY2tTdHlsZSkpO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGBlZGl0b3Iuc2VuZCguLi4pYCBpbnN0ZWFkXG4gICAqXG4gICAqIGBgYFxuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBlZGl0b3Iuc2VuZCh7XG4gICAqICB0eXBlOiAnbGlzdCBpdGVtLnRvZ2dsZScsXG4gICAqICBsaXN0SXRlbTogJy4uLicsXG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIHRvZ2dsZUxpc3QgPSAoZWRpdG9yLCBsaXN0U3R5bGUpID0+IGVkaXRvci5lZGl0YWJsZT8udG9nZ2xlTGlzdChsaXN0U3R5bGUpO1xuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogVXNlIGBlZGl0b3Iuc2VuZCguLi4pYCBpbnN0ZWFkXG4gICAqXG4gICAqIGBgYFxuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBlZGl0b3Iuc2VuZCh7XG4gICAqICB0eXBlOiAnZGVjb3JhdG9yLnRvZ2dsZScsXG4gICAqICBkZWNvcmF0b3I6ICcuLi4nLFxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyB0b2dnbGVNYXJrID0gKGVkaXRvciwgbWFyaykgPT4ge1xuICAgIGRlYnVnKFwiSG9zdCB0b2dnbGluZyBtYXJrXCIsIG1hcmspLCBlZGl0b3IuZWRpdGFibGU/LnRvZ2dsZU1hcmsobWFyayk7XG4gIH07XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYnVpbHQtaW4gc2VsZWN0b3JzIG9yIHdyaXRlIHlvdXIgb3duOiBodHRwczovL3d3dy5wb3J0YWJsZXRleHQub3JnL3JlZmVyZW5jZS9zZWxlY3RvcnMvXG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgKiBhcyBzZWxlY3RvcnMgZnJvbSAnQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzJ1xuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBjb25zdCBzZWxlY3RlZFZhbHVlID0gdXNlRWRpdG9yU2VsZWN0b3IoZWRpdG9yLCBzZWxlY3RvcnMuZ2V0U2VsZWN0ZWRWYWx1ZSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgZ2V0RnJhZ21lbnQgPSAoZWRpdG9yKSA9PiBlZGl0b3IuZWRpdGFibGU/LmdldEZyYWdtZW50KCk7XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogICB0eXBlOiAnaGlzdG9yeS51bmRvJyxcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgdW5kbyA9IChlZGl0b3IpID0+IHtcbiAgICBkZWJ1ZyhcIkhvc3QgdW5kb2luZ1wiKSwgZWRpdG9yLmVkaXRhYmxlPy51bmRvKCk7XG4gIH07XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYGVkaXRvci5zZW5kKC4uLilgIGluc3RlYWRcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGVkaXRvciA9IHVzZUVkaXRvcigpXG4gICAqIGVkaXRvci5zZW5kKHtcbiAgICogICB0eXBlOiAnaGlzdG9yeS5yZWRvJyxcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgcmVkbyA9IChlZGl0b3IpID0+IHtcbiAgICBkZWJ1ZyhcIkhvc3QgcmVkb2luZ1wiKSwgZWRpdG9yLmVkaXRhYmxlPy5yZWRvKCk7XG4gIH07XG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBVc2UgYnVpbHQtaW4gc2VsZWN0b3JzIG9yIHdyaXRlIHlvdXIgb3duOiBodHRwczovL3d3dy5wb3J0YWJsZXRleHQub3JnL3JlZmVyZW5jZS9zZWxlY3RvcnMvXG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgKiBhcyBzZWxlY3RvcnMgZnJvbSAnQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzJ1xuICAgKiBjb25zdCBlZGl0b3IgPSB1c2VFZGl0b3IoKVxuICAgKiBjb25zdCBpc092ZXJsYXBwaW5nID0gdXNlRWRpdG9yU2VsZWN0b3IoZWRpdG9yLCBzZWxlY3RvcnMuaXNPdmVybGFwcGluZ1NlbGVjdGlvbihzZWxlY3Rpb25CKSlcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgaXNTZWxlY3Rpb25zT3ZlcmxhcHBpbmcgPSAoZWRpdG9yLCBzZWxlY3Rpb25BLCBzZWxlY3Rpb25CKSA9PiBlZGl0b3IuZWRpdGFibGU/LmlzU2VsZWN0aW9uc092ZXJsYXBwaW5nKHNlbGVjdGlvbkEsIHNlbGVjdGlvbkIpO1xufVxuZnVuY3Rpb24gUm91dGVQYXRjaGVzT2JzZXJ2YWJsZVRvRWRpdG9yQWN0b3IocHJvcHMpIHtcbiAgY29uc3QgJCA9IGMoNCk7XG4gIGxldCB0MCwgdDE7XG4gIHJldHVybiAkWzBdICE9PSBwcm9wcy5lZGl0b3JBY3RvciB8fCAkWzFdICE9PSBwcm9wcy5wYXRjaGVzJCA/ICh0MCA9ICgpID0+IHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBwcm9wcy5wYXRjaGVzJC5zdWJzY3JpYmUoKHBheWxvYWQpID0+IHtcbiAgICAgIHByb3BzLmVkaXRvckFjdG9yLnNlbmQoe1xuICAgICAgICB0eXBlOiBcInBhdGNoZXNcIixcbiAgICAgICAgLi4ucGF5bG9hZFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gIH0sIHQxID0gW3Byb3BzLmVkaXRvckFjdG9yLCBwcm9wcy5wYXRjaGVzJF0sICRbMF0gPSBwcm9wcy5lZGl0b3JBY3RvciwgJFsxXSA9IHByb3BzLnBhdGNoZXMkLCAkWzJdID0gdDAsICRbM10gPSB0MSkgOiAodDAgPSAkWzJdLCB0MSA9ICRbM10pLCB1c2VFZmZlY3QodDAsIHQxKSwgbnVsbDtcbn1cbmZ1bmN0aW9uIEVkaXRvclByb3ZpZGVyKHByb3BzKSB7XG4gIGNvbnN0ICQgPSBjKDI5KTtcbiAgbGV0IHQwO1xuICAkWzBdICE9PSBwcm9wcy5pbml0aWFsQ29uZmlnID8gKHQwID0gKCkgPT4ge1xuICAgIGNvbnN0IGludGVybmFsRWRpdG9yID0gY3JlYXRlSW50ZXJuYWxFZGl0b3IocHJvcHMuaW5pdGlhbENvbmZpZyksIHBvcnRhYmxlVGV4dEVkaXRvciA9IG5ldyBQb3J0YWJsZVRleHRFZGl0b3Ioe1xuICAgICAgZWRpdG9yOiBpbnRlcm5hbEVkaXRvci5lZGl0b3JcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgaW50ZXJuYWxFZGl0b3IsXG4gICAgICBwb3J0YWJsZVRleHRFZGl0b3JcbiAgICB9O1xuICB9LCAkWzBdID0gcHJvcHMuaW5pdGlhbENvbmZpZywgJFsxXSA9IHQwKSA6IHQwID0gJFsxXTtcbiAgY29uc3QgW3QxXSA9IHVzZVN0YXRlKHQwKSwge1xuICAgIGludGVybmFsRWRpdG9yOiBpbnRlcm5hbEVkaXRvcl8wLFxuICAgIHBvcnRhYmxlVGV4dEVkaXRvcjogcG9ydGFibGVUZXh0RWRpdG9yXzBcbiAgfSA9IHQxO1xuICBsZXQgdDI7XG4gICRbMl0gIT09IGludGVybmFsRWRpdG9yXzAuYWN0b3JzLmVkaXRvckFjdG9yIHx8ICRbM10gIT09IGludGVybmFsRWRpdG9yXzAuYWN0b3JzLm11dGF0aW9uQWN0b3IgfHwgJFs0XSAhPT0gaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMucmVsYXlBY3RvciB8fCAkWzVdICE9PSBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5zeW5jQWN0b3IgfHwgJFs2XSAhPT0gaW50ZXJuYWxFZGl0b3JfMC5lZGl0b3IuX2ludGVybmFsLnNsYXRlRWRpdG9yLmluc3RhbmNlIHx8ICRbN10gIT09IGludGVybmFsRWRpdG9yXzAuc3Vic2NyaXB0aW9ucyB8fCAkWzhdICE9PSBwb3J0YWJsZVRleHRFZGl0b3JfMCA/ICh0MiA9ICgpID0+IHtcbiAgICBjb25zdCB1bnN1YnNjcmliZXJzID0gW107XG4gICAgZm9yIChjb25zdCBzdWJzY3JpcHRpb24gb2YgaW50ZXJuYWxFZGl0b3JfMC5zdWJzY3JpcHRpb25zKVxuICAgICAgdW5zdWJzY3JpYmVycy5wdXNoKHN1YnNjcmlwdGlvbigpKTtcbiAgICBjb25zdCByZWxheUFjdG9yU3Vic2NyaXB0aW9uID0gaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMucmVsYXlBY3Rvci5vbihcIipcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBjaGFuZ2UgPSBldmVudFRvQ2hhbmdlKGV2ZW50KTtcbiAgICAgIGNoYW5nZSAmJiBwb3J0YWJsZVRleHRFZGl0b3JfMC5jaGFuZ2UkLm5leHQoY2hhbmdlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdW5zdWJzY3JpYmVycy5wdXNoKHJlbGF5QWN0b3JTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUpLCBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5lZGl0b3JBY3Rvci5zdGFydCgpLCBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5lZGl0b3JBY3Rvci5zZW5kKHtcbiAgICAgIHR5cGU6IFwiYWRkIHNsYXRlIGVkaXRvclwiLFxuICAgICAgZWRpdG9yOiBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5zdGFuY2VcbiAgICB9KSwgaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMubXV0YXRpb25BY3Rvci5zdGFydCgpLCBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5yZWxheUFjdG9yLnN0YXJ0KCksIGludGVybmFsRWRpdG9yXzAuYWN0b3JzLnN5bmNBY3Rvci5zdGFydCgpLCAoKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHVuc3Vic2NyaWJlIG9mIHVuc3Vic2NyaWJlcnMpXG4gICAgICAgIHVuc3Vic2NyaWJlKCk7XG4gICAgICBzdG9wQWN0b3IoaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMuZWRpdG9yQWN0b3IpLCBzdG9wQWN0b3IoaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMubXV0YXRpb25BY3RvciksIHN0b3BBY3RvcihpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5yZWxheUFjdG9yKSwgc3RvcEFjdG9yKGludGVybmFsRWRpdG9yXzAuYWN0b3JzLnN5bmNBY3Rvcik7XG4gICAgfTtcbiAgfSwgJFsyXSA9IGludGVybmFsRWRpdG9yXzAuYWN0b3JzLmVkaXRvckFjdG9yLCAkWzNdID0gaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMubXV0YXRpb25BY3RvciwgJFs0XSA9IGludGVybmFsRWRpdG9yXzAuYWN0b3JzLnJlbGF5QWN0b3IsICRbNV0gPSBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5zeW5jQWN0b3IsICRbNl0gPSBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5zdGFuY2UsICRbN10gPSBpbnRlcm5hbEVkaXRvcl8wLnN1YnNjcmlwdGlvbnMsICRbOF0gPSBwb3J0YWJsZVRleHRFZGl0b3JfMCwgJFs5XSA9IHQyKSA6IHQyID0gJFs5XTtcbiAgbGV0IHQzO1xuICAkWzEwXSAhPT0gaW50ZXJuYWxFZGl0b3JfMCB8fCAkWzExXSAhPT0gcG9ydGFibGVUZXh0RWRpdG9yXzAgPyAodDMgPSBbaW50ZXJuYWxFZGl0b3JfMCwgcG9ydGFibGVUZXh0RWRpdG9yXzBdLCAkWzEwXSA9IGludGVybmFsRWRpdG9yXzAsICRbMTFdID0gcG9ydGFibGVUZXh0RWRpdG9yXzAsICRbMTJdID0gdDMpIDogdDMgPSAkWzEyXSwgdXNlRWZmZWN0KHQyLCB0Myk7XG4gIGxldCB0NDtcbiAgJFsxM10gIT09IHBvcnRhYmxlVGV4dEVkaXRvcl8wIHx8ICRbMTRdICE9PSBwcm9wcy5jaGlsZHJlbiA/ICh0NCA9IC8qIEBfX1BVUkVfXyAqLyBqc3goUG9ydGFibGVUZXh0RWRpdG9yQ29udGV4dC5Qcm92aWRlciwgeyB2YWx1ZTogcG9ydGFibGVUZXh0RWRpdG9yXzAsIGNoaWxkcmVuOiBwcm9wcy5jaGlsZHJlbiB9KSwgJFsxM10gPSBwb3J0YWJsZVRleHRFZGl0b3JfMCwgJFsxNF0gPSBwcm9wcy5jaGlsZHJlbiwgJFsxNV0gPSB0NCkgOiB0NCA9ICRbMTVdO1xuICBsZXQgdDU7XG4gICRbMTZdICE9PSBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5pdGlhbFZhbHVlIHx8ICRbMTddICE9PSBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5zdGFuY2UgfHwgJFsxOF0gIT09IHQ0ID8gKHQ1ID0gLyogQF9fUFVSRV9fICovIGpzeChTbGF0ZSwgeyBlZGl0b3I6IGludGVybmFsRWRpdG9yXzAuZWRpdG9yLl9pbnRlcm5hbC5zbGF0ZUVkaXRvci5pbnN0YW5jZSwgaW5pdGlhbFZhbHVlOiBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5pdGlhbFZhbHVlLCBjaGlsZHJlbjogdDQgfSksICRbMTZdID0gaW50ZXJuYWxFZGl0b3JfMC5lZGl0b3IuX2ludGVybmFsLnNsYXRlRWRpdG9yLmluaXRpYWxWYWx1ZSwgJFsxN10gPSBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvci5faW50ZXJuYWwuc2xhdGVFZGl0b3IuaW5zdGFuY2UsICRbMThdID0gdDQsICRbMTldID0gdDUpIDogdDUgPSAkWzE5XTtcbiAgbGV0IHQ2O1xuICAkWzIwXSAhPT0gaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMucmVsYXlBY3RvciB8fCAkWzIxXSAhPT0gdDUgPyAodDYgPSAvKiBAX19QVVJFX18gKi8ganN4KFJlbGF5QWN0b3JDb250ZXh0LlByb3ZpZGVyLCB7IHZhbHVlOiBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5yZWxheUFjdG9yLCBjaGlsZHJlbjogdDUgfSksICRbMjBdID0gaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMucmVsYXlBY3RvciwgJFsyMV0gPSB0NSwgJFsyMl0gPSB0NikgOiB0NiA9ICRbMjJdO1xuICBsZXQgdDc7XG4gICRbMjNdICE9PSBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5lZGl0b3JBY3RvciB8fCAkWzI0XSAhPT0gdDYgPyAodDcgPSAvKiBAX19QVVJFX18gKi8ganN4KEVkaXRvckFjdG9yQ29udGV4dC5Qcm92aWRlciwgeyB2YWx1ZTogaW50ZXJuYWxFZGl0b3JfMC5hY3RvcnMuZWRpdG9yQWN0b3IsIGNoaWxkcmVuOiB0NiB9KSwgJFsyM10gPSBpbnRlcm5hbEVkaXRvcl8wLmFjdG9ycy5lZGl0b3JBY3RvciwgJFsyNF0gPSB0NiwgJFsyNV0gPSB0NykgOiB0NyA9ICRbMjVdO1xuICBsZXQgdDg7XG4gIHJldHVybiAkWzI2XSAhPT0gaW50ZXJuYWxFZGl0b3JfMC5lZGl0b3IgfHwgJFsyN10gIT09IHQ3ID8gKHQ4ID0gLyogQF9fUFVSRV9fICovIGpzeChFZGl0b3JDb250ZXh0LlByb3ZpZGVyLCB7IHZhbHVlOiBpbnRlcm5hbEVkaXRvcl8wLmVkaXRvciwgY2hpbGRyZW46IHQ3IH0pLCAkWzI2XSA9IGludGVybmFsRWRpdG9yXzAuZWRpdG9yLCAkWzI3XSA9IHQ3LCAkWzI4XSA9IHQ4KSA6IHQ4ID0gJFsyOF0sIHQ4O1xufVxuY29uc3QgdXNlUG9ydGFibGVUZXh0RWRpdG9yU2VsZWN0aW9uID0gKCkgPT4ge1xuICBjb25zdCAkID0gYyg1KSwgZWRpdG9yQWN0b3IgPSB1c2VDb250ZXh0KEVkaXRvckFjdG9yQ29udGV4dCk7XG4gIGxldCB0MDtcbiAgJFswXSAhPT0gZWRpdG9yQWN0b3IgPyAodDAgPSBlZGl0b3JBY3Rvci5nZXRTbmFwc2hvdCgpLCAkWzBdID0gZWRpdG9yQWN0b3IsICRbMV0gPSB0MCkgOiB0MCA9ICRbMV07XG4gIGNvbnN0IFtzZWxlY3Rpb24sIHNldFNlbGVjdGlvbl0gPSB1c2VTdGF0ZSh0MC5jb250ZXh0LnNlbGVjdGlvbik7XG4gIGxldCB0MSwgdDI7XG4gIHJldHVybiAkWzJdICE9PSBlZGl0b3JBY3RvciA/ICh0MSA9ICgpID0+IHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBlZGl0b3JBY3Rvci5vbihcInNlbGVjdGlvblwiLCAoZXZlbnQpID0+IHtcbiAgICAgIHN0YXJ0VHJhbnNpdGlvbigoKSA9PiB7XG4gICAgICAgIHNldFNlbGVjdGlvbihldmVudC5zZWxlY3Rpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gIH0sIHQyID0gW2VkaXRvckFjdG9yXSwgJFsyXSA9IGVkaXRvckFjdG9yLCAkWzNdID0gdDEsICRbNF0gPSB0MikgOiAodDEgPSAkWzNdLCB0MiA9ICRbNF0pLCB1c2VFZmZlY3QodDEsIHQyKSwgc2VsZWN0aW9uO1xufTtcbmV4cG9ydCB7XG4gIEVkaXRvclByb3ZpZGVyLFxuICBQb3J0YWJsZVRleHRFZGl0YWJsZSxcbiAgUG9ydGFibGVUZXh0RWRpdG9yLFxuICBkZWZpbmVTY2hlbWEsXG4gIGRlZmF1bHRLZXlHZW5lcmF0b3IgYXMga2V5R2VuZXJhdG9yLFxuICB1c2VFZGl0b3IsXG4gIHVzZUVkaXRvclNlbGVjdG9yLFxuICB1c2VQb3J0YWJsZVRleHRFZGl0b3IsXG4gIHVzZVBvcnRhYmxlVGV4dEVkaXRvclNlbGVjdGlvblxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/plugins/index.js":
/*!****************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/plugins/index.js ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BehaviorPlugin: () => (/* binding */ BehaviorPlugin),\n/* harmony export */   EditorRefPlugin: () => (/* binding */ EditorRefPlugin),\n/* harmony export */   EventListenerPlugin: () => (/* binding */ EventListenerPlugin)\n/* harmony export */ });\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../_chunks-es/use-editor.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\");\n\n\n\nfunction BehaviorPlugin(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__.c)(4), editor = (0,_chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_2__.useEditor)();\n  let t0, t1;\n  return $[0] !== editor || $[1] !== props.behaviors ? (t0 = () => {\n    const unregisterBehaviors = props.behaviors.map((behavior) => editor.registerBehavior({\n      behavior\n    }));\n    return () => {\n      unregisterBehaviors.forEach(_temp);\n    };\n  }, t1 = [editor, props.behaviors], $[0] = editor, $[1] = props.behaviors, $[2] = t0, $[3] = t1) : (t0 = $[2], t1 = $[3]), (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(t0, t1), null;\n}\nfunction _temp(unregister) {\n  unregister();\n}\nconst EditorRefPlugin = react__WEBPACK_IMPORTED_MODULE_1__.forwardRef((_, ref) => {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__.c)(2), editor = (0,_chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_2__.useEditor)(), portableTextEditorRef = react__WEBPACK_IMPORTED_MODULE_1__.useRef(editor);\n  let t0, t1;\n  return $[0] === /* @__PURE__ */ Symbol.for(\"react.memo_cache_sentinel\") ? (t0 = () => portableTextEditorRef.current, t1 = [], $[0] = t0, $[1] = t1) : (t0 = $[0], t1 = $[1]), react__WEBPACK_IMPORTED_MODULE_1__.useImperativeHandle(ref, t0, t1), null;\n});\nEditorRefPlugin.displayName = \"EditorRefPlugin\";\nfunction EventListenerPlugin(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__.c)(4), editor = (0,_chunks_es_use_editor_js__WEBPACK_IMPORTED_MODULE_2__.useEditor)();\n  let t0, t1;\n  return $[0] !== editor || $[1] !== props.on ? (t0 = () => {\n    const subscription = editor.on(\"*\", props.on);\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, t1 = [editor, props.on], $[0] = editor, $[1] = props.on, $[2] = t0, $[3] = t1) : (t0 = $[2], t1 = $[3]), (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(t0, t1), null;\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL3BsdWdpbnMvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTJDO0FBQ0Y7QUFDZTtBQUN4RDtBQUNBLFlBQVkseURBQUMsY0FBYyxtRUFBUztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHLHlIQUF5SCxnREFBUztBQUNySTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qiw2Q0FBZ0I7QUFDeEMsWUFBWSx5REFBQyxjQUFjLG1FQUFTLDRCQUE0Qix5Q0FBWTtBQUM1RTtBQUNBLGdMQUFnTCxzREFBeUI7QUFDek0sQ0FBQztBQUNEO0FBQ0E7QUFDQSxZQUFZLHlEQUFDLGNBQWMsbUVBQVM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRywyR0FBMkcsZ0RBQVM7QUFDdkg7QUFLRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL3BsdWdpbnMvaW5kZXguanM/NGNiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjIH0gZnJvbSBcInJlYWN0LWNvbXBpbGVyLXJ1bnRpbWVcIjtcbmltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHVzZUVkaXRvciB9IGZyb20gXCIuLi9fY2h1bmtzLWVzL3VzZS1lZGl0b3IuanNcIjtcbmZ1bmN0aW9uIEJlaGF2aW9yUGx1Z2luKHByb3BzKSB7XG4gIGNvbnN0ICQgPSBjKDQpLCBlZGl0b3IgPSB1c2VFZGl0b3IoKTtcbiAgbGV0IHQwLCB0MTtcbiAgcmV0dXJuICRbMF0gIT09IGVkaXRvciB8fCAkWzFdICE9PSBwcm9wcy5iZWhhdmlvcnMgPyAodDAgPSAoKSA9PiB7XG4gICAgY29uc3QgdW5yZWdpc3RlckJlaGF2aW9ycyA9IHByb3BzLmJlaGF2aW9ycy5tYXAoKGJlaGF2aW9yKSA9PiBlZGl0b3IucmVnaXN0ZXJCZWhhdmlvcih7XG4gICAgICBiZWhhdmlvclxuICAgIH0pKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdW5yZWdpc3RlckJlaGF2aW9ycy5mb3JFYWNoKF90ZW1wKTtcbiAgICB9O1xuICB9LCB0MSA9IFtlZGl0b3IsIHByb3BzLmJlaGF2aW9yc10sICRbMF0gPSBlZGl0b3IsICRbMV0gPSBwcm9wcy5iZWhhdmlvcnMsICRbMl0gPSB0MCwgJFszXSA9IHQxKSA6ICh0MCA9ICRbMl0sIHQxID0gJFszXSksIHVzZUVmZmVjdCh0MCwgdDEpLCBudWxsO1xufVxuZnVuY3Rpb24gX3RlbXAodW5yZWdpc3Rlcikge1xuICB1bnJlZ2lzdGVyKCk7XG59XG5jb25zdCBFZGl0b3JSZWZQbHVnaW4gPSBSZWFjdC5mb3J3YXJkUmVmKChfLCByZWYpID0+IHtcbiAgY29uc3QgJCA9IGMoMiksIGVkaXRvciA9IHVzZUVkaXRvcigpLCBwb3J0YWJsZVRleHRFZGl0b3JSZWYgPSBSZWFjdC51c2VSZWYoZWRpdG9yKTtcbiAgbGV0IHQwLCB0MTtcbiAgcmV0dXJuICRbMF0gPT09IC8qIEBfX1BVUkVfXyAqLyBTeW1ib2wuZm9yKFwicmVhY3QubWVtb19jYWNoZV9zZW50aW5lbFwiKSA/ICh0MCA9ICgpID0+IHBvcnRhYmxlVGV4dEVkaXRvclJlZi5jdXJyZW50LCB0MSA9IFtdLCAkWzBdID0gdDAsICRbMV0gPSB0MSkgOiAodDAgPSAkWzBdLCB0MSA9ICRbMV0pLCBSZWFjdC51c2VJbXBlcmF0aXZlSGFuZGxlKHJlZiwgdDAsIHQxKSwgbnVsbDtcbn0pO1xuRWRpdG9yUmVmUGx1Z2luLmRpc3BsYXlOYW1lID0gXCJFZGl0b3JSZWZQbHVnaW5cIjtcbmZ1bmN0aW9uIEV2ZW50TGlzdGVuZXJQbHVnaW4ocHJvcHMpIHtcbiAgY29uc3QgJCA9IGMoNCksIGVkaXRvciA9IHVzZUVkaXRvcigpO1xuICBsZXQgdDAsIHQxO1xuICByZXR1cm4gJFswXSAhPT0gZWRpdG9yIHx8ICRbMV0gIT09IHByb3BzLm9uID8gKHQwID0gKCkgPT4ge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGVkaXRvci5vbihcIipcIiwgcHJvcHMub24pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICB9LCB0MSA9IFtlZGl0b3IsIHByb3BzLm9uXSwgJFswXSA9IGVkaXRvciwgJFsxXSA9IHByb3BzLm9uLCAkWzJdID0gdDAsICRbM10gPSB0MSkgOiAodDAgPSAkWzJdLCB0MSA9ICRbM10pLCB1c2VFZmZlY3QodDAsIHQxKSwgbnVsbDtcbn1cbmV4cG9ydCB7XG4gIEJlaGF2aW9yUGx1Z2luLFxuICBFZGl0b3JSZWZQbHVnaW4sXG4gIEV2ZW50TGlzdGVuZXJQbHVnaW5cbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/plugins/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/selectors/index.js":
/*!******************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/selectors/index.js ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getActiveAnnotations: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getActiveAnnotations),\n/* harmony export */   getActiveListItem: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getActiveListItem),\n/* harmony export */   getActiveStyle: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getActiveStyle),\n/* harmony export */   getAnchorBlock: () => (/* binding */ getAnchorBlock),\n/* harmony export */   getAnchorChild: () => (/* binding */ getAnchorChild),\n/* harmony export */   getAnchorSpan: () => (/* binding */ getAnchorSpan),\n/* harmony export */   getAnchorTextBlock: () => (/* binding */ getAnchorTextBlock),\n/* harmony export */   getBlockOffsets: () => (/* binding */ getBlockOffsets),\n/* harmony export */   getBlockTextAfter: () => (/* binding */ getBlockTextAfter),\n/* harmony export */   getBlockTextBefore: () => (/* binding */ getBlockTextBefore),\n/* harmony export */   getCaretWordSelection: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getCaretWordSelection),\n/* harmony export */   getFirstBlock: () => (/* binding */ getFirstBlock),\n/* harmony export */   getFocusBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusBlock),\n/* harmony export */   getFocusBlockObject: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusBlockObject),\n/* harmony export */   getFocusChild: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusChild),\n/* harmony export */   getFocusInlineObject: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusInlineObject),\n/* harmony export */   getFocusListBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusListBlock),\n/* harmony export */   getFocusSpan: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusSpan),\n/* harmony export */   getFocusTextBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusTextBlock),\n/* harmony export */   getLastBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getLastBlock),\n/* harmony export */   getMarkState: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getMarkState),\n/* harmony export */   getNextBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getNextBlock),\n/* harmony export */   getNextInlineObject: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getNextInlineObject),\n/* harmony export */   getNextInlineObjects: () => (/* binding */ getNextInlineObjects),\n/* harmony export */   getNextSpan: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getNextSpan),\n/* harmony export */   getPreviousBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getPreviousBlock),\n/* harmony export */   getPreviousInlineObject: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getPreviousInlineObject),\n/* harmony export */   getPreviousInlineObjects: () => (/* binding */ getPreviousInlineObjects),\n/* harmony export */   getPreviousSpan: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getPreviousSpan),\n/* harmony export */   getSelectedBlocks: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectedBlocks),\n/* harmony export */   getSelectedSpans: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectedSpans),\n/* harmony export */   getSelectedTextBlocks: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectedTextBlocks),\n/* harmony export */   getSelectedValue: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectedValue),\n/* harmony export */   getSelection: () => (/* binding */ getSelection),\n/* harmony export */   getSelectionEndBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionEndBlock),\n/* harmony export */   getSelectionEndChild: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionEndChild),\n/* harmony export */   getSelectionEndPoint: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionEndPoint),\n/* harmony export */   getSelectionStartBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionStartBlock),\n/* harmony export */   getSelectionStartChild: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionStartChild),\n/* harmony export */   getSelectionStartPoint: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionStartPoint),\n/* harmony export */   getSelectionText: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionText),\n/* harmony export */   getValue: () => (/* binding */ getValue),\n/* harmony export */   isActiveAnnotation: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isActiveAnnotation),\n/* harmony export */   isActiveDecorator: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isActiveDecorator),\n/* harmony export */   isActiveListItem: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isActiveListItem),\n/* harmony export */   isActiveStyle: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isActiveStyle),\n/* harmony export */   isAtTheEndOfBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isAtTheEndOfBlock),\n/* harmony export */   isAtTheStartOfBlock: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isAtTheStartOfBlock),\n/* harmony export */   isOverlappingSelection: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isOverlappingSelection),\n/* harmony export */   isPointAfterSelection: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isPointAfterSelection),\n/* harmony export */   isPointBeforeSelection: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isPointBeforeSelection),\n/* harmony export */   isSelectingEntireBlocks: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isSelectingEntireBlocks),\n/* harmony export */   isSelectionCollapsed: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isSelectionCollapsed),\n/* harmony export */   isSelectionExpanded: () => (/* reexport safe */ _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.isSelectionExpanded)\n/* harmony export */ });\n/* harmony import */ var _chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../_chunks-es/selector.is-at-the-start-of-block.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n/* harmony import */ var _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../_chunks-es/util.slice-blocks.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n\n\n\n\nconst getAnchorBlock = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const key = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(snapshot.context.selection.anchor), index = key ? snapshot.blockIndexMap.get(key) : void 0, node = index !== void 0 ? snapshot.context.value.at(index) : void 0;\n  return node && key ? {\n    node,\n    path: [{\n      _key: key\n    }]\n  } : void 0;\n}, getAnchorTextBlock = (snapshot) => {\n  const anchorBlock = getAnchorBlock(snapshot);\n  return anchorBlock && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(snapshot.context, anchorBlock.node) ? {\n    node: anchorBlock.node,\n    path: anchorBlock.path\n  } : void 0;\n}, getAnchorChild = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const anchorBlock = getAnchorTextBlock(snapshot);\n  if (!anchorBlock)\n    return;\n  const key = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(snapshot.context.selection.anchor), node = key ? anchorBlock.node.children.find((span) => span._key === key) : void 0;\n  return node && key ? {\n    node,\n    path: [...anchorBlock.path, \"children\", {\n      _key: key\n    }]\n  } : void 0;\n}, getAnchorSpan = (snapshot) => {\n  const anchorChild = getAnchorChild(snapshot);\n  return anchorChild && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, anchorChild.node) ? {\n    node: anchorChild.node,\n    path: anchorChild.path\n  } : void 0;\n}, getBlockOffsets = (snapshot) => {\n  if (!snapshot.context.selection)\n    return;\n  const selectionStartPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionStartPoint)(snapshot), selectionEndPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionEndPoint)(snapshot);\n  if (!selectionStartPoint || !selectionEndPoint)\n    return;\n  const start = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.spanSelectionPointToBlockOffset)({\n    context: snapshot.context,\n    selectionPoint: selectionStartPoint\n  }), end = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.spanSelectionPointToBlockOffset)({\n    context: snapshot.context,\n    selectionPoint: selectionEndPoint\n  });\n  return start && end ? {\n    start,\n    end\n  } : void 0;\n}, getFirstBlock = (snapshot) => {\n  const node = snapshot.context.value[0];\n  return node ? {\n    node,\n    path: [{\n      _key: node._key\n    }]\n  } : void 0;\n}, getNextInlineObjects = (snapshot) => {\n  const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusTextBlock)(snapshot), selectionEndPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionEndPoint)(snapshot), selectionEndPointChildKey = selectionEndPoint && (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isKeyedSegment)(selectionEndPoint.path[2]) ? selectionEndPoint.path[2]._key : void 0;\n  if (!focusTextBlock || !selectionEndPointChildKey)\n    return [];\n  let endPointChildFound = !1;\n  const inlineObjects = [];\n  for (const child of focusTextBlock.node.children) {\n    if (child._key === selectionEndPointChildKey) {\n      endPointChildFound = !0;\n      continue;\n    }\n    if (!(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) && endPointChildFound) {\n      inlineObjects.push({\n        node: child,\n        path: [...focusTextBlock.path, \"children\", {\n          _key: child._key\n        }]\n      });\n      break;\n    }\n  }\n  return inlineObjects;\n}, getPreviousInlineObjects = (snapshot) => {\n  const focusTextBlock = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusTextBlock)(snapshot), selectionStartPoint = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionStartPoint)(snapshot), selectionStartPointChildKey = selectionStartPoint && (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isKeyedSegment)(selectionStartPoint.path[2]) ? selectionStartPoint.path[2]._key : void 0;\n  if (!focusTextBlock || !selectionStartPointChildKey)\n    return [];\n  const inlineObjects = [];\n  for (const child of focusTextBlock.node.children) {\n    if (child._key === selectionStartPointChildKey)\n      break;\n    (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(snapshot.context, child) || inlineObjects.push({\n      node: child,\n      path: [...focusTextBlock.path, \"children\", {\n        _key: child._key\n      }]\n    });\n  }\n  return inlineObjects;\n}, getSelection = (snapshot) => snapshot.context.selection, getBlockTextAfter = (snapshot) => {\n  if (!snapshot.context.selection)\n    return \"\";\n  const endPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint)(snapshot.context.selection), block = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusBlock)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: endPoint,\n        focus: endPoint\n      }\n    }\n  });\n  if (!block)\n    return \"\";\n  const endOfBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockEndPoint)({\n    context: snapshot.context,\n    block\n  });\n  return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionText)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: endPoint,\n        focus: endOfBlock\n      }\n    }\n  });\n}, getBlockTextBefore = (snapshot) => {\n  if (!snapshot.context.selection)\n    return \"\";\n  const startPoint = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint)(snapshot.context.selection), block = (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getFocusBlock)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: startPoint,\n        focus: startPoint\n      }\n    }\n  });\n  if (!block)\n    return \"\";\n  const startOfBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockStartPoint)({\n    context: snapshot.context,\n    block\n  });\n  return (0,_chunks_es_selector_is_at_the_start_of_block_js__WEBPACK_IMPORTED_MODULE_2__.getSelectionText)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: startOfBlock,\n        focus: startPoint\n      }\n    }\n  });\n}, getValue = (snapshot) => snapshot.context.value;\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL3NlbGVjdG9ycy9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0s7QUFDc25CO0FBQy9lO0FBQ2xQO0FBQzNEO0FBQ0E7QUFDQTtBQUNBLGNBQWMsOEZBQTZCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSixDQUFDO0FBQ0Q7QUFDQSx3QkFBd0IsaUVBQVc7QUFDbkM7QUFDQTtBQUNBLElBQUk7QUFDSixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsOEZBQTZCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSixDQUFDO0FBQ0Q7QUFDQSx3QkFBd0IsNERBQU07QUFDOUI7QUFDQTtBQUNBLElBQUk7QUFDSixDQUFDO0FBQ0Q7QUFDQTtBQUNBLDhCQUE4Qix1R0FBc0IsZ0NBQWdDLHFHQUFvQjtBQUN4RztBQUNBO0FBQ0EsZ0JBQWdCLGdHQUErQjtBQUMvQztBQUNBO0FBQ0EsR0FBRyxTQUFTLGdHQUErQjtBQUMzQztBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0osQ0FBQztBQUNELHlCQUF5QixrR0FBaUIsZ0NBQWdDLHFHQUFvQiw2REFBNkQsK0VBQWM7QUFDeks7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyw0REFBTTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCx5QkFBeUIsa0dBQWlCLGtDQUFrQyx1R0FBc0IsaUVBQWlFLCtFQUFjO0FBQ2pMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksNERBQU07QUFDVjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLG1CQUFtQixxRkFBc0Isc0NBQXNDLDhGQUFhO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLHFCQUFxQixpRkFBZ0I7QUFDckM7QUFDQTtBQUNBLEdBQUc7QUFDSCxTQUFTLGlHQUFnQjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILENBQUM7QUFDRDtBQUNBO0FBQ0EscUJBQXFCLHVGQUF3QixzQ0FBc0MsOEZBQWE7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsdUJBQXVCLG1GQUFrQjtBQUN6QztBQUNBO0FBQ0EsR0FBRztBQUNILFNBQVMsaUdBQWdCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQ0FBQztBQXdEQztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL3NlbGVjdG9ycy9pbmRleC5qcz9mOTFiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQsIGdldFNlbGVjdGlvbkVuZFBvaW50LCBnZXRGb2N1c1RleHRCbG9jaywgZ2V0Rm9jdXNCbG9jaywgZ2V0U2VsZWN0aW9uVGV4dCB9IGZyb20gXCIuLi9fY2h1bmtzLWVzL3NlbGVjdG9yLmlzLWF0LXRoZS1zdGFydC1vZi1ibG9jay5qc1wiO1xuaW1wb3J0IHsgZ2V0QWN0aXZlQW5ub3RhdGlvbnMsIGdldEFjdGl2ZUxpc3RJdGVtLCBnZXRBY3RpdmVTdHlsZSwgZ2V0Q2FyZXRXb3JkU2VsZWN0aW9uLCBnZXRGb2N1c0Jsb2NrT2JqZWN0LCBnZXRGb2N1c0NoaWxkLCBnZXRGb2N1c0lubGluZU9iamVjdCwgZ2V0Rm9jdXNMaXN0QmxvY2ssIGdldEZvY3VzU3BhbiwgZ2V0TGFzdEJsb2NrLCBnZXRNYXJrU3RhdGUsIGdldE5leHRCbG9jaywgZ2V0TmV4dElubGluZU9iamVjdCwgZ2V0TmV4dFNwYW4sIGdldFByZXZpb3VzQmxvY2ssIGdldFByZXZpb3VzSW5saW5lT2JqZWN0LCBnZXRQcmV2aW91c1NwYW4sIGdldFNlbGVjdGVkQmxvY2tzLCBnZXRTZWxlY3RlZFNwYW5zLCBnZXRTZWxlY3RlZFRleHRCbG9ja3MsIGdldFNlbGVjdGVkVmFsdWUsIGdldFNlbGVjdGlvbkVuZEJsb2NrLCBnZXRTZWxlY3Rpb25FbmRDaGlsZCwgZ2V0U2VsZWN0aW9uU3RhcnRCbG9jaywgZ2V0U2VsZWN0aW9uU3RhcnRDaGlsZCwgaXNBY3RpdmVBbm5vdGF0aW9uLCBpc0FjdGl2ZURlY29yYXRvciwgaXNBY3RpdmVMaXN0SXRlbSwgaXNBY3RpdmVTdHlsZSwgaXNBdFRoZUVuZE9mQmxvY2ssIGlzQXRUaGVTdGFydE9mQmxvY2ssIGlzT3ZlcmxhcHBpbmdTZWxlY3Rpb24sIGlzUG9pbnRBZnRlclNlbGVjdGlvbiwgaXNQb2ludEJlZm9yZVNlbGVjdGlvbiwgaXNTZWxlY3RpbmdFbnRpcmVCbG9ja3MsIGlzU2VsZWN0aW9uQ29sbGFwc2VkLCBpc1NlbGVjdGlvbkV4cGFuZGVkIH0gZnJvbSBcIi4uL19jaHVua3MtZXMvc2VsZWN0b3IuaXMtYXQtdGhlLXN0YXJ0LW9mLWJsb2NrLmpzXCI7XG5pbXBvcnQgeyBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludCwgZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQsIHNwYW5TZWxlY3Rpb25Qb2ludFRvQmxvY2tPZmZzZXQsIGlzS2V5ZWRTZWdtZW50LCBnZXRTZWxlY3Rpb25FbmRQb2ludCBhcyBnZXRTZWxlY3Rpb25FbmRQb2ludCQxLCBnZXRCbG9ja0VuZFBvaW50LCBnZXRTZWxlY3Rpb25TdGFydFBvaW50IGFzIGdldFNlbGVjdGlvblN0YXJ0UG9pbnQkMSwgZ2V0QmxvY2tTdGFydFBvaW50IH0gZnJvbSBcIi4uL19jaHVua3MtZXMvdXRpbC5zbGljZS1ibG9ja3MuanNcIjtcbmltcG9ydCB7IGlzVGV4dEJsb2NrLCBpc1NwYW4gfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9zY2hlbWFcIjtcbmNvbnN0IGdldEFuY2hvckJsb2NrID0gKHNuYXBzaG90KSA9PiB7XG4gIGlmICghc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pXG4gICAgcmV0dXJuO1xuICBjb25zdCBrZXkgPSBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludChzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbi5hbmNob3IpLCBpbmRleCA9IGtleSA/IHNuYXBzaG90LmJsb2NrSW5kZXhNYXAuZ2V0KGtleSkgOiB2b2lkIDAsIG5vZGUgPSBpbmRleCAhPT0gdm9pZCAwID8gc25hcHNob3QuY29udGV4dC52YWx1ZS5hdChpbmRleCkgOiB2b2lkIDA7XG4gIHJldHVybiBub2RlICYmIGtleSA/IHtcbiAgICBub2RlLFxuICAgIHBhdGg6IFt7XG4gICAgICBfa2V5OiBrZXlcbiAgICB9XVxuICB9IDogdm9pZCAwO1xufSwgZ2V0QW5jaG9yVGV4dEJsb2NrID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IGFuY2hvckJsb2NrID0gZ2V0QW5jaG9yQmxvY2soc25hcHNob3QpO1xuICByZXR1cm4gYW5jaG9yQmxvY2sgJiYgaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYW5jaG9yQmxvY2subm9kZSkgPyB7XG4gICAgbm9kZTogYW5jaG9yQmxvY2subm9kZSxcbiAgICBwYXRoOiBhbmNob3JCbG9jay5wYXRoXG4gIH0gOiB2b2lkIDA7XG59LCBnZXRBbmNob3JDaGlsZCA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybjtcbiAgY29uc3QgYW5jaG9yQmxvY2sgPSBnZXRBbmNob3JUZXh0QmxvY2soc25hcHNob3QpO1xuICBpZiAoIWFuY2hvckJsb2NrKVxuICAgIHJldHVybjtcbiAgY29uc3Qga2V5ID0gZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24uYW5jaG9yKSwgbm9kZSA9IGtleSA/IGFuY2hvckJsb2NrLm5vZGUuY2hpbGRyZW4uZmluZCgoc3BhbikgPT4gc3Bhbi5fa2V5ID09PSBrZXkpIDogdm9pZCAwO1xuICByZXR1cm4gbm9kZSAmJiBrZXkgPyB7XG4gICAgbm9kZSxcbiAgICBwYXRoOiBbLi4uYW5jaG9yQmxvY2sucGF0aCwgXCJjaGlsZHJlblwiLCB7XG4gICAgICBfa2V5OiBrZXlcbiAgICB9XVxuICB9IDogdm9pZCAwO1xufSwgZ2V0QW5jaG9yU3BhbiA9IChzbmFwc2hvdCkgPT4ge1xuICBjb25zdCBhbmNob3JDaGlsZCA9IGdldEFuY2hvckNoaWxkKHNuYXBzaG90KTtcbiAgcmV0dXJuIGFuY2hvckNoaWxkICYmIGlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBhbmNob3JDaGlsZC5ub2RlKSA/IHtcbiAgICBub2RlOiBhbmNob3JDaGlsZC5ub2RlLFxuICAgIHBhdGg6IGFuY2hvckNoaWxkLnBhdGhcbiAgfSA6IHZvaWQgMDtcbn0sIGdldEJsb2NrT2Zmc2V0cyA9IChzbmFwc2hvdCkgPT4ge1xuICBpZiAoIXNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2VsZWN0aW9uU3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQoc25hcHNob3QpLCBzZWxlY3Rpb25FbmRQb2ludCA9IGdldFNlbGVjdGlvbkVuZFBvaW50KHNuYXBzaG90KTtcbiAgaWYgKCFzZWxlY3Rpb25TdGFydFBvaW50IHx8ICFzZWxlY3Rpb25FbmRQb2ludClcbiAgICByZXR1cm47XG4gIGNvbnN0IHN0YXJ0ID0gc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICBzZWxlY3Rpb25Qb2ludDogc2VsZWN0aW9uU3RhcnRQb2ludFxuICB9KSwgZW5kID0gc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICBzZWxlY3Rpb25Qb2ludDogc2VsZWN0aW9uRW5kUG9pbnRcbiAgfSk7XG4gIHJldHVybiBzdGFydCAmJiBlbmQgPyB7XG4gICAgc3RhcnQsXG4gICAgZW5kXG4gIH0gOiB2b2lkIDA7XG59LCBnZXRGaXJzdEJsb2NrID0gKHNuYXBzaG90KSA9PiB7XG4gIGNvbnN0IG5vZGUgPSBzbmFwc2hvdC5jb250ZXh0LnZhbHVlWzBdO1xuICByZXR1cm4gbm9kZSA/IHtcbiAgICBub2RlLFxuICAgIHBhdGg6IFt7XG4gICAgICBfa2V5OiBub2RlLl9rZXlcbiAgICB9XVxuICB9IDogdm9pZCAwO1xufSwgZ2V0TmV4dElubGluZU9iamVjdHMgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3QgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCksIHNlbGVjdGlvbkVuZFBvaW50ID0gZ2V0U2VsZWN0aW9uRW5kUG9pbnQoc25hcHNob3QpLCBzZWxlY3Rpb25FbmRQb2ludENoaWxkS2V5ID0gc2VsZWN0aW9uRW5kUG9pbnQgJiYgaXNLZXllZFNlZ21lbnQoc2VsZWN0aW9uRW5kUG9pbnQucGF0aFsyXSkgPyBzZWxlY3Rpb25FbmRQb2ludC5wYXRoWzJdLl9rZXkgOiB2b2lkIDA7XG4gIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvbkVuZFBvaW50Q2hpbGRLZXkpXG4gICAgcmV0dXJuIFtdO1xuICBsZXQgZW5kUG9pbnRDaGlsZEZvdW5kID0gITE7XG4gIGNvbnN0IGlubGluZU9iamVjdHMgPSBbXTtcbiAgZm9yIChjb25zdCBjaGlsZCBvZiBmb2N1c1RleHRCbG9jay5ub2RlLmNoaWxkcmVuKSB7XG4gICAgaWYgKGNoaWxkLl9rZXkgPT09IHNlbGVjdGlvbkVuZFBvaW50Q2hpbGRLZXkpIHtcbiAgICAgIGVuZFBvaW50Q2hpbGRGb3VuZCA9ICEwO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmICghaXNTcGFuKHNuYXBzaG90LmNvbnRleHQsIGNoaWxkKSAmJiBlbmRQb2ludENoaWxkRm91bmQpIHtcbiAgICAgIGlubGluZU9iamVjdHMucHVzaCh7XG4gICAgICAgIG5vZGU6IGNoaWxkLFxuICAgICAgICBwYXRoOiBbLi4uZm9jdXNUZXh0QmxvY2sucGF0aCwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgX2tleTogY2hpbGQuX2tleVxuICAgICAgICB9XVxuICAgICAgfSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGlubGluZU9iamVjdHM7XG59LCBnZXRQcmV2aW91c0lubGluZU9iamVjdHMgPSAoc25hcHNob3QpID0+IHtcbiAgY29uc3QgZm9jdXNUZXh0QmxvY2sgPSBnZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCksIHNlbGVjdGlvblN0YXJ0UG9pbnQgPSBnZXRTZWxlY3Rpb25TdGFydFBvaW50KHNuYXBzaG90KSwgc2VsZWN0aW9uU3RhcnRQb2ludENoaWxkS2V5ID0gc2VsZWN0aW9uU3RhcnRQb2ludCAmJiBpc0tleWVkU2VnbWVudChzZWxlY3Rpb25TdGFydFBvaW50LnBhdGhbMl0pID8gc2VsZWN0aW9uU3RhcnRQb2ludC5wYXRoWzJdLl9rZXkgOiB2b2lkIDA7XG4gIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvblN0YXJ0UG9pbnRDaGlsZEtleSlcbiAgICByZXR1cm4gW107XG4gIGNvbnN0IGlubGluZU9iamVjdHMgPSBbXTtcbiAgZm9yIChjb25zdCBjaGlsZCBvZiBmb2N1c1RleHRCbG9jay5ub2RlLmNoaWxkcmVuKSB7XG4gICAgaWYgKGNoaWxkLl9rZXkgPT09IHNlbGVjdGlvblN0YXJ0UG9pbnRDaGlsZEtleSlcbiAgICAgIGJyZWFrO1xuICAgIGlzU3BhbihzbmFwc2hvdC5jb250ZXh0LCBjaGlsZCkgfHwgaW5saW5lT2JqZWN0cy5wdXNoKHtcbiAgICAgIG5vZGU6IGNoaWxkLFxuICAgICAgcGF0aDogWy4uLmZvY3VzVGV4dEJsb2NrLnBhdGgsIFwiY2hpbGRyZW5cIiwge1xuICAgICAgICBfa2V5OiBjaGlsZC5fa2V5XG4gICAgICB9XVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBpbmxpbmVPYmplY3RzO1xufSwgZ2V0U2VsZWN0aW9uID0gKHNuYXBzaG90KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiwgZ2V0QmxvY2tUZXh0QWZ0ZXIgPSAoc25hcHNob3QpID0+IHtcbiAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICByZXR1cm4gXCJcIjtcbiAgY29uc3QgZW5kUG9pbnQgPSBnZXRTZWxlY3Rpb25FbmRQb2ludCQxKHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uKSwgYmxvY2sgPSBnZXRGb2N1c0Jsb2NrKHtcbiAgICAuLi5zbmFwc2hvdCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5zbmFwc2hvdC5jb250ZXh0LFxuICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgIGFuY2hvcjogZW5kUG9pbnQsXG4gICAgICAgIGZvY3VzOiBlbmRQb2ludFxuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGlmICghYmxvY2spXG4gICAgcmV0dXJuIFwiXCI7XG4gIGNvbnN0IGVuZE9mQmxvY2sgPSBnZXRCbG9ja0VuZFBvaW50KHtcbiAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgIGJsb2NrXG4gIH0pO1xuICByZXR1cm4gZ2V0U2VsZWN0aW9uVGV4dCh7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IGVuZFBvaW50LFxuICAgICAgICBmb2N1czogZW5kT2ZCbG9ja1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59LCBnZXRCbG9ja1RleHRCZWZvcmUgPSAoc25hcHNob3QpID0+IHtcbiAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbilcbiAgICByZXR1cm4gXCJcIjtcbiAgY29uc3Qgc3RhcnRQb2ludCA9IGdldFNlbGVjdGlvblN0YXJ0UG9pbnQkMShzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiksIGJsb2NrID0gZ2V0Rm9jdXNCbG9jayh7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHN0YXJ0UG9pbnQsXG4gICAgICAgIGZvY3VzOiBzdGFydFBvaW50XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgaWYgKCFibG9jaylcbiAgICByZXR1cm4gXCJcIjtcbiAgY29uc3Qgc3RhcnRPZkJsb2NrID0gZ2V0QmxvY2tTdGFydFBvaW50KHtcbiAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgIGJsb2NrXG4gIH0pO1xuICByZXR1cm4gZ2V0U2VsZWN0aW9uVGV4dCh7XG4gICAgLi4uc25hcHNob3QsXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHN0YXJ0T2ZCbG9jayxcbiAgICAgICAgZm9jdXM6IHN0YXJ0UG9pbnRcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSwgZ2V0VmFsdWUgPSAoc25hcHNob3QpID0+IHNuYXBzaG90LmNvbnRleHQudmFsdWU7XG5leHBvcnQge1xuICBnZXRBY3RpdmVBbm5vdGF0aW9ucyxcbiAgZ2V0QWN0aXZlTGlzdEl0ZW0sXG4gIGdldEFjdGl2ZVN0eWxlLFxuICBnZXRBbmNob3JCbG9jayxcbiAgZ2V0QW5jaG9yQ2hpbGQsXG4gIGdldEFuY2hvclNwYW4sXG4gIGdldEFuY2hvclRleHRCbG9jayxcbiAgZ2V0QmxvY2tPZmZzZXRzLFxuICBnZXRCbG9ja1RleHRBZnRlcixcbiAgZ2V0QmxvY2tUZXh0QmVmb3JlLFxuICBnZXRDYXJldFdvcmRTZWxlY3Rpb24sXG4gIGdldEZpcnN0QmxvY2ssXG4gIGdldEZvY3VzQmxvY2ssXG4gIGdldEZvY3VzQmxvY2tPYmplY3QsXG4gIGdldEZvY3VzQ2hpbGQsXG4gIGdldEZvY3VzSW5saW5lT2JqZWN0LFxuICBnZXRGb2N1c0xpc3RCbG9jayxcbiAgZ2V0Rm9jdXNTcGFuLFxuICBnZXRGb2N1c1RleHRCbG9jayxcbiAgZ2V0TGFzdEJsb2NrLFxuICBnZXRNYXJrU3RhdGUsXG4gIGdldE5leHRCbG9jayxcbiAgZ2V0TmV4dElubGluZU9iamVjdCxcbiAgZ2V0TmV4dElubGluZU9iamVjdHMsXG4gIGdldE5leHRTcGFuLFxuICBnZXRQcmV2aW91c0Jsb2NrLFxuICBnZXRQcmV2aW91c0lubGluZU9iamVjdCxcbiAgZ2V0UHJldmlvdXNJbmxpbmVPYmplY3RzLFxuICBnZXRQcmV2aW91c1NwYW4sXG4gIGdldFNlbGVjdGVkQmxvY2tzLFxuICBnZXRTZWxlY3RlZFNwYW5zLFxuICBnZXRTZWxlY3RlZFRleHRCbG9ja3MsXG4gIGdldFNlbGVjdGVkVmFsdWUsXG4gIGdldFNlbGVjdGlvbixcbiAgZ2V0U2VsZWN0aW9uRW5kQmxvY2ssXG4gIGdldFNlbGVjdGlvbkVuZENoaWxkLFxuICBnZXRTZWxlY3Rpb25FbmRQb2ludCxcbiAgZ2V0U2VsZWN0aW9uU3RhcnRCbG9jayxcbiAgZ2V0U2VsZWN0aW9uU3RhcnRDaGlsZCxcbiAgZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCxcbiAgZ2V0U2VsZWN0aW9uVGV4dCxcbiAgZ2V0VmFsdWUsXG4gIGlzQWN0aXZlQW5ub3RhdGlvbixcbiAgaXNBY3RpdmVEZWNvcmF0b3IsXG4gIGlzQWN0aXZlTGlzdEl0ZW0sXG4gIGlzQWN0aXZlU3R5bGUsXG4gIGlzQXRUaGVFbmRPZkJsb2NrLFxuICBpc0F0VGhlU3RhcnRPZkJsb2NrLFxuICBpc092ZXJsYXBwaW5nU2VsZWN0aW9uLFxuICBpc1BvaW50QWZ0ZXJTZWxlY3Rpb24sXG4gIGlzUG9pbnRCZWZvcmVTZWxlY3Rpb24sXG4gIGlzU2VsZWN0aW5nRW50aXJlQmxvY2tzLFxuICBpc1NlbGVjdGlvbkNvbGxhcHNlZCxcbiAgaXNTZWxlY3Rpb25FeHBhbmRlZFxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/selectors/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/editor/lib/utils/index.js":
/*!**************************************************************!*\
  !*** ./node_modules/@portabletext/editor/lib/utils/index.js ***!
  \**************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   blockOffsetToBlockSelectionPoint: () => (/* binding */ blockOffsetToBlockSelectionPoint),\n/* harmony export */   blockOffsetToSelectionPoint: () => (/* binding */ blockOffsetToSelectionPoint),\n/* harmony export */   blockOffsetToSpanSelectionPoint: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.blockOffsetToSpanSelectionPoint),\n/* harmony export */   blockOffsetsToSelection: () => (/* binding */ blockOffsetsToSelection),\n/* harmony export */   childSelectionPointToBlockOffset: () => (/* binding */ childSelectionPointToBlockOffset),\n/* harmony export */   getBlockEndPoint: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockEndPoint),\n/* harmony export */   getBlockStartPoint: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockStartPoint),\n/* harmony export */   getSelectionEndPoint: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionEndPoint),\n/* harmony export */   getSelectionStartPoint: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getSelectionStartPoint),\n/* harmony export */   getTextBlockText: () => (/* reexport safe */ _chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_2__.getTextBlockText),\n/* harmony export */   isEmptyTextBlock: () => (/* reexport safe */ _chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_2__.isEmptyTextBlock),\n/* harmony export */   isEqualSelectionPoints: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints),\n/* harmony export */   isEqualSelections: () => (/* binding */ isEqualSelections),\n/* harmony export */   isKeyedSegment: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isKeyedSegment),\n/* harmony export */   isSelectionCollapsed: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isSelectionCollapsed),\n/* harmony export */   isSpan: () => (/* reexport safe */ _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan),\n/* harmony export */   isTextBlock: () => (/* reexport safe */ _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock),\n/* harmony export */   mergeTextBlocks: () => (/* binding */ mergeTextBlocks),\n/* harmony export */   reverseSelection: () => (/* binding */ reverseSelection),\n/* harmony export */   selectionPointToBlockOffset: () => (/* binding */ selectionPointToBlockOffset),\n/* harmony export */   sliceBlocks: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.sliceBlocks),\n/* harmony export */   spanSelectionPointToBlockOffset: () => (/* reexport safe */ _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.spanSelectionPointToBlockOffset),\n/* harmony export */   splitTextBlock: () => (/* binding */ splitTextBlock)\n/* harmony export */ });\n/* harmony import */ var _chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../_chunks-es/util.slice-blocks.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../_chunks-es/util.slice-text-block.js */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-text-block.js\");\n\n\n\n\n\n\nfunction blockOffsetToBlockSelectionPoint({\n  context,\n  blockOffset\n}) {\n  let selectionPoint;\n  for (const block of context.value)\n    if (block._key === blockOffset.path[0]._key) {\n      selectionPoint = {\n        path: [{\n          _key: block._key\n        }],\n        offset: blockOffset.offset\n      };\n      break;\n    }\n  return selectionPoint;\n}\nfunction blockOffsetToSelectionPoint({\n  context,\n  blockOffset,\n  direction\n}) {\n  return (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.blockOffsetToSpanSelectionPoint)({\n    context,\n    blockOffset,\n    direction\n  }) || blockOffsetToBlockSelectionPoint({\n    context,\n    blockOffset\n  });\n}\nfunction blockOffsetsToSelection({\n  context,\n  offsets,\n  backward\n}) {\n  const anchor = blockOffsetToSelectionPoint({\n    context,\n    blockOffset: offsets.anchor,\n    direction: backward ? \"backward\" : \"forward\"\n  }), focus = blockOffsetToSelectionPoint({\n    context,\n    blockOffset: offsets.focus,\n    direction: backward ? \"forward\" : \"backward\"\n  });\n  return !anchor || !focus ? null : {\n    anchor,\n    focus,\n    backward\n  };\n}\nfunction childSelectionPointToBlockOffset({\n  context,\n  selectionPoint\n}) {\n  let offset = 0;\n  const blockKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(selectionPoint), childKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getChildKeyFromSelectionPoint)(selectionPoint);\n  if (!(!blockKey || !childKey)) {\n    for (const block of context.value)\n      if (block._key === blockKey && (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(context, block))\n        for (const child of block.children) {\n          if (child._key === childKey)\n            return {\n              path: [{\n                _key: block._key\n              }],\n              offset: offset + selectionPoint.offset\n            };\n          (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(context, child) && (offset += child.text.length);\n        }\n  }\n}\nfunction isEqualSelections(a, b) {\n  return !a && !b ? !0 : !a || !b ? !1 : (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(a.anchor, b.anchor) && (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.isEqualSelectionPoints)(a.focus, b.focus);\n}\nfunction mergeTextBlocks({\n  context,\n  targetBlock,\n  incomingBlock\n}) {\n  const parsedIncomingBlock = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.parseBlock)({\n    context,\n    block: incomingBlock,\n    options: {\n      normalize: !1,\n      removeUnusedMarkDefs: !0,\n      validateFields: !1\n    }\n  });\n  return !parsedIncomingBlock || !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)(context, parsedIncomingBlock) ? targetBlock : {\n    ...targetBlock,\n    children: [...targetBlock.children, ...parsedIncomingBlock.children],\n    markDefs: [...targetBlock.markDefs ?? [], ...parsedIncomingBlock.markDefs ?? []]\n  };\n}\nfunction reverseSelection(selection) {\n  return selection && (selection.backward ? {\n    anchor: selection.focus,\n    focus: selection.anchor,\n    backward: !1\n  } : {\n    anchor: selection.focus,\n    focus: selection.anchor,\n    backward: !0\n  });\n}\nfunction selectionPointToBlockOffset({\n  context,\n  selectionPoint\n}) {\n  const blockKey = (0,_chunks_es_util_slice_blocks_js__WEBPACK_IMPORTED_MODULE_0__.getBlockKeyFromSelectionPoint)(selectionPoint);\n  return selectionPoint.path.length === 1 && blockKey !== void 0 ? {\n    path: [{\n      _key: blockKey\n    }],\n    offset: selectionPoint.offset\n  } : childSelectionPointToBlockOffset({\n    context,\n    selectionPoint\n  });\n}\nfunction splitTextBlock({\n  context,\n  block,\n  point\n}) {\n  const firstChild = block.children.at(0), lastChild = block.children.at(block.children.length - 1);\n  if (!firstChild || !lastChild)\n    return;\n  const before = (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_2__.sliceTextBlock)({\n    context: {\n      schema: context.schema,\n      selection: {\n        anchor: {\n          path: [{\n            _key: block._key\n          }, \"children\", {\n            _key: firstChild._key\n          }],\n          offset: 0\n        },\n        focus: point\n      }\n    },\n    block\n  }), after = (0,_chunks_es_util_slice_text_block_js__WEBPACK_IMPORTED_MODULE_2__.sliceTextBlock)({\n    context: {\n      schema: context.schema,\n      selection: {\n        anchor: point,\n        focus: {\n          path: [{\n            _key: block._key\n          }, \"children\", {\n            _key: lastChild._key\n          }],\n          offset: (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)(context, lastChild) ? lastChild.text.length : 0\n        }\n      }\n    },\n    block\n  });\n  return {\n    before,\n    after\n  };\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9lZGl0b3IvbGliL3V0aWxzL2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVMO0FBQ3FDO0FBQ2pLO0FBQzJCO0FBQ2Q7QUFDb0I7QUFDNUY7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxTQUFTLGdHQUErQjtBQUN4QztBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxtQkFBbUIsOEZBQTZCLDZCQUE2Qiw4RkFBNkI7QUFDMUc7QUFDQTtBQUNBLHFDQUFxQyxpRUFBVztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQSxVQUFVLDREQUFNO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLHVGQUFzQix3QkFBd0IsdUZBQXNCO0FBQzdHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOEJBQThCLDJFQUFVO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILGtDQUFrQyxpRUFBVztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsbUJBQW1CLDhGQUE2QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtRkFBYztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxXQUFXO0FBQ1g7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUcsV0FBVyxtRkFBYztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBLFdBQVc7QUFDWCxrQkFBa0IsNERBQU07QUFDeEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeUJFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L2VkaXRvci9saWIvdXRpbHMvaW5kZXguanM/ODA5MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBibG9ja09mZnNldFRvU3BhblNlbGVjdGlvblBvaW50LCBnZXRCbG9ja0tleUZyb21TZWxlY3Rpb25Qb2ludCwgZ2V0Q2hpbGRLZXlGcm9tU2VsZWN0aW9uUG9pbnQsIGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMsIHBhcnNlQmxvY2sgfSBmcm9tIFwiLi4vX2NodW5rcy1lcy91dGlsLnNsaWNlLWJsb2Nrcy5qc1wiO1xuaW1wb3J0IHsgZ2V0QmxvY2tFbmRQb2ludCwgZ2V0QmxvY2tTdGFydFBvaW50LCBnZXRTZWxlY3Rpb25FbmRQb2ludCwgZ2V0U2VsZWN0aW9uU3RhcnRQb2ludCwgaXNLZXllZFNlZ21lbnQsIGlzU2VsZWN0aW9uQ29sbGFwc2VkLCBzbGljZUJsb2Nrcywgc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCB9IGZyb20gXCIuLi9fY2h1bmtzLWVzL3V0aWwuc2xpY2UtYmxvY2tzLmpzXCI7XG5pbXBvcnQgeyBpc1RleHRCbG9jaywgaXNTcGFuIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvc2NoZW1hXCI7XG5pbXBvcnQgeyBpc1NwYW4gYXMgaXNTcGFuMiwgaXNUZXh0QmxvY2sgYXMgaXNUZXh0QmxvY2syIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvc2NoZW1hXCI7XG5pbXBvcnQgeyBzbGljZVRleHRCbG9jayB9IGZyb20gXCIuLi9fY2h1bmtzLWVzL3V0aWwuc2xpY2UtdGV4dC1ibG9jay5qc1wiO1xuaW1wb3J0IHsgZ2V0VGV4dEJsb2NrVGV4dCwgaXNFbXB0eVRleHRCbG9jayB9IGZyb20gXCIuLi9fY2h1bmtzLWVzL3V0aWwuc2xpY2UtdGV4dC1ibG9jay5qc1wiO1xuZnVuY3Rpb24gYmxvY2tPZmZzZXRUb0Jsb2NrU2VsZWN0aW9uUG9pbnQoe1xuICBjb250ZXh0LFxuICBibG9ja09mZnNldFxufSkge1xuICBsZXQgc2VsZWN0aW9uUG9pbnQ7XG4gIGZvciAoY29uc3QgYmxvY2sgb2YgY29udGV4dC52YWx1ZSlcbiAgICBpZiAoYmxvY2suX2tleSA9PT0gYmxvY2tPZmZzZXQucGF0aFswXS5fa2V5KSB7XG4gICAgICBzZWxlY3Rpb25Qb2ludCA9IHtcbiAgICAgICAgcGF0aDogW3tcbiAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgIH1dLFxuICAgICAgICBvZmZzZXQ6IGJsb2NrT2Zmc2V0Lm9mZnNldFxuICAgICAgfTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgcmV0dXJuIHNlbGVjdGlvblBvaW50O1xufVxuZnVuY3Rpb24gYmxvY2tPZmZzZXRUb1NlbGVjdGlvblBvaW50KHtcbiAgY29udGV4dCxcbiAgYmxvY2tPZmZzZXQsXG4gIGRpcmVjdGlvblxufSkge1xuICByZXR1cm4gYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCh7XG4gICAgY29udGV4dCxcbiAgICBibG9ja09mZnNldCxcbiAgICBkaXJlY3Rpb25cbiAgfSkgfHwgYmxvY2tPZmZzZXRUb0Jsb2NrU2VsZWN0aW9uUG9pbnQoe1xuICAgIGNvbnRleHQsXG4gICAgYmxvY2tPZmZzZXRcbiAgfSk7XG59XG5mdW5jdGlvbiBibG9ja09mZnNldHNUb1NlbGVjdGlvbih7XG4gIGNvbnRleHQsXG4gIG9mZnNldHMsXG4gIGJhY2t3YXJkXG59KSB7XG4gIGNvbnN0IGFuY2hvciA9IGJsb2NrT2Zmc2V0VG9TZWxlY3Rpb25Qb2ludCh7XG4gICAgY29udGV4dCxcbiAgICBibG9ja09mZnNldDogb2Zmc2V0cy5hbmNob3IsXG4gICAgZGlyZWN0aW9uOiBiYWNrd2FyZCA/IFwiYmFja3dhcmRcIiA6IFwiZm9yd2FyZFwiXG4gIH0pLCBmb2N1cyA9IGJsb2NrT2Zmc2V0VG9TZWxlY3Rpb25Qb2ludCh7XG4gICAgY29udGV4dCxcbiAgICBibG9ja09mZnNldDogb2Zmc2V0cy5mb2N1cyxcbiAgICBkaXJlY3Rpb246IGJhY2t3YXJkID8gXCJmb3J3YXJkXCIgOiBcImJhY2t3YXJkXCJcbiAgfSk7XG4gIHJldHVybiAhYW5jaG9yIHx8ICFmb2N1cyA/IG51bGwgOiB7XG4gICAgYW5jaG9yLFxuICAgIGZvY3VzLFxuICAgIGJhY2t3YXJkXG4gIH07XG59XG5mdW5jdGlvbiBjaGlsZFNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gIGNvbnRleHQsXG4gIHNlbGVjdGlvblBvaW50XG59KSB7XG4gIGxldCBvZmZzZXQgPSAwO1xuICBjb25zdCBibG9ja0tleSA9IGdldEJsb2NrS2V5RnJvbVNlbGVjdGlvblBvaW50KHNlbGVjdGlvblBvaW50KSwgY2hpbGRLZXkgPSBnZXRDaGlsZEtleUZyb21TZWxlY3Rpb25Qb2ludChzZWxlY3Rpb25Qb2ludCk7XG4gIGlmICghKCFibG9ja0tleSB8fCAhY2hpbGRLZXkpKSB7XG4gICAgZm9yIChjb25zdCBibG9jayBvZiBjb250ZXh0LnZhbHVlKVxuICAgICAgaWYgKGJsb2NrLl9rZXkgPT09IGJsb2NrS2V5ICYmIGlzVGV4dEJsb2NrKGNvbnRleHQsIGJsb2NrKSlcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBibG9jay5jaGlsZHJlbikge1xuICAgICAgICAgIGlmIChjaGlsZC5fa2V5ID09PSBjaGlsZEtleSlcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgICAgICAgX2tleTogYmxvY2suX2tleVxuICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQgKyBzZWxlY3Rpb25Qb2ludC5vZmZzZXRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgaXNTcGFuKGNvbnRleHQsIGNoaWxkKSAmJiAob2Zmc2V0ICs9IGNoaWxkLnRleHQubGVuZ3RoKTtcbiAgICAgICAgfVxuICB9XG59XG5mdW5jdGlvbiBpc0VxdWFsU2VsZWN0aW9ucyhhLCBiKSB7XG4gIHJldHVybiAhYSAmJiAhYiA/ICEwIDogIWEgfHwgIWIgPyAhMSA6IGlzRXF1YWxTZWxlY3Rpb25Qb2ludHMoYS5hbmNob3IsIGIuYW5jaG9yKSAmJiBpc0VxdWFsU2VsZWN0aW9uUG9pbnRzKGEuZm9jdXMsIGIuZm9jdXMpO1xufVxuZnVuY3Rpb24gbWVyZ2VUZXh0QmxvY2tzKHtcbiAgY29udGV4dCxcbiAgdGFyZ2V0QmxvY2ssXG4gIGluY29taW5nQmxvY2tcbn0pIHtcbiAgY29uc3QgcGFyc2VkSW5jb21pbmdCbG9jayA9IHBhcnNlQmxvY2soe1xuICAgIGNvbnRleHQsXG4gICAgYmxvY2s6IGluY29taW5nQmxvY2ssXG4gICAgb3B0aW9uczoge1xuICAgICAgbm9ybWFsaXplOiAhMSxcbiAgICAgIHJlbW92ZVVudXNlZE1hcmtEZWZzOiAhMCxcbiAgICAgIHZhbGlkYXRlRmllbGRzOiAhMVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiAhcGFyc2VkSW5jb21pbmdCbG9jayB8fCAhaXNUZXh0QmxvY2soY29udGV4dCwgcGFyc2VkSW5jb21pbmdCbG9jaykgPyB0YXJnZXRCbG9jayA6IHtcbiAgICAuLi50YXJnZXRCbG9jayxcbiAgICBjaGlsZHJlbjogWy4uLnRhcmdldEJsb2NrLmNoaWxkcmVuLCAuLi5wYXJzZWRJbmNvbWluZ0Jsb2NrLmNoaWxkcmVuXSxcbiAgICBtYXJrRGVmczogWy4uLnRhcmdldEJsb2NrLm1hcmtEZWZzID8/IFtdLCAuLi5wYXJzZWRJbmNvbWluZ0Jsb2NrLm1hcmtEZWZzID8/IFtdXVxuICB9O1xufVxuZnVuY3Rpb24gcmV2ZXJzZVNlbGVjdGlvbihzZWxlY3Rpb24pIHtcbiAgcmV0dXJuIHNlbGVjdGlvbiAmJiAoc2VsZWN0aW9uLmJhY2t3YXJkID8ge1xuICAgIGFuY2hvcjogc2VsZWN0aW9uLmZvY3VzLFxuICAgIGZvY3VzOiBzZWxlY3Rpb24uYW5jaG9yLFxuICAgIGJhY2t3YXJkOiAhMVxuICB9IDoge1xuICAgIGFuY2hvcjogc2VsZWN0aW9uLmZvY3VzLFxuICAgIGZvY3VzOiBzZWxlY3Rpb24uYW5jaG9yLFxuICAgIGJhY2t3YXJkOiAhMFxuICB9KTtcbn1cbmZ1bmN0aW9uIHNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gIGNvbnRleHQsXG4gIHNlbGVjdGlvblBvaW50XG59KSB7XG4gIGNvbnN0IGJsb2NrS2V5ID0gZ2V0QmxvY2tLZXlGcm9tU2VsZWN0aW9uUG9pbnQoc2VsZWN0aW9uUG9pbnQpO1xuICByZXR1cm4gc2VsZWN0aW9uUG9pbnQucGF0aC5sZW5ndGggPT09IDEgJiYgYmxvY2tLZXkgIT09IHZvaWQgMCA/IHtcbiAgICBwYXRoOiBbe1xuICAgICAgX2tleTogYmxvY2tLZXlcbiAgICB9XSxcbiAgICBvZmZzZXQ6IHNlbGVjdGlvblBvaW50Lm9mZnNldFxuICB9IDogY2hpbGRTZWxlY3Rpb25Qb2ludFRvQmxvY2tPZmZzZXQoe1xuICAgIGNvbnRleHQsXG4gICAgc2VsZWN0aW9uUG9pbnRcbiAgfSk7XG59XG5mdW5jdGlvbiBzcGxpdFRleHRCbG9jayh7XG4gIGNvbnRleHQsXG4gIGJsb2NrLFxuICBwb2ludFxufSkge1xuICBjb25zdCBmaXJzdENoaWxkID0gYmxvY2suY2hpbGRyZW4uYXQoMCksIGxhc3RDaGlsZCA9IGJsb2NrLmNoaWxkcmVuLmF0KGJsb2NrLmNoaWxkcmVuLmxlbmd0aCAtIDEpO1xuICBpZiAoIWZpcnN0Q2hpbGQgfHwgIWxhc3RDaGlsZClcbiAgICByZXR1cm47XG4gIGNvbnN0IGJlZm9yZSA9IHNsaWNlVGV4dEJsb2NrKHtcbiAgICBjb250ZXh0OiB7XG4gICAgICBzY2hlbWE6IGNvbnRleHQuc2NoZW1hLFxuICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgICBfa2V5OiBmaXJzdENoaWxkLl9rZXlcbiAgICAgICAgICB9XSxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfSxcbiAgICAgICAgZm9jdXM6IHBvaW50XG4gICAgICB9XG4gICAgfSxcbiAgICBibG9ja1xuICB9KSwgYWZ0ZXIgPSBzbGljZVRleHRCbG9jayh7XG4gICAgY29udGV4dDoge1xuICAgICAgc2NoZW1hOiBjb250ZXh0LnNjaGVtYSxcbiAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICBhbmNob3I6IHBvaW50LFxuICAgICAgICBmb2N1czoge1xuICAgICAgICAgIHBhdGg6IFt7XG4gICAgICAgICAgICBfa2V5OiBibG9jay5fa2V5XG4gICAgICAgICAgfSwgXCJjaGlsZHJlblwiLCB7XG4gICAgICAgICAgICBfa2V5OiBsYXN0Q2hpbGQuX2tleVxuICAgICAgICAgIH1dLFxuICAgICAgICAgIG9mZnNldDogaXNTcGFuKGNvbnRleHQsIGxhc3RDaGlsZCkgPyBsYXN0Q2hpbGQudGV4dC5sZW5ndGggOiAwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGJsb2NrXG4gIH0pO1xuICByZXR1cm4ge1xuICAgIGJlZm9yZSxcbiAgICBhZnRlclxuICB9O1xufVxuZXhwb3J0IHtcbiAgYmxvY2tPZmZzZXRUb0Jsb2NrU2VsZWN0aW9uUG9pbnQsXG4gIGJsb2NrT2Zmc2V0VG9TZWxlY3Rpb25Qb2ludCxcbiAgYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCxcbiAgYmxvY2tPZmZzZXRzVG9TZWxlY3Rpb24sXG4gIGNoaWxkU2VsZWN0aW9uUG9pbnRUb0Jsb2NrT2Zmc2V0LFxuICBnZXRCbG9ja0VuZFBvaW50LFxuICBnZXRCbG9ja1N0YXJ0UG9pbnQsXG4gIGdldFNlbGVjdGlvbkVuZFBvaW50LFxuICBnZXRTZWxlY3Rpb25TdGFydFBvaW50LFxuICBnZXRUZXh0QmxvY2tUZXh0LFxuICBpc0VtcHR5VGV4dEJsb2NrLFxuICBpc0VxdWFsU2VsZWN0aW9uUG9pbnRzLFxuICBpc0VxdWFsU2VsZWN0aW9ucyxcbiAgaXNLZXllZFNlZ21lbnQsXG4gIGlzU2VsZWN0aW9uQ29sbGFwc2VkLFxuICBpc1NwYW4yIGFzIGlzU3BhbixcbiAgaXNUZXh0QmxvY2syIGFzIGlzVGV4dEJsb2NrLFxuICBtZXJnZVRleHRCbG9ja3MsXG4gIHJldmVyc2VTZWxlY3Rpb24sXG4gIHNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCxcbiAgc2xpY2VCbG9ja3MsXG4gIHNwYW5TZWxlY3Rpb25Qb2ludFRvQmxvY2tPZmZzZXQsXG4gIHNwbGl0VGV4dEJsb2NrXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/editor/lib/utils/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/keyboard-shortcuts/dist/index.js":
/*!*********************************************************************!*\
  !*** ./node_modules/@portabletext/keyboard-shortcuts/dist/index.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   blockquote: () => (/* binding */ blockquote),\n/* harmony export */   bold: () => (/* binding */ bold),\n/* harmony export */   code: () => (/* binding */ code),\n/* harmony export */   createKeyboardShortcut: () => (/* binding */ createKeyboardShortcut),\n/* harmony export */   h1: () => (/* binding */ h1),\n/* harmony export */   h2: () => (/* binding */ h2),\n/* harmony export */   h3: () => (/* binding */ h3),\n/* harmony export */   h4: () => (/* binding */ h4),\n/* harmony export */   h5: () => (/* binding */ h5),\n/* harmony export */   h6: () => (/* binding */ h6),\n/* harmony export */   italic: () => (/* binding */ italic),\n/* harmony export */   link: () => (/* binding */ link),\n/* harmony export */   normal: () => (/* binding */ normal),\n/* harmony export */   redo: () => (/* binding */ redo),\n/* harmony export */   strikeThrough: () => (/* binding */ strikeThrough),\n/* harmony export */   underline: () => (/* binding */ underline),\n/* harmony export */   undo: () => (/* binding */ undo)\n/* harmony export */ });\nconst IS_APPLE = typeof window < \"u\" && /Mac|iPod|iPhone|iPad/.test(window.navigator.userAgent);\nfunction isKeyboardShortcut(definition, event) {\n  return isCorrectModifiers(definition, event) ? definition.code !== void 0 && definition.code.toLowerCase() === event.code.toLowerCase() ? !0 : definition.key !== void 0 && definition.key.toLowerCase() === event.key.toLowerCase() : !1;\n}\nfunction isCorrectModifiers(definition, event) {\n  return (definition.ctrl === event.ctrlKey || definition.ctrl === void 0) && (definition.meta === event.metaKey || definition.meta === void 0) && (definition.shift === event.shiftKey || definition.shift === void 0) && (definition.alt === event.altKey || definition.alt === void 0);\n}\nfunction createKeyboardShortcut(definition) {\n  if (IS_APPLE) {\n    const appleDefinition = definition.apple ?? definition.default, firstDefinition2 = appleDefinition.at(0);\n    return {\n      guard: (event) => appleDefinition.some(\n        (definition2) => isKeyboardShortcut(definition2, event)\n      ),\n      keys: [\n        ...firstDefinition2?.meta ? [\"\\u2318\"] : [],\n        ...firstDefinition2?.ctrl ? [\"Ctrl\"] : [],\n        ...firstDefinition2?.alt ? [\"Option\"] : [],\n        ...firstDefinition2?.shift ? [\"Shift\"] : [],\n        ...firstDefinition2?.key !== void 0 ? [firstDefinition2.key] : firstDefinition2?.code !== void 0 ? [firstDefinition2.code] : []\n      ]\n    };\n  }\n  const firstDefinition = definition.default.at(0);\n  return {\n    guard: (event) => definition.default.some(\n      (definition2) => isKeyboardShortcut(definition2, event)\n    ),\n    keys: [\n      ...firstDefinition?.meta ? [\"Meta\"] : [],\n      ...firstDefinition?.ctrl ? [\"Ctrl\"] : [],\n      ...firstDefinition?.alt ? [\"Alt\"] : [],\n      ...firstDefinition?.shift ? [\"Shift\"] : [],\n      ...firstDefinition?.key !== void 0 ? [firstDefinition.key] : firstDefinition?.code !== void 0 ? [firstDefinition.code] : []\n    ]\n  };\n}\nconst bold = createKeyboardShortcut({\n  default: [\n    {\n      key: \"B\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"B\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), italic = createKeyboardShortcut({\n  default: [\n    {\n      key: \"I\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"I\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), code = createKeyboardShortcut({\n  default: [\n    {\n      key: \"'\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"'\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), underline = createKeyboardShortcut({\n  default: [\n    {\n      key: \"U\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"U\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), strikeThrough = createKeyboardShortcut({\n  default: [\n    {\n      key: \"X\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !0\n    }\n  ],\n  apple: [\n    {\n      key: \"X\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !0\n    }\n  ]\n}), link = createKeyboardShortcut({\n  default: [\n    {\n      key: \"K\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"K\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), normal = createKeyboardShortcut({\n  default: [\n    {\n      key: \"0\",\n      code: \"Digit0\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"0\",\n      code: \"Numpad0\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"0\",\n      code: \"Digit0\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"0\",\n      code: \"Numpad0\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), h1 = createKeyboardShortcut({\n  default: [\n    {\n      key: \"1\",\n      code: \"Digit1\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"1\",\n      code: \"Numpad1\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"1\",\n      code: \"Digit1\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"1\",\n      code: \"Numpad1\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), h2 = createKeyboardShortcut({\n  default: [\n    {\n      key: \"2\",\n      code: \"Digit2\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"2\",\n      code: \"Numpad2\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"2\",\n      code: \"Digit2\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"2\",\n      code: \"Numpad2\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), h3 = createKeyboardShortcut({\n  default: [\n    {\n      key: \"3\",\n      code: \"Digit3\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"3\",\n      code: \"Numpad3\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"3\",\n      code: \"Digit3\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"3\",\n      code: \"Numpad3\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), h4 = createKeyboardShortcut({\n  default: [\n    {\n      key: \"4\",\n      code: \"Digit4\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"4\",\n      code: \"Numpad4\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"4\",\n      code: \"Digit4\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"4\",\n      code: \"Numpad4\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), h5 = createKeyboardShortcut({\n  default: [\n    {\n      key: \"5\",\n      code: \"Digit5\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"5\",\n      code: \"Numpad5\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"5\",\n      code: \"Digit5\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"5\",\n      code: \"Numpad5\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), h6 = createKeyboardShortcut({\n  default: [\n    {\n      key: \"6\",\n      code: \"Digit6\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"6\",\n      code: \"Numpad6\",\n      alt: !0,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"6\",\n      code: \"Digit6\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    },\n    {\n      key: \"6\",\n      code: \"Numpad6\",\n      alt: !0,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), blockquote = createKeyboardShortcut({\n  default: [\n    {\n      key: \"Q\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !0\n    }\n  ]\n}), undo = createKeyboardShortcut({\n  default: [\n    {\n      key: \"Z\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    }\n  ],\n  apple: [\n    {\n      key: \"Z\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !1\n    }\n  ]\n}), redo = createKeyboardShortcut({\n  default: [\n    {\n      key: \"Y\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !1\n    },\n    {\n      key: \"Z\",\n      alt: !1,\n      ctrl: !0,\n      meta: !1,\n      shift: !0\n    }\n  ],\n  apple: [\n    {\n      key: \"Z\",\n      alt: !1,\n      ctrl: !1,\n      meta: !0,\n      shift: !0\n    }\n  ]\n});\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9rZXlib2FyZC1zaG9ydGN1dHMvZGlzdC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFtQkM7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NyaXNwLWNsZWFuaW5nLy4vbm9kZV9tb2R1bGVzL0Bwb3J0YWJsZXRleHQva2V5Ym9hcmQtc2hvcnRjdXRzL2Rpc3QvaW5kZXguanM/NTZkNSJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBJU19BUFBMRSA9IHR5cGVvZiB3aW5kb3cgPCBcInVcIiAmJiAvTWFjfGlQb2R8aVBob25lfGlQYWQvLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xuZnVuY3Rpb24gaXNLZXlib2FyZFNob3J0Y3V0KGRlZmluaXRpb24sIGV2ZW50KSB7XG4gIHJldHVybiBpc0NvcnJlY3RNb2RpZmllcnMoZGVmaW5pdGlvbiwgZXZlbnQpID8gZGVmaW5pdGlvbi5jb2RlICE9PSB2b2lkIDAgJiYgZGVmaW5pdGlvbi5jb2RlLnRvTG93ZXJDYXNlKCkgPT09IGV2ZW50LmNvZGUudG9Mb3dlckNhc2UoKSA/ICEwIDogZGVmaW5pdGlvbi5rZXkgIT09IHZvaWQgMCAmJiBkZWZpbml0aW9uLmtleS50b0xvd2VyQ2FzZSgpID09PSBldmVudC5rZXkudG9Mb3dlckNhc2UoKSA6ICExO1xufVxuZnVuY3Rpb24gaXNDb3JyZWN0TW9kaWZpZXJzKGRlZmluaXRpb24sIGV2ZW50KSB7XG4gIHJldHVybiAoZGVmaW5pdGlvbi5jdHJsID09PSBldmVudC5jdHJsS2V5IHx8IGRlZmluaXRpb24uY3RybCA9PT0gdm9pZCAwKSAmJiAoZGVmaW5pdGlvbi5tZXRhID09PSBldmVudC5tZXRhS2V5IHx8IGRlZmluaXRpb24ubWV0YSA9PT0gdm9pZCAwKSAmJiAoZGVmaW5pdGlvbi5zaGlmdCA9PT0gZXZlbnQuc2hpZnRLZXkgfHwgZGVmaW5pdGlvbi5zaGlmdCA9PT0gdm9pZCAwKSAmJiAoZGVmaW5pdGlvbi5hbHQgPT09IGV2ZW50LmFsdEtleSB8fCBkZWZpbml0aW9uLmFsdCA9PT0gdm9pZCAwKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoZGVmaW5pdGlvbikge1xuICBpZiAoSVNfQVBQTEUpIHtcbiAgICBjb25zdCBhcHBsZURlZmluaXRpb24gPSBkZWZpbml0aW9uLmFwcGxlID8/IGRlZmluaXRpb24uZGVmYXVsdCwgZmlyc3REZWZpbml0aW9uMiA9IGFwcGxlRGVmaW5pdGlvbi5hdCgwKTtcbiAgICByZXR1cm4ge1xuICAgICAgZ3VhcmQ6IChldmVudCkgPT4gYXBwbGVEZWZpbml0aW9uLnNvbWUoXG4gICAgICAgIChkZWZpbml0aW9uMikgPT4gaXNLZXlib2FyZFNob3J0Y3V0KGRlZmluaXRpb24yLCBldmVudClcbiAgICAgICksXG4gICAgICBrZXlzOiBbXG4gICAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbjI/Lm1ldGEgPyBbXCJcXHUyMzE4XCJdIDogW10sXG4gICAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbjI/LmN0cmwgPyBbXCJDdHJsXCJdIDogW10sXG4gICAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbjI/LmFsdCA/IFtcIk9wdGlvblwiXSA6IFtdLFxuICAgICAgICAuLi5maXJzdERlZmluaXRpb24yPy5zaGlmdCA/IFtcIlNoaWZ0XCJdIDogW10sXG4gICAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbjI/LmtleSAhPT0gdm9pZCAwID8gW2ZpcnN0RGVmaW5pdGlvbjIua2V5XSA6IGZpcnN0RGVmaW5pdGlvbjI/LmNvZGUgIT09IHZvaWQgMCA/IFtmaXJzdERlZmluaXRpb24yLmNvZGVdIDogW11cbiAgICAgIF1cbiAgICB9O1xuICB9XG4gIGNvbnN0IGZpcnN0RGVmaW5pdGlvbiA9IGRlZmluaXRpb24uZGVmYXVsdC5hdCgwKTtcbiAgcmV0dXJuIHtcbiAgICBndWFyZDogKGV2ZW50KSA9PiBkZWZpbml0aW9uLmRlZmF1bHQuc29tZShcbiAgICAgIChkZWZpbml0aW9uMikgPT4gaXNLZXlib2FyZFNob3J0Y3V0KGRlZmluaXRpb24yLCBldmVudClcbiAgICApLFxuICAgIGtleXM6IFtcbiAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbj8ubWV0YSA/IFtcIk1ldGFcIl0gOiBbXSxcbiAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbj8uY3RybCA/IFtcIkN0cmxcIl0gOiBbXSxcbiAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbj8uYWx0ID8gW1wiQWx0XCJdIDogW10sXG4gICAgICAuLi5maXJzdERlZmluaXRpb24/LnNoaWZ0ID8gW1wiU2hpZnRcIl0gOiBbXSxcbiAgICAgIC4uLmZpcnN0RGVmaW5pdGlvbj8ua2V5ICE9PSB2b2lkIDAgPyBbZmlyc3REZWZpbml0aW9uLmtleV0gOiBmaXJzdERlZmluaXRpb24/LmNvZGUgIT09IHZvaWQgMCA/IFtmaXJzdERlZmluaXRpb24uY29kZV0gOiBbXVxuICAgIF1cbiAgfTtcbn1cbmNvbnN0IGJvbGQgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCJCXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITAsXG4gICAgICBtZXRhOiAhMSxcbiAgICAgIHNoaWZ0OiAhMVxuICAgIH1cbiAgXSxcbiAgYXBwbGU6IFtcbiAgICB7XG4gICAgICBrZXk6IFwiQlwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9XG4gIF1cbn0pLCBpdGFsaWMgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCJJXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITAsXG4gICAgICBtZXRhOiAhMSxcbiAgICAgIHNoaWZ0OiAhMVxuICAgIH1cbiAgXSxcbiAgYXBwbGU6IFtcbiAgICB7XG4gICAgICBrZXk6IFwiSVwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9XG4gIF1cbn0pLCBjb2RlID0gY3JlYXRlS2V5Ym9hcmRTaG9ydGN1dCh7XG4gIGRlZmF1bHQ6IFtcbiAgICB7XG4gICAgICBrZXk6IFwiJ1wiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9XG4gIF0sXG4gIGFwcGxlOiBbXG4gICAge1xuICAgICAga2V5OiBcIidcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgdW5kZXJsaW5lID0gY3JlYXRlS2V5Ym9hcmRTaG9ydGN1dCh7XG4gIGRlZmF1bHQ6IFtcbiAgICB7XG4gICAgICBrZXk6IFwiVVwiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9XG4gIF0sXG4gIGFwcGxlOiBbXG4gICAge1xuICAgICAga2V5OiBcIlVcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgc3RyaWtlVGhyb3VnaCA9IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICBkZWZhdWx0OiBbXG4gICAge1xuICAgICAga2V5OiBcIlhcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICEwXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCJYXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITEsXG4gICAgICBtZXRhOiAhMCxcbiAgICAgIHNoaWZ0OiAhMFxuICAgIH1cbiAgXVxufSksIGxpbmsgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCJLXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITAsXG4gICAgICBtZXRhOiAhMSxcbiAgICAgIHNoaWZ0OiAhMVxuICAgIH1cbiAgXSxcbiAgYXBwbGU6IFtcbiAgICB7XG4gICAgICBrZXk6IFwiS1wiLFxuICAgICAgYWx0OiAhMSxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9XG4gIF1cbn0pLCBub3JtYWwgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCIwXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0MFwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIwXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDBcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCIwXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0MFwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIwXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDBcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgaDEgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCIxXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0MVwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIxXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDFcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCIxXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0MVwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIxXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDFcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgaDIgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCIyXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0MlwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIyXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDJcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCIyXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0MlwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIyXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDJcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgaDMgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCIzXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0M1wiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIzXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDNcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCIzXCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0M1wiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCIzXCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDNcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgaDQgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCI0XCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0NFwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCI0XCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDRcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCI0XCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0NFwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCI0XCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDRcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgaDUgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCI1XCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0NVwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCI1XCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDVcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCI1XCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0NVwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCI1XCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDVcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgaDYgPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCI2XCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0NlwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICEwLFxuICAgICAgbWV0YTogITEsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCI2XCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDZcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCI2XCIsXG4gICAgICBjb2RlOiBcIkRpZ2l0NlwiLFxuICAgICAgYWx0OiAhMCxcbiAgICAgIGN0cmw6ICExLFxuICAgICAgbWV0YTogITAsXG4gICAgICBzaGlmdDogITFcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCI2XCIsXG4gICAgICBjb2RlOiBcIk51bXBhZDZcIixcbiAgICAgIGFsdDogITAsXG4gICAgICBjdHJsOiAhMSxcbiAgICAgIG1ldGE6ICEwLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdXG59KSwgYmxvY2txdW90ZSA9IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICBkZWZhdWx0OiBbXG4gICAge1xuICAgICAga2V5OiBcIlFcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICEwXG4gICAgfVxuICBdXG59KSwgdW5kbyA9IGNyZWF0ZUtleWJvYXJkU2hvcnRjdXQoe1xuICBkZWZhdWx0OiBbXG4gICAge1xuICAgICAga2V5OiBcIlpcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICExXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCJaXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITEsXG4gICAgICBtZXRhOiAhMCxcbiAgICAgIHNoaWZ0OiAhMVxuICAgIH1cbiAgXVxufSksIHJlZG8gPSBjcmVhdGVLZXlib2FyZFNob3J0Y3V0KHtcbiAgZGVmYXVsdDogW1xuICAgIHtcbiAgICAgIGtleTogXCJZXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITAsXG4gICAgICBtZXRhOiAhMSxcbiAgICAgIHNoaWZ0OiAhMVxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiBcIlpcIixcbiAgICAgIGFsdDogITEsXG4gICAgICBjdHJsOiAhMCxcbiAgICAgIG1ldGE6ICExLFxuICAgICAgc2hpZnQ6ICEwXG4gICAgfVxuICBdLFxuICBhcHBsZTogW1xuICAgIHtcbiAgICAgIGtleTogXCJaXCIsXG4gICAgICBhbHQ6ICExLFxuICAgICAgY3RybDogITEsXG4gICAgICBtZXRhOiAhMCxcbiAgICAgIHNoaWZ0OiAhMFxuICAgIH1cbiAgXVxufSk7XG5leHBvcnQge1xuICBibG9ja3F1b3RlLFxuICBib2xkLFxuICBjb2RlLFxuICBjcmVhdGVLZXlib2FyZFNob3J0Y3V0LFxuICBoMSxcbiAgaDIsXG4gIGgzLFxuICBoNCxcbiAgaDUsXG4gIGg2LFxuICBpdGFsaWMsXG4gIGxpbmssXG4gIG5vcm1hbCxcbiAgcmVkbyxcbiAgc3RyaWtlVGhyb3VnaCxcbiAgdW5kZXJsaW5lLFxuICB1bmRvXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/keyboard-shortcuts/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/markdown/dist/index.js":
/*!***********************************************************!*\
  !*** ./node_modules/@portabletext/markdown/dist/index.js ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DefaultBlockSpacingRenderer: () => (/* binding */ DefaultBlockSpacingRenderer),\n/* harmony export */   DefaultBlockquoteRenderer: () => (/* binding */ DefaultBlockquoteRenderer),\n/* harmony export */   DefaultCodeBlockRenderer: () => (/* binding */ DefaultCodeBlockRenderer),\n/* harmony export */   DefaultCodeRenderer: () => (/* binding */ DefaultCodeRenderer),\n/* harmony export */   DefaultEmRenderer: () => (/* binding */ DefaultEmRenderer),\n/* harmony export */   DefaultH1Renderer: () => (/* binding */ DefaultH1Renderer),\n/* harmony export */   DefaultH2Renderer: () => (/* binding */ DefaultH2Renderer),\n/* harmony export */   DefaultH3Renderer: () => (/* binding */ DefaultH3Renderer),\n/* harmony export */   DefaultH4Renderer: () => (/* binding */ DefaultH4Renderer),\n/* harmony export */   DefaultH5Renderer: () => (/* binding */ DefaultH5Renderer),\n/* harmony export */   DefaultH6Renderer: () => (/* binding */ DefaultH6Renderer),\n/* harmony export */   DefaultHardBreakRenderer: () => (/* binding */ DefaultHardBreakRenderer),\n/* harmony export */   DefaultHorizontalRuleRenderer: () => (/* binding */ DefaultHorizontalRuleRenderer),\n/* harmony export */   DefaultHtmlRenderer: () => (/* binding */ DefaultHtmlRenderer),\n/* harmony export */   DefaultImageRenderer: () => (/* binding */ DefaultImageRenderer),\n/* harmony export */   DefaultLinkRenderer: () => (/* binding */ DefaultLinkRenderer),\n/* harmony export */   DefaultListItemRenderer: () => (/* binding */ DefaultListItemRenderer),\n/* harmony export */   DefaultNormalRenderer: () => (/* binding */ DefaultNormalRenderer),\n/* harmony export */   DefaultStrikeThroughRenderer: () => (/* binding */ DefaultStrikeThroughRenderer),\n/* harmony export */   DefaultStrongRenderer: () => (/* binding */ DefaultStrongRenderer),\n/* harmony export */   DefaultTableRenderer: () => (/* binding */ DefaultTableRenderer),\n/* harmony export */   DefaultUnderlineRenderer: () => (/* binding */ DefaultUnderlineRenderer),\n/* harmony export */   markdownToPortableText: () => (/* binding */ markdownToPortableText),\n/* harmony export */   portableTextToMarkdown: () => (/* binding */ portableTextToMarkdown)\n/* harmony export */ });\n/* harmony import */ var _portabletext_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/schema */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/toolkit */ \"(ssr)/./node_modules/@portabletext/toolkit/dist/index.js\");\n/* harmony import */ var markdown_it__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! markdown-it */ \"(ssr)/./node_modules/markdown-it/index.mjs\");\n\n\n\nfunction defaultKeyGenerator() {\n  return randomKey(12);\n}\nconst getByteHexTable = /* @__PURE__ */ (() => {\n  let table;\n  return () => {\n    if (table)\n      return table;\n    table = [];\n    for (let i = 0; i < 256; ++i)\n      table[i] = (i + 256).toString(16).slice(1);\n    return table;\n  };\n})();\nfunction whatwgRNG(length = 16) {\n  const rnds8 = new Uint8Array(length);\n  return crypto.getRandomValues(rnds8), rnds8;\n}\nfunction randomKey(length) {\n  const table = getByteHexTable();\n  return whatwgRNG(length).reduce((str, n) => str + table[n], \"\").slice(0, length);\n}\nconst schema = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.compileSchema)((0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.defineSchema)({}));\nfunction buildListIndexMap(blocks) {\n  const levelIndexMaps = /* @__PURE__ */ new Map(), listIndexMap = /* @__PURE__ */ new Map();\n  let previousListItem;\n  for (let blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n    const block = blocks.at(blockIndex);\n    if (block === void 0)\n      continue;\n    if (block._key || (block._key = defaultKeyGenerator()), !(0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isTextBlock)({ schema }, block)) {\n      levelIndexMaps.clear(), previousListItem = void 0;\n      continue;\n    }\n    if (block.listItem === void 0 || block.level === void 0) {\n      levelIndexMaps.clear(), previousListItem = void 0;\n      continue;\n    }\n    if (!previousListItem) {\n      const levelIndexMap2 = levelIndexMaps.get(block.listItem) ?? /* @__PURE__ */ new Map();\n      levelIndexMap2.set(block.level, 1), levelIndexMaps.set(block.listItem, levelIndexMap2), listIndexMap.set(block._key, 1), previousListItem = {\n        listItem: block.listItem,\n        level: block.level\n      };\n      continue;\n    }\n    if (previousListItem.listItem === block.listItem && previousListItem.level < block.level) {\n      const levelIndexMap2 = levelIndexMaps.get(block.listItem) ?? /* @__PURE__ */ new Map();\n      levelIndexMap2.set(block.level, 1), levelIndexMaps.set(block.listItem, levelIndexMap2), listIndexMap.set(block._key, 1), previousListItem = {\n        listItem: block.listItem,\n        level: block.level\n      };\n      continue;\n    }\n    levelIndexMaps.forEach((levelIndexMap2, listItem) => {\n      if (listItem === block.listItem)\n        return;\n      const levelsToDelete = [];\n      levelIndexMap2.forEach((_, level) => {\n        level >= block.level && levelsToDelete.push(level);\n      }), levelsToDelete.forEach((level) => {\n        levelIndexMap2.delete(level);\n      });\n    });\n    const levelIndexMap = levelIndexMaps.get(block.listItem) ?? /* @__PURE__ */ new Map(), levelCounter = levelIndexMap.get(block.level) ?? 0;\n    levelIndexMap.set(block.level, levelCounter + 1), levelIndexMaps.set(block.listItem, levelIndexMap), listIndexMap.set(block._key, levelCounter + 1), previousListItem = {\n      listItem: block.listItem,\n      level: block.level\n    };\n  }\n  return listIndexMap;\n}\nconst createRenderNode = (renderers, listIndexMap) => {\n  function renderNode(options) {\n    const { node, index, isInline } = options;\n    return (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextListItemBlock)(node) ? renderListItem(node, index) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextToolkitSpan)(node) ? renderSpan(node) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextBlock)(node) ? renderBlock(node, index, isInline) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextToolkitTextNode)(node) ? renderText(node) : renderCustomBlock(node, index, isInline);\n  }\n  function renderListItem(node, index) {\n    const renderer = renderers.listItem, itemHandler = (typeof renderer == \"function\" ? renderer : renderer[node.listItem]) || renderers.unknownListItem;\n    let children = (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.buildMarksTree)(node).map((child, i) => renderNode({ node: child, isInline: !0, index: i })).join(\"\");\n    if (node.style && node.style !== \"normal\") {\n      const { listItem: _listItem, ...blockNode } = node;\n      children = renderNode({\n        node: blockNode,\n        index,\n        isInline: !1\n      }), children = children.replace(/\\n+$/, \"\");\n    }\n    return itemHandler({\n      value: node,\n      index,\n      listIndex: node._key ? listIndexMap.get(node._key) : void 0,\n      isInline: !1,\n      renderNode,\n      children\n    });\n  }\n  function renderSpan(node) {\n    const { markDef, markType, markKey } = node, span = renderers.marks[markType] || renderers.unknownMark, children = node.children.map(\n      (child, childIndex) => renderNode({ node: child, index: childIndex, isInline: !0 })\n    );\n    return span({\n      text: (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.spanToPlainText)(node),\n      value: markDef,\n      markType,\n      markKey,\n      renderNode,\n      children: children.join(\"\")\n    });\n  }\n  function renderBlock(node, index, isInline) {\n    const { _key, ...props } = serializeBlock({ node, index, isInline, renderNode }), style = props.node.style || \"normal\";\n    return ((typeof renderers.block == \"function\" ? renderers.block : renderers.block[style]) || renderers.unknownBlockStyle)({ ...props, value: props.node, renderNode });\n  }\n  function renderText(node) {\n    return node.text === `\n` ? renderers.hardBreak() : node.text;\n  }\n  function renderCustomBlock(value, index, isInline) {\n    return (renderers.types[value._type] ?? renderers.unknownType)({\n      value,\n      isInline,\n      index,\n      renderNode\n    });\n  }\n  return renderNode;\n};\nfunction serializeBlock(options) {\n  const { node, index, isInline, renderNode } = options, renderedChildren = (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.buildMarksTree)(node).map(\n    (child, i) => renderNode({ node: child, isInline: !0, index: i, renderNode })\n  );\n  return {\n    _key: node._key || defaultKeyGenerator(),\n    children: renderedChildren.join(\"\"),\n    index,\n    isInline,\n    node\n  };\n}\nconst DefaultBlockSpacingRenderer = ({\n  current,\n  next\n}) => (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextListItemBlock)(current) && (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextListItemBlock)(next) ? `\n` : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextBlock)(current) && (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextBlock)(next) && current.style === \"blockquote\" && next.style === \"blockquote\" ? `\n>\n` : `\n\n`, DefaultHardBreakRenderer = () => `  \n`, DefaultListItemRenderer = ({\n  children,\n  value,\n  listIndex\n}) => {\n  const listStyle = value.listItem || \"bullet\", level = value.level || 1;\n  return listStyle === \"number\" ? `${\"   \".repeat(level - 1)}${listIndex ?? 1}. ${children}` : `${\"   \".repeat(level - 1)}- ${children}`;\n}, DefaultUnknownListItemRenderer = ({\n  children\n}) => `- ${children}\n`;\nfunction escapeImageAndLinkText(text) {\n  return text.replace(/([[\\]\\\\])/g, \"\\\\$1\");\n}\nfunction unescapeImageAndLinkText(text) {\n  return text.replace(/\\\\([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^_`{|}~])/g, \"$1\");\n}\nfunction escapeImageAndLinkTitle(text) {\n  return text.replace(/([\\\\\"])/g, \"\\\\$1\");\n}\nconst DefaultEmRenderer = ({ children }) => `_${children}_`, DefaultStrongRenderer = ({ children }) => `**${children}**`, DefaultCodeRenderer = ({ children }) => `\\`${children}\\``, DefaultUnderlineRenderer = ({\n  children\n}) => `<u>${children}</u>`, DefaultStrikeThroughRenderer = ({\n  children\n}) => `~~${children}~~`, DefaultLinkRenderer = ({\n  children,\n  value\n}) => {\n  const href = value?.href || \"\", title = value?.title || \"\";\n  if (uriLooksSafe(href)) {\n    if (/[\"'][^\"']*[<>]|[<>][^<>]*[\"']/.test(href)) {\n      const encodedHref = href.replace(/[\"<>() ]/g, (char) => `%${char.charCodeAt(0).toString(16).toUpperCase()}`);\n      return `[${escapeImageAndLinkText(children)}](${encodedHref})`;\n    }\n    return `[${escapeImageAndLinkText(children)}](${href}${title ? ` \"${escapeImageAndLinkTitle(title)}\"` : \"\"})`;\n  }\n  return children;\n};\nfunction uriLooksSafe(uri) {\n  const url = (uri || \"\").trim(), first = url.charAt(0);\n  if (first === \"#\" || first === \"/\")\n    return !0;\n  const colonIndex = url.indexOf(\":\");\n  if (colonIndex === -1)\n    return !0;\n  const allowedProtocols = [\"http\", \"https\", \"mailto\", \"tel\"], proto = url.slice(0, colonIndex).toLowerCase();\n  if (allowedProtocols.indexOf(proto) !== -1)\n    return !0;\n  const queryIndex = url.indexOf(\"?\");\n  if (queryIndex !== -1 && colonIndex > queryIndex)\n    return !0;\n  const hashIndex = url.indexOf(\"#\");\n  return hashIndex !== -1 && colonIndex > hashIndex;\n}\nconst DefaultUnknownMarkRenderer = ({\n  children\n}) => children, DefaultNormalRenderer = ({\n  children\n}) => !children || children.trim() === \"\" ? \"\" : children, DefaultBlockquoteRenderer = ({\n  children\n}) => children ? children.split(`\n`).map((line) => `> ${line}`).join(`\n`) : \">\", DefaultH1Renderer = ({ children }) => `# ${children}`, DefaultH2Renderer = ({ children }) => `## ${children}`, DefaultH3Renderer = ({ children }) => `### ${children}`, DefaultH4Renderer = ({ children }) => `#### ${children}`, DefaultH5Renderer = ({ children }) => `##### ${children}`, DefaultH6Renderer = ({ children }) => `###### ${children}`, DefaultUnknownStyleRenderer = ({\n  children\n}) => children ?? \"\", DefaultCodeBlockRenderer = ({ value }) => `\\`\\`\\`${value.language ?? \"\"}\n${value.code}\n\\`\\`\\``, DefaultHorizontalRuleRenderer = () => \"---\", DefaultHtmlRenderer = ({ value }) => value.html, DefaultImageRenderer = ({ value }) => {\n  const alt = escapeImageAndLinkText(value.alt ?? \"\"), title = value.title ? ` \"${escapeImageAndLinkTitle(value.title)}\"` : \"\";\n  return `![${alt}](${value.src}${title})`;\n}, DefaultTableRenderer = ({ value, renderNode }) => {\n  const headerRows = value.headerRows || 0, rows = value.rows, lines = [], getCellText = (cellBlocks) => cellBlocks.map(\n    (block, index) => renderNode({\n      node: block,\n      index,\n      isInline: !1,\n      renderNode\n    })\n  ).join(\" \").trim();\n  for (let i = 0; i < headerRows; i++) {\n    const row = rows[i];\n    if (row) {\n      const cellTexts = row.cells.map((cell) => getCellText(cell.value));\n      lines.push(`| ${cellTexts.join(\" | \")} |`);\n    }\n  }\n  if (headerRows > 0 && rows[0]) {\n    const separators = rows[0].cells.map(() => \" --- \");\n    lines.push(`|${separators.join(\"|\")}|`);\n  }\n  for (let i = headerRows; i < rows.length; i++) {\n    const row = rows[i];\n    if (row) {\n      const cellTexts = row.cells.map((cell) => getCellText(cell.value));\n      lines.push(`| ${cellTexts.join(\" | \")} |`);\n    }\n  }\n  return lines.join(`\n`);\n}, DefaultUnknownTypeRenderer = ({\n  value,\n  isInline\n}) => {\n  const json = `\\`\\`\\`json\n${JSON.stringify(value, null, 2)}\n\\`\\`\\``;\n  return isInline ? `\n${json}\n` : json;\n}, defaultRenderers = {\n  types: {},\n  block: {\n    normal: DefaultNormalRenderer,\n    blockquote: DefaultBlockquoteRenderer,\n    h1: DefaultH1Renderer,\n    h2: DefaultH2Renderer,\n    h3: DefaultH3Renderer,\n    h4: DefaultH4Renderer,\n    h5: DefaultH5Renderer,\n    h6: DefaultH6Renderer\n  },\n  marks: {\n    em: DefaultEmRenderer,\n    strong: DefaultStrongRenderer,\n    code: DefaultCodeRenderer,\n    underline: DefaultUnderlineRenderer,\n    \"strike-through\": DefaultStrikeThroughRenderer,\n    link: DefaultLinkRenderer\n  },\n  listItem: DefaultListItemRenderer,\n  hardBreak: DefaultHardBreakRenderer,\n  unknownType: DefaultUnknownTypeRenderer,\n  unknownMark: DefaultUnknownMarkRenderer,\n  unknownListItem: DefaultUnknownListItemRenderer,\n  unknownBlockStyle: DefaultUnknownStyleRenderer\n};\nfunction portableTextToMarkdown(blocks, options = {}) {\n  const renderers = {\n    block: {\n      ...defaultRenderers.block,\n      ...options.block\n    },\n    listItem: options.listItem ?? defaultRenderers.listItem,\n    marks: {\n      ...defaultRenderers.marks,\n      ...options.marks\n    },\n    types: {\n      ...defaultRenderers.types,\n      ...options.types\n    },\n    hardBreak: options.hardBreak ?? defaultRenderers.hardBreak,\n    unknownType: options.unknownType ?? defaultRenderers.unknownType,\n    unknownBlockStyle: options.unknownBlockStyle ?? defaultRenderers.unknownBlockStyle,\n    unknownListItem: options.unknownListItem ?? defaultRenderers.unknownListItem,\n    unknownMark: options.unknownMark ?? defaultRenderers.unknownMark\n  }, renderBlockSpacing = options.blockSpacing ?? DefaultBlockSpacingRenderer, listIndexMap = buildListIndexMap(blocks), renderNode = createRenderNode(renderers, listIndexMap);\n  return blocks.map((node, index) => {\n    const renderedNode = renderNode({\n      node,\n      index,\n      isInline: !1,\n      renderNode\n    });\n    if (index === blocks.length - 1)\n      return renderedNode;\n    const nextNode = blocks.at(index + 1);\n    if (!nextNode)\n      return renderedNode;\n    const blockSpacing = renderBlockSpacing({\n      current: node,\n      next: nextNode\n    }) ?? `\n\n`;\n    return `${renderedNode}${blockSpacing}`;\n  }).join(\"\");\n}\nconst normalStyleDefinition = {\n  name: \"normal\"\n}, h1StyleDefinition = {\n  name: \"h1\"\n}, h2StyleDefinition = {\n  name: \"h2\"\n}, h3StyleDefinition = {\n  name: \"h3\"\n}, h4StyleDefinition = {\n  name: \"h4\"\n}, h5StyleDefinition = {\n  name: \"h5\"\n}, h6StyleDefinition = {\n  name: \"h6\"\n}, blockquoteStyleDefinition = {\n  name: \"blockquote\"\n}, defaultOrderedListItemDefinition = {\n  name: \"number\"\n}, defaultUnorderedListItemDefinition = {\n  name: \"bullet\"\n}, defaultStrongDecoratorDefinition = {\n  name: \"strong\"\n}, defaultEmDecoratorDefinition = {\n  name: \"em\"\n}, defaultCodeDecoratorDefinition = {\n  name: \"code\"\n}, defaultStrikeThroughDecoratorDefinition = {\n  name: \"strike-through\"\n}, defaultLinkObjectDefinition = {\n  name: \"link\",\n  fields: [\n    { name: \"href\", type: \"string\" },\n    { name: \"title\", type: \"string\" }\n  ]\n}, defaultCodeObjectDefinition = {\n  name: \"code\",\n  fields: [\n    { name: \"language\", type: \"string\" },\n    { name: \"code\", type: \"string\" }\n  ]\n}, defaultImageObjectDefinition = {\n  name: \"image\",\n  fields: [\n    { name: \"src\", type: \"string\" },\n    { name: \"alt\", type: \"string\" },\n    { name: \"title\", type: \"string\" }\n  ]\n}, defaultHorizontalRuleObjectDefinition = {\n  name: \"horizontal-rule\"\n}, defaultHtmlObjectDefinition = {\n  name: \"html\",\n  fields: [{ name: \"html\", type: \"string\" }]\n}, defaultTableObjectDefinition = {\n  name: \"table\",\n  fields: [\n    { name: \"headerRows\", type: \"number\" },\n    { name: \"rows\", type: \"array\" }\n  ]\n}, defaultSchema = (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.compileSchema)(\n  (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.defineSchema)({\n    styles: [\n      normalStyleDefinition,\n      h1StyleDefinition,\n      h2StyleDefinition,\n      h3StyleDefinition,\n      h4StyleDefinition,\n      h5StyleDefinition,\n      h6StyleDefinition,\n      blockquoteStyleDefinition\n    ],\n    lists: [\n      defaultOrderedListItemDefinition,\n      defaultUnorderedListItemDefinition\n    ],\n    decorators: [\n      defaultStrongDecoratorDefinition,\n      defaultEmDecoratorDefinition,\n      defaultCodeDecoratorDefinition,\n      defaultStrikeThroughDecoratorDefinition\n    ],\n    annotations: [defaultLinkObjectDefinition],\n    blockObjects: [\n      defaultCodeObjectDefinition,\n      defaultHorizontalRuleObjectDefinition,\n      defaultImageObjectDefinition,\n      defaultHtmlObjectDefinition,\n      defaultTableObjectDefinition\n    ],\n    inlineObjects: [defaultImageObjectDefinition]\n  })\n);\nfunction buildStyleMatcher(definition) {\n  return ({ context }) => {\n    const schemaDefinition = context.schema.styles.find(\n      (item) => item.name === definition.name\n    );\n    if (schemaDefinition)\n      return schemaDefinition.name;\n  };\n}\nfunction buildListItemMatcher(definition) {\n  return ({ context }) => {\n    const schemaDefinition = context.schema.lists.find(\n      (item) => item.name === definition.name\n    );\n    if (schemaDefinition)\n      return schemaDefinition.name;\n  };\n}\nfunction buildDecoratorMatcher(definition) {\n  return ({ context }) => {\n    const schemaDefinition = context.schema.decorators.find(\n      (item) => item.name === definition.name\n    );\n    if (schemaDefinition)\n      return schemaDefinition.name;\n  };\n}\nfunction buildAnnotationMatcher(definition) {\n  return ({ context, value }) => {\n    const schemaDefinition = context.schema.annotations.find(\n      (item) => item.name === definition.name\n    );\n    if (!schemaDefinition)\n      return;\n    const filteredValue = schemaDefinition.fields.reduce((filteredValue2, field) => {\n      const fieldValue = value[field.name];\n      return fieldValue !== void 0 && (filteredValue2[field.name] = fieldValue), filteredValue2;\n    }, {});\n    return {\n      _key: context.keyGenerator(),\n      _type: schemaDefinition.name,\n      ...filteredValue\n    };\n  };\n}\nfunction buildObjectMatcher(definition) {\n  return ({ context, value, isInline }) => {\n    const schemaDefinition = (isInline ? context.schema.inlineObjects : context.schema.blockObjects).find(\n      (item) => item.name === definition.name\n    );\n    if (!schemaDefinition)\n      return;\n    const filteredValue = schemaDefinition.fields.reduce((filteredValue2, field) => {\n      const fieldValue = value[field.name];\n      return fieldValue !== void 0 && (filteredValue2[field.name] = fieldValue), filteredValue2;\n    }, {});\n    return {\n      _key: context.keyGenerator(),\n      _type: schemaDefinition.name,\n      ...filteredValue\n    };\n  };\n}\nconst codeBlockMatcher = ({ context, value, isInline }) => {\n  const codeObject = buildObjectMatcher(defaultCodeObjectDefinition)({ context, value, isInline });\n  if (codeObject && \"code\" in codeObject)\n    return codeObject;\n}, imageBlockMatcher = ({ context, value, isInline }) => {\n  const imageObject = buildObjectMatcher(defaultImageObjectDefinition)({ context, value, isInline });\n  if (imageObject && \"src\" in imageObject)\n    return imageObject;\n}, defaultOptions = {\n  block: {\n    normal: buildStyleMatcher(normalStyleDefinition),\n    blockquote: buildStyleMatcher(blockquoteStyleDefinition),\n    h1: buildStyleMatcher(h1StyleDefinition),\n    h2: buildStyleMatcher(h2StyleDefinition),\n    h3: buildStyleMatcher(h3StyleDefinition),\n    h4: buildStyleMatcher(h4StyleDefinition),\n    h5: buildStyleMatcher(h5StyleDefinition),\n    h6: buildStyleMatcher(h6StyleDefinition)\n  },\n  listItem: {\n    number: buildListItemMatcher(defaultOrderedListItemDefinition),\n    bullet: buildListItemMatcher(defaultUnorderedListItemDefinition)\n  },\n  marks: {\n    strong: buildDecoratorMatcher(defaultStrongDecoratorDefinition),\n    em: buildDecoratorMatcher(defaultEmDecoratorDefinition),\n    code: buildDecoratorMatcher(defaultCodeDecoratorDefinition),\n    strikeThrough: buildDecoratorMatcher(\n      defaultStrikeThroughDecoratorDefinition\n    ),\n    link: buildAnnotationMatcher(defaultLinkObjectDefinition)\n  },\n  types: {\n    code: codeBlockMatcher,\n    horizontalRule: buildObjectMatcher(defaultHorizontalRuleObjectDefinition),\n    html: buildObjectMatcher(defaultHtmlObjectDefinition),\n    image: imageBlockMatcher\n  }\n};\nfunction flattenTable(table, portableText) {\n  for (const row of table.rows)\n    for (const cell of row.cells)\n      for (const block of cell.value)\n        portableText.push(block);\n}\nfunction markdownToPortableText(markdown, options) {\n  const consolidatedOptions = {\n    schema: options?.schema ?? defaultSchema,\n    keyGenerator: options?.keyGenerator ?? defaultKeyGenerator,\n    html: {\n      inline: options?.html?.inline ?? \"skip\"\n    },\n    marks: {\n      ...defaultOptions.marks,\n      ...options?.marks\n    },\n    block: {\n      ...defaultOptions.block,\n      ...options?.block\n    },\n    listItem: {\n      ...defaultOptions.listItem,\n      ...options?.listItem\n    },\n    types: {\n      ...defaultOptions.types,\n      ...options?.types\n    }\n  }, tokens = (0,markdown_it__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n    html: !0,\n    linkify: !0,\n    typographer: !0\n  }).enable([\"strikethrough\", \"table\"]).parse(markdown, {}), portableText = [];\n  let currentBlock = null;\n  const currentListStack = [], markDefRefs = [];\n  let currentMarkDefs = [], currentBlockquoteStyle = null, inListItem = !1, currentTable = null, currentTableRow = null, inTableHead = !1;\n  const startBlock = (style) => {\n    flushBlock(), currentBlock = {\n      _type: \"block\",\n      style,\n      children: [],\n      _key: consolidatedOptions.keyGenerator(),\n      markDefs: []\n    }, currentMarkDefs = [];\n  }, flushBlock = () => {\n    currentBlock && (currentBlock.children.length === 0 && currentBlock.children.push({\n      _type: consolidatedOptions.schema.span.name,\n      _key: consolidatedOptions.keyGenerator(),\n      text: \"\",\n      marks: []\n    }), currentBlock.markDefs = currentMarkDefs, portableText.push(currentBlock), currentBlock = null, currentMarkDefs = []);\n  }, addSpan = (text) => {\n    if (text.length === 0)\n      return;\n    if (!currentBlock) {\n      const style = currentBlockquoteStyle ?? consolidatedOptions.block.normal({\n        context: { schema: consolidatedOptions.schema }\n      });\n      style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\"));\n    }\n    if (!currentBlock)\n      throw new Error(\"Expected current block\");\n    const lastChild = currentBlock.children.at(-1);\n    (0,_portabletext_schema__WEBPACK_IMPORTED_MODULE_1__.isSpan)({ schema: consolidatedOptions.schema }, lastChild) && lastChild.marks?.every((mark) => markDefRefs.includes(mark)) && markDefRefs.every((mark) => lastChild.marks?.includes(mark)) ? lastChild.text += text : currentBlock.children.push({\n      _type: consolidatedOptions.schema.span.name,\n      _key: consolidatedOptions.keyGenerator(),\n      text,\n      marks: [...markDefRefs]\n    });\n  }, listLevel = () => currentListStack.length, ensureListBlock = (listItem) => {\n    if (!currentBlock) {\n      const style = currentBlockquoteStyle ?? consolidatedOptions.block.normal({\n        context: { schema: consolidatedOptions.schema }\n      });\n      style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\"));\n    }\n    if (!currentBlock)\n      throw new Error(\"Expected current block\");\n    (currentBlock.listItem !== listItem || currentBlock.level !== listLevel()) && (currentBlock.listItem = listItem, currentBlock.level = listLevel());\n  };\n  for (const token of tokens)\n    switch (token.type) {\n      // Paragraphs\n      case \"paragraph_open\": {\n        if (inListItem) {\n          if (!currentBlock) {\n            const listType = currentListStack.at(-1);\n            listType && ensureListBlock(listType);\n          }\n          break;\n        }\n        const style = currentBlockquoteStyle ?? consolidatedOptions.block.normal({\n          context: { schema: consolidatedOptions.schema }\n        });\n        if (!style) {\n          console.warn('No default style found, using \"normal\"'), startBlock(\"normal\");\n          break;\n        }\n        startBlock(style);\n        break;\n      }\n      case \"paragraph_close\":\n        if (inListItem)\n          break;\n        flushBlock();\n        break;\n      // Headings\n      case \"heading_open\": {\n        const level = Number(token?.tag?.slice(1)), headingMatcher = {\n          1: consolidatedOptions.block.h1,\n          2: consolidatedOptions.block.h2,\n          3: consolidatedOptions.block.h3,\n          4: consolidatedOptions.block.h4,\n          5: consolidatedOptions.block.h5,\n          6: consolidatedOptions.block.h6\n        }[level], style = headingMatcher?.({\n          context: { schema: consolidatedOptions.schema }\n        }) ?? consolidatedOptions.block.normal({\n          context: { schema: consolidatedOptions.schema }\n        });\n        if (!style) {\n          console.warn('No heading style found, using \"normal\"'), startBlock(\"normal\");\n          break;\n        }\n        startBlock(style);\n        break;\n      }\n      case \"heading_close\":\n        flushBlock();\n        break;\n      // Blockquote\n      case \"blockquote_open\": {\n        flushBlock(), currentBlockquoteStyle = consolidatedOptions.block.blockquote({\n          context: { schema: consolidatedOptions.schema }\n        }) ?? consolidatedOptions.block.normal({\n          context: { schema: consolidatedOptions.schema }\n        }) ?? \"normal\";\n        break;\n      }\n      case \"blockquote_close\": {\n        flushBlock(), currentBlockquoteStyle = null;\n        break;\n      }\n      // Lists\n      case \"bullet_list_open\": {\n        const listItem = consolidatedOptions.listItem.bullet({\n          context: { schema: consolidatedOptions.schema }\n        });\n        if (!listItem) {\n          currentListStack.push(null);\n          break;\n        }\n        currentListStack.push(listItem);\n        break;\n      }\n      case \"ordered_list_open\": {\n        const listItem = consolidatedOptions.listItem.number({\n          context: { schema: consolidatedOptions.schema }\n        });\n        if (!listItem) {\n          currentListStack.push(null);\n          break;\n        }\n        currentListStack.push(listItem);\n        break;\n      }\n      case \"bullet_list_close\":\n      case \"ordered_list_close\":\n        currentListStack.pop();\n        break;\n      case \"list_item_open\": {\n        const listType = currentListStack.at(-1);\n        if (listType === void 0)\n          throw new Error(\"Expected an open list\");\n        if (currentBlock && flushBlock(), listType === null) {\n          const style = currentBlockquoteStyle ?? consolidatedOptions.block.normal({\n            context: { schema: consolidatedOptions.schema }\n          });\n          style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\")), inListItem = !0;\n          break;\n        }\n        ensureListBlock(listType), inListItem = !0;\n        break;\n      }\n      case \"list_item_close\":\n        inListItem = !1, flushBlock();\n        break;\n      // Code fences / blocks\n      case \"fence\": {\n        flushBlock();\n        const language = token.info.trim() || void 0, code = token.content.replace(/\\n$/, \"\"), codeObject = consolidatedOptions.types.code({\n          context: {\n            schema: consolidatedOptions.schema,\n            keyGenerator: consolidatedOptions.keyGenerator\n          },\n          value: { language, code },\n          isInline: !1\n        });\n        if (!codeObject) {\n          const style = consolidatedOptions.block.normal({\n            context: { schema: consolidatedOptions.schema }\n          });\n          style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\")), addSpan(code), flushBlock();\n          break;\n        }\n        portableText.push(codeObject);\n        break;\n      }\n      // Horizontal rule\n      case \"hr\": {\n        flushBlock();\n        const hrObject = consolidatedOptions.types.horizontalRule({\n          context: {\n            schema: consolidatedOptions.schema,\n            keyGenerator: consolidatedOptions.keyGenerator\n          },\n          value: {},\n          isInline: !1\n        });\n        if (!hrObject) {\n          const style = consolidatedOptions.block.normal({\n            context: { schema: consolidatedOptions.schema }\n          });\n          style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\")), addSpan(\"---\"), flushBlock();\n          break;\n        }\n        portableText.push(hrObject);\n        break;\n      }\n      // HTML block\n      case \"html_block\": {\n        flushBlock();\n        const htmlContent = token.content.trim();\n        if (!htmlContent)\n          break;\n        const htmlObject = consolidatedOptions.types.html({\n          context: {\n            schema: consolidatedOptions.schema,\n            keyGenerator: consolidatedOptions.keyGenerator\n          },\n          value: { html: htmlContent },\n          isInline: !1\n        });\n        if (!htmlObject) {\n          const style = consolidatedOptions.block.normal({\n            context: { schema: consolidatedOptions.schema }\n          });\n          style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\")), addSpan(htmlContent), flushBlock();\n          break;\n        }\n        portableText.push(htmlObject);\n        break;\n      }\n      case \"code_block\": {\n        flushBlock();\n        const code = token.content.replace(/\\n$/, \"\"), codeObject = consolidatedOptions.types.code({\n          context: {\n            schema: consolidatedOptions.schema,\n            keyGenerator: consolidatedOptions.keyGenerator\n          },\n          value: { language: void 0, code },\n          isInline: !1\n        });\n        if (codeObject)\n          portableText.push(codeObject);\n        else {\n          const style = consolidatedOptions.block.normal({\n            context: { schema: consolidatedOptions.schema }\n          });\n          style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\")), addSpan(code), flushBlock();\n        }\n        break;\n      }\n      // Tables\n      case \"table_open\":\n        flushBlock(), currentTable = { rows: [], headerRows: 0 };\n        break;\n      case \"table_close\": {\n        if (!currentTable)\n          break;\n        if (consolidatedOptions.types.table) {\n          const tableObject = consolidatedOptions.types.table({\n            context: {\n              schema: consolidatedOptions.schema,\n              keyGenerator: consolidatedOptions.keyGenerator\n            },\n            value: {\n              rows: currentTable.rows,\n              headerRows: currentTable.headerRows > 0 ? currentTable.headerRows : void 0\n            },\n            isInline: !1\n          });\n          tableObject ? portableText.push(tableObject) : flattenTable(currentTable, portableText);\n        } else\n          flattenTable(currentTable, portableText);\n        currentTable = null;\n        break;\n      }\n      case \"thead_open\":\n        inTableHead = !0;\n        break;\n      case \"thead_close\":\n        inTableHead = !1;\n        break;\n      case \"tbody_open\":\n      case \"tbody_close\":\n        break;\n      case \"tr_open\":\n        currentTableRow = [];\n        break;\n      case \"tr_close\":\n        currentTable && currentTableRow && (currentTable.rows.push({\n          _key: consolidatedOptions.keyGenerator(),\n          _type: \"row\",\n          cells: currentTableRow\n        }), inTableHead && currentTable.headerRows++), currentTableRow = null;\n        break;\n      case \"th_open\":\n      case \"td_open\": {\n        const style = consolidatedOptions.block.normal({\n          context: { schema: consolidatedOptions.schema }\n        });\n        style ? startBlock(style) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\"));\n        break;\n      }\n      case \"th_close\":\n      case \"td_close\": {\n        flushBlock();\n        const cellBlocks = [];\n        if (portableText.length > 0) {\n          const lastBlock = portableText.at(-1);\n          lastBlock && lastBlock._type === \"block\" && cellBlocks.push(portableText.pop());\n        }\n        cellBlocks.length === 0 && cellBlocks.push({\n          _type: \"block\",\n          style: consolidatedOptions.block.normal({\n            context: { schema: consolidatedOptions.schema }\n          }) || \"normal\",\n          children: [\n            {\n              _type: consolidatedOptions.schema.span.name,\n              _key: consolidatedOptions.keyGenerator(),\n              text: \"\",\n              marks: []\n            }\n          ],\n          _key: consolidatedOptions.keyGenerator(),\n          markDefs: []\n        });\n        const firstBlock = cellBlocks[0];\n        if (cellBlocks.length === 1 && firstBlock && firstBlock._type === \"block\" && \"children\" in firstBlock && Array.isArray(firstBlock.children) && firstBlock.children.length === 1) {\n          const onlyChild = firstBlock.children[0];\n          typeof onlyChild == \"object\" && onlyChild !== null && \"_type\" in onlyChild && onlyChild._type !== consolidatedOptions.schema.span.name && onlyChild._type === \"image\" && (cellBlocks[0] = onlyChild);\n        }\n        currentTableRow !== null && currentTableRow.push({\n          _type: \"cell\",\n          _key: consolidatedOptions.keyGenerator(),\n          value: cellBlocks\n        });\n        break;\n      }\n      // Inline container\n      case \"inline\": {\n        const inTableCell = currentTableRow !== null;\n        if (token.children?.length === 1 && token.children[0]?.type === \"image\") {\n          const imageToken = token.children[0];\n          if (!imageToken)\n            break;\n          const src = imageToken.attrs?.find(([name]) => name === \"src\")?.at(1) || \"\", alt = unescapeImageAndLinkText(imageToken.content || \"\"), title = imageToken.attrs?.find(([name]) => name === \"title\")?.at(1) || void 0, blockImageObject = consolidatedOptions.types.image({\n            context: {\n              schema: consolidatedOptions.schema,\n              keyGenerator: consolidatedOptions.keyGenerator\n            },\n            value: { src, alt, title },\n            isInline: !1\n          });\n          if (blockImageObject) {\n            inTableCell ? currentBlock && \"children\" in currentBlock && currentBlock.children.push(\n              blockImageObject\n            ) : (currentBlock && \"children\" in currentBlock && currentBlock.children.length > 0 ? flushBlock() : (currentBlock = null, currentMarkDefs = []), portableText.push(blockImageObject));\n            break;\n          }\n          const inlineImageObject = consolidatedOptions.types.image({\n            context: {\n              schema: consolidatedOptions.schema,\n              keyGenerator: consolidatedOptions.keyGenerator\n            },\n            value: { src, alt, title },\n            isInline: !0\n          });\n          if (inlineImageObject) {\n            if (!currentBlock)\n              if (inListItem) {\n                const listType = currentListStack.at(-1);\n                listType && ensureListBlock(listType);\n              } else {\n                const style = consolidatedOptions.block.normal({\n                  context: { schema: consolidatedOptions.schema }\n                });\n                style && startBlock(style);\n              }\n            currentBlock && \"children\" in currentBlock && currentBlock.children.push(\n              inlineImageObject\n            );\n            break;\n          }\n          addSpan(`![${alt}](${src})`);\n          break;\n        }\n        for (const childToken of token.children ?? [])\n          switch (childToken.type) {\n            case \"text\":\n              addSpan(childToken.content);\n              break;\n            case \"softbreak\":\n            case \"hardbreak\":\n              addSpan(`\n`);\n              break;\n            case \"code_inline\": {\n              const decorator = consolidatedOptions.marks.code({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator) {\n                addSpan(childToken.content);\n                break;\n              }\n              markDefRefs.push(decorator), addSpan(childToken.content);\n              const index = markDefRefs.lastIndexOf(decorator);\n              index !== -1 && markDefRefs.splice(index, 1);\n              break;\n            }\n            case \"strong_open\": {\n              const decorator = consolidatedOptions.marks.strong({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator)\n                break;\n              markDefRefs.push(decorator);\n              break;\n            }\n            case \"strong_close\": {\n              const decorator = consolidatedOptions.marks.strong({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator)\n                break;\n              const index = markDefRefs.lastIndexOf(decorator);\n              index !== -1 && markDefRefs.splice(index, 1);\n              break;\n            }\n            case \"em_open\": {\n              const decorator = consolidatedOptions.marks.em({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator)\n                break;\n              markDefRefs.push(decorator);\n              break;\n            }\n            case \"em_close\": {\n              const decorator = consolidatedOptions.marks.em({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator)\n                break;\n              const index = markDefRefs.lastIndexOf(decorator);\n              index !== -1 && markDefRefs.splice(index, 1);\n              break;\n            }\n            case \"s_open\": {\n              const decorator = consolidatedOptions.marks.strikeThrough({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator)\n                break;\n              markDefRefs.push(decorator);\n              break;\n            }\n            case \"s_close\": {\n              const decorator = consolidatedOptions.marks.strikeThrough({\n                context: { schema: consolidatedOptions.schema }\n              });\n              if (!decorator)\n                break;\n              const index = markDefRefs.lastIndexOf(decorator);\n              index !== -1 && markDefRefs.splice(index, 1);\n              break;\n            }\n            case \"link_open\": {\n              const href = childToken.attrs?.find(([name]) => name === \"href\")?.at(1);\n              if (!href)\n                break;\n              const title = childToken.attrs?.find(([name]) => name === \"title\")?.at(1), linkObject = consolidatedOptions.marks.link({\n                context: {\n                  schema: consolidatedOptions.schema,\n                  keyGenerator: consolidatedOptions.keyGenerator\n                },\n                value: { href, title }\n              });\n              if (!linkObject)\n                break;\n              currentMarkDefs.push(linkObject), markDefRefs.push(linkObject._key);\n              break;\n            }\n            case \"link_close\": {\n              const markDefKeys = new Set(currentMarkDefs.map((d) => d._key));\n              let lastLinkIndex;\n              for (const markDefRef of markDefRefs.reverse())\n                if (markDefKeys.has(markDefRef)) {\n                  lastLinkIndex = markDefRefs.indexOf(markDefRef);\n                  break;\n                }\n              if (lastLinkIndex !== void 0) {\n                const realIndex = markDefRefs.length - 1 - lastLinkIndex;\n                markDefRefs.splice(realIndex, 1);\n              }\n              break;\n            }\n            case \"image\": {\n              const src = childToken.attrs?.find(([name]) => name === \"src\")?.at(1) || \"\", alt = unescapeImageAndLinkText(childToken.content || \"\"), inlineImageObject = consolidatedOptions.types.image({\n                context: {\n                  schema: consolidatedOptions.schema,\n                  keyGenerator: consolidatedOptions.keyGenerator\n                },\n                value: { src, alt, title: void 0 },\n                isInline: !0\n              });\n              if (inlineImageObject) {\n                if (!currentBlock) {\n                  const style2 = consolidatedOptions.block.normal({\n                    context: { schema: consolidatedOptions.schema }\n                  });\n                  style2 ? startBlock(style2) : (console.warn('No default style found, using \"normal\"'), startBlock(\"normal\"));\n                }\n                if (!currentBlock)\n                  throw new Error(\"Expected current block after startBlock\");\n                currentBlock.children.push(\n                  inlineImageObject\n                );\n                break;\n              }\n              const blockImageObject = consolidatedOptions.types.image({\n                context: {\n                  schema: consolidatedOptions.schema,\n                  keyGenerator: consolidatedOptions.keyGenerator\n                },\n                value: { src, alt, title: void 0 },\n                isInline: !1\n              });\n              if (!blockImageObject) {\n                addSpan(`![${alt}](${src})`);\n                break;\n              }\n              if (inTableCell) {\n                currentBlock && \"children\" in currentBlock && currentBlock.children.push(\n                  blockImageObject\n                );\n                break;\n              }\n              flushBlock(), portableText.push(blockImageObject);\n              const style = consolidatedOptions.block.normal({\n                context: { schema: consolidatedOptions.schema }\n              });\n              style && startBlock(style);\n              break;\n            }\n            case \"html_inline\": {\n              consolidatedOptions.html.inline === \"text\" && addSpan(childToken.content);\n              break;\n            }\n          }\n        break;\n      }\n    }\n  return flushBlock(), portableText;\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9tYXJrZG93bi9kaXN0L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3RjtBQUM0RjtBQUMvSTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsbUVBQWEsQ0FBQyxrRUFBWSxHQUFHO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw0QkFBNEI7QUFDdkQ7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELGlFQUFXLEdBQUcsUUFBUTtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0JBQXdCO0FBQ3BDLFdBQVcsa0ZBQTJCLHVDQUF1QyxnRkFBeUIsNEJBQTRCLDBFQUFtQiw4Q0FBOEMsb0ZBQTZCO0FBQ2hPO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixxRUFBYyxzQ0FBc0MscUNBQXFDO0FBQzVHO0FBQ0EsY0FBYyxvQ0FBb0M7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWSw2QkFBNkI7QUFDekMsMENBQTBDLDhDQUE4QztBQUN4RjtBQUNBO0FB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Q3ZCLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxtQkFBbUIsZ0JBQWdCO0FBQ25DO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkIsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLG1CQUFtQjtBQUNuQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxtQkFBbUIsbUJBQW1CO0FBQ3RDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkIsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxtQkFBbUIsd0JBQXdCO0FBQzNDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFdBQVc7QUFDWDtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkIsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixxQkFBcUIsaUJBQWlCO0FBQ3RDO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLHFCQUFxQixpQkFBaUI7QUFDdEM7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBLDZCQUE2QjtBQUM3QixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsSUFBSSxJQUFJLElBQUk7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0IsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0IsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQix5QkFBeUI7QUFDekIsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQix5QkFBeUIseUJBQXlCO0FBQ2xEO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQixtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIseUJBQXlCLHlCQUF5QjtBQUNsRDtBQUNBLGVBQWU7QUFDZjtBQUNBLDZCQUE2QixJQUFJLElBQUksSUFBSTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEwQkU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NyaXNwLWNsZWFuaW5nLy4vbm9kZV9tb2R1bGVzL0Bwb3J0YWJsZXRleHQvbWFya2Rvd24vZGlzdC9pbmRleC5qcz9lYmZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbXBpbGVTY2hlbWEsIGRlZmluZVNjaGVtYSwgaXNUZXh0QmxvY2ssIGlzU3BhbiB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3NjaGVtYVwiO1xuaW1wb3J0IHsgaXNQb3J0YWJsZVRleHRMaXN0SXRlbUJsb2NrLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuLCBpc1BvcnRhYmxlVGV4dEJsb2NrLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRUZXh0Tm9kZSwgYnVpbGRNYXJrc1RyZWUsIHNwYW5Ub1BsYWluVGV4dCB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3Rvb2xraXRcIjtcbmltcG9ydCBtYXJrZG93bml0IGZyb20gXCJtYXJrZG93bi1pdFwiO1xuZnVuY3Rpb24gZGVmYXVsdEtleUdlbmVyYXRvcigpIHtcbiAgcmV0dXJuIHJhbmRvbUtleSgxMik7XG59XG5jb25zdCBnZXRCeXRlSGV4VGFibGUgPSAvKiBAX19QVVJFX18gKi8gKCgpID0+IHtcbiAgbGV0IHRhYmxlO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGlmICh0YWJsZSlcbiAgICAgIHJldHVybiB0YWJsZTtcbiAgICB0YWJsZSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpXG4gICAgICB0YWJsZVtpXSA9IChpICsgMjU2KS50b1N0cmluZygxNikuc2xpY2UoMSk7XG4gICAgcmV0dXJuIHRhYmxlO1xuICB9O1xufSkoKTtcbmZ1bmN0aW9uIHdoYXR3Z1JORyhsZW5ndGggPSAxNikge1xuICBjb25zdCBybmRzOCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7XG4gIHJldHVybiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHJuZHM4KSwgcm5kczg7XG59XG5mdW5jdGlvbiByYW5kb21LZXkobGVuZ3RoKSB7XG4gIGNvbnN0IHRhYmxlID0gZ2V0Qnl0ZUhleFRhYmxlKCk7XG4gIHJldHVybiB3aGF0d2dSTkcobGVuZ3RoKS5yZWR1Y2UoKHN0ciwgbikgPT4gc3RyICsgdGFibGVbbl0sIFwiXCIpLnNsaWNlKDAsIGxlbmd0aCk7XG59XG5jb25zdCBzY2hlbWEgPSBjb21waWxlU2NoZW1hKGRlZmluZVNjaGVtYSh7fSkpO1xuZnVuY3Rpb24gYnVpbGRMaXN0SW5kZXhNYXAoYmxvY2tzKSB7XG4gIGNvbnN0IGxldmVsSW5kZXhNYXBzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgbGlzdEluZGV4TWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgbGV0IHByZXZpb3VzTGlzdEl0ZW07XG4gIGZvciAobGV0IGJsb2NrSW5kZXggPSAwOyBibG9ja0luZGV4IDwgYmxvY2tzLmxlbmd0aDsgYmxvY2tJbmRleCsrKSB7XG4gICAgY29uc3QgYmxvY2sgPSBibG9ja3MuYXQoYmxvY2tJbmRleCk7XG4gICAgaWYgKGJsb2NrID09PSB2b2lkIDApXG4gICAgICBjb250aW51ZTtcbiAgICBpZiAoYmxvY2suX2tleSB8fCAoYmxvY2suX2tleSA9IGRlZmF1bHRLZXlHZW5lcmF0b3IoKSksICFpc1RleHRCbG9jayh7IHNjaGVtYSB9LCBibG9jaykpIHtcbiAgICAgIGxldmVsSW5kZXhNYXBzLmNsZWFyKCksIHByZXZpb3VzTGlzdEl0ZW0gPSB2b2lkIDA7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKGJsb2NrLmxpc3RJdGVtID09PSB2b2lkIDAgfHwgYmxvY2subGV2ZWwgPT09IHZvaWQgMCkge1xuICAgICAgbGV2ZWxJbmRleE1hcHMuY2xlYXIoKSwgcHJldmlvdXNMaXN0SXRlbSA9IHZvaWQgMDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoIXByZXZpb3VzTGlzdEl0ZW0pIHtcbiAgICAgIGNvbnN0IGxldmVsSW5kZXhNYXAyID0gbGV2ZWxJbmRleE1hcHMuZ2V0KGJsb2NrLmxpc3RJdGVtKSA/PyAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgbGV2ZWxJbmRleE1hcDIuc2V0KGJsb2NrLmxldmVsLCAxKSwgbGV2ZWxJbmRleE1hcHMuc2V0KGJsb2NrLmxpc3RJdGVtLCBsZXZlbEluZGV4TWFwMiksIGxpc3RJbmRleE1hcC5zZXQoYmxvY2suX2tleSwgMSksIHByZXZpb3VzTGlzdEl0ZW0gPSB7XG4gICAgICAgIGxpc3RJdGVtOiBibG9jay5saXN0SXRlbSxcbiAgICAgICAgbGV2ZWw6IGJsb2NrLmxldmVsXG4gICAgICB9O1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChwcmV2aW91c0xpc3RJdGVtLmxpc3RJdGVtID09PSBibG9jay5saXN0SXRlbSAmJiBwcmV2aW91c0xpc3RJdGVtLmxldmVsIDwgYmxvY2subGV2ZWwpIHtcbiAgICAgIGNvbnN0IGxldmVsSW5kZXhNYXAyID0gbGV2ZWxJbmRleE1hcHMuZ2V0KGJsb2NrLmxpc3RJdGVtKSA/PyAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgICAgbGV2ZWxJbmRleE1hcDIuc2V0KGJsb2NrLmxldmVsLCAxKSwgbGV2ZWxJbmRleE1hcHMuc2V0KGJsb2NrLmxpc3RJdGVtLCBsZXZlbEluZGV4TWFwMiksIGxpc3RJbmRleE1hcC5zZXQoYmxvY2suX2tleSwgMSksIHByZXZpb3VzTGlzdEl0ZW0gPSB7XG4gICAgICAgIGxpc3RJdGVtOiBibG9jay5saXN0SXRlbSxcbiAgICAgICAgbGV2ZWw6IGJsb2NrLmxldmVsXG4gICAgICB9O1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGxldmVsSW5kZXhNYXBzLmZvckVhY2goKGxldmVsSW5kZXhNYXAyLCBsaXN0SXRlbSkgPT4ge1xuICAgICAgaWYgKGxpc3RJdGVtID09PSBibG9jay5saXN0SXRlbSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY29uc3QgbGV2ZWxzVG9EZWxldGUgPSBbXTtcbiAgICAgIGxldmVsSW5kZXhNYXAyLmZvckVhY2goKF8sIGxldmVsKSA9PiB7XG4gICAgICAgIGxldmVsID49IGJsb2NrLmxldmVsICYmIGxldmVsc1RvRGVsZXRlLnB1c2gobGV2ZWwpO1xuICAgICAgfSksIGxldmVsc1RvRGVsZXRlLmZvckVhY2goKGxldmVsKSA9PiB7XG4gICAgICAgIGxldmVsSW5kZXhNYXAyLmRlbGV0ZShsZXZlbCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBjb25zdCBsZXZlbEluZGV4TWFwID0gbGV2ZWxJbmRleE1hcHMuZ2V0KGJsb2NrLmxpc3RJdGVtKSA/PyAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCBsZXZlbENvdW50ZXIgPSBsZXZlbEluZGV4TWFwLmdldChibG9jay5sZXZlbCkgPz8gMDtcbiAgICBsZXZlbEluZGV4TWFwLnNldChibG9jay5sZXZlbCwgbGV2ZWxDb3VudGVyICsgMSksIGxldmVsSW5kZXhNYXBzLnNldChibG9jay5saXN0SXRlbSwgbGV2ZWxJbmRleE1hcCksIGxpc3RJbmRleE1hcC5zZXQoYmxvY2suX2tleSwgbGV2ZWxDb3VudGVyICsgMSksIHByZXZpb3VzTGlzdEl0ZW0gPSB7XG4gICAgICBsaXN0SXRlbTogYmxvY2subGlzdEl0ZW0sXG4gICAgICBsZXZlbDogYmxvY2subGV2ZWxcbiAgICB9O1xuICB9XG4gIHJldHVybiBsaXN0SW5kZXhNYXA7XG59XG5jb25zdCBjcmVhdGVSZW5kZXJOb2RlID0gKHJlbmRlcmVycywgbGlzdEluZGV4TWFwKSA9PiB7XG4gIGZ1bmN0aW9uIHJlbmRlck5vZGUob3B0aW9ucykge1xuICAgIGNvbnN0IHsgbm9kZSwgaW5kZXgsIGlzSW5saW5lIH0gPSBvcHRpb25zO1xuICAgIHJldHVybiBpc1BvcnRhYmxlVGV4dExpc3RJdGVtQmxvY2sobm9kZSkgPyByZW5kZXJMaXN0SXRlbShub2RlLCBpbmRleCkgOiBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuKG5vZGUpID8gcmVuZGVyU3Bhbihub2RlKSA6IGlzUG9ydGFibGVUZXh0QmxvY2sobm9kZSkgPyByZW5kZXJCbG9jayhub2RlLCBpbmRleCwgaXNJbmxpbmUpIDogaXNQb3J0YWJsZVRleHRUb29sa2l0VGV4dE5vZGUobm9kZSkgPyByZW5kZXJUZXh0KG5vZGUpIDogcmVuZGVyQ3VzdG9tQmxvY2sobm9kZSwgaW5kZXgsIGlzSW5saW5lKTtcbiAgfVxuICBmdW5jdGlvbiByZW5kZXJMaXN0SXRlbShub2RlLCBpbmRleCkge1xuICAgIGNvbnN0IHJlbmRlcmVyID0gcmVuZGVyZXJzLmxpc3RJdGVtLCBpdGVtSGFuZGxlciA9ICh0eXBlb2YgcmVuZGVyZXIgPT0gXCJmdW5jdGlvblwiID8gcmVuZGVyZXIgOiByZW5kZXJlcltub2RlLmxpc3RJdGVtXSkgfHwgcmVuZGVyZXJzLnVua25vd25MaXN0SXRlbTtcbiAgICBsZXQgY2hpbGRyZW4gPSBidWlsZE1hcmtzVHJlZShub2RlKS5tYXAoKGNoaWxkLCBpKSA9PiByZW5kZXJOb2RlKHsgbm9kZTogY2hpbGQsIGlzSW5saW5lOiAhMCwgaW5kZXg6IGkgfSkpLmpvaW4oXCJcIik7XG4gICAgaWYgKG5vZGUuc3R5bGUgJiYgbm9kZS5zdHlsZSAhPT0gXCJub3JtYWxcIikge1xuICAgICAgY29uc3QgeyBsaXN0SXRlbTogX2xpc3RJdGVtLCAuLi5ibG9ja05vZGUgfSA9IG5vZGU7XG4gICAgICBjaGlsZHJlbiA9IHJlbmRlck5vZGUoe1xuICAgICAgICBub2RlOiBibG9ja05vZGUsXG4gICAgICAgIGluZGV4LFxuICAgICAgICBpc0lubGluZTogITFcbiAgICAgIH0pLCBjaGlsZHJlbiA9IGNoaWxkcmVuLnJlcGxhY2UoL1xcbiskLywgXCJcIik7XG4gICAgfVxuICAgIHJldHVybiBpdGVtSGFuZGxlcih7XG4gICAgICB2YWx1ZTogbm9kZSxcbiAgICAgIGluZGV4LFxuICAgICAgbGlzdEluZGV4OiBub2RlLl9rZXkgPyBsaXN0SW5kZXhNYXAuZ2V0KG5vZGUuX2tleSkgOiB2b2lkIDAsXG4gICAgICBpc0lubGluZTogITEsXG4gICAgICByZW5kZXJOb2RlLFxuICAgICAgY2hpbGRyZW5cbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiByZW5kZXJTcGFuKG5vZGUpIHtcbiAgICBjb25zdCB7IG1hcmtEZWYsIG1hcmtUeXBlLCBtYXJrS2V5IH0gPSBub2RlLCBzcGFuID0gcmVuZGVyZXJzLm1hcmtzW21hcmtUeXBlXSB8fCByZW5kZXJlcnMudW5rbm93bk1hcmssIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbi5tYXAoXG4gICAgICAoY2hpbGQsIGNoaWxkSW5kZXgpID0+IHJlbmRlck5vZGUoeyBub2RlOiBjaGlsZCwgaW5kZXg6IGNoaWxkSW5kZXgsIGlzSW5saW5lOiAhMCB9KVxuICAgICk7XG4gICAgcmV0dXJuIHNwYW4oe1xuICAgICAgdGV4dDogc3BhblRvUGxhaW5UZXh0KG5vZGUpLFxuICAgICAgdmFsdWU6IG1hcmtEZWYsXG4gICAgICBtYXJrVHlwZSxcbiAgICAgIG1hcmtLZXksXG4gICAgICByZW5kZXJOb2RlLFxuICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLmpvaW4oXCJcIilcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiByZW5kZXJCbG9jayhub2RlLCBpbmRleCwgaXNJbmxpbmUpIHtcbiAgICBjb25zdCB7IF9rZXksIC4uLnByb3BzIH0gPSBzZXJpYWxpemVCbG9jayh7IG5vZGUsIGluZGV4LCBpc0lubGluZSwgcmVuZGVyTm9kZSB9KSwgc3R5bGUgPSBwcm9wcy5ub2RlLnN0eWxlIHx8IFwibm9ybWFsXCI7XG4gICAgcmV0dXJuICgodHlwZW9mIHJlbmRlcmVycy5ibG9jayA9PSBcImZ1bmN0aW9uXCIgPyByZW5kZXJlcnMuYmxvY2sgOiByZW5kZXJlcnMuYmxvY2tbc3R5bGVdKSB8fCByZW5kZXJlcnMudW5rbm93bkJsb2NrU3R5bGUpKHsgLi4ucHJvcHMsIHZhbHVlOiBwcm9wcy5ub2RlLCByZW5kZXJOb2RlIH0pO1xuICB9XG4gIGZ1bmN0aW9uIHJlbmRlclRleHQobm9kZSkge1xuICAgIHJldHVybiBub2RlLnRleHQgPT09IGBcbmAgPyByZW5kZXJlcnMuaGFyZEJyZWFrKCkgOiBub2RlLnRleHQ7XG4gIH1cbiAgZnVuY3Rpb24gcmVuZGVyQ3VzdG9tQmxvY2sodmFsdWUsIGluZGV4LCBpc0lubGluZSkge1xuICAgIHJldHVybiAocmVuZGVyZXJzLnR5cGVzW3ZhbHVlLl90eXBlXSA/PyByZW5kZXJlcnMudW5rbm93blR5cGUpKHtcbiAgICAgIHZhbHVlLFxuICAgICAgaXNJbmxpbmUsXG4gICAgICBpbmRleCxcbiAgICAgIHJlbmRlck5vZGVcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmVuZGVyTm9kZTtcbn07XG5mdW5jdGlvbiBzZXJpYWxpemVCbG9jayhvcHRpb25zKSB7XG4gIGNvbnN0IHsgbm9kZSwgaW5kZXgsIGlzSW5saW5lLCByZW5kZXJOb2RlIH0gPSBvcHRpb25zLCByZW5kZXJlZENoaWxkcmVuID0gYnVpbGRNYXJrc1RyZWUobm9kZSkubWFwKFxuICAgIChjaGlsZCwgaSkgPT4gcmVuZGVyTm9kZSh7IG5vZGU6IGNoaWxkLCBpc0lubGluZTogITAsIGluZGV4OiBpLCByZW5kZXJOb2RlIH0pXG4gICk7XG4gIHJldHVybiB7XG4gICAgX2tleTogbm9kZS5fa2V5IHx8IGRlZmF1bHRLZXlHZW5lcmF0b3IoKSxcbiAgICBjaGlsZHJlbjogcmVuZGVyZWRDaGlsZHJlbi5qb2luKFwiXCIpLFxuICAgIGluZGV4LFxuICAgIGlzSW5saW5lLFxuICAgIG5vZGVcbiAgfTtcbn1cbmNvbnN0IERlZmF1bHRCbG9ja1NwYWNpbmdSZW5kZXJlciA9ICh7XG4gIGN1cnJlbnQsXG4gIG5leHRcbn0pID0+IGlzUG9ydGFibGVUZXh0TGlzdEl0ZW1CbG9jayhjdXJyZW50KSAmJiBpc1BvcnRhYmxlVGV4dExpc3RJdGVtQmxvY2sobmV4dCkgPyBgXG5gIDogaXNQb3J0YWJsZVRleHRCbG9jayhjdXJyZW50KSAmJiBpc1BvcnRhYmxlVGV4dEJsb2NrKG5leHQpICYmIGN1cnJlbnQuc3R5bGUgPT09IFwiYmxvY2txdW90ZVwiICYmIG5leHQuc3R5bGUgPT09IFwiYmxvY2txdW90ZVwiID8gYFxuPlxuYCA6IGBcblxuYCwgRGVmYXVsdEhhcmRCcmVha1JlbmRlcmVyID0gKCkgPT4gYCAgXG5gLCBEZWZhdWx0TGlzdEl0ZW1SZW5kZXJlciA9ICh7XG4gIGNoaWxkcmVuLFxuICB2YWx1ZSxcbiAgbGlzdEluZGV4XG59KSA9PiB7XG4gIGNvbnN0IGxpc3RTdHlsZSA9IHZhbHVlLmxpc3RJdGVtIHx8IFwiYnVsbGV0XCIsIGxldmVsID0gdmFsdWUubGV2ZWwgfHwgMTtcbiAgcmV0dXJuIGxpc3RTdHlsZSA9PT0gXCJudW1iZXJcIiA/IGAke1wiICAgXCIucmVwZWF0KGxldmVsIC0gMSl9JHtsaXN0SW5kZXggPz8gMX0uICR7Y2hpbGRyZW59YCA6IGAke1wiICAgXCIucmVwZWF0KGxldmVsIC0gMSl9LSAke2NoaWxkcmVufWA7XG59LCBEZWZhdWx0VW5rbm93bkxpc3RJdGVtUmVuZGVyZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4gYC0gJHtjaGlsZHJlbn1cbmA7XG5mdW5jdGlvbiBlc2NhcGVJbWFnZUFuZExpbmtUZXh0KHRleHQpIHtcbiAgcmV0dXJuIHRleHQucmVwbGFjZSgvKFtbXFxdXFxcXF0pL2csIFwiXFxcXCQxXCIpO1xufVxuZnVuY3Rpb24gdW5lc2NhcGVJbWFnZUFuZExpbmtUZXh0KHRleHQpIHtcbiAgcmV0dXJuIHRleHQucmVwbGFjZSgvXFxcXChbIVwiIyQlJicoKSorLFxcLS4vOjs8PT4/QFtcXFxcXFxdXl9ge3x9fl0pL2csIFwiJDFcIik7XG59XG5mdW5jdGlvbiBlc2NhcGVJbWFnZUFuZExpbmtUaXRsZSh0ZXh0KSB7XG4gIHJldHVybiB0ZXh0LnJlcGxhY2UoLyhbXFxcXFwiXSkvZywgXCJcXFxcJDFcIik7XG59XG5jb25zdCBEZWZhdWx0RW1SZW5kZXJlciA9ICh7IGNoaWxkcmVuIH0pID0+IGBfJHtjaGlsZHJlbn1fYCwgRGVmYXVsdFN0cm9uZ1JlbmRlcmVyID0gKHsgY2hpbGRyZW4gfSkgPT4gYCoqJHtjaGlsZHJlbn0qKmAsIERlZmF1bHRDb2RlUmVuZGVyZXIgPSAoeyBjaGlsZHJlbiB9KSA9PiBgXFxgJHtjaGlsZHJlbn1cXGBgLCBEZWZhdWx0VW5kZXJsaW5lUmVuZGVyZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4gYDx1PiR7Y2hpbGRyZW59PC91PmAsIERlZmF1bHRTdHJpa2VUaHJvdWdoUmVuZGVyZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4gYH5+JHtjaGlsZHJlbn1+fmAsIERlZmF1bHRMaW5rUmVuZGVyZXIgPSAoe1xuICBjaGlsZHJlbixcbiAgdmFsdWVcbn0pID0+IHtcbiAgY29uc3QgaHJlZiA9IHZhbHVlPy5ocmVmIHx8IFwiXCIsIHRpdGxlID0gdmFsdWU/LnRpdGxlIHx8IFwiXCI7XG4gIGlmICh1cmlMb29rc1NhZmUoaHJlZikpIHtcbiAgICBpZiAoL1tcIiddW15cIiddKls8Pl18Wzw+XVtePD5dKltcIiddLy50ZXN0KGhyZWYpKSB7XG4gICAgICBjb25zdCBlbmNvZGVkSHJlZiA9IGhyZWYucmVwbGFjZSgvW1wiPD4oKSBdL2csIChjaGFyKSA9PiBgJSR7Y2hhci5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpfWApO1xuICAgICAgcmV0dXJuIGBbJHtlc2NhcGVJbWFnZUFuZExpbmtUZXh0KGNoaWxkcmVuKX1dKCR7ZW5jb2RlZEhyZWZ9KWA7XG4gICAgfVxuICAgIHJldHVybiBgWyR7ZXNjYXBlSW1hZ2VBbmRMaW5rVGV4dChjaGlsZHJlbil9XSgke2hyZWZ9JHt0aXRsZSA/IGAgXCIke2VzY2FwZUltYWdlQW5kTGlua1RpdGxlKHRpdGxlKX1cImAgOiBcIlwifSlgO1xuICB9XG4gIHJldHVybiBjaGlsZHJlbjtcbn07XG5mdW5jdGlvbiB1cmlMb29rc1NhZmUodXJpKSB7XG4gIGNvbnN0IHVybCA9ICh1cmkgfHwgXCJcIikudHJpbSgpLCBmaXJzdCA9IHVybC5jaGFyQXQoMCk7XG4gIGlmIChmaXJzdCA9PT0gXCIjXCIgfHwgZmlyc3QgPT09IFwiL1wiKVxuICAgIHJldHVybiAhMDtcbiAgY29uc3QgY29sb25JbmRleCA9IHVybC5pbmRleE9mKFwiOlwiKTtcbiAgaWYgKGNvbG9uSW5kZXggPT09IC0xKVxuICAgIHJldHVybiAhMDtcbiAgY29uc3QgYWxsb3dlZFByb3RvY29scyA9IFtcImh0dHBcIiwgXCJodHRwc1wiLCBcIm1haWx0b1wiLCBcInRlbFwiXSwgcHJvdG8gPSB1cmwuc2xpY2UoMCwgY29sb25JbmRleCkudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGFsbG93ZWRQcm90b2NvbHMuaW5kZXhPZihwcm90bykgIT09IC0xKVxuICAgIHJldHVybiAhMDtcbiAgY29uc3QgcXVlcnlJbmRleCA9IHVybC5pbmRleE9mKFwiP1wiKTtcbiAgaWYgKHF1ZXJ5SW5kZXggIT09IC0xICYmIGNvbG9uSW5kZXggPiBxdWVyeUluZGV4KVxuICAgIHJldHVybiAhMDtcbiAgY29uc3QgaGFzaEluZGV4ID0gdXJsLmluZGV4T2YoXCIjXCIpO1xuICByZXR1cm4gaGFzaEluZGV4ICE9PSAtMSAmJiBjb2xvbkluZGV4ID4gaGFzaEluZGV4O1xufVxuY29uc3QgRGVmYXVsdFVua25vd25NYXJrUmVuZGVyZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4gY2hpbGRyZW4sIERlZmF1bHROb3JtYWxSZW5kZXJlciA9ICh7XG4gIGNoaWxkcmVuXG59KSA9PiAhY2hpbGRyZW4gfHwgY2hpbGRyZW4udHJpbSgpID09PSBcIlwiID8gXCJcIiA6IGNoaWxkcmVuLCBEZWZhdWx0QmxvY2txdW90ZVJlbmRlcmVyID0gKHtcbiAgY2hpbGRyZW5cbn0pID0+IGNoaWxkcmVuID8gY2hpbGRyZW4uc3BsaXQoYFxuYCkubWFwKChsaW5lKSA9PiBgPiAke2xpbmV9YCkuam9pbihgXG5gKSA6IFwiPlwiLCBEZWZhdWx0SDFSZW5kZXJlciA9ICh7IGNoaWxkcmVuIH0pID0+IGAjICR7Y2hpbGRyZW59YCwgRGVmYXVsdEgyUmVuZGVyZXIgPSAoeyBjaGlsZHJlbiB9KSA9PiBgIyMgJHtjaGlsZHJlbn1gLCBEZWZhdWx0SDNSZW5kZXJlciA9ICh7IGNoaWxkcmVuIH0pID0+IGAjIyMgJHtjaGlsZHJlbn1gLCBEZWZhdWx0SDRSZW5kZXJlciA9ICh7IGNoaWxkcmVuIH0pID0+IGAjIyMjICR7Y2hpbGRyZW59YCwgRGVmYXVsdEg1UmVuZGVyZXIgPSAoeyBjaGlsZHJlbiB9KSA9PiBgIyMjIyMgJHtjaGlsZHJlbn1gLCBEZWZhdWx0SDZSZW5kZXJlciA9ICh7IGNoaWxkcmVuIH0pID0+IGAjIyMjIyMgJHtjaGlsZHJlbn1gLCBEZWZhdWx0VW5rbm93blN0eWxlUmVuZGVyZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4gY2hpbGRyZW4gPz8gXCJcIiwgRGVmYXVsdENvZGVCbG9ja1JlbmRlcmVyID0gKHsgdmFsdWUgfSkgPT4gYFxcYFxcYFxcYCR7dmFsdWUubGFuZ3VhZ2UgPz8gXCJcIn1cbiR7dmFsdWUuY29kZX1cblxcYFxcYFxcYGAsIERlZmF1bHRIb3Jpem9udGFsUnVsZVJlbmRlcmVyID0gKCkgPT4gXCItLS1cIiwgRGVmYXVsdEh0bWxSZW5kZXJlciA9ICh7IHZhbHVlIH0pID0+IHZhbHVlLmh0bWwsIERlZmF1bHRJbWFnZVJlbmRlcmVyID0gKHsgdmFsdWUgfSkgPT4ge1xuICBjb25zdCBhbHQgPSBlc2NhcGVJbWFnZUFuZExpbmtUZXh0KHZhbHVlLmFsdCA/PyBcIlwiKSwgdGl0bGUgPSB2YWx1ZS50aXRsZSA/IGAgXCIke2VzY2FwZUltYWdlQW5kTGlua1RpdGxlKHZhbHVlLnRpdGxlKX1cImAgOiBcIlwiO1xuICByZXR1cm4gYCFbJHthbHR9XSgke3ZhbHVlLnNyY30ke3RpdGxlfSlgO1xufSwgRGVmYXVsdFRhYmxlUmVuZGVyZXIgPSAoeyB2YWx1ZSwgcmVuZGVyTm9kZSB9KSA9PiB7XG4gIGNvbnN0IGhlYWRlclJvd3MgPSB2YWx1ZS5oZWFkZXJSb3dzIHx8IDAsIHJvd3MgPSB2YWx1ZS5yb3dzLCBsaW5lcyA9IFtdLCBnZXRDZWxsVGV4dCA9IChjZWxsQmxvY2tzKSA9PiBjZWxsQmxvY2tzLm1hcChcbiAgICAoYmxvY2ssIGluZGV4KSA9PiByZW5kZXJOb2RlKHtcbiAgICAgIG5vZGU6IGJsb2NrLFxuICAgICAgaW5kZXgsXG4gICAgICBpc0lubGluZTogITEsXG4gICAgICByZW5kZXJOb2RlXG4gICAgfSlcbiAgKS5qb2luKFwiIFwiKS50cmltKCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgaGVhZGVyUm93czsgaSsrKSB7XG4gICAgY29uc3Qgcm93ID0gcm93c1tpXTtcbiAgICBpZiAocm93KSB7XG4gICAgICBjb25zdCBjZWxsVGV4dHMgPSByb3cuY2VsbHMubWFwKChjZWxsKSA9PiBnZXRDZWxsVGV4dChjZWxsLnZhbHVlKSk7XG4gICAgICBsaW5lcy5wdXNoKGB8ICR7Y2VsbFRleHRzLmpvaW4oXCIgfCBcIil9IHxgKTtcbiAgICB9XG4gIH1cbiAgaWYgKGhlYWRlclJvd3MgPiAwICYmIHJvd3NbMF0pIHtcbiAgICBjb25zdCBzZXBhcmF0b3JzID0gcm93c1swXS5jZWxscy5tYXAoKCkgPT4gXCIgLS0tIFwiKTtcbiAgICBsaW5lcy5wdXNoKGB8JHtzZXBhcmF0b3JzLmpvaW4oXCJ8XCIpfXxgKTtcbiAgfVxuICBmb3IgKGxldCBpID0gaGVhZGVyUm93czsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCByb3cgPSByb3dzW2ldO1xuICAgIGlmIChyb3cpIHtcbiAgICAgIGNvbnN0IGNlbGxUZXh0cyA9IHJvdy5jZWxscy5tYXAoKGNlbGwpID0+IGdldENlbGxUZXh0KGNlbGwudmFsdWUpKTtcbiAgICAgIGxpbmVzLnB1c2goYHwgJHtjZWxsVGV4dHMuam9pbihcIiB8IFwiKX0gfGApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGluZXMuam9pbihgXG5gKTtcbn0sIERlZmF1bHRVbmtub3duVHlwZVJlbmRlcmVyID0gKHtcbiAgdmFsdWUsXG4gIGlzSW5saW5lXG59KSA9PiB7XG4gIGNvbnN0IGpzb24gPSBgXFxgXFxgXFxganNvblxuJHtKU09OLnN0cmluZ2lmeSh2YWx1ZSwgbnVsbCwgMil9XG5cXGBcXGBcXGBgO1xuICByZXR1cm4gaXNJbmxpbmUgPyBgXG4ke2pzb259XG5gIDoganNvbjtcbn0sIGRlZmF1bHRSZW5kZXJlcnMgPSB7XG4gIHR5cGVzOiB7fSxcbiAgYmxvY2s6IHtcbiAgICBub3JtYWw6IERlZmF1bHROb3JtYWxSZW5kZXJlcixcbiAgICBibG9ja3F1b3RlOiBEZWZhdWx0QmxvY2txdW90ZVJlbmRlcmVyLFxuICAgIGgxOiBEZWZhdWx0SDFSZW5kZXJlcixcbiAgICBoMjogRGVmYXVsdEgyUmVuZGVyZXIsXG4gICAgaDM6IERlZmF1bHRIM1JlbmRlcmVyLFxuICAgIGg0OiBEZWZhdWx0SDRSZW5kZXJlcixcbiAgICBoNTogRGVmYXVsdEg1UmVuZGVyZXIsXG4gICAgaDY6IERlZmF1bHRINlJlbmRlcmVyXG4gIH0sXG4gIG1hcmtzOiB7XG4gICAgZW06IERlZmF1bHRFbVJlbmRlcmVyLFxuICAgIHN0cm9uZzogRGVmYXVsdFN0cm9uZ1JlbmRlcmVyLFxuICAgIGNvZGU6IERlZmF1bHRDb2RlUmVuZGVyZXIsXG4gICAgdW5kZXJsaW5lOiBEZWZhdWx0VW5kZXJsaW5lUmVuZGVyZXIsXG4gICAgXCJzdHJpa2UtdGhyb3VnaFwiOiBEZWZhdWx0U3RyaWtlVGhyb3VnaFJlbmRlcmVyLFxuICAgIGxpbms6IERlZmF1bHRMaW5rUmVuZGVyZXJcbiAgfSxcbiAgbGlzdEl0ZW06IERlZmF1bHRMaXN0SXRlbVJlbmRlcmVyLFxuICBoYXJkQnJlYWs6IERlZmF1bHRIYXJkQnJlYWtSZW5kZXJlcixcbiAgdW5rbm93blR5cGU6IERlZmF1bHRVbmtub3duVHlwZVJlbmRlcmVyLFxuICB1bmtub3duTWFyazogRGVmYXVsdFVua25vd25NYXJrUmVuZGVyZXIsXG4gIHVua25vd25MaXN0SXRlbTogRGVmYXVsdFVua25vd25MaXN0SXRlbVJlbmRlcmVyLFxuICB1bmtub3duQmxvY2tTdHlsZTogRGVmYXVsdFVua25vd25TdHlsZVJlbmRlcmVyXG59O1xuZnVuY3Rpb24gcG9ydGFibGVUZXh0VG9NYXJrZG93bihibG9ja3MsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCByZW5kZXJlcnMgPSB7XG4gICAgYmxvY2s6IHtcbiAgICAgIC4uLmRlZmF1bHRSZW5kZXJlcnMuYmxvY2ssXG4gICAgICAuLi5vcHRpb25zLmJsb2NrXG4gICAgfSxcbiAgICBsaXN0SXRlbTogb3B0aW9ucy5saXN0SXRlbSA/PyBkZWZhdWx0UmVuZGVyZXJzLmxpc3RJdGVtLFxuICAgIG1hcmtzOiB7XG4gICAgICAuLi5kZWZhdWx0UmVuZGVyZXJzLm1hcmtzLFxuICAgICAgLi4ub3B0aW9ucy5tYXJrc1xuICAgIH0sXG4gICAgdHlwZXM6IHtcbiAgICAgIC4uLmRlZmF1bHRSZW5kZXJlcnMudHlwZXMsXG4gICAgICAuLi5vcHRpb25zLnR5cGVzXG4gICAgfSxcbiAgICBoYXJkQnJlYWs6IG9wdGlvbnMuaGFyZEJyZWFrID8/IGRlZmF1bHRSZW5kZXJlcnMuaGFyZEJyZWFrLFxuICAgIHVua25vd25UeXBlOiBvcHRpb25zLnVua25vd25UeXBlID8/IGRlZmF1bHRSZW5kZXJlcnMudW5rbm93blR5cGUsXG4gICAgdW5rbm93bkJsb2NrU3R5bGU6IG9wdGlvbnMudW5rbm93bkJsb2NrU3R5bGUgPz8gZGVmYXVsdFJlbmRlcmVycy51bmtub3duQmxvY2tTdHlsZSxcbiAgICB1bmtub3duTGlzdEl0ZW06IG9wdGlvbnMudW5rbm93bkxpc3RJdGVtID8/IGRlZmF1bHRSZW5kZXJlcnMudW5rbm93bkxpc3RJdGVtLFxuICAgIHVua25vd25NYXJrOiBvcHRpb25zLnVua25vd25NYXJrID8/IGRlZmF1bHRSZW5kZXJlcnMudW5rbm93bk1hcmtcbiAgfSwgcmVuZGVyQmxvY2tTcGFjaW5nID0gb3B0aW9ucy5ibG9ja1NwYWNpbmcgPz8gRGVmYXVsdEJsb2NrU3BhY2luZ1JlbmRlcmVyLCBsaXN0SW5kZXhNYXAgPSBidWlsZExpc3RJbmRleE1hcChibG9ja3MpLCByZW5kZXJOb2RlID0gY3JlYXRlUmVuZGVyTm9kZShyZW5kZXJlcnMsIGxpc3RJbmRleE1hcCk7XG4gIHJldHVybiBibG9ja3MubWFwKChub2RlLCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IHJlbmRlcmVkTm9kZSA9IHJlbmRlck5vZGUoe1xuICAgICAgbm9kZSxcbiAgICAgIGluZGV4LFxuICAgICAgaXNJbmxpbmU6ICExLFxuICAgICAgcmVuZGVyTm9kZVxuICAgIH0pO1xuICAgIGlmIChpbmRleCA9PT0gYmxvY2tzLmxlbmd0aCAtIDEpXG4gICAgICByZXR1cm4gcmVuZGVyZWROb2RlO1xuICAgIGNvbnN0IG5leHROb2RlID0gYmxvY2tzLmF0KGluZGV4ICsgMSk7XG4gICAgaWYgKCFuZXh0Tm9kZSlcbiAgICAgIHJldHVybiByZW5kZXJlZE5vZGU7XG4gICAgY29uc3QgYmxvY2tTcGFjaW5nID0gcmVuZGVyQmxvY2tTcGFjaW5nKHtcbiAgICAgIGN1cnJlbnQ6IG5vZGUsXG4gICAgICBuZXh0OiBuZXh0Tm9kZVxuICAgIH0pID8/IGBcblxuYDtcbiAgICByZXR1cm4gYCR7cmVuZGVyZWROb2RlfSR7YmxvY2tTcGFjaW5nfWA7XG4gIH0pLmpvaW4oXCJcIik7XG59XG5jb25zdCBub3JtYWxTdHlsZURlZmluaXRpb24gPSB7XG4gIG5hbWU6IFwibm9ybWFsXCJcbn0sIGgxU3R5bGVEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImgxXCJcbn0sIGgyU3R5bGVEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImgyXCJcbn0sIGgzU3R5bGVEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImgzXCJcbn0sIGg0U3R5bGVEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImg0XCJcbn0sIGg1U3R5bGVEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImg1XCJcbn0sIGg2U3R5bGVEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImg2XCJcbn0sIGJsb2NrcXVvdGVTdHlsZURlZmluaXRpb24gPSB7XG4gIG5hbWU6IFwiYmxvY2txdW90ZVwiXG59LCBkZWZhdWx0T3JkZXJlZExpc3RJdGVtRGVmaW5pdGlvbiA9IHtcbiAgbmFtZTogXCJudW1iZXJcIlxufSwgZGVmYXVsdFVub3JkZXJlZExpc3RJdGVtRGVmaW5pdGlvbiA9IHtcbiAgbmFtZTogXCJidWxsZXRcIlxufSwgZGVmYXVsdFN0cm9uZ0RlY29yYXRvckRlZmluaXRpb24gPSB7XG4gIG5hbWU6IFwic3Ryb25nXCJcbn0sIGRlZmF1bHRFbURlY29yYXRvckRlZmluaXRpb24gPSB7XG4gIG5hbWU6IFwiZW1cIlxufSwgZGVmYXVsdENvZGVEZWNvcmF0b3JEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImNvZGVcIlxufSwgZGVmYXVsdFN0cmlrZVRocm91Z2hEZWNvcmF0b3JEZWZpbml0aW9uID0ge1xuICBuYW1lOiBcInN0cmlrZS10aHJvdWdoXCJcbn0sIGRlZmF1bHRMaW5rT2JqZWN0RGVmaW5pdGlvbiA9IHtcbiAgbmFtZTogXCJsaW5rXCIsXG4gIGZpZWxkczogW1xuICAgIHsgbmFtZTogXCJocmVmXCIsIHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICB7IG5hbWU6IFwidGl0bGVcIiwgdHlwZTogXCJzdHJpbmdcIiB9XG4gIF1cbn0sIGRlZmF1bHRDb2RlT2JqZWN0RGVmaW5pdGlvbiA9IHtcbiAgbmFtZTogXCJjb2RlXCIsXG4gIGZpZWxkczogW1xuICAgIHsgbmFtZTogXCJsYW5ndWFnZVwiLCB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgeyBuYW1lOiBcImNvZGVcIiwgdHlwZTogXCJzdHJpbmdcIiB9XG4gIF1cbn0sIGRlZmF1bHRJbWFnZU9iamVjdERlZmluaXRpb24gPSB7XG4gIG5hbWU6IFwiaW1hZ2VcIixcbiAgZmllbGRzOiBbXG4gICAgeyBuYW1lOiBcInNyY1wiLCB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgeyBuYW1lOiBcImFsdFwiLCB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgeyBuYW1lOiBcInRpdGxlXCIsIHR5cGU6IFwic3RyaW5nXCIgfVxuICBdXG59LCBkZWZhdWx0SG9yaXpvbnRhbFJ1bGVPYmplY3REZWZpbml0aW9uID0ge1xuICBuYW1lOiBcImhvcml6b250YWwtcnVsZVwiXG59LCBkZWZhdWx0SHRtbE9iamVjdERlZmluaXRpb24gPSB7XG4gIG5hbWU6IFwiaHRtbFwiLFxuICBmaWVsZHM6IFt7IG5hbWU6IFwiaHRtbFwiLCB0eXBlOiBcInN0cmluZ1wiIH1dXG59LCBkZWZhdWx0VGFibGVPYmplY3REZWZpbml0aW9uID0ge1xuICBuYW1lOiBcInRhYmxlXCIsXG4gIGZpZWxkczogW1xuICAgIHsgbmFtZTogXCJoZWFkZXJSb3dzXCIsIHR5cGU6IFwibnVtYmVyXCIgfSxcbiAgICB7IG5hbWU6IFwicm93c1wiLCB0eXBlOiBcImFycmF5XCIgfVxuICBdXG59LCBkZWZhdWx0U2NoZW1hID0gY29tcGlsZVNjaGVtYShcbiAgZGVmaW5lU2NoZW1hKHtcbiAgICBzdHlsZXM6IFtcbiAgICAgIG5vcm1hbFN0eWxlRGVmaW5pdGlvbixcbiAgICAgIGgxU3R5bGVEZWZpbml0aW9uLFxuICAgICAgaDJTdHlsZURlZmluaXRpb24sXG4gICAgICBoM1N0eWxlRGVmaW5pdGlvbixcbiAgICAgIGg0U3R5bGVEZWZpbml0aW9uLFxuICAgICAgaDVTdHlsZURlZmluaXRpb24sXG4gICAgICBoNlN0eWxlRGVmaW5pdGlvbixcbiAgICAgIGJsb2NrcXVvdGVTdHlsZURlZmluaXRpb25cbiAgICBdLFxuICAgIGxpc3RzOiBbXG4gICAgICBkZWZhdWx0T3JkZXJlZExpc3RJdGVtRGVmaW5pdGlvbixcbiAgICAgIGRlZmF1bHRVbm9yZGVyZWRMaXN0SXRlbURlZmluaXRpb25cbiAgICBdLFxuICAgIGRlY29yYXRvcnM6IFtcbiAgICAgIGRlZmF1bHRTdHJvbmdEZWNvcmF0b3JEZWZpbml0aW9uLFxuICAgICAgZGVmYXVsdEVtRGVjb3JhdG9yRGVmaW5pdGlvbixcbiAgICAgIGRlZmF1bHRDb2RlRGVjb3JhdG9yRGVmaW5pdGlvbixcbiAgICAgIGRlZmF1bHRTdHJpa2VUaHJvdWdoRGVjb3JhdG9yRGVmaW5pdGlvblxuICAgIF0sXG4gICAgYW5ub3RhdGlvbnM6IFtkZWZhdWx0TGlua09iamVjdERlZmluaXRpb25dLFxuICAgIGJsb2NrT2JqZWN0czogW1xuICAgICAgZGVmYXVsdENvZGVPYmplY3REZWZpbml0aW9uLFxuICAgICAgZGVmYXVsdEhvcml6b250YWxSdWxlT2JqZWN0RGVmaW5pdGlvbixcbiAgICAgIGRlZmF1bHRJbWFnZU9iamVjdERlZmluaXRpb24sXG4gICAgICBkZWZhdWx0SHRtbE9iamVjdERlZmluaXRpb24sXG4gICAgICBkZWZhdWx0VGFibGVPYmplY3REZWZpbml0aW9uXG4gICAgXSxcbiAgICBpbmxpbmVPYmplY3RzOiBbZGVmYXVsdEltYWdlT2JqZWN0RGVmaW5pdGlvbl1cbiAgfSlcbik7XG5mdW5jdGlvbiBidWlsZFN0eWxlTWF0Y2hlcihkZWZpbml0aW9uKSB7XG4gIHJldHVybiAoeyBjb250ZXh0IH0pID0+IHtcbiAgICBjb25zdCBzY2hlbWFEZWZpbml0aW9uID0gY29udGV4dC5zY2hlbWEuc3R5bGVzLmZpbmQoXG4gICAgICAoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBkZWZpbml0aW9uLm5hbWVcbiAgICApO1xuICAgIGlmIChzY2hlbWFEZWZpbml0aW9uKVxuICAgICAgcmV0dXJuIHNjaGVtYURlZmluaXRpb24ubmFtZTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGJ1aWxkTGlzdEl0ZW1NYXRjaGVyKGRlZmluaXRpb24pIHtcbiAgcmV0dXJuICh7IGNvbnRleHQgfSkgPT4ge1xuICAgIGNvbnN0IHNjaGVtYURlZmluaXRpb24gPSBjb250ZXh0LnNjaGVtYS5saXN0cy5maW5kKFxuICAgICAgKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PT0gZGVmaW5pdGlvbi5uYW1lXG4gICAgKTtcbiAgICBpZiAoc2NoZW1hRGVmaW5pdGlvbilcbiAgICAgIHJldHVybiBzY2hlbWFEZWZpbml0aW9uLm5hbWU7XG4gIH07XG59XG5mdW5jdGlvbiBidWlsZERlY29yYXRvck1hdGNoZXIoZGVmaW5pdGlvbikge1xuICByZXR1cm4gKHsgY29udGV4dCB9KSA9PiB7XG4gICAgY29uc3Qgc2NoZW1hRGVmaW5pdGlvbiA9IGNvbnRleHQuc2NoZW1hLmRlY29yYXRvcnMuZmluZChcbiAgICAgIChpdGVtKSA9PiBpdGVtLm5hbWUgPT09IGRlZmluaXRpb24ubmFtZVxuICAgICk7XG4gICAgaWYgKHNjaGVtYURlZmluaXRpb24pXG4gICAgICByZXR1cm4gc2NoZW1hRGVmaW5pdGlvbi5uYW1lO1xuICB9O1xufVxuZnVuY3Rpb24gYnVpbGRBbm5vdGF0aW9uTWF0Y2hlcihkZWZpbml0aW9uKSB7XG4gIHJldHVybiAoeyBjb250ZXh0LCB2YWx1ZSB9KSA9PiB7XG4gICAgY29uc3Qgc2NoZW1hRGVmaW5pdGlvbiA9IGNvbnRleHQuc2NoZW1hLmFubm90YXRpb25zLmZpbmQoXG4gICAgICAoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBkZWZpbml0aW9uLm5hbWVcbiAgICApO1xuICAgIGlmICghc2NoZW1hRGVmaW5pdGlvbilcbiAgICAgIHJldHVybjtcbiAgICBjb25zdCBmaWx0ZXJlZFZhbHVlID0gc2NoZW1hRGVmaW5pdGlvbi5maWVsZHMucmVkdWNlKChmaWx0ZXJlZFZhbHVlMiwgZmllbGQpID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSB2YWx1ZVtmaWVsZC5uYW1lXTtcbiAgICAgIHJldHVybiBmaWVsZFZhbHVlICE9PSB2b2lkIDAgJiYgKGZpbHRlcmVkVmFsdWUyW2ZpZWxkLm5hbWVdID0gZmllbGRWYWx1ZSksIGZpbHRlcmVkVmFsdWUyO1xuICAgIH0sIHt9KTtcbiAgICByZXR1cm4ge1xuICAgICAgX2tleTogY29udGV4dC5rZXlHZW5lcmF0b3IoKSxcbiAgICAgIF90eXBlOiBzY2hlbWFEZWZpbml0aW9uLm5hbWUsXG4gICAgICAuLi5maWx0ZXJlZFZhbHVlXG4gICAgfTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGJ1aWxkT2JqZWN0TWF0Y2hlcihkZWZpbml0aW9uKSB7XG4gIHJldHVybiAoeyBjb250ZXh0LCB2YWx1ZSwgaXNJbmxpbmUgfSkgPT4ge1xuICAgIGNvbnN0IHNjaGVtYURlZmluaXRpb24gPSAoaXNJbmxpbmUgPyBjb250ZXh0LnNjaGVtYS5pbmxpbmVPYmplY3RzIDogY29udGV4dC5zY2hlbWEuYmxvY2tPYmplY3RzKS5maW5kKFxuICAgICAgKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PT0gZGVmaW5pdGlvbi5uYW1lXG4gICAgKTtcbiAgICBpZiAoIXNjaGVtYURlZmluaXRpb24pXG4gICAgICByZXR1cm47XG4gICAgY29uc3QgZmlsdGVyZWRWYWx1ZSA9IHNjaGVtYURlZmluaXRpb24uZmllbGRzLnJlZHVjZSgoZmlsdGVyZWRWYWx1ZTIsIGZpZWxkKSA9PiB7XG4gICAgICBjb25zdCBmaWVsZFZhbHVlID0gdmFsdWVbZmllbGQubmFtZV07XG4gICAgICByZXR1cm4gZmllbGRWYWx1ZSAhPT0gdm9pZCAwICYmIChmaWx0ZXJlZFZhbHVlMltmaWVsZC5uYW1lXSA9IGZpZWxkVmFsdWUpLCBmaWx0ZXJlZFZhbHVlMjtcbiAgICB9LCB7fSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9rZXk6IGNvbnRleHQua2V5R2VuZXJhdG9yKCksXG4gICAgICBfdHlwZTogc2NoZW1hRGVmaW5pdGlvbi5uYW1lLFxuICAgICAgLi4uZmlsdGVyZWRWYWx1ZVxuICAgIH07XG4gIH07XG59XG5jb25zdCBjb2RlQmxvY2tNYXRjaGVyID0gKHsgY29udGV4dCwgdmFsdWUsIGlzSW5saW5lIH0pID0+IHtcbiAgY29uc3QgY29kZU9iamVjdCA9IGJ1aWxkT2JqZWN0TWF0Y2hlcihkZWZhdWx0Q29kZU9iamVjdERlZmluaXRpb24pKHsgY29udGV4dCwgdmFsdWUsIGlzSW5saW5lIH0pO1xuICBpZiAoY29kZU9iamVjdCAmJiBcImNvZGVcIiBpbiBjb2RlT2JqZWN0KVxuICAgIHJldHVybiBjb2RlT2JqZWN0O1xufSwgaW1hZ2VCbG9ja01hdGNoZXIgPSAoeyBjb250ZXh0LCB2YWx1ZSwgaXNJbmxpbmUgfSkgPT4ge1xuICBjb25zdCBpbWFnZU9iamVjdCA9IGJ1aWxkT2JqZWN0TWF0Y2hlcihkZWZhdWx0SW1hZ2VPYmplY3REZWZpbml0aW9uKSh7IGNvbnRleHQsIHZhbHVlLCBpc0lubGluZSB9KTtcbiAgaWYgKGltYWdlT2JqZWN0ICYmIFwic3JjXCIgaW4gaW1hZ2VPYmplY3QpXG4gICAgcmV0dXJuIGltYWdlT2JqZWN0O1xufSwgZGVmYXVsdE9wdGlvbnMgPSB7XG4gIGJsb2NrOiB7XG4gICAgbm9ybWFsOiBidWlsZFN0eWxlTWF0Y2hlcihub3JtYWxTdHlsZURlZmluaXRpb24pLFxuICAgIGJsb2NrcXVvdGU6IGJ1aWxkU3R5bGVNYXRjaGVyKGJsb2NrcXVvdGVTdHlsZURlZmluaXRpb24pLFxuICAgIGgxOiBidWlsZFN0eWxlTWF0Y2hlcihoMVN0eWxlRGVmaW5pdGlvbiksXG4gICAgaDI6IGJ1aWxkU3R5bGVNYXRjaGVyKGgyU3R5bGVEZWZpbml0aW9uKSxcbiAgICBoMzogYnVpbGRTdHlsZU1hdGNoZXIoaDNTdHlsZURlZmluaXRpb24pLFxuICAgIGg0OiBidWlsZFN0eWxlTWF0Y2hlcihoNFN0eWxlRGVmaW5pdGlvbiksXG4gICAgaDU6IGJ1aWxkU3R5bGVNYXRjaGVyKGg1U3R5bGVEZWZpbml0aW9uKSxcbiAgICBoNjogYnVpbGRTdHlsZU1hdGNoZXIoaDZTdHlsZURlZmluaXRpb24pXG4gIH0sXG4gIGxpc3RJdGVtOiB7XG4gICAgbnVtYmVyOiBidWlsZExpc3RJdGVtTWF0Y2hlcihkZWZhdWx0T3JkZXJlZExpc3RJdGVtRGVmaW5pdGlvbiksXG4gICAgYnVsbGV0OiBidWlsZExpc3RJdGVtTWF0Y2hlcihkZWZhdWx0VW5vcmRlcmVkTGlzdEl0ZW1EZWZpbml0aW9uKVxuICB9LFxuICBtYXJrczoge1xuICAgIHN0cm9uZzogYnVpbGREZWNvcmF0b3JNYXRjaGVyKGRlZmF1bHRTdHJvbmdEZWNvcmF0b3JEZWZpbml0aW9uKSxcbiAgICBlbTogYnVpbGREZWNvcmF0b3JNYXRjaGVyKGRlZmF1bHRFbURlY29yYXRvckRlZmluaXRpb24pLFxuICAgIGNvZGU6IGJ1aWxkRGVjb3JhdG9yTWF0Y2hlcihkZWZhdWx0Q29kZURlY29yYXRvckRlZmluaXRpb24pLFxuICAgIHN0cmlrZVRocm91Z2g6IGJ1aWxkRGVjb3JhdG9yTWF0Y2hlcihcbiAgICAgIGRlZmF1bHRTdHJpa2VUaHJvdWdoRGVjb3JhdG9yRGVmaW5pdGlvblxuICAgICksXG4gICAgbGluazogYnVpbGRBbm5vdGF0aW9uTWF0Y2hlcihkZWZhdWx0TGlua09iamVjdERlZmluaXRpb24pXG4gIH0sXG4gIHR5cGVzOiB7XG4gICAgY29kZTogY29kZUJsb2NrTWF0Y2hlcixcbiAgICBob3Jpem9udGFsUnVsZTogYnVpbGRPYmplY3RNYXRjaGVyKGRlZmF1bHRIb3Jpem9udGFsUnVsZU9iamVjdERlZmluaXRpb24pLFxuICAgIGh0bWw6IGJ1aWxkT2JqZWN0TWF0Y2hlcihkZWZhdWx0SHRtbE9iamVjdERlZmluaXRpb24pLFxuICAgIGltYWdlOiBpbWFnZUJsb2NrTWF0Y2hlclxuICB9XG59O1xuZnVuY3Rpb24gZmxhdHRlblRhYmxlKHRhYmxlLCBwb3J0YWJsZVRleHQpIHtcbiAgZm9yIChjb25zdCByb3cgb2YgdGFibGUucm93cylcbiAgICBmb3IgKGNvbnN0IGNlbGwgb2Ygcm93LmNlbGxzKVxuICAgICAgZm9yIChjb25zdCBibG9jayBvZiBjZWxsLnZhbHVlKVxuICAgICAgICBwb3J0YWJsZVRleHQucHVzaChibG9jayk7XG59XG5mdW5jdGlvbiBtYXJrZG93blRvUG9ydGFibGVUZXh0KG1hcmtkb3duLCBvcHRpb25zKSB7XG4gIGNvbnN0IGNvbnNvbGlkYXRlZE9wdGlvbnMgPSB7XG4gICAgc2NoZW1hOiBvcHRpb25zPy5zY2hlbWEgPz8gZGVmYXVsdFNjaGVtYSxcbiAgICBrZXlHZW5lcmF0b3I6IG9wdGlvbnM/LmtleUdlbmVyYXRvciA/PyBkZWZhdWx0S2V5R2VuZXJhdG9yLFxuICAgIGh0bWw6IHtcbiAgICAgIGlubGluZTogb3B0aW9ucz8uaHRtbD8uaW5saW5lID8/IFwic2tpcFwiXG4gICAgfSxcbiAgICBtYXJrczoge1xuICAgICAgLi4uZGVmYXVsdE9wdGlvbnMubWFya3MsXG4gICAgICAuLi5vcHRpb25zPy5tYXJrc1xuICAgIH0sXG4gICAgYmxvY2s6IHtcbiAgICAgIC4uLmRlZmF1bHRPcHRpb25zLmJsb2NrLFxuICAgICAgLi4ub3B0aW9ucz8uYmxvY2tcbiAgICB9LFxuICAgIGxpc3RJdGVtOiB7XG4gICAgICAuLi5kZWZhdWx0T3B0aW9ucy5saXN0SXRlbSxcbiAgICAgIC4uLm9wdGlvbnM/Lmxpc3RJdGVtXG4gICAgfSxcbiAgICB0eXBlczoge1xuICAgICAgLi4uZGVmYXVsdE9wdGlvbnMudHlwZXMsXG4gICAgICAuLi5vcHRpb25zPy50eXBlc1xuICAgIH1cbiAgfSwgdG9rZW5zID0gbWFya2Rvd25pdCh7XG4gICAgaHRtbDogITAsXG4gICAgbGlua2lmeTogITAsXG4gICAgdHlwb2dyYXBoZXI6ICEwXG4gIH0pLmVuYWJsZShbXCJzdHJpa2V0aHJvdWdoXCIsIFwidGFibGVcIl0pLnBhcnNlKG1hcmtkb3duLCB7fSksIHBvcnRhYmxlVGV4dCA9IFtdO1xuICBsZXQgY3VycmVudEJsb2NrID0gbnVsbDtcbiAgY29uc3QgY3VycmVudExpc3RTdGFjayA9IFtdLCBtYXJrRGVmUmVmcyA9IFtdO1xuICBsZXQgY3VycmVudE1hcmtEZWZzID0gW10sIGN1cnJlbnRCbG9ja3F1b3RlU3R5bGUgPSBudWxsLCBpbkxpc3RJdGVtID0gITEsIGN1cnJlbnRUYWJsZSA9IG51bGwsIGN1cnJlbnRUYWJsZVJvdyA9IG51bGwsIGluVGFibGVIZWFkID0gITE7XG4gIGNvbnN0IHN0YXJ0QmxvY2sgPSAoc3R5bGUpID0+IHtcbiAgICBmbHVzaEJsb2NrKCksIGN1cnJlbnRCbG9jayA9IHtcbiAgICAgIF90eXBlOiBcImJsb2NrXCIsXG4gICAgICBzdHlsZSxcbiAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgIF9rZXk6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yKCksXG4gICAgICBtYXJrRGVmczogW11cbiAgICB9LCBjdXJyZW50TWFya0RlZnMgPSBbXTtcbiAgfSwgZmx1c2hCbG9jayA9ICgpID0+IHtcbiAgICBjdXJyZW50QmxvY2sgJiYgKGN1cnJlbnRCbG9jay5jaGlsZHJlbi5sZW5ndGggPT09IDAgJiYgY3VycmVudEJsb2NrLmNoaWxkcmVuLnB1c2goe1xuICAgICAgX3R5cGU6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLnNwYW4ubmFtZSxcbiAgICAgIF9rZXk6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yKCksXG4gICAgICB0ZXh0OiBcIlwiLFxuICAgICAgbWFya3M6IFtdXG4gICAgfSksIGN1cnJlbnRCbG9jay5tYXJrRGVmcyA9IGN1cnJlbnRNYXJrRGVmcywgcG9ydGFibGVUZXh0LnB1c2goY3VycmVudEJsb2NrKSwgY3VycmVudEJsb2NrID0gbnVsbCwgY3VycmVudE1hcmtEZWZzID0gW10pO1xuICB9LCBhZGRTcGFuID0gKHRleHQpID0+IHtcbiAgICBpZiAodGV4dC5sZW5ndGggPT09IDApXG4gICAgICByZXR1cm47XG4gICAgaWYgKCFjdXJyZW50QmxvY2spIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gY3VycmVudEJsb2NrcXVvdGVTdHlsZSA/PyBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLm5vcm1hbCh7XG4gICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICB9KTtcbiAgICAgIHN0eWxlID8gc3RhcnRCbG9jayhzdHlsZSkgOiAoY29uc29sZS53YXJuKCdObyBkZWZhdWx0IHN0eWxlIGZvdW5kLCB1c2luZyBcIm5vcm1hbFwiJyksIHN0YXJ0QmxvY2soXCJub3JtYWxcIikpO1xuICAgIH1cbiAgICBpZiAoIWN1cnJlbnRCbG9jaylcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIGN1cnJlbnQgYmxvY2tcIik7XG4gICAgY29uc3QgbGFzdENoaWxkID0gY3VycmVudEJsb2NrLmNoaWxkcmVuLmF0KC0xKTtcbiAgICBpc1NwYW4oeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH0sIGxhc3RDaGlsZCkgJiYgbGFzdENoaWxkLm1hcmtzPy5ldmVyeSgobWFyaykgPT4gbWFya0RlZlJlZnMuaW5jbHVkZXMobWFyaykpICYmIG1hcmtEZWZSZWZzLmV2ZXJ5KChtYXJrKSA9PiBsYXN0Q2hpbGQubWFya3M/LmluY2x1ZGVzKG1hcmspKSA/IGxhc3RDaGlsZC50ZXh0ICs9IHRleHQgOiBjdXJyZW50QmxvY2suY2hpbGRyZW4ucHVzaCh7XG4gICAgICBfdHlwZTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgX2tleTogY29uc29saWRhdGVkT3B0aW9ucy5rZXlHZW5lcmF0b3IoKSxcbiAgICAgIHRleHQsXG4gICAgICBtYXJrczogWy4uLm1hcmtEZWZSZWZzXVxuICAgIH0pO1xuICB9LCBsaXN0TGV2ZWwgPSAoKSA9PiBjdXJyZW50TGlzdFN0YWNrLmxlbmd0aCwgZW5zdXJlTGlzdEJsb2NrID0gKGxpc3RJdGVtKSA9PiB7XG4gICAgaWYgKCFjdXJyZW50QmxvY2spIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gY3VycmVudEJsb2NrcXVvdGVTdHlsZSA/PyBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLm5vcm1hbCh7XG4gICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICB9KTtcbiAgICAgIHN0eWxlID8gc3RhcnRCbG9jayhzdHlsZSkgOiAoY29uc29sZS53YXJuKCdObyBkZWZhdWx0IHN0eWxlIGZvdW5kLCB1c2luZyBcIm5vcm1hbFwiJyksIHN0YXJ0QmxvY2soXCJub3JtYWxcIikpO1xuICAgIH1cbiAgICBpZiAoIWN1cnJlbnRCbG9jaylcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIGN1cnJlbnQgYmxvY2tcIik7XG4gICAgKGN1cnJlbnRCbG9jay5saXN0SXRlbSAhPT0gbGlzdEl0ZW0gfHwgY3VycmVudEJsb2NrLmxldmVsICE9PSBsaXN0TGV2ZWwoKSkgJiYgKGN1cnJlbnRCbG9jay5saXN0SXRlbSA9IGxpc3RJdGVtLCBjdXJyZW50QmxvY2subGV2ZWwgPSBsaXN0TGV2ZWwoKSk7XG4gIH07XG4gIGZvciAoY29uc3QgdG9rZW4gb2YgdG9rZW5zKVxuICAgIHN3aXRjaCAodG9rZW4udHlwZSkge1xuICAgICAgLy8gUGFyYWdyYXBoc1xuICAgICAgY2FzZSBcInBhcmFncmFwaF9vcGVuXCI6IHtcbiAgICAgICAgaWYgKGluTGlzdEl0ZW0pIHtcbiAgICAgICAgICBpZiAoIWN1cnJlbnRCbG9jaykge1xuICAgICAgICAgICAgY29uc3QgbGlzdFR5cGUgPSBjdXJyZW50TGlzdFN0YWNrLmF0KC0xKTtcbiAgICAgICAgICAgIGxpc3RUeXBlICYmIGVuc3VyZUxpc3RCbG9jayhsaXN0VHlwZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0eWxlID0gY3VycmVudEJsb2NrcXVvdGVTdHlsZSA/PyBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLm5vcm1hbCh7XG4gICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghc3R5bGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIGRlZmF1bHQgc3R5bGUgZm91bmQsIHVzaW5nIFwibm9ybWFsXCInKSwgc3RhcnRCbG9jayhcIm5vcm1hbFwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBzdGFydEJsb2NrKHN0eWxlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwicGFyYWdyYXBoX2Nsb3NlXCI6XG4gICAgICAgIGlmIChpbkxpc3RJdGVtKVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBmbHVzaEJsb2NrKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgLy8gSGVhZGluZ3NcbiAgICAgIGNhc2UgXCJoZWFkaW5nX29wZW5cIjoge1xuICAgICAgICBjb25zdCBsZXZlbCA9IE51bWJlcih0b2tlbj8udGFnPy5zbGljZSgxKSksIGhlYWRpbmdNYXRjaGVyID0ge1xuICAgICAgICAgIDE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2suaDEsXG4gICAgICAgICAgMjogY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5oMixcbiAgICAgICAgICAzOiBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLmgzLFxuICAgICAgICAgIDQ6IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2suaDQsXG4gICAgICAgICAgNTogY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5oNSxcbiAgICAgICAgICA2OiBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLmg2XG4gICAgICAgIH1bbGV2ZWxdLCBzdHlsZSA9IGhlYWRpbmdNYXRjaGVyPy4oe1xuICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgIH0pID8/IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2subm9ybWFsKHtcbiAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFzdHlsZSkge1xuICAgICAgICAgIGNvbnNvbGUud2FybignTm8gaGVhZGluZyBzdHlsZSBmb3VuZCwgdXNpbmcgXCJub3JtYWxcIicpLCBzdGFydEJsb2NrKFwibm9ybWFsXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHN0YXJ0QmxvY2soc3R5bGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJoZWFkaW5nX2Nsb3NlXCI6XG4gICAgICAgIGZsdXNoQmxvY2soKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBCbG9ja3F1b3RlXG4gICAgICBjYXNlIFwiYmxvY2txdW90ZV9vcGVuXCI6IHtcbiAgICAgICAgZmx1c2hCbG9jaygpLCBjdXJyZW50QmxvY2txdW90ZVN0eWxlID0gY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5ibG9ja3F1b3RlKHtcbiAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICB9KSA/PyBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLm5vcm1hbCh7XG4gICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgfSkgPz8gXCJub3JtYWxcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmxvY2txdW90ZV9jbG9zZVwiOiB7XG4gICAgICAgIGZsdXNoQmxvY2soKSwgY3VycmVudEJsb2NrcXVvdGVTdHlsZSA9IG51bGw7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8gTGlzdHNcbiAgICAgIGNhc2UgXCJidWxsZXRfbGlzdF9vcGVuXCI6IHtcbiAgICAgICAgY29uc3QgbGlzdEl0ZW0gPSBjb25zb2xpZGF0ZWRPcHRpb25zLmxpc3RJdGVtLmJ1bGxldCh7XG4gICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghbGlzdEl0ZW0pIHtcbiAgICAgICAgICBjdXJyZW50TGlzdFN0YWNrLnB1c2gobnVsbCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudExpc3RTdGFjay5wdXNoKGxpc3RJdGVtKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwib3JkZXJlZF9saXN0X29wZW5cIjoge1xuICAgICAgICBjb25zdCBsaXN0SXRlbSA9IGNvbnNvbGlkYXRlZE9wdGlvbnMubGlzdEl0ZW0ubnVtYmVyKHtcbiAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFsaXN0SXRlbSkge1xuICAgICAgICAgIGN1cnJlbnRMaXN0U3RhY2sucHVzaChudWxsKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50TGlzdFN0YWNrLnB1c2gobGlzdEl0ZW0pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJidWxsZXRfbGlzdF9jbG9zZVwiOlxuICAgICAgY2FzZSBcIm9yZGVyZWRfbGlzdF9jbG9zZVwiOlxuICAgICAgICBjdXJyZW50TGlzdFN0YWNrLnBvcCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJsaXN0X2l0ZW1fb3BlblwiOiB7XG4gICAgICAgIGNvbnN0IGxpc3RUeXBlID0gY3VycmVudExpc3RTdGFjay5hdCgtMSk7XG4gICAgICAgIGlmIChsaXN0VHlwZSA9PT0gdm9pZCAwKVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIGFuIG9wZW4gbGlzdFwiKTtcbiAgICAgICAgaWYgKGN1cnJlbnRCbG9jayAmJiBmbHVzaEJsb2NrKCksIGxpc3RUeXBlID09PSBudWxsKSB7XG4gICAgICAgICAgY29uc3Qgc3R5bGUgPSBjdXJyZW50QmxvY2txdW90ZVN0eWxlID8/IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2subm9ybWFsKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc3R5bGUgPyBzdGFydEJsb2NrKHN0eWxlKSA6IChjb25zb2xlLndhcm4oJ05vIGRlZmF1bHQgc3R5bGUgZm91bmQsIHVzaW5nIFwibm9ybWFsXCInKSwgc3RhcnRCbG9jayhcIm5vcm1hbFwiKSksIGluTGlzdEl0ZW0gPSAhMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBlbnN1cmVMaXN0QmxvY2sobGlzdFR5cGUpLCBpbkxpc3RJdGVtID0gITA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImxpc3RfaXRlbV9jbG9zZVwiOlxuICAgICAgICBpbkxpc3RJdGVtID0gITEsIGZsdXNoQmxvY2soKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBDb2RlIGZlbmNlcyAvIGJsb2Nrc1xuICAgICAgY2FzZSBcImZlbmNlXCI6IHtcbiAgICAgICAgZmx1c2hCbG9jaygpO1xuICAgICAgICBjb25zdCBsYW5ndWFnZSA9IHRva2VuLmluZm8udHJpbSgpIHx8IHZvaWQgMCwgY29kZSA9IHRva2VuLmNvbnRlbnQucmVwbGFjZSgvXFxuJC8sIFwiXCIpLCBjb2RlT2JqZWN0ID0gY29uc29saWRhdGVkT3B0aW9ucy50eXBlcy5jb2RlKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLFxuICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBjb25zb2xpZGF0ZWRPcHRpb25zLmtleUdlbmVyYXRvclxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IHsgbGFuZ3VhZ2UsIGNvZGUgfSxcbiAgICAgICAgICBpc0lubGluZTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghY29kZU9iamVjdCkge1xuICAgICAgICAgIGNvbnN0IHN0eWxlID0gY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5ub3JtYWwoe1xuICAgICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzdHlsZSA/IHN0YXJ0QmxvY2soc3R5bGUpIDogKGNvbnNvbGUud2FybignTm8gZGVmYXVsdCBzdHlsZSBmb3VuZCwgdXNpbmcgXCJub3JtYWxcIicpLCBzdGFydEJsb2NrKFwibm9ybWFsXCIpKSwgYWRkU3Bhbihjb2RlKSwgZmx1c2hCbG9jaygpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHBvcnRhYmxlVGV4dC5wdXNoKGNvZGVPYmplY3QpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIEhvcml6b250YWwgcnVsZVxuICAgICAgY2FzZSBcImhyXCI6IHtcbiAgICAgICAgZmx1c2hCbG9jaygpO1xuICAgICAgICBjb25zdCBock9iamVjdCA9IGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMuaG9yaXpvbnRhbFJ1bGUoe1xuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEsXG4gICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YWx1ZToge30sXG4gICAgICAgICAgaXNJbmxpbmU6ICExXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWhyT2JqZWN0KSB7XG4gICAgICAgICAgY29uc3Qgc3R5bGUgPSBjb25zb2xpZGF0ZWRPcHRpb25zLmJsb2NrLm5vcm1hbCh7XG4gICAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHN0eWxlID8gc3RhcnRCbG9jayhzdHlsZSkgOiAoY29uc29sZS53YXJuKCdObyBkZWZhdWx0IHN0eWxlIGZvdW5kLCB1c2luZyBcIm5vcm1hbFwiJyksIHN0YXJ0QmxvY2soXCJub3JtYWxcIikpLCBhZGRTcGFuKFwiLS0tXCIpLCBmbHVzaEJsb2NrKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcG9ydGFibGVUZXh0LnB1c2goaHJPYmplY3QpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIEhUTUwgYmxvY2tcbiAgICAgIGNhc2UgXCJodG1sX2Jsb2NrXCI6IHtcbiAgICAgICAgZmx1c2hCbG9jaygpO1xuICAgICAgICBjb25zdCBodG1sQ29udGVudCA9IHRva2VuLmNvbnRlbnQudHJpbSgpO1xuICAgICAgICBpZiAoIWh0bWxDb250ZW50KVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjb25zdCBodG1sT2JqZWN0ID0gY29uc29saWRhdGVkT3B0aW9ucy50eXBlcy5odG1sKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLFxuICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBjb25zb2xpZGF0ZWRPcHRpb25zLmtleUdlbmVyYXRvclxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IHsgaHRtbDogaHRtbENvbnRlbnQgfSxcbiAgICAgICAgICBpc0lubGluZTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghaHRtbE9iamVjdCkge1xuICAgICAgICAgIGNvbnN0IHN0eWxlID0gY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5ub3JtYWwoe1xuICAgICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzdHlsZSA/IHN0YXJ0QmxvY2soc3R5bGUpIDogKGNvbnNvbGUud2FybignTm8gZGVmYXVsdCBzdHlsZSBmb3VuZCwgdXNpbmcgXCJub3JtYWxcIicpLCBzdGFydEJsb2NrKFwibm9ybWFsXCIpKSwgYWRkU3BhbihodG1sQ29udGVudCksIGZsdXNoQmxvY2soKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBwb3J0YWJsZVRleHQucHVzaChodG1sT2JqZWN0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29kZV9ibG9ja1wiOiB7XG4gICAgICAgIGZsdXNoQmxvY2soKTtcbiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuLmNvbnRlbnQucmVwbGFjZSgvXFxuJC8sIFwiXCIpLCBjb2RlT2JqZWN0ID0gY29uc29saWRhdGVkT3B0aW9ucy50eXBlcy5jb2RlKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLFxuICAgICAgICAgICAga2V5R2VuZXJhdG9yOiBjb25zb2xpZGF0ZWRPcHRpb25zLmtleUdlbmVyYXRvclxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IHsgbGFuZ3VhZ2U6IHZvaWQgMCwgY29kZSB9LFxuICAgICAgICAgIGlzSW5saW5lOiAhMVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGNvZGVPYmplY3QpXG4gICAgICAgICAgcG9ydGFibGVUZXh0LnB1c2goY29kZU9iamVjdCk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHN0eWxlID0gY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5ub3JtYWwoe1xuICAgICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzdHlsZSA/IHN0YXJ0QmxvY2soc3R5bGUpIDogKGNvbnNvbGUud2FybignTm8gZGVmYXVsdCBzdHlsZSBmb3VuZCwgdXNpbmcgXCJub3JtYWxcIicpLCBzdGFydEJsb2NrKFwibm9ybWFsXCIpKSwgYWRkU3Bhbihjb2RlKSwgZmx1c2hCbG9jaygpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8gVGFibGVzXG4gICAgICBjYXNlIFwidGFibGVfb3BlblwiOlxuICAgICAgICBmbHVzaEJsb2NrKCksIGN1cnJlbnRUYWJsZSA9IHsgcm93czogW10sIGhlYWRlclJvd3M6IDAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwidGFibGVfY2xvc2VcIjoge1xuICAgICAgICBpZiAoIWN1cnJlbnRUYWJsZSlcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgaWYgKGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMudGFibGUpIHtcbiAgICAgICAgICBjb25zdCB0YWJsZU9iamVjdCA9IGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMudGFibGUoe1xuICAgICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgICBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLFxuICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgcm93czogY3VycmVudFRhYmxlLnJvd3MsXG4gICAgICAgICAgICAgIGhlYWRlclJvd3M6IGN1cnJlbnRUYWJsZS5oZWFkZXJSb3dzID4gMCA/IGN1cnJlbnRUYWJsZS5oZWFkZXJSb3dzIDogdm9pZCAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNJbmxpbmU6ICExXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGFibGVPYmplY3QgPyBwb3J0YWJsZVRleHQucHVzaCh0YWJsZU9iamVjdCkgOiBmbGF0dGVuVGFibGUoY3VycmVudFRhYmxlLCBwb3J0YWJsZVRleHQpO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgICBmbGF0dGVuVGFibGUoY3VycmVudFRhYmxlLCBwb3J0YWJsZVRleHQpO1xuICAgICAgICBjdXJyZW50VGFibGUgPSBudWxsO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0aGVhZF9vcGVuXCI6XG4gICAgICAgIGluVGFibGVIZWFkID0gITA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInRoZWFkX2Nsb3NlXCI6XG4gICAgICAgIGluVGFibGVIZWFkID0gITE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInRib2R5X29wZW5cIjpcbiAgICAgIGNhc2UgXCJ0Ym9keV9jbG9zZVwiOlxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0cl9vcGVuXCI6XG4gICAgICAgIGN1cnJlbnRUYWJsZVJvdyA9IFtdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0cl9jbG9zZVwiOlxuICAgICAgICBjdXJyZW50VGFibGUgJiYgY3VycmVudFRhYmxlUm93ICYmIChjdXJyZW50VGFibGUucm93cy5wdXNoKHtcbiAgICAgICAgICBfa2V5OiBjb25zb2xpZGF0ZWRPcHRpb25zLmtleUdlbmVyYXRvcigpLFxuICAgICAgICAgIF90eXBlOiBcInJvd1wiLFxuICAgICAgICAgIGNlbGxzOiBjdXJyZW50VGFibGVSb3dcbiAgICAgICAgfSksIGluVGFibGVIZWFkICYmIGN1cnJlbnRUYWJsZS5oZWFkZXJSb3dzKyspLCBjdXJyZW50VGFibGVSb3cgPSBudWxsO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0aF9vcGVuXCI6XG4gICAgICBjYXNlIFwidGRfb3BlblwiOiB7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5ub3JtYWwoe1xuICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgIH0pO1xuICAgICAgICBzdHlsZSA/IHN0YXJ0QmxvY2soc3R5bGUpIDogKGNvbnNvbGUud2FybignTm8gZGVmYXVsdCBzdHlsZSBmb3VuZCwgdXNpbmcgXCJub3JtYWxcIicpLCBzdGFydEJsb2NrKFwibm9ybWFsXCIpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGhfY2xvc2VcIjpcbiAgICAgIGNhc2UgXCJ0ZF9jbG9zZVwiOiB7XG4gICAgICAgIGZsdXNoQmxvY2soKTtcbiAgICAgICAgY29uc3QgY2VsbEJsb2NrcyA9IFtdO1xuICAgICAgICBpZiAocG9ydGFibGVUZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBsYXN0QmxvY2sgPSBwb3J0YWJsZVRleHQuYXQoLTEpO1xuICAgICAgICAgIGxhc3RCbG9jayAmJiBsYXN0QmxvY2suX3R5cGUgPT09IFwiYmxvY2tcIiAmJiBjZWxsQmxvY2tzLnB1c2gocG9ydGFibGVUZXh0LnBvcCgpKTtcbiAgICAgICAgfVxuICAgICAgICBjZWxsQmxvY2tzLmxlbmd0aCA9PT0gMCAmJiBjZWxsQmxvY2tzLnB1c2goe1xuICAgICAgICAgIF90eXBlOiBcImJsb2NrXCIsXG4gICAgICAgICAgc3R5bGU6IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2subm9ybWFsKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgICAgfSkgfHwgXCJub3JtYWxcIixcbiAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBfdHlwZTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgICAgICAgICBfa2V5OiBjb25zb2xpZGF0ZWRPcHRpb25zLmtleUdlbmVyYXRvcigpLFxuICAgICAgICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICAgICAgICBtYXJrczogW11cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIF9rZXk6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yKCksXG4gICAgICAgICAgbWFya0RlZnM6IFtdXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBmaXJzdEJsb2NrID0gY2VsbEJsb2Nrc1swXTtcbiAgICAgICAgaWYgKGNlbGxCbG9ja3MubGVuZ3RoID09PSAxICYmIGZpcnN0QmxvY2sgJiYgZmlyc3RCbG9jay5fdHlwZSA9PT0gXCJibG9ja1wiICYmIFwiY2hpbGRyZW5cIiBpbiBmaXJzdEJsb2NrICYmIEFycmF5LmlzQXJyYXkoZmlyc3RCbG9jay5jaGlsZHJlbikgJiYgZmlyc3RCbG9jay5jaGlsZHJlbi5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICBjb25zdCBvbmx5Q2hpbGQgPSBmaXJzdEJsb2NrLmNoaWxkcmVuWzBdO1xuICAgICAgICAgIHR5cGVvZiBvbmx5Q2hpbGQgPT0gXCJvYmplY3RcIiAmJiBvbmx5Q2hpbGQgIT09IG51bGwgJiYgXCJfdHlwZVwiIGluIG9ubHlDaGlsZCAmJiBvbmx5Q2hpbGQuX3R5cGUgIT09IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLnNwYW4ubmFtZSAmJiBvbmx5Q2hpbGQuX3R5cGUgPT09IFwiaW1hZ2VcIiAmJiAoY2VsbEJsb2Nrc1swXSA9IG9ubHlDaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudFRhYmxlUm93ICE9PSBudWxsICYmIGN1cnJlbnRUYWJsZVJvdy5wdXNoKHtcbiAgICAgICAgICBfdHlwZTogXCJjZWxsXCIsXG4gICAgICAgICAgX2tleTogY29uc29saWRhdGVkT3B0aW9ucy5rZXlHZW5lcmF0b3IoKSxcbiAgICAgICAgICB2YWx1ZTogY2VsbEJsb2Nrc1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyBJbmxpbmUgY29udGFpbmVyXG4gICAgICBjYXNlIFwiaW5saW5lXCI6IHtcbiAgICAgICAgY29uc3QgaW5UYWJsZUNlbGwgPSBjdXJyZW50VGFibGVSb3cgIT09IG51bGw7XG4gICAgICAgIGlmICh0b2tlbi5jaGlsZHJlbj8ubGVuZ3RoID09PSAxICYmIHRva2VuLmNoaWxkcmVuWzBdPy50eXBlID09PSBcImltYWdlXCIpIHtcbiAgICAgICAgICBjb25zdCBpbWFnZVRva2VuID0gdG9rZW4uY2hpbGRyZW5bMF07XG4gICAgICAgICAgaWYgKCFpbWFnZVRva2VuKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY29uc3Qgc3JjID0gaW1hZ2VUb2tlbi5hdHRycz8uZmluZCgoW25hbWVdKSA9PiBuYW1lID09PSBcInNyY1wiKT8uYXQoMSkgfHwgXCJcIiwgYWx0ID0gdW5lc2NhcGVJbWFnZUFuZExpbmtUZXh0KGltYWdlVG9rZW4uY29udGVudCB8fCBcIlwiKSwgdGl0bGUgPSBpbWFnZVRva2VuLmF0dHJzPy5maW5kKChbbmFtZV0pID0+IG5hbWUgPT09IFwidGl0bGVcIik/LmF0KDEpIHx8IHZvaWQgMCwgYmxvY2tJbWFnZU9iamVjdCA9IGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMuaW1hZ2Uoe1xuICAgICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgICBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLFxuICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsdWU6IHsgc3JjLCBhbHQsIHRpdGxlIH0sXG4gICAgICAgICAgICBpc0lubGluZTogITFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoYmxvY2tJbWFnZU9iamVjdCkge1xuICAgICAgICAgICAgaW5UYWJsZUNlbGwgPyBjdXJyZW50QmxvY2sgJiYgXCJjaGlsZHJlblwiIGluIGN1cnJlbnRCbG9jayAmJiBjdXJyZW50QmxvY2suY2hpbGRyZW4ucHVzaChcbiAgICAgICAgICAgICAgYmxvY2tJbWFnZU9iamVjdFxuICAgICAgICAgICAgKSA6IChjdXJyZW50QmxvY2sgJiYgXCJjaGlsZHJlblwiIGluIGN1cnJlbnRCbG9jayAmJiBjdXJyZW50QmxvY2suY2hpbGRyZW4ubGVuZ3RoID4gMCA/IGZsdXNoQmxvY2soKSA6IChjdXJyZW50QmxvY2sgPSBudWxsLCBjdXJyZW50TWFya0RlZnMgPSBbXSksIHBvcnRhYmxlVGV4dC5wdXNoKGJsb2NrSW1hZ2VPYmplY3QpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBpbmxpbmVJbWFnZU9iamVjdCA9IGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMuaW1hZ2Uoe1xuICAgICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgICBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hLFxuICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsdWU6IHsgc3JjLCBhbHQsIHRpdGxlIH0sXG4gICAgICAgICAgICBpc0lubGluZTogITBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoaW5saW5lSW1hZ2VPYmplY3QpIHtcbiAgICAgICAgICAgIGlmICghY3VycmVudEJsb2NrKVxuICAgICAgICAgICAgICBpZiAoaW5MaXN0SXRlbSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpc3RUeXBlID0gY3VycmVudExpc3RTdGFjay5hdCgtMSk7XG4gICAgICAgICAgICAgICAgbGlzdFR5cGUgJiYgZW5zdXJlTGlzdEJsb2NrKGxpc3RUeXBlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2subm9ybWFsKHtcbiAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3R5bGUgJiYgc3RhcnRCbG9jayhzdHlsZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRCbG9jayAmJiBcImNoaWxkcmVuXCIgaW4gY3VycmVudEJsb2NrICYmIGN1cnJlbnRCbG9jay5jaGlsZHJlbi5wdXNoKFxuICAgICAgICAgICAgICBpbmxpbmVJbWFnZU9iamVjdFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhZGRTcGFuKGAhWyR7YWx0fV0oJHtzcmN9KWApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGRUb2tlbiBvZiB0b2tlbi5jaGlsZHJlbiA/PyBbXSlcbiAgICAgICAgICBzd2l0Y2ggKGNoaWxkVG9rZW4udHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICAgICAgYWRkU3BhbihjaGlsZFRva2VuLmNvbnRlbnQpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzb2Z0YnJlYWtcIjpcbiAgICAgICAgICAgIGNhc2UgXCJoYXJkYnJlYWtcIjpcbiAgICAgICAgICAgICAgYWRkU3BhbihgXG5gKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY29kZV9pbmxpbmVcIjoge1xuICAgICAgICAgICAgICBjb25zdCBkZWNvcmF0b3IgPSBjb25zb2xpZGF0ZWRPcHRpb25zLm1hcmtzLmNvZGUoe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoIWRlY29yYXRvcikge1xuICAgICAgICAgICAgICAgIGFkZFNwYW4oY2hpbGRUb2tlbi5jb250ZW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBtYXJrRGVmUmVmcy5wdXNoKGRlY29yYXRvciksIGFkZFNwYW4oY2hpbGRUb2tlbi5jb250ZW50KTtcbiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBtYXJrRGVmUmVmcy5sYXN0SW5kZXhPZihkZWNvcmF0b3IpO1xuICAgICAgICAgICAgICBpbmRleCAhPT0gLTEgJiYgbWFya0RlZlJlZnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwic3Ryb25nX29wZW5cIjoge1xuICAgICAgICAgICAgICBjb25zdCBkZWNvcmF0b3IgPSBjb25zb2xpZGF0ZWRPcHRpb25zLm1hcmtzLnN0cm9uZyh7XG4gICAgICAgICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGlmICghZGVjb3JhdG9yKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBtYXJrRGVmUmVmcy5wdXNoKGRlY29yYXRvcik7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcInN0cm9uZ19jbG9zZVwiOiB7XG4gICAgICAgICAgICAgIGNvbnN0IGRlY29yYXRvciA9IGNvbnNvbGlkYXRlZE9wdGlvbnMubWFya3Muc3Ryb25nKHtcbiAgICAgICAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKCFkZWNvcmF0b3IpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gbWFya0RlZlJlZnMubGFzdEluZGV4T2YoZGVjb3JhdG9yKTtcbiAgICAgICAgICAgICAgaW5kZXggIT09IC0xICYmIG1hcmtEZWZSZWZzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImVtX29wZW5cIjoge1xuICAgICAgICAgICAgICBjb25zdCBkZWNvcmF0b3IgPSBjb25zb2xpZGF0ZWRPcHRpb25zLm1hcmtzLmVtKHtcbiAgICAgICAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKCFkZWNvcmF0b3IpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIG1hcmtEZWZSZWZzLnB1c2goZGVjb3JhdG9yKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiZW1fY2xvc2VcIjoge1xuICAgICAgICAgICAgICBjb25zdCBkZWNvcmF0b3IgPSBjb25zb2xpZGF0ZWRPcHRpb25zLm1hcmtzLmVtKHtcbiAgICAgICAgICAgICAgICBjb250ZXh0OiB7IHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKCFkZWNvcmF0b3IpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gbWFya0RlZlJlZnMubGFzdEluZGV4T2YoZGVjb3JhdG9yKTtcbiAgICAgICAgICAgICAgaW5kZXggIT09IC0xICYmIG1hcmtEZWZSZWZzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcInNfb3BlblwiOiB7XG4gICAgICAgICAgICAgIGNvbnN0IGRlY29yYXRvciA9IGNvbnNvbGlkYXRlZE9wdGlvbnMubWFya3Muc3RyaWtlVGhyb3VnaCh7XG4gICAgICAgICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGlmICghZGVjb3JhdG9yKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBtYXJrRGVmUmVmcy5wdXNoKGRlY29yYXRvcik7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcInNfY2xvc2VcIjoge1xuICAgICAgICAgICAgICBjb25zdCBkZWNvcmF0b3IgPSBjb25zb2xpZGF0ZWRPcHRpb25zLm1hcmtzLnN0cmlrZVRocm91Z2goe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoIWRlY29yYXRvcilcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBtYXJrRGVmUmVmcy5sYXN0SW5kZXhPZihkZWNvcmF0b3IpO1xuICAgICAgICAgICAgICBpbmRleCAhPT0gLTEgJiYgbWFya0RlZlJlZnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwibGlua19vcGVuXCI6IHtcbiAgICAgICAgICAgICAgY29uc3QgaHJlZiA9IGNoaWxkVG9rZW4uYXR0cnM/LmZpbmQoKFtuYW1lXSkgPT4gbmFtZSA9PT0gXCJocmVmXCIpPy5hdCgxKTtcbiAgICAgICAgICAgICAgaWYgKCFocmVmKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjb25zdCB0aXRsZSA9IGNoaWxkVG9rZW4uYXR0cnM/LmZpbmQoKFtuYW1lXSkgPT4gbmFtZSA9PT0gXCJ0aXRsZVwiKT8uYXQoMSksIGxpbmtPYmplY3QgPSBjb25zb2xpZGF0ZWRPcHRpb25zLm1hcmtzLmxpbmsoe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAgIHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEsXG4gICAgICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeyBocmVmLCB0aXRsZSB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoIWxpbmtPYmplY3QpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGN1cnJlbnRNYXJrRGVmcy5wdXNoKGxpbmtPYmplY3QpLCBtYXJrRGVmUmVmcy5wdXNoKGxpbmtPYmplY3QuX2tleSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImxpbmtfY2xvc2VcIjoge1xuICAgICAgICAgICAgICBjb25zdCBtYXJrRGVmS2V5cyA9IG5ldyBTZXQoY3VycmVudE1hcmtEZWZzLm1hcCgoZCkgPT4gZC5fa2V5KSk7XG4gICAgICAgICAgICAgIGxldCBsYXN0TGlua0luZGV4O1xuICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1hcmtEZWZSZWYgb2YgbWFya0RlZlJlZnMucmV2ZXJzZSgpKVxuICAgICAgICAgICAgICAgIGlmIChtYXJrRGVmS2V5cy5oYXMobWFya0RlZlJlZikpIHtcbiAgICAgICAgICAgICAgICAgIGxhc3RMaW5rSW5kZXggPSBtYXJrRGVmUmVmcy5pbmRleE9mKG1hcmtEZWZSZWYpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAobGFzdExpbmtJbmRleCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVhbEluZGV4ID0gbWFya0RlZlJlZnMubGVuZ3RoIC0gMSAtIGxhc3RMaW5rSW5kZXg7XG4gICAgICAgICAgICAgICAgbWFya0RlZlJlZnMuc3BsaWNlKHJlYWxJbmRleCwgMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiaW1hZ2VcIjoge1xuICAgICAgICAgICAgICBjb25zdCBzcmMgPSBjaGlsZFRva2VuLmF0dHJzPy5maW5kKChbbmFtZV0pID0+IG5hbWUgPT09IFwic3JjXCIpPy5hdCgxKSB8fCBcIlwiLCBhbHQgPSB1bmVzY2FwZUltYWdlQW5kTGlua1RleHQoY2hpbGRUb2tlbi5jb250ZW50IHx8IFwiXCIpLCBpbmxpbmVJbWFnZU9iamVjdCA9IGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMuaW1hZ2Uoe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAgIHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEsXG4gICAgICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeyBzcmMsIGFsdCwgdGl0bGU6IHZvaWQgMCB9LFxuICAgICAgICAgICAgICAgIGlzSW5saW5lOiAhMFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKGlubGluZUltYWdlT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50QmxvY2spIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHN0eWxlMiA9IGNvbnNvbGlkYXRlZE9wdGlvbnMuYmxvY2subm9ybWFsKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogeyBzY2hlbWE6IGNvbnNvbGlkYXRlZE9wdGlvbnMuc2NoZW1hIH1cbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgc3R5bGUyID8gc3RhcnRCbG9jayhzdHlsZTIpIDogKGNvbnNvbGUud2FybignTm8gZGVmYXVsdCBzdHlsZSBmb3VuZCwgdXNpbmcgXCJub3JtYWxcIicpLCBzdGFydEJsb2NrKFwibm9ybWFsXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50QmxvY2spXG4gICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFeHBlY3RlZCBjdXJyZW50IGJsb2NrIGFmdGVyIHN0YXJ0QmxvY2tcIik7XG4gICAgICAgICAgICAgICAgY3VycmVudEJsb2NrLmNoaWxkcmVuLnB1c2goXG4gICAgICAgICAgICAgICAgICBpbmxpbmVJbWFnZU9iamVjdFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgYmxvY2tJbWFnZU9iamVjdCA9IGNvbnNvbGlkYXRlZE9wdGlvbnMudHlwZXMuaW1hZ2Uoe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAgIHNjaGVtYTogY29uc29saWRhdGVkT3B0aW9ucy5zY2hlbWEsXG4gICAgICAgICAgICAgICAgICBrZXlHZW5lcmF0b3I6IGNvbnNvbGlkYXRlZE9wdGlvbnMua2V5R2VuZXJhdG9yXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeyBzcmMsIGFsdCwgdGl0bGU6IHZvaWQgMCB9LFxuICAgICAgICAgICAgICAgIGlzSW5saW5lOiAhMVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKCFibG9ja0ltYWdlT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgYWRkU3BhbihgIVske2FsdH1dKCR7c3JjfSlgKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoaW5UYWJsZUNlbGwpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2sgJiYgXCJjaGlsZHJlblwiIGluIGN1cnJlbnRCbG9jayAmJiBjdXJyZW50QmxvY2suY2hpbGRyZW4ucHVzaChcbiAgICAgICAgICAgICAgICAgIGJsb2NrSW1hZ2VPYmplY3RcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGZsdXNoQmxvY2soKSwgcG9ydGFibGVUZXh0LnB1c2goYmxvY2tJbWFnZU9iamVjdCk7XG4gICAgICAgICAgICAgIGNvbnN0IHN0eWxlID0gY29uc29saWRhdGVkT3B0aW9ucy5ibG9jay5ub3JtYWwoe1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IHsgc2NoZW1hOiBjb25zb2xpZGF0ZWRPcHRpb25zLnNjaGVtYSB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBzdHlsZSAmJiBzdGFydEJsb2NrKHN0eWxlKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiaHRtbF9pbmxpbmVcIjoge1xuICAgICAgICAgICAgICBjb25zb2xpZGF0ZWRPcHRpb25zLmh0bWwuaW5saW5lID09PSBcInRleHRcIiAmJiBhZGRTcGFuKGNoaWxkVG9rZW4uY29udGVudCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICByZXR1cm4gZmx1c2hCbG9jaygpLCBwb3J0YWJsZVRleHQ7XG59XG5leHBvcnQge1xuICBEZWZhdWx0QmxvY2tTcGFjaW5nUmVuZGVyZXIsXG4gIERlZmF1bHRCbG9ja3F1b3RlUmVuZGVyZXIsXG4gIERlZmF1bHRDb2RlQmxvY2tSZW5kZXJlcixcbiAgRGVmYXVsdENvZGVSZW5kZXJlcixcbiAgRGVmYXVsdEVtUmVuZGVyZXIsXG4gIERlZmF1bHRIMVJlbmRlcmVyLFxuICBEZWZhdWx0SDJSZW5kZXJlcixcbiAgRGVmYXVsdEgzUmVuZGVyZXIsXG4gIERlZmF1bHRINFJlbmRlcmVyLFxuICBEZWZhdWx0SDVSZW5kZXJlcixcbiAgRGVmYXVsdEg2UmVuZGVyZXIsXG4gIERlZmF1bHRIYXJkQnJlYWtSZW5kZXJlcixcbiAgRGVmYXVsdEhvcml6b250YWxSdWxlUmVuZGVyZXIsXG4gIERlZmF1bHRIdG1sUmVuZGVyZXIsXG4gIERlZmF1bHRJbWFnZVJlbmRlcmVyLFxuICBEZWZhdWx0TGlua1JlbmRlcmVyLFxuICBEZWZhdWx0TGlzdEl0ZW1SZW5kZXJlcixcbiAgRGVmYXVsdE5vcm1hbFJlbmRlcmVyLFxuICBEZWZhdWx0U3RyaWtlVGhyb3VnaFJlbmRlcmVyLFxuICBEZWZhdWx0U3Ryb25nUmVuZGVyZXIsXG4gIERlZmF1bHRUYWJsZVJlbmRlcmVyLFxuICBEZWZhdWx0VW5kZXJsaW5lUmVuZGVyZXIsXG4gIG1hcmtkb3duVG9Qb3J0YWJsZVRleHQsXG4gIHBvcnRhYmxlVGV4dFRvTWFya2Rvd25cbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/markdown/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/patches/dist/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/@portabletext/patches/dist/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyAll: () => (/* binding */ applyAll),\n/* harmony export */   diffMatchPatch: () => (/* binding */ diffMatchPatch),\n/* harmony export */   insert: () => (/* binding */ insert),\n/* harmony export */   prefixPath: () => (/* binding */ prefixPath),\n/* harmony export */   set: () => (/* binding */ set),\n/* harmony export */   setIfMissing: () => (/* binding */ setIfMissing),\n/* harmony export */   unset: () => (/* binding */ unset)\n/* harmony export */ });\n/* harmony import */ var _sanity_diff_match_patch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @sanity/diff-match-patch */ \"(ssr)/./node_modules/@sanity/diff-match-patch/dist/index.js\");\n\nconst BEFORE = \"before\", AFTER = \"after\";\nfunction insert$1(array, position, index, ...args) {\n  if (position !== BEFORE && position !== AFTER)\n    throw new Error(\n      `Invalid position \"${position}\", must be either ${BEFORE} or ${AFTER}`\n    );\n  const items = flatten(...args);\n  if (array.length === 0)\n    return items;\n  const len = array.length, idx = Math.abs((len + index) % len) % len, normalizedIdx = position === \"after\" ? idx + 1 : idx, copy = array.slice();\n  return copy.splice(normalizedIdx, 0, ...flatten(items)), copy;\n}\nfunction flatten(...values) {\n  return values.reduce((prev, item) => prev.concat(item), []);\n}\nfunction isKeyedSegment(segment) {\n  return typeof segment == \"object\" && segment !== null && \"_key\" in segment;\n}\nfunction findTargetIndex(array, pathSegment) {\n  if (typeof pathSegment == \"number\")\n    return pathSegment;\n  if (isKeyedSegment(pathSegment)) {\n    const index = array.findIndex((item) => item._key === pathSegment._key);\n    return index === -1 ? !1 : index;\n  }\n  return !1;\n}\nfunction applyPatchToArray(value, patch) {\n  const nextValue = value.slice();\n  if (patch.path.length === 0) {\n    if (patch.type === \"setIfMissing\") {\n      if (!Array.isArray(patch.value))\n        throw new Error(\"Cannot set value of an array to a non-array\");\n      return value === void 0 ? patch.value : value;\n    }\n    if (patch.type === \"set\") {\n      if (!Array.isArray(patch.value))\n        throw new Error(\"Cannot set value of an array to a non-array\");\n      return patch.value;\n    }\n    if (patch.type === \"unset\")\n      return;\n    throw new Error(`Invalid array operation: ${patch.type}`);\n  }\n  const [head, ...tail] = patch.path, index = findTargetIndex(value, head);\n  if (index === !1)\n    return nextValue;\n  if (tail.length === 0) {\n    if (patch.type === \"insert\") {\n      const { position, items } = patch;\n      return insert$1(value, position, index, items);\n    } else if (patch.type === \"unset\") {\n      if (typeof index != \"number\")\n        throw new Error(\n          `Expected array index to be a number, instead got \"${index}\"`\n        );\n      return nextValue.splice(index, 1), nextValue;\n    }\n  }\n  return nextValue[index] = applyPatch(nextValue[index], {\n    ...patch,\n    path: tail\n  }), nextValue;\n}\nfunction applyPatchToNumber(value, patch) {\n  if (patch.path.length > 0)\n    throw new Error(\n      `Cannot apply deep operations on primitive values. Received patch with type \"${patch.type}\" and path \"${patch.path.map((path) => JSON.stringify(path)).join(\".\")} that targeted the value \"${JSON.stringify(value)}\"`\n    );\n  if (patch.type === \"set\")\n    return patch.value;\n  if (patch.type === \"setIfMissing\")\n    return value === void 0 ? patch.value : value;\n  if (patch.type !== \"unset\") {\n    if (patch.type === \"inc\") {\n      if (typeof patch.value != \"number\")\n        throw new Error(\"Cannot increment with a non-number\");\n      return value + patch.value;\n    }\n    if (patch.type === \"dec\") {\n      if (typeof patch.value != \"number\")\n        throw new Error(\"Cannot decrement with a non-number\");\n      return value - patch.value;\n    }\n    throw new Error(\n      `Received patch of unsupported type: \"${JSON.stringify(\n        patch.type\n      )}\" for number. This is most likely a bug.`\n    );\n  }\n}\nfunction applyPatchToObject(value, patch) {\n  const nextValue = { ...value };\n  if (patch.path.length === 0) {\n    if (patch.type === \"set\") {\n      if (typeof patch.value == \"object\" && patch.value !== null && !Array.isArray(patch.value))\n        return patch.value;\n      throw new Error(\"Cannot set value of an object to a non-object\");\n    }\n    if (patch.type === \"setIfMissing\") {\n      if (typeof patch.value == \"object\" && patch.value !== null && !Array.isArray(patch.value))\n        return value;\n      throw new Error(\"Cannot setIfMissing value of an object to a non-object\");\n    }\n    if (patch.type === \"unset\")\n      return;\n    throw new Error(`Invalid object operation: ${patch.type}`);\n  }\n  const [head, ...tail] = patch.path;\n  if (typeof head != \"string\")\n    throw new Error(`Expected field name to be a string, instead got: ${head}`);\n  if (tail.length === 0 && patch.type === \"unset\") {\n    const { [head]: _, ...rest } = nextValue;\n    return rest;\n  }\n  return !(head in nextValue) && tail.length > 0 || (nextValue[head] = applyPatch(nextValue[head], {\n    ...patch,\n    path: tail\n  })), nextValue;\n}\nfunction applyPatchToUnknown(value, patch) {\n  if (patch.path.length > 0)\n    throw new Error(\n      `Cannot apply deep operations on primitive values. Received patch with type \"${patch.type}\" and path \"${patch.path.map((path) => JSON.stringify(path)).join(\".\")} that targeted the value \"${JSON.stringify(value)}\"`\n    );\n  if (patch.type === \"set\")\n    return patch.value;\n  if (patch.type === \"setIfMissing\")\n    return value === void 0 ? patch.value : value;\n  if (patch.type !== \"unset\")\n    throw new Error(\n      `Received patch of unsupported type: \"${JSON.stringify(\n        patch.type\n      )}\" for primitives. This is most likely a bug.`\n    );\n}\nfunction applyPatchToString(value, patch) {\n  if (patch.path.length > 0)\n    throw new Error(\n      `Cannot apply deep operations on string values. Received patch with type \"${patch.type}\" and path \"${patch.path.join(\".\")} that targeted the value \"${JSON.stringify(value)}\"`\n    );\n  if (patch.type === \"diffMatchPatch\") {\n    const [result] = (0,_sanity_diff_match_patch__WEBPACK_IMPORTED_MODULE_0__.applyPatches)((0,_sanity_diff_match_patch__WEBPACK_IMPORTED_MODULE_0__.parsePatch)(patch.value), value, {\n      allowExceedingIndices: !0\n    });\n    return result;\n  }\n  if (patch.type === \"setIfMissing\")\n    return value === void 0 ? patch.value : value;\n  if (patch.type === \"set\")\n    return patch.value;\n  if (patch.type !== \"unset\")\n    throw new Error(\n      `Received patch of unsupported type: \"${JSON.stringify(\n        patch.type\n      )}\" for string. This is most likely a bug.`\n    );\n}\nfunction applyAll(value, patches) {\n  return patches.reduce(applyPatch, value);\n}\nfunction applyPatch(value, patch) {\n  return Array.isArray(value) ? applyPatchToArray(value, patch) : typeof value == \"string\" ? applyPatchToString(value, patch) : isObject(value) ? applyPatchToObject(value, patch) : typeof value == \"number\" ? applyPatchToNumber(value, patch) : applyPatchToUnknown(value, patch);\n}\nfunction isObject(value) {\n  return typeof value == \"object\" && value !== null && !Array.isArray(value);\n}\nfunction setIfMissing(value, path = []) {\n  return {\n    type: \"setIfMissing\",\n    path,\n    value\n  };\n}\nfunction diffMatchPatch(currentValue, nextValue, path = []) {\n  const patches = (0,_sanity_diff_match_patch__WEBPACK_IMPORTED_MODULE_0__.makePatches)(currentValue, nextValue), patch = (0,_sanity_diff_match_patch__WEBPACK_IMPORTED_MODULE_0__.stringifyPatches)(patches);\n  return { type: \"diffMatchPatch\", path, value: patch };\n}\nfunction insert(items, position, path = []) {\n  return {\n    type: \"insert\",\n    path,\n    position,\n    items\n  };\n}\nfunction set(value, path = []) {\n  return { type: \"set\", path, value };\n}\nfunction unset(path = []) {\n  return { type: \"unset\", path };\n}\nfunction prefixPath(patch, segment) {\n  return {\n    ...patch,\n    path: [segment, ...patch.path]\n  };\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wYXRjaGVzL2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBbUc7QUFDbkc7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsU0FBUyxvQkFBb0IsUUFBUSxLQUFLLE1BQU07QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsV0FBVztBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGtCQUFrQjtBQUNoQztBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsK0RBQStELE1BQU07QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRkFBcUYsV0FBVyxjQUFjLDBEQUEwRCwyQkFBMkIsc0JBQXNCO0FBQ3pOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsV0FBVztBQUM1RDtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsS0FBSztBQUM3RTtBQUNBLFlBQVkscUJBQXFCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRkFBcUYsV0FBVyxjQUFjLDBEQUEwRCwyQkFBMkIsc0JBQXNCO0FBQ3pOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRkFBa0YsV0FBVyxjQUFjLHNCQUFzQiwyQkFBMkIsc0JBQXNCO0FBQ2xMO0FBQ0E7QUFDQSxxQkFBcUIsc0VBQVksQ0FBQyxvRUFBVTtBQUM1QztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHFFQUFXLG1DQUFtQywwRUFBZ0I7QUFDaEYsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFTRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wYXRjaGVzL2Rpc3QvaW5kZXguanM/ZTI0YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcHBseVBhdGNoZXMsIHBhcnNlUGF0Y2gsIG1ha2VQYXRjaGVzLCBzdHJpbmdpZnlQYXRjaGVzIH0gZnJvbSBcIkBzYW5pdHkvZGlmZi1tYXRjaC1wYXRjaFwiO1xuY29uc3QgQkVGT1JFID0gXCJiZWZvcmVcIiwgQUZURVIgPSBcImFmdGVyXCI7XG5mdW5jdGlvbiBpbnNlcnQkMShhcnJheSwgcG9zaXRpb24sIGluZGV4LCAuLi5hcmdzKSB7XG4gIGlmIChwb3NpdGlvbiAhPT0gQkVGT1JFICYmIHBvc2l0aW9uICE9PSBBRlRFUilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgSW52YWxpZCBwb3NpdGlvbiBcIiR7cG9zaXRpb259XCIsIG11c3QgYmUgZWl0aGVyICR7QkVGT1JFfSBvciAke0FGVEVSfWBcbiAgICApO1xuICBjb25zdCBpdGVtcyA9IGZsYXR0ZW4oLi4uYXJncyk7XG4gIGlmIChhcnJheS5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIGl0ZW1zO1xuICBjb25zdCBsZW4gPSBhcnJheS5sZW5ndGgsIGlkeCA9IE1hdGguYWJzKChsZW4gKyBpbmRleCkgJSBsZW4pICUgbGVuLCBub3JtYWxpemVkSWR4ID0gcG9zaXRpb24gPT09IFwiYWZ0ZXJcIiA/IGlkeCArIDEgOiBpZHgsIGNvcHkgPSBhcnJheS5zbGljZSgpO1xuICByZXR1cm4gY29weS5zcGxpY2Uobm9ybWFsaXplZElkeCwgMCwgLi4uZmxhdHRlbihpdGVtcykpLCBjb3B5O1xufVxuZnVuY3Rpb24gZmxhdHRlbiguLi52YWx1ZXMpIHtcbiAgcmV0dXJuIHZhbHVlcy5yZWR1Y2UoKHByZXYsIGl0ZW0pID0+IHByZXYuY29uY2F0KGl0ZW0pLCBbXSk7XG59XG5mdW5jdGlvbiBpc0tleWVkU2VnbWVudChzZWdtZW50KSB7XG4gIHJldHVybiB0eXBlb2Ygc2VnbWVudCA9PSBcIm9iamVjdFwiICYmIHNlZ21lbnQgIT09IG51bGwgJiYgXCJfa2V5XCIgaW4gc2VnbWVudDtcbn1cbmZ1bmN0aW9uIGZpbmRUYXJnZXRJbmRleChhcnJheSwgcGF0aFNlZ21lbnQpIHtcbiAgaWYgKHR5cGVvZiBwYXRoU2VnbWVudCA9PSBcIm51bWJlclwiKVxuICAgIHJldHVybiBwYXRoU2VnbWVudDtcbiAgaWYgKGlzS2V5ZWRTZWdtZW50KHBhdGhTZWdtZW50KSkge1xuICAgIGNvbnN0IGluZGV4ID0gYXJyYXkuZmluZEluZGV4KChpdGVtKSA9PiBpdGVtLl9rZXkgPT09IHBhdGhTZWdtZW50Ll9rZXkpO1xuICAgIHJldHVybiBpbmRleCA9PT0gLTEgPyAhMSA6IGluZGV4O1xuICB9XG4gIHJldHVybiAhMTtcbn1cbmZ1bmN0aW9uIGFwcGx5UGF0Y2hUb0FycmF5KHZhbHVlLCBwYXRjaCkge1xuICBjb25zdCBuZXh0VmFsdWUgPSB2YWx1ZS5zbGljZSgpO1xuICBpZiAocGF0Y2gucGF0aC5sZW5ndGggPT09IDApIHtcbiAgICBpZiAocGF0Y2gudHlwZSA9PT0gXCJzZXRJZk1pc3NpbmdcIikge1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGNoLnZhbHVlKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNldCB2YWx1ZSBvZiBhbiBhcnJheSB0byBhIG5vbi1hcnJheVwiKTtcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdm9pZCAwID8gcGF0Y2gudmFsdWUgOiB2YWx1ZTtcbiAgICB9XG4gICAgaWYgKHBhdGNoLnR5cGUgPT09IFwic2V0XCIpIHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShwYXRjaC52YWx1ZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgdmFsdWUgb2YgYW4gYXJyYXkgdG8gYSBub24tYXJyYXlcIik7XG4gICAgICByZXR1cm4gcGF0Y2gudmFsdWU7XG4gICAgfVxuICAgIGlmIChwYXRjaC50eXBlID09PSBcInVuc2V0XCIpXG4gICAgICByZXR1cm47XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGFycmF5IG9wZXJhdGlvbjogJHtwYXRjaC50eXBlfWApO1xuICB9XG4gIGNvbnN0IFtoZWFkLCAuLi50YWlsXSA9IHBhdGNoLnBhdGgsIGluZGV4ID0gZmluZFRhcmdldEluZGV4KHZhbHVlLCBoZWFkKTtcbiAgaWYgKGluZGV4ID09PSAhMSlcbiAgICByZXR1cm4gbmV4dFZhbHVlO1xuICBpZiAodGFpbC5sZW5ndGggPT09IDApIHtcbiAgICBpZiAocGF0Y2gudHlwZSA9PT0gXCJpbnNlcnRcIikge1xuICAgICAgY29uc3QgeyBwb3NpdGlvbiwgaXRlbXMgfSA9IHBhdGNoO1xuICAgICAgcmV0dXJuIGluc2VydCQxKHZhbHVlLCBwb3NpdGlvbiwgaW5kZXgsIGl0ZW1zKTtcbiAgICB9IGVsc2UgaWYgKHBhdGNoLnR5cGUgPT09IFwidW5zZXRcIikge1xuICAgICAgaWYgKHR5cGVvZiBpbmRleCAhPSBcIm51bWJlclwiKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEV4cGVjdGVkIGFycmF5IGluZGV4IHRvIGJlIGEgbnVtYmVyLCBpbnN0ZWFkIGdvdCBcIiR7aW5kZXh9XCJgXG4gICAgICAgICk7XG4gICAgICByZXR1cm4gbmV4dFZhbHVlLnNwbGljZShpbmRleCwgMSksIG5leHRWYWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5leHRWYWx1ZVtpbmRleF0gPSBhcHBseVBhdGNoKG5leHRWYWx1ZVtpbmRleF0sIHtcbiAgICAuLi5wYXRjaCxcbiAgICBwYXRoOiB0YWlsXG4gIH0pLCBuZXh0VmFsdWU7XG59XG5mdW5jdGlvbiBhcHBseVBhdGNoVG9OdW1iZXIodmFsdWUsIHBhdGNoKSB7XG4gIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA+IDApXG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYENhbm5vdCBhcHBseSBkZWVwIG9wZXJhdGlvbnMgb24gcHJpbWl0aXZlIHZhbHVlcy4gUmVjZWl2ZWQgcGF0Y2ggd2l0aCB0eXBlIFwiJHtwYXRjaC50eXBlfVwiIGFuZCBwYXRoIFwiJHtwYXRjaC5wYXRoLm1hcCgocGF0aCkgPT4gSlNPTi5zdHJpbmdpZnkocGF0aCkpLmpvaW4oXCIuXCIpfSB0aGF0IHRhcmdldGVkIHRoZSB2YWx1ZSBcIiR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfVwiYFxuICAgICk7XG4gIGlmIChwYXRjaC50eXBlID09PSBcInNldFwiKVxuICAgIHJldHVybiBwYXRjaC52YWx1ZTtcbiAgaWYgKHBhdGNoLnR5cGUgPT09IFwic2V0SWZNaXNzaW5nXCIpXG4gICAgcmV0dXJuIHZhbHVlID09PSB2b2lkIDAgPyBwYXRjaC52YWx1ZSA6IHZhbHVlO1xuICBpZiAocGF0Y2gudHlwZSAhPT0gXCJ1bnNldFwiKSB7XG4gICAgaWYgKHBhdGNoLnR5cGUgPT09IFwiaW5jXCIpIHtcbiAgICAgIGlmICh0eXBlb2YgcGF0Y2gudmFsdWUgIT0gXCJudW1iZXJcIilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGluY3JlbWVudCB3aXRoIGEgbm9uLW51bWJlclwiKTtcbiAgICAgIHJldHVybiB2YWx1ZSArIHBhdGNoLnZhbHVlO1xuICAgIH1cbiAgICBpZiAocGF0Y2gudHlwZSA9PT0gXCJkZWNcIikge1xuICAgICAgaWYgKHR5cGVvZiBwYXRjaC52YWx1ZSAhPSBcIm51bWJlclwiKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZGVjcmVtZW50IHdpdGggYSBub24tbnVtYmVyXCIpO1xuICAgICAgcmV0dXJuIHZhbHVlIC0gcGF0Y2gudmFsdWU7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBSZWNlaXZlZCBwYXRjaCBvZiB1bnN1cHBvcnRlZCB0eXBlOiBcIiR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHBhdGNoLnR5cGVcbiAgICAgICl9XCIgZm9yIG51bWJlci4gVGhpcyBpcyBtb3N0IGxpa2VseSBhIGJ1Zy5gXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gYXBwbHlQYXRjaFRvT2JqZWN0KHZhbHVlLCBwYXRjaCkge1xuICBjb25zdCBuZXh0VmFsdWUgPSB7IC4uLnZhbHVlIH07XG4gIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMCkge1xuICAgIGlmIChwYXRjaC50eXBlID09PSBcInNldFwiKSB7XG4gICAgICBpZiAodHlwZW9mIHBhdGNoLnZhbHVlID09IFwib2JqZWN0XCIgJiYgcGF0Y2gudmFsdWUgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkocGF0Y2gudmFsdWUpKVxuICAgICAgICByZXR1cm4gcGF0Y2gudmFsdWU7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IHZhbHVlIG9mIGFuIG9iamVjdCB0byBhIG5vbi1vYmplY3RcIik7XG4gICAgfVxuICAgIGlmIChwYXRjaC50eXBlID09PSBcInNldElmTWlzc2luZ1wiKSB7XG4gICAgICBpZiAodHlwZW9mIHBhdGNoLnZhbHVlID09IFwib2JqZWN0XCIgJiYgcGF0Y2gudmFsdWUgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkocGF0Y2gudmFsdWUpKVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0SWZNaXNzaW5nIHZhbHVlIG9mIGFuIG9iamVjdCB0byBhIG5vbi1vYmplY3RcIik7XG4gICAgfVxuICAgIGlmIChwYXRjaC50eXBlID09PSBcInVuc2V0XCIpXG4gICAgICByZXR1cm47XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG9iamVjdCBvcGVyYXRpb246ICR7cGF0Y2gudHlwZX1gKTtcbiAgfVxuICBjb25zdCBbaGVhZCwgLi4udGFpbF0gPSBwYXRjaC5wYXRoO1xuICBpZiAodHlwZW9mIGhlYWQgIT0gXCJzdHJpbmdcIilcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGZpZWxkIG5hbWUgdG8gYmUgYSBzdHJpbmcsIGluc3RlYWQgZ290OiAke2hlYWR9YCk7XG4gIGlmICh0YWlsLmxlbmd0aCA9PT0gMCAmJiBwYXRjaC50eXBlID09PSBcInVuc2V0XCIpIHtcbiAgICBjb25zdCB7IFtoZWFkXTogXywgLi4ucmVzdCB9ID0gbmV4dFZhbHVlO1xuICAgIHJldHVybiByZXN0O1xuICB9XG4gIHJldHVybiAhKGhlYWQgaW4gbmV4dFZhbHVlKSAmJiB0YWlsLmxlbmd0aCA+IDAgfHwgKG5leHRWYWx1ZVtoZWFkXSA9IGFwcGx5UGF0Y2gobmV4dFZhbHVlW2hlYWRdLCB7XG4gICAgLi4ucGF0Y2gsXG4gICAgcGF0aDogdGFpbFxuICB9KSksIG5leHRWYWx1ZTtcbn1cbmZ1bmN0aW9uIGFwcGx5UGF0Y2hUb1Vua25vd24odmFsdWUsIHBhdGNoKSB7XG4gIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA+IDApXG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYENhbm5vdCBhcHBseSBkZWVwIG9wZXJhdGlvbnMgb24gcHJpbWl0aXZlIHZhbHVlcy4gUmVjZWl2ZWQgcGF0Y2ggd2l0aCB0eXBlIFwiJHtwYXRjaC50eXBlfVwiIGFuZCBwYXRoIFwiJHtwYXRjaC5wYXRoLm1hcCgocGF0aCkgPT4gSlNPTi5zdHJpbmdpZnkocGF0aCkpLmpvaW4oXCIuXCIpfSB0aGF0IHRhcmdldGVkIHRoZSB2YWx1ZSBcIiR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfVwiYFxuICAgICk7XG4gIGlmIChwYXRjaC50eXBlID09PSBcInNldFwiKVxuICAgIHJldHVybiBwYXRjaC52YWx1ZTtcbiAgaWYgKHBhdGNoLnR5cGUgPT09IFwic2V0SWZNaXNzaW5nXCIpXG4gICAgcmV0dXJuIHZhbHVlID09PSB2b2lkIDAgPyBwYXRjaC52YWx1ZSA6IHZhbHVlO1xuICBpZiAocGF0Y2gudHlwZSAhPT0gXCJ1bnNldFwiKVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBSZWNlaXZlZCBwYXRjaCBvZiB1bnN1cHBvcnRlZCB0eXBlOiBcIiR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHBhdGNoLnR5cGVcbiAgICAgICl9XCIgZm9yIHByaW1pdGl2ZXMuIFRoaXMgaXMgbW9zdCBsaWtlbHkgYSBidWcuYFxuICAgICk7XG59XG5mdW5jdGlvbiBhcHBseVBhdGNoVG9TdHJpbmcodmFsdWUsIHBhdGNoKSB7XG4gIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA+IDApXG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYENhbm5vdCBhcHBseSBkZWVwIG9wZXJhdGlvbnMgb24gc3RyaW5nIHZhbHVlcy4gUmVjZWl2ZWQgcGF0Y2ggd2l0aCB0eXBlIFwiJHtwYXRjaC50eXBlfVwiIGFuZCBwYXRoIFwiJHtwYXRjaC5wYXRoLmpvaW4oXCIuXCIpfSB0aGF0IHRhcmdldGVkIHRoZSB2YWx1ZSBcIiR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfVwiYFxuICAgICk7XG4gIGlmIChwYXRjaC50eXBlID09PSBcImRpZmZNYXRjaFBhdGNoXCIpIHtcbiAgICBjb25zdCBbcmVzdWx0XSA9IGFwcGx5UGF0Y2hlcyhwYXJzZVBhdGNoKHBhdGNoLnZhbHVlKSwgdmFsdWUsIHtcbiAgICAgIGFsbG93RXhjZWVkaW5nSW5kaWNlczogITBcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIGlmIChwYXRjaC50eXBlID09PSBcInNldElmTWlzc2luZ1wiKVxuICAgIHJldHVybiB2YWx1ZSA9PT0gdm9pZCAwID8gcGF0Y2gudmFsdWUgOiB2YWx1ZTtcbiAgaWYgKHBhdGNoLnR5cGUgPT09IFwic2V0XCIpXG4gICAgcmV0dXJuIHBhdGNoLnZhbHVlO1xuICBpZiAocGF0Y2gudHlwZSAhPT0gXCJ1bnNldFwiKVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBSZWNlaXZlZCBwYXRjaCBvZiB1bnN1cHBvcnRlZCB0eXBlOiBcIiR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHBhdGNoLnR5cGVcbiAgICAgICl9XCIgZm9yIHN0cmluZy4gVGhpcyBpcyBtb3N0IGxpa2VseSBhIGJ1Zy5gXG4gICAgKTtcbn1cbmZ1bmN0aW9uIGFwcGx5QWxsKHZhbHVlLCBwYXRjaGVzKSB7XG4gIHJldHVybiBwYXRjaGVzLnJlZHVjZShhcHBseVBhdGNoLCB2YWx1ZSk7XG59XG5mdW5jdGlvbiBhcHBseVBhdGNoKHZhbHVlLCBwYXRjaCkge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBhcHBseVBhdGNoVG9BcnJheSh2YWx1ZSwgcGF0Y2gpIDogdHlwZW9mIHZhbHVlID09IFwic3RyaW5nXCIgPyBhcHBseVBhdGNoVG9TdHJpbmcodmFsdWUsIHBhdGNoKSA6IGlzT2JqZWN0KHZhbHVlKSA/IGFwcGx5UGF0Y2hUb09iamVjdCh2YWx1ZSwgcGF0Y2gpIDogdHlwZW9mIHZhbHVlID09IFwibnVtYmVyXCIgPyBhcHBseVBhdGNoVG9OdW1iZXIodmFsdWUsIHBhdGNoKSA6IGFwcGx5UGF0Y2hUb1Vua25vd24odmFsdWUsIHBhdGNoKTtcbn1cbmZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSk7XG59XG5mdW5jdGlvbiBzZXRJZk1pc3NpbmcodmFsdWUsIHBhdGggPSBbXSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwic2V0SWZNaXNzaW5nXCIsXG4gICAgcGF0aCxcbiAgICB2YWx1ZVxuICB9O1xufVxuZnVuY3Rpb24gZGlmZk1hdGNoUGF0Y2goY3VycmVudFZhbHVlLCBuZXh0VmFsdWUsIHBhdGggPSBbXSkge1xuICBjb25zdCBwYXRjaGVzID0gbWFrZVBhdGNoZXMoY3VycmVudFZhbHVlLCBuZXh0VmFsdWUpLCBwYXRjaCA9IHN0cmluZ2lmeVBhdGNoZXMocGF0Y2hlcyk7XG4gIHJldHVybiB7IHR5cGU6IFwiZGlmZk1hdGNoUGF0Y2hcIiwgcGF0aCwgdmFsdWU6IHBhdGNoIH07XG59XG5mdW5jdGlvbiBpbnNlcnQoaXRlbXMsIHBvc2l0aW9uLCBwYXRoID0gW10pIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcImluc2VydFwiLFxuICAgIHBhdGgsXG4gICAgcG9zaXRpb24sXG4gICAgaXRlbXNcbiAgfTtcbn1cbmZ1bmN0aW9uIHNldCh2YWx1ZSwgcGF0aCA9IFtdKSB7XG4gIHJldHVybiB7IHR5cGU6IFwic2V0XCIsIHBhdGgsIHZhbHVlIH07XG59XG5mdW5jdGlvbiB1bnNldChwYXRoID0gW10pIHtcbiAgcmV0dXJuIHsgdHlwZTogXCJ1bnNldFwiLCBwYXRoIH07XG59XG5mdW5jdGlvbiBwcmVmaXhQYXRoKHBhdGNoLCBzZWdtZW50KSB7XG4gIHJldHVybiB7XG4gICAgLi4ucGF0Y2gsXG4gICAgcGF0aDogW3NlZ21lbnQsIC4uLnBhdGNoLnBhdGhdXG4gIH07XG59XG5leHBvcnQge1xuICBhcHBseUFsbCxcbiAgZGlmZk1hdGNoUGF0Y2gsXG4gIGluc2VydCxcbiAgcHJlZml4UGF0aCxcbiAgc2V0LFxuICBzZXRJZk1pc3NpbmcsXG4gIHVuc2V0XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/patches/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/plugin-character-pair-decorator/dist/index.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/@portabletext/plugin-character-pair-decorator/dist/index.js ***!
  \**********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CharacterPairDecoratorPlugin: () => (/* binding */ CharacterPairDecoratorPlugin)\n/* harmony export */ });\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n/* harmony import */ var _portabletext_editor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @portabletext/editor */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\");\n/* harmony import */ var _portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/editor/behaviors */ \"(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js\");\n/* harmony import */ var _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @portabletext/editor/utils */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n/* harmony import */ var _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @portabletext/editor/utils */ \"(ssr)/./node_modules/@portabletext/editor/lib/utils/index.js\");\n/* harmony import */ var _xstate_react__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @xstate/react */ \"(ssr)/./node_modules/@xstate/react/dist/xstate-react.development.esm.js\");\n/* harmony import */ var remeda__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! remeda */ \"(ssr)/./node_modules/remeda/dist/isDeepEqual-jLo35Woq.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/xstate.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/actors/dist/xstate-actors.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/assign-ef1b62f6.development.esm.js\");\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/selectors/index.js\");\n\n\n\n\n\n\n\n\nfunction createCharacterPairRegex(char, amount) {\n  const prePrefix = `(?<!\\\\${char})`, prefix = `\\\\${char}`.repeat(Math.max(amount, 1)), postPrefix = \"(?!\\\\s)\", content = `([^${char}\\\\n]+?)`, preSuffix = \"(?<!\\\\s)\", suffix = `\\\\${char}`.repeat(Math.max(amount, 1)), postSuffix = `(?!\\\\${char})`;\n  return `${prePrefix}${prefix}${postPrefix}${content}${preSuffix}${suffix}${postSuffix}`;\n}\nfunction createCharacterPairDecoratorBehavior(config) {\n  config.pair.amount < 1 && console.warn(\"The amount of characters in the pair should be greater than 0\");\n  const pairRegex = createCharacterPairRegex(config.pair.char, config.pair.amount), regEx = new RegExp(`(${pairRegex})$`);\n  return (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.defineBehavior)({\n    on: \"insert.text\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (config.pair.amount < 1)\n        return !1;\n      const decorator = config.decorator({\n        context: {\n          schema: snapshot.context.schema\n        },\n        schema: snapshot.context.schema\n      });\n      if (decorator === void 0)\n        return !1;\n      const focusTextBlock = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getFocusTextBlock(snapshot), selectionStartPoint = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getSelectionStartPoint(snapshot), selectionStartOffset = selectionStartPoint ? _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_3__.spanSelectionPointToBlockOffset({\n        context: snapshot.context,\n        selectionPoint: selectionStartPoint\n      }) : void 0;\n      if (!focusTextBlock || !selectionStartOffset)\n        return !1;\n      const newText = `${_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getBlockTextBefore(snapshot)}${event.text}`, textToDecorate = newText.match(regEx)?.at(0);\n      if (textToDecorate === void 0)\n        return !1;\n      const prefixOffsets = {\n        anchor: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar**\".length - \"**bar**\".length = 4\n          offset: newText.length - textToDecorate.length\n        },\n        focus: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar**\".length - \"**bar**\".length + \"*\".length * 2 = 6\n          offset: newText.length - textToDecorate.length + config.pair.char.length * config.pair.amount\n        }\n      }, suffixOffsets = {\n        anchor: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar*|\" (10) + \"*\".length - 2 = 9\n          offset: selectionStartOffset.offset + event.text.length - config.pair.char.length * config.pair.amount\n        },\n        focus: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar*|\" (10) + \"*\".length = 11\n          offset: selectionStartOffset.offset + event.text.length\n        }\n      };\n      if (prefixOffsets.focus.offset - prefixOffsets.anchor.offset > 1) {\n        const prefixSelection = _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_5__.blockOffsetsToSelection({\n          context: snapshot.context,\n          offsets: prefixOffsets\n        }), inlineObjectBeforePrefixFocus = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getPreviousInlineObject({\n          ...snapshot,\n          context: {\n            ...snapshot.context,\n            selection: prefixSelection ? {\n              anchor: prefixSelection.focus,\n              focus: prefixSelection.focus\n            } : null\n          }\n        }), inlineObjectBeforePrefixFocusOffset = inlineObjectBeforePrefixFocus ? _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_5__.childSelectionPointToBlockOffset({\n          context: snapshot.context,\n          selectionPoint: {\n            path: inlineObjectBeforePrefixFocus.path,\n            offset: 0\n          }\n        }) : void 0;\n        if (inlineObjectBeforePrefixFocusOffset && inlineObjectBeforePrefixFocusOffset.offset > prefixOffsets.anchor.offset && inlineObjectBeforePrefixFocusOffset.offset < prefixOffsets.focus.offset)\n          return !1;\n      }\n      if (suffixOffsets.focus.offset - suffixOffsets.anchor.offset > 1) {\n        const previousInlineObject = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getPreviousInlineObject(snapshot), previousInlineObjectOffset = previousInlineObject ? _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_5__.childSelectionPointToBlockOffset({\n          context: snapshot.context,\n          selectionPoint: {\n            path: previousInlineObject.path,\n            offset: 0\n          }\n        }) : void 0;\n        if (previousInlineObjectOffset && previousInlineObjectOffset.offset > suffixOffsets.anchor.offset && previousInlineObjectOffset.offset < suffixOffsets.focus.offset)\n          return !1;\n      }\n      return {\n        prefixOffsets,\n        suffixOffsets,\n        decorator\n      };\n    },\n    actions: [\n      // Insert the text as usual in its own undo step\n      ({\n        event\n      }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.forward)(event)],\n      (_, {\n        prefixOffsets,\n        suffixOffsets,\n        decorator\n      }) => [\n        // Decorate the text between the prefix and suffix\n        (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.raise)({\n          type: \"decorator.add\",\n          decorator,\n          at: {\n            anchor: prefixOffsets.focus,\n            focus: suffixOffsets.anchor\n          }\n        }),\n        // Delete the suffix\n        (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.raise)({\n          type: \"delete.text\",\n          at: suffixOffsets\n        }),\n        // Delete the prefix\n        (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.raise)({\n          type: \"delete.text\",\n          at: prefixOffsets\n        }),\n        // Toggle the decorator off so the next inserted text isn't emphasized\n        (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.raise)({\n          type: \"decorator.remove\",\n          decorator\n        }),\n        (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.effect)(() => {\n          config.onDecorate({\n            ...suffixOffsets.anchor,\n            offset: suffixOffsets.anchor.offset - (prefixOffsets.focus.offset - prefixOffsets.anchor.offset)\n          });\n        })\n      ]\n    ]\n  });\n}\nfunction CharacterPairDecoratorPlugin(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__.c)(4), editor = (0,_portabletext_editor__WEBPACK_IMPORTED_MODULE_6__.useEditor)();\n  let t0;\n  return $[0] !== editor || $[1] !== props.decorator || $[2] !== props.pair ? (t0 = {\n    input: {\n      editor,\n      decorator: props.decorator,\n      pair: props.pair\n    }\n  }, $[0] = editor, $[1] = props.decorator, $[2] = props.pair, $[3] = t0) : t0 = $[3], (0,_xstate_react__WEBPACK_IMPORTED_MODULE_7__.useActorRef)(decoratorPairMachine, t0), null;\n}\nconst decorateListener = ({\n  sendBack,\n  input\n}) => input.editor.registerBehavior({\n  behavior: createCharacterPairDecoratorBehavior({\n    decorator: input.decorator,\n    pair: input.pair,\n    onDecorate: (offset) => {\n      sendBack({\n        type: \"decorator.add\",\n        blockOffset: offset\n      });\n    }\n  })\n}), selectionListenerCallback = ({\n  sendBack,\n  input\n}) => input.editor.registerBehavior({\n  behavior: (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.defineBehavior)({\n    on: \"select\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if (!event.at)\n        return {\n          blockOffsets: void 0\n        };\n      const anchor = _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_3__.spanSelectionPointToBlockOffset({\n        context: snapshot.context,\n        selectionPoint: event.at.anchor\n      }), focus = _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_3__.spanSelectionPointToBlockOffset({\n        context: snapshot.context,\n        selectionPoint: event.at.focus\n      });\n      return !anchor || !focus ? {\n        blockOffsets: void 0\n      } : {\n        blockOffsets: {\n          anchor,\n          focus\n        }\n      };\n    },\n    actions: [({\n      event\n    }, {\n      blockOffsets\n    }) => [{\n      type: \"effect\",\n      effect: () => {\n        sendBack({\n          type: \"selection\",\n          blockOffsets\n        });\n      }\n    }, (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.forward)(event)]]\n  })\n}), deleteBackwardListenerCallback = ({\n  sendBack,\n  input\n}) => input.editor.registerBehavior({\n  behavior: (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.defineBehavior)({\n    on: \"delete.backward\",\n    actions: [() => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.raise)({\n      type: \"history.undo\"\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_1__.effect)(() => {\n      sendBack({\n        type: \"delete.backward\"\n      });\n    })]]\n  })\n}), decoratorPairMachine = (0,xstate__WEBPACK_IMPORTED_MODULE_8__.setup)({\n  types: {\n    context: {},\n    input: {},\n    events: {}\n  },\n  actors: {\n    \"decorate listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.fromCallback)(decorateListener),\n    \"delete.backward listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.fromCallback)(deleteBackwardListenerCallback),\n    \"selection listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_9__.fromCallback)(selectionListenerCallback)\n  }\n}).createMachine({\n  id: \"decorator pair\",\n  context: ({\n    input\n  }) => ({\n    decorator: input.decorator,\n    editor: input.editor,\n    pair: input.pair\n  }),\n  initial: \"idle\",\n  states: {\n    idle: {\n      invoke: [{\n        src: \"decorate listener\",\n        input: ({\n          context\n        }) => ({\n          decorator: context.decorator,\n          editor: context.editor,\n          pair: context.pair\n        })\n      }],\n      on: {\n        \"decorator.add\": {\n          target: \"decorator added\",\n          actions: (0,xstate__WEBPACK_IMPORTED_MODULE_10__.a)({\n            offsetAfterDecorator: ({\n              event\n            }) => event.blockOffset\n          })\n        }\n      }\n    },\n    \"decorator added\": {\n      exit: [(0,xstate__WEBPACK_IMPORTED_MODULE_10__.a)({\n        offsetAfterDecorator: void 0\n      })],\n      invoke: [{\n        src: \"selection listener\",\n        input: ({\n          context\n        }) => ({\n          editor: context.editor\n        })\n      }, {\n        src: \"delete.backward listener\",\n        input: ({\n          context\n        }) => ({\n          editor: context.editor\n        })\n      }],\n      on: {\n        selection: {\n          target: \"idle\",\n          guard: ({\n            context,\n            event\n          }) => !(0,remeda__WEBPACK_IMPORTED_MODULE_11__.isDeepEqual)({\n            anchor: context.offsetAfterDecorator,\n            focus: context.offsetAfterDecorator\n          }, event.blockOffsets)\n        },\n        \"delete.backward\": {\n          target: \"idle\"\n        }\n      }\n    }\n  }\n});\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4tY2hhcmFjdGVyLXBhaXItZGVjb3JhdG9yL2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUEyQztBQUNNO0FBQ3VDO0FBQ3BDO0FBQ1I7QUFDUDtBQUNnQjtBQUNPO0FBQzVEO0FBQ0EsNkJBQTZCLEtBQUssa0JBQWtCLEtBQUssdUVBQXVFLEtBQUssZ0RBQWdELEtBQUssb0RBQW9ELEtBQUs7QUFDblAsWUFBWSxVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxXQUFXO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBLDJHQUEyRyxVQUFVO0FBQ3JILFNBQVMsOEVBQWM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsNkJBQTZCLDZFQUEyQixrQ0FBa0Msa0ZBQWdDLHlEQUF5RCx1RkFBcUM7QUFDeE47QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EseUJBQXlCLDhFQUE0QixXQUFXLEVBQUUsV0FBVztBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLCtFQUE2QjtBQUM3RDtBQUNBO0FBQ0EsU0FBUyxtQ0FBbUMsbUZBQWlDO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBLFNBQVMseUVBQXlFLHdGQUFzQztBQUN4SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLG1GQUFpQyxnRUFBZ0Usd0ZBQXNDO0FBQzVLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sTUFBTSx1RUFBTztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLFFBQVEscUVBQUs7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxRQUFRLHFFQUFLO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVEscUVBQUs7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsUUFBUSxxRUFBSztBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsUUFBUSxzRUFBTTtBQUNkO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsWUFBWSx5REFBQyxjQUFjLCtEQUFTO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxvRkFBb0YsMERBQVc7QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxHQUFHO0FBQ0gsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsWUFBWSw4RUFBYztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQix1RkFBcUM7QUFDMUQ7QUFDQTtBQUNBLE9BQU8sV0FBVyx1RkFBcUM7QUFDdkQ7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsS0FBSyxFQUFFLHVFQUFPO0FBQ2QsR0FBRztBQUNILENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNELFlBQVksOEVBQWM7QUFDMUI7QUFDQSxxQkFBcUIscUVBQUs7QUFDMUI7QUFDQSxLQUFLLEdBQUcsc0VBQU07QUFDZDtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCxHQUFHO0FBQ0gsQ0FBQywwQkFBMEIsNkNBQUs7QUFDaEM7QUFDQSxlQUFlO0FBQ2YsYUFBYTtBQUNiO0FBQ0EsR0FBRztBQUNIO0FBQ0EseUJBQXlCLG9EQUFZO0FBQ3JDLGdDQUFnQyxvREFBWTtBQUM1QywwQkFBMEIsb0RBQVk7QUFDdEM7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwwQ0FBTTtBQUN6QjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFdBQVc7QUFDWDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsYUFBYSwwQ0FBTTtBQUNuQjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE1BQU0sb0RBQVc7QUFDNUI7QUFDQTtBQUNBLFdBQVc7QUFDWCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUdDO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L3BsdWdpbi1jaGFyYWN0ZXItcGFpci1kZWNvcmF0b3IvZGlzdC9pbmRleC5qcz9jMzUxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGMgfSBmcm9tIFwicmVhY3QtY29tcGlsZXItcnVudGltZVwiO1xuaW1wb3J0IHsgdXNlRWRpdG9yIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvZWRpdG9yXCI7XG5pbXBvcnQgeyBkZWZpbmVCZWhhdmlvciwgZm9yd2FyZCwgcmFpc2UsIGVmZmVjdCB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L2VkaXRvci9iZWhhdmlvcnNcIjtcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gXCJAcG9ydGFibGV0ZXh0L2VkaXRvci91dGlsc1wiO1xuaW1wb3J0IHsgdXNlQWN0b3JSZWYgfSBmcm9tIFwiQHhzdGF0ZS9yZWFjdFwiO1xuaW1wb3J0IHsgaXNEZWVwRXF1YWwgfSBmcm9tIFwicmVtZWRhXCI7XG5pbXBvcnQgeyBzZXR1cCwgZnJvbUNhbGxiYWNrLCBhc3NpZ24gfSBmcm9tIFwieHN0YXRlXCI7XG5pbXBvcnQgKiBhcyBzZWxlY3RvcnMgZnJvbSBcIkBwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9yc1wiO1xuZnVuY3Rpb24gY3JlYXRlQ2hhcmFjdGVyUGFpclJlZ2V4KGNoYXIsIGFtb3VudCkge1xuICBjb25zdCBwcmVQcmVmaXggPSBgKD88IVxcXFwke2NoYXJ9KWAsIHByZWZpeCA9IGBcXFxcJHtjaGFyfWAucmVwZWF0KE1hdGgubWF4KGFtb3VudCwgMSkpLCBwb3N0UHJlZml4ID0gXCIoPyFcXFxccylcIiwgY29udGVudCA9IGAoW14ke2NoYXJ9XFxcXG5dKz8pYCwgcHJlU3VmZml4ID0gXCIoPzwhXFxcXHMpXCIsIHN1ZmZpeCA9IGBcXFxcJHtjaGFyfWAucmVwZWF0KE1hdGgubWF4KGFtb3VudCwgMSkpLCBwb3N0U3VmZml4ID0gYCg/IVxcXFwke2NoYXJ9KWA7XG4gIHJldHVybiBgJHtwcmVQcmVmaXh9JHtwcmVmaXh9JHtwb3N0UHJlZml4fSR7Y29udGVudH0ke3ByZVN1ZmZpeH0ke3N1ZmZpeH0ke3Bvc3RTdWZmaXh9YDtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUNoYXJhY3RlclBhaXJEZWNvcmF0b3JCZWhhdmlvcihjb25maWcpIHtcbiAgY29uZmlnLnBhaXIuYW1vdW50IDwgMSAmJiBjb25zb2xlLndhcm4oXCJUaGUgYW1vdW50IG9mIGNoYXJhY3RlcnMgaW4gdGhlIHBhaXIgc2hvdWxkIGJlIGdyZWF0ZXIgdGhhbiAwXCIpO1xuICBjb25zdCBwYWlyUmVnZXggPSBjcmVhdGVDaGFyYWN0ZXJQYWlyUmVnZXgoY29uZmlnLnBhaXIuY2hhciwgY29uZmlnLnBhaXIuYW1vdW50KSwgcmVnRXggPSBuZXcgUmVnRXhwKGAoJHtwYWlyUmVnZXh9KSRgKTtcbiAgcmV0dXJuIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnNlcnQudGV4dFwiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGlmIChjb25maWcucGFpci5hbW91bnQgPCAxKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBkZWNvcmF0b3IgPSBjb25maWcuZGVjb3JhdG9yKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICAgICAgfSxcbiAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYVxuICAgICAgfSk7XG4gICAgICBpZiAoZGVjb3JhdG9yID09PSB2b2lkIDApXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IGZvY3VzVGV4dEJsb2NrID0gc2VsZWN0b3JzLmdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KSwgc2VsZWN0aW9uU3RhcnRQb2ludCA9IHNlbGVjdG9ycy5nZXRTZWxlY3Rpb25TdGFydFBvaW50KHNuYXBzaG90KSwgc2VsZWN0aW9uU3RhcnRPZmZzZXQgPSBzZWxlY3Rpb25TdGFydFBvaW50ID8gdXRpbHMuc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvblBvaW50OiBzZWxlY3Rpb25TdGFydFBvaW50XG4gICAgICB9KSA6IHZvaWQgMDtcbiAgICAgIGlmICghZm9jdXNUZXh0QmxvY2sgfHwgIXNlbGVjdGlvblN0YXJ0T2Zmc2V0KVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBuZXdUZXh0ID0gYCR7c2VsZWN0b3JzLmdldEJsb2NrVGV4dEJlZm9yZShzbmFwc2hvdCl9JHtldmVudC50ZXh0fWAsIHRleHRUb0RlY29yYXRlID0gbmV3VGV4dC5tYXRjaChyZWdFeCk/LmF0KDApO1xuICAgICAgaWYgKHRleHRUb0RlY29yYXRlID09PSB2b2lkIDApXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IHByZWZpeE9mZnNldHMgPSB7XG4gICAgICAgIGFuY2hvcjoge1xuICAgICAgICAgIHBhdGg6IGZvY3VzVGV4dEJsb2NrLnBhdGgsXG4gICAgICAgICAgLy8gRXhhbXBsZTogXCJmb28gKipiYXIqKlwiLmxlbmd0aCAtIFwiKipiYXIqKlwiLmxlbmd0aCA9IDRcbiAgICAgICAgICBvZmZzZXQ6IG5ld1RleHQubGVuZ3RoIC0gdGV4dFRvRGVjb3JhdGUubGVuZ3RoXG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgcGF0aDogZm9jdXNUZXh0QmxvY2sucGF0aCxcbiAgICAgICAgICAvLyBFeGFtcGxlOiBcImZvbyAqKmJhcioqXCIubGVuZ3RoIC0gXCIqKmJhcioqXCIubGVuZ3RoICsgXCIqXCIubGVuZ3RoICogMiA9IDZcbiAgICAgICAgICBvZmZzZXQ6IG5ld1RleHQubGVuZ3RoIC0gdGV4dFRvRGVjb3JhdGUubGVuZ3RoICsgY29uZmlnLnBhaXIuY2hhci5sZW5ndGggKiBjb25maWcucGFpci5hbW91bnRcbiAgICAgICAgfVxuICAgICAgfSwgc3VmZml4T2Zmc2V0cyA9IHtcbiAgICAgICAgYW5jaG9yOiB7XG4gICAgICAgICAgcGF0aDogZm9jdXNUZXh0QmxvY2sucGF0aCxcbiAgICAgICAgICAvLyBFeGFtcGxlOiBcImZvbyAqKmJhcip8XCIgKDEwKSArIFwiKlwiLmxlbmd0aCAtIDIgPSA5XG4gICAgICAgICAgb2Zmc2V0OiBzZWxlY3Rpb25TdGFydE9mZnNldC5vZmZzZXQgKyBldmVudC50ZXh0Lmxlbmd0aCAtIGNvbmZpZy5wYWlyLmNoYXIubGVuZ3RoICogY29uZmlnLnBhaXIuYW1vdW50XG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzOiB7XG4gICAgICAgICAgcGF0aDogZm9jdXNUZXh0QmxvY2sucGF0aCxcbiAgICAgICAgICAvLyBFeGFtcGxlOiBcImZvbyAqKmJhcip8XCIgKDEwKSArIFwiKlwiLmxlbmd0aCA9IDExXG4gICAgICAgICAgb2Zmc2V0OiBzZWxlY3Rpb25TdGFydE9mZnNldC5vZmZzZXQgKyBldmVudC50ZXh0Lmxlbmd0aFxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaWYgKHByZWZpeE9mZnNldHMuZm9jdXMub2Zmc2V0IC0gcHJlZml4T2Zmc2V0cy5hbmNob3Iub2Zmc2V0ID4gMSkge1xuICAgICAgICBjb25zdCBwcmVmaXhTZWxlY3Rpb24gPSB1dGlscy5ibG9ja09mZnNldHNUb1NlbGVjdGlvbih7XG4gICAgICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICBvZmZzZXRzOiBwcmVmaXhPZmZzZXRzXG4gICAgICAgIH0pLCBpbmxpbmVPYmplY3RCZWZvcmVQcmVmaXhGb2N1cyA9IHNlbGVjdG9ycy5nZXRQcmV2aW91c0lubGluZU9iamVjdCh7XG4gICAgICAgICAgLi4uc25hcHNob3QsXG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgICAgIHNlbGVjdGlvbjogcHJlZml4U2VsZWN0aW9uID8ge1xuICAgICAgICAgICAgICBhbmNob3I6IHByZWZpeFNlbGVjdGlvbi5mb2N1cyxcbiAgICAgICAgICAgICAgZm9jdXM6IHByZWZpeFNlbGVjdGlvbi5mb2N1c1xuICAgICAgICAgICAgfSA6IG51bGxcbiAgICAgICAgICB9XG4gICAgICAgIH0pLCBpbmxpbmVPYmplY3RCZWZvcmVQcmVmaXhGb2N1c09mZnNldCA9IGlubGluZU9iamVjdEJlZm9yZVByZWZpeEZvY3VzID8gdXRpbHMuY2hpbGRTZWxlY3Rpb25Qb2ludFRvQmxvY2tPZmZzZXQoe1xuICAgICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uUG9pbnQ6IHtcbiAgICAgICAgICAgIHBhdGg6IGlubGluZU9iamVjdEJlZm9yZVByZWZpeEZvY3VzLnBhdGgsXG4gICAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0pIDogdm9pZCAwO1xuICAgICAgICBpZiAoaW5saW5lT2JqZWN0QmVmb3JlUHJlZml4Rm9jdXNPZmZzZXQgJiYgaW5saW5lT2JqZWN0QmVmb3JlUHJlZml4Rm9jdXNPZmZzZXQub2Zmc2V0ID4gcHJlZml4T2Zmc2V0cy5hbmNob3Iub2Zmc2V0ICYmIGlubGluZU9iamVjdEJlZm9yZVByZWZpeEZvY3VzT2Zmc2V0Lm9mZnNldCA8IHByZWZpeE9mZnNldHMuZm9jdXMub2Zmc2V0KVxuICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgIH1cbiAgICAgIGlmIChzdWZmaXhPZmZzZXRzLmZvY3VzLm9mZnNldCAtIHN1ZmZpeE9mZnNldHMuYW5jaG9yLm9mZnNldCA+IDEpIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNJbmxpbmVPYmplY3QgPSBzZWxlY3RvcnMuZ2V0UHJldmlvdXNJbmxpbmVPYmplY3Qoc25hcHNob3QpLCBwcmV2aW91c0lubGluZU9iamVjdE9mZnNldCA9IHByZXZpb3VzSW5saW5lT2JqZWN0ID8gdXRpbHMuY2hpbGRTZWxlY3Rpb25Qb2ludFRvQmxvY2tPZmZzZXQoe1xuICAgICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uUG9pbnQ6IHtcbiAgICAgICAgICAgIHBhdGg6IHByZXZpb3VzSW5saW5lT2JqZWN0LnBhdGgsXG4gICAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0pIDogdm9pZCAwO1xuICAgICAgICBpZiAocHJldmlvdXNJbmxpbmVPYmplY3RPZmZzZXQgJiYgcHJldmlvdXNJbmxpbmVPYmplY3RPZmZzZXQub2Zmc2V0ID4gc3VmZml4T2Zmc2V0cy5hbmNob3Iub2Zmc2V0ICYmIHByZXZpb3VzSW5saW5lT2JqZWN0T2Zmc2V0Lm9mZnNldCA8IHN1ZmZpeE9mZnNldHMuZm9jdXMub2Zmc2V0KVxuICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByZWZpeE9mZnNldHMsXG4gICAgICAgIHN1ZmZpeE9mZnNldHMsXG4gICAgICAgIGRlY29yYXRvclxuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFtcbiAgICAgIC8vIEluc2VydCB0aGUgdGV4dCBhcyB1c3VhbCBpbiBpdHMgb3duIHVuZG8gc3RlcFxuICAgICAgKHtcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pID0+IFtmb3J3YXJkKGV2ZW50KV0sXG4gICAgICAoXywge1xuICAgICAgICBwcmVmaXhPZmZzZXRzLFxuICAgICAgICBzdWZmaXhPZmZzZXRzLFxuICAgICAgICBkZWNvcmF0b3JcbiAgICAgIH0pID0+IFtcbiAgICAgICAgLy8gRGVjb3JhdGUgdGhlIHRleHQgYmV0d2VlbiB0aGUgcHJlZml4IGFuZCBzdWZmaXhcbiAgICAgICAgcmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwiZGVjb3JhdG9yLmFkZFwiLFxuICAgICAgICAgIGRlY29yYXRvcixcbiAgICAgICAgICBhdDoge1xuICAgICAgICAgICAgYW5jaG9yOiBwcmVmaXhPZmZzZXRzLmZvY3VzLFxuICAgICAgICAgICAgZm9jdXM6IHN1ZmZpeE9mZnNldHMuYW5jaG9yXG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgLy8gRGVsZXRlIHRoZSBzdWZmaXhcbiAgICAgICAgcmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwiZGVsZXRlLnRleHRcIixcbiAgICAgICAgICBhdDogc3VmZml4T2Zmc2V0c1xuICAgICAgICB9KSxcbiAgICAgICAgLy8gRGVsZXRlIHRoZSBwcmVmaXhcbiAgICAgICAgcmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwiZGVsZXRlLnRleHRcIixcbiAgICAgICAgICBhdDogcHJlZml4T2Zmc2V0c1xuICAgICAgICB9KSxcbiAgICAgICAgLy8gVG9nZ2xlIHRoZSBkZWNvcmF0b3Igb2ZmIHNvIHRoZSBuZXh0IGluc2VydGVkIHRleHQgaXNuJ3QgZW1waGFzaXplZFxuICAgICAgICByYWlzZSh7XG4gICAgICAgICAgdHlwZTogXCJkZWNvcmF0b3IucmVtb3ZlXCIsXG4gICAgICAgICAgZGVjb3JhdG9yXG4gICAgICAgIH0pLFxuICAgICAgICBlZmZlY3QoKCkgPT4ge1xuICAgICAgICAgIGNvbmZpZy5vbkRlY29yYXRlKHtcbiAgICAgICAgICAgIC4uLnN1ZmZpeE9mZnNldHMuYW5jaG9yLFxuICAgICAgICAgICAgb2Zmc2V0OiBzdWZmaXhPZmZzZXRzLmFuY2hvci5vZmZzZXQgLSAocHJlZml4T2Zmc2V0cy5mb2N1cy5vZmZzZXQgLSBwcmVmaXhPZmZzZXRzLmFuY2hvci5vZmZzZXQpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgXVxuICB9KTtcbn1cbmZ1bmN0aW9uIENoYXJhY3RlclBhaXJEZWNvcmF0b3JQbHVnaW4ocHJvcHMpIHtcbiAgY29uc3QgJCA9IGMoNCksIGVkaXRvciA9IHVzZUVkaXRvcigpO1xuICBsZXQgdDA7XG4gIHJldHVybiAkWzBdICE9PSBlZGl0b3IgfHwgJFsxXSAhPT0gcHJvcHMuZGVjb3JhdG9yIHx8ICRbMl0gIT09IHByb3BzLnBhaXIgPyAodDAgPSB7XG4gICAgaW5wdXQ6IHtcbiAgICAgIGVkaXRvcixcbiAgICAgIGRlY29yYXRvcjogcHJvcHMuZGVjb3JhdG9yLFxuICAgICAgcGFpcjogcHJvcHMucGFpclxuICAgIH1cbiAgfSwgJFswXSA9IGVkaXRvciwgJFsxXSA9IHByb3BzLmRlY29yYXRvciwgJFsyXSA9IHByb3BzLnBhaXIsICRbM10gPSB0MCkgOiB0MCA9ICRbM10sIHVzZUFjdG9yUmVmKGRlY29yYXRvclBhaXJNYWNoaW5lLCB0MCksIG51bGw7XG59XG5jb25zdCBkZWNvcmF0ZUxpc3RlbmVyID0gKHtcbiAgc2VuZEJhY2ssXG4gIGlucHV0XG59KSA9PiBpbnB1dC5lZGl0b3IucmVnaXN0ZXJCZWhhdmlvcih7XG4gIGJlaGF2aW9yOiBjcmVhdGVDaGFyYWN0ZXJQYWlyRGVjb3JhdG9yQmVoYXZpb3Ioe1xuICAgIGRlY29yYXRvcjogaW5wdXQuZGVjb3JhdG9yLFxuICAgIHBhaXI6IGlucHV0LnBhaXIsXG4gICAgb25EZWNvcmF0ZTogKG9mZnNldCkgPT4ge1xuICAgICAgc2VuZEJhY2soe1xuICAgICAgICB0eXBlOiBcImRlY29yYXRvci5hZGRcIixcbiAgICAgICAgYmxvY2tPZmZzZXQ6IG9mZnNldFxuICAgICAgfSk7XG4gICAgfVxuICB9KVxufSksIHNlbGVjdGlvbkxpc3RlbmVyQ2FsbGJhY2sgPSAoe1xuICBzZW5kQmFjayxcbiAgaW5wdXRcbn0pID0+IGlucHV0LmVkaXRvci5yZWdpc3RlckJlaGF2aW9yKHtcbiAgYmVoYXZpb3I6IGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJzZWxlY3RcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBpZiAoIWV2ZW50LmF0KVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJsb2NrT2Zmc2V0czogdm9pZCAwXG4gICAgICAgIH07XG4gICAgICBjb25zdCBhbmNob3IgPSB1dGlscy5zcGFuU2VsZWN0aW9uUG9pbnRUb0Jsb2NrT2Zmc2V0KHtcbiAgICAgICAgY29udGV4dDogc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uUG9pbnQ6IGV2ZW50LmF0LmFuY2hvclxuICAgICAgfSksIGZvY3VzID0gdXRpbHMuc3BhblNlbGVjdGlvblBvaW50VG9CbG9ja09mZnNldCh7XG4gICAgICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgIHNlbGVjdGlvblBvaW50OiBldmVudC5hdC5mb2N1c1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gIWFuY2hvciB8fCAhZm9jdXMgPyB7XG4gICAgICAgIGJsb2NrT2Zmc2V0czogdm9pZCAwXG4gICAgICB9IDoge1xuICAgICAgICBibG9ja09mZnNldHM6IHtcbiAgICAgICAgICBhbmNob3IsXG4gICAgICAgICAgZm9jdXNcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBibG9ja09mZnNldHNcbiAgICB9KSA9PiBbe1xuICAgICAgdHlwZTogXCJlZmZlY3RcIixcbiAgICAgIGVmZmVjdDogKCkgPT4ge1xuICAgICAgICBzZW5kQmFjayh7XG4gICAgICAgICAgdHlwZTogXCJzZWxlY3Rpb25cIixcbiAgICAgICAgICBibG9ja09mZnNldHNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwgZm9yd2FyZChldmVudCldXVxuICB9KVxufSksIGRlbGV0ZUJhY2t3YXJkTGlzdGVuZXJDYWxsYmFjayA9ICh7XG4gIHNlbmRCYWNrLFxuICBpbnB1dFxufSkgPT4gaW5wdXQuZWRpdG9yLnJlZ2lzdGVyQmVoYXZpb3Ioe1xuICBiZWhhdmlvcjogZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImRlbGV0ZS5iYWNrd2FyZFwiLFxuICAgIGFjdGlvbnM6IFsoKSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJoaXN0b3J5LnVuZG9cIlxuICAgIH0pLCBlZmZlY3QoKCkgPT4ge1xuICAgICAgc2VuZEJhY2soe1xuICAgICAgICB0eXBlOiBcImRlbGV0ZS5iYWNrd2FyZFwiXG4gICAgICB9KTtcbiAgICB9KV1dXG4gIH0pXG59KSwgZGVjb3JhdG9yUGFpck1hY2hpbmUgPSBzZXR1cCh7XG4gIHR5cGVzOiB7XG4gICAgY29udGV4dDoge30sXG4gICAgaW5wdXQ6IHt9LFxuICAgIGV2ZW50czoge31cbiAgfSxcbiAgYWN0b3JzOiB7XG4gICAgXCJkZWNvcmF0ZSBsaXN0ZW5lclwiOiBmcm9tQ2FsbGJhY2soZGVjb3JhdGVMaXN0ZW5lciksXG4gICAgXCJkZWxldGUuYmFja3dhcmQgbGlzdGVuZXJcIjogZnJvbUNhbGxiYWNrKGRlbGV0ZUJhY2t3YXJkTGlzdGVuZXJDYWxsYmFjayksXG4gICAgXCJzZWxlY3Rpb24gbGlzdGVuZXJcIjogZnJvbUNhbGxiYWNrKHNlbGVjdGlvbkxpc3RlbmVyQ2FsbGJhY2spXG4gIH1cbn0pLmNyZWF0ZU1hY2hpbmUoe1xuICBpZDogXCJkZWNvcmF0b3IgcGFpclwiLFxuICBjb250ZXh0OiAoe1xuICAgIGlucHV0XG4gIH0pID0+ICh7XG4gICAgZGVjb3JhdG9yOiBpbnB1dC5kZWNvcmF0b3IsXG4gICAgZWRpdG9yOiBpbnB1dC5lZGl0b3IsXG4gICAgcGFpcjogaW5wdXQucGFpclxuICB9KSxcbiAgaW5pdGlhbDogXCJpZGxlXCIsXG4gIHN0YXRlczoge1xuICAgIGlkbGU6IHtcbiAgICAgIGludm9rZTogW3tcbiAgICAgICAgc3JjOiBcImRlY29yYXRlIGxpc3RlbmVyXCIsXG4gICAgICAgIGlucHV0OiAoe1xuICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgfSkgPT4gKHtcbiAgICAgICAgICBkZWNvcmF0b3I6IGNvbnRleHQuZGVjb3JhdG9yLFxuICAgICAgICAgIGVkaXRvcjogY29udGV4dC5lZGl0b3IsXG4gICAgICAgICAgcGFpcjogY29udGV4dC5wYWlyXG4gICAgICAgIH0pXG4gICAgICB9XSxcbiAgICAgIG9uOiB7XG4gICAgICAgIFwiZGVjb3JhdG9yLmFkZFwiOiB7XG4gICAgICAgICAgdGFyZ2V0OiBcImRlY29yYXRvciBhZGRlZFwiLFxuICAgICAgICAgIGFjdGlvbnM6IGFzc2lnbih7XG4gICAgICAgICAgICBvZmZzZXRBZnRlckRlY29yYXRvcjogKHtcbiAgICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICAgIH0pID0+IGV2ZW50LmJsb2NrT2Zmc2V0XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgXCJkZWNvcmF0b3IgYWRkZWRcIjoge1xuICAgICAgZXhpdDogW2Fzc2lnbih7XG4gICAgICAgIG9mZnNldEFmdGVyRGVjb3JhdG9yOiB2b2lkIDBcbiAgICAgIH0pXSxcbiAgICAgIGludm9rZTogW3tcbiAgICAgICAgc3JjOiBcInNlbGVjdGlvbiBsaXN0ZW5lclwiLFxuICAgICAgICBpbnB1dDogKHtcbiAgICAgICAgICBjb250ZXh0XG4gICAgICAgIH0pID0+ICh7XG4gICAgICAgICAgZWRpdG9yOiBjb250ZXh0LmVkaXRvclxuICAgICAgICB9KVxuICAgICAgfSwge1xuICAgICAgICBzcmM6IFwiZGVsZXRlLmJhY2t3YXJkIGxpc3RlbmVyXCIsXG4gICAgICAgIGlucHV0OiAoe1xuICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgfSkgPT4gKHtcbiAgICAgICAgICBlZGl0b3I6IGNvbnRleHQuZWRpdG9yXG4gICAgICAgIH0pXG4gICAgICB9XSxcbiAgICAgIG9uOiB7XG4gICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgIHRhcmdldDogXCJpZGxlXCIsXG4gICAgICAgICAgZ3VhcmQ6ICh7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICB9KSA9PiAhaXNEZWVwRXF1YWwoe1xuICAgICAgICAgICAgYW5jaG9yOiBjb250ZXh0Lm9mZnNldEFmdGVyRGVjb3JhdG9yLFxuICAgICAgICAgICAgZm9jdXM6IGNvbnRleHQub2Zmc2V0QWZ0ZXJEZWNvcmF0b3JcbiAgICAgICAgICB9LCBldmVudC5ibG9ja09mZnNldHMpXG4gICAgICAgIH0sXG4gICAgICAgIFwiZGVsZXRlLmJhY2t3YXJkXCI6IHtcbiAgICAgICAgICB0YXJnZXQ6IFwiaWRsZVwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuZXhwb3J0IHtcbiAgQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpblxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/plugin-character-pair-decorator/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/plugin-input-rule/dist/index.js":
/*!********************************************************************!*\
  !*** ./node_modules/@portabletext/plugin-input-rule/dist/index.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   InputRulePlugin: () => (/* binding */ InputRulePlugin),\n/* harmony export */   defineInputRule: () => (/* binding */ defineInputRule),\n/* harmony export */   defineInputRuleBehavior: () => (/* binding */ defineInputRuleBehavior),\n/* harmony export */   defineTextTransformRule: () => (/* binding */ defineTextTransformRule)\n/* harmony export */ });\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n/* harmony import */ var _portabletext_editor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @portabletext/editor */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\");\n/* harmony import */ var _portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @portabletext/editor/behaviors */ \"(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js\");\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/selectors/index.js\");\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n/* harmony import */ var _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @portabletext/editor/utils */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/util.slice-blocks.js\");\n/* harmony import */ var _xstate_react__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @xstate/react */ \"(ssr)/./node_modules/@xstate/react/dist/xstate-react.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/dist/xstate.development.esm.js\");\n/* harmony import */ var xstate__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! xstate */ \"(ssr)/./node_modules/xstate/actors/dist/xstate-actors.development.esm.js\");\n\n\n\n\n\n\n\nfunction defineInputRule(config) {\n  return config;\n}\nfunction getInputRuleMatchLocation({\n  match,\n  adjustIndexBy,\n  snapshot,\n  focusBlock,\n  originalTextBefore\n}) {\n  const [text, start, end] = match, adjustedIndex = start + adjustIndexBy, targetOffsets = {\n    anchor: {\n      path: focusBlock.path,\n      offset: adjustedIndex\n    },\n    focus: {\n      path: focusBlock.path,\n      offset: adjustedIndex + end - start\n    },\n    backward: !1\n  }, normalizedOffsets = {\n    anchor: {\n      path: focusBlock.path,\n      offset: Math.min(targetOffsets.anchor.offset, originalTextBefore.length)\n    },\n    focus: {\n      path: focusBlock.path,\n      offset: Math.min(targetOffsets.focus.offset, originalTextBefore.length)\n    }\n  }, anchorBackwards = (0,_portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_1__.blockOffsetToSpanSelectionPoint)({\n    context: snapshot.context,\n    blockOffset: normalizedOffsets.anchor,\n    direction: \"backward\"\n  }), focusForwards = (0,_portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_1__.blockOffsetToSpanSelectionPoint)({\n    context: snapshot.context,\n    blockOffset: normalizedOffsets.focus,\n    direction: \"forward\"\n  });\n  if (!anchorBackwards || !focusForwards)\n    return;\n  const selection = {\n    anchor: anchorBackwards,\n    focus: focusForwards\n  }, inlineObjectsAfterMatch = (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getNextInlineObjects)({\n    ...snapshot,\n    context: {\n      ...snapshot.context,\n      selection: {\n        anchor: selection.anchor,\n        focus: selection.anchor\n      }\n    }\n  }), inlineObjectsBefore = (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getPreviousInlineObjects)(snapshot);\n  if (!inlineObjectsAfterMatch.some((inlineObjectAfter) => inlineObjectsBefore.some((inlineObjectBefore) => inlineObjectAfter.node._key === inlineObjectBefore.node._key)))\n    return {\n      text,\n      selection,\n      targetOffsets\n    };\n}\nfunction defineInputRuleBehavior(config) {\n  return (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.defineBehavior)({\n    on: \"insert.text\",\n    guard: ({\n      snapshot,\n      event,\n      dom\n    }) => {\n      if (!snapshot.context.selection || !(0,_portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_1__.isSelectionCollapsed)(snapshot.context.selection))\n        return !1;\n      const focusBlock = (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getFocusBlock)(snapshot);\n      if (!focusBlock)\n        return !1;\n      const originalTextBefore = (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getBlockTextBefore)(snapshot);\n      let textBefore = originalTextBefore;\n      const originalNewText = textBefore + event.text;\n      let newText = originalNewText;\n      const foundMatches = [], foundActions = [];\n      for (const rule of config.rules) {\n        const matcher = new RegExp(rule.on.source, \"gd\");\n        for (; ; ) {\n          const ruleMatches = [...newText.matchAll(matcher)].flatMap((regExpMatch) => {\n            if (regExpMatch.indices === void 0)\n              return [];\n            const match = regExpMatch.indices.at(0);\n            if (!match)\n              return [];\n            const matchLocation = getInputRuleMatchLocation({\n              match: [regExpMatch.at(0) ?? \"\", ...match],\n              adjustIndexBy: originalNewText.length - newText.length,\n              snapshot,\n              focusBlock,\n              originalTextBefore\n            });\n            if (!matchLocation)\n              return [];\n            if (matchLocation.targetOffsets.focus.offset <= originalTextBefore.length)\n              return [];\n            if (foundMatches.some((foundMatch) => foundMatch.targetOffsets.anchor.offset === matchLocation.targetOffsets.anchor.offset))\n              return [];\n            const groupMatches = regExpMatch.indices.length > 1 ? regExpMatch.indices.slice(1).filter((indices) => indices !== void 0) : [];\n            return [{\n              text: matchLocation.text,\n              selection: matchLocation.selection,\n              targetOffsets: matchLocation.targetOffsets,\n              groupMatches: groupMatches.flatMap((match2, index) => {\n                const text = regExpMatch.at(index + 1) ?? \"\";\n                return getInputRuleMatchLocation({\n                  match: [text, ...match2],\n                  adjustIndexBy: originalNewText.length - newText.length,\n                  snapshot,\n                  focusBlock,\n                  originalTextBefore\n                }) || [];\n              })\n            }];\n          });\n          if (ruleMatches.length > 0) {\n            const guardResult = rule.guard?.({\n              snapshot,\n              event: {\n                type: \"custom.input rule\",\n                matches: ruleMatches,\n                focusBlock,\n                textBefore: originalTextBefore,\n                textInserted: event.text\n              },\n              dom\n            }) ?? !0;\n            if (!guardResult)\n              break;\n            const actionSets = rule.actions.map((action) => action({\n              snapshot,\n              event: {\n                type: \"custom.input rule\",\n                matches: ruleMatches,\n                focusBlock,\n                textBefore: originalTextBefore,\n                textInserted: event.text\n              },\n              dom\n            }, guardResult));\n            for (const actionSet of actionSets)\n              for (const action of actionSet)\n                foundActions.push(action);\n            const matches = ruleMatches.flatMap((match) => match.groupMatches.length === 0 ? [match] : match.groupMatches);\n            for (const match of matches)\n              foundMatches.push(match), textBefore = newText.slice(0, match.targetOffsets.focus.offset ?? 0), newText = originalNewText.slice(match.targetOffsets.focus.offset ?? 0);\n          } else\n            break;\n        }\n      }\n      return foundActions.length === 0 ? !1 : {\n        actions: foundActions\n      };\n    },\n    actions: [({\n      event\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.forward)(event)], (_, {\n      actions\n    }) => actions, ({\n      snapshot\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.effect)(() => {\n      const blockOffsets = (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getBlockOffsets)(snapshot);\n      config.onApply?.({\n        endOffsets: blockOffsets\n      });\n    })]]\n  });\n}\nfunction InputRulePlugin(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__.c)(3), editor = (0,_portabletext_editor__WEBPACK_IMPORTED_MODULE_5__.useEditor)();\n  let t0;\n  return $[0] !== editor || $[1] !== props.rules ? (t0 = {\n    input: {\n      editor,\n      rules: props.rules\n    }\n  }, $[0] = editor, $[1] = props.rules, $[2] = t0) : t0 = $[2], (0,_xstate_react__WEBPACK_IMPORTED_MODULE_6__.useActorRef)(inputRuleMachine, t0), null;\n}\nconst inputRuleListenerCallback = ({\n  input,\n  sendBack\n}) => {\n  const unregister = input.editor.registerBehavior({\n    behavior: defineInputRuleBehavior({\n      rules: input.rules,\n      onApply: ({\n        endOffsets\n      }) => {\n        sendBack({\n          type: \"input rule raised\",\n          endOffsets\n        });\n      }\n    })\n  });\n  return () => {\n    unregister();\n  };\n}, deleteBackwardListenerCallback = ({\n  input,\n  sendBack\n}) => input.editor.registerBehavior({\n  behavior: (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.defineBehavior)({\n    on: \"delete.backward\",\n    actions: [() => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"history.undo\"\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.effect)(() => {\n      sendBack({\n        type: \"history.undo raised\"\n      });\n    })]]\n  })\n}), selectionListenerCallback = ({\n  sendBack,\n  input\n}) => input.editor.registerBehavior({\n  behavior: (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.defineBehavior)({\n    on: \"select\",\n    guard: ({\n      snapshot,\n      event\n    }) => ({\n      blockOffsets: (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getBlockOffsets)({\n        ...snapshot,\n        context: {\n          ...snapshot.context,\n          selection: event.at\n        }\n      })\n    }),\n    actions: [({\n      event\n    }, {\n      blockOffsets\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.effect)(() => {\n      sendBack({\n        type: \"selection changed\",\n        blockOffsets\n      });\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.forward)(event)]]\n  })\n}), inputRuleSetup = (0,xstate__WEBPACK_IMPORTED_MODULE_7__.setup)({\n  types: {\n    context: {},\n    input: {},\n    events: {}\n  },\n  actors: {\n    \"delete.backward listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_8__.fromCallback)(deleteBackwardListenerCallback),\n    \"input rule listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_8__.fromCallback)(inputRuleListenerCallback),\n    \"selection listener\": (0,xstate__WEBPACK_IMPORTED_MODULE_8__.fromCallback)(selectionListenerCallback)\n  },\n  guards: {\n    \"block offset changed\": ({\n      context,\n      event\n    }) => {\n      if (event.type !== \"selection changed\")\n        return !1;\n      if (!event.blockOffsets || !context.endOffsets)\n        return !0;\n      const startChanged = context.endOffsets.start.path[0]._key !== event.blockOffsets.start.path[0]._key || context.endOffsets.start.offset !== event.blockOffsets.start.offset, endChanged = context.endOffsets.end.path[0]._key !== event.blockOffsets.end.path[0]._key || context.endOffsets.end.offset !== event.blockOffsets.end.offset;\n      return startChanged || endChanged;\n    }\n  }\n}), assignEndOffsets = inputRuleSetup.assign({\n  endOffsets: ({\n    context,\n    event\n  }) => event.type === \"input rule raised\" ? event.endOffsets : context.endOffsets\n}), inputRuleMachine = inputRuleSetup.createMachine({\n  id: \"input rule\",\n  context: ({\n    input\n  }) => ({\n    editor: input.editor,\n    rules: input.rules,\n    endOffsets: void 0\n  }),\n  initial: \"idle\",\n  invoke: {\n    src: \"input rule listener\",\n    input: ({\n      context\n    }) => ({\n      editor: context.editor,\n      rules: context.rules\n    })\n  },\n  on: {\n    \"input rule raised\": {\n      target: \".input rule applied\",\n      actions: assignEndOffsets\n    }\n  },\n  states: {\n    idle: {},\n    \"input rule applied\": {\n      invoke: [{\n        src: \"delete.backward listener\",\n        input: ({\n          context\n        }) => ({\n          editor: context.editor\n        })\n      }, {\n        src: \"selection listener\",\n        input: ({\n          context\n        }) => ({\n          editor: context.editor\n        })\n      }],\n      on: {\n        \"selection changed\": {\n          target: \"idle\",\n          guard: \"block offset changed\"\n        },\n        \"history.undo raised\": {\n          target: \"idle\"\n        }\n      }\n    }\n  }\n});\nfunction defineTextTransformRule(config) {\n  return {\n    on: config.on,\n    guard: config.guard ?? (() => !0),\n    actions: [({\n      snapshot,\n      event\n    }, guardResponse) => {\n      const locations = event.matches.flatMap((match) => match.groupMatches.length === 0 ? [match] : match.groupMatches), newText = event.textBefore + event.textInserted;\n      let textLengthDelta = 0;\n      const actions = [];\n      for (const location of locations.reverse()) {\n        const text = config.transform({\n          location\n        }, guardResponse);\n        textLengthDelta = textLengthDelta - (text.length - (location.targetOffsets.focus.offset - location.targetOffsets.anchor.offset)), actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"select\",\n          at: location.targetOffsets\n        })), actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"delete\",\n          at: location.targetOffsets\n        })), actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"insert.child\",\n          child: {\n            _type: snapshot.context.schema.span.name,\n            text,\n            marks: (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getMarkState)({\n              ...snapshot,\n              context: {\n                ...snapshot.context,\n                selection: {\n                  anchor: location.selection.anchor,\n                  focus: {\n                    path: location.selection.focus.path,\n                    offset: Math.min(location.selection.focus.offset, event.textBefore.length)\n                  }\n                }\n              }\n            })?.marks ?? []\n          }\n        }));\n      }\n      const endCaretPosition = {\n        path: event.focusBlock.path,\n        offset: newText.length - textLengthDelta\n      };\n      return [...actions, (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n        type: \"select\",\n        at: {\n          anchor: endCaretPosition,\n          focus: endCaretPosition\n        }\n      })];\n    }]\n  };\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4taW5wdXQtcnVsZS9kaXN0L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMkM7QUFDTTtBQUN1QztBQUMwRTtBQUMvRDtBQUN2RDtBQUNDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxvQkFBb0IsMkZBQStCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLEdBQUcsbUJBQW1CLDJGQUErQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsNEJBQTRCLG9GQUFvQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyx5QkFBeUIsd0ZBQXdCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDhFQUFjO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsMENBQTBDLGdGQUFvQjtBQUM5RDtBQUNBLHlCQUF5Qiw2RUFBYTtBQUN0QztBQUNBO0FBQ0EsaUNBQWlDLGtGQUFrQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUNBLG1CQUFtQiw0RUFBWTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIscUVBQUs7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQU1FO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L3BsdWdpbi1pbnB1dC1ydWxlL2Rpc3QvaW5kZXguanM/YmMxOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjIH0gZnJvbSBcInJlYWN0LWNvbXBpbGVyLXJ1bnRpbWVcIjtcbmltcG9ydCB7IHVzZUVkaXRvciB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L2VkaXRvclwiO1xuaW1wb3J0IHsgZGVmaW5lQmVoYXZpb3IsIGVmZmVjdCwgZm9yd2FyZCwgcmFpc2UgfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9lZGl0b3IvYmVoYXZpb3JzXCI7XG5pbXBvcnQgeyBnZXROZXh0SW5saW5lT2JqZWN0cywgZ2V0UHJldmlvdXNJbmxpbmVPYmplY3RzLCBnZXRCbG9ja09mZnNldHMsIGdldEZvY3VzQmxvY2ssIGdldEJsb2NrVGV4dEJlZm9yZSwgZ2V0TWFya1N0YXRlIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9yc1wiO1xuaW1wb3J0IHsgYmxvY2tPZmZzZXRUb1NwYW5TZWxlY3Rpb25Qb2ludCwgaXNTZWxlY3Rpb25Db2xsYXBzZWQgfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9lZGl0b3IvdXRpbHNcIjtcbmltcG9ydCB7IHVzZUFjdG9yUmVmIH0gZnJvbSBcIkB4c3RhdGUvcmVhY3RcIjtcbmltcG9ydCB7IHNldHVwLCBmcm9tQ2FsbGJhY2sgfSBmcm9tIFwieHN0YXRlXCI7XG5mdW5jdGlvbiBkZWZpbmVJbnB1dFJ1bGUoY29uZmlnKSB7XG4gIHJldHVybiBjb25maWc7XG59XG5mdW5jdGlvbiBnZXRJbnB1dFJ1bGVNYXRjaExvY2F0aW9uKHtcbiAgbWF0Y2gsXG4gIGFkanVzdEluZGV4QnksXG4gIHNuYXBzaG90LFxuICBmb2N1c0Jsb2NrLFxuICBvcmlnaW5hbFRleHRCZWZvcmVcbn0pIHtcbiAgY29uc3QgW3RleHQsIHN0YXJ0LCBlbmRdID0gbWF0Y2gsIGFkanVzdGVkSW5kZXggPSBzdGFydCArIGFkanVzdEluZGV4QnksIHRhcmdldE9mZnNldHMgPSB7XG4gICAgYW5jaG9yOiB7XG4gICAgICBwYXRoOiBmb2N1c0Jsb2NrLnBhdGgsXG4gICAgICBvZmZzZXQ6IGFkanVzdGVkSW5kZXhcbiAgICB9LFxuICAgIGZvY3VzOiB7XG4gICAgICBwYXRoOiBmb2N1c0Jsb2NrLnBhdGgsXG4gICAgICBvZmZzZXQ6IGFkanVzdGVkSW5kZXggKyBlbmQgLSBzdGFydFxuICAgIH0sXG4gICAgYmFja3dhcmQ6ICExXG4gIH0sIG5vcm1hbGl6ZWRPZmZzZXRzID0ge1xuICAgIGFuY2hvcjoge1xuICAgICAgcGF0aDogZm9jdXNCbG9jay5wYXRoLFxuICAgICAgb2Zmc2V0OiBNYXRoLm1pbih0YXJnZXRPZmZzZXRzLmFuY2hvci5vZmZzZXQsIG9yaWdpbmFsVGV4dEJlZm9yZS5sZW5ndGgpXG4gICAgfSxcbiAgICBmb2N1czoge1xuICAgICAgcGF0aDogZm9jdXNCbG9jay5wYXRoLFxuICAgICAgb2Zmc2V0OiBNYXRoLm1pbih0YXJnZXRPZmZzZXRzLmZvY3VzLm9mZnNldCwgb3JpZ2luYWxUZXh0QmVmb3JlLmxlbmd0aClcbiAgICB9XG4gIH0sIGFuY2hvckJhY2t3YXJkcyA9IGJsb2NrT2Zmc2V0VG9TcGFuU2VsZWN0aW9uUG9pbnQoe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2tPZmZzZXQ6IG5vcm1hbGl6ZWRPZmZzZXRzLmFuY2hvcixcbiAgICBkaXJlY3Rpb246IFwiYmFja3dhcmRcIlxuICB9KSwgZm9jdXNGb3J3YXJkcyA9IGJsb2NrT2Zmc2V0VG9TcGFuU2VsZWN0aW9uUG9pbnQoe1xuICAgIGNvbnRleHQ6IHNuYXBzaG90LmNvbnRleHQsXG4gICAgYmxvY2tPZmZzZXQ6IG5vcm1hbGl6ZWRPZmZzZXRzLmZvY3VzLFxuICAgIGRpcmVjdGlvbjogXCJmb3J3YXJkXCJcbiAgfSk7XG4gIGlmICghYW5jaG9yQmFja3dhcmRzIHx8ICFmb2N1c0ZvcndhcmRzKVxuICAgIHJldHVybjtcbiAgY29uc3Qgc2VsZWN0aW9uID0ge1xuICAgIGFuY2hvcjogYW5jaG9yQmFja3dhcmRzLFxuICAgIGZvY3VzOiBmb2N1c0ZvcndhcmRzXG4gIH0sIGlubGluZU9iamVjdHNBZnRlck1hdGNoID0gZ2V0TmV4dElubGluZU9iamVjdHMoe1xuICAgIC4uLnNuYXBzaG90LFxuICAgIGNvbnRleHQ6IHtcbiAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgYW5jaG9yOiBzZWxlY3Rpb24uYW5jaG9yLFxuICAgICAgICBmb2N1czogc2VsZWN0aW9uLmFuY2hvclxuICAgICAgfVxuICAgIH1cbiAgfSksIGlubGluZU9iamVjdHNCZWZvcmUgPSBnZXRQcmV2aW91c0lubGluZU9iamVjdHMoc25hcHNob3QpO1xuICBpZiAoIWlubGluZU9iamVjdHNBZnRlck1hdGNoLnNvbWUoKGlubGluZU9iamVjdEFmdGVyKSA9PiBpbmxpbmVPYmplY3RzQmVmb3JlLnNvbWUoKGlubGluZU9iamVjdEJlZm9yZSkgPT4gaW5saW5lT2JqZWN0QWZ0ZXIubm9kZS5fa2V5ID09PSBpbmxpbmVPYmplY3RCZWZvcmUubm9kZS5fa2V5KSkpXG4gICAgcmV0dXJuIHtcbiAgICAgIHRleHQsXG4gICAgICBzZWxlY3Rpb24sXG4gICAgICB0YXJnZXRPZmZzZXRzXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGRlZmluZUlucHV0UnVsZUJlaGF2aW9yKGNvbmZpZykge1xuICByZXR1cm4gZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC50ZXh0XCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50LFxuICAgICAgZG9tXG4gICAgfSkgPT4ge1xuICAgICAgaWYgKCFzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiB8fCAhaXNTZWxlY3Rpb25Db2xsYXBzZWQoc25hcHNob3QuY29udGV4dC5zZWxlY3Rpb24pKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBmb2N1c0Jsb2NrID0gZ2V0Rm9jdXNCbG9jayhzbmFwc2hvdCk7XG4gICAgICBpZiAoIWZvY3VzQmxvY2spXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dEJlZm9yZSA9IGdldEJsb2NrVGV4dEJlZm9yZShzbmFwc2hvdCk7XG4gICAgICBsZXQgdGV4dEJlZm9yZSA9IG9yaWdpbmFsVGV4dEJlZm9yZTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsTmV3VGV4dCA9IHRleHRCZWZvcmUgKyBldmVudC50ZXh0O1xuICAgICAgbGV0IG5ld1RleHQgPSBvcmlnaW5hbE5ld1RleHQ7XG4gICAgICBjb25zdCBmb3VuZE1hdGNoZXMgPSBbXSwgZm91bmRBY3Rpb25zID0gW107XG4gICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgY29uZmlnLnJ1bGVzKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXIgPSBuZXcgUmVnRXhwKHJ1bGUub24uc291cmNlLCBcImdkXCIpO1xuICAgICAgICBmb3IgKDsgOyApIHtcbiAgICAgICAgICBjb25zdCBydWxlTWF0Y2hlcyA9IFsuLi5uZXdUZXh0Lm1hdGNoQWxsKG1hdGNoZXIpXS5mbGF0TWFwKChyZWdFeHBNYXRjaCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlZ0V4cE1hdGNoLmluZGljZXMgPT09IHZvaWQgMClcbiAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSByZWdFeHBNYXRjaC5pbmRpY2VzLmF0KDApO1xuICAgICAgICAgICAgaWYgKCFtYXRjaClcbiAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgY29uc3QgbWF0Y2hMb2NhdGlvbiA9IGdldElucHV0UnVsZU1hdGNoTG9jYXRpb24oe1xuICAgICAgICAgICAgICBtYXRjaDogW3JlZ0V4cE1hdGNoLmF0KDApID8/IFwiXCIsIC4uLm1hdGNoXSxcbiAgICAgICAgICAgICAgYWRqdXN0SW5kZXhCeTogb3JpZ2luYWxOZXdUZXh0Lmxlbmd0aCAtIG5ld1RleHQubGVuZ3RoLFxuICAgICAgICAgICAgICBzbmFwc2hvdCxcbiAgICAgICAgICAgICAgZm9jdXNCbG9jayxcbiAgICAgICAgICAgICAgb3JpZ2luYWxUZXh0QmVmb3JlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghbWF0Y2hMb2NhdGlvbilcbiAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgaWYgKG1hdGNoTG9jYXRpb24udGFyZ2V0T2Zmc2V0cy5mb2N1cy5vZmZzZXQgPD0gb3JpZ2luYWxUZXh0QmVmb3JlLmxlbmd0aClcbiAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgaWYgKGZvdW5kTWF0Y2hlcy5zb21lKChmb3VuZE1hdGNoKSA9PiBmb3VuZE1hdGNoLnRhcmdldE9mZnNldHMuYW5jaG9yLm9mZnNldCA9PT0gbWF0Y2hMb2NhdGlvbi50YXJnZXRPZmZzZXRzLmFuY2hvci5vZmZzZXQpKVxuICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICBjb25zdCBncm91cE1hdGNoZXMgPSByZWdFeHBNYXRjaC5pbmRpY2VzLmxlbmd0aCA+IDEgPyByZWdFeHBNYXRjaC5pbmRpY2VzLnNsaWNlKDEpLmZpbHRlcigoaW5kaWNlcykgPT4gaW5kaWNlcyAhPT0gdm9pZCAwKSA6IFtdO1xuICAgICAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICAgIHRleHQ6IG1hdGNoTG9jYXRpb24udGV4dCxcbiAgICAgICAgICAgICAgc2VsZWN0aW9uOiBtYXRjaExvY2F0aW9uLnNlbGVjdGlvbixcbiAgICAgICAgICAgICAgdGFyZ2V0T2Zmc2V0czogbWF0Y2hMb2NhdGlvbi50YXJnZXRPZmZzZXRzLFxuICAgICAgICAgICAgICBncm91cE1hdGNoZXM6IGdyb3VwTWF0Y2hlcy5mbGF0TWFwKChtYXRjaDIsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IHJlZ0V4cE1hdGNoLmF0KGluZGV4ICsgMSkgPz8gXCJcIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0SW5wdXRSdWxlTWF0Y2hMb2NhdGlvbih7XG4gICAgICAgICAgICAgICAgICBtYXRjaDogW3RleHQsIC4uLm1hdGNoMl0sXG4gICAgICAgICAgICAgICAgICBhZGp1c3RJbmRleEJ5OiBvcmlnaW5hbE5ld1RleHQubGVuZ3RoIC0gbmV3VGV4dC5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICBzbmFwc2hvdCxcbiAgICAgICAgICAgICAgICAgIGZvY3VzQmxvY2ssXG4gICAgICAgICAgICAgICAgICBvcmlnaW5hbFRleHRCZWZvcmVcbiAgICAgICAgICAgICAgICB9KSB8fCBbXTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1dO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmIChydWxlTWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBndWFyZFJlc3VsdCA9IHJ1bGUuZ3VhcmQ/Lih7XG4gICAgICAgICAgICAgIHNuYXBzaG90LFxuICAgICAgICAgICAgICBldmVudDoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiY3VzdG9tLmlucHV0IHJ1bGVcIixcbiAgICAgICAgICAgICAgICBtYXRjaGVzOiBydWxlTWF0Y2hlcyxcbiAgICAgICAgICAgICAgICBmb2N1c0Jsb2NrLFxuICAgICAgICAgICAgICAgIHRleHRCZWZvcmU6IG9yaWdpbmFsVGV4dEJlZm9yZSxcbiAgICAgICAgICAgICAgICB0ZXh0SW5zZXJ0ZWQ6IGV2ZW50LnRleHRcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZG9tXG4gICAgICAgICAgICB9KSA/PyAhMDtcbiAgICAgICAgICAgIGlmICghZ3VhcmRSZXN1bHQpXG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY29uc3QgYWN0aW9uU2V0cyA9IHJ1bGUuYWN0aW9ucy5tYXAoKGFjdGlvbikgPT4gYWN0aW9uKHtcbiAgICAgICAgICAgICAgc25hcHNob3QsXG4gICAgICAgICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJjdXN0b20uaW5wdXQgcnVsZVwiLFxuICAgICAgICAgICAgICAgIG1hdGNoZXM6IHJ1bGVNYXRjaGVzLFxuICAgICAgICAgICAgICAgIGZvY3VzQmxvY2ssXG4gICAgICAgICAgICAgICAgdGV4dEJlZm9yZTogb3JpZ2luYWxUZXh0QmVmb3JlLFxuICAgICAgICAgICAgICAgIHRleHRJbnNlcnRlZDogZXZlbnQudGV4dFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBkb21cbiAgICAgICAgICAgIH0sIGd1YXJkUmVzdWx0KSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGFjdGlvblNldCBvZiBhY3Rpb25TZXRzKVxuICAgICAgICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25TZXQpXG4gICAgICAgICAgICAgICAgZm91bmRBY3Rpb25zLnB1c2goYWN0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBydWxlTWF0Y2hlcy5mbGF0TWFwKChtYXRjaCkgPT4gbWF0Y2guZ3JvdXBNYXRjaGVzLmxlbmd0aCA9PT0gMCA/IFttYXRjaF0gOiBtYXRjaC5ncm91cE1hdGNoZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBtYXRjaCBvZiBtYXRjaGVzKVxuICAgICAgICAgICAgICBmb3VuZE1hdGNoZXMucHVzaChtYXRjaCksIHRleHRCZWZvcmUgPSBuZXdUZXh0LnNsaWNlKDAsIG1hdGNoLnRhcmdldE9mZnNldHMuZm9jdXMub2Zmc2V0ID8/IDApLCBuZXdUZXh0ID0gb3JpZ2luYWxOZXdUZXh0LnNsaWNlKG1hdGNoLnRhcmdldE9mZnNldHMuZm9jdXMub2Zmc2V0ID8/IDApO1xuICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmb3VuZEFjdGlvbnMubGVuZ3RoID09PSAwID8gITEgOiB7XG4gICAgICAgIGFjdGlvbnM6IGZvdW5kQWN0aW9uc1xuICAgICAgfTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9KSA9PiBbZm9yd2FyZChldmVudCldLCAoXywge1xuICAgICAgYWN0aW9uc1xuICAgIH0pID0+IGFjdGlvbnMsICh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0pID0+IFtlZmZlY3QoKCkgPT4ge1xuICAgICAgY29uc3QgYmxvY2tPZmZzZXRzID0gZ2V0QmxvY2tPZmZzZXRzKHNuYXBzaG90KTtcbiAgICAgIGNvbmZpZy5vbkFwcGx5Py4oe1xuICAgICAgICBlbmRPZmZzZXRzOiBibG9ja09mZnNldHNcbiAgICAgIH0pO1xuICAgIH0pXV1cbiAgfSk7XG59XG5mdW5jdGlvbiBJbnB1dFJ1bGVQbHVnaW4ocHJvcHMpIHtcbiAgY29uc3QgJCA9IGMoMyksIGVkaXRvciA9IHVzZUVkaXRvcigpO1xuICBsZXQgdDA7XG4gIHJldHVybiAkWzBdICE9PSBlZGl0b3IgfHwgJFsxXSAhPT0gcHJvcHMucnVsZXMgPyAodDAgPSB7XG4gICAgaW5wdXQ6IHtcbiAgICAgIGVkaXRvcixcbiAgICAgIHJ1bGVzOiBwcm9wcy5ydWxlc1xuICAgIH1cbiAgfSwgJFswXSA9IGVkaXRvciwgJFsxXSA9IHByb3BzLnJ1bGVzLCAkWzJdID0gdDApIDogdDAgPSAkWzJdLCB1c2VBY3RvclJlZihpbnB1dFJ1bGVNYWNoaW5lLCB0MCksIG51bGw7XG59XG5jb25zdCBpbnB1dFJ1bGVMaXN0ZW5lckNhbGxiYWNrID0gKHtcbiAgaW5wdXQsXG4gIHNlbmRCYWNrXG59KSA9PiB7XG4gIGNvbnN0IHVucmVnaXN0ZXIgPSBpbnB1dC5lZGl0b3IucmVnaXN0ZXJCZWhhdmlvcih7XG4gICAgYmVoYXZpb3I6IGRlZmluZUlucHV0UnVsZUJlaGF2aW9yKHtcbiAgICAgIHJ1bGVzOiBpbnB1dC5ydWxlcyxcbiAgICAgIG9uQXBwbHk6ICh7XG4gICAgICAgIGVuZE9mZnNldHNcbiAgICAgIH0pID0+IHtcbiAgICAgICAgc2VuZEJhY2soe1xuICAgICAgICAgIHR5cGU6IFwiaW5wdXQgcnVsZSByYWlzZWRcIixcbiAgICAgICAgICBlbmRPZmZzZXRzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pXG4gIH0pO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIHVucmVnaXN0ZXIoKTtcbiAgfTtcbn0sIGRlbGV0ZUJhY2t3YXJkTGlzdGVuZXJDYWxsYmFjayA9ICh7XG4gIGlucHV0LFxuICBzZW5kQmFja1xufSkgPT4gaW5wdXQuZWRpdG9yLnJlZ2lzdGVyQmVoYXZpb3Ioe1xuICBiZWhhdmlvcjogZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImRlbGV0ZS5iYWNrd2FyZFwiLFxuICAgIGFjdGlvbnM6IFsoKSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJoaXN0b3J5LnVuZG9cIlxuICAgIH0pLCBlZmZlY3QoKCkgPT4ge1xuICAgICAgc2VuZEJhY2soe1xuICAgICAgICB0eXBlOiBcImhpc3RvcnkudW5kbyByYWlzZWRcIlxuICAgICAgfSk7XG4gICAgfSldXVxuICB9KVxufSksIHNlbGVjdGlvbkxpc3RlbmVyQ2FsbGJhY2sgPSAoe1xuICBzZW5kQmFjayxcbiAgaW5wdXRcbn0pID0+IGlucHV0LmVkaXRvci5yZWdpc3RlckJlaGF2aW9yKHtcbiAgYmVoYXZpb3I6IGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJzZWxlY3RcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiAoe1xuICAgICAgYmxvY2tPZmZzZXRzOiBnZXRCbG9ja09mZnNldHMoe1xuICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgc2VsZWN0aW9uOiBldmVudC5hdFxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pLFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBibG9ja09mZnNldHNcbiAgICB9KSA9PiBbZWZmZWN0KCgpID0+IHtcbiAgICAgIHNlbmRCYWNrKHtcbiAgICAgICAgdHlwZTogXCJzZWxlY3Rpb24gY2hhbmdlZFwiLFxuICAgICAgICBibG9ja09mZnNldHNcbiAgICAgIH0pO1xuICAgIH0pLCBmb3J3YXJkKGV2ZW50KV1dXG4gIH0pXG59KSwgaW5wdXRSdWxlU2V0dXAgPSBzZXR1cCh7XG4gIHR5cGVzOiB7XG4gICAgY29udGV4dDoge30sXG4gICAgaW5wdXQ6IHt9LFxuICAgIGV2ZW50czoge31cbiAgfSxcbiAgYWN0b3JzOiB7XG4gICAgXCJkZWxldGUuYmFja3dhcmQgbGlzdGVuZXJcIjogZnJvbUNhbGxiYWNrKGRlbGV0ZUJhY2t3YXJkTGlzdGVuZXJDYWxsYmFjayksXG4gICAgXCJpbnB1dCBydWxlIGxpc3RlbmVyXCI6IGZyb21DYWxsYmFjayhpbnB1dFJ1bGVMaXN0ZW5lckNhbGxiYWNrKSxcbiAgICBcInNlbGVjdGlvbiBsaXN0ZW5lclwiOiBmcm9tQ2FsbGJhY2soc2VsZWN0aW9uTGlzdGVuZXJDYWxsYmFjaylcbiAgfSxcbiAgZ3VhcmRzOiB7XG4gICAgXCJibG9jayBvZmZzZXQgY2hhbmdlZFwiOiAoe1xuICAgICAgY29udGV4dCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnR5cGUgIT09IFwic2VsZWN0aW9uIGNoYW5nZWRcIilcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgaWYgKCFldmVudC5ibG9ja09mZnNldHMgfHwgIWNvbnRleHQuZW5kT2Zmc2V0cylcbiAgICAgICAgcmV0dXJuICEwO1xuICAgICAgY29uc3Qgc3RhcnRDaGFuZ2VkID0gY29udGV4dC5lbmRPZmZzZXRzLnN0YXJ0LnBhdGhbMF0uX2tleSAhPT0gZXZlbnQuYmxvY2tPZmZzZXRzLnN0YXJ0LnBhdGhbMF0uX2tleSB8fCBjb250ZXh0LmVuZE9mZnNldHMuc3RhcnQub2Zmc2V0ICE9PSBldmVudC5ibG9ja09mZnNldHMuc3RhcnQub2Zmc2V0LCBlbmRDaGFuZ2VkID0gY29udGV4dC5lbmRPZmZzZXRzLmVuZC5wYXRoWzBdLl9rZXkgIT09IGV2ZW50LmJsb2NrT2Zmc2V0cy5lbmQucGF0aFswXS5fa2V5IHx8IGNvbnRleHQuZW5kT2Zmc2V0cy5lbmQub2Zmc2V0ICE9PSBldmVudC5ibG9ja09mZnNldHMuZW5kLm9mZnNldDtcbiAgICAgIHJldHVybiBzdGFydENoYW5nZWQgfHwgZW5kQ2hhbmdlZDtcbiAgICB9XG4gIH1cbn0pLCBhc3NpZ25FbmRPZmZzZXRzID0gaW5wdXRSdWxlU2V0dXAuYXNzaWduKHtcbiAgZW5kT2Zmc2V0czogKHtcbiAgICBjb250ZXh0LFxuICAgIGV2ZW50XG4gIH0pID0+IGV2ZW50LnR5cGUgPT09IFwiaW5wdXQgcnVsZSByYWlzZWRcIiA/IGV2ZW50LmVuZE9mZnNldHMgOiBjb250ZXh0LmVuZE9mZnNldHNcbn0pLCBpbnB1dFJ1bGVNYWNoaW5lID0gaW5wdXRSdWxlU2V0dXAuY3JlYXRlTWFjaGluZSh7XG4gIGlkOiBcImlucHV0IHJ1bGVcIixcbiAgY29udGV4dDogKHtcbiAgICBpbnB1dFxuICB9KSA9PiAoe1xuICAgIGVkaXRvcjogaW5wdXQuZWRpdG9yLFxuICAgIHJ1bGVzOiBpbnB1dC5ydWxlcyxcbiAgICBlbmRPZmZzZXRzOiB2b2lkIDBcbiAgfSksXG4gIGluaXRpYWw6IFwiaWRsZVwiLFxuICBpbnZva2U6IHtcbiAgICBzcmM6IFwiaW5wdXQgcnVsZSBsaXN0ZW5lclwiLFxuICAgIGlucHV0OiAoe1xuICAgICAgY29udGV4dFxuICAgIH0pID0+ICh7XG4gICAgICBlZGl0b3I6IGNvbnRleHQuZWRpdG9yLFxuICAgICAgcnVsZXM6IGNvbnRleHQucnVsZXNcbiAgICB9KVxuICB9LFxuICBvbjoge1xuICAgIFwiaW5wdXQgcnVsZSByYWlzZWRcIjoge1xuICAgICAgdGFyZ2V0OiBcIi5pbnB1dCBydWxlIGFwcGxpZWRcIixcbiAgICAgIGFjdGlvbnM6IGFzc2lnbkVuZE9mZnNldHNcbiAgICB9XG4gIH0sXG4gIHN0YXRlczoge1xuICAgIGlkbGU6IHt9LFxuICAgIFwiaW5wdXQgcnVsZSBhcHBsaWVkXCI6IHtcbiAgICAgIGludm9rZTogW3tcbiAgICAgICAgc3JjOiBcImRlbGV0ZS5iYWNrd2FyZCBsaXN0ZW5lclwiLFxuICAgICAgICBpbnB1dDogKHtcbiAgICAgICAgICBjb250ZXh0XG4gICAgICAgIH0pID0+ICh7XG4gICAgICAgICAgZWRpdG9yOiBjb250ZXh0LmVkaXRvclxuICAgICAgICB9KVxuICAgICAgfSwge1xuICAgICAgICBzcmM6IFwic2VsZWN0aW9uIGxpc3RlbmVyXCIsXG4gICAgICAgIGlucHV0OiAoe1xuICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgfSkgPT4gKHtcbiAgICAgICAgICBlZGl0b3I6IGNvbnRleHQuZWRpdG9yXG4gICAgICAgIH0pXG4gICAgICB9XSxcbiAgICAgIG9uOiB7XG4gICAgICAgIFwic2VsZWN0aW9uIGNoYW5nZWRcIjoge1xuICAgICAgICAgIHRhcmdldDogXCJpZGxlXCIsXG4gICAgICAgICAgZ3VhcmQ6IFwiYmxvY2sgb2Zmc2V0IGNoYW5nZWRcIlxuICAgICAgICB9LFxuICAgICAgICBcImhpc3RvcnkudW5kbyByYWlzZWRcIjoge1xuICAgICAgICAgIHRhcmdldDogXCJpZGxlXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5mdW5jdGlvbiBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZShjb25maWcpIHtcbiAgcmV0dXJuIHtcbiAgICBvbjogY29uZmlnLm9uLFxuICAgIGd1YXJkOiBjb25maWcuZ3VhcmQgPz8gKCgpID0+ICEwKSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9LCBndWFyZFJlc3BvbnNlKSA9PiB7XG4gICAgICBjb25zdCBsb2NhdGlvbnMgPSBldmVudC5tYXRjaGVzLmZsYXRNYXAoKG1hdGNoKSA9PiBtYXRjaC5ncm91cE1hdGNoZXMubGVuZ3RoID09PSAwID8gW21hdGNoXSA6IG1hdGNoLmdyb3VwTWF0Y2hlcyksIG5ld1RleHQgPSBldmVudC50ZXh0QmVmb3JlICsgZXZlbnQudGV4dEluc2VydGVkO1xuICAgICAgbGV0IHRleHRMZW5ndGhEZWx0YSA9IDA7XG4gICAgICBjb25zdCBhY3Rpb25zID0gW107XG4gICAgICBmb3IgKGNvbnN0IGxvY2F0aW9uIG9mIGxvY2F0aW9ucy5yZXZlcnNlKCkpIHtcbiAgICAgICAgY29uc3QgdGV4dCA9IGNvbmZpZy50cmFuc2Zvcm0oe1xuICAgICAgICAgIGxvY2F0aW9uXG4gICAgICAgIH0sIGd1YXJkUmVzcG9uc2UpO1xuICAgICAgICB0ZXh0TGVuZ3RoRGVsdGEgPSB0ZXh0TGVuZ3RoRGVsdGEgLSAodGV4dC5sZW5ndGggLSAobG9jYXRpb24udGFyZ2V0T2Zmc2V0cy5mb2N1cy5vZmZzZXQgLSBsb2NhdGlvbi50YXJnZXRPZmZzZXRzLmFuY2hvci5vZmZzZXQpKSwgYWN0aW9ucy5wdXNoKHJhaXNlKHtcbiAgICAgICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgICAgIGF0OiBsb2NhdGlvbi50YXJnZXRPZmZzZXRzXG4gICAgICAgIH0pKSwgYWN0aW9ucy5wdXNoKHJhaXNlKHtcbiAgICAgICAgICB0eXBlOiBcImRlbGV0ZVwiLFxuICAgICAgICAgIGF0OiBsb2NhdGlvbi50YXJnZXRPZmZzZXRzXG4gICAgICAgIH0pKSwgYWN0aW9ucy5wdXNoKHJhaXNlKHtcbiAgICAgICAgICB0eXBlOiBcImluc2VydC5jaGlsZFwiLFxuICAgICAgICAgIGNoaWxkOiB7XG4gICAgICAgICAgICBfdHlwZTogc25hcHNob3QuY29udGV4dC5zY2hlbWEuc3Bhbi5uYW1lLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIG1hcmtzOiBnZXRNYXJrU3RhdGUoe1xuICAgICAgICAgICAgICAuLi5zbmFwc2hvdCxcbiAgICAgICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgICAgIC4uLnNuYXBzaG90LmNvbnRleHQsXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgICAgICAgICBhbmNob3I6IGxvY2F0aW9uLnNlbGVjdGlvbi5hbmNob3IsXG4gICAgICAgICAgICAgICAgICBmb2N1czoge1xuICAgICAgICAgICAgICAgICAgICBwYXRoOiBsb2NhdGlvbi5zZWxlY3Rpb24uZm9jdXMucGF0aCxcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBNYXRoLm1pbihsb2NhdGlvbi5zZWxlY3Rpb24uZm9jdXMub2Zmc2V0LCBldmVudC50ZXh0QmVmb3JlLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pPy5tYXJrcyA/PyBbXVxuICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgY29uc3QgZW5kQ2FyZXRQb3NpdGlvbiA9IHtcbiAgICAgICAgcGF0aDogZXZlbnQuZm9jdXNCbG9jay5wYXRoLFxuICAgICAgICBvZmZzZXQ6IG5ld1RleHQubGVuZ3RoIC0gdGV4dExlbmd0aERlbHRhXG4gICAgICB9O1xuICAgICAgcmV0dXJuIFsuLi5hY3Rpb25zLCByYWlzZSh7XG4gICAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICAgIGF0OiB7XG4gICAgICAgICAgYW5jaG9yOiBlbmRDYXJldFBvc2l0aW9uLFxuICAgICAgICAgIGZvY3VzOiBlbmRDYXJldFBvc2l0aW9uXG4gICAgICAgIH1cbiAgICAgIH0pXTtcbiAgICB9XVxuICB9O1xufVxuZXhwb3J0IHtcbiAgSW5wdXRSdWxlUGx1Z2luLFxuICBkZWZpbmVJbnB1dFJ1bGUsXG4gIGRlZmluZUlucHV0UnVsZUJlaGF2aW9yLFxuICBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/plugin-input-rule/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/plugin-markdown-shortcuts/dist/index.js":
/*!****************************************************************************!*\
  !*** ./node_modules/@portabletext/plugin-markdown-shortcuts/dist/index.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MarkdownShortcutsPlugin: () => (/* binding */ MarkdownShortcutsPlugin)\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-jsx-runtime.js\");\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n/* harmony import */ var _portabletext_editor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @portabletext/editor */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\");\n/* harmony import */ var _portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @portabletext/plugin-character-pair-decorator */ \"(ssr)/./node_modules/@portabletext/plugin-character-pair-decorator/dist/index.js\");\n/* harmony import */ var _portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @portabletext/plugin-input-rule */ \"(ssr)/./node_modules/@portabletext/plugin-input-rule/dist/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @portabletext/editor/behaviors */ \"(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js\");\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n\n\n\n\n\n\n\n\n\nfunction createMarkdownBehaviors(config) {\n  const automaticHrOnPaste = (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.defineBehavior)({\n    on: \"clipboard.paste\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const text = event.originEvent.dataTransfer.getData(\"text/plain\"), hrRegExp = /^(---)$|^(-)$|^(___)$|^(\\*\\*\\*)$/, hrCharacters = text.match(hrRegExp)?.[0], hrObject = config.horizontalRuleObject?.({\n        context: {\n          schema: snapshot.context.schema,\n          keyGenerator: snapshot.context.keyGenerator\n        }\n      }), focusBlock = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getFocusBlock(snapshot), focusTextBlock = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getFocusTextBlock(snapshot);\n      return !hrCharacters || !hrObject || !focusBlock ? !1 : {\n        hrCharacters,\n        hrObject,\n        focusBlock,\n        focusTextBlock\n      };\n    },\n    actions: [(_, {\n      hrCharacters\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"insert.text\",\n      text: hrCharacters\n    })], ({\n      snapshot\n    }, {\n      hrObject,\n      focusBlock,\n      focusTextBlock\n    }) => focusTextBlock ? [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"insert.block\",\n      block: {\n        _type: snapshot.context.schema.block.name,\n        children: focusTextBlock.node.children\n      },\n      placement: \"after\"\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"insert.block\",\n      block: hrObject,\n      placement: \"after\"\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"delete.block\",\n      at: focusBlock.path\n    })] : [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"insert.block\",\n      block: hrObject,\n      placement: \"after\"\n    })]]\n  }), clearStyleOnBackspace = (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.defineBehavior)({\n    on: \"delete.backward\",\n    guard: ({\n      snapshot\n    }) => {\n      const selectionCollapsed = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.isSelectionCollapsed(snapshot), focusTextBlock = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getFocusTextBlock(snapshot), focusSpan = _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getFocusSpan(snapshot);\n      if (!selectionCollapsed || !focusTextBlock || !focusSpan)\n        return !1;\n      const atTheBeginningOfBLock = focusTextBlock.node.children[0]._key === focusSpan.node._key && snapshot.context.selection?.focus.offset === 0, defaultStyle = config.defaultStyle?.({\n        context: {\n          schema: snapshot.context.schema\n        },\n        schema: snapshot.context.schema\n      });\n      return atTheBeginningOfBLock && defaultStyle && focusTextBlock.node.style !== defaultStyle ? {\n        defaultStyle,\n        focusTextBlock\n      } : !1;\n    },\n    actions: [(_, {\n      defaultStyle,\n      focusTextBlock\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.set\",\n      props: {\n        style: defaultStyle\n      },\n      at: focusTextBlock.path\n    })]]\n  });\n  return [automaticHrOnPaste, clearStyleOnBackspace];\n}\nfunction createBlockquoteRule(config) {\n  return (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.defineInputRule)({\n    on: /^> /,\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const style = config.blockquoteStyle({\n        context: {\n          schema: snapshot.context.schema\n        },\n        schema: snapshot.context.schema\n      });\n      if (!style || (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getPreviousInlineObject)(snapshot))\n        return !1;\n      const match = event.matches.at(0);\n      return match ? {\n        style,\n        match\n      } : !1;\n    },\n    actions: [({\n      event\n    }, {\n      style,\n      match\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.unset\",\n      props: [\"listItem\", \"level\"],\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.set\",\n      props: {\n        style\n      },\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"delete\",\n      at: match.targetOffsets\n    })]]\n  });\n}\nfunction createHeadingRule(config) {\n  return (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.defineInputRule)({\n    on: /^#+ /,\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      if ((0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getPreviousInlineObject)(snapshot))\n        return !1;\n      const match = event.matches.at(0);\n      if (!match)\n        return !1;\n      const level = match.text.length - 1, style = config.headingStyle({\n        context: {\n          schema: snapshot.context.schema\n        },\n        schema: snapshot.context.schema,\n        props: {\n          level\n        },\n        level\n      });\n      return style ? {\n        match,\n        style\n      } : !1;\n    },\n    actions: [({\n      event\n    }, {\n      match,\n      style\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.unset\",\n      props: [\"listItem\", \"level\"],\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.set\",\n      props: {\n        style\n      },\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"delete\",\n      at: match.targetOffsets\n    })]]\n  });\n}\nfunction createHorizontalRuleRule(config) {\n  return (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.defineInputRule)({\n    on: /^(---)|^(-)|^(___)|^(\\*\\*\\*)/,\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const hrObject = config.horizontalRuleObject({\n        context: {\n          schema: snapshot.context.schema,\n          keyGenerator: snapshot.context.keyGenerator\n        }\n      });\n      if (!hrObject || (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getPreviousInlineObject)(snapshot))\n        return !1;\n      const match = event.matches.at(0);\n      return match ? {\n        hrObject,\n        match\n      } : !1;\n    },\n    actions: [(_, {\n      hrObject,\n      match\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"insert.block\",\n      block: hrObject,\n      placement: \"before\",\n      select: \"none\"\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"delete\",\n      at: match.targetOffsets\n    })]]\n  });\n}\nfunction createMarkdownLinkRule(config) {\n  return (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.defineInputRule)({\n    on: /\\[([^[\\]]+)]\\((.+)\\)/,\n    actions: [({\n      snapshot,\n      event\n    }) => {\n      const newText = event.textBefore + event.textInserted;\n      let textLengthDelta = 0;\n      const actions = [];\n      for (const match of event.matches.reverse()) {\n        const textMatch = match.groupMatches.at(0), hrefMatch = match.groupMatches.at(1);\n        if (textMatch === void 0 || hrefMatch === void 0)\n          continue;\n        textLengthDelta = textLengthDelta - (match.targetOffsets.focus.offset - match.targetOffsets.anchor.offset - textMatch.text.length);\n        const linkObject = config.linkObject({\n          context: {\n            schema: snapshot.context.schema,\n            keyGenerator: snapshot.context.keyGenerator\n          },\n          props: {\n            href: hrefMatch.text\n          }\n        });\n        if (!linkObject)\n          continue;\n        const {\n          _type,\n          _key,\n          ...value\n        } = linkObject, leftSideOffsets = {\n          anchor: match.targetOffsets.anchor,\n          focus: textMatch.targetOffsets.anchor\n        }, rightSideOffsets = {\n          anchor: textMatch.targetOffsets.focus,\n          focus: match.targetOffsets.focus\n        };\n        actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"select\",\n          at: textMatch.targetOffsets\n        })), actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"annotation.add\",\n          annotation: {\n            name: _type,\n            _key,\n            value\n          }\n        })), actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"delete\",\n          at: rightSideOffsets\n        })), actions.push((0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n          type: \"delete\",\n          at: leftSideOffsets\n        }));\n      }\n      const endCaretPosition = {\n        path: event.focusBlock.path,\n        offset: newText.length - textLengthDelta * -1\n      };\n      return [...actions, (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n        type: \"select\",\n        at: {\n          anchor: endCaretPosition,\n          focus: endCaretPosition\n        }\n      })];\n    }]\n  });\n}\nfunction createOrderedListRule(config) {\n  return (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.defineInputRule)({\n    on: /^1\\. /,\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const orderedList = config.orderedList({\n        context: {\n          schema: snapshot.context.schema\n        },\n        schema: snapshot.context.schema\n      });\n      if (!orderedList || (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getPreviousInlineObject)(snapshot))\n        return !1;\n      const match = event.matches.at(0);\n      return match ? {\n        match,\n        orderedList\n      } : !1;\n    },\n    actions: [({\n      event\n    }, {\n      match,\n      orderedList\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.unset\",\n      props: [\"style\"],\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.set\",\n      props: {\n        listItem: orderedList,\n        level: event.focusBlock.node.level ?? 1\n      },\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"delete\",\n      at: match.targetOffsets\n    })]]\n  });\n}\nfunction createUnorderedListRule(config) {\n  return (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.defineInputRule)({\n    on: /^(-|\\*) /,\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const unorderedList = config.unorderedList({\n        context: {\n          schema: snapshot.context.schema\n        },\n        schema: snapshot.context.schema\n      });\n      if (!unorderedList || (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_4__.getPreviousInlineObject)(snapshot))\n        return !1;\n      const match = event.matches.at(0);\n      return match ? {\n        match,\n        unorderedList\n      } : !1;\n    },\n    actions: [({\n      event\n    }, {\n      match,\n      unorderedList\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.unset\",\n      props: [\"style\"],\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"block.set\",\n      props: {\n        listItem: unorderedList,\n        level: event.focusBlock.node.level ?? 1\n      },\n      at: event.focusBlock.path\n    }), (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_3__.raise)({\n      type: \"delete\",\n      at: match.targetOffsets\n    })]]\n  });\n}\nfunction MarkdownShortcutsPlugin(t0) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(39), {\n    blockquoteStyle,\n    boldDecorator,\n    codeDecorator,\n    defaultStyle,\n    headingStyle,\n    horizontalRuleObject,\n    linkObject,\n    italicDecorator,\n    orderedList,\n    strikeThroughDecorator,\n    unorderedList\n  } = t0, editor = (0,_portabletext_editor__WEBPACK_IMPORTED_MODULE_6__.useEditor)();\n  let t1, t2;\n  $[0] !== defaultStyle || $[1] !== editor ? (t1 = () => {\n    const unregisterBehaviors = createMarkdownBehaviors({\n      defaultStyle\n    }).map((behavior) => editor.registerBehavior({\n      behavior\n    }));\n    return () => {\n      for (const unregisterBehavior of unregisterBehaviors)\n        unregisterBehavior();\n    };\n  }, t2 = [defaultStyle, editor], $[0] = defaultStyle, $[1] = editor, $[2] = t1, $[3] = t2) : (t1 = $[2], t2 = $[3]), (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(t1, t2);\n  let rules;\n  if ($[4] !== blockquoteStyle || $[5] !== headingStyle || $[6] !== horizontalRuleObject || $[7] !== linkObject || $[8] !== orderedList || $[9] !== unorderedList) {\n    if (rules = [], blockquoteStyle) {\n      let t32;\n      $[11] !== blockquoteStyle ? (t32 = createBlockquoteRule({\n        blockquoteStyle\n      }), $[11] = blockquoteStyle, $[12] = t32) : t32 = $[12], rules.push(t32);\n    }\n    if (headingStyle) {\n      let t32;\n      $[13] !== headingStyle ? (t32 = createHeadingRule({\n        headingStyle\n      }), $[13] = headingStyle, $[14] = t32) : t32 = $[14], rules.push(t32);\n    }\n    if (horizontalRuleObject) {\n      let t32;\n      $[15] !== horizontalRuleObject ? (t32 = createHorizontalRuleRule({\n        horizontalRuleObject\n      }), $[15] = horizontalRuleObject, $[16] = t32) : t32 = $[16], rules.push(t32);\n    }\n    if (linkObject) {\n      let t32;\n      $[17] !== linkObject ? (t32 = createMarkdownLinkRule({\n        linkObject\n      }), $[17] = linkObject, $[18] = t32) : t32 = $[18], rules.push(t32);\n    }\n    if (orderedList) {\n      let t32;\n      $[19] !== orderedList ? (t32 = createOrderedListRule({\n        orderedList\n      }), $[19] = orderedList, $[20] = t32) : t32 = $[20], rules.push(t32);\n    }\n    if (unorderedList) {\n      let t32;\n      $[21] !== unorderedList ? (t32 = createUnorderedListRule({\n        unorderedList\n      }), $[21] = unorderedList, $[22] = t32) : t32 = $[22], rules.push(t32);\n    }\n    $[4] = blockquoteStyle, $[5] = headingStyle, $[6] = horizontalRuleObject, $[7] = linkObject, $[8] = orderedList, $[9] = unorderedList, $[10] = rules;\n  } else\n    rules = $[10];\n  const inputRules = rules.length > 0 ? rules : null;\n  let t3;\n  $[23] !== boldDecorator ? (t3 = boldDecorator ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, { children: [\n    /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__.CharacterPairDecoratorPlugin, { decorator: boldDecorator, pair: {\n      char: \"*\",\n      amount: 2\n    } }),\n    /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__.CharacterPairDecoratorPlugin, { decorator: boldDecorator, pair: {\n      char: \"_\",\n      amount: 2\n    } })\n  ] }) : null, $[23] = boldDecorator, $[24] = t3) : t3 = $[24];\n  let t4;\n  $[25] !== codeDecorator ? (t4 = codeDecorator ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__.CharacterPairDecoratorPlugin, { decorator: codeDecorator, pair: {\n    char: \"`\",\n    amount: 1\n  } }) : null, $[25] = codeDecorator, $[26] = t4) : t4 = $[26];\n  let t5;\n  $[27] !== italicDecorator ? (t5 = italicDecorator ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, { children: [\n    /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__.CharacterPairDecoratorPlugin, { decorator: italicDecorator, pair: {\n      char: \"*\",\n      amount: 1\n    } }),\n    /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__.CharacterPairDecoratorPlugin, { decorator: italicDecorator, pair: {\n      char: \"_\",\n      amount: 1\n    } })\n  ] }) : null, $[27] = italicDecorator, $[28] = t5) : t5 = $[28];\n  let t6;\n  $[29] !== strikeThroughDecorator ? (t6 = strikeThroughDecorator ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_character_pair_decorator__WEBPACK_IMPORTED_MODULE_7__.CharacterPairDecoratorPlugin, { decorator: strikeThroughDecorator, pair: {\n    char: \"~\",\n    amount: 2\n  } }) : null, $[29] = strikeThroughDecorator, $[30] = t6) : t6 = $[30];\n  let t7;\n  $[31] !== inputRules ? (t7 = inputRules ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_5__.InputRulePlugin, { rules: inputRules }) : null, $[31] = inputRules, $[32] = t7) : t7 = $[32];\n  let t8;\n  return $[33] !== t3 || $[34] !== t4 || $[35] !== t5 || $[36] !== t6 || $[37] !== t7 ? (t8 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, { children: [\n    t3,\n    t4,\n    t5,\n    t6,\n    t7\n  ] }), $[33] = t3, $[34] = t4, $[35] = t5, $[36] = t6, $[37] = t7, $[38] = t8) : t8 = $[38], t8;\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4tbWFya2Rvd24tc2hvcnRjdXRzL2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2I7QUFDTTtBQUM0QztBQUNWO0FBQ2pEO0FBQ3FDO0FBQ1g7QUFDYTtBQUN6RTtBQUNBLDZCQUE2Qiw4RUFBYztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxnQkFBZ0IseUVBQXVCLDZCQUE2Qiw2RUFBMkI7QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLLE1BQU0scUVBQUs7QUFDaEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLLHVCQUF1QixxRUFBSztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUssR0FBRyxxRUFBSztBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUssR0FBRyxxRUFBSztBQUNiO0FBQ0E7QUFDQSxLQUFLLE1BQU0scUVBQUs7QUFDaEI7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUcsMkJBQTJCLDhFQUFjO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxpQ0FBaUMsZ0ZBQThCLDZCQUE2Qiw2RUFBMkIsd0JBQXdCLHdFQUFzQjtBQUNySztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSyxNQUFNLHFFQUFLO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsU0FBUyxnRkFBZTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1Asb0JBQW9CLHVGQUF1QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLLE1BQU0scUVBQUs7QUFDaEI7QUFDQTtBQUNBO0FBQ0EsS0FBSyxHQUFHLHFFQUFLO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSyxHQUFHLHFFQUFLO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBLFNBQVMsZ0ZBQWU7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsVUFBVSx1RkFBdUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSyxNQUFNLHFFQUFLO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLEtBQUssR0FBRyxxRUFBSztBQUNiO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUssR0FBRyxxRUFBSztBQUNiO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQSxTQUFTLGdGQUFlO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsdUJBQXVCLHVGQUF1QjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLLE1BQU0scUVBQUs7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLEdBQUcscUVBQUs7QUFDYjtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0EsU0FBUyxnRkFBZTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixxRUFBSztBQUMxQjtBQUNBO0FBQ0EsU0FBUyxpQkFBaUIscUVBQUs7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxpQkFBaUIscUVBQUs7QUFDL0I7QUFDQTtBQUNBLFNBQVMsaUJBQWlCLHFFQUFLO0FBQy9CO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixxRUFBSztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBLFNBQVMsZ0ZBQWU7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLDBCQUEwQix1RkFBdUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSyxNQUFNLHFFQUFLO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLEtBQUssR0FBRyxxRUFBSztBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSyxHQUFHLHFFQUFLO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBLFNBQVMsZ0ZBQWU7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLDRCQUE0Qix1RkFBdUI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSyxNQUFNLHFFQUFLO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLEtBQUssR0FBRyxxRUFBSztBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSyxHQUFHLHFFQUFLO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBLFlBQVkseURBQUM7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxlQUFlLCtEQUFTO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxtSEFBbUgsZ0RBQVM7QUFDL0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSx1REFBSSxDQUFDLHVEQUFRLElBQUk7QUFDbkYsb0JBQW9CLHNEQUFHLENBQUMsdUdBQTRCLElBQUk7QUFDeEQ7QUFDQTtBQUNBLE9BQU87QUFDUCxvQkFBb0Isc0RBQUcsQ0FBQyx1R0FBNEIsSUFBSTtBQUN4RDtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBLGtFQUFrRSxzREFBRyxDQUFDLHVHQUE0QixJQUFJO0FBQ3RHO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxzRUFBc0UsdURBQUksQ0FBQyx1REFBUSxJQUFJO0FBQ3ZGLG9CQUFvQixzREFBRyxDQUFDLHVHQUE0QixJQUFJO0FBQ3hEO0FBQ0E7QUFDQSxPQUFPO0FBQ1Asb0JBQW9CLHNEQUFHLENBQUMsdUdBQTRCLElBQUk7QUFDeEQ7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQSxvRkFBb0Ysc0RBQUcsQ0FBQyx1R0FBNEIsSUFBSTtBQUN4SDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsNERBQTRELHNEQUFHLENBQUMsNEVBQWUsSUFBSSxtQkFBbUI7QUFDdEc7QUFDQSw4R0FBOEcsdURBQUksQ0FBQyx1REFBUSxJQUFJO0FBQy9IO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFHRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4tbWFya2Rvd24tc2hvcnRjdXRzL2Rpc3QvaW5kZXguanM/ZDNiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBqc3hzLCBGcmFnbWVudCwganN4IH0gZnJvbSBcInJlYWN0L2pzeC1ydW50aW1lXCI7XG5pbXBvcnQgeyBjIH0gZnJvbSBcInJlYWN0LWNvbXBpbGVyLXJ1bnRpbWVcIjtcbmltcG9ydCB7IHVzZUVkaXRvciB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L2VkaXRvclwiO1xuaW1wb3J0IHsgQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpbiB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L3BsdWdpbi1jaGFyYWN0ZXItcGFpci1kZWNvcmF0b3JcIjtcbmltcG9ydCB7IGRlZmluZUlucHV0UnVsZSwgSW5wdXRSdWxlUGx1Z2luIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvcGx1Z2luLWlucHV0LXJ1bGVcIjtcbmltcG9ydCB7IHVzZUVmZmVjdCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgZGVmaW5lQmVoYXZpb3IsIHJhaXNlIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvZWRpdG9yL2JlaGF2aW9yc1wiO1xuaW1wb3J0ICogYXMgc2VsZWN0b3JzIGZyb20gXCJAcG9ydGFibGV0ZXh0L2VkaXRvci9zZWxlY3RvcnNcIjtcbmltcG9ydCB7IGdldFByZXZpb3VzSW5saW5lT2JqZWN0IH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvZWRpdG9yL3NlbGVjdG9yc1wiO1xuZnVuY3Rpb24gY3JlYXRlTWFya2Rvd25CZWhhdmlvcnMoY29uZmlnKSB7XG4gIGNvbnN0IGF1dG9tYXRpY0hyT25QYXN0ZSA9IGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJjbGlwYm9hcmQucGFzdGVcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCB0ZXh0ID0gZXZlbnQub3JpZ2luRXZlbnQuZGF0YVRyYW5zZmVyLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpLCBoclJlZ0V4cCA9IC9eKC0tLSkkfF4o4oCULSkkfF4oX19fKSR8XihcXCpcXCpcXCopJC8sIGhyQ2hhcmFjdGVycyA9IHRleHQubWF0Y2goaHJSZWdFeHApPy5bMF0sIGhyT2JqZWN0ID0gY29uZmlnLmhvcml6b250YWxSdWxlT2JqZWN0Py4oe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICBrZXlHZW5lcmF0b3I6IHNuYXBzaG90LmNvbnRleHQua2V5R2VuZXJhdG9yXG4gICAgICAgIH1cbiAgICAgIH0pLCBmb2N1c0Jsb2NrID0gc2VsZWN0b3JzLmdldEZvY3VzQmxvY2soc25hcHNob3QpLCBmb2N1c1RleHRCbG9jayA9IHNlbGVjdG9ycy5nZXRGb2N1c1RleHRCbG9jayhzbmFwc2hvdCk7XG4gICAgICByZXR1cm4gIWhyQ2hhcmFjdGVycyB8fCAhaHJPYmplY3QgfHwgIWZvY3VzQmxvY2sgPyAhMSA6IHtcbiAgICAgICAgaHJDaGFyYWN0ZXJzLFxuICAgICAgICBock9iamVjdCxcbiAgICAgICAgZm9jdXNCbG9jayxcbiAgICAgICAgZm9jdXNUZXh0QmxvY2tcbiAgICAgIH07XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKF8sIHtcbiAgICAgIGhyQ2hhcmFjdGVyc1xuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC50ZXh0XCIsXG4gICAgICB0ZXh0OiBockNoYXJhY3RlcnNcbiAgICB9KV0sICh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0sIHtcbiAgICAgIGhyT2JqZWN0LFxuICAgICAgZm9jdXNCbG9jayxcbiAgICAgIGZvY3VzVGV4dEJsb2NrXG4gICAgfSkgPT4gZm9jdXNUZXh0QmxvY2sgPyBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJpbnNlcnQuYmxvY2tcIixcbiAgICAgIGJsb2NrOiB7XG4gICAgICAgIF90eXBlOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lLFxuICAgICAgICBjaGlsZHJlbjogZm9jdXNUZXh0QmxvY2subm9kZS5jaGlsZHJlblxuICAgICAgfSxcbiAgICAgIHBsYWNlbWVudDogXCJhZnRlclwiXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICBibG9jazogaHJPYmplY3QsXG4gICAgICBwbGFjZW1lbnQ6IFwiYWZ0ZXJcIlxuICAgIH0pLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZS5ibG9ja1wiLFxuICAgICAgYXQ6IGZvY3VzQmxvY2sucGF0aFxuICAgIH0pXSA6IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgICAgYmxvY2s6IGhyT2JqZWN0LFxuICAgICAgcGxhY2VtZW50OiBcImFmdGVyXCJcbiAgICB9KV1dXG4gIH0pLCBjbGVhclN0eWxlT25CYWNrc3BhY2UgPSBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiZGVsZXRlLmJhY2t3YXJkXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbkNvbGxhcHNlZCA9IHNlbGVjdG9ycy5pc1NlbGVjdGlvbkNvbGxhcHNlZChzbmFwc2hvdCksIGZvY3VzVGV4dEJsb2NrID0gc2VsZWN0b3JzLmdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KSwgZm9jdXNTcGFuID0gc2VsZWN0b3JzLmdldEZvY3VzU3BhbihzbmFwc2hvdCk7XG4gICAgICBpZiAoIXNlbGVjdGlvbkNvbGxhcHNlZCB8fCAhZm9jdXNUZXh0QmxvY2sgfHwgIWZvY3VzU3BhbilcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgYXRUaGVCZWdpbm5pbmdPZkJMb2NrID0gZm9jdXNUZXh0QmxvY2subm9kZS5jaGlsZHJlblswXS5fa2V5ID09PSBmb2N1c1NwYW4ubm9kZS5fa2V5ICYmIHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uPy5mb2N1cy5vZmZzZXQgPT09IDAsIGRlZmF1bHRTdHlsZSA9IGNvbmZpZy5kZWZhdWx0U3R5bGU/Lih7XG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBzY2hlbWE6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hXG4gICAgICAgIH0sXG4gICAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGF0VGhlQmVnaW5uaW5nT2ZCTG9jayAmJiBkZWZhdWx0U3R5bGUgJiYgZm9jdXNUZXh0QmxvY2subm9kZS5zdHlsZSAhPT0gZGVmYXVsdFN0eWxlID8ge1xuICAgICAgICBkZWZhdWx0U3R5bGUsXG4gICAgICAgIGZvY3VzVGV4dEJsb2NrXG4gICAgICB9IDogITE7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKF8sIHtcbiAgICAgIGRlZmF1bHRTdHlsZSxcbiAgICAgIGZvY3VzVGV4dEJsb2NrXG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiYmxvY2suc2V0XCIsXG4gICAgICBwcm9wczoge1xuICAgICAgICBzdHlsZTogZGVmYXVsdFN0eWxlXG4gICAgICB9LFxuICAgICAgYXQ6IGZvY3VzVGV4dEJsb2NrLnBhdGhcbiAgICB9KV1dXG4gIH0pO1xuICByZXR1cm4gW2F1dG9tYXRpY0hyT25QYXN0ZSwgY2xlYXJTdHlsZU9uQmFja3NwYWNlXTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUJsb2NrcXVvdGVSdWxlKGNvbmZpZykge1xuICByZXR1cm4gZGVmaW5lSW5wdXRSdWxlKHtcbiAgICBvbjogL14+IC8sXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3Qgc3R5bGUgPSBjb25maWcuYmxvY2txdW90ZVN0eWxlKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICAgICAgfSxcbiAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYVxuICAgICAgfSk7XG4gICAgICBpZiAoIXN0eWxlIHx8IGdldFByZXZpb3VzSW5saW5lT2JqZWN0KHNuYXBzaG90KSlcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgbWF0Y2ggPSBldmVudC5tYXRjaGVzLmF0KDApO1xuICAgICAgcmV0dXJuIG1hdGNoID8ge1xuICAgICAgICBzdHlsZSxcbiAgICAgICAgbWF0Y2hcbiAgICAgIH0gOiAhMTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgZXZlbnRcbiAgICB9LCB7XG4gICAgICBzdHlsZSxcbiAgICAgIG1hdGNoXG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiYmxvY2sudW5zZXRcIixcbiAgICAgIHByb3BzOiBbXCJsaXN0SXRlbVwiLCBcImxldmVsXCJdLFxuICAgICAgYXQ6IGV2ZW50LmZvY3VzQmxvY2sucGF0aFxuICAgIH0pLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImJsb2NrLnNldFwiLFxuICAgICAgcHJvcHM6IHtcbiAgICAgICAgc3R5bGVcbiAgICAgIH0sXG4gICAgICBhdDogZXZlbnQuZm9jdXNCbG9jay5wYXRoXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgICBhdDogbWF0Y2gudGFyZ2V0T2Zmc2V0c1xuICAgIH0pXV1cbiAgfSk7XG59XG5mdW5jdGlvbiBjcmVhdGVIZWFkaW5nUnVsZShjb25maWcpIHtcbiAgcmV0dXJuIGRlZmluZUlucHV0UnVsZSh7XG4gICAgb246IC9eIysgLyxcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBpZiAoZ2V0UHJldmlvdXNJbmxpbmVPYmplY3Qoc25hcHNob3QpKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBtYXRjaCA9IGV2ZW50Lm1hdGNoZXMuYXQoMCk7XG4gICAgICBpZiAoIW1hdGNoKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBsZXZlbCA9IG1hdGNoLnRleHQubGVuZ3RoIC0gMSwgc3R5bGUgPSBjb25maWcuaGVhZGluZ1N0eWxlKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICAgICAgfSxcbiAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICBsZXZlbFxuICAgICAgICB9LFxuICAgICAgICBsZXZlbFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3R5bGUgPyB7XG4gICAgICAgIG1hdGNoLFxuICAgICAgICBzdHlsZVxuICAgICAgfSA6ICExO1xuICAgIH0sXG4gICAgYWN0aW9uczogWyh7XG4gICAgICBldmVudFxuICAgIH0sIHtcbiAgICAgIG1hdGNoLFxuICAgICAgc3R5bGVcbiAgICB9KSA9PiBbcmFpc2Uoe1xuICAgICAgdHlwZTogXCJibG9jay51bnNldFwiLFxuICAgICAgcHJvcHM6IFtcImxpc3RJdGVtXCIsIFwibGV2ZWxcIl0sXG4gICAgICBhdDogZXZlbnQuZm9jdXNCbG9jay5wYXRoXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiYmxvY2suc2V0XCIsXG4gICAgICBwcm9wczoge1xuICAgICAgICBzdHlsZVxuICAgICAgfSxcbiAgICAgIGF0OiBldmVudC5mb2N1c0Jsb2NrLnBhdGhcbiAgICB9KSwgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgIGF0OiBtYXRjaC50YXJnZXRPZmZzZXRzXG4gICAgfSldXVxuICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUhvcml6b250YWxSdWxlUnVsZShjb25maWcpIHtcbiAgcmV0dXJuIGRlZmluZUlucHV0UnVsZSh7XG4gICAgb246IC9eKC0tLSl8XijigJQtKXxeKF9fXyl8XihcXCpcXCpcXCopLyxcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBock9iamVjdCA9IGNvbmZpZy5ob3Jpem9udGFsUnVsZU9iamVjdCh7XG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBzY2hlbWE6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hLFxuICAgICAgICAgIGtleUdlbmVyYXRvcjogc25hcHNob3QuY29udGV4dC5rZXlHZW5lcmF0b3JcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoIWhyT2JqZWN0IHx8IGdldFByZXZpb3VzSW5saW5lT2JqZWN0KHNuYXBzaG90KSlcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgY29uc3QgbWF0Y2ggPSBldmVudC5tYXRjaGVzLmF0KDApO1xuICAgICAgcmV0dXJuIG1hdGNoID8ge1xuICAgICAgICBock9iamVjdCxcbiAgICAgICAgbWF0Y2hcbiAgICAgIH0gOiAhMTtcbiAgICB9LFxuICAgIGFjdGlvbnM6IFsoXywge1xuICAgICAgaHJPYmplY3QsXG4gICAgICBtYXRjaFxuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImluc2VydC5ibG9ja1wiLFxuICAgICAgYmxvY2s6IGhyT2JqZWN0LFxuICAgICAgcGxhY2VtZW50OiBcImJlZm9yZVwiLFxuICAgICAgc2VsZWN0OiBcIm5vbmVcIlxuICAgIH0pLCByYWlzZSh7XG4gICAgICB0eXBlOiBcImRlbGV0ZVwiLFxuICAgICAgYXQ6IG1hdGNoLnRhcmdldE9mZnNldHNcbiAgICB9KV1dXG4gIH0pO1xufVxuZnVuY3Rpb24gY3JlYXRlTWFya2Rvd25MaW5rUnVsZShjb25maWcpIHtcbiAgcmV0dXJuIGRlZmluZUlucHV0UnVsZSh7XG4gICAgb246IC9cXFsoW15bXFxdXSspXVxcKCguKylcXCkvLFxuICAgIGFjdGlvbnM6IFsoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IG5ld1RleHQgPSBldmVudC50ZXh0QmVmb3JlICsgZXZlbnQudGV4dEluc2VydGVkO1xuICAgICAgbGV0IHRleHRMZW5ndGhEZWx0YSA9IDA7XG4gICAgICBjb25zdCBhY3Rpb25zID0gW107XG4gICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGV2ZW50Lm1hdGNoZXMucmV2ZXJzZSgpKSB7XG4gICAgICAgIGNvbnN0IHRleHRNYXRjaCA9IG1hdGNoLmdyb3VwTWF0Y2hlcy5hdCgwKSwgaHJlZk1hdGNoID0gbWF0Y2guZ3JvdXBNYXRjaGVzLmF0KDEpO1xuICAgICAgICBpZiAodGV4dE1hdGNoID09PSB2b2lkIDAgfHwgaHJlZk1hdGNoID09PSB2b2lkIDApXG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIHRleHRMZW5ndGhEZWx0YSA9IHRleHRMZW5ndGhEZWx0YSAtIChtYXRjaC50YXJnZXRPZmZzZXRzLmZvY3VzLm9mZnNldCAtIG1hdGNoLnRhcmdldE9mZnNldHMuYW5jaG9yLm9mZnNldCAtIHRleHRNYXRjaC50ZXh0Lmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGxpbmtPYmplY3QgPSBjb25maWcubGlua09iamVjdCh7XG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYSxcbiAgICAgICAgICAgIGtleUdlbmVyYXRvcjogc25hcHNob3QuY29udGV4dC5rZXlHZW5lcmF0b3JcbiAgICAgICAgICB9LFxuICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICBocmVmOiBocmVmTWF0Y2gudGV4dFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghbGlua09iamVjdClcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIF90eXBlLFxuICAgICAgICAgIF9rZXksXG4gICAgICAgICAgLi4udmFsdWVcbiAgICAgICAgfSA9IGxpbmtPYmplY3QsIGxlZnRTaWRlT2Zmc2V0cyA9IHtcbiAgICAgICAgICBhbmNob3I6IG1hdGNoLnRhcmdldE9mZnNldHMuYW5jaG9yLFxuICAgICAgICAgIGZvY3VzOiB0ZXh0TWF0Y2gudGFyZ2V0T2Zmc2V0cy5hbmNob3JcbiAgICAgICAgfSwgcmlnaHRTaWRlT2Zmc2V0cyA9IHtcbiAgICAgICAgICBhbmNob3I6IHRleHRNYXRjaC50YXJnZXRPZmZzZXRzLmZvY3VzLFxuICAgICAgICAgIGZvY3VzOiBtYXRjaC50YXJnZXRPZmZzZXRzLmZvY3VzXG4gICAgICAgIH07XG4gICAgICAgIGFjdGlvbnMucHVzaChyYWlzZSh7XG4gICAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgICBhdDogdGV4dE1hdGNoLnRhcmdldE9mZnNldHNcbiAgICAgICAgfSkpLCBhY3Rpb25zLnB1c2gocmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwiYW5ub3RhdGlvbi5hZGRcIixcbiAgICAgICAgICBhbm5vdGF0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiBfdHlwZSxcbiAgICAgICAgICAgIF9rZXksXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBhY3Rpb25zLnB1c2gocmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgICAgICAgYXQ6IHJpZ2h0U2lkZU9mZnNldHNcbiAgICAgICAgfSkpLCBhY3Rpb25zLnB1c2gocmFpc2Uoe1xuICAgICAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgICAgICAgYXQ6IGxlZnRTaWRlT2Zmc2V0c1xuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICBjb25zdCBlbmRDYXJldFBvc2l0aW9uID0ge1xuICAgICAgICBwYXRoOiBldmVudC5mb2N1c0Jsb2NrLnBhdGgsXG4gICAgICAgIG9mZnNldDogbmV3VGV4dC5sZW5ndGggLSB0ZXh0TGVuZ3RoRGVsdGEgKiAtMVxuICAgICAgfTtcbiAgICAgIHJldHVybiBbLi4uYWN0aW9ucywgcmFpc2Uoe1xuICAgICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgICBhdDoge1xuICAgICAgICAgIGFuY2hvcjogZW5kQ2FyZXRQb3NpdGlvbixcbiAgICAgICAgICBmb2N1czogZW5kQ2FyZXRQb3NpdGlvblxuICAgICAgICB9XG4gICAgICB9KV07XG4gICAgfV1cbiAgfSk7XG59XG5mdW5jdGlvbiBjcmVhdGVPcmRlcmVkTGlzdFJ1bGUoY29uZmlnKSB7XG4gIHJldHVybiBkZWZpbmVJbnB1dFJ1bGUoe1xuICAgIG9uOiAvXjFcXC4gLyxcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBvcmRlcmVkTGlzdCA9IGNvbmZpZy5vcmRlcmVkTGlzdCh7XG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBzY2hlbWE6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hXG4gICAgICAgIH0sXG4gICAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICAgIH0pO1xuICAgICAgaWYgKCFvcmRlcmVkTGlzdCB8fCBnZXRQcmV2aW91c0lubGluZU9iamVjdChzbmFwc2hvdCkpXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgIGNvbnN0IG1hdGNoID0gZXZlbnQubWF0Y2hlcy5hdCgwKTtcbiAgICAgIHJldHVybiBtYXRjaCA/IHtcbiAgICAgICAgbWF0Y2gsXG4gICAgICAgIG9yZGVyZWRMaXN0XG4gICAgICB9IDogITE7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIGV2ZW50XG4gICAgfSwge1xuICAgICAgbWF0Y2gsXG4gICAgICBvcmRlcmVkTGlzdFxuICAgIH0pID0+IFtyYWlzZSh7XG4gICAgICB0eXBlOiBcImJsb2NrLnVuc2V0XCIsXG4gICAgICBwcm9wczogW1wic3R5bGVcIl0sXG4gICAgICBhdDogZXZlbnQuZm9jdXNCbG9jay5wYXRoXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiYmxvY2suc2V0XCIsXG4gICAgICBwcm9wczoge1xuICAgICAgICBsaXN0SXRlbTogb3JkZXJlZExpc3QsXG4gICAgICAgIGxldmVsOiBldmVudC5mb2N1c0Jsb2NrLm5vZGUubGV2ZWwgPz8gMVxuICAgICAgfSxcbiAgICAgIGF0OiBldmVudC5mb2N1c0Jsb2NrLnBhdGhcbiAgICB9KSwgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJkZWxldGVcIixcbiAgICAgIGF0OiBtYXRjaC50YXJnZXRPZmZzZXRzXG4gICAgfSldXVxuICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVVub3JkZXJlZExpc3RSdWxlKGNvbmZpZykge1xuICByZXR1cm4gZGVmaW5lSW5wdXRSdWxlKHtcbiAgICBvbjogL14oLXxcXCopIC8sXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBzbmFwc2hvdCxcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgdW5vcmRlcmVkTGlzdCA9IGNvbmZpZy51bm9yZGVyZWRMaXN0KHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIHNjaGVtYTogc25hcHNob3QuY29udGV4dC5zY2hlbWFcbiAgICAgICAgfSxcbiAgICAgICAgc2NoZW1hOiBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYVxuICAgICAgfSk7XG4gICAgICBpZiAoIXVub3JkZXJlZExpc3QgfHwgZ2V0UHJldmlvdXNJbmxpbmVPYmplY3Qoc25hcHNob3QpKVxuICAgICAgICByZXR1cm4gITE7XG4gICAgICBjb25zdCBtYXRjaCA9IGV2ZW50Lm1hdGNoZXMuYXQoMCk7XG4gICAgICByZXR1cm4gbWF0Y2ggPyB7XG4gICAgICAgIG1hdGNoLFxuICAgICAgICB1bm9yZGVyZWRMaXN0XG4gICAgICB9IDogITE7XG4gICAgfSxcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIGV2ZW50XG4gICAgfSwge1xuICAgICAgbWF0Y2gsXG4gICAgICB1bm9yZGVyZWRMaXN0XG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiYmxvY2sudW5zZXRcIixcbiAgICAgIHByb3BzOiBbXCJzdHlsZVwiXSxcbiAgICAgIGF0OiBldmVudC5mb2N1c0Jsb2NrLnBhdGhcbiAgICB9KSwgcmFpc2Uoe1xuICAgICAgdHlwZTogXCJibG9jay5zZXRcIixcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIGxpc3RJdGVtOiB1bm9yZGVyZWRMaXN0LFxuICAgICAgICBsZXZlbDogZXZlbnQuZm9jdXNCbG9jay5ub2RlLmxldmVsID8/IDFcbiAgICAgIH0sXG4gICAgICBhdDogZXZlbnQuZm9jdXNCbG9jay5wYXRoXG4gICAgfSksIHJhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgICBhdDogbWF0Y2gudGFyZ2V0T2Zmc2V0c1xuICAgIH0pXV1cbiAgfSk7XG59XG5mdW5jdGlvbiBNYXJrZG93blNob3J0Y3V0c1BsdWdpbih0MCkge1xuICBjb25zdCAkID0gYygzOSksIHtcbiAgICBibG9ja3F1b3RlU3R5bGUsXG4gICAgYm9sZERlY29yYXRvcixcbiAgICBjb2RlRGVjb3JhdG9yLFxuICAgIGRlZmF1bHRTdHlsZSxcbiAgICBoZWFkaW5nU3R5bGUsXG4gICAgaG9yaXpvbnRhbFJ1bGVPYmplY3QsXG4gICAgbGlua09iamVjdCxcbiAgICBpdGFsaWNEZWNvcmF0b3IsXG4gICAgb3JkZXJlZExpc3QsXG4gICAgc3RyaWtlVGhyb3VnaERlY29yYXRvcixcbiAgICB1bm9yZGVyZWRMaXN0XG4gIH0gPSB0MCwgZWRpdG9yID0gdXNlRWRpdG9yKCk7XG4gIGxldCB0MSwgdDI7XG4gICRbMF0gIT09IGRlZmF1bHRTdHlsZSB8fCAkWzFdICE9PSBlZGl0b3IgPyAodDEgPSAoKSA9PiB7XG4gICAgY29uc3QgdW5yZWdpc3RlckJlaGF2aW9ycyA9IGNyZWF0ZU1hcmtkb3duQmVoYXZpb3JzKHtcbiAgICAgIGRlZmF1bHRTdHlsZVxuICAgIH0pLm1hcCgoYmVoYXZpb3IpID0+IGVkaXRvci5yZWdpc3RlckJlaGF2aW9yKHtcbiAgICAgIGJlaGF2aW9yXG4gICAgfSkpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHVucmVnaXN0ZXJCZWhhdmlvciBvZiB1bnJlZ2lzdGVyQmVoYXZpb3JzKVxuICAgICAgICB1bnJlZ2lzdGVyQmVoYXZpb3IoKTtcbiAgICB9O1xuICB9LCB0MiA9IFtkZWZhdWx0U3R5bGUsIGVkaXRvcl0sICRbMF0gPSBkZWZhdWx0U3R5bGUsICRbMV0gPSBlZGl0b3IsICRbMl0gPSB0MSwgJFszXSA9IHQyKSA6ICh0MSA9ICRbMl0sIHQyID0gJFszXSksIHVzZUVmZmVjdCh0MSwgdDIpO1xuICBsZXQgcnVsZXM7XG4gIGlmICgkWzRdICE9PSBibG9ja3F1b3RlU3R5bGUgfHwgJFs1XSAhPT0gaGVhZGluZ1N0eWxlIHx8ICRbNl0gIT09IGhvcml6b250YWxSdWxlT2JqZWN0IHx8ICRbN10gIT09IGxpbmtPYmplY3QgfHwgJFs4XSAhPT0gb3JkZXJlZExpc3QgfHwgJFs5XSAhPT0gdW5vcmRlcmVkTGlzdCkge1xuICAgIGlmIChydWxlcyA9IFtdLCBibG9ja3F1b3RlU3R5bGUpIHtcbiAgICAgIGxldCB0MzI7XG4gICAgICAkWzExXSAhPT0gYmxvY2txdW90ZVN0eWxlID8gKHQzMiA9IGNyZWF0ZUJsb2NrcXVvdGVSdWxlKHtcbiAgICAgICAgYmxvY2txdW90ZVN0eWxlXG4gICAgICB9KSwgJFsxMV0gPSBibG9ja3F1b3RlU3R5bGUsICRbMTJdID0gdDMyKSA6IHQzMiA9ICRbMTJdLCBydWxlcy5wdXNoKHQzMik7XG4gICAgfVxuICAgIGlmIChoZWFkaW5nU3R5bGUpIHtcbiAgICAgIGxldCB0MzI7XG4gICAgICAkWzEzXSAhPT0gaGVhZGluZ1N0eWxlID8gKHQzMiA9IGNyZWF0ZUhlYWRpbmdSdWxlKHtcbiAgICAgICAgaGVhZGluZ1N0eWxlXG4gICAgICB9KSwgJFsxM10gPSBoZWFkaW5nU3R5bGUsICRbMTRdID0gdDMyKSA6IHQzMiA9ICRbMTRdLCBydWxlcy5wdXNoKHQzMik7XG4gICAgfVxuICAgIGlmIChob3Jpem9udGFsUnVsZU9iamVjdCkge1xuICAgICAgbGV0IHQzMjtcbiAgICAgICRbMTVdICE9PSBob3Jpem9udGFsUnVsZU9iamVjdCA/ICh0MzIgPSBjcmVhdGVIb3Jpem9udGFsUnVsZVJ1bGUoe1xuICAgICAgICBob3Jpem9udGFsUnVsZU9iamVjdFxuICAgICAgfSksICRbMTVdID0gaG9yaXpvbnRhbFJ1bGVPYmplY3QsICRbMTZdID0gdDMyKSA6IHQzMiA9ICRbMTZdLCBydWxlcy5wdXNoKHQzMik7XG4gICAgfVxuICAgIGlmIChsaW5rT2JqZWN0KSB7XG4gICAgICBsZXQgdDMyO1xuICAgICAgJFsxN10gIT09IGxpbmtPYmplY3QgPyAodDMyID0gY3JlYXRlTWFya2Rvd25MaW5rUnVsZSh7XG4gICAgICAgIGxpbmtPYmplY3RcbiAgICAgIH0pLCAkWzE3XSA9IGxpbmtPYmplY3QsICRbMThdID0gdDMyKSA6IHQzMiA9ICRbMThdLCBydWxlcy5wdXNoKHQzMik7XG4gICAgfVxuICAgIGlmIChvcmRlcmVkTGlzdCkge1xuICAgICAgbGV0IHQzMjtcbiAgICAgICRbMTldICE9PSBvcmRlcmVkTGlzdCA/ICh0MzIgPSBjcmVhdGVPcmRlcmVkTGlzdFJ1bGUoe1xuICAgICAgICBvcmRlcmVkTGlzdFxuICAgICAgfSksICRbMTldID0gb3JkZXJlZExpc3QsICRbMjBdID0gdDMyKSA6IHQzMiA9ICRbMjBdLCBydWxlcy5wdXNoKHQzMik7XG4gICAgfVxuICAgIGlmICh1bm9yZGVyZWRMaXN0KSB7XG4gICAgICBsZXQgdDMyO1xuICAgICAgJFsyMV0gIT09IHVub3JkZXJlZExpc3QgPyAodDMyID0gY3JlYXRlVW5vcmRlcmVkTGlzdFJ1bGUoe1xuICAgICAgICB1bm9yZGVyZWRMaXN0XG4gICAgICB9KSwgJFsyMV0gPSB1bm9yZGVyZWRMaXN0LCAkWzIyXSA9IHQzMikgOiB0MzIgPSAkWzIyXSwgcnVsZXMucHVzaCh0MzIpO1xuICAgIH1cbiAgICAkWzRdID0gYmxvY2txdW90ZVN0eWxlLCAkWzVdID0gaGVhZGluZ1N0eWxlLCAkWzZdID0gaG9yaXpvbnRhbFJ1bGVPYmplY3QsICRbN10gPSBsaW5rT2JqZWN0LCAkWzhdID0gb3JkZXJlZExpc3QsICRbOV0gPSB1bm9yZGVyZWRMaXN0LCAkWzEwXSA9IHJ1bGVzO1xuICB9IGVsc2VcbiAgICBydWxlcyA9ICRbMTBdO1xuICBjb25zdCBpbnB1dFJ1bGVzID0gcnVsZXMubGVuZ3RoID4gMCA/IHJ1bGVzIDogbnVsbDtcbiAgbGV0IHQzO1xuICAkWzIzXSAhPT0gYm9sZERlY29yYXRvciA/ICh0MyA9IGJvbGREZWNvcmF0b3IgPyAvKiBAX19QVVJFX18gKi8ganN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW1xuICAgIC8qIEBfX1BVUkVfXyAqLyBqc3goQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpbiwgeyBkZWNvcmF0b3I6IGJvbGREZWNvcmF0b3IsIHBhaXI6IHtcbiAgICAgIGNoYXI6IFwiKlwiLFxuICAgICAgYW1vdW50OiAyXG4gICAgfSB9KSxcbiAgICAvKiBAX19QVVJFX18gKi8ganN4KENoYXJhY3RlclBhaXJEZWNvcmF0b3JQbHVnaW4sIHsgZGVjb3JhdG9yOiBib2xkRGVjb3JhdG9yLCBwYWlyOiB7XG4gICAgICBjaGFyOiBcIl9cIixcbiAgICAgIGFtb3VudDogMlxuICAgIH0gfSlcbiAgXSB9KSA6IG51bGwsICRbMjNdID0gYm9sZERlY29yYXRvciwgJFsyNF0gPSB0MykgOiB0MyA9ICRbMjRdO1xuICBsZXQgdDQ7XG4gICRbMjVdICE9PSBjb2RlRGVjb3JhdG9yID8gKHQ0ID0gY29kZURlY29yYXRvciA/IC8qIEBfX1BVUkVfXyAqLyBqc3goQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpbiwgeyBkZWNvcmF0b3I6IGNvZGVEZWNvcmF0b3IsIHBhaXI6IHtcbiAgICBjaGFyOiBcImBcIixcbiAgICBhbW91bnQ6IDFcbiAgfSB9KSA6IG51bGwsICRbMjVdID0gY29kZURlY29yYXRvciwgJFsyNl0gPSB0NCkgOiB0NCA9ICRbMjZdO1xuICBsZXQgdDU7XG4gICRbMjddICE9PSBpdGFsaWNEZWNvcmF0b3IgPyAodDUgPSBpdGFsaWNEZWNvcmF0b3IgPyAvKiBAX19QVVJFX18gKi8ganN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW1xuICAgIC8qIEBfX1BVUkVfXyAqLyBqc3goQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpbiwgeyBkZWNvcmF0b3I6IGl0YWxpY0RlY29yYXRvciwgcGFpcjoge1xuICAgICAgY2hhcjogXCIqXCIsXG4gICAgICBhbW91bnQ6IDFcbiAgICB9IH0pLFxuICAgIC8qIEBfX1BVUkVfXyAqLyBqc3goQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpbiwgeyBkZWNvcmF0b3I6IGl0YWxpY0RlY29yYXRvciwgcGFpcjoge1xuICAgICAgY2hhcjogXCJfXCIsXG4gICAgICBhbW91bnQ6IDFcbiAgICB9IH0pXG4gIF0gfSkgOiBudWxsLCAkWzI3XSA9IGl0YWxpY0RlY29yYXRvciwgJFsyOF0gPSB0NSkgOiB0NSA9ICRbMjhdO1xuICBsZXQgdDY7XG4gICRbMjldICE9PSBzdHJpa2VUaHJvdWdoRGVjb3JhdG9yID8gKHQ2ID0gc3RyaWtlVGhyb3VnaERlY29yYXRvciA/IC8qIEBfX1BVUkVfXyAqLyBqc3goQ2hhcmFjdGVyUGFpckRlY29yYXRvclBsdWdpbiwgeyBkZWNvcmF0b3I6IHN0cmlrZVRocm91Z2hEZWNvcmF0b3IsIHBhaXI6IHtcbiAgICBjaGFyOiBcIn5cIixcbiAgICBhbW91bnQ6IDJcbiAgfSB9KSA6IG51bGwsICRbMjldID0gc3RyaWtlVGhyb3VnaERlY29yYXRvciwgJFszMF0gPSB0NikgOiB0NiA9ICRbMzBdO1xuICBsZXQgdDc7XG4gICRbMzFdICE9PSBpbnB1dFJ1bGVzID8gKHQ3ID0gaW5wdXRSdWxlcyA/IC8qIEBfX1BVUkVfXyAqLyBqc3goSW5wdXRSdWxlUGx1Z2luLCB7IHJ1bGVzOiBpbnB1dFJ1bGVzIH0pIDogbnVsbCwgJFszMV0gPSBpbnB1dFJ1bGVzLCAkWzMyXSA9IHQ3KSA6IHQ3ID0gJFszMl07XG4gIGxldCB0ODtcbiAgcmV0dXJuICRbMzNdICE9PSB0MyB8fCAkWzM0XSAhPT0gdDQgfHwgJFszNV0gIT09IHQ1IHx8ICRbMzZdICE9PSB0NiB8fCAkWzM3XSAhPT0gdDcgPyAodDggPSAvKiBAX19QVVJFX18gKi8ganN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW1xuICAgIHQzLFxuICAgIHQ0LFxuICAgIHQ1LFxuICAgIHQ2LFxuICAgIHQ3XG4gIF0gfSksICRbMzNdID0gdDMsICRbMzRdID0gdDQsICRbMzVdID0gdDUsICRbMzZdID0gdDYsICRbMzddID0gdDcsICRbMzhdID0gdDgpIDogdDggPSAkWzM4XSwgdDg7XG59XG5leHBvcnQge1xuICBNYXJrZG93blNob3J0Y3V0c1BsdWdpblxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/plugin-markdown-shortcuts/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/plugin-one-line/dist/index.js":
/*!******************************************************************!*\
  !*** ./node_modules/@portabletext/plugin-one-line/dist/index.js ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OneLinePlugin: () => (/* binding */ OneLinePlugin)\n/* harmony export */ });\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n/* harmony import */ var _portabletext_editor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @portabletext/editor */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/use-editor.js\");\n/* harmony import */ var _portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/editor/behaviors */ \"(ssr)/./node_modules/@portabletext/editor/lib/behaviors/index.js\");\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n/* harmony import */ var _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @portabletext/editor/utils */ \"(ssr)/./node_modules/@portabletext/schema/dist/index.js\");\n/* harmony import */ var _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @portabletext/editor/utils */ \"(ssr)/./node_modules/@portabletext/editor/lib/utils/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\n\n\n\n\nconst oneLineBehaviors = [\n  /**\n   * Hitting Enter on an expanded selection should just delete that selection\n   * without causing a line break.\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.break\",\n    guard: ({\n      snapshot\n    }) => snapshot.context.selection && _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_3__.isSelectionExpanded(snapshot) ? {\n      selection: snapshot.context.selection\n    } : !1,\n    actions: [(_, {\n      selection\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.raise)({\n      type: \"delete\",\n      at: selection\n    })]]\n  }),\n  /**\n   * All other cases of `insert.break` should be aborted.\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.break\",\n    actions: []\n  }),\n  /**\n   * `insert.block` `before` or `after` is not allowed in a one-line editor.\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.block\",\n    guard: ({\n      event\n    }) => event.placement === \"before\" || event.placement === \"after\",\n    actions: []\n  }),\n  /**\n   * An ordinary `insert.block` is acceptable if it's a text block. In that\n   * case it will get merged into the existing text block.\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.block\",\n    guard: ({\n      snapshot,\n      event\n    }) => !_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_3__.getFocusTextBlock(snapshot) || !_portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_4__.isTextBlock(snapshot.context, event.block) ? !1 : event.placement !== \"auto\" || event.select !== \"end\",\n    actions: [({\n      event\n    }) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.raise)({\n      type: \"insert.block\",\n      block: event.block,\n      placement: \"auto\",\n      select: \"end\"\n    })]]\n  }),\n  /**\n   * Fallback Behavior to avoid `insert.block` in case the Behaviors above all\n   * end up with a falsy guard.\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.block\",\n    guard: ({\n      snapshot,\n      event\n    }) => _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_3__.getFocusTextBlock(snapshot) ? !_portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_4__.isTextBlock(snapshot.context, event.block) : !0,\n    actions: []\n  }),\n  /**\n   * If multiple blocks are inserted, then the non-text blocks are filtered out\n   * and the text blocks are merged into one block\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.blocks\",\n    guard: ({\n      snapshot,\n      event\n    }) => {\n      const textBlocks = event.blocks.filter((block) => _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_4__.isTextBlock(snapshot.context, block));\n      return textBlocks.length === 0 ? !1 : textBlocks.reduce((targetBlock, incomingBlock) => _portabletext_editor_utils__WEBPACK_IMPORTED_MODULE_5__.mergeTextBlocks({\n        context: snapshot.context,\n        targetBlock,\n        incomingBlock\n      }));\n    },\n    actions: [\n      // `insert.block` is raised so the Behavior above can handle the\n      // insertion\n      (_, block) => [(0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.raise)({\n        type: \"insert.block\",\n        block,\n        placement: \"auto\"\n      })]\n    ]\n  }),\n  /**\n   * Fallback Behavior to avoid `insert.blocks` in case the Behavior above\n   * ends up with a falsy guard.\n   */\n  (0,_portabletext_editor_behaviors__WEBPACK_IMPORTED_MODULE_2__.defineBehavior)({\n    on: \"insert.blocks\",\n    actions: []\n  })\n];\nfunction OneLinePlugin() {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_0__.c)(3), editor = (0,_portabletext_editor__WEBPACK_IMPORTED_MODULE_6__.useEditor)();\n  let t0, t1;\n  return $[0] !== editor ? (t0 = () => {\n    const unregisterBehaviors = oneLineBehaviors.map((behavior) => editor.registerBehavior({\n      behavior\n    }));\n    return () => {\n      for (const unregisterBehavior of unregisterBehaviors)\n        unregisterBehavior();\n    };\n  }, t1 = [editor], $[0] = editor, $[1] = t0, $[2] = t1) : (t0 = $[1], t1 = $[2]), (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(t0, t1), null;\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4tb25lLWxpbmUvZGlzdC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUEyQztBQUNNO0FBQ3NCO0FBQ1g7QUFDUjtBQUNsQjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSw4RUFBYztBQUNoQjtBQUNBO0FBQ0E7QUFDQSxLQUFLLG1DQUFtQywrRUFBNkI7QUFDckU7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUssTUFBTSxxRUFBSztBQUNoQjtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFLDhFQUFjO0FBQ2hCO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsRUFBRSw4RUFBYztBQUNoQjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLDhFQUFjO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxNQUFNLDZFQUEyQixlQUFlLG1FQUFpQjtBQUN0RTtBQUNBO0FBQ0EsS0FBSyxNQUFNLHFFQUFLO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsOEVBQWM7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLEtBQUssNkVBQTJCLGNBQWMsbUVBQWlCO0FBQ3BFO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSw4RUFBYztBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCx3REFBd0QsbUVBQWlCO0FBQ3pFLDhGQUE4Rix1RUFBcUI7QUFDbkg7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIscUVBQUs7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSw4RUFBYztBQUNoQjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxZQUFZLHlEQUFDLGNBQWMsK0RBQVM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLGdGQUFnRixnREFBUztBQUM1RjtBQUdFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L3BsdWdpbi1vbmUtbGluZS9kaXN0L2luZGV4LmpzP2Q3YjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYyB9IGZyb20gXCJyZWFjdC1jb21waWxlci1ydW50aW1lXCI7XG5pbXBvcnQgeyB1c2VFZGl0b3IgfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9lZGl0b3JcIjtcbmltcG9ydCB7IGRlZmluZUJlaGF2aW9yLCByYWlzZSB9IGZyb20gXCJAcG9ydGFibGV0ZXh0L2VkaXRvci9iZWhhdmlvcnNcIjtcbmltcG9ydCAqIGFzIHNlbGVjdG9ycyBmcm9tIFwiQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzXCI7XG5pbXBvcnQgKiBhcyB1dGlscyBmcm9tIFwiQHBvcnRhYmxldGV4dC9lZGl0b3IvdXRpbHNcIjtcbmltcG9ydCB7IHVzZUVmZmVjdCB9IGZyb20gXCJyZWFjdFwiO1xuY29uc3Qgb25lTGluZUJlaGF2aW9ycyA9IFtcbiAgLyoqXG4gICAqIEhpdHRpbmcgRW50ZXIgb24gYW4gZXhwYW5kZWQgc2VsZWN0aW9uIHNob3VsZCBqdXN0IGRlbGV0ZSB0aGF0IHNlbGVjdGlvblxuICAgKiB3aXRob3V0IGNhdXNpbmcgYSBsaW5lIGJyZWFrLlxuICAgKi9cbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC5icmVha1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3RcbiAgICB9KSA9PiBzbmFwc2hvdC5jb250ZXh0LnNlbGVjdGlvbiAmJiBzZWxlY3RvcnMuaXNTZWxlY3Rpb25FeHBhbmRlZChzbmFwc2hvdCkgPyB7XG4gICAgICBzZWxlY3Rpb246IHNuYXBzaG90LmNvbnRleHQuc2VsZWN0aW9uXG4gICAgfSA6ICExLFxuICAgIGFjdGlvbnM6IFsoXywge1xuICAgICAgc2VsZWN0aW9uXG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiZGVsZXRlXCIsXG4gICAgICBhdDogc2VsZWN0aW9uXG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIEFsbCBvdGhlciBjYXNlcyBvZiBgaW5zZXJ0LmJyZWFrYCBzaG91bGQgYmUgYWJvcnRlZC5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnNlcnQuYnJlYWtcIixcbiAgICBhY3Rpb25zOiBbXVxuICB9KSxcbiAgLyoqXG4gICAqIGBpbnNlcnQuYmxvY2tgIGBiZWZvcmVgIG9yIGBhZnRlcmAgaXMgbm90IGFsbG93ZWQgaW4gYSBvbmUtbGluZSBlZGl0b3IuXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgZ3VhcmQ6ICh7XG4gICAgICBldmVudFxuICAgIH0pID0+IGV2ZW50LnBsYWNlbWVudCA9PT0gXCJiZWZvcmVcIiB8fCBldmVudC5wbGFjZW1lbnQgPT09IFwiYWZ0ZXJcIixcbiAgICBhY3Rpb25zOiBbXVxuICB9KSxcbiAgLyoqXG4gICAqIEFuIG9yZGluYXJ5IGBpbnNlcnQuYmxvY2tgIGlzIGFjY2VwdGFibGUgaWYgaXQncyBhIHRleHQgYmxvY2suIEluIHRoYXRcbiAgICogY2FzZSBpdCB3aWxsIGdldCBtZXJnZWQgaW50byB0aGUgZXhpc3RpbmcgdGV4dCBibG9jay5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiAhc2VsZWN0b3JzLmdldEZvY3VzVGV4dEJsb2NrKHNuYXBzaG90KSB8fCAhdXRpbHMuaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgZXZlbnQuYmxvY2spID8gITEgOiBldmVudC5wbGFjZW1lbnQgIT09IFwiYXV0b1wiIHx8IGV2ZW50LnNlbGVjdCAhPT0gXCJlbmRcIixcbiAgICBhY3Rpb25zOiBbKHtcbiAgICAgIGV2ZW50XG4gICAgfSkgPT4gW3JhaXNlKHtcbiAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICBibG9jazogZXZlbnQuYmxvY2ssXG4gICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiLFxuICAgICAgc2VsZWN0OiBcImVuZFwiXG4gICAgfSldXVxuICB9KSxcbiAgLyoqXG4gICAqIEZhbGxiYWNrIEJlaGF2aW9yIHRvIGF2b2lkIGBpbnNlcnQuYmxvY2tgIGluIGNhc2UgdGhlIEJlaGF2aW9ycyBhYm92ZSBhbGxcbiAgICogZW5kIHVwIHdpdGggYSBmYWxzeSBndWFyZC5cbiAgICovXG4gIGRlZmluZUJlaGF2aW9yKHtcbiAgICBvbjogXCJpbnNlcnQuYmxvY2tcIixcbiAgICBndWFyZDogKHtcbiAgICAgIHNuYXBzaG90LFxuICAgICAgZXZlbnRcbiAgICB9KSA9PiBzZWxlY3RvcnMuZ2V0Rm9jdXNUZXh0QmxvY2soc25hcHNob3QpID8gIXV0aWxzLmlzVGV4dEJsb2NrKHNuYXBzaG90LmNvbnRleHQsIGV2ZW50LmJsb2NrKSA6ICEwLFxuICAgIGFjdGlvbnM6IFtdXG4gIH0pLFxuICAvKipcbiAgICogSWYgbXVsdGlwbGUgYmxvY2tzIGFyZSBpbnNlcnRlZCwgdGhlbiB0aGUgbm9uLXRleHQgYmxvY2tzIGFyZSBmaWx0ZXJlZCBvdXRcbiAgICogYW5kIHRoZSB0ZXh0IGJsb2NrcyBhcmUgbWVyZ2VkIGludG8gb25lIGJsb2NrXG4gICAqL1xuICBkZWZpbmVCZWhhdmlvcih7XG4gICAgb246IFwiaW5zZXJ0LmJsb2Nrc1wiLFxuICAgIGd1YXJkOiAoe1xuICAgICAgc25hcHNob3QsXG4gICAgICBldmVudFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IHRleHRCbG9ja3MgPSBldmVudC5ibG9ja3MuZmlsdGVyKChibG9jaykgPT4gdXRpbHMuaXNUZXh0QmxvY2soc25hcHNob3QuY29udGV4dCwgYmxvY2spKTtcbiAgICAgIHJldHVybiB0ZXh0QmxvY2tzLmxlbmd0aCA9PT0gMCA/ICExIDogdGV4dEJsb2Nrcy5yZWR1Y2UoKHRhcmdldEJsb2NrLCBpbmNvbWluZ0Jsb2NrKSA9PiB1dGlscy5tZXJnZVRleHRCbG9ja3Moe1xuICAgICAgICBjb250ZXh0OiBzbmFwc2hvdC5jb250ZXh0LFxuICAgICAgICB0YXJnZXRCbG9jayxcbiAgICAgICAgaW5jb21pbmdCbG9ja1xuICAgICAgfSkpO1xuICAgIH0sXG4gICAgYWN0aW9uczogW1xuICAgICAgLy8gYGluc2VydC5ibG9ja2AgaXMgcmFpc2VkIHNvIHRoZSBCZWhhdmlvciBhYm92ZSBjYW4gaGFuZGxlIHRoZVxuICAgICAgLy8gaW5zZXJ0aW9uXG4gICAgICAoXywgYmxvY2spID0+IFtyYWlzZSh7XG4gICAgICAgIHR5cGU6IFwiaW5zZXJ0LmJsb2NrXCIsXG4gICAgICAgIGJsb2NrLFxuICAgICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiXG4gICAgICB9KV1cbiAgICBdXG4gIH0pLFxuICAvKipcbiAgICogRmFsbGJhY2sgQmVoYXZpb3IgdG8gYXZvaWQgYGluc2VydC5ibG9ja3NgIGluIGNhc2UgdGhlIEJlaGF2aW9yIGFib3ZlXG4gICAqIGVuZHMgdXAgd2l0aCBhIGZhbHN5IGd1YXJkLlxuICAgKi9cbiAgZGVmaW5lQmVoYXZpb3Ioe1xuICAgIG9uOiBcImluc2VydC5ibG9ja3NcIixcbiAgICBhY3Rpb25zOiBbXVxuICB9KVxuXTtcbmZ1bmN0aW9uIE9uZUxpbmVQbHVnaW4oKSB7XG4gIGNvbnN0ICQgPSBjKDMpLCBlZGl0b3IgPSB1c2VFZGl0b3IoKTtcbiAgbGV0IHQwLCB0MTtcbiAgcmV0dXJuICRbMF0gIT09IGVkaXRvciA/ICh0MCA9ICgpID0+IHtcbiAgICBjb25zdCB1bnJlZ2lzdGVyQmVoYXZpb3JzID0gb25lTGluZUJlaGF2aW9ycy5tYXAoKGJlaGF2aW9yKSA9PiBlZGl0b3IucmVnaXN0ZXJCZWhhdmlvcih7XG4gICAgICBiZWhhdmlvclxuICAgIH0pKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCB1bnJlZ2lzdGVyQmVoYXZpb3Igb2YgdW5yZWdpc3RlckJlaGF2aW9ycylcbiAgICAgICAgdW5yZWdpc3RlckJlaGF2aW9yKCk7XG4gICAgfTtcbiAgfSwgdDEgPSBbZWRpdG9yXSwgJFswXSA9IGVkaXRvciwgJFsxXSA9IHQwLCAkWzJdID0gdDEpIDogKHQwID0gJFsxXSwgdDEgPSAkWzJdKSwgdXNlRWZmZWN0KHQwLCB0MSksIG51bGw7XG59XG5leHBvcnQge1xuICBPbmVMaW5lUGx1Z2luXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/plugin-one-line/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/plugin-typography/dist/index.js":
/*!********************************************************************!*\
  !*** ./node_modules/@portabletext/plugin-typography/dist/index.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TypographyPlugin: () => (/* binding */ TypographyPlugin),\n/* harmony export */   closingDoubleQuoteRule: () => (/* binding */ closingDoubleQuoteRule),\n/* harmony export */   closingSingleQuoteRule: () => (/* binding */ closingSingleQuoteRule),\n/* harmony export */   copyrightRule: () => (/* binding */ copyrightRule),\n/* harmony export */   createDecoratorGuard: () => (/* binding */ createDecoratorGuard),\n/* harmony export */   ellipsisRule: () => (/* binding */ ellipsisRule),\n/* harmony export */   emDashRule: () => (/* binding */ emDashRule),\n/* harmony export */   laquoRule: () => (/* binding */ laquoRule),\n/* harmony export */   leftArrowRule: () => (/* binding */ leftArrowRule),\n/* harmony export */   multiplicationRule: () => (/* binding */ multiplicationRule),\n/* harmony export */   notEqualRule: () => (/* binding */ notEqualRule),\n/* harmony export */   oneHalfRule: () => (/* binding */ oneHalfRule),\n/* harmony export */   oneQuarterRule: () => (/* binding */ oneQuarterRule),\n/* harmony export */   openingDoubleQuoteRule: () => (/* binding */ openingDoubleQuoteRule),\n/* harmony export */   openingSingleQuoteRule: () => (/* binding */ openingSingleQuoteRule),\n/* harmony export */   plusMinusRule: () => (/* binding */ plusMinusRule),\n/* harmony export */   raquoRule: () => (/* binding */ raquoRule),\n/* harmony export */   registeredTrademarkRule: () => (/* binding */ registeredTrademarkRule),\n/* harmony export */   rightArrowRule: () => (/* binding */ rightArrowRule),\n/* harmony export */   servicemarkRule: () => (/* binding */ servicemarkRule),\n/* harmony export */   smartQuotesRules: () => (/* binding */ smartQuotesRules),\n/* harmony export */   superscriptThreeRule: () => (/* binding */ superscriptThreeRule),\n/* harmony export */   superscriptTwoRule: () => (/* binding */ superscriptTwoRule),\n/* harmony export */   threeQuartersRule: () => (/* binding */ threeQuartersRule),\n/* harmony export */   trademarkRule: () => (/* binding */ trademarkRule)\n/* harmony export */ });\n/* harmony import */ var _portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/editor/selectors */ \"(ssr)/./node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js\");\n/* harmony import */ var _portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @portabletext/plugin-input-rule */ \"(ssr)/./node_modules/@portabletext/plugin-input-rule/dist/index.js\");\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-jsx-runtime.js\");\n/* harmony import */ var react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-compiler-runtime */ \"(ssr)/./node_modules/react-compiler-runtime/dist/index.js\");\n\n\n\n\nfunction createDecoratorGuard(config) {\n  return ({\n    snapshot,\n    event\n  }) => {\n    const allowedDecorators = config.decorators({\n      context: {\n        schema: snapshot.context.schema\n      }\n    }), decorators = snapshot.context.schema.decorators.flatMap((decorator) => allowedDecorators.includes(decorator.name) ? [] : [decorator.name]);\n    if (decorators.length === 0)\n      return !0;\n    const matchedSpans = event.matches.flatMap((match) => (0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.getSelectedSpans)({\n      ...snapshot,\n      context: {\n        ...snapshot.context,\n        selection: match.selection\n      }\n    }));\n    let preventInputRule = !1;\n    for (const decorator of decorators) {\n      if ((0,_portabletext_editor_selectors__WEBPACK_IMPORTED_MODULE_2__.isActiveDecorator)(decorator)(snapshot)) {\n        preventInputRule = !0;\n        break;\n      }\n      if (matchedSpans.some((span) => span.node.marks?.includes(decorator))) {\n        preventInputRule = !0;\n        break;\n      }\n    }\n    return !preventInputRule;\n  };\n}\nconst emDashRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /--/,\n  transform: () => \"\\u2014\"\n}), ellipsisRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\.\\.\\./,\n  transform: () => \"\\u2026\"\n}), openingDoubleQuoteRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: new RegExp(`(?:^|(?<=[\\\\s{[(<'\"\\\\u2018\\\\u201C]))\"`, \"g\"),\n  transform: () => \"\\u201C\"\n}), closingDoubleQuoteRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\"/g,\n  transform: () => \"\\u201D\"\n}), openingSingleQuoteRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: new RegExp(`(?:^|(?<=[\\\\s{[(<'\"\\\\u2018\\\\u201C]))'`, \"g\"),\n  transform: () => \"\\u2018\"\n}), closingSingleQuoteRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /'/g,\n  transform: () => \"\\u2019\"\n}), smartQuotesRules = [openingDoubleQuoteRule, closingDoubleQuoteRule, openingSingleQuoteRule, closingSingleQuoteRule], leftArrowRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /<-/,\n  transform: () => \"\\u2190\"\n}), rightArrowRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /->/,\n  transform: () => \"\\u2192\"\n}), copyrightRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\(c\\)/,\n  transform: () => \"\\xA9\"\n}), servicemarkRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\(sm\\)/,\n  transform: () => \"\\u2120\"\n}), trademarkRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\(tm\\)/,\n  transform: () => \"\\u2122\"\n}), registeredTrademarkRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\(r\\)/,\n  transform: () => \"\\xAE\"\n}), oneHalfRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /(?:^|\\s)(1\\/2)\\s/,\n  transform: () => \"\\xBD\"\n}), plusMinusRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\+\\/-/,\n  transform: () => \"\\xB1\"\n}), notEqualRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /!=/,\n  transform: () => \"\\u2260\"\n}), laquoRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /<</,\n  transform: () => \"\\xAB\"\n}), raquoRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: />>/,\n  transform: () => \"\\xBB\"\n}), multiplicationRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\d+\\s?([*x])\\s?\\d+/,\n  transform: () => \"\\xD7\"\n}), superscriptTwoRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\^2/,\n  transform: () => \"\\xB2\"\n}), superscriptThreeRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /\\^3/,\n  transform: () => \"\\xB3\"\n}), oneQuarterRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /(?:^|\\s)(1\\/4)\\s/,\n  transform: () => \"\\xBC\"\n}), threeQuartersRule = (0,_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.defineTextTransformRule)({\n  on: /(?:^|\\s)(3\\/4)\\s/,\n  transform: () => \"\\xBE\"\n}), defaultRuleConfig = [{\n  name: \"emDash\",\n  rule: emDashRule,\n  state: \"on\"\n}, {\n  name: \"ellipsis\",\n  rule: ellipsisRule,\n  state: \"on\"\n}, {\n  name: \"openingDoubleQuote\",\n  rule: openingDoubleQuoteRule,\n  state: \"on\"\n}, {\n  name: \"closingDoubleQuote\",\n  rule: closingDoubleQuoteRule,\n  state: \"on\"\n}, {\n  name: \"openingSingleQuote\",\n  rule: openingSingleQuoteRule,\n  state: \"on\"\n}, {\n  name: \"closingSingleQuote\",\n  rule: closingSingleQuoteRule,\n  state: \"on\"\n}, {\n  name: \"leftArrow\",\n  rule: leftArrowRule,\n  state: \"on\"\n}, {\n  name: \"rightArrow\",\n  rule: rightArrowRule,\n  state: \"on\"\n}, {\n  name: \"copyright\",\n  rule: copyrightRule,\n  state: \"on\"\n}, {\n  name: \"trademark\",\n  rule: trademarkRule,\n  state: \"on\"\n}, {\n  name: \"servicemark\",\n  rule: servicemarkRule,\n  state: \"on\"\n}, {\n  name: \"registeredTrademark\",\n  rule: registeredTrademarkRule,\n  state: \"on\"\n}, {\n  name: \"oneHalf\",\n  rule: oneHalfRule,\n  state: \"off\"\n}, {\n  name: \"plusMinus\",\n  rule: plusMinusRule,\n  state: \"off\"\n}, {\n  name: \"laquo\",\n  rule: laquoRule,\n  state: \"off\"\n}, {\n  name: \"notEqual\",\n  rule: notEqualRule,\n  state: \"off\"\n}, {\n  name: \"raquo\",\n  rule: raquoRule,\n  state: \"off\"\n}, {\n  name: \"multiplication\",\n  rule: multiplicationRule,\n  state: \"off\"\n}, {\n  name: \"superscriptTwo\",\n  rule: superscriptTwoRule,\n  state: \"off\"\n}, {\n  name: \"superscriptThree\",\n  rule: superscriptThreeRule,\n  state: \"off\"\n}, {\n  name: \"oneQuarter\",\n  rule: oneQuarterRule,\n  state: \"off\"\n}, {\n  name: \"threeQuarters\",\n  rule: threeQuartersRule,\n  state: \"off\"\n}];\nfunction TypographyPlugin(props) {\n  const $ = (0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(13), {\n    preset: t0,\n    enable: t1,\n    disable: t2,\n    guard\n  } = props, preset = t0 === void 0 ? \"default\" : t0;\n  let t3;\n  $[0] !== t1 ? (t3 = t1 === void 0 ? [] : t1, $[0] = t1, $[1] = t3) : t3 = $[1];\n  const enable = t3;\n  let t4;\n  $[2] !== t2 ? (t4 = t2 === void 0 ? [] : t2, $[2] = t2, $[3] = t4) : t4 = $[3];\n  const disable = t4;\n  let enabledRules;\n  if ($[4] !== disable || $[5] !== enable || $[6] !== preset) {\n    if (enabledRules = /* @__PURE__ */ new Set(), preset === \"all\")\n      for (const rule of defaultRuleConfig)\n        enabledRules.add(rule.name);\n    else if (preset === \"default\")\n      for (const rule_0 of defaultRuleConfig)\n        rule_0.state === \"on\" && enabledRules.add(rule_0.name);\n    for (const ruleName of enable)\n      enabledRules.add(ruleName);\n    for (const ruleName_0 of disable)\n      enabledRules.delete(ruleName_0);\n    $[4] = disable, $[5] = enable, $[6] = preset, $[7] = enabledRules;\n  } else\n    enabledRules = $[7];\n  let t5;\n  $[8] !== enabledRules || $[9] !== guard ? (t5 = defaultRuleConfig.flatMap((rule_1) => enabledRules.has(rule_1.name) ? [{\n    ...rule_1.rule,\n    guard: guard ?? _temp\n  }] : []), $[8] = enabledRules, $[9] = guard, $[10] = t5) : t5 = $[10];\n  const configuredInputRules = t5;\n  let t6;\n  return $[11] !== configuredInputRules ? (t6 = /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_portabletext_plugin_input_rule__WEBPACK_IMPORTED_MODULE_3__.InputRulePlugin, { rules: configuredInputRules }), $[11] = configuredInputRules, $[12] = t6) : t6 = $[12], t6;\n}\nfunction _temp() {\n  return !0;\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4tdHlwb2dyYXBoeS9kaXN0L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXFGO0FBQ007QUFDbkQ7QUFDRztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsMERBQTBELGdGQUFnQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxVQUFVLGlGQUFpQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHdGQUF1QjtBQUMxQztBQUNBO0FBQ0EsQ0FBQyxrQkFBa0Isd0ZBQXVCO0FBQzFDO0FBQ0E7QUFDQSxDQUFDLDRCQUE0Qix3RkFBdUI7QUFDcEQsZ0NBQWdDO0FBQ2hDO0FBQ0EsQ0FBQyw0QkFBNEIsd0ZBQXVCO0FBQ3BEO0FBQ0E7QUFDQSxDQUFDLDRCQUE0Qix3RkFBdUI7QUFDcEQsZ0NBQWdDO0FBQ2hDO0FBQ0EsQ0FBQyw0QkFBNEIsd0ZBQXVCO0FBQ3BEO0FBQ0E7QUFDQSxDQUFDLHdJQUF3SSx3RkFBdUI7QUFDaEs7QUFDQTtBQUNBLENBQUMsb0JBQW9CLHdGQUF1QjtBQUM1QztBQUNBO0FBQ0EsQ0FBQyxtQkFBbUIsd0ZBQXVCO0FBQzNDO0FBQ0E7QUFDQSxDQUFDLHFCQUFxQix3RkFBdUI7QUFDN0M7QUFDQTtBQUNBLENBQUMsbUJBQW1CLHdGQUF1QjtBQUMzQztBQUNBO0FBQ0EsQ0FBQyw2QkFBNkIsd0ZBQXVCO0FBQ3JEO0FBQ0E7QUFDQSxDQUFDLGlCQUFpQix3RkFBdUI7QUFDekM7QUFDQTtBQUNBLENBQUMsbUJBQW1CLHdGQUF1QjtBQUMzQztBQUNBO0FBQ0EsQ0FBQyxrQkFBa0Isd0ZBQXVCO0FBQzFDO0FBQ0E7QUFDQSxDQUFDLGVBQWUsd0ZBQXVCO0FBQ3ZDO0FBQ0E7QUFDQSxDQUFDLGVBQWUsd0ZBQXVCO0FBQ3ZDO0FBQ0E7QUFDQSxDQUFDLHdCQUF3Qix3RkFBdUI7QUFDaEQ7QUFDQTtBQUNBLENBQUMsd0JBQXdCLHdGQUF1QjtBQUNoRDtBQUNBO0FBQ0EsQ0FBQywwQkFBMEIsd0ZBQXVCO0FBQ2xEO0FBQ0E7QUFDQSxDQUFDLG9CQUFvQix3RkFBdUI7QUFDNUM7QUFDQTtBQUNBLENBQUMsdUJBQXVCLHdGQUF1QjtBQUMvQztBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLFlBQVkseURBQUM7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxnRUFBZ0Usc0RBQUcsQ0FBQyw0RUFBZSxJQUFJLDZCQUE2QjtBQUNwSDtBQUNBO0FBQ0E7QUFDQTtBQTJCRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9wbHVnaW4tdHlwb2dyYXBoeS9kaXN0L2luZGV4LmpzPzJmMmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0U2VsZWN0ZWRTcGFucywgaXNBY3RpdmVEZWNvcmF0b3IgfSBmcm9tIFwiQHBvcnRhYmxldGV4dC9lZGl0b3Ivc2VsZWN0b3JzXCI7XG5pbXBvcnQgeyBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZSwgSW5wdXRSdWxlUGx1Z2luIH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvcGx1Z2luLWlucHV0LXJ1bGVcIjtcbmltcG9ydCB7IGpzeCB9IGZyb20gXCJyZWFjdC9qc3gtcnVudGltZVwiO1xuaW1wb3J0IHsgYyB9IGZyb20gXCJyZWFjdC1jb21waWxlci1ydW50aW1lXCI7XG5mdW5jdGlvbiBjcmVhdGVEZWNvcmF0b3JHdWFyZChjb25maWcpIHtcbiAgcmV0dXJuICh7XG4gICAgc25hcHNob3QsXG4gICAgZXZlbnRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGFsbG93ZWREZWNvcmF0b3JzID0gY29uZmlnLmRlY29yYXRvcnMoe1xuICAgICAgY29udGV4dDoge1xuICAgICAgICBzY2hlbWE6IHNuYXBzaG90LmNvbnRleHQuc2NoZW1hXG4gICAgICB9XG4gICAgfSksIGRlY29yYXRvcnMgPSBzbmFwc2hvdC5jb250ZXh0LnNjaGVtYS5kZWNvcmF0b3JzLmZsYXRNYXAoKGRlY29yYXRvcikgPT4gYWxsb3dlZERlY29yYXRvcnMuaW5jbHVkZXMoZGVjb3JhdG9yLm5hbWUpID8gW10gOiBbZGVjb3JhdG9yLm5hbWVdKTtcbiAgICBpZiAoZGVjb3JhdG9ycy5sZW5ndGggPT09IDApXG4gICAgICByZXR1cm4gITA7XG4gICAgY29uc3QgbWF0Y2hlZFNwYW5zID0gZXZlbnQubWF0Y2hlcy5mbGF0TWFwKChtYXRjaCkgPT4gZ2V0U2VsZWN0ZWRTcGFucyh7XG4gICAgICAuLi5zbmFwc2hvdCxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgLi4uc25hcHNob3QuY29udGV4dCxcbiAgICAgICAgc2VsZWN0aW9uOiBtYXRjaC5zZWxlY3Rpb25cbiAgICAgIH1cbiAgICB9KSk7XG4gICAgbGV0IHByZXZlbnRJbnB1dFJ1bGUgPSAhMTtcbiAgICBmb3IgKGNvbnN0IGRlY29yYXRvciBvZiBkZWNvcmF0b3JzKSB7XG4gICAgICBpZiAoaXNBY3RpdmVEZWNvcmF0b3IoZGVjb3JhdG9yKShzbmFwc2hvdCkpIHtcbiAgICAgICAgcHJldmVudElucHV0UnVsZSA9ICEwO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChtYXRjaGVkU3BhbnMuc29tZSgoc3BhbikgPT4gc3Bhbi5ub2RlLm1hcmtzPy5pbmNsdWRlcyhkZWNvcmF0b3IpKSkge1xuICAgICAgICBwcmV2ZW50SW5wdXRSdWxlID0gITA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gIXByZXZlbnRJbnB1dFJ1bGU7XG4gIH07XG59XG5jb25zdCBlbURhc2hSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogLy0tLyxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxcdTIwMTRcIlxufSksIGVsbGlwc2lzUnVsZSA9IGRlZmluZVRleHRUcmFuc2Zvcm1SdWxlKHtcbiAgb246IC9cXC5cXC5cXC4vLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx1MjAyNlwiXG59KSwgb3BlbmluZ0RvdWJsZVF1b3RlUnVsZSA9IGRlZmluZVRleHRUcmFuc2Zvcm1SdWxlKHtcbiAgb246IG5ldyBSZWdFeHAoYCg/Ol58KD88PVtcXFxcc3tbKDwnXCJcXFxcdTIwMThcXFxcdTIwMUNdKSlcImAsIFwiZ1wiKSxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxcdTIwMUNcIlxufSksIGNsb3NpbmdEb3VibGVRdW90ZVJ1bGUgPSBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZSh7XG4gIG9uOiAvXCIvZyxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxcdTIwMURcIlxufSksIG9wZW5pbmdTaW5nbGVRdW90ZVJ1bGUgPSBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZSh7XG4gIG9uOiBuZXcgUmVnRXhwKGAoPzpefCg/PD1bXFxcXHN7Wyg8J1wiXFxcXHUyMDE4XFxcXHUyMDFDXSkpJ2AsIFwiZ1wiKSxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxcdTIwMThcIlxufSksIGNsb3NpbmdTaW5nbGVRdW90ZVJ1bGUgPSBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZSh7XG4gIG9uOiAvJy9nLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx1MjAxOVwiXG59KSwgc21hcnRRdW90ZXNSdWxlcyA9IFtvcGVuaW5nRG91YmxlUXVvdGVSdWxlLCBjbG9zaW5nRG91YmxlUXVvdGVSdWxlLCBvcGVuaW5nU2luZ2xlUXVvdGVSdWxlLCBjbG9zaW5nU2luZ2xlUXVvdGVSdWxlXSwgbGVmdEFycm93UnVsZSA9IGRlZmluZVRleHRUcmFuc2Zvcm1SdWxlKHtcbiAgb246IC88LS8sXG4gIHRyYW5zZm9ybTogKCkgPT4gXCJcXHUyMTkwXCJcbn0pLCByaWdodEFycm93UnVsZSA9IGRlZmluZVRleHRUcmFuc2Zvcm1SdWxlKHtcbiAgb246IC8tPi8sXG4gIHRyYW5zZm9ybTogKCkgPT4gXCJcXHUyMTkyXCJcbn0pLCBjb3B5cmlnaHRSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogL1xcKGNcXCkvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QTlcIlxufSksIHNlcnZpY2VtYXJrUnVsZSA9IGRlZmluZVRleHRUcmFuc2Zvcm1SdWxlKHtcbiAgb246IC9cXChzbVxcKS8sXG4gIHRyYW5zZm9ybTogKCkgPT4gXCJcXHUyMTIwXCJcbn0pLCB0cmFkZW1hcmtSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogL1xcKHRtXFwpLyxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxcdTIxMjJcIlxufSksIHJlZ2lzdGVyZWRUcmFkZW1hcmtSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogL1xcKHJcXCkvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QUVcIlxufSksIG9uZUhhbGZSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogLyg/Ol58XFxzKSgxXFwvMilcXHMvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QkRcIlxufSksIHBsdXNNaW51c1J1bGUgPSBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZSh7XG4gIG9uOiAvXFwrXFwvLS8sXG4gIHRyYW5zZm9ybTogKCkgPT4gXCJcXHhCMVwiXG59KSwgbm90RXF1YWxSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogLyE9LyxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxcdTIyNjBcIlxufSksIGxhcXVvUnVsZSA9IGRlZmluZVRleHRUcmFuc2Zvcm1SdWxlKHtcbiAgb246IC88PC8sXG4gIHRyYW5zZm9ybTogKCkgPT4gXCJcXHhBQlwiXG59KSwgcmFxdW9SdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogLz4+LyxcbiAgdHJhbnNmb3JtOiAoKSA9PiBcIlxceEJCXCJcbn0pLCBtdWx0aXBsaWNhdGlvblJ1bGUgPSBkZWZpbmVUZXh0VHJhbnNmb3JtUnVsZSh7XG4gIG9uOiAvXFxkK1xccz8oWyp4XSlcXHM/XFxkKy8sXG4gIHRyYW5zZm9ybTogKCkgPT4gXCJcXHhEN1wiXG59KSwgc3VwZXJzY3JpcHRUd29SdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogL1xcXjIvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QjJcIlxufSksIHN1cGVyc2NyaXB0VGhyZWVSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogL1xcXjMvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QjNcIlxufSksIG9uZVF1YXJ0ZXJSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogLyg/Ol58XFxzKSgxXFwvNClcXHMvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QkNcIlxufSksIHRocmVlUXVhcnRlcnNSdWxlID0gZGVmaW5lVGV4dFRyYW5zZm9ybVJ1bGUoe1xuICBvbjogLyg/Ol58XFxzKSgzXFwvNClcXHMvLFxuICB0cmFuc2Zvcm06ICgpID0+IFwiXFx4QkVcIlxufSksIGRlZmF1bHRSdWxlQ29uZmlnID0gW3tcbiAgbmFtZTogXCJlbURhc2hcIixcbiAgcnVsZTogZW1EYXNoUnVsZSxcbiAgc3RhdGU6IFwib25cIlxufSwge1xuICBuYW1lOiBcImVsbGlwc2lzXCIsXG4gIHJ1bGU6IGVsbGlwc2lzUnVsZSxcbiAgc3RhdGU6IFwib25cIlxufSwge1xuICBuYW1lOiBcIm9wZW5pbmdEb3VibGVRdW90ZVwiLFxuICBydWxlOiBvcGVuaW5nRG91YmxlUXVvdGVSdWxlLFxuICBzdGF0ZTogXCJvblwiXG59LCB7XG4gIG5hbWU6IFwiY2xvc2luZ0RvdWJsZVF1b3RlXCIsXG4gIHJ1bGU6IGNsb3NpbmdEb3VibGVRdW90ZVJ1bGUsXG4gIHN0YXRlOiBcIm9uXCJcbn0sIHtcbiAgbmFtZTogXCJvcGVuaW5nU2luZ2xlUXVvdGVcIixcbiAgcnVsZTogb3BlbmluZ1NpbmdsZVF1b3RlUnVsZSxcbiAgc3RhdGU6IFwib25cIlxufSwge1xuICBuYW1lOiBcImNsb3NpbmdTaW5nbGVRdW90ZVwiLFxuICBydWxlOiBjbG9zaW5nU2luZ2xlUXVvdGVSdWxlLFxuICBzdGF0ZTogXCJvblwiXG59LCB7XG4gIG5hbWU6IFwibGVmdEFycm93XCIsXG4gIHJ1bGU6IGxlZnRBcnJvd1J1bGUsXG4gIHN0YXRlOiBcIm9uXCJcbn0sIHtcbiAgbmFtZTogXCJyaWdodEFycm93XCIsXG4gIHJ1bGU6IHJpZ2h0QXJyb3dSdWxlLFxuICBzdGF0ZTogXCJvblwiXG59LCB7XG4gIG5hbWU6IFwiY29weXJpZ2h0XCIsXG4gIHJ1bGU6IGNvcHlyaWdodFJ1bGUsXG4gIHN0YXRlOiBcIm9uXCJcbn0sIHtcbiAgbmFtZTogXCJ0cmFkZW1hcmtcIixcbiAgcnVsZTogdHJhZGVtYXJrUnVsZSxcbiAgc3RhdGU6IFwib25cIlxufSwge1xuICBuYW1lOiBcInNlcnZpY2VtYXJrXCIsXG4gIHJ1bGU6IHNlcnZpY2VtYXJrUnVsZSxcbiAgc3RhdGU6IFwib25cIlxufSwge1xuICBuYW1lOiBcInJlZ2lzdGVyZWRUcmFkZW1hcmtcIixcbiAgcnVsZTogcmVnaXN0ZXJlZFRyYWRlbWFya1J1bGUsXG4gIHN0YXRlOiBcIm9uXCJcbn0sIHtcbiAgbmFtZTogXCJvbmVIYWxmXCIsXG4gIHJ1bGU6IG9uZUhhbGZSdWxlLFxuICBzdGF0ZTogXCJvZmZcIlxufSwge1xuICBuYW1lOiBcInBsdXNNaW51c1wiLFxuICBydWxlOiBwbHVzTWludXNSdWxlLFxuICBzdGF0ZTogXCJvZmZcIlxufSwge1xuICBuYW1lOiBcImxhcXVvXCIsXG4gIHJ1bGU6IGxhcXVvUnVsZSxcbiAgc3RhdGU6IFwib2ZmXCJcbn0sIHtcbiAgbmFtZTogXCJub3RFcXVhbFwiLFxuICBydWxlOiBub3RFcXVhbFJ1bGUsXG4gIHN0YXRlOiBcIm9mZlwiXG59LCB7XG4gIG5hbWU6IFwicmFxdW9cIixcbiAgcnVsZTogcmFxdW9SdWxlLFxuICBzdGF0ZTogXCJvZmZcIlxufSwge1xuICBuYW1lOiBcIm11bHRpcGxpY2F0aW9uXCIsXG4gIHJ1bGU6IG11bHRpcGxpY2F0aW9uUnVsZSxcbiAgc3RhdGU6IFwib2ZmXCJcbn0sIHtcbiAgbmFtZTogXCJzdXBlcnNjcmlwdFR3b1wiLFxuICBydWxlOiBzdXBlcnNjcmlwdFR3b1J1bGUsXG4gIHN0YXRlOiBcIm9mZlwiXG59LCB7XG4gIG5hbWU6IFwic3VwZXJzY3JpcHRUaHJlZVwiLFxuICBydWxlOiBzdXBlcnNjcmlwdFRocmVlUnVsZSxcbiAgc3RhdGU6IFwib2ZmXCJcbn0sIHtcbiAgbmFtZTogXCJvbmVRdWFydGVyXCIsXG4gIHJ1bGU6IG9uZVF1YXJ0ZXJSdWxlLFxuICBzdGF0ZTogXCJvZmZcIlxufSwge1xuICBuYW1lOiBcInRocmVlUXVhcnRlcnNcIixcbiAgcnVsZTogdGhyZWVRdWFydGVyc1J1bGUsXG4gIHN0YXRlOiBcIm9mZlwiXG59XTtcbmZ1bmN0aW9uIFR5cG9ncmFwaHlQbHVnaW4ocHJvcHMpIHtcbiAgY29uc3QgJCA9IGMoMTMpLCB7XG4gICAgcHJlc2V0OiB0MCxcbiAgICBlbmFibGU6IHQxLFxuICAgIGRpc2FibGU6IHQyLFxuICAgIGd1YXJkXG4gIH0gPSBwcm9wcywgcHJlc2V0ID0gdDAgPT09IHZvaWQgMCA/IFwiZGVmYXVsdFwiIDogdDA7XG4gIGxldCB0MztcbiAgJFswXSAhPT0gdDEgPyAodDMgPSB0MSA9PT0gdm9pZCAwID8gW10gOiB0MSwgJFswXSA9IHQxLCAkWzFdID0gdDMpIDogdDMgPSAkWzFdO1xuICBjb25zdCBlbmFibGUgPSB0MztcbiAgbGV0IHQ0O1xuICAkWzJdICE9PSB0MiA/ICh0NCA9IHQyID09PSB2b2lkIDAgPyBbXSA6IHQyLCAkWzJdID0gdDIsICRbM10gPSB0NCkgOiB0NCA9ICRbM107XG4gIGNvbnN0IGRpc2FibGUgPSB0NDtcbiAgbGV0IGVuYWJsZWRSdWxlcztcbiAgaWYgKCRbNF0gIT09IGRpc2FibGUgfHwgJFs1XSAhPT0gZW5hYmxlIHx8ICRbNl0gIT09IHByZXNldCkge1xuICAgIGlmIChlbmFibGVkUnVsZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCBwcmVzZXQgPT09IFwiYWxsXCIpXG4gICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgZGVmYXVsdFJ1bGVDb25maWcpXG4gICAgICAgIGVuYWJsZWRSdWxlcy5hZGQocnVsZS5uYW1lKTtcbiAgICBlbHNlIGlmIChwcmVzZXQgPT09IFwiZGVmYXVsdFwiKVxuICAgICAgZm9yIChjb25zdCBydWxlXzAgb2YgZGVmYXVsdFJ1bGVDb25maWcpXG4gICAgICAgIHJ1bGVfMC5zdGF0ZSA9PT0gXCJvblwiICYmIGVuYWJsZWRSdWxlcy5hZGQocnVsZV8wLm5hbWUpO1xuICAgIGZvciAoY29uc3QgcnVsZU5hbWUgb2YgZW5hYmxlKVxuICAgICAgZW5hYmxlZFJ1bGVzLmFkZChydWxlTmFtZSk7XG4gICAgZm9yIChjb25zdCBydWxlTmFtZV8wIG9mIGRpc2FibGUpXG4gICAgICBlbmFibGVkUnVsZXMuZGVsZXRlKHJ1bGVOYW1lXzApO1xuICAgICRbNF0gPSBkaXNhYmxlLCAkWzVdID0gZW5hYmxlLCAkWzZdID0gcHJlc2V0LCAkWzddID0gZW5hYmxlZFJ1bGVzO1xuICB9IGVsc2VcbiAgICBlbmFibGVkUnVsZXMgPSAkWzddO1xuICBsZXQgdDU7XG4gICRbOF0gIT09IGVuYWJsZWRSdWxlcyB8fCAkWzldICE9PSBndWFyZCA/ICh0NSA9IGRlZmF1bHRSdWxlQ29uZmlnLmZsYXRNYXAoKHJ1bGVfMSkgPT4gZW5hYmxlZFJ1bGVzLmhhcyhydWxlXzEubmFtZSkgPyBbe1xuICAgIC4uLnJ1bGVfMS5ydWxlLFxuICAgIGd1YXJkOiBndWFyZCA/PyBfdGVtcFxuICB9XSA6IFtdKSwgJFs4XSA9IGVuYWJsZWRSdWxlcywgJFs5XSA9IGd1YXJkLCAkWzEwXSA9IHQ1KSA6IHQ1ID0gJFsxMF07XG4gIGNvbnN0IGNvbmZpZ3VyZWRJbnB1dFJ1bGVzID0gdDU7XG4gIGxldCB0NjtcbiAgcmV0dXJuICRbMTFdICE9PSBjb25maWd1cmVkSW5wdXRSdWxlcyA/ICh0NiA9IC8qIEBfX1BVUkVfXyAqLyBqc3goSW5wdXRSdWxlUGx1Z2luLCB7IHJ1bGVzOiBjb25maWd1cmVkSW5wdXRSdWxlcyB9KSwgJFsxMV0gPSBjb25maWd1cmVkSW5wdXRSdWxlcywgJFsxMl0gPSB0NikgOiB0NiA9ICRbMTJdLCB0Njtcbn1cbmZ1bmN0aW9uIF90ZW1wKCkge1xuICByZXR1cm4gITA7XG59XG5leHBvcnQge1xuICBUeXBvZ3JhcGh5UGx1Z2luLFxuICBjbG9zaW5nRG91YmxlUXVvdGVSdWxlLFxuICBjbG9zaW5nU2luZ2xlUXVvdGVSdWxlLFxuICBjb3B5cmlnaHRSdWxlLFxuICBjcmVhdGVEZWNvcmF0b3JHdWFyZCxcbiAgZWxsaXBzaXNSdWxlLFxuICBlbURhc2hSdWxlLFxuICBsYXF1b1J1bGUsXG4gIGxlZnRBcnJvd1J1bGUsXG4gIG11bHRpcGxpY2F0aW9uUnVsZSxcbiAgbm90RXF1YWxSdWxlLFxuICBvbmVIYWxmUnVsZSxcbiAgb25lUXVhcnRlclJ1bGUsXG4gIG9wZW5pbmdEb3VibGVRdW90ZVJ1bGUsXG4gIG9wZW5pbmdTaW5nbGVRdW90ZVJ1bGUsXG4gIHBsdXNNaW51c1J1bGUsXG4gIHJhcXVvUnVsZSxcbiAgcmVnaXN0ZXJlZFRyYWRlbWFya1J1bGUsXG4gIHJpZ2h0QXJyb3dSdWxlLFxuICBzZXJ2aWNlbWFya1J1bGUsXG4gIHNtYXJ0UXVvdGVzUnVsZXMsXG4gIHN1cGVyc2NyaXB0VGhyZWVSdWxlLFxuICBzdXBlcnNjcmlwdFR3b1J1bGUsXG4gIHRocmVlUXVhcnRlcnNSdWxlLFxuICB0cmFkZW1hcmtSdWxlXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/plugin-typography/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/react/dist/index.js":
/*!********************************************************!*\
  !*** ./node_modules/@portabletext/react/dist/index.js ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PortableText: () => (/* binding */ PortableText),\n/* harmony export */   defaultComponents: () => (/* binding */ defaultComponents),\n/* harmony export */   mergeComponents: () => (/* binding */ mergeComponents),\n/* harmony export */   toPlainText: () => (/* reexport safe */ _portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.toPlainText)\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-jsx-runtime.js\");\n/* harmony import */ var _portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @portabletext/toolkit */ \"(ssr)/./node_modules/@portabletext/toolkit/dist/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n\n\n\nconst defaultLists = {\n\tnumber: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"ol\", { children }),\n\tbullet: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"ul\", { children })\n}, DefaultListItem = ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"li\", { children }), link = ({ children, value }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"a\", {\n\thref: value?.href,\n\tchildren\n}), underlineStyle = { textDecoration: \"underline\" }, defaultMarks = {\n\tem: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"em\", { children }),\n\tstrong: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"strong\", { children }),\n\tcode: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"code\", { children }),\n\tunderline: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", {\n\t\tstyle: underlineStyle,\n\t\tchildren\n\t}),\n\t\"strike-through\": ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"del\", { children }),\n\tlink\n}, getTemplate = (type, prop) => `[@portabletext/react] Unknown ${type}, specify a component for it in the \\`components.${prop}\\` prop`, unknownTypeWarning = (typeName) => getTemplate(`block type \"${typeName}\"`, \"types\"), unknownMarkWarning = (markType) => getTemplate(`mark type \"${markType}\"`, \"marks\"), unknownBlockStyleWarning = (blockStyle) => getTemplate(`block style \"${blockStyle}\"`, \"block\"), unknownListStyleWarning = (listStyle) => getTemplate(`list style \"${listStyle}\"`, \"list\"), unknownListItemStyleWarning = (listStyle) => getTemplate(`list item style \"${listStyle}\"`, \"listItem\");\nfunction printWarning(message) {\n\tconsole.warn(message);\n}\nconst hidden = { display: \"none\" }, defaultComponents = {\n\ttypes: {},\n\tblock: {\n\t\tnormal: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"p\", { children }),\n\t\tblockquote: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"blockquote\", { children }),\n\t\th1: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"h1\", { children }),\n\t\th2: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"h2\", { children }),\n\t\th3: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"h3\", { children }),\n\t\th4: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"h4\", { children }),\n\t\th5: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"h5\", { children }),\n\t\th6: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"h6\", { children })\n\t},\n\tmarks: defaultMarks,\n\tlist: defaultLists,\n\tlistItem: DefaultListItem,\n\thardBreak: () => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"br\", {}),\n\tunknownType: ({ value, isInline }) => {\n\t\tlet warning = unknownTypeWarning(value._type);\n\t\treturn (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(isInline ? \"span\" : \"div\", {\n\t\t\tstyle: hidden,\n\t\t\tchildren: warning\n\t\t});\n\t},\n\tunknownMark: ({ markType, children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", {\n\t\tclassName: `unknown__pt__mark__${markType}`,\n\t\tchildren\n\t}),\n\tunknownList: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"ul\", { children }),\n\tunknownListItem: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"li\", { children }),\n\tunknownBlockStyle: ({ children }) => /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"p\", { children })\n};\nfunction mergeComponents(parent, overrides) {\n\tlet { block: _block, list: _list, listItem: _listItem, marks: _marks, types: _types, ...rest } = overrides;\n\treturn {\n\t\t...parent,\n\t\tblock: mergeDeeply(parent, overrides, \"block\"),\n\t\tlist: mergeDeeply(parent, overrides, \"list\"),\n\t\tlistItem: mergeDeeply(parent, overrides, \"listItem\"),\n\t\tmarks: mergeDeeply(parent, overrides, \"marks\"),\n\t\ttypes: mergeDeeply(parent, overrides, \"types\"),\n\t\t...rest\n\t};\n}\nfunction mergeDeeply(parent, overrides, key) {\n\tlet override = overrides[key], parentVal = parent[key];\n\treturn typeof override == \"function\" || override && typeof parentVal == \"function\" ? override : override ? {\n\t\t...parentVal,\n\t\t...override\n\t} : parentVal;\n}\nfunction PortableText({ value: input, components: componentOverrides, listNestingMode, onMissingComponent: missingComponentHandler = printWarning }) {\n\tlet handleMissingComponent = missingComponentHandler || noop, nested = (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.nestLists)(Array.isArray(input) ? input : [input], listNestingMode || _portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.LIST_NEST_MODE_HTML), components = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => componentOverrides ? mergeComponents(defaultComponents, componentOverrides) : defaultComponents, [componentOverrides]), renderNode = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => getNodeRenderer(components, handleMissingComponent), [components, handleMissingComponent]);\n\treturn /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, { children: nested.map((node, index) => renderNode({\n\t\tnode,\n\t\tindex,\n\t\tisInline: !1,\n\t\trenderNode\n\t})) });\n}\nconst getNodeRenderer = (components, handleMissingComponent) => {\n\tfunction renderNode(options) {\n\t\tlet { node, index, isInline } = options, key = node._key || `node-${index}`;\n\t\treturn (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextToolkitList)(node) ? renderList(node, index, key) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextListItemBlock)(node) ? renderListItem(node, index, key) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextToolkitSpan)(node) ? renderSpan(node, index, key) : hasCustomComponentForNode(node) ? renderCustomBlock(node, index, key, isInline) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextBlock)(node) ? renderBlock(node, index, key, isInline) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.isPortableTextToolkitTextNode)(node) ? renderText(node, key) : renderUnknownType(node, index, key, isInline);\n\t}\n\tfunction hasCustomComponentForNode(node) {\n\t\treturn node._type in components.types;\n\t}\n\tfunction renderListItem(node, index, key) {\n\t\tlet tree = serializeBlock({\n\t\t\tnode,\n\t\t\tindex,\n\t\t\tisInline: !1,\n\t\t\trenderNode\n\t\t}), renderer = components.listItem, Li = (typeof renderer == \"function\" ? renderer : renderer[node.listItem]) || components.unknownListItem;\n\t\tif (Li === components.unknownListItem) {\n\t\t\tlet style = node.listItem || \"bullet\";\n\t\t\thandleMissingComponent(unknownListItemStyleWarning(style), {\n\t\t\t\ttype: style,\n\t\t\t\tnodeType: \"listItemStyle\"\n\t\t\t});\n\t\t}\n\t\tlet children = tree.children;\n\t\tif (node.style && node.style !== \"normal\") {\n\t\t\tlet { listItem: _listItem, ...blockNode } = node;\n\t\t\tchildren = renderNode({\n\t\t\t\tnode: blockNode,\n\t\t\t\tindex,\n\t\t\t\tisInline: !1,\n\t\t\t\trenderNode\n\t\t\t});\n\t\t}\n\t\treturn /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Li, {\n\t\t\tvalue: node,\n\t\t\tindex,\n\t\t\tisInline: !1,\n\t\t\trenderNode,\n\t\t\tchildren\n\t\t}, key);\n\t}\n\tfunction renderList(node, index, key) {\n\t\tlet children = node.children.map((child, childIndex) => renderNode({\n\t\t\tnode: child._key ? child : {\n\t\t\t\t...child,\n\t\t\t\t_key: `li-${index}-${childIndex}`\n\t\t\t},\n\t\t\tindex: childIndex,\n\t\t\tisInline: !1,\n\t\t\trenderNode\n\t\t})), component = components.list, List = (typeof component == \"function\" ? component : component[node.listItem]) || components.unknownList;\n\t\tif (List === components.unknownList) {\n\t\t\tlet style = node.listItem || \"bullet\";\n\t\t\thandleMissingComponent(unknownListStyleWarning(style), {\n\t\t\t\tnodeType: \"listStyle\",\n\t\t\t\ttype: style\n\t\t\t});\n\t\t}\n\t\treturn /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(List, {\n\t\t\tvalue: node,\n\t\t\tindex,\n\t\t\tisInline: !1,\n\t\t\trenderNode,\n\t\t\tchildren\n\t\t}, key);\n\t}\n\tfunction renderSpan(node, _index, key) {\n\t\tlet { markDef, markType, markKey } = node, Span = components.marks[markType] || components.unknownMark, children = node.children.map((child, childIndex) => renderNode({\n\t\t\tnode: child,\n\t\t\tindex: childIndex,\n\t\t\tisInline: !0,\n\t\t\trenderNode\n\t\t}));\n\t\treturn Span === components.unknownMark && handleMissingComponent(unknownMarkWarning(markType), {\n\t\t\tnodeType: \"mark\",\n\t\t\ttype: markType\n\t\t}), /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Span, {\n\t\t\ttext: (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.spanToPlainText)(node),\n\t\t\tvalue: markDef,\n\t\t\tmarkType,\n\t\t\tmarkKey,\n\t\t\trenderNode,\n\t\t\tchildren\n\t\t}, key);\n\t}\n\tfunction renderBlock(node, index, key, isInline) {\n\t\tlet { _key, ...props } = serializeBlock({\n\t\t\tnode,\n\t\t\tindex,\n\t\t\tisInline,\n\t\t\trenderNode\n\t\t}), style = props.node.style || \"normal\", Block = (typeof components.block == \"function\" ? components.block : components.block[style]) || components.unknownBlockStyle;\n\t\treturn Block === components.unknownBlockStyle && handleMissingComponent(unknownBlockStyleWarning(style), {\n\t\t\tnodeType: \"blockStyle\",\n\t\t\ttype: style\n\t\t}), /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Block, {\n\t\t\t...props,\n\t\t\tvalue: props.node,\n\t\t\trenderNode\n\t\t}, key);\n\t}\n\tfunction renderText(node, key) {\n\t\tif (node.text === \"\\n\") {\n\t\t\tlet HardBreak = components.hardBreak;\n\t\t\treturn HardBreak ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(HardBreak, {}, key) : \"\\n\";\n\t\t}\n\t\treturn node.text;\n\t}\n\tfunction renderUnknownType(node, index, key, isInline) {\n\t\tlet nodeOptions = {\n\t\t\tvalue: node,\n\t\t\tisInline,\n\t\t\tindex,\n\t\t\trenderNode\n\t\t};\n\t\thandleMissingComponent(unknownTypeWarning(node._type), {\n\t\t\tnodeType: \"block\",\n\t\t\ttype: node._type\n\t\t});\n\t\tlet UnknownType = components.unknownType;\n\t\treturn /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(UnknownType, { ...nodeOptions }, key);\n\t}\n\tfunction renderCustomBlock(node, index, key, isInline) {\n\t\tlet nodeOptions = {\n\t\t\tvalue: node,\n\t\t\tisInline,\n\t\t\tindex,\n\t\t\trenderNode\n\t\t}, Node = components.types[node._type];\n\t\treturn Node ? /* @__PURE__ */ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Node, { ...nodeOptions }, key) : null;\n\t}\n\treturn renderNode;\n};\nfunction serializeBlock(options) {\n\tlet { node, index, isInline, renderNode } = options, children = (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_2__.buildMarksTree)(node).map((child, i) => renderNode({\n\t\tnode: child,\n\t\tisInline: !0,\n\t\tindex: i,\n\t\trenderNode\n\t}));\n\treturn {\n\t\t_key: node._key || `block-${index}`,\n\t\tchildren,\n\t\tindex,\n\t\tisInline,\n\t\tnode\n\t};\n}\nfunction noop() {}\n\n\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9yZWFjdC9kaXN0L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBa0Q7QUFDME07QUFDNU47QUFDaEM7QUFDQSxZQUFZLFVBQVUscUJBQXFCLHNEQUFHLFNBQVMsVUFBVTtBQUNqRSxZQUFZLFVBQVUscUJBQXFCLHNEQUFHLFNBQVMsVUFBVTtBQUNqRSxDQUFDLHVCQUF1QixVQUFVLHFCQUFxQixzREFBRyxTQUFTLFVBQVUsYUFBYSxpQkFBaUIscUJBQXFCLHNEQUFHO0FBQ25JO0FBQ0E7QUFDQSxDQUFDLHNCQUFzQiw2QkFBNkI7QUFDcEQsUUFBUSxVQUFVLHFCQUFxQixzREFBRyxTQUFTLFVBQVU7QUFDN0QsWUFBWSxVQUFVLHFCQUFxQixzREFBRyxhQUFhLFVBQVU7QUFDckUsVUFBVSxVQUFVLHFCQUFxQixzREFBRyxXQUFXLFVBQVU7QUFDakUsZUFBZSxVQUFVLHFCQUFxQixzREFBRztBQUNqRDtBQUNBO0FBQ0EsRUFBRTtBQUNGLHNCQUFzQixVQUFVLHFCQUFxQixzREFBRyxVQUFVLFVBQVU7QUFDNUU7QUFDQSxDQUFDLGlFQUFpRSxLQUFLLG1EQUFtRCxLQUFLLHdFQUF3RSxTQUFTLDJFQUEyRSxTQUFTLHFGQUFxRixXQUFXLGtGQUFrRixVQUFVLDBGQUEwRixVQUFVO0FBQ3BrQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsaUJBQWlCO0FBQ2xDLFVBQVU7QUFDVjtBQUNBLGFBQWEsVUFBVSxxQkFBcUIsc0RBQUcsUUFBUSxVQUFVO0FBQ2pFLGlCQUFpQixVQUFVLHFCQUFxQixzREFBRyxpQkFBaUIsVUFBVTtBQUM5RSxTQUFTLFVBQVUscUJBQXFCLHNEQUFHLFNBQVMsVUFBVTtBQUM5RCxTQUFTLFVBQVUscUJBQXFCLHNEQUFHLFNBQVMsVUFBVTtBQUM5RCxTQUFTLFVBQVUscUJBQXFCLHNEQUFHLFNBQVMsVUFBVTtBQUM5RCxTQUFTLFVBQVUscUJBQXFCLHNEQUFHLFNBQVMsVUFB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUN5RTs7QUFFekUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L3JlYWN0L2Rpc3QvaW5kZXguanM/YzU3OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGcmFnbWVudCwganN4IH0gZnJvbSBcInJlYWN0L2pzeC1ydW50aW1lXCI7XG5pbXBvcnQgeyBMSVNUX05FU1RfTU9ERV9IVE1MLCBidWlsZE1hcmtzVHJlZSwgaXNQb3J0YWJsZVRleHRCbG9jaywgaXNQb3J0YWJsZVRleHRMaXN0SXRlbUJsb2NrLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRMaXN0LCBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRUZXh0Tm9kZSwgbmVzdExpc3RzLCBzcGFuVG9QbGFpblRleHQsIHRvUGxhaW5UZXh0IH0gZnJvbSBcIkBwb3J0YWJsZXRleHQvdG9vbGtpdFwiO1xuaW1wb3J0IHsgdXNlTWVtbyB9IGZyb20gXCJyZWFjdFwiO1xuY29uc3QgZGVmYXVsdExpc3RzID0ge1xuXHRudW1iZXI6ICh7IGNoaWxkcmVuIH0pID0+IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJvbFwiLCB7IGNoaWxkcmVuIH0pLFxuXHRidWxsZXQ6ICh7IGNoaWxkcmVuIH0pID0+IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJ1bFwiLCB7IGNoaWxkcmVuIH0pXG59LCBEZWZhdWx0TGlzdEl0ZW0gPSAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwibGlcIiwgeyBjaGlsZHJlbiB9KSwgbGluayA9ICh7IGNoaWxkcmVuLCB2YWx1ZSB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiYVwiLCB7XG5cdGhyZWY6IHZhbHVlPy5ocmVmLFxuXHRjaGlsZHJlblxufSksIHVuZGVybGluZVN0eWxlID0geyB0ZXh0RGVjb3JhdGlvbjogXCJ1bmRlcmxpbmVcIiB9LCBkZWZhdWx0TWFya3MgPSB7XG5cdGVtOiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiZW1cIiwgeyBjaGlsZHJlbiB9KSxcblx0c3Ryb25nOiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwic3Ryb25nXCIsIHsgY2hpbGRyZW4gfSksXG5cdGNvZGU6ICh7IGNoaWxkcmVuIH0pID0+IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJjb2RlXCIsIHsgY2hpbGRyZW4gfSksXG5cdHVuZGVybGluZTogKHsgY2hpbGRyZW4gfSkgPT4gLyogQF9fUFVSRV9fICovIGpzeChcInNwYW5cIiwge1xuXHRcdHN0eWxlOiB1bmRlcmxpbmVTdHlsZSxcblx0XHRjaGlsZHJlblxuXHR9KSxcblx0XCJzdHJpa2UtdGhyb3VnaFwiOiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiZGVsXCIsIHsgY2hpbGRyZW4gfSksXG5cdGxpbmtcbn0sIGdldFRlbXBsYXRlID0gKHR5cGUsIHByb3ApID0+IGBbQHBvcnRhYmxldGV4dC9yZWFjdF0gVW5rbm93biAke3R5cGV9LCBzcGVjaWZ5IGEgY29tcG9uZW50IGZvciBpdCBpbiB0aGUgXFxgY29tcG9uZW50cy4ke3Byb3B9XFxgIHByb3BgLCB1bmtub3duVHlwZVdhcm5pbmcgPSAodHlwZU5hbWUpID0+IGdldFRlbXBsYXRlKGBibG9jayB0eXBlIFwiJHt0eXBlTmFtZX1cImAsIFwidHlwZXNcIiksIHVua25vd25NYXJrV2FybmluZyA9IChtYXJrVHlwZSkgPT4gZ2V0VGVtcGxhdGUoYG1hcmsgdHlwZSBcIiR7bWFya1R5cGV9XCJgLCBcIm1hcmtzXCIpLCB1bmtub3duQmxvY2tTdHlsZVdhcm5pbmcgPSAoYmxvY2tTdHlsZSkgPT4gZ2V0VGVtcGxhdGUoYGJsb2NrIHN0eWxlIFwiJHtibG9ja1N0eWxlfVwiYCwgXCJibG9ja1wiKSwgdW5rbm93bkxpc3RTdHlsZVdhcm5pbmcgPSAobGlzdFN0eWxlKSA9PiBnZXRUZW1wbGF0ZShgbGlzdCBzdHlsZSBcIiR7bGlzdFN0eWxlfVwiYCwgXCJsaXN0XCIpLCB1bmtub3duTGlzdEl0ZW1TdHlsZVdhcm5pbmcgPSAobGlzdFN0eWxlKSA9PiBnZXRUZW1wbGF0ZShgbGlzdCBpdGVtIHN0eWxlIFwiJHtsaXN0U3R5bGV9XCJgLCBcImxpc3RJdGVtXCIpO1xuZnVuY3Rpb24gcHJpbnRXYXJuaW5nKG1lc3NhZ2UpIHtcblx0Y29uc29sZS53YXJuKG1lc3NhZ2UpO1xufVxuY29uc3QgaGlkZGVuID0geyBkaXNwbGF5OiBcIm5vbmVcIiB9LCBkZWZhdWx0Q29tcG9uZW50cyA9IHtcblx0dHlwZXM6IHt9LFxuXHRibG9jazoge1xuXHRcdG5vcm1hbDogKHsgY2hpbGRyZW4gfSkgPT4gLyogQF9fUFVSRV9fICovIGpzeChcInBcIiwgeyBjaGlsZHJlbiB9KSxcblx0XHRibG9ja3F1b3RlOiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiYmxvY2txdW90ZVwiLCB7IGNoaWxkcmVuIH0pLFxuXHRcdGgxOiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiaDFcIiwgeyBjaGlsZHJlbiB9KSxcblx0XHRoMjogKHsgY2hpbGRyZW4gfSkgPT4gLyogQF9fUFVSRV9fICovIGpzeChcImgyXCIsIHsgY2hpbGRyZW4gfSksXG5cdFx0aDM6ICh7IGNoaWxkcmVuIH0pID0+IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJoM1wiLCB7IGNoaWxkcmVuIH0pLFxuXHRcdGg0OiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiaDRcIiwgeyBjaGlsZHJlbiB9KSxcblx0XHRoNTogKHsgY2hpbGRyZW4gfSkgPT4gLyogQF9fUFVSRV9fICovIGpzeChcImg1XCIsIHsgY2hpbGRyZW4gfSksXG5cdFx0aDY6ICh7IGNoaWxkcmVuIH0pID0+IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJoNlwiLCB7IGNoaWxkcmVuIH0pXG5cdH0sXG5cdG1hcmtzOiBkZWZhdWx0TWFya3MsXG5cdGxpc3Q6IGRlZmF1bHRMaXN0cyxcblx0bGlzdEl0ZW06IERlZmF1bHRMaXN0SXRlbSxcblx0aGFyZEJyZWFrOiAoKSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwiYnJcIiwge30pLFxuXHR1bmtub3duVHlwZTogKHsgdmFsdWUsIGlzSW5saW5lIH0pID0+IHtcblx0XHRsZXQgd2FybmluZyA9IHVua25vd25UeXBlV2FybmluZyh2YWx1ZS5fdHlwZSk7XG5cdFx0cmV0dXJuIGpzeChpc0lubGluZSA/IFwic3BhblwiIDogXCJkaXZcIiwge1xuXHRcdFx0c3R5bGU6IGhpZGRlbixcblx0XHRcdGNoaWxkcmVuOiB3YXJuaW5nXG5cdFx0fSk7XG5cdH0sXG5cdHVua25vd25NYXJrOiAoeyBtYXJrVHlwZSwgY2hpbGRyZW4gfSkgPT4gLyogQF9fUFVSRV9fICovIGpzeChcInNwYW5cIiwge1xuXHRcdGNsYXNzTmFtZTogYHVua25vd25fX3B0X19tYXJrX18ke21hcmtUeXBlfWAsXG5cdFx0Y2hpbGRyZW5cblx0fSksXG5cdHVua25vd25MaXN0OiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwidWxcIiwgeyBjaGlsZHJlbiB9KSxcblx0dW5rbm93bkxpc3RJdGVtOiAoeyBjaGlsZHJlbiB9KSA9PiAvKiBAX19QVVJFX18gKi8ganN4KFwibGlcIiwgeyBjaGlsZHJlbiB9KSxcblx0dW5rbm93bkJsb2NrU3R5bGU6ICh7IGNoaWxkcmVuIH0pID0+IC8qIEBfX1BVUkVfXyAqLyBqc3goXCJwXCIsIHsgY2hpbGRyZW4gfSlcbn07XG5mdW5jdGlvbiBtZXJnZUNvbXBvbmVudHMocGFyZW50LCBvdmVycmlkZXMpIHtcblx0bGV0IHsgYmxvY2s6IF9ibG9jaywgbGlzdDogX2xpc3QsIGxpc3RJdGVtOiBfbGlzdEl0ZW0sIG1hcmtzOiBfbWFya3MsIHR5cGVzOiBfdHlwZXMsIC4uLnJlc3QgfSA9IG92ZXJyaWRlcztcblx0cmV0dXJuIHtcblx0XHQuLi5wYXJlbnQsXG5cdFx0YmxvY2s6IG1lcmdlRGVlcGx5KHBhcmVudCwgb3ZlcnJpZGVzLCBcImJsb2NrXCIpLFxuXHRcdGxpc3Q6IG1lcmdlRGVlcGx5KHBhcmVudCwgb3ZlcnJpZGVzLCBcImxpc3RcIiksXG5cdFx0bGlzdEl0ZW06IG1lcmdlRGVlcGx5KHBhcmVudCwgb3ZlcnJpZGVzLCBcImxpc3RJdGVtXCIpLFxuXHRcdG1hcmtzOiBtZXJnZURlZXBseShwYXJlbnQsIG92ZXJyaWRlcywgXCJtYXJrc1wiKSxcblx0XHR0eXBlczogbWVyZ2VEZWVwbHkocGFyZW50LCBvdmVycmlkZXMsIFwidHlwZXNcIiksXG5cdFx0Li4ucmVzdFxuXHR9O1xufVxuZnVuY3Rpb24gbWVyZ2VEZWVwbHkocGFyZW50LCBvdmVycmlkZXMsIGtleSkge1xuXHRsZXQgb3ZlcnJpZGUgPSBvdmVycmlkZXNba2V5XSwgcGFyZW50VmFsID0gcGFyZW50W2tleV07XG5cdHJldHVybiB0eXBlb2Ygb3ZlcnJpZGUgPT0gXCJmdW5jdGlvblwiIHx8IG92ZXJyaWRlICYmIHR5cGVvZiBwYXJlbnRWYWwgPT0gXCJmdW5jdGlvblwiID8gb3ZlcnJpZGUgOiBvdmVycmlkZSA/IHtcblx0XHQuLi5wYXJlbnRWYWwsXG5cdFx0Li4ub3ZlcnJpZGVcblx0fSA6IHBhcmVudFZhbDtcbn1cbmZ1bmN0aW9uIFBvcnRhYmxlVGV4dCh7IHZhbHVlOiBpbnB1dCwgY29tcG9uZW50czogY29tcG9uZW50T3ZlcnJpZGVzLCBsaXN0TmVzdGluZ01vZGUsIG9uTWlzc2luZ0NvbXBvbmVudDogbWlzc2luZ0NvbXBvbmVudEhhbmRsZXIgPSBwcmludFdhcm5pbmcgfSkge1xuXHRsZXQgaGFuZGxlTWlzc2luZ0NvbXBvbmVudCA9IG1pc3NpbmdDb21wb25lbnRIYW5kbGVyIHx8IG5vb3AsIG5lc3RlZCA9IG5lc3RMaXN0cyhBcnJheS5pc0FycmF5KGlucHV0KSA/IGlucHV0IDogW2lucHV0XSwgbGlzdE5lc3RpbmdNb2RlIHx8IExJU1RfTkVTVF9NT0RFX0hUTUwpLCBjb21wb25lbnRzID0gdXNlTWVtbygoKSA9PiBjb21wb25lbnRPdmVycmlkZXMgPyBtZXJnZUNvbXBvbmVudHMoZGVmYXVsdENvbXBvbmVudHMsIGNvbXBvbmVudE92ZXJyaWRlcykgOiBkZWZhdWx0Q29tcG9uZW50cywgW2NvbXBvbmVudE92ZXJyaWRlc10pLCByZW5kZXJOb2RlID0gdXNlTWVtbygoKSA9PiBnZXROb2RlUmVuZGVyZXIoY29tcG9uZW50cywgaGFuZGxlTWlzc2luZ0NvbXBvbmVudCksIFtjb21wb25lbnRzLCBoYW5kbGVNaXNzaW5nQ29tcG9uZW50XSk7XG5cdHJldHVybiAvKiBAX19QVVJFX18gKi8ganN4KEZyYWdtZW50LCB7IGNoaWxkcmVuOiBuZXN0ZWQubWFwKChub2RlLCBpbmRleCkgPT4gcmVuZGVyTm9kZSh7XG5cdFx0bm9kZSxcblx0XHRpbmRleCxcblx0XHRpc0lubGluZTogITEsXG5cdFx0cmVuZGVyTm9kZVxuXHR9KSkgfSk7XG59XG5jb25zdCBnZXROb2RlUmVuZGVyZXIgPSAoY29tcG9uZW50cywgaGFuZGxlTWlzc2luZ0NvbXBvbmVudCkgPT4ge1xuXHRmdW5jdGlvbiByZW5kZXJOb2RlKG9wdGlvbnMpIHtcblx0XHRsZXQgeyBub2RlLCBpbmRleCwgaXNJbmxpbmUgfSA9IG9wdGlvbnMsIGtleSA9IG5vZGUuX2tleSB8fCBgbm9kZS0ke2luZGV4fWA7XG5cdFx0cmV0dXJuIGlzUG9ydGFibGVUZXh0VG9vbGtpdExpc3Qobm9kZSkgPyByZW5kZXJMaXN0KG5vZGUsIGluZGV4LCBrZXkpIDogaXNQb3J0YWJsZVRleHRMaXN0SXRlbUJsb2NrKG5vZGUpID8gcmVuZGVyTGlzdEl0ZW0obm9kZSwgaW5kZXgsIGtleSkgOiBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuKG5vZGUpID8gcmVuZGVyU3Bhbihub2RlLCBpbmRleCwga2V5KSA6IGhhc0N1c3RvbUNvbXBvbmVudEZvck5vZGUobm9kZSkgPyByZW5kZXJDdXN0b21CbG9jayhub2RlLCBpbmRleCwga2V5LCBpc0lubGluZSkgOiBpc1BvcnRhYmxlVGV4dEJsb2NrKG5vZGUpID8gcmVuZGVyQmxvY2sobm9kZSwgaW5kZXgsIGtleSwgaXNJbmxpbmUpIDogaXNQb3J0YWJsZVRleHRUb29sa2l0VGV4dE5vZGUobm9kZSkgPyByZW5kZXJUZXh0KG5vZGUsIGtleSkgOiByZW5kZXJVbmtub3duVHlwZShub2RlLCBpbmRleCwga2V5LCBpc0lubGluZSk7XG5cdH1cblx0ZnVuY3Rpb24gaGFzQ3VzdG9tQ29tcG9uZW50Rm9yTm9kZShub2RlKSB7XG5cdFx0cmV0dXJuIG5vZGUuX3R5cGUgaW4gY29tcG9uZW50cy50eXBlcztcblx0fVxuXHRmdW5jdGlvbiByZW5kZXJMaXN0SXRlbShub2RlLCBpbmRleCwga2V5KSB7XG5cdFx0bGV0IHRyZWUgPSBzZXJpYWxpemVCbG9jayh7XG5cdFx0XHRub2RlLFxuXHRcdFx0aW5kZXgsXG5cdFx0XHRpc0lubGluZTogITEsXG5cdFx0XHRyZW5kZXJOb2RlXG5cdFx0fSksIHJlbmRlcmVyID0gY29tcG9uZW50cy5saXN0SXRlbSwgTGkgPSAodHlwZW9mIHJlbmRlcmVyID09IFwiZnVuY3Rpb25cIiA/IHJlbmRlcmVyIDogcmVuZGVyZXJbbm9kZS5saXN0SXRlbV0pIHx8IGNvbXBvbmVudHMudW5rbm93bkxpc3RJdGVtO1xuXHRcdGlmIChMaSA9PT0gY29tcG9uZW50cy51bmtub3duTGlzdEl0ZW0pIHtcblx0XHRcdGxldCBzdHlsZSA9IG5vZGUubGlzdEl0ZW0gfHwgXCJidWxsZXRcIjtcblx0XHRcdGhhbmRsZU1pc3NpbmdDb21wb25lbnQodW5rbm93bkxpc3RJdGVtU3R5bGVXYXJuaW5nKHN0eWxlKSwge1xuXHRcdFx0XHR0eXBlOiBzdHlsZSxcblx0XHRcdFx0bm9kZVR5cGU6IFwibGlzdEl0ZW1TdHlsZVwiXG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0bGV0IGNoaWxkcmVuID0gdHJlZS5jaGlsZHJlbjtcblx0XHRpZiAobm9kZS5zdHlsZSAmJiBub2RlLnN0eWxlICE9PSBcIm5vcm1hbFwiKSB7XG5cdFx0XHRsZXQgeyBsaXN0SXRlbTogX2xpc3RJdGVtLCAuLi5ibG9ja05vZGUgfSA9IG5vZGU7XG5cdFx0XHRjaGlsZHJlbiA9IHJlbmRlck5vZGUoe1xuXHRcdFx0XHRub2RlOiBibG9ja05vZGUsXG5cdFx0XHRcdGluZGV4LFxuXHRcdFx0XHRpc0lubGluZTogITEsXG5cdFx0XHRcdHJlbmRlck5vZGVcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRyZXR1cm4gLyogQF9fUFVSRV9fICovIGpzeChMaSwge1xuXHRcdFx0dmFsdWU6IG5vZGUsXG5cdFx0XHRpbmRleCxcblx0XHRcdGlzSW5saW5lOiAhMSxcblx0XHRcdHJlbmRlck5vZGUsXG5cdFx0XHRjaGlsZHJlblxuXHRcdH0sIGtleSk7XG5cdH1cblx0ZnVuY3Rpb24gcmVuZGVyTGlzdChub2RlLCBpbmRleCwga2V5KSB7XG5cdFx0bGV0IGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbi5tYXAoKGNoaWxkLCBjaGlsZEluZGV4KSA9PiByZW5kZXJOb2RlKHtcblx0XHRcdG5vZGU6IGNoaWxkLl9rZXkgPyBjaGlsZCA6IHtcblx0XHRcdFx0Li4uY2hpbGQsXG5cdFx0XHRcdF9rZXk6IGBsaS0ke2luZGV4fS0ke2NoaWxkSW5kZXh9YFxuXHRcdFx0fSxcblx0XHRcdGluZGV4OiBjaGlsZEluZGV4LFxuXHRcdFx0aXNJbmxpbmU6ICExLFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH0pKSwgY29tcG9uZW50ID0gY29tcG9uZW50cy5saXN0LCBMaXN0ID0gKHR5cGVvZiBjb21wb25lbnQgPT0gXCJmdW5jdGlvblwiID8gY29tcG9uZW50IDogY29tcG9uZW50W25vZGUubGlzdEl0ZW1dKSB8fCBjb21wb25lbnRzLnVua25vd25MaXN0O1xuXHRcdGlmIChMaXN0ID09PSBjb21wb25lbnRzLnVua25vd25MaXN0KSB7XG5cdFx0XHRsZXQgc3R5bGUgPSBub2RlLmxpc3RJdGVtIHx8IFwiYnVsbGV0XCI7XG5cdFx0XHRoYW5kbGVNaXNzaW5nQ29tcG9uZW50KHVua25vd25MaXN0U3R5bGVXYXJuaW5nKHN0eWxlKSwge1xuXHRcdFx0XHRub2RlVHlwZTogXCJsaXN0U3R5bGVcIixcblx0XHRcdFx0dHlwZTogc3R5bGVcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRyZXR1cm4gLyogQF9fUFVSRV9fICovIGpzeChMaXN0LCB7XG5cdFx0XHR2YWx1ZTogbm9kZSxcblx0XHRcdGluZGV4LFxuXHRcdFx0aXNJbmxpbmU6ICExLFxuXHRcdFx0cmVuZGVyTm9kZSxcblx0XHRcdGNoaWxkcmVuXG5cdFx0fSwga2V5KTtcblx0fVxuXHRmdW5jdGlvbiByZW5kZXJTcGFuKG5vZGUsIF9pbmRleCwga2V5KSB7XG5cdFx0bGV0IHsgbWFya0RlZiwgbWFya1R5cGUsIG1hcmtLZXkgfSA9IG5vZGUsIFNwYW4gPSBjb21wb25lbnRzLm1hcmtzW21hcmtUeXBlXSB8fCBjb21wb25lbnRzLnVua25vd25NYXJrLCBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW4ubWFwKChjaGlsZCwgY2hpbGRJbmRleCkgPT4gcmVuZGVyTm9kZSh7XG5cdFx0XHRub2RlOiBjaGlsZCxcblx0XHRcdGluZGV4OiBjaGlsZEluZGV4LFxuXHRcdFx0aXNJbmxpbmU6ICEwLFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH0pKTtcblx0XHRyZXR1cm4gU3BhbiA9PT0gY29tcG9uZW50cy51bmtub3duTWFyayAmJiBoYW5kbGVNaXNzaW5nQ29tcG9uZW50KHVua25vd25NYXJrV2FybmluZyhtYXJrVHlwZSksIHtcblx0XHRcdG5vZGVUeXBlOiBcIm1hcmtcIixcblx0XHRcdHR5cGU6IG1hcmtUeXBlXG5cdFx0fSksIC8qIEBfX1BVUkVfXyAqLyBqc3goU3Bhbiwge1xuXHRcdFx0dGV4dDogc3BhblRvUGxhaW5UZXh0KG5vZGUpLFxuXHRcdFx0dmFsdWU6IG1hcmtEZWYsXG5cdFx0XHRtYXJrVHlwZSxcblx0XHRcdG1hcmtLZXksXG5cdFx0XHRyZW5kZXJOb2RlLFxuXHRcdFx0Y2hpbGRyZW5cblx0XHR9LCBrZXkpO1xuXHR9XG5cdGZ1bmN0aW9uIHJlbmRlckJsb2NrKG5vZGUsIGluZGV4LCBrZXksIGlzSW5saW5lKSB7XG5cdFx0bGV0IHsgX2tleSwgLi4ucHJvcHMgfSA9IHNlcmlhbGl6ZUJsb2NrKHtcblx0XHRcdG5vZGUsXG5cdFx0XHRpbmRleCxcblx0XHRcdGlzSW5saW5lLFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH0pLCBzdHlsZSA9IHByb3BzLm5vZGUuc3R5bGUgfHwgXCJub3JtYWxcIiwgQmxvY2sgPSAodHlwZW9mIGNvbXBvbmVudHMuYmxvY2sgPT0gXCJmdW5jdGlvblwiID8gY29tcG9uZW50cy5ibG9jayA6IGNvbXBvbmVudHMuYmxvY2tbc3R5bGVdKSB8fCBjb21wb25lbnRzLnVua25vd25CbG9ja1N0eWxlO1xuXHRcdHJldHVybiBCbG9jayA9PT0gY29tcG9uZW50cy51bmtub3duQmxvY2tTdHlsZSAmJiBoYW5kbGVNaXNzaW5nQ29tcG9uZW50KHVua25vd25CbG9ja1N0eWxlV2FybmluZyhzdHlsZSksIHtcblx0XHRcdG5vZGVUeXBlOiBcImJsb2NrU3R5bGVcIixcblx0XHRcdHR5cGU6IHN0eWxlXG5cdFx0fSksIC8qIEBfX1BVUkVfXyAqLyBqc3goQmxvY2ssIHtcblx0XHRcdC4uLnByb3BzLFxuXHRcdFx0dmFsdWU6IHByb3BzLm5vZGUsXG5cdFx0XHRyZW5kZXJOb2RlXG5cdFx0fSwga2V5KTtcblx0fVxuXHRmdW5jdGlvbiByZW5kZXJUZXh0KG5vZGUsIGtleSkge1xuXHRcdGlmIChub2RlLnRleHQgPT09IFwiXFxuXCIpIHtcblx0XHRcdGxldCBIYXJkQnJlYWsgPSBjb21wb25lbnRzLmhhcmRCcmVhaztcblx0XHRcdHJldHVybiBIYXJkQnJlYWsgPyAvKiBAX19QVVJFX18gKi8ganN4KEhhcmRCcmVhaywge30sIGtleSkgOiBcIlxcblwiO1xuXHRcdH1cblx0XHRyZXR1cm4gbm9kZS50ZXh0O1xuXHR9XG5cdGZ1bmN0aW9uIHJlbmRlclVua25vd25UeXBlKG5vZGUsIGluZGV4LCBrZXksIGlzSW5saW5lKSB7XG5cdFx0bGV0IG5vZGVPcHRpb25zID0ge1xuXHRcdFx0dmFsdWU6IG5vZGUsXG5cdFx0XHRpc0lubGluZSxcblx0XHRcdGluZGV4LFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH07XG5cdFx0aGFuZGxlTWlzc2luZ0NvbXBvbmVudCh1bmtub3duVHlwZVdhcm5pbmcobm9kZS5fdHlwZSksIHtcblx0XHRcdG5vZGVUeXBlOiBcImJsb2NrXCIsXG5cdFx0XHR0eXBlOiBub2RlLl90eXBlXG5cdFx0fSk7XG5cdFx0bGV0IFVua25vd25UeXBlID0gY29tcG9uZW50cy51bmtub3duVHlwZTtcblx0XHRyZXR1cm4gLyogQF9fUFVSRV9fICovIGpzeChVbmtub3duVHlwZSwgeyAuLi5ub2RlT3B0aW9ucyB9LCBrZXkpO1xuXHR9XG5cdGZ1bmN0aW9uIHJlbmRlckN1c3RvbUJsb2NrKG5vZGUsIGluZGV4LCBrZXksIGlzSW5saW5lKSB7XG5cdFx0bGV0IG5vZGVPcHRpb25zID0ge1xuXHRcdFx0dmFsdWU6IG5vZGUsXG5cdFx0XHRpc0lubGluZSxcblx0XHRcdGluZGV4LFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH0sIE5vZGUgPSBjb21wb25lbnRzLnR5cGVzW25vZGUuX3R5cGVdO1xuXHRcdHJldHVybiBOb2RlID8gLyogQF9fUFVSRV9fICovIGpzeChOb2RlLCB7IC4uLm5vZGVPcHRpb25zIH0sIGtleSkgOiBudWxsO1xuXHR9XG5cdHJldHVybiByZW5kZXJOb2RlO1xufTtcbmZ1bmN0aW9uIHNlcmlhbGl6ZUJsb2NrKG9wdGlvbnMpIHtcblx0bGV0IHsgbm9kZSwgaW5kZXgsIGlzSW5saW5lLCByZW5kZXJOb2RlIH0gPSBvcHRpb25zLCBjaGlsZHJlbiA9IGJ1aWxkTWFya3NUcmVlKG5vZGUpLm1hcCgoY2hpbGQsIGkpID0+IHJlbmRlck5vZGUoe1xuXHRcdG5vZGU6IGNoaWxkLFxuXHRcdGlzSW5saW5lOiAhMCxcblx0XHRpbmRleDogaSxcblx0XHRyZW5kZXJOb2RlXG5cdH0pKTtcblx0cmV0dXJuIHtcblx0XHRfa2V5OiBub2RlLl9rZXkgfHwgYGJsb2NrLSR7aW5kZXh9YCxcblx0XHRjaGlsZHJlbixcblx0XHRpbmRleCxcblx0XHRpc0lubGluZSxcblx0XHRub2RlXG5cdH07XG59XG5mdW5jdGlvbiBub29wKCkge31cbmV4cG9ydCB7IFBvcnRhYmxlVGV4dCwgZGVmYXVsdENvbXBvbmVudHMsIG1lcmdlQ29tcG9uZW50cywgdG9QbGFpblRleHQgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/react/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/sanity-bridge/dist/index.js":
/*!****************************************************************!*\
  !*** ./node_modules/@portabletext/sanity-bridge/dist/index.js ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   compileSchemaDefinitionToPortableTextMemberSchemaTypes: () => (/* binding */ compileSchemaDefinitionToPortableTextMemberSchemaTypes),\n/* harmony export */   createPortableTextMemberSchemaTypes: () => (/* binding */ createPortableTextMemberSchemaTypes),\n/* harmony export */   portableTextMemberSchemaTypesToSchema: () => (/* binding */ portableTextMemberSchemaTypesToSchema),\n/* harmony export */   sanitySchemaToPortableTextSchema: () => (/* binding */ sanitySchemaToPortableTextSchema)\n/* harmony export */ });\n/* harmony import */ var _sanity_schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @sanity/schema */ \"(ssr)/./node_modules/@sanity/schema/lib/index.js\");\n/* harmony import */ var _sanity_schema_internal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @sanity/schema/_internal */ \"(ssr)/./node_modules/@sanity/schema/lib/_internal.js\");\n/* harmony import */ var _sanity_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @sanity/types */ \"(ssr)/./node_modules/@sanity/types/lib/index.js\");\n\n\n\nfunction createPortableTextMemberSchemaTypes(portableTextType) {\n  if (!portableTextType)\n    throw new Error(\"Parameter 'portabletextType' missing (required)\");\n  const blockType = portableTextType.of?.find(findBlockType);\n  if (!blockType)\n    throw new Error(\"Block type is not defined in this schema (required)\");\n  const childrenField = blockType.fields?.find(\n    (field) => field.name === \"children\"\n  );\n  if (!childrenField)\n    throw new Error(\"Children field for block type found in schema (required)\");\n  const ofType = childrenField.type.of;\n  if (!ofType)\n    throw new Error(\n      \"Valid types for block children not found in schema (required)\"\n    );\n  const spanType = ofType.find((memberType) => memberType.name === \"span\");\n  if (!spanType)\n    throw new Error(\"Span type not found in schema (required)\");\n  const inlineObjectTypes = ofType.filter(\n    (memberType) => memberType.name !== \"span\"\n  ) || [], blockObjectTypes = portableTextType.of?.filter(\n    (field) => field.name !== blockType.name\n  ) || [];\n  return {\n    styles: resolveEnabledStyles(blockType),\n    decorators: resolveEnabledDecorators(spanType),\n    lists: resolveEnabledListItems(blockType),\n    block: blockType,\n    span: spanType,\n    portableText: portableTextType,\n    inlineObjects: inlineObjectTypes,\n    blockObjects: blockObjectTypes,\n    annotations: spanType.annotations\n  };\n}\nfunction resolveEnabledStyles(blockType) {\n  const styleField = blockType.fields?.find(\n    (btField) => btField.name === \"style\"\n  );\n  if (!styleField)\n    throw new Error(\n      \"A field with name 'style' is not defined in the block type (required).\"\n    );\n  const textStyles = styleField.type.options?.list && styleField.type.options.list?.filter(\n    (style) => style.value\n  );\n  if (!textStyles || textStyles.length === 0)\n    throw new Error(\n      \"The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.\"\n    );\n  return textStyles;\n}\nfunction resolveEnabledDecorators(spanType) {\n  return spanType.decorators;\n}\nfunction resolveEnabledListItems(blockType) {\n  const listField = blockType.fields?.find(\n    (btField) => btField.name === \"listItem\"\n  );\n  if (!listField)\n    throw new Error(\n      \"A field with name 'listItem' is not defined in the block type (required).\"\n    );\n  const listItems = listField.type.options?.list && listField.type.options.list.filter((list) => list.value);\n  if (!listItems)\n    throw new Error(\"The list field need at least to be an empty array\");\n  return listItems;\n}\nfunction findBlockType(type) {\n  return type.type ? findBlockType(type.type) : type.name === \"block\" ? type : null;\n}\nfunction portableTextMemberSchemaTypesToSchema(schema) {\n  return {\n    annotations: schema.annotations.map((annotation) => ({\n      name: annotation.name,\n      fields: annotation.fields.map((field) => ({\n        name: field.name,\n        type: field.type.jsonType,\n        title: field.type.title\n      })),\n      title: annotation.title\n    })),\n    block: {\n      name: schema.block.name\n    },\n    blockObjects: schema.blockObjects.map((blockObject) => ({\n      name: blockObject.name,\n      fields: blockObject.fields.map((field) => ({\n        name: field.name,\n        type: field.type.jsonType,\n        title: field.type.title\n      })),\n      title: blockObject.title\n    })),\n    decorators: schema.decorators.map((decorator) => ({\n      name: decorator.value,\n      title: decorator.title,\n      value: decorator.value\n    })),\n    inlineObjects: schema.inlineObjects.map((inlineObject) => ({\n      name: inlineObject.name,\n      fields: inlineObject.fields.map((field) => ({\n        name: field.name,\n        type: field.type.jsonType,\n        title: field.type.title\n      })),\n      title: inlineObject.title\n    })),\n    span: {\n      name: schema.span.name\n    },\n    styles: schema.styles.map((style) => ({\n      name: style.value,\n      title: style.title,\n      value: style.value\n    })),\n    lists: schema.lists.map((list) => ({\n      name: list.value,\n      title: list.title,\n      value: list.value\n    }))\n  };\n}\nfunction sanitySchemaToPortableTextSchema(sanitySchema) {\n  const portableTextMemberSchemaTypes = createPortableTextMemberSchemaTypes(\n    sanitySchema.hasOwnProperty(\"jsonType\") ? sanitySchema : compileType(sanitySchema)\n  );\n  return portableTextMemberSchemaTypesToSchema(portableTextMemberSchemaTypes);\n}\nfunction compileType(rawType) {\n  return _sanity_schema__WEBPACK_IMPORTED_MODULE_0__.Schema.compile({\n    name: \"blockTypeSchema\",\n    types: [rawType, ..._sanity_schema_internal__WEBPACK_IMPORTED_MODULE_1__.builtinTypes]\n  }).get(rawType.name);\n}\nconst keyGenerator = () => randomKey(12), getByteHexTable = /* @__PURE__ */ (() => {\n  let table;\n  return () => {\n    if (table)\n      return table;\n    table = [];\n    for (let i = 0; i < 256; ++i)\n      table[i] = (i + 256).toString(16).slice(1);\n    return table;\n  };\n})();\nfunction whatwgRNG(length = 16) {\n  const rnds8 = new Uint8Array(length);\n  return crypto.getRandomValues(rnds8), rnds8;\n}\nfunction randomKey(length) {\n  const table = getByteHexTable();\n  return whatwgRNG(length).reduce((str, n) => str + table[n], \"\").slice(0, length);\n}\nfunction startCase(str) {\n  return str.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/[_-]+/g, \" \").trim().split(/\\s+/).filter(Boolean).map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(\" \");\n}\nconst temporaryImageBlockObjectName = `tmp-${keyGenerator()}-image`, temporaryUrlBlockObjectName = `tmp-${keyGenerator()}-url`, temporaryImageInlineObjectName = `tmp-${keyGenerator()}-image`, temporaryUrlInlineObjectName = `tmp-${keyGenerator()}-url`, temporaryBlockObjectNames = {\n  image: temporaryImageBlockObjectName,\n  url: temporaryUrlBlockObjectName\n}, temporaryInlineObjectNames = {\n  image: temporaryImageInlineObjectName,\n  url: temporaryUrlInlineObjectName\n}, blockObjectNames = {\n  [temporaryImageBlockObjectName]: \"image\",\n  [temporaryUrlBlockObjectName]: \"url\"\n}, inlineObjectNames = {\n  [temporaryImageInlineObjectName]: \"image\",\n  [temporaryUrlInlineObjectName]: \"url\"\n}, defaultObjectTitles = {\n  image: \"Image\",\n  url: \"URL\"\n};\nfunction compileSchemaDefinitionToPortableTextMemberSchemaTypes(definition) {\n  const blockObjects = definition?.blockObjects?.map(\n    (blockObject) => (0,_sanity_types__WEBPACK_IMPORTED_MODULE_2__.defineType)({\n      type: \"object\",\n      // Very naive way to work around `SanitySchema.compile` adding default\n      // fields to objects with certain names.\n      name: temporaryBlockObjectNames[blockObject.name] ?? blockObject.name,\n      title: blockObject.title === void 0 ? (\n        // This avoids the default title which is a title case of the object name\n        defaultObjectTitles[blockObject.name]\n      ) : blockObject.title,\n      fields: blockObject.fields?.map((field) => ({\n        name: field.name,\n        type: field.type,\n        title: field.title ?? startCase(field.name)\n      })) ?? []\n    })\n  ) ?? [], inlineObjects = definition?.inlineObjects?.map(\n    (inlineObject) => (0,_sanity_types__WEBPACK_IMPORTED_MODULE_2__.defineType)({\n      type: \"object\",\n      // Very naive way to work around `SanitySchema.compile` adding default\n      // fields to objects with certain names.\n      name: temporaryInlineObjectNames[inlineObject.name] ?? inlineObject.name,\n      title: inlineObject.title === void 0 ? (\n        // This avoids the default title which is a title case of the object name\n        defaultObjectTitles[inlineObject.name]\n      ) : inlineObject.title,\n      fields: inlineObject.fields?.map((field) => ({\n        name: field.name,\n        type: field.type,\n        title: field.title ?? startCase(field.name)\n      })) ?? []\n    })\n  ) ?? [], portableTextSchema = (0,_sanity_types__WEBPACK_IMPORTED_MODULE_2__.defineField)({\n    type: \"array\",\n    name: \"portable-text\",\n    of: [\n      ...blockObjects.map((blockObject) => ({ type: blockObject.name })),\n      {\n        type: \"block\",\n        name: \"block\",\n        of: inlineObjects.map((inlineObject) => ({ type: inlineObject.name })),\n        marks: {\n          decorators: definition?.decorators?.map((decorator) => ({\n            title: decorator.title ?? startCase(decorator.name),\n            value: decorator.name\n          })) ?? [],\n          annotations: definition?.annotations?.map((annotation) => ({\n            name: annotation.name,\n            type: \"object\",\n            title: annotation.title,\n            fields: annotation.fields?.map((field) => ({\n              name: field.name,\n              title: field.title ?? startCase(field.name),\n              type: field.type\n            })) ?? []\n          })) ?? []\n        },\n        lists: definition?.lists?.map((list) => ({\n          value: list.name,\n          title: list.title ?? startCase(list.name)\n        })) ?? [],\n        styles: definition?.styles?.map((style) => ({\n          value: style.name,\n          title: style.title ?? startCase(style.name)\n        })) ?? []\n      }\n    ]\n  }), schema = _sanity_schema__WEBPACK_IMPORTED_MODULE_0__.Schema.compile({\n    types: [portableTextSchema, ...blockObjects, ...inlineObjects]\n  }).get(\"portable-text\"), pteSchema = createPortableTextMemberSchemaTypes(schema);\n  return {\n    ...pteSchema,\n    portableText: {\n      ...pteSchema.portableText,\n      of: pteSchema.portableText.of.map((schemaType) => {\n        if (!(0,_sanity_types__WEBPACK_IMPORTED_MODULE_2__.isObjectSchemaType)(schemaType))\n          return schemaType;\n        const nameMapping = blockObjectNames[schemaType.name];\n        schemaType.name = nameMapping ?? schemaType.name;\n        for (const field of schemaType.fields)\n          if (!(field.name !== \"children\" || !(0,_sanity_types__WEBPACK_IMPORTED_MODULE_2__.isArraySchemaType)(field.type)))\n            for (const ofSchemaType of field.type.of) {\n              const nameMapping2 = inlineObjectNames[ofSchemaType.name];\n              nameMapping2 && (ofSchemaType.name = nameMapping2);\n            }\n        return schemaType;\n      })\n    },\n    blockObjects: pteSchema.blockObjects.map(\n      (blockObject) => blockObjectNames[blockObject.name] !== void 0 ? {\n        ...blockObject,\n        name: blockObjectNames[blockObject.name],\n        type: {\n          ...blockObject.type,\n          name: blockObjectNames[blockObject.name]\n        }\n      } : blockObject\n    ),\n    inlineObjects: pteSchema.inlineObjects.map(\n      (inlineObject) => inlineObjectNames[inlineObject.name] !== void 0 ? {\n        ...inlineObject,\n        name: inlineObjectNames[inlineObject.name]\n      } : inlineObject\n    )\n  };\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9zYW5pdHktYnJpZGdlL2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUF3QztBQUNnQjtBQUN1QztBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxpQ0FBaUM7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsa0RBQU07QUFDZjtBQUNBLHdCQUF3QixpRUFBWTtBQUNwQyxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxlQUFlLDhDQUE4QyxlQUFlLCtDQUErQyxlQUFlLCtDQUErQyxlQUFlO0FBQ3JQO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQix5REFBVTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0Esc0JBQXNCLHlEQUFVO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsZ0NBQWdDLDBEQUFXO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLDhDQUE4Qyx3QkFBd0I7QUFDdEU7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELHlCQUF5QjtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFdBQVc7QUFDWCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsR0FBRyxZQUFZLGtEQUFNO0FBQ3JCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlFQUFrQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxnRUFBaUI7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQU1FO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmlzcC1jbGVhbmluZy8uL25vZGVfbW9kdWxlcy9AcG9ydGFibGV0ZXh0L3Nhbml0eS1icmlkZ2UvZGlzdC9pbmRleC5qcz9kZGEyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNjaGVtYSB9IGZyb20gXCJAc2FuaXR5L3NjaGVtYVwiO1xuaW1wb3J0IHsgYnVpbHRpblR5cGVzIH0gZnJvbSBcIkBzYW5pdHkvc2NoZW1hL19pbnRlcm5hbFwiO1xuaW1wb3J0IHsgZGVmaW5lVHlwZSwgZGVmaW5lRmllbGQsIGlzT2JqZWN0U2NoZW1hVHlwZSwgaXNBcnJheVNjaGVtYVR5cGUgfSBmcm9tIFwiQHNhbml0eS90eXBlc1wiO1xuZnVuY3Rpb24gY3JlYXRlUG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXMocG9ydGFibGVUZXh0VHlwZSkge1xuICBpZiAoIXBvcnRhYmxlVGV4dFR5cGUpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUGFyYW1ldGVyICdwb3J0YWJsZXRleHRUeXBlJyBtaXNzaW5nIChyZXF1aXJlZClcIik7XG4gIGNvbnN0IGJsb2NrVHlwZSA9IHBvcnRhYmxlVGV4dFR5cGUub2Y/LmZpbmQoZmluZEJsb2NrVHlwZSk7XG4gIGlmICghYmxvY2tUeXBlKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkJsb2NrIHR5cGUgaXMgbm90IGRlZmluZWQgaW4gdGhpcyBzY2hlbWEgKHJlcXVpcmVkKVwiKTtcbiAgY29uc3QgY2hpbGRyZW5GaWVsZCA9IGJsb2NrVHlwZS5maWVsZHM/LmZpbmQoXG4gICAgKGZpZWxkKSA9PiBmaWVsZC5uYW1lID09PSBcImNoaWxkcmVuXCJcbiAgKTtcbiAgaWYgKCFjaGlsZHJlbkZpZWxkKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkNoaWxkcmVuIGZpZWxkIGZvciBibG9jayB0eXBlIGZvdW5kIGluIHNjaGVtYSAocmVxdWlyZWQpXCIpO1xuICBjb25zdCBvZlR5cGUgPSBjaGlsZHJlbkZpZWxkLnR5cGUub2Y7XG4gIGlmICghb2ZUeXBlKVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiVmFsaWQgdHlwZXMgZm9yIGJsb2NrIGNoaWxkcmVuIG5vdCBmb3VuZCBpbiBzY2hlbWEgKHJlcXVpcmVkKVwiXG4gICAgKTtcbiAgY29uc3Qgc3BhblR5cGUgPSBvZlR5cGUuZmluZCgobWVtYmVyVHlwZSkgPT4gbWVtYmVyVHlwZS5uYW1lID09PSBcInNwYW5cIik7XG4gIGlmICghc3BhblR5cGUpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU3BhbiB0eXBlIG5vdCBmb3VuZCBpbiBzY2hlbWEgKHJlcXVpcmVkKVwiKTtcbiAgY29uc3QgaW5saW5lT2JqZWN0VHlwZXMgPSBvZlR5cGUuZmlsdGVyKFxuICAgIChtZW1iZXJUeXBlKSA9PiBtZW1iZXJUeXBlLm5hbWUgIT09IFwic3BhblwiXG4gICkgfHwgW10sIGJsb2NrT2JqZWN0VHlwZXMgPSBwb3J0YWJsZVRleHRUeXBlLm9mPy5maWx0ZXIoXG4gICAgKGZpZWxkKSA9PiBmaWVsZC5uYW1lICE9PSBibG9ja1R5cGUubmFtZVxuICApIHx8IFtdO1xuICByZXR1cm4ge1xuICAgIHN0eWxlczogcmVzb2x2ZUVuYWJsZWRTdHlsZXMoYmxvY2tUeXBlKSxcbiAgICBkZWNvcmF0b3JzOiByZXNvbHZlRW5hYmxlZERlY29yYXRvcnMoc3BhblR5cGUpLFxuICAgIGxpc3RzOiByZXNvbHZlRW5hYmxlZExpc3RJdGVtcyhibG9ja1R5cGUpLFxuICAgIGJsb2NrOiBibG9ja1R5cGUsXG4gICAgc3Bhbjogc3BhblR5cGUsXG4gICAgcG9ydGFibGVUZXh0OiBwb3J0YWJsZVRleHRUeXBlLFxuICAgIGlubGluZU9iamVjdHM6IGlubGluZU9iamVjdFR5cGVzLFxuICAgIGJsb2NrT2JqZWN0czogYmxvY2tPYmplY3RUeXBlcyxcbiAgICBhbm5vdGF0aW9uczogc3BhblR5cGUuYW5ub3RhdGlvbnNcbiAgfTtcbn1cbmZ1bmN0aW9uIHJlc29sdmVFbmFibGVkU3R5bGVzKGJsb2NrVHlwZSkge1xuICBjb25zdCBzdHlsZUZpZWxkID0gYmxvY2tUeXBlLmZpZWxkcz8uZmluZChcbiAgICAoYnRGaWVsZCkgPT4gYnRGaWVsZC5uYW1lID09PSBcInN0eWxlXCJcbiAgKTtcbiAgaWYgKCFzdHlsZUZpZWxkKVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiQSBmaWVsZCB3aXRoIG5hbWUgJ3N0eWxlJyBpcyBub3QgZGVmaW5lZCBpbiB0aGUgYmxvY2sgdHlwZSAocmVxdWlyZWQpLlwiXG4gICAgKTtcbiAgY29uc3QgdGV4dFN0eWxlcyA9IHN0eWxlRmllbGQudHlwZS5vcHRpb25zPy5saXN0ICYmIHN0eWxlRmllbGQudHlwZS5vcHRpb25zLmxpc3Q/LmZpbHRlcihcbiAgICAoc3R5bGUpID0+IHN0eWxlLnZhbHVlXG4gICk7XG4gIGlmICghdGV4dFN0eWxlcyB8fCB0ZXh0U3R5bGVzLmxlbmd0aCA9PT0gMClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIlRoZSBzdHlsZSBmaWVsZHMgbmVlZCBhdCBsZWFzdCBvbmUgc3R5bGUgZGVmaW5lZC4gSS5lOiB7dGl0bGU6ICdOb3JtYWwnLCB2YWx1ZTogJ25vcm1hbCd9LlwiXG4gICAgKTtcbiAgcmV0dXJuIHRleHRTdHlsZXM7XG59XG5mdW5jdGlvbiByZXNvbHZlRW5hYmxlZERlY29yYXRvcnMoc3BhblR5cGUpIHtcbiAgcmV0dXJuIHNwYW5UeXBlLmRlY29yYXRvcnM7XG59XG5mdW5jdGlvbiByZXNvbHZlRW5hYmxlZExpc3RJdGVtcyhibG9ja1R5cGUpIHtcbiAgY29uc3QgbGlzdEZpZWxkID0gYmxvY2tUeXBlLmZpZWxkcz8uZmluZChcbiAgICAoYnRGaWVsZCkgPT4gYnRGaWVsZC5uYW1lID09PSBcImxpc3RJdGVtXCJcbiAgKTtcbiAgaWYgKCFsaXN0RmllbGQpXG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJBIGZpZWxkIHdpdGggbmFtZSAnbGlzdEl0ZW0nIGlzIG5vdCBkZWZpbmVkIGluIHRoZSBibG9jayB0eXBlIChyZXF1aXJlZCkuXCJcbiAgICApO1xuICBjb25zdCBsaXN0SXRlbXMgPSBsaXN0RmllbGQudHlwZS5vcHRpb25zPy5saXN0ICYmIGxpc3RGaWVsZC50eXBlLm9wdGlvbnMubGlzdC5maWx0ZXIoKGxpc3QpID0+IGxpc3QudmFsdWUpO1xuICBpZiAoIWxpc3RJdGVtcylcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbGlzdCBmaWVsZCBuZWVkIGF0IGxlYXN0IHRvIGJlIGFuIGVtcHR5IGFycmF5XCIpO1xuICByZXR1cm4gbGlzdEl0ZW1zO1xufVxuZnVuY3Rpb24gZmluZEJsb2NrVHlwZSh0eXBlKSB7XG4gIHJldHVybiB0eXBlLnR5cGUgPyBmaW5kQmxvY2tUeXBlKHR5cGUudHlwZSkgOiB0eXBlLm5hbWUgPT09IFwiYmxvY2tcIiA/IHR5cGUgOiBudWxsO1xufVxuZnVuY3Rpb24gcG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXNUb1NjaGVtYShzY2hlbWEpIHtcbiAgcmV0dXJuIHtcbiAgICBhbm5vdGF0aW9uczogc2NoZW1hLmFubm90YXRpb25zLm1hcCgoYW5ub3RhdGlvbikgPT4gKHtcbiAgICAgIG5hbWU6IGFubm90YXRpb24ubmFtZSxcbiAgICAgIGZpZWxkczogYW5ub3RhdGlvbi5maWVsZHMubWFwKChmaWVsZCkgPT4gKHtcbiAgICAgICAgbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAgdHlwZTogZmllbGQudHlwZS5qc29uVHlwZSxcbiAgICAgICAgdGl0bGU6IGZpZWxkLnR5cGUudGl0bGVcbiAgICAgIH0pKSxcbiAgICAgIHRpdGxlOiBhbm5vdGF0aW9uLnRpdGxlXG4gICAgfSkpLFxuICAgIGJsb2NrOiB7XG4gICAgICBuYW1lOiBzY2hlbWEuYmxvY2submFtZVxuICAgIH0sXG4gICAgYmxvY2tPYmplY3RzOiBzY2hlbWEuYmxvY2tPYmplY3RzLm1hcCgoYmxvY2tPYmplY3QpID0+ICh7XG4gICAgICBuYW1lOiBibG9ja09iamVjdC5uYW1lLFxuICAgICAgZmllbGRzOiBibG9ja09iamVjdC5maWVsZHMubWFwKChmaWVsZCkgPT4gKHtcbiAgICAgICAgbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAgdHlwZTogZmllbGQudHlwZS5qc29uVHlwZSxcbiAgICAgICAgdGl0bGU6IGZpZWxkLnR5cGUudGl0bGVcbiAgICAgIH0pKSxcbiAgICAgIHRpdGxlOiBibG9ja09iamVjdC50aXRsZVxuICAgIH0pKSxcbiAgICBkZWNvcmF0b3JzOiBzY2hlbWEuZGVjb3JhdG9ycy5tYXAoKGRlY29yYXRvcikgPT4gKHtcbiAgICAgIG5hbWU6IGRlY29yYXRvci52YWx1ZSxcbiAgICAgIHRpdGxlOiBkZWNvcmF0b3IudGl0bGUsXG4gICAgICB2YWx1ZTogZGVjb3JhdG9yLnZhbHVlXG4gICAgfSkpLFxuICAgIGlubGluZU9iamVjdHM6IHNjaGVtYS5pbmxpbmVPYmplY3RzLm1hcCgoaW5saW5lT2JqZWN0KSA9PiAoe1xuICAgICAgbmFtZTogaW5saW5lT2JqZWN0Lm5hbWUsXG4gICAgICBmaWVsZHM6IGlubGluZU9iamVjdC5maWVsZHMubWFwKChmaWVsZCkgPT4gKHtcbiAgICAgICAgbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAgdHlwZTogZmllbGQudHlwZS5qc29uVHlwZSxcbiAgICAgICAgdGl0bGU6IGZpZWxkLnR5cGUudGl0bGVcbiAgICAgIH0pKSxcbiAgICAgIHRpdGxlOiBpbmxpbmVPYmplY3QudGl0bGVcbiAgICB9KSksXG4gICAgc3Bhbjoge1xuICAgICAgbmFtZTogc2NoZW1hLnNwYW4ubmFtZVxuICAgIH0sXG4gICAgc3R5bGVzOiBzY2hlbWEuc3R5bGVzLm1hcCgoc3R5bGUpID0+ICh7XG4gICAgICBuYW1lOiBzdHlsZS52YWx1ZSxcbiAgICAgIHRpdGxlOiBzdHlsZS50aXRsZSxcbiAgICAgIHZhbHVlOiBzdHlsZS52YWx1ZVxuICAgIH0pKSxcbiAgICBsaXN0czogc2NoZW1hLmxpc3RzLm1hcCgobGlzdCkgPT4gKHtcbiAgICAgIG5hbWU6IGxpc3QudmFsdWUsXG4gICAgICB0aXRsZTogbGlzdC50aXRsZSxcbiAgICAgIHZhbHVlOiBsaXN0LnZhbHVlXG4gICAgfSkpXG4gIH07XG59XG5mdW5jdGlvbiBzYW5pdHlTY2hlbWFUb1BvcnRhYmxlVGV4dFNjaGVtYShzYW5pdHlTY2hlbWEpIHtcbiAgY29uc3QgcG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXMgPSBjcmVhdGVQb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlcyhcbiAgICBzYW5pdHlTY2hlbWEuaGFzT3duUHJvcGVydHkoXCJqc29uVHlwZVwiKSA/IHNhbml0eVNjaGVtYSA6IGNvbXBpbGVUeXBlKHNhbml0eVNjaGVtYSlcbiAgKTtcbiAgcmV0dXJuIHBvcnRhYmxlVGV4dE1lbWJlclNjaGVtYVR5cGVzVG9TY2hlbWEocG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXMpO1xufVxuZnVuY3Rpb24gY29tcGlsZVR5cGUocmF3VHlwZSkge1xuICByZXR1cm4gU2NoZW1hLmNvbXBpbGUoe1xuICAgIG5hbWU6IFwiYmxvY2tUeXBlU2NoZW1hXCIsXG4gICAgdHlwZXM6IFtyYXdUeXBlLCAuLi5idWlsdGluVHlwZXNdXG4gIH0pLmdldChyYXdUeXBlLm5hbWUpO1xufVxuY29uc3Qga2V5R2VuZXJhdG9yID0gKCkgPT4gcmFuZG9tS2V5KDEyKSwgZ2V0Qnl0ZUhleFRhYmxlID0gLyogQF9fUFVSRV9fICovICgoKSA9PiB7XG4gIGxldCB0YWJsZTtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBpZiAodGFibGUpXG4gICAgICByZXR1cm4gdGFibGU7XG4gICAgdGFibGUgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgKytpKVxuICAgICAgdGFibGVbaV0gPSAoaSArIDI1NikudG9TdHJpbmcoMTYpLnNsaWNlKDEpO1xuICAgIHJldHVybiB0YWJsZTtcbiAgfTtcbn0pKCk7XG5mdW5jdGlvbiB3aGF0d2dSTkcobGVuZ3RoID0gMTYpIHtcbiAgY29uc3Qgcm5kczggPSBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICByZXR1cm4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhybmRzOCksIHJuZHM4O1xufVxuZnVuY3Rpb24gcmFuZG9tS2V5KGxlbmd0aCkge1xuICBjb25zdCB0YWJsZSA9IGdldEJ5dGVIZXhUYWJsZSgpO1xuICByZXR1cm4gd2hhdHdnUk5HKGxlbmd0aCkucmVkdWNlKChzdHIsIG4pID0+IHN0ciArIHRhYmxlW25dLCBcIlwiKS5zbGljZSgwLCBsZW5ndGgpO1xufVxuZnVuY3Rpb24gc3RhcnRDYXNlKHN0cikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csIFwiJDEgJDJcIikucmVwbGFjZSgvW18tXSsvZywgXCIgXCIpLnRyaW0oKS5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKS5tYXAoKHdvcmQpID0+IHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKS5qb2luKFwiIFwiKTtcbn1cbmNvbnN0IHRlbXBvcmFyeUltYWdlQmxvY2tPYmplY3ROYW1lID0gYHRtcC0ke2tleUdlbmVyYXRvcigpfS1pbWFnZWAsIHRlbXBvcmFyeVVybEJsb2NrT2JqZWN0TmFtZSA9IGB0bXAtJHtrZXlHZW5lcmF0b3IoKX0tdXJsYCwgdGVtcG9yYXJ5SW1hZ2VJbmxpbmVPYmplY3ROYW1lID0gYHRtcC0ke2tleUdlbmVyYXRvcigpfS1pbWFnZWAsIHRlbXBvcmFyeVVybElubGluZU9iamVjdE5hbWUgPSBgdG1wLSR7a2V5R2VuZXJhdG9yKCl9LXVybGAsIHRlbXBvcmFyeUJsb2NrT2JqZWN0TmFtZXMgPSB7XG4gIGltYWdlOiB0ZW1wb3JhcnlJbWFnZUJsb2NrT2JqZWN0TmFtZSxcbiAgdXJsOiB0ZW1wb3JhcnlVcmxCbG9ja09iamVjdE5hbWVcbn0sIHRlbXBvcmFyeUlubGluZU9iamVjdE5hbWVzID0ge1xuICBpbWFnZTogdGVtcG9yYXJ5SW1hZ2VJbmxpbmVPYmplY3ROYW1lLFxuICB1cmw6IHRlbXBvcmFyeVVybElubGluZU9iamVjdE5hbWVcbn0sIGJsb2NrT2JqZWN0TmFtZXMgPSB7XG4gIFt0ZW1wb3JhcnlJbWFnZUJsb2NrT2JqZWN0TmFtZV06IFwiaW1hZ2VcIixcbiAgW3RlbXBvcmFyeVVybEJsb2NrT2JqZWN0TmFtZV06IFwidXJsXCJcbn0sIGlubGluZU9iamVjdE5hbWVzID0ge1xuICBbdGVtcG9yYXJ5SW1hZ2VJbmxpbmVPYmplY3ROYW1lXTogXCJpbWFnZVwiLFxuICBbdGVtcG9yYXJ5VXJsSW5saW5lT2JqZWN0TmFtZV06IFwidXJsXCJcbn0sIGRlZmF1bHRPYmplY3RUaXRsZXMgPSB7XG4gIGltYWdlOiBcIkltYWdlXCIsXG4gIHVybDogXCJVUkxcIlxufTtcbmZ1bmN0aW9uIGNvbXBpbGVTY2hlbWFEZWZpbml0aW9uVG9Qb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlcyhkZWZpbml0aW9uKSB7XG4gIGNvbnN0IGJsb2NrT2JqZWN0cyA9IGRlZmluaXRpb24/LmJsb2NrT2JqZWN0cz8ubWFwKFxuICAgIChibG9ja09iamVjdCkgPT4gZGVmaW5lVHlwZSh7XG4gICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgLy8gVmVyeSBuYWl2ZSB3YXkgdG8gd29yayBhcm91bmQgYFNhbml0eVNjaGVtYS5jb21waWxlYCBhZGRpbmcgZGVmYXVsdFxuICAgICAgLy8gZmllbGRzIHRvIG9iamVjdHMgd2l0aCBjZXJ0YWluIG5hbWVzLlxuICAgICAgbmFtZTogdGVtcG9yYXJ5QmxvY2tPYmplY3ROYW1lc1tibG9ja09iamVjdC5uYW1lXSA/PyBibG9ja09iamVjdC5uYW1lLFxuICAgICAgdGl0bGU6IGJsb2NrT2JqZWN0LnRpdGxlID09PSB2b2lkIDAgPyAoXG4gICAgICAgIC8vIFRoaXMgYXZvaWRzIHRoZSBkZWZhdWx0IHRpdGxlIHdoaWNoIGlzIGEgdGl0bGUgY2FzZSBvZiB0aGUgb2JqZWN0IG5hbWVcbiAgICAgICAgZGVmYXVsdE9iamVjdFRpdGxlc1tibG9ja09iamVjdC5uYW1lXVxuICAgICAgKSA6IGJsb2NrT2JqZWN0LnRpdGxlLFxuICAgICAgZmllbGRzOiBibG9ja09iamVjdC5maWVsZHM/Lm1hcCgoZmllbGQpID0+ICh7XG4gICAgICAgIG5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgIHR5cGU6IGZpZWxkLnR5cGUsXG4gICAgICAgIHRpdGxlOiBmaWVsZC50aXRsZSA/PyBzdGFydENhc2UoZmllbGQubmFtZSlcbiAgICAgIH0pKSA/PyBbXVxuICAgIH0pXG4gICkgPz8gW10sIGlubGluZU9iamVjdHMgPSBkZWZpbml0aW9uPy5pbmxpbmVPYmplY3RzPy5tYXAoXG4gICAgKGlubGluZU9iamVjdCkgPT4gZGVmaW5lVHlwZSh7XG4gICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgLy8gVmVyeSBuYWl2ZSB3YXkgdG8gd29yayBhcm91bmQgYFNhbml0eVNjaGVtYS5jb21waWxlYCBhZGRpbmcgZGVmYXVsdFxuICAgICAgLy8gZmllbGRzIHRvIG9iamVjdHMgd2l0aCBjZXJ0YWluIG5hbWVzLlxuICAgICAgbmFtZTogdGVtcG9yYXJ5SW5saW5lT2JqZWN0TmFtZXNbaW5saW5lT2JqZWN0Lm5hbWVdID8/IGlubGluZU9iamVjdC5uYW1lLFxuICAgICAgdGl0bGU6IGlubGluZU9iamVjdC50aXRsZSA9PT0gdm9pZCAwID8gKFxuICAgICAgICAvLyBUaGlzIGF2b2lkcyB0aGUgZGVmYXVsdCB0aXRsZSB3aGljaCBpcyBhIHRpdGxlIGNhc2Ugb2YgdGhlIG9iamVjdCBuYW1lXG4gICAgICAgIGRlZmF1bHRPYmplY3RUaXRsZXNbaW5saW5lT2JqZWN0Lm5hbWVdXG4gICAgICApIDogaW5saW5lT2JqZWN0LnRpdGxlLFxuICAgICAgZmllbGRzOiBpbmxpbmVPYmplY3QuZmllbGRzPy5tYXAoKGZpZWxkKSA9PiAoe1xuICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLFxuICAgICAgICB0eXBlOiBmaWVsZC50eXBlLFxuICAgICAgICB0aXRsZTogZmllbGQudGl0bGUgPz8gc3RhcnRDYXNlKGZpZWxkLm5hbWUpXG4gICAgICB9KSkgPz8gW11cbiAgICB9KVxuICApID8/IFtdLCBwb3J0YWJsZVRleHRTY2hlbWEgPSBkZWZpbmVGaWVsZCh7XG4gICAgdHlwZTogXCJhcnJheVwiLFxuICAgIG5hbWU6IFwicG9ydGFibGUtdGV4dFwiLFxuICAgIG9mOiBbXG4gICAgICAuLi5ibG9ja09iamVjdHMubWFwKChibG9ja09iamVjdCkgPT4gKHsgdHlwZTogYmxvY2tPYmplY3QubmFtZSB9KSksXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFwiYmxvY2tcIixcbiAgICAgICAgbmFtZTogXCJibG9ja1wiLFxuICAgICAgICBvZjogaW5saW5lT2JqZWN0cy5tYXAoKGlubGluZU9iamVjdCkgPT4gKHsgdHlwZTogaW5saW5lT2JqZWN0Lm5hbWUgfSkpLFxuICAgICAgICBtYXJrczoge1xuICAgICAgICAgIGRlY29yYXRvcnM6IGRlZmluaXRpb24/LmRlY29yYXRvcnM/Lm1hcCgoZGVjb3JhdG9yKSA9PiAoe1xuICAgICAgICAgICAgdGl0bGU6IGRlY29yYXRvci50aXRsZSA/PyBzdGFydENhc2UoZGVjb3JhdG9yLm5hbWUpLFxuICAgICAgICAgICAgdmFsdWU6IGRlY29yYXRvci5uYW1lXG4gICAgICAgICAgfSkpID8/IFtdLFxuICAgICAgICAgIGFubm90YXRpb25zOiBkZWZpbml0aW9uPy5hbm5vdGF0aW9ucz8ubWFwKChhbm5vdGF0aW9uKSA9PiAoe1xuICAgICAgICAgICAgbmFtZTogYW5ub3RhdGlvbi5uYW1lLFxuICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgIHRpdGxlOiBhbm5vdGF0aW9uLnRpdGxlLFxuICAgICAgICAgICAgZmllbGRzOiBhbm5vdGF0aW9uLmZpZWxkcz8ubWFwKChmaWVsZCkgPT4gKHtcbiAgICAgICAgICAgICAgbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAgICAgICAgdGl0bGU6IGZpZWxkLnRpdGxlID8/IHN0YXJ0Q2FzZShmaWVsZC5uYW1lKSxcbiAgICAgICAgICAgICAgdHlwZTogZmllbGQudHlwZVxuICAgICAgICAgICAgfSkpID8/IFtdXG4gICAgICAgICAgfSkpID8/IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGxpc3RzOiBkZWZpbml0aW9uPy5saXN0cz8ubWFwKChsaXN0KSA9PiAoe1xuICAgICAgICAgIHZhbHVlOiBsaXN0Lm5hbWUsXG4gICAgICAgICAgdGl0bGU6IGxpc3QudGl0bGUgPz8gc3RhcnRDYXNlKGxpc3QubmFtZSlcbiAgICAgICAgfSkpID8/IFtdLFxuICAgICAgICBzdHlsZXM6IGRlZmluaXRpb24/LnN0eWxlcz8ubWFwKChzdHlsZSkgPT4gKHtcbiAgICAgICAgICB2YWx1ZTogc3R5bGUubmFtZSxcbiAgICAgICAgICB0aXRsZTogc3R5bGUudGl0bGUgPz8gc3RhcnRDYXNlKHN0eWxlLm5hbWUpXG4gICAgICAgIH0pKSA/PyBbXVxuICAgICAgfVxuICAgIF1cbiAgfSksIHNjaGVtYSA9IFNjaGVtYS5jb21waWxlKHtcbiAgICB0eXBlczogW3BvcnRhYmxlVGV4dFNjaGVtYSwgLi4uYmxvY2tPYmplY3RzLCAuLi5pbmxpbmVPYmplY3RzXVxuICB9KS5nZXQoXCJwb3J0YWJsZS10ZXh0XCIpLCBwdGVTY2hlbWEgPSBjcmVhdGVQb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlcyhzY2hlbWEpO1xuICByZXR1cm4ge1xuICAgIC4uLnB0ZVNjaGVtYSxcbiAgICBwb3J0YWJsZVRleHQ6IHtcbiAgICAgIC4uLnB0ZVNjaGVtYS5wb3J0YWJsZVRleHQsXG4gICAgICBvZjogcHRlU2NoZW1hLnBvcnRhYmxlVGV4dC5vZi5tYXAoKHNjaGVtYVR5cGUpID0+IHtcbiAgICAgICAgaWYgKCFpc09iamVjdFNjaGVtYVR5cGUoc2NoZW1hVHlwZSkpXG4gICAgICAgICAgcmV0dXJuIHNjaGVtYVR5cGU7XG4gICAgICAgIGNvbnN0IG5hbWVNYXBwaW5nID0gYmxvY2tPYmplY3ROYW1lc1tzY2hlbWFUeXBlLm5hbWVdO1xuICAgICAgICBzY2hlbWFUeXBlLm5hbWUgPSBuYW1lTWFwcGluZyA/PyBzY2hlbWFUeXBlLm5hbWU7XG4gICAgICAgIGZvciAoY29uc3QgZmllbGQgb2Ygc2NoZW1hVHlwZS5maWVsZHMpXG4gICAgICAgICAgaWYgKCEoZmllbGQubmFtZSAhPT0gXCJjaGlsZHJlblwiIHx8ICFpc0FycmF5U2NoZW1hVHlwZShmaWVsZC50eXBlKSkpXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG9mU2NoZW1hVHlwZSBvZiBmaWVsZC50eXBlLm9mKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG5hbWVNYXBwaW5nMiA9IGlubGluZU9iamVjdE5hbWVzW29mU2NoZW1hVHlwZS5uYW1lXTtcbiAgICAgICAgICAgICAgbmFtZU1hcHBpbmcyICYmIChvZlNjaGVtYVR5cGUubmFtZSA9IG5hbWVNYXBwaW5nMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIHJldHVybiBzY2hlbWFUeXBlO1xuICAgICAgfSlcbiAgICB9LFxuICAgIGJsb2NrT2JqZWN0czogcHRlU2NoZW1hLmJsb2NrT2JqZWN0cy5tYXAoXG4gICAgICAoYmxvY2tPYmplY3QpID0+IGJsb2NrT2JqZWN0TmFtZXNbYmxvY2tPYmplY3QubmFtZV0gIT09IHZvaWQgMCA/IHtcbiAgICAgICAgLi4uYmxvY2tPYmplY3QsXG4gICAgICAgIG5hbWU6IGJsb2NrT2JqZWN0TmFtZXNbYmxvY2tPYmplY3QubmFtZV0sXG4gICAgICAgIHR5cGU6IHtcbiAgICAgICAgICAuLi5ibG9ja09iamVjdC50eXBlLFxuICAgICAgICAgIG5hbWU6IGJsb2NrT2JqZWN0TmFtZXNbYmxvY2tPYmplY3QubmFtZV1cbiAgICAgICAgfVxuICAgICAgfSA6IGJsb2NrT2JqZWN0XG4gICAgKSxcbiAgICBpbmxpbmVPYmplY3RzOiBwdGVTY2hlbWEuaW5saW5lT2JqZWN0cy5tYXAoXG4gICAgICAoaW5saW5lT2JqZWN0KSA9PiBpbmxpbmVPYmplY3ROYW1lc1tpbmxpbmVPYmplY3QubmFtZV0gIT09IHZvaWQgMCA/IHtcbiAgICAgICAgLi4uaW5saW5lT2JqZWN0LFxuICAgICAgICBuYW1lOiBpbmxpbmVPYmplY3ROYW1lc1tpbmxpbmVPYmplY3QubmFtZV1cbiAgICAgIH0gOiBpbmxpbmVPYmplY3RcbiAgICApXG4gIH07XG59XG5leHBvcnQge1xuICBjb21waWxlU2NoZW1hRGVmaW5pdGlvblRvUG9ydGFibGVUZXh0TWVtYmVyU2NoZW1hVHlwZXMsXG4gIGNyZWF0ZVBvcnRhYmxlVGV4dE1lbWJlclNjaGVtYVR5cGVzLFxuICBwb3J0YWJsZVRleHRNZW1iZXJTY2hlbWFUeXBlc1RvU2NoZW1hLFxuICBzYW5pdHlTY2hlbWFUb1BvcnRhYmxlVGV4dFNjaGVtYVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/sanity-bridge/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/schema/dist/index.js":
/*!*********************************************************!*\
  !*** ./node_modules/@portabletext/schema/dist/index.js ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   compileSchema: () => (/* binding */ compileSchema),\n/* harmony export */   defineSchema: () => (/* binding */ defineSchema),\n/* harmony export */   isSpan: () => (/* binding */ isSpan),\n/* harmony export */   isTextBlock: () => (/* binding */ isTextBlock),\n/* harmony export */   isTypedObject: () => (/* binding */ isTypedObject)\n/* harmony export */ });\nfunction compileSchema(definition) {\n  const styles = (definition.styles ?? []).map((style) => ({\n    ...style,\n    value: style.name\n  })), blockFields = [];\n  if (definition.block?.fields)\n    for (const field of definition.block.fields) {\n      if (field.name === \"_type\" || field.name === \"_key\" || field.name === \"children\" || field.name === \"markDefs\" || field.name === \"style\" || field.name === \"listItem\" || field.name === \"level\") {\n        console.warn(\n          `\"${field.name}\" is a reserved field name on Portable Text blocks`\n        );\n        continue;\n      }\n      blockFields.push(field);\n    }\n  return {\n    block: {\n      name: definition.block?.name ?? \"block\",\n      ...blockFields.length > 0 ? { fields: blockFields } : {}\n    },\n    span: {\n      name: \"span\"\n    },\n    styles: styles.some((style) => style.value === \"normal\") ? styles : [{ value: \"normal\", name: \"normal\", title: \"Normal\" }, ...styles],\n    lists: (definition.lists ?? []).map((list) => ({\n      ...list,\n      value: list.name\n    })),\n    decorators: (definition.decorators ?? []).map((decorator) => ({\n      ...decorator,\n      value: decorator.name\n    })),\n    annotations: (definition.annotations ?? []).map((annotation) => ({\n      ...annotation,\n      fields: annotation.fields ?? []\n    })),\n    blockObjects: (definition.blockObjects ?? []).map((blockObject) => ({\n      ...blockObject,\n      fields: blockObject.fields ?? []\n    })),\n    inlineObjects: (definition.inlineObjects ?? []).map((inlineObject) => ({\n      ...inlineObject,\n      fields: inlineObject.fields ?? []\n    }))\n  };\n}\nfunction defineSchema(definition) {\n  return definition;\n}\nfunction isTypedObject(object) {\n  return isRecord(object) && typeof object._type == \"string\";\n}\nfunction isRecord(value) {\n  return !!value && (typeof value == \"object\" || typeof value == \"function\");\n}\nfunction isTextBlock(context, block) {\n  return !(!isTypedObject(block) || block._type !== context.schema.block.name || !Array.isArray(block.children));\n}\nfunction isSpan(context, child) {\n  return !(!isTypedObject(child) || child._type !== context.schema.span.name || typeof child.text != \"string\");\n}\n\n//# sourceMappingURL=index.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC9zY2hlbWEvZGlzdC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxXQUFXO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0Msc0JBQXNCO0FBQzFELEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMLDJFQUEyRSxrREFBa0Q7QUFDN0g7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBT0U7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NyaXNwLWNsZWFuaW5nLy4vbm9kZV9tb2R1bGVzL0Bwb3J0YWJsZXRleHQvc2NoZW1hL2Rpc3QvaW5kZXguanM/NGJmYiJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBjb21waWxlU2NoZW1hKGRlZmluaXRpb24pIHtcbiAgY29uc3Qgc3R5bGVzID0gKGRlZmluaXRpb24uc3R5bGVzID8/IFtdKS5tYXAoKHN0eWxlKSA9PiAoe1xuICAgIC4uLnN0eWxlLFxuICAgIHZhbHVlOiBzdHlsZS5uYW1lXG4gIH0pKSwgYmxvY2tGaWVsZHMgPSBbXTtcbiAgaWYgKGRlZmluaXRpb24uYmxvY2s/LmZpZWxkcylcbiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGRlZmluaXRpb24uYmxvY2suZmllbGRzKSB7XG4gICAgICBpZiAoZmllbGQubmFtZSA9PT0gXCJfdHlwZVwiIHx8IGZpZWxkLm5hbWUgPT09IFwiX2tleVwiIHx8IGZpZWxkLm5hbWUgPT09IFwiY2hpbGRyZW5cIiB8fCBmaWVsZC5uYW1lID09PSBcIm1hcmtEZWZzXCIgfHwgZmllbGQubmFtZSA9PT0gXCJzdHlsZVwiIHx8IGZpZWxkLm5hbWUgPT09IFwibGlzdEl0ZW1cIiB8fCBmaWVsZC5uYW1lID09PSBcImxldmVsXCIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIGBcIiR7ZmllbGQubmFtZX1cIiBpcyBhIHJlc2VydmVkIGZpZWxkIG5hbWUgb24gUG9ydGFibGUgVGV4dCBibG9ja3NgXG4gICAgICAgICk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgYmxvY2tGaWVsZHMucHVzaChmaWVsZCk7XG4gICAgfVxuICByZXR1cm4ge1xuICAgIGJsb2NrOiB7XG4gICAgICBuYW1lOiBkZWZpbml0aW9uLmJsb2NrPy5uYW1lID8/IFwiYmxvY2tcIixcbiAgICAgIC4uLmJsb2NrRmllbGRzLmxlbmd0aCA+IDAgPyB7IGZpZWxkczogYmxvY2tGaWVsZHMgfSA6IHt9XG4gICAgfSxcbiAgICBzcGFuOiB7XG4gICAgICBuYW1lOiBcInNwYW5cIlxuICAgIH0sXG4gICAgc3R5bGVzOiBzdHlsZXMuc29tZSgoc3R5bGUpID0+IHN0eWxlLnZhbHVlID09PSBcIm5vcm1hbFwiKSA/IHN0eWxlcyA6IFt7IHZhbHVlOiBcIm5vcm1hbFwiLCBuYW1lOiBcIm5vcm1hbFwiLCB0aXRsZTogXCJOb3JtYWxcIiB9LCAuLi5zdHlsZXNdLFxuICAgIGxpc3RzOiAoZGVmaW5pdGlvbi5saXN0cyA/PyBbXSkubWFwKChsaXN0KSA9PiAoe1xuICAgICAgLi4ubGlzdCxcbiAgICAgIHZhbHVlOiBsaXN0Lm5hbWVcbiAgICB9KSksXG4gICAgZGVjb3JhdG9yczogKGRlZmluaXRpb24uZGVjb3JhdG9ycyA/PyBbXSkubWFwKChkZWNvcmF0b3IpID0+ICh7XG4gICAgICAuLi5kZWNvcmF0b3IsXG4gICAgICB2YWx1ZTogZGVjb3JhdG9yLm5hbWVcbiAgICB9KSksXG4gICAgYW5ub3RhdGlvbnM6IChkZWZpbml0aW9uLmFubm90YXRpb25zID8/IFtdKS5tYXAoKGFubm90YXRpb24pID0+ICh7XG4gICAgICAuLi5hbm5vdGF0aW9uLFxuICAgICAgZmllbGRzOiBhbm5vdGF0aW9uLmZpZWxkcyA/PyBbXVxuICAgIH0pKSxcbiAgICBibG9ja09iamVjdHM6IChkZWZpbml0aW9uLmJsb2NrT2JqZWN0cyA/PyBbXSkubWFwKChibG9ja09iamVjdCkgPT4gKHtcbiAgICAgIC4uLmJsb2NrT2JqZWN0LFxuICAgICAgZmllbGRzOiBibG9ja09iamVjdC5maWVsZHMgPz8gW11cbiAgICB9KSksXG4gICAgaW5saW5lT2JqZWN0czogKGRlZmluaXRpb24uaW5saW5lT2JqZWN0cyA/PyBbXSkubWFwKChpbmxpbmVPYmplY3QpID0+ICh7XG4gICAgICAuLi5pbmxpbmVPYmplY3QsXG4gICAgICBmaWVsZHM6IGlubGluZU9iamVjdC5maWVsZHMgPz8gW11cbiAgICB9KSlcbiAgfTtcbn1cbmZ1bmN0aW9uIGRlZmluZVNjaGVtYShkZWZpbml0aW9uKSB7XG4gIHJldHVybiBkZWZpbml0aW9uO1xufVxuZnVuY3Rpb24gaXNUeXBlZE9iamVjdChvYmplY3QpIHtcbiAgcmV0dXJuIGlzUmVjb3JkKG9iamVjdCkgJiYgdHlwZW9mIG9iamVjdC5fdHlwZSA9PSBcInN0cmluZ1wiO1xufVxuZnVuY3Rpb24gaXNSZWNvcmQodmFsdWUpIHtcbiAgcmV0dXJuICEhdmFsdWUgJiYgKHR5cGVvZiB2YWx1ZSA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiB2YWx1ZSA9PSBcImZ1bmN0aW9uXCIpO1xufVxuZnVuY3Rpb24gaXNUZXh0QmxvY2soY29udGV4dCwgYmxvY2spIHtcbiAgcmV0dXJuICEoIWlzVHlwZWRPYmplY3QoYmxvY2spIHx8IGJsb2NrLl90eXBlICE9PSBjb250ZXh0LnNjaGVtYS5ibG9jay5uYW1lIHx8ICFBcnJheS5pc0FycmF5KGJsb2NrLmNoaWxkcmVuKSk7XG59XG5mdW5jdGlvbiBpc1NwYW4oY29udGV4dCwgY2hpbGQpIHtcbiAgcmV0dXJuICEoIWlzVHlwZWRPYmplY3QoY2hpbGQpIHx8IGNoaWxkLl90eXBlICE9PSBjb250ZXh0LnNjaGVtYS5zcGFuLm5hbWUgfHwgdHlwZW9mIGNoaWxkLnRleHQgIT0gXCJzdHJpbmdcIik7XG59XG5leHBvcnQge1xuICBjb21waWxlU2NoZW1hLFxuICBkZWZpbmVTY2hlbWEsXG4gIGlzU3BhbixcbiAgaXNUZXh0QmxvY2ssXG4gIGlzVHlwZWRPYmplY3Rcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/schema/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/to-html/dist/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/@portabletext/to-html/dist/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   defaultComponents: () => (/* binding */ defaultComponents),\n/* harmony export */   escapeHTML: () => (/* binding */ escapeHTML),\n/* harmony export */   mergeComponents: () => (/* binding */ mergeComponents),\n/* harmony export */   toHTML: () => (/* binding */ toHTML),\n/* harmony export */   uriLooksSafe: () => (/* binding */ uriLooksSafe)\n/* harmony export */ });\n/* harmony import */ var _portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @portabletext/toolkit */ \"(ssr)/./node_modules/@portabletext/toolkit/dist/index.js\");\n\nconst allowedProtocols = [\n\t\"http\",\n\t\"https\",\n\t\"mailto\",\n\t\"tel\"\n], charMap = {\n\t\"&\": \"amp\",\n\t\"<\": \"lt\",\n\t\">\": \"gt\",\n\t\"\\\"\": \"quot\",\n\t\"'\": \"#x27\"\n};\nfunction escapeHTML(str) {\n\treturn replaceMultipleSpaces(str.replace(/[&<>\"']/g, (s) => `&${charMap[s]};`));\n}\nfunction replaceMultipleSpaces(str) {\n\treturn str.replace(/ {2,}/g, (match) => `${\"&nbsp;\".repeat(match.length - 1)} `);\n}\nfunction uriLooksSafe(uri) {\n\tlet url = (uri || \"\").trim(), first = url.charAt(0);\n\tif (first === \"#\" || first === \"/\") return !0;\n\tlet colonIndex = url.indexOf(\":\");\n\tif (colonIndex === -1) return !0;\n\tlet proto = url.slice(0, colonIndex).toLowerCase();\n\tif (allowedProtocols.indexOf(proto) !== -1) return !0;\n\tlet queryIndex = url.indexOf(\"?\");\n\tif (queryIndex !== -1 && colonIndex > queryIndex) return !0;\n\tlet hashIndex = url.indexOf(\"#\");\n\treturn hashIndex !== -1 && colonIndex > hashIndex;\n}\nconst defaultLists = {\n\tnumber: ({ children }) => `<ol>${children}</ol>`,\n\tbullet: ({ children }) => `<ul>${children}</ul>`\n}, DefaultListItem = ({ children }) => `<li>${children}</li>`, link = ({ children, value }) => {\n\tlet href = value?.href || \"\";\n\treturn uriLooksSafe(href) ? `<a href=\"${escapeHTML(href)}\">${children}</a>` : children;\n}, defaultMarks = {\n\tem: ({ children }) => `<em>${children}</em>`,\n\tstrong: ({ children }) => `<strong>${children}</strong>`,\n\tcode: ({ children }) => `<code>${children}</code>`,\n\tunderline: ({ children }) => `<span style=\"text-decoration:underline\">${children}</span>`,\n\t\"strike-through\": ({ children }) => `<del>${children}</del>`,\n\tlink\n}, getTemplate = (type, prop) => `Unknown ${type}, specify a component for it in the \\`components.${prop}\\` option`, unknownTypeWarning = (typeName) => getTemplate(`block type \"${typeName}\"`, \"types\"), unknownMarkWarning = (markType) => getTemplate(`mark type \"${markType}\"`, \"marks\"), unknownBlockStyleWarning = (blockStyle) => getTemplate(`block style \"${blockStyle}\"`, \"block\"), unknownListStyleWarning = (listStyle) => getTemplate(`list style \"${listStyle}\"`, \"list\"), unknownListItemStyleWarning = (listStyle) => getTemplate(`list item style \"${listStyle}\"`, \"listItem\");\nfunction printWarning(message) {\n\tconsole.warn(message);\n}\nconst defaultComponents = {\n\ttypes: {},\n\tblock: {\n\t\tnormal: ({ children }) => `<p>${children}</p>`,\n\t\tblockquote: ({ children }) => `<blockquote>${children}</blockquote>`,\n\t\th1: ({ children }) => `<h1>${children}</h1>`,\n\t\th2: ({ children }) => `<h2>${children}</h2>`,\n\t\th3: ({ children }) => `<h3>${children}</h3>`,\n\t\th4: ({ children }) => `<h4>${children}</h4>`,\n\t\th5: ({ children }) => `<h5>${children}</h5>`,\n\t\th6: ({ children }) => `<h6>${children}</h6>`\n\t},\n\tmarks: defaultMarks,\n\tlist: defaultLists,\n\tlistItem: DefaultListItem,\n\thardBreak: () => \"<br/>\",\n\tescapeHTML,\n\tunknownType: ({ value, isInline }) => {\n\t\tlet warning = unknownTypeWarning(value._type);\n\t\treturn isInline ? `<span style=\"display:none\">${warning}</span>` : `<div style=\"display:none\">${warning}</div>`;\n\t},\n\tunknownMark: ({ markType, children }) => `<span class=\"unknown__pt__mark__${markType}\">${children}</span>`,\n\tunknownList: ({ children }) => `<ul>${children}</ul>`,\n\tunknownListItem: ({ children }) => `<li>${children}</li>`,\n\tunknownBlockStyle: ({ children }) => `<p>${children}</p>`\n};\nfunction mergeComponents(parent, overrides) {\n\tlet { block, list, listItem, marks, types, ...rest } = overrides;\n\treturn {\n\t\t...parent,\n\t\tblock: mergeDeeply(parent, overrides, \"block\"),\n\t\tlist: mergeDeeply(parent, overrides, \"list\"),\n\t\tlistItem: mergeDeeply(parent, overrides, \"listItem\"),\n\t\tmarks: mergeDeeply(parent, overrides, \"marks\"),\n\t\ttypes: mergeDeeply(parent, overrides, \"types\"),\n\t\t...rest\n\t};\n}\nfunction mergeDeeply(parent, overrides, key) {\n\tlet override = overrides[key], parentVal = parent[key];\n\treturn typeof override == \"function\" ? override : override ? typeof parentVal == \"function\" ? override : {\n\t\t...parentVal,\n\t\t...override\n\t} : parentVal;\n}\nfunction toHTML(value, options = {}) {\n\tlet { components: componentOverrides, onMissingComponent: missingComponentHandler = printWarning } = options, handleMissingComponent = missingComponentHandler || noop, nested = (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.nestLists)(Array.isArray(value) ? value : [value], \"html\"), renderNode = getNodeRenderer(componentOverrides ? mergeComponents(defaultComponents, componentOverrides) : defaultComponents, handleMissingComponent);\n\treturn nested.map((node, index) => renderNode({\n\t\tnode,\n\t\tindex,\n\t\tisInline: !1,\n\t\trenderNode\n\t})).join(\"\");\n}\nconst getNodeRenderer = (components, handleMissingComponent) => {\n\tfunction renderNode(options) {\n\t\tlet { node, index, isInline } = options;\n\t\treturn (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.isPortableTextToolkitList)(node) ? renderList(node, index) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.isPortableTextListItemBlock)(node) ? renderListItem(node, index) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.isPortableTextToolkitSpan)(node) ? renderSpan(node) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.isPortableTextBlock)(node) ? renderBlock(node, index, isInline) : (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.isPortableTextToolkitTextNode)(node) ? renderText(node) : renderCustomBlock(node, index, isInline);\n\t}\n\tfunction renderListItem(node, index) {\n\t\tlet tree = serializeBlock({\n\t\t\tnode,\n\t\t\tindex,\n\t\t\tisInline: !1,\n\t\t\trenderNode\n\t\t}), renderer = components.listItem, itemHandler = (typeof renderer == \"function\" ? renderer : renderer[node.listItem]) || components.unknownListItem;\n\t\tif (itemHandler === components.unknownListItem) {\n\t\t\tlet style = node.listItem || \"bullet\";\n\t\t\thandleMissingComponent(unknownListItemStyleWarning(style), {\n\t\t\t\ttype: style,\n\t\t\t\tnodeType: \"listItemStyle\"\n\t\t\t});\n\t\t}\n\t\tlet children = tree.children;\n\t\tif (node.style && node.style !== \"normal\") {\n\t\t\tlet { listItem, ...blockNode } = node;\n\t\t\tchildren = renderNode({\n\t\t\t\tnode: blockNode,\n\t\t\t\tindex,\n\t\t\t\tisInline: !1,\n\t\t\t\trenderNode\n\t\t\t});\n\t\t}\n\t\treturn itemHandler({\n\t\t\tvalue: node,\n\t\t\tindex,\n\t\t\tisInline: !1,\n\t\t\trenderNode,\n\t\t\tchildren\n\t\t});\n\t}\n\tfunction renderList(node, index) {\n\t\tlet children = node.children.map((child, childIndex) => renderNode({\n\t\t\tnode: child._key ? child : {\n\t\t\t\t...child,\n\t\t\t\t_key: `li-${index}-${childIndex}`\n\t\t\t},\n\t\t\tindex: childIndex,\n\t\t\tisInline: !1,\n\t\t\trenderNode\n\t\t})), component = components.list, list = (typeof component == \"function\" ? component : component[node.listItem]) || components.unknownList;\n\t\tif (list === components.unknownList) {\n\t\t\tlet style = node.listItem || \"bullet\";\n\t\t\thandleMissingComponent(unknownListStyleWarning(style), {\n\t\t\t\tnodeType: \"listStyle\",\n\t\t\t\ttype: style\n\t\t\t});\n\t\t}\n\t\treturn list({\n\t\t\tvalue: node,\n\t\t\tindex,\n\t\t\tisInline: !1,\n\t\t\trenderNode,\n\t\t\tchildren: children.join(\"\")\n\t\t});\n\t}\n\tfunction renderSpan(node) {\n\t\tlet { markDef, markType, markKey } = node, span = components.marks[markType] || components.unknownMark, children = node.children.map((child, childIndex) => renderNode({\n\t\t\tnode: child,\n\t\t\tindex: childIndex,\n\t\t\tisInline: !0,\n\t\t\trenderNode\n\t\t}));\n\t\treturn span === components.unknownMark && handleMissingComponent(unknownMarkWarning(markType), {\n\t\t\tnodeType: \"mark\",\n\t\t\ttype: markType\n\t\t}), span({\n\t\t\ttext: (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.spanToPlainText)(node),\n\t\t\tvalue: markDef,\n\t\t\tmarkType,\n\t\t\tmarkKey,\n\t\t\trenderNode,\n\t\t\tchildren: children.join(\"\")\n\t\t});\n\t}\n\tfunction renderBlock(node, index, isInline) {\n\t\tlet { _key, ...props } = serializeBlock({\n\t\t\tnode,\n\t\t\tindex,\n\t\t\tisInline,\n\t\t\trenderNode\n\t\t}), style = props.node.style || \"normal\", block = (typeof components.block == \"function\" ? components.block : components.block[style]) || components.unknownBlockStyle;\n\t\treturn block === components.unknownBlockStyle && handleMissingComponent(unknownBlockStyleWarning(style), {\n\t\t\tnodeType: \"blockStyle\",\n\t\t\ttype: style\n\t\t}), block({\n\t\t\t...props,\n\t\t\tvalue: props.node,\n\t\t\trenderNode\n\t\t});\n\t}\n\tfunction renderText(node) {\n\t\tif (node.text === \"\\n\") {\n\t\t\tlet hardBreak = components.hardBreak;\n\t\t\treturn hardBreak ? hardBreak() : \"\\n\";\n\t\t}\n\t\treturn components.escapeHTML(node.text);\n\t}\n\tfunction renderCustomBlock(value, index, isInline) {\n\t\tlet node = components.types[value._type];\n\t\treturn node || handleMissingComponent(unknownTypeWarning(value._type), {\n\t\t\tnodeType: \"block\",\n\t\t\ttype: value._type\n\t\t}), (node || components.unknownType)({\n\t\t\tvalue,\n\t\t\tisInline,\n\t\t\tindex,\n\t\t\trenderNode\n\t\t});\n\t}\n\treturn renderNode;\n};\nfunction serializeBlock(options) {\n\tlet { node, index, isInline, renderNode } = options, children = (0,_portabletext_toolkit__WEBPACK_IMPORTED_MODULE_0__.buildMarksTree)(node).map((child, i) => renderNode({\n\t\tnode: child,\n\t\tisInline: !0,\n\t\tindex: i,\n\t\trenderNode\n\t}));\n\treturn {\n\t\t_key: node._key || `block-${index}`,\n\t\tchildren: children.join(\"\"),\n\t\tindex,\n\t\tisInline,\n\t\tnode\n\t};\n}\nfunction noop() {}\n\n\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC90by1odG1sL2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTBOO0FBQzFOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLFlBQVk7QUFDN0U7QUFDQTtBQUNBLHVCQUF1QixHQUFHLGtCQUFrQixPQUFPLDRCQUE0QjtBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxVQUFVLFlBQVksU0FBUztBQUMzQyxZQUFZLFVBQVUsWUFBWSxTQUFTO0FBQzNDLENBQUMsdUJBQXVCLFVBQVUsWUFBWSxTQUFTLGtCQUFrQixpQkFBaUI7QUFDMUY7QUFDQSx5Q0FBeUMsaUJBQWlCLElBQUksU0FBUztBQUN2RSxDQUFDO0FBQ0QsUUFBUSxVQUFVLFlBQVksU0FBUztBQUN2QyxZQUFZLFVBQVUsZ0JBQWdCLFNBQVM7QUFDL0MsVUFBVSxVQUFVLGNBQWMsU0FBUztBQUMzQyxlQUFlLFVBQVUsZ0RBQWdELFNBQVM7QUFDbEYsc0JBQXNCLFVBQVUsYUFBYSxTQUFTO0FBQ3REO0FBQ0EsQ0FBQywyQ0FBMkMsS0FBSyxtREFBbUQsS0FBSywwRUFBMEUsU0FBUywyRUFBMkUsU0FBUyxxRkFBcUYsV0FBVyxrRkFBa0YsVUFBVSwwRkFBMEYsVUFBVTtBQUNoakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxhQUFhLFVBQVUsV0FBVyxTQUFTO0FBQzNDLGlCQUFpQixVQUFVLG9CQUFvQixTQUFTO0FBQ3hELFNBQVMsVUFBVSxZQUFZLFNBQVM7QUFDeEMsU0FBUyxVQUFVLFlBQVksU0FBUztBQUN4QyxTQUFTLFVBQVUsWUFBWSxTQUFTO0FBQ3hDLFNBQVMsVUFBVSxZQUFZLFNBQVM7QUFDeEMsU0FBUyxVQUFVLFlBQVksU0FBUztBQUN4QyxTQUFTLFVBQVUsWUFBWSxTQUFTO0FBQ3hDLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLGlCQUFpQjtBQUNsQztBQUNBLGtEQUFrRCxRQUFRLHdDQUF3QyxRQUFRO0FBQzFHLEVBQUU7QUFDRixpQkFBaUIsb0JBQW9CLHdDQUF3QyxTQUFTLElBQUksU0FBUztBQUNuRyxpQkFBaUIsVUFBVSxZQUFZLFNBQVM7QUFDaEQscUJBQXFCLFVBQVUsWUFBWSxTQUFTO0FBQ3BELHVCQUF1QixVQUFVLFdBQVcsU0FBUztBQUNyRDtBQUNBO0FBQ0EsT0FBTywrQ0FBK0M7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsbUNBQW1DO0FBQ25DLE9BQU8sNkZBQTZGLDhFQUE4RSxnRUFBUztBQUMzTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBLFFBQVEsd0JBQXdCO0FBQ2hDLFNBQVMsZ0ZBQXlCLG1DQUFtQyxrRkFBMkIsdUNBQXVDLGdGQUF5Qiw0QkFBNEIsMEVBQW1CLDhDQUE4QyxvRkFBNkI7QUFDMVI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxTQUFTLHlCQUF5QjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTSxHQUFHLFdBQVc7QUFDcEMsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxRQUFRLDZCQUE2QjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsU0FBUyxzRUFBZTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxRQUFRLGlCQUFpQjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxvQ0FBb0Msc0JBQXNCLHFFQUFjO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0EsOEJBQThCLE1BQU07QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZ0Y7O0FBRWhGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3Jpc3AtY2xlYW5pbmcvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC90by1odG1sL2Rpc3QvaW5kZXguanM/ZjM1MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBidWlsZE1hcmtzVHJlZSwgaXNQb3J0YWJsZVRleHRCbG9jaywgaXNQb3J0YWJsZVRleHRMaXN0SXRlbUJsb2NrLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRMaXN0LCBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRUZXh0Tm9kZSwgbmVzdExpc3RzLCBzcGFuVG9QbGFpblRleHQgfSBmcm9tIFwiQHBvcnRhYmxldGV4dC90b29sa2l0XCI7XG5jb25zdCBhbGxvd2VkUHJvdG9jb2xzID0gW1xuXHRcImh0dHBcIixcblx0XCJodHRwc1wiLFxuXHRcIm1haWx0b1wiLFxuXHRcInRlbFwiXG5dLCBjaGFyTWFwID0ge1xuXHRcIiZcIjogXCJhbXBcIixcblx0XCI8XCI6IFwibHRcIixcblx0XCI+XCI6IFwiZ3RcIixcblx0XCJcXFwiXCI6IFwicXVvdFwiLFxuXHRcIidcIjogXCIjeDI3XCJcbn07XG5mdW5jdGlvbiBlc2NhcGVIVE1MKHN0cikge1xuXHRyZXR1cm4gcmVwbGFjZU11bHRpcGxlU3BhY2VzKHN0ci5yZXBsYWNlKC9bJjw+XCInXS9nLCAocykgPT4gYCYke2NoYXJNYXBbc119O2ApKTtcbn1cbmZ1bmN0aW9uIHJlcGxhY2VNdWx0aXBsZVNwYWNlcyhzdHIpIHtcblx0cmV0dXJuIHN0ci5yZXBsYWNlKC8gezIsfS9nLCAobWF0Y2gpID0+IGAke1wiJm5ic3A7XCIucmVwZWF0KG1hdGNoLmxlbmd0aCAtIDEpfSBgKTtcbn1cbmZ1bmN0aW9uIHVyaUxvb2tzU2FmZSh1cmkpIHtcblx0bGV0IHVybCA9ICh1cmkgfHwgXCJcIikudHJpbSgpLCBmaXJzdCA9IHVybC5jaGFyQXQoMCk7XG5cdGlmIChmaXJzdCA9PT0gXCIjXCIgfHwgZmlyc3QgPT09IFwiL1wiKSByZXR1cm4gITA7XG5cdGxldCBjb2xvbkluZGV4ID0gdXJsLmluZGV4T2YoXCI6XCIpO1xuXHRpZiAoY29sb25JbmRleCA9PT0gLTEpIHJldHVybiAhMDtcblx0bGV0IHByb3RvID0gdXJsLnNsaWNlKDAsIGNvbG9uSW5kZXgpLnRvTG93ZXJDYXNlKCk7XG5cdGlmIChhbGxvd2VkUHJvdG9jb2xzLmluZGV4T2YocHJvdG8pICE9PSAtMSkgcmV0dXJuICEwO1xuXHRsZXQgcXVlcnlJbmRleCA9IHVybC5pbmRleE9mKFwiP1wiKTtcblx0aWYgKHF1ZXJ5SW5kZXggIT09IC0xICYmIGNvbG9uSW5kZXggPiBxdWVyeUluZGV4KSByZXR1cm4gITA7XG5cdGxldCBoYXNoSW5kZXggPSB1cmwuaW5kZXhPZihcIiNcIik7XG5cdHJldHVybiBoYXNoSW5kZXggIT09IC0xICYmIGNvbG9uSW5kZXggPiBoYXNoSW5kZXg7XG59XG5jb25zdCBkZWZhdWx0TGlzdHMgPSB7XG5cdG51bWJlcjogKHsgY2hpbGRyZW4gfSkgPT4gYDxvbD4ke2NoaWxkcmVufTwvb2w+YCxcblx0YnVsbGV0OiAoeyBjaGlsZHJlbiB9KSA9PiBgPHVsPiR7Y2hpbGRyZW59PC91bD5gXG59LCBEZWZhdWx0TGlzdEl0ZW0gPSAoeyBjaGlsZHJlbiB9KSA9PiBgPGxpPiR7Y2hpbGRyZW59PC9saT5gLCBsaW5rID0gKHsgY2hpbGRyZW4sIHZhbHVlIH0pID0+IHtcblx0bGV0IGhyZWYgPSB2YWx1ZT8uaHJlZiB8fCBcIlwiO1xuXHRyZXR1cm4gdXJpTG9va3NTYWZlKGhyZWYpID8gYDxhIGhyZWY9XCIke2VzY2FwZUhUTUwoaHJlZil9XCI+JHtjaGlsZHJlbn08L2E+YCA6IGNoaWxkcmVuO1xufSwgZGVmYXVsdE1hcmtzID0ge1xuXHRlbTogKHsgY2hpbGRyZW4gfSkgPT4gYDxlbT4ke2NoaWxkcmVufTwvZW0+YCxcblx0c3Ryb25nOiAoeyBjaGlsZHJlbiB9KSA9PiBgPHN0cm9uZz4ke2NoaWxkcmVufTwvc3Ryb25nPmAsXG5cdGNvZGU6ICh7IGNoaWxkcmVuIH0pID0+IGA8Y29kZT4ke2NoaWxkcmVufTwvY29kZT5gLFxuXHR1bmRlcmxpbmU6ICh7IGNoaWxkcmVuIH0pID0+IGA8c3BhbiBzdHlsZT1cInRleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmVcIj4ke2NoaWxkcmVufTwvc3Bhbj5gLFxuXHRcInN0cmlrZS10aHJvdWdoXCI6ICh7IGNoaWxkcmVuIH0pID0+IGA8ZGVsPiR7Y2hpbGRyZW59PC9kZWw+YCxcblx0bGlua1xufSwgZ2V0VGVtcGxhdGUgPSAodHlwZSwgcHJvcCkgPT4gYFVua25vd24gJHt0eXBlfSwgc3BlY2lmeSBhIGNvbXBvbmVudCBmb3IgaXQgaW4gdGhlIFxcYGNvbXBvbmVudHMuJHtwcm9wfVxcYCBvcHRpb25gLCB1bmtub3duVHlwZVdhcm5pbmcgPSAodHlwZU5hbWUpID0+IGdldFRlbXBsYXRlKGBibG9jayB0eXBlIFwiJHt0eXBlTmFtZX1cImAsIFwidHlwZXNcIiksIHVua25vd25NYXJrV2FybmluZyA9IChtYXJrVHlwZSkgPT4gZ2V0VGVtcGxhdGUoYG1hcmsgdHlwZSBcIiR7bWFya1R5cGV9XCJgLCBcIm1hcmtzXCIpLCB1bmtub3duQmxvY2tTdHlsZVdhcm5pbmcgPSAoYmxvY2tTdHlsZSkgPT4gZ2V0VGVtcGxhdGUoYGJsb2NrIHN0eWxlIFwiJHtibG9ja1N0eWxlfVwiYCwgXCJibG9ja1wiKSwgdW5rbm93bkxpc3RTdHlsZVdhcm5pbmcgPSAobGlzdFN0eWxlKSA9PiBnZXRUZW1wbGF0ZShgbGlzdCBzdHlsZSBcIiR7bGlzdFN0eWxlfVwiYCwgXCJsaXN0XCIpLCB1bmtub3duTGlzdEl0ZW1TdHlsZVdhcm5pbmcgPSAobGlzdFN0eWxlKSA9PiBnZXRUZW1wbGF0ZShgbGlzdCBpdGVtIHN0eWxlIFwiJHtsaXN0U3R5bGV9XCJgLCBcImxpc3RJdGVtXCIpO1xuZnVuY3Rpb24gcHJpbnRXYXJuaW5nKG1lc3NhZ2UpIHtcblx0Y29uc29sZS53YXJuKG1lc3NhZ2UpO1xufVxuY29uc3QgZGVmYXVsdENvbXBvbmVudHMgPSB7XG5cdHR5cGVzOiB7fSxcblx0YmxvY2s6IHtcblx0XHRub3JtYWw6ICh7IGNoaWxkcmVuIH0pID0+IGA8cD4ke2NoaWxkcmVufTwvcD5gLFxuXHRcdGJsb2NrcXVvdGU6ICh7IGNoaWxkcmVuIH0pID0+IGA8YmxvY2txdW90ZT4ke2NoaWxkcmVufTwvYmxvY2txdW90ZT5gLFxuXHRcdGgxOiAoeyBjaGlsZHJlbiB9KSA9PiBgPGgxPiR7Y2hpbGRyZW59PC9oMT5gLFxuXHRcdGgyOiAoeyBjaGlsZHJlbiB9KSA9PiBgPGgyPiR7Y2hpbGRyZW59PC9oMj5gLFxuXHRcdGgzOiAoeyBjaGlsZHJlbiB9KSA9PiBgPGgzPiR7Y2hpbGRyZW59PC9oMz5gLFxuXHRcdGg0OiAoeyBjaGlsZHJlbiB9KSA9PiBgPGg0PiR7Y2hpbGRyZW59PC9oND5gLFxuXHRcdGg1OiAoeyBjaGlsZHJlbiB9KSA9PiBgPGg1PiR7Y2hpbGRyZW59PC9oNT5gLFxuXHRcdGg2OiAoeyBjaGlsZHJlbiB9KSA9PiBgPGg2PiR7Y2hpbGRyZW59PC9oNj5gXG5cdH0sXG5cdG1hcmtzOiBkZWZhdWx0TWFya3MsXG5cdGxpc3Q6IGRlZmF1bHRMaXN0cyxcblx0bGlzdEl0ZW06IERlZmF1bHRMaXN0SXRlbSxcblx0aGFyZEJyZWFrOiAoKSA9PiBcIjxici8+XCIsXG5cdGVzY2FwZUhUTUwsXG5cdHVua25vd25UeXBlOiAoeyB2YWx1ZSwgaXNJbmxpbmUgfSkgPT4ge1xuXHRcdGxldCB3YXJuaW5nID0gdW5rbm93blR5cGVXYXJuaW5nKHZhbHVlLl90eXBlKTtcblx0XHRyZXR1cm4gaXNJbmxpbmUgPyBgPHNwYW4gc3R5bGU9XCJkaXNwbGF5Om5vbmVcIj4ke3dhcm5pbmd9PC9zcGFuPmAgOiBgPGRpdiBzdHlsZT1cImRpc3BsYXk6bm9uZVwiPiR7d2FybmluZ308L2Rpdj5gO1xuXHR9LFxuXHR1bmtub3duTWFyazogKHsgbWFya1R5cGUsIGNoaWxkcmVuIH0pID0+IGA8c3BhbiBjbGFzcz1cInVua25vd25fX3B0X19tYXJrX18ke21hcmtUeXBlfVwiPiR7Y2hpbGRyZW59PC9zcGFuPmAsXG5cdHVua25vd25MaXN0OiAoeyBjaGlsZHJlbiB9KSA9PiBgPHVsPiR7Y2hpbGRyZW59PC91bD5gLFxuXHR1bmtub3duTGlzdEl0ZW06ICh7IGNoaWxkcmVuIH0pID0+IGA8bGk+JHtjaGlsZHJlbn08L2xpPmAsXG5cdHVua25vd25CbG9ja1N0eWxlOiAoeyBjaGlsZHJlbiB9KSA9PiBgPHA+JHtjaGlsZHJlbn08L3A+YFxufTtcbmZ1bmN0aW9uIG1lcmdlQ29tcG9uZW50cyhwYXJlbnQsIG92ZXJyaWRlcykge1xuXHRsZXQgeyBibG9jaywgbGlzdCwgbGlzdEl0ZW0sIG1hcmtzLCB0eXBlcywgLi4ucmVzdCB9ID0gb3ZlcnJpZGVzO1xuXHRyZXR1cm4ge1xuXHRcdC4uLnBhcmVudCxcblx0XHRibG9jazogbWVyZ2VEZWVwbHkocGFyZW50LCBvdmVycmlkZXMsIFwiYmxvY2tcIiksXG5cdFx0bGlzdDogbWVyZ2VEZWVwbHkocGFyZW50LCBvdmVycmlkZXMsIFwibGlzdFwiKSxcblx0XHRsaXN0SXRlbTogbWVyZ2VEZWVwbHkocGFyZW50LCBvdmVycmlkZXMsIFwibGlzdEl0ZW1cIiksXG5cdFx0bWFya3M6IG1lcmdlRGVlcGx5KHBhcmVudCwgb3ZlcnJpZGVzLCBcIm1hcmtzXCIpLFxuXHRcdHR5cGVzOiBtZXJnZURlZXBseShwYXJlbnQsIG92ZXJyaWRlcywgXCJ0eXBlc1wiKSxcblx0XHQuLi5yZXN0XG5cdH07XG59XG5mdW5jdGlvbiBtZXJnZURlZXBseShwYXJlbnQsIG92ZXJyaWRlcywga2V5KSB7XG5cdGxldCBvdmVycmlkZSA9IG92ZXJyaWRlc1trZXldLCBwYXJlbnRWYWwgPSBwYXJlbnRba2V5XTtcblx0cmV0dXJuIHR5cGVvZiBvdmVycmlkZSA9PSBcImZ1bmN0aW9uXCIgPyBvdmVycmlkZSA6IG92ZXJyaWRlID8gdHlwZW9mIHBhcmVudFZhbCA9PSBcImZ1bmN0aW9uXCIgPyBvdmVycmlkZSA6IHtcblx0XHQuLi5wYXJlbnRWYWwsXG5cdFx0Li4ub3ZlcnJpZGVcblx0fSA6IHBhcmVudFZhbDtcbn1cbmZ1bmN0aW9uIHRvSFRNTCh2YWx1ZSwgb3B0aW9ucyA9IHt9KSB7XG5cdGxldCB7IGNvbXBvbmVudHM6IGNvbXBvbmVudE92ZXJyaWRlcywgb25NaXNzaW5nQ29tcG9uZW50OiBtaXNzaW5nQ29tcG9uZW50SGFuZGxlciA9IHByaW50V2FybmluZyB9ID0gb3B0aW9ucywgaGFuZGxlTWlzc2luZ0NvbXBvbmVudCA9IG1pc3NpbmdDb21wb25lbnRIYW5kbGVyIHx8IG5vb3AsIG5lc3RlZCA9IG5lc3RMaXN0cyhBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXSwgXCJodG1sXCIpLCByZW5kZXJOb2RlID0gZ2V0Tm9kZVJlbmRlcmVyKGNvbXBvbmVudE92ZXJyaWRlcyA/IG1lcmdlQ29tcG9uZW50cyhkZWZhdWx0Q29tcG9uZW50cywgY29tcG9uZW50T3ZlcnJpZGVzKSA6IGRlZmF1bHRDb21wb25lbnRzLCBoYW5kbGVNaXNzaW5nQ29tcG9uZW50KTtcblx0cmV0dXJuIG5lc3RlZC5tYXAoKG5vZGUsIGluZGV4KSA9PiByZW5kZXJOb2RlKHtcblx0XHRub2RlLFxuXHRcdGluZGV4LFxuXHRcdGlzSW5saW5lOiAhMSxcblx0XHRyZW5kZXJOb2RlXG5cdH0pKS5qb2luKFwiXCIpO1xufVxuY29uc3QgZ2V0Tm9kZVJlbmRlcmVyID0gKGNvbXBvbmVudHMsIGhhbmRsZU1pc3NpbmdDb21wb25lbnQpID0+IHtcblx0ZnVuY3Rpb24gcmVuZGVyTm9kZShvcHRpb25zKSB7XG5cdFx0bGV0IHsgbm9kZSwgaW5kZXgsIGlzSW5saW5lIH0gPSBvcHRpb25zO1xuXHRcdHJldHVybiBpc1BvcnRhYmxlVGV4dFRvb2xraXRMaXN0KG5vZGUpID8gcmVuZGVyTGlzdChub2RlLCBpbmRleCkgOiBpc1BvcnRhYmxlVGV4dExpc3RJdGVtQmxvY2sobm9kZSkgPyByZW5kZXJMaXN0SXRlbShub2RlLCBpbmRleCkgOiBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuKG5vZGUpID8gcmVuZGVyU3Bhbihub2RlKSA6IGlzUG9ydGFibGVUZXh0QmxvY2sobm9kZSkgPyByZW5kZXJCbG9jayhub2RlLCBpbmRleCwgaXNJbmxpbmUpIDogaXNQb3J0YWJsZVRleHRUb29sa2l0VGV4dE5vZGUobm9kZSkgPyByZW5kZXJUZXh0KG5vZGUpIDogcmVuZGVyQ3VzdG9tQmxvY2sobm9kZSwgaW5kZXgsIGlzSW5saW5lKTtcblx0fVxuXHRmdW5jdGlvbiByZW5kZXJMaXN0SXRlbShub2RlLCBpbmRleCkge1xuXHRcdGxldCB0cmVlID0gc2VyaWFsaXplQmxvY2soe1xuXHRcdFx0bm9kZSxcblx0XHRcdGluZGV4LFxuXHRcdFx0aXNJbmxpbmU6ICExLFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH0pLCByZW5kZXJlciA9IGNvbXBvbmVudHMubGlzdEl0ZW0sIGl0ZW1IYW5kbGVyID0gKHR5cGVvZiByZW5kZXJlciA9PSBcImZ1bmN0aW9uXCIgPyByZW5kZXJlciA6IHJlbmRlcmVyW25vZGUubGlzdEl0ZW1dKSB8fCBjb21wb25lbnRzLnVua25vd25MaXN0SXRlbTtcblx0XHRpZiAoaXRlbUhhbmRsZXIgPT09IGNvbXBvbmVudHMudW5rbm93bkxpc3RJdGVtKSB7XG5cdFx0XHRsZXQgc3R5bGUgPSBub2RlLmxpc3RJdGVtIHx8IFwiYnVsbGV0XCI7XG5cdFx0XHRoYW5kbGVNaXNzaW5nQ29tcG9uZW50KHVua25vd25MaXN0SXRlbVN0eWxlV2FybmluZyhzdHlsZSksIHtcblx0XHRcdFx0dHlwZTogc3R5bGUsXG5cdFx0XHRcdG5vZGVUeXBlOiBcImxpc3RJdGVtU3R5bGVcIlxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGxldCBjaGlsZHJlbiA9IHRyZWUuY2hpbGRyZW47XG5cdFx0aWYgKG5vZGUuc3R5bGUgJiYgbm9kZS5zdHlsZSAhPT0gXCJub3JtYWxcIikge1xuXHRcdFx0bGV0IHsgbGlzdEl0ZW0sIC4uLmJsb2NrTm9kZSB9ID0gbm9kZTtcblx0XHRcdGNoaWxkcmVuID0gcmVuZGVyTm9kZSh7XG5cdFx0XHRcdG5vZGU6IGJsb2NrTm9kZSxcblx0XHRcdFx0aW5kZXgsXG5cdFx0XHRcdGlzSW5saW5lOiAhMSxcblx0XHRcdFx0cmVuZGVyTm9kZVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdHJldHVybiBpdGVtSGFuZGxlcih7XG5cdFx0XHR2YWx1ZTogbm9kZSxcblx0XHRcdGluZGV4LFxuXHRcdFx0aXNJbmxpbmU6ICExLFxuXHRcdFx0cmVuZGVyTm9kZSxcblx0XHRcdGNoaWxkcmVuXG5cdFx0fSk7XG5cdH1cblx0ZnVuY3Rpb24gcmVuZGVyTGlzdChub2RlLCBpbmRleCkge1xuXHRcdGxldCBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW4ubWFwKChjaGlsZCwgY2hpbGRJbmRleCkgPT4gcmVuZGVyTm9kZSh7XG5cdFx0XHRub2RlOiBjaGlsZC5fa2V5ID8gY2hpbGQgOiB7XG5cdFx0XHRcdC4uLmNoaWxkLFxuXHRcdFx0XHRfa2V5OiBgbGktJHtpbmRleH0tJHtjaGlsZEluZGV4fWBcblx0XHRcdH0sXG5cdFx0XHRpbmRleDogY2hpbGRJbmRleCxcblx0XHRcdGlzSW5saW5lOiAhMSxcblx0XHRcdHJlbmRlck5vZGVcblx0XHR9KSksIGNvbXBvbmVudCA9IGNvbXBvbmVudHMubGlzdCwgbGlzdCA9ICh0eXBlb2YgY29tcG9uZW50ID09IFwiZnVuY3Rpb25cIiA/IGNvbXBvbmVudCA6IGNvbXBvbmVudFtub2RlLmxpc3RJdGVtXSkgfHwgY29tcG9uZW50cy51bmtub3duTGlzdDtcblx0XHRpZiAobGlzdCA9PT0gY29tcG9uZW50cy51bmtub3duTGlzdCkge1xuXHRcdFx0bGV0IHN0eWxlID0gbm9kZS5saXN0SXRlbSB8fCBcImJ1bGxldFwiO1xuXHRcdFx0aGFuZGxlTWlzc2luZ0NvbXBvbmVudCh1bmtub3duTGlzdFN0eWxlV2FybmluZyhzdHlsZSksIHtcblx0XHRcdFx0bm9kZVR5cGU6IFwibGlzdFN0eWxlXCIsXG5cdFx0XHRcdHR5cGU6IHN0eWxlXG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0cmV0dXJuIGxpc3Qoe1xuXHRcdFx0dmFsdWU6IG5vZGUsXG5cdFx0XHRpbmRleCxcblx0XHRcdGlzSW5saW5lOiAhMSxcblx0XHRcdHJlbmRlck5vZGUsXG5cdFx0XHRjaGlsZHJlbjogY2hpbGRyZW4uam9pbihcIlwiKVxuXHRcdH0pO1xuXHR9XG5cdGZ1bmN0aW9uIHJlbmRlclNwYW4obm9kZSkge1xuXHRcdGxldCB7IG1hcmtEZWYsIG1hcmtUeXBlLCBtYXJrS2V5IH0gPSBub2RlLCBzcGFuID0gY29tcG9uZW50cy5tYXJrc1ttYXJrVHlwZV0gfHwgY29tcG9uZW50cy51bmtub3duTWFyaywgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuLm1hcCgoY2hpbGQsIGNoaWxkSW5kZXgpID0+IHJlbmRlck5vZGUoe1xuXHRcdFx0bm9kZTogY2hpbGQsXG5cdFx0XHRpbmRleDogY2hpbGRJbmRleCxcblx0XHRcdGlzSW5saW5lOiAhMCxcblx0XHRcdHJlbmRlck5vZGVcblx0XHR9KSk7XG5cdFx0cmV0dXJuIHNwYW4gPT09IGNvbXBvbmVudHMudW5rbm93bk1hcmsgJiYgaGFuZGxlTWlzc2luZ0NvbXBvbmVudCh1bmtub3duTWFya1dhcm5pbmcobWFya1R5cGUpLCB7XG5cdFx0XHRub2RlVHlwZTogXCJtYXJrXCIsXG5cdFx0XHR0eXBlOiBtYXJrVHlwZVxuXHRcdH0pLCBzcGFuKHtcblx0XHRcdHRleHQ6IHNwYW5Ub1BsYWluVGV4dChub2RlKSxcblx0XHRcdHZhbHVlOiBtYXJrRGVmLFxuXHRcdFx0bWFya1R5cGUsXG5cdFx0XHRtYXJrS2V5LFxuXHRcdFx0cmVuZGVyTm9kZSxcblx0XHRcdGNoaWxkcmVuOiBjaGlsZHJlbi5qb2luKFwiXCIpXG5cdFx0fSk7XG5cdH1cblx0ZnVuY3Rpb24gcmVuZGVyQmxvY2sobm9kZSwgaW5kZXgsIGlzSW5saW5lKSB7XG5cdFx0bGV0IHsgX2tleSwgLi4ucHJvcHMgfSA9IHNlcmlhbGl6ZUJsb2NrKHtcblx0XHRcdG5vZGUsXG5cdFx0XHRpbmRleCxcblx0XHRcdGlzSW5saW5lLFxuXHRcdFx0cmVuZGVyTm9kZVxuXHRcdH0pLCBzdHlsZSA9IHByb3BzLm5vZGUuc3R5bGUgfHwgXCJub3JtYWxcIiwgYmxvY2sgPSAodHlwZW9mIGNvbXBvbmVudHMuYmxvY2sgPT0gXCJmdW5jdGlvblwiID8gY29tcG9uZW50cy5ibG9jayA6IGNvbXBvbmVudHMuYmxvY2tbc3R5bGVdKSB8fCBjb21wb25lbnRzLnVua25vd25CbG9ja1N0eWxlO1xuXHRcdHJldHVybiBibG9jayA9PT0gY29tcG9uZW50cy51bmtub3duQmxvY2tTdHlsZSAmJiBoYW5kbGVNaXNzaW5nQ29tcG9uZW50KHVua25vd25CbG9ja1N0eWxlV2FybmluZyhzdHlsZSksIHtcblx0XHRcdG5vZGVUeXBlOiBcImJsb2NrU3R5bGVcIixcblx0XHRcdHR5cGU6IHN0eWxlXG5cdFx0fSksIGJsb2NrKHtcblx0XHRcdC4uLnByb3BzLFxuXHRcdFx0dmFsdWU6IHByb3BzLm5vZGUsXG5cdFx0XHRyZW5kZXJOb2RlXG5cdFx0fSk7XG5cdH1cblx0ZnVuY3Rpb24gcmVuZGVyVGV4dChub2RlKSB7XG5cdFx0aWYgKG5vZGUudGV4dCA9PT0gXCJcXG5cIikge1xuXHRcdFx0bGV0IGhhcmRCcmVhayA9IGNvbXBvbmVudHMuaGFyZEJyZWFrO1xuXHRcdFx0cmV0dXJuIGhhcmRCcmVhayA/IGhhcmRCcmVhaygpIDogXCJcXG5cIjtcblx0XHR9XG5cdFx0cmV0dXJuIGNvbXBvbmVudHMuZXNjYXBlSFRNTChub2RlLnRleHQpO1xuXHR9XG5cdGZ1bmN0aW9uIHJlbmRlckN1c3RvbUJsb2NrKHZhbHVlLCBpbmRleCwgaXNJbmxpbmUpIHtcblx0XHRsZXQgbm9kZSA9IGNvbXBvbmVudHMudHlwZXNbdmFsdWUuX3R5cGVdO1xuXHRcdHJldHVybiBub2RlIHx8IGhhbmRsZU1pc3NpbmdDb21wb25lbnQodW5rbm93blR5cGVXYXJuaW5nKHZhbHVlLl90eXBlKSwge1xuXHRcdFx0bm9kZVR5cGU6IFwiYmxvY2tcIixcblx0XHRcdHR5cGU6IHZhbHVlLl90eXBlXG5cdFx0fSksIChub2RlIHx8IGNvbXBvbmVudHMudW5rbm93blR5cGUpKHtcblx0XHRcdHZhbHVlLFxuXHRcdFx0aXNJbmxpbmUsXG5cdFx0XHRpbmRleCxcblx0XHRcdHJlbmRlck5vZGVcblx0XHR9KTtcblx0fVxuXHRyZXR1cm4gcmVuZGVyTm9kZTtcbn07XG5mdW5jdGlvbiBzZXJpYWxpemVCbG9jayhvcHRpb25zKSB7XG5cdGxldCB7IG5vZGUsIGluZGV4LCBpc0lubGluZSwgcmVuZGVyTm9kZSB9ID0gb3B0aW9ucywgY2hpbGRyZW4gPSBidWlsZE1hcmtzVHJlZShub2RlKS5tYXAoKGNoaWxkLCBpKSA9PiByZW5kZXJOb2RlKHtcblx0XHRub2RlOiBjaGlsZCxcblx0XHRpc0lubGluZTogITAsXG5cdFx0aW5kZXg6IGksXG5cdFx0cmVuZGVyTm9kZVxuXHR9KSk7XG5cdHJldHVybiB7XG5cdFx0X2tleTogbm9kZS5fa2V5IHx8IGBibG9jay0ke2luZGV4fWAsXG5cdFx0Y2hpbGRyZW46IGNoaWxkcmVuLmpvaW4oXCJcIiksXG5cdFx0aW5kZXgsXG5cdFx0aXNJbmxpbmUsXG5cdFx0bm9kZVxuXHR9O1xufVxuZnVuY3Rpb24gbm9vcCgpIHt9XG5leHBvcnQgeyBkZWZhdWx0Q29tcG9uZW50cywgZXNjYXBlSFRNTCwgbWVyZ2VDb21wb25lbnRzLCB0b0hUTUwsIHVyaUxvb2tzU2FmZSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/to-html/dist/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@portabletext/toolkit/dist/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/@portabletext/toolkit/dist/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LIST_NEST_MODE_DIRECT: () => (/* binding */ LIST_NEST_MODE_DIRECT),\n/* harmony export */   LIST_NEST_MODE_HTML: () => (/* binding */ LIST_NEST_MODE_HTML),\n/* harmony export */   buildMarksTree: () => (/* binding */ buildMarksTree),\n/* harmony export */   isPortableTextBlock: () => (/* binding */ isPortableTextBlock),\n/* harmony export */   isPortableTextListItemBlock: () => (/* binding */ isPortableTextListItemBlock),\n/* harmony export */   isPortableTextSpan: () => (/* binding */ isPortableTextSpan),\n/* harmony export */   isPortableTextToolkitList: () => (/* binding */ isPortableTextToolkitList),\n/* harmony export */   isPortableTextToolkitSpan: () => (/* binding */ isPortableTextToolkitSpan),\n/* harmony export */   isPortableTextToolkitTextNode: () => (/* binding */ isPortableTextToolkitTextNode),\n/* harmony export */   nestLists: () => (/* binding */ nestLists),\n/* harmony export */   sortMarksByOccurences: () => (/* binding */ sortMarksByOccurences),\n/* harmony export */   spanToPlainText: () => (/* binding */ spanToPlainText),\n/* harmony export */   toPlainText: () => (/* binding */ toPlainText)\n/* harmony export */ });\nfunction isPortableTextSpan(node) {\n\treturn node._type === \"span\" && \"text\" in node && typeof node.text == \"string\" && (node.marks === void 0 || Array.isArray(node.marks) && node.marks.every((mark) => typeof mark == \"string\"));\n}\nfunction isPortableTextBlock(node) {\n\treturn typeof node._type == \"string\" && node._type[0] !== \"@\" && (!(\"markDefs\" in node) || !node.markDefs || Array.isArray(node.markDefs) && node.markDefs.every((def) => typeof def._key == \"string\")) && \"children\" in node && Array.isArray(node.children) && node.children.every((child) => typeof child == \"object\" && \"_type\" in child);\n}\nfunction isPortableTextListItemBlock(block) {\n\treturn isPortableTextBlock(block) && \"listItem\" in block && typeof block.listItem == \"string\" && (block.level === void 0 || typeof block.level == \"number\");\n}\nfunction isPortableTextToolkitList(block) {\n\treturn block._type === \"@list\";\n}\nfunction isPortableTextToolkitSpan(span) {\n\treturn span._type === \"@span\";\n}\nfunction isPortableTextToolkitTextNode(node) {\n\treturn node._type === \"@text\";\n}\nconst knownDecorators = [\n\t\"strong\",\n\t\"em\",\n\t\"code\",\n\t\"underline\",\n\t\"strike-through\"\n];\nfunction sortMarksByOccurences(span, index, blockChildren) {\n\tif (!isPortableTextSpan(span) || !span.marks || !span.marks.length) return [];\n\tlet marks = span.marks.slice(), occurences = {};\n\treturn marks.forEach((mark) => {\n\t\toccurences[mark] = 1;\n\t\tfor (let siblingIndex = index + 1; siblingIndex < blockChildren.length; siblingIndex++) {\n\t\t\tlet sibling = blockChildren[siblingIndex];\n\t\t\tif (sibling && isPortableTextSpan(sibling) && Array.isArray(sibling.marks) && sibling.marks.indexOf(mark) !== -1) occurences[mark]++;\n\t\t\telse break;\n\t\t}\n\t}), marks.sort((markA, markB) => sortMarks(occurences, markA, markB));\n}\nfunction sortMarks(occurences, markA, markB) {\n\tlet aOccurences = occurences[markA], bOccurences = occurences[markB];\n\tif (aOccurences !== bOccurences) return bOccurences - aOccurences;\n\tlet aKnownPos = knownDecorators.indexOf(markA), bKnownPos = knownDecorators.indexOf(markB);\n\treturn aKnownPos === bKnownPos ? markA.localeCompare(markB) : aKnownPos - bKnownPos;\n}\nfunction buildMarksTree(block) {\n\tlet { children } = block, markDefs = block.markDefs ?? [];\n\tif (!children || !children.length) return [];\n\tlet sortedMarks = children.map(sortMarksByOccurences), rootNode = {\n\t\t_type: \"@span\",\n\t\tchildren: [],\n\t\tmarkType: \"<unknown>\"\n\t}, nodeStack = [rootNode];\n\tfor (let i = 0; i < children.length; i++) {\n\t\tlet span = children[i];\n\t\tif (!span) continue;\n\t\tlet marksNeeded = sortedMarks[i] || [], pos = 1;\n\t\tif (nodeStack.length > 1) for (; pos < nodeStack.length; pos++) {\n\t\t\tlet mark = nodeStack[pos]?.markKey || \"\", index = marksNeeded.indexOf(mark);\n\t\t\tif (index === -1) break;\n\t\t\tmarksNeeded.splice(index, 1);\n\t\t}\n\t\tnodeStack = nodeStack.slice(0, pos);\n\t\tlet currentNode = nodeStack[nodeStack.length - 1];\n\t\tif (currentNode) {\n\t\t\tfor (let markKey of marksNeeded) {\n\t\t\t\tlet markDef = markDefs?.find((def) => def._key === markKey), node = {\n\t\t\t\t\t_type: \"@span\",\n\t\t\t\t\t_key: span._key,\n\t\t\t\t\tchildren: [],\n\t\t\t\t\tmarkDef,\n\t\t\t\t\tmarkType: markDef ? markDef._type : markKey,\n\t\t\t\t\tmarkKey\n\t\t\t\t};\n\t\t\t\tcurrentNode.children.push(node), nodeStack.push(node), currentNode = node;\n\t\t\t}\n\t\t\tif (isPortableTextSpan(span)) {\n\t\t\t\tlet lines = span.text.split(\"\\n\");\n\t\t\t\tfor (let line = lines.length; line-- > 1;) lines.splice(line, 0, \"\\n\");\n\t\t\t\tcurrentNode.children = currentNode.children.concat(lines.map((text) => ({\n\t\t\t\t\t_type: \"@text\",\n\t\t\t\t\ttext\n\t\t\t\t})));\n\t\t\t} else currentNode.children = currentNode.children.concat(span);\n\t\t}\n\t}\n\treturn rootNode.children;\n}\nfunction nestLists(blocks, mode) {\n\tlet tree = [], currentList;\n\tfor (let i = 0; i < blocks.length; i++) {\n\t\tlet block = blocks[i];\n\t\tif (block) {\n\t\t\tif (!isPortableTextListItemBlock(block)) {\n\t\t\t\ttree.push(block), currentList = void 0;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!currentList) {\n\t\t\t\tcurrentList = listFromBlock(block, i, mode), tree.push(currentList);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (blockMatchesList(block, currentList)) {\n\t\t\t\tcurrentList.children.push(block);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif ((block.level || 1) > currentList.level) {\n\t\t\t\tlet newList = listFromBlock(block, i, mode);\n\t\t\t\tif (mode === \"html\") {\n\t\t\t\t\tlet lastListItem = currentList.children[currentList.children.length - 1], newLastChild = {\n\t\t\t\t\t\t...lastListItem,\n\t\t\t\t\t\tchildren: [...lastListItem.children, newList]\n\t\t\t\t\t};\n\t\t\t\t\tcurrentList.children[currentList.children.length - 1] = newLastChild;\n\t\t\t\t} else currentList.children.push(newList);\n\t\t\t\tcurrentList = newList;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif ((block.level || 1) < currentList.level) {\n\t\t\t\tlet matchingBranch = tree[tree.length - 1], match = matchingBranch && findListMatching(matchingBranch, block);\n\t\t\t\tif (match) {\n\t\t\t\t\tcurrentList = match, currentList.children.push(block);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tcurrentList = listFromBlock(block, i, mode), tree.push(currentList);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (block.listItem !== currentList.listItem) {\n\t\t\t\tlet matchingBranch = tree[tree.length - 1], match = matchingBranch && findListMatching(matchingBranch, { level: block.level || 1 });\n\t\t\t\tif (match && match.listItem === block.listItem) {\n\t\t\t\t\tcurrentList = match, currentList.children.push(block);\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tcurrentList = listFromBlock(block, i, mode), tree.push(currentList);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.warn(\"Unknown state encountered for block\", block), tree.push(block);\n\t\t}\n\t}\n\treturn tree;\n}\nfunction blockMatchesList(block, list) {\n\treturn (block.level || 1) === list.level && block.listItem === list.listItem;\n}\nfunction listFromBlock(block, index, mode) {\n\treturn {\n\t\t_type: \"@list\",\n\t\t_key: `${block._key || `${index}`}-parent`,\n\t\tmode,\n\t\tlevel: block.level || 1,\n\t\tlistItem: block.listItem,\n\t\tchildren: [block]\n\t};\n}\nfunction findListMatching(rootNode, matching) {\n\tlet level = matching.level || 1, style = matching.listItem || \"normal\", filterOnType = typeof matching.listItem == \"string\";\n\tif (isPortableTextToolkitList(rootNode) && (rootNode.level || 1) === level && filterOnType && (rootNode.listItem || \"normal\") === style) return rootNode;\n\tif (!(\"children\" in rootNode)) return;\n\tlet node = rootNode.children[rootNode.children.length - 1];\n\treturn node && !isPortableTextSpan(node) ? findListMatching(node, matching) : void 0;\n}\nfunction spanToPlainText(span) {\n\tlet text = \"\";\n\treturn span.children.forEach((current) => {\n\t\tisPortableTextToolkitTextNode(current) ? text += current.text : isPortableTextToolkitSpan(current) && (text += spanToPlainText(current));\n\t}), text;\n}\nconst leadingSpace = /^\\s/, trailingSpace = /\\s$/;\nfunction toPlainText(block) {\n\tlet blocks = Array.isArray(block) ? block : [block], text = \"\";\n\treturn blocks.forEach((current, index) => {\n\t\tif (!isPortableTextBlock(current)) return;\n\t\tlet pad = !1;\n\t\tcurrent.children.forEach((span) => {\n\t\t\tisPortableTextSpan(span) ? (text += pad && text && !trailingSpace.test(text) && !leadingSpace.test(span.text) ? \" \" : \"\", text += span.text, pad = !1) : pad = !0;\n\t\t}), index !== blocks.length - 1 && (text += \"\\n\\n\");\n\t}), text;\n}\nconst LIST_NEST_MODE_HTML = \"html\", LIST_NEST_MODE_DIRECT = \"direct\";\n\n\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHBvcnRhYmxldGV4dC90b29sa2l0L2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxxQ0FBcUM7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sV0FBVztBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGLGlCQUFpQixxQkFBcUI7QUFDdEM7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHdCQUF3QjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLFdBQVc7QUFDN0M7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsbUJBQW1CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkdBQTZHLHlCQUF5QjtBQUN0STtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxpQkFBaUIsTUFBTSxFQUFFO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ2lTOztBQUVqUyIsInNvdXJjZXMiOlsid2VicGFjazovL2NyaXNwLWNsZWFuaW5nLy4vbm9kZV9tb2R1bGVzL0Bwb3J0YWJsZXRleHQvdG9vbGtpdC9kaXN0L2luZGV4LmpzPzdkNGEiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gaXNQb3J0YWJsZVRleHRTcGFuKG5vZGUpIHtcblx0cmV0dXJuIG5vZGUuX3R5cGUgPT09IFwic3BhblwiICYmIFwidGV4dFwiIGluIG5vZGUgJiYgdHlwZW9mIG5vZGUudGV4dCA9PSBcInN0cmluZ1wiICYmIChub2RlLm1hcmtzID09PSB2b2lkIDAgfHwgQXJyYXkuaXNBcnJheShub2RlLm1hcmtzKSAmJiBub2RlLm1hcmtzLmV2ZXJ5KChtYXJrKSA9PiB0eXBlb2YgbWFyayA9PSBcInN0cmluZ1wiKSk7XG59XG5mdW5jdGlvbiBpc1BvcnRhYmxlVGV4dEJsb2NrKG5vZGUpIHtcblx0cmV0dXJuIHR5cGVvZiBub2RlLl90eXBlID09IFwic3RyaW5nXCIgJiYgbm9kZS5fdHlwZVswXSAhPT0gXCJAXCIgJiYgKCEoXCJtYXJrRGVmc1wiIGluIG5vZGUpIHx8ICFub2RlLm1hcmtEZWZzIHx8IEFycmF5LmlzQXJyYXkobm9kZS5tYXJrRGVmcykgJiYgbm9kZS5tYXJrRGVmcy5ldmVyeSgoZGVmKSA9PiB0eXBlb2YgZGVmLl9rZXkgPT0gXCJzdHJpbmdcIikpICYmIFwiY2hpbGRyZW5cIiBpbiBub2RlICYmIEFycmF5LmlzQXJyYXkobm9kZS5jaGlsZHJlbikgJiYgbm9kZS5jaGlsZHJlbi5ldmVyeSgoY2hpbGQpID0+IHR5cGVvZiBjaGlsZCA9PSBcIm9iamVjdFwiICYmIFwiX3R5cGVcIiBpbiBjaGlsZCk7XG59XG5mdW5jdGlvbiBpc1BvcnRhYmxlVGV4dExpc3RJdGVtQmxvY2soYmxvY2spIHtcblx0cmV0dXJuIGlzUG9ydGFibGVUZXh0QmxvY2soYmxvY2spICYmIFwibGlzdEl0ZW1cIiBpbiBibG9jayAmJiB0eXBlb2YgYmxvY2subGlzdEl0ZW0gPT0gXCJzdHJpbmdcIiAmJiAoYmxvY2subGV2ZWwgPT09IHZvaWQgMCB8fCB0eXBlb2YgYmxvY2subGV2ZWwgPT0gXCJudW1iZXJcIik7XG59XG5mdW5jdGlvbiBpc1BvcnRhYmxlVGV4dFRvb2xraXRMaXN0KGJsb2NrKSB7XG5cdHJldHVybiBibG9jay5fdHlwZSA9PT0gXCJAbGlzdFwiO1xufVxuZnVuY3Rpb24gaXNQb3J0YWJsZVRleHRUb29sa2l0U3BhbihzcGFuKSB7XG5cdHJldHVybiBzcGFuLl90eXBlID09PSBcIkBzcGFuXCI7XG59XG5mdW5jdGlvbiBpc1BvcnRhYmxlVGV4dFRvb2xraXRUZXh0Tm9kZShub2RlKSB7XG5cdHJldHVybiBub2RlLl90eXBlID09PSBcIkB0ZXh0XCI7XG59XG5jb25zdCBrbm93bkRlY29yYXRvcnMgPSBbXG5cdFwic3Ryb25nXCIsXG5cdFwiZW1cIixcblx0XCJjb2RlXCIsXG5cdFwidW5kZXJsaW5lXCIsXG5cdFwic3RyaWtlLXRocm91Z2hcIlxuXTtcbmZ1bmN0aW9uIHNvcnRNYXJrc0J5T2NjdXJlbmNlcyhzcGFuLCBpbmRleCwgYmxvY2tDaGlsZHJlbikge1xuXHRpZiAoIWlzUG9ydGFibGVUZXh0U3BhbihzcGFuKSB8fCAhc3Bhbi5tYXJrcyB8fCAhc3Bhbi5tYXJrcy5sZW5ndGgpIHJldHVybiBbXTtcblx0bGV0IG1hcmtzID0gc3Bhbi5tYXJrcy5zbGljZSgpLCBvY2N1cmVuY2VzID0ge307XG5cdHJldHVybiBtYXJrcy5mb3JFYWNoKChtYXJrKSA9PiB7XG5cdFx0b2NjdXJlbmNlc1ttYXJrXSA9IDE7XG5cdFx0Zm9yIChsZXQgc2libGluZ0luZGV4ID0gaW5kZXggKyAxOyBzaWJsaW5nSW5kZXggPCBibG9ja0NoaWxkcmVuLmxlbmd0aDsgc2libGluZ0luZGV4KyspIHtcblx0XHRcdGxldCBzaWJsaW5nID0gYmxvY2tDaGlsZHJlbltzaWJsaW5nSW5kZXhdO1xuXHRcdFx0aWYgKHNpYmxpbmcgJiYgaXNQb3J0YWJsZVRleHRTcGFuKHNpYmxpbmcpICYmIEFycmF5LmlzQXJyYXkoc2libGluZy5tYXJrcykgJiYgc2libGluZy5tYXJrcy5pbmRleE9mKG1hcmspICE9PSAtMSkgb2NjdXJlbmNlc1ttYXJrXSsrO1xuXHRcdFx0ZWxzZSBicmVhaztcblx0XHR9XG5cdH0pLCBtYXJrcy5zb3J0KChtYXJrQSwgbWFya0IpID0+IHNvcnRNYXJrcyhvY2N1cmVuY2VzLCBtYXJrQSwgbWFya0IpKTtcbn1cbmZ1bmN0aW9uIHNvcnRNYXJrcyhvY2N1cmVuY2VzLCBtYXJrQSwgbWFya0IpIHtcblx0bGV0IGFPY2N1cmVuY2VzID0gb2NjdXJlbmNlc1ttYXJrQV0sIGJPY2N1cmVuY2VzID0gb2NjdXJlbmNlc1ttYXJrQl07XG5cdGlmIChhT2NjdXJlbmNlcyAhPT0gYk9jY3VyZW5jZXMpIHJldHVybiBiT2NjdXJlbmNlcyAtIGFPY2N1cmVuY2VzO1xuXHRsZXQgYUtub3duUG9zID0ga25vd25EZWNvcmF0b3JzLmluZGV4T2YobWFya0EpLCBiS25vd25Qb3MgPSBrbm93bkRlY29yYXRvcnMuaW5kZXhPZihtYXJrQik7XG5cdHJldHVybiBhS25vd25Qb3MgPT09IGJLbm93blBvcyA/IG1hcmtBLmxvY2FsZUNvbXBhcmUobWFya0IpIDogYUtub3duUG9zIC0gYktub3duUG9zO1xufVxuZnVuY3Rpb24gYnVpbGRNYXJrc1RyZWUoYmxvY2spIHtcblx0bGV0IHsgY2hpbGRyZW4gfSA9IGJsb2NrLCBtYXJrRGVmcyA9IGJsb2NrLm1hcmtEZWZzID8/IFtdO1xuXHRpZiAoIWNoaWxkcmVuIHx8ICFjaGlsZHJlbi5sZW5ndGgpIHJldHVybiBbXTtcblx0bGV0IHNvcnRlZE1hcmtzID0gY2hpbGRyZW4ubWFwKHNvcnRNYXJrc0J5T2NjdXJlbmNlcyksIHJvb3ROb2RlID0ge1xuXHRcdF90eXBlOiBcIkBzcGFuXCIsXG5cdFx0Y2hpbGRyZW46IFtdLFxuXHRcdG1hcmtUeXBlOiBcIjx1bmtub3duPlwiXG5cdH0sIG5vZGVTdGFjayA9IFtyb290Tm9kZV07XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcblx0XHRsZXQgc3BhbiA9IGNoaWxkcmVuW2ldO1xuXHRcdGlmICghc3BhbikgY29udGludWU7XG5cdFx0bGV0IG1hcmtzTmVlZGVkID0gc29ydGVkTWFya3NbaV0gfHwgW10sIHBvcyA9IDE7XG5cdFx0aWYgKG5vZGVTdGFjay5sZW5ndGggPiAxKSBmb3IgKDsgcG9zIDwgbm9kZVN0YWNrLmxlbmd0aDsgcG9zKyspIHtcblx0XHRcdGxldCBtYXJrID0gbm9kZVN0YWNrW3Bvc10/Lm1hcmtLZXkgfHwgXCJcIiwgaW5kZXggPSBtYXJrc05lZWRlZC5pbmRleE9mKG1hcmspO1xuXHRcdFx0aWYgKGluZGV4ID09PSAtMSkgYnJlYWs7XG5cdFx0XHRtYXJrc05lZWRlZC5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblx0XHRub2RlU3RhY2sgPSBub2RlU3RhY2suc2xpY2UoMCwgcG9zKTtcblx0XHRsZXQgY3VycmVudE5vZGUgPSBub2RlU3RhY2tbbm9kZVN0YWNrLmxlbmd0aCAtIDFdO1xuXHRcdGlmIChjdXJyZW50Tm9kZSkge1xuXHRcdFx0Zm9yIChsZXQgbWFya0tleSBvZiBtYXJrc05lZWRlZCkge1xuXHRcdFx0XHRsZXQgbWFya0RlZiA9IG1hcmtEZWZzPy5maW5kKChkZWYpID0+IGRlZi5fa2V5ID09PSBtYXJrS2V5KSwgbm9kZSA9IHtcblx0XHRcdFx0XHRfdHlwZTogXCJAc3BhblwiLFxuXHRcdFx0XHRcdF9rZXk6IHNwYW4uX2tleSxcblx0XHRcdFx0XHRjaGlsZHJlbjogW10sXG5cdFx0XHRcdFx0bWFya0RlZixcblx0XHRcdFx0XHRtYXJrVHlwZTogbWFya0RlZiA/IG1hcmtEZWYuX3R5cGUgOiBtYXJrS2V5LFxuXHRcdFx0XHRcdG1hcmtLZXlcblx0XHRcdFx0fTtcblx0XHRcdFx0Y3VycmVudE5vZGUuY2hpbGRyZW4ucHVzaChub2RlKSwgbm9kZVN0YWNrLnB1c2gobm9kZSksIGN1cnJlbnROb2RlID0gbm9kZTtcblx0XHRcdH1cblx0XHRcdGlmIChpc1BvcnRhYmxlVGV4dFNwYW4oc3BhbikpIHtcblx0XHRcdFx0bGV0IGxpbmVzID0gc3Bhbi50ZXh0LnNwbGl0KFwiXFxuXCIpO1xuXHRcdFx0XHRmb3IgKGxldCBsaW5lID0gbGluZXMubGVuZ3RoOyBsaW5lLS0gPiAxOykgbGluZXMuc3BsaWNlKGxpbmUsIDAsIFwiXFxuXCIpO1xuXHRcdFx0XHRjdXJyZW50Tm9kZS5jaGlsZHJlbiA9IGN1cnJlbnROb2RlLmNoaWxkcmVuLmNvbmNhdChsaW5lcy5tYXAoKHRleHQpID0+ICh7XG5cdFx0XHRcdFx0X3R5cGU6IFwiQHRleHRcIixcblx0XHRcdFx0XHR0ZXh0XG5cdFx0XHRcdH0pKSk7XG5cdFx0XHR9IGVsc2UgY3VycmVudE5vZGUuY2hpbGRyZW4gPSBjdXJyZW50Tm9kZS5jaGlsZHJlbi5jb25jYXQoc3Bhbik7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByb290Tm9kZS5jaGlsZHJlbjtcbn1cbmZ1bmN0aW9uIG5lc3RMaXN0cyhibG9ja3MsIG1vZGUpIHtcblx0bGV0IHRyZWUgPSBbXSwgY3VycmVudExpc3Q7XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0bGV0IGJsb2NrID0gYmxvY2tzW2ldO1xuXHRcdGlmIChibG9jaykge1xuXHRcdFx0aWYgKCFpc1BvcnRhYmxlVGV4dExpc3RJdGVtQmxvY2soYmxvY2spKSB7XG5cdFx0XHRcdHRyZWUucHVzaChibG9jayksIGN1cnJlbnRMaXN0ID0gdm9pZCAwO1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblx0XHRcdGlmICghY3VycmVudExpc3QpIHtcblx0XHRcdFx0Y3VycmVudExpc3QgPSBsaXN0RnJvbUJsb2NrKGJsb2NrLCBpLCBtb2RlKSwgdHJlZS5wdXNoKGN1cnJlbnRMaXN0KTtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cdFx0XHRpZiAoYmxvY2tNYXRjaGVzTGlzdChibG9jaywgY3VycmVudExpc3QpKSB7XG5cdFx0XHRcdGN1cnJlbnRMaXN0LmNoaWxkcmVuLnB1c2goYmxvY2spO1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblx0XHRcdGlmICgoYmxvY2subGV2ZWwgfHwgMSkgPiBjdXJyZW50TGlzdC5sZXZlbCkge1xuXHRcdFx0XHRsZXQgbmV3TGlzdCA9IGxpc3RGcm9tQmxvY2soYmxvY2ssIGksIG1vZGUpO1xuXHRcdFx0XHRpZiAobW9kZSA9PT0gXCJodG1sXCIpIHtcblx0XHRcdFx0XHRsZXQgbGFzdExpc3RJdGVtID0gY3VycmVudExpc3QuY2hpbGRyZW5bY3VycmVudExpc3QuY2hpbGRyZW4ubGVuZ3RoIC0gMV0sIG5ld0xhc3RDaGlsZCA9IHtcblx0XHRcdFx0XHRcdC4uLmxhc3RMaXN0SXRlbSxcblx0XHRcdFx0XHRcdGNoaWxkcmVuOiBbLi4ubGFzdExpc3RJdGVtLmNoaWxkcmVuLCBuZXdMaXN0XVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0Y3VycmVudExpc3QuY2hpbGRyZW5bY3VycmVudExpc3QuY2hpbGRyZW4ubGVuZ3RoIC0gMV0gPSBuZXdMYXN0Q2hpbGQ7XG5cdFx0XHRcdH0gZWxzZSBjdXJyZW50TGlzdC5jaGlsZHJlbi5wdXNoKG5ld0xpc3QpO1xuXHRcdFx0XHRjdXJyZW50TGlzdCA9IG5ld0xpc3Q7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXHRcdFx0aWYgKChibG9jay5sZXZlbCB8fCAxKSA8IGN1cnJlbnRMaXN0LmxldmVsKSB7XG5cdFx0XHRcdGxldCBtYXRjaGluZ0JyYW5jaCA9IHRyZWVbdHJlZS5sZW5ndGggLSAxXSwgbWF0Y2ggPSBtYXRjaGluZ0JyYW5jaCAmJiBmaW5kTGlzdE1hdGNoaW5nKG1hdGNoaW5nQnJhbmNoLCBibG9jayk7XG5cdFx0XHRcdGlmIChtYXRjaCkge1xuXHRcdFx0XHRcdGN1cnJlbnRMaXN0ID0gbWF0Y2gsIGN1cnJlbnRMaXN0LmNoaWxkcmVuLnB1c2goYmxvY2spO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGN1cnJlbnRMaXN0ID0gbGlzdEZyb21CbG9jayhibG9jaywgaSwgbW9kZSksIHRyZWUucHVzaChjdXJyZW50TGlzdCk7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXHRcdFx0aWYgKGJsb2NrLmxpc3RJdGVtICE9PSBjdXJyZW50TGlzdC5saXN0SXRlbSkge1xuXHRcdFx0XHRsZXQgbWF0Y2hpbmdCcmFuY2ggPSB0cmVlW3RyZWUubGVuZ3RoIC0gMV0sIG1hdGNoID0gbWF0Y2hpbmdCcmFuY2ggJiYgZmluZExpc3RNYXRjaGluZyhtYXRjaGluZ0JyYW5jaCwgeyBsZXZlbDogYmxvY2subGV2ZWwgfHwgMSB9KTtcblx0XHRcdFx0aWYgKG1hdGNoICYmIG1hdGNoLmxpc3RJdGVtID09PSBibG9jay5saXN0SXRlbSkge1xuXHRcdFx0XHRcdGN1cnJlbnRMaXN0ID0gbWF0Y2gsIGN1cnJlbnRMaXN0LmNoaWxkcmVuLnB1c2goYmxvY2spO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGN1cnJlbnRMaXN0ID0gbGlzdEZyb21CbG9jayhibG9jaywgaSwgbW9kZSksIHRyZWUucHVzaChjdXJyZW50TGlzdCk7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGNvbnNvbGUud2FybihcIlVua25vd24gc3RhdGUgZW5jb3VudGVyZWQgZm9yIGJsb2NrXCIsIGJsb2NrKSwgdHJlZS5wdXNoKGJsb2NrKTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHRyZWU7XG59XG5mdW5jdGlvbiBibG9ja01hdGNoZXNMaXN0KGJsb2NrLCBsaXN0KSB7XG5cdHJldHVybiAoYmxvY2subGV2ZWwgfHwgMSkgPT09IGxpc3QubGV2ZWwgJiYgYmxvY2subGlzdEl0ZW0gPT09IGxpc3QubGlzdEl0ZW07XG59XG5mdW5jdGlvbiBsaXN0RnJvbUJsb2NrKGJsb2NrLCBpbmRleCwgbW9kZSkge1xuXHRyZXR1cm4ge1xuXHRcdF90eXBlOiBcIkBsaXN0XCIsXG5cdFx0X2tleTogYCR7YmxvY2suX2tleSB8fCBgJHtpbmRleH1gfS1wYXJlbnRgLFxuXHRcdG1vZGUsXG5cdFx0bGV2ZWw6IGJsb2NrLmxldmVsIHx8IDEsXG5cdFx0bGlzdEl0ZW06IGJsb2NrLmxpc3RJdGVtLFxuXHRcdGNoaWxkcmVuOiBbYmxvY2tdXG5cdH07XG59XG5mdW5jdGlvbiBmaW5kTGlzdE1hdGNoaW5nKHJvb3ROb2RlLCBtYXRjaGluZykge1xuXHRsZXQgbGV2ZWwgPSBtYXRjaGluZy5sZXZlbCB8fCAxLCBzdHlsZSA9IG1hdGNoaW5nLmxpc3RJdGVtIHx8IFwibm9ybWFsXCIsIGZpbHRlck9uVHlwZSA9IHR5cGVvZiBtYXRjaGluZy5saXN0SXRlbSA9PSBcInN0cmluZ1wiO1xuXHRpZiAoaXNQb3J0YWJsZVRleHRUb29sa2l0TGlzdChyb290Tm9kZSkgJiYgKHJvb3ROb2RlLmxldmVsIHx8IDEpID09PSBsZXZlbCAmJiBmaWx0ZXJPblR5cGUgJiYgKHJvb3ROb2RlLmxpc3RJdGVtIHx8IFwibm9ybWFsXCIpID09PSBzdHlsZSkgcmV0dXJuIHJvb3ROb2RlO1xuXHRpZiAoIShcImNoaWxkcmVuXCIgaW4gcm9vdE5vZGUpKSByZXR1cm47XG5cdGxldCBub2RlID0gcm9vdE5vZGUuY2hpbGRyZW5bcm9vdE5vZGUuY2hpbGRyZW4ubGVuZ3RoIC0gMV07XG5cdHJldHVybiBub2RlICYmICFpc1BvcnRhYmxlVGV4dFNwYW4obm9kZSkgPyBmaW5kTGlzdE1hdGNoaW5nKG5vZGUsIG1hdGNoaW5nKSA6IHZvaWQgMDtcbn1cbmZ1bmN0aW9uIHNwYW5Ub1BsYWluVGV4dChzcGFuKSB7XG5cdGxldCB0ZXh0ID0gXCJcIjtcblx0cmV0dXJuIHNwYW4uY2hpbGRyZW4uZm9yRWFjaCgoY3VycmVudCkgPT4ge1xuXHRcdGlzUG9ydGFibGVUZXh0VG9vbGtpdFRleHROb2RlKGN1cnJlbnQpID8gdGV4dCArPSBjdXJyZW50LnRleHQgOiBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuKGN1cnJlbnQpICYmICh0ZXh0ICs9IHNwYW5Ub1BsYWluVGV4dChjdXJyZW50KSk7XG5cdH0pLCB0ZXh0O1xufVxuY29uc3QgbGVhZGluZ1NwYWNlID0gL15cXHMvLCB0cmFpbGluZ1NwYWNlID0gL1xccyQvO1xuZnVuY3Rpb24gdG9QbGFpblRleHQoYmxvY2spIHtcblx0bGV0IGJsb2NrcyA9IEFycmF5LmlzQXJyYXkoYmxvY2spID8gYmxvY2sgOiBbYmxvY2tdLCB0ZXh0ID0gXCJcIjtcblx0cmV0dXJuIGJsb2Nrcy5mb3JFYWNoKChjdXJyZW50LCBpbmRleCkgPT4ge1xuXHRcdGlmICghaXNQb3J0YWJsZVRleHRCbG9jayhjdXJyZW50KSkgcmV0dXJuO1xuXHRcdGxldCBwYWQgPSAhMTtcblx0XHRjdXJyZW50LmNoaWxkcmVuLmZvckVhY2goKHNwYW4pID0+IHtcblx0XHRcdGlzUG9ydGFibGVUZXh0U3BhbihzcGFuKSA/ICh0ZXh0ICs9IHBhZCAmJiB0ZXh0ICYmICF0cmFpbGluZ1NwYWNlLnRlc3QodGV4dCkgJiYgIWxlYWRpbmdTcGFjZS50ZXN0KHNwYW4udGV4dCkgPyBcIiBcIiA6IFwiXCIsIHRleHQgKz0gc3Bhbi50ZXh0LCBwYWQgPSAhMSkgOiBwYWQgPSAhMDtcblx0XHR9KSwgaW5kZXggIT09IGJsb2Nrcy5sZW5ndGggLSAxICYmICh0ZXh0ICs9IFwiXFxuXFxuXCIpO1xuXHR9KSwgdGV4dDtcbn1cbmNvbnN0IExJU1RfTkVTVF9NT0RFX0hUTUwgPSBcImh0bWxcIiwgTElTVF9ORVNUX01PREVfRElSRUNUID0gXCJkaXJlY3RcIjtcbmV4cG9ydCB7IExJU1RfTkVTVF9NT0RFX0RJUkVDVCwgTElTVF9ORVNUX01PREVfSFRNTCwgYnVpbGRNYXJrc1RyZWUsIGlzUG9ydGFibGVUZXh0QmxvY2ssIGlzUG9ydGFibGVUZXh0TGlzdEl0ZW1CbG9jaywgaXNQb3J0YWJsZVRleHRTcGFuLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRMaXN0LCBpc1BvcnRhYmxlVGV4dFRvb2xraXRTcGFuLCBpc1BvcnRhYmxlVGV4dFRvb2xraXRUZXh0Tm9kZSwgbmVzdExpc3RzLCBzb3J0TWFya3NCeU9jY3VyZW5jZXMsIHNwYW5Ub1BsYWluVGV4dCwgdG9QbGFpblRleHQgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@portabletext/toolkit/dist/index.js\n");

/***/ })

};
;